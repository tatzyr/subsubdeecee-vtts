[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=0"
  },
  {
    "text": "Scott: Hi, I'm Scott Mionis from the Virtualization Team, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=10"
  },
  {
    "text": "and today we'll cover how features in macOS Sonoma ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=14"
  },
  {
    "text": "enable you to create seamless experiences with Virtualization. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=19"
  },
  {
    "text": "Virtualization framework lets you configure, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=23"
  },
  {
    "text": "manage, and run virtual machines. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=26"
  },
  {
    "text": "In macOS Sonoma, virtual Macs and Linux virtual machines ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=29"
  },
  {
    "text": "are more powerful than ever. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=32"
  },
  {
    "text": "They're easier to use, and with new configuration options, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=35"
  },
  {
    "text": "they are highly customizable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=38"
  },
  {
    "text": "There are a bunch of features that make this possible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=41"
  },
  {
    "text": "In this session, let's explore a few key items ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=45"
  },
  {
    "text": "and how to leverage them in your applications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=48"
  },
  {
    "text": "First, new workflows in virtual machines and improvements to the user experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=51"
  },
  {
    "text": "Next, new storage and keyboard configuration options. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=58"
  },
  {
    "text": "And last, how Rosetta 2 is making x86_64 applications run even faster ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=62"
  },
  {
    "text": "in Linux virtual machines. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=68"
  },
  {
    "text": "Let's dive into some of the new ways to work with virtual machines. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=70"
  },
  {
    "text": "We will go over two powerful new features. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=75"
  },
  {
    "text": "First is the resizable display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=79"
  },
  {
    "text": "A new display option for virtual machines ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=81"
  },
  {
    "text": "that resizes at runtime to fill the window. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=84"
  },
  {
    "text": "And next, saving and restoring a virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=88"
  },
  {
    "text": "A mechanism for serializing a running virtual machine to disk ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=91"
  },
  {
    "text": "so it can be resumed later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=95"
  },
  {
    "text": "Let's start with the resizable display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=98"
  },
  {
    "text": "Screen size is a big part of working on a virtual Mac. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=101"
  },
  {
    "text": "With a resizable display, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=106"
  },
  {
    "text": "the virtual machine dynamically adjusts the screen resolution to fill the window, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=108"
  },
  {
    "text": "making the most efficient use of your space. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=113"
  },
  {
    "text": "Let's put this into code.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=117"
  },
  {
    "text": "To use the resizable display in your own application, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=120"
  },
  {
    "text": "First, initialize a VZVirtualMachineView.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=123"
  },
  {
    "text": "To make the display resizable, set the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=129"
  },
  {
    "text": "\"automaticallyReconfiguresDisplay\" property to true. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=133"
  },
  {
    "text": "And that's it! ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=137"
  },
  {
    "text": "Resizing the VZVirtualMachineView will now automatically ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=139"
  },
  {
    "text": "tell the virtual machine to adjust its display size. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=143"
  },
  {
    "text": "And if you prefer to keep the display fixed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=146"
  },
  {
    "text": "this property can remain its default value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=149"
  },
  {
    "text": "Next, let's discuss saving, and restoring a virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=153"
  },
  {
    "text": "Stopping a virtual machine means powering off the VM. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=158"
  },
  {
    "text": "Starting a virtual machine means doing a cold boot. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=162"
  },
  {
    "text": "But when working on a Mac, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=166"
  },
  {
    "text": "most applications save your progress as you work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=168"
  },
  {
    "text": "The same should hold for virtual machines.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=172"
  },
  {
    "text": "Let's say I'm running a virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=176"
  },
  {
    "text": "And I want to close it without losing my progress. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=179"
  },
  {
    "text": "I can save my virtual machine to a file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=182"
  },
  {
    "text": "and resume running it later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=185"
  },
  {
    "text": "Or, let's say I want to back up my work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=189"
  },
  {
    "text": "I can save my virtual machine at any point, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=193"
  },
  {
    "text": "making sure to clone external resources like disk and auxiliary storage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=197"
  },
  {
    "text": "And if I want to jump back in time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=203"
  },
  {
    "text": "I can rewind the virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=206"
  },
  {
    "text": "right back to my previous state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=208"
  },
  {
    "text": "So much is possible with this feature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=211"
  },
  {
    "text": "So now let's put it into action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=213"
  },
  {
    "text": "I'm running macOS Sonoma, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=217"
  },
  {
    "text": "and on my desktop is a virtual Mac, also running macOS Sonoma, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=219"
  },
  {
    "text": "in the Virtualization sample application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=223"
  },
  {
    "text": "And I'm doing some research for my next exciting trip to the Apple Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=226"
  },
  {
    "text": "Of course, I have Maps open, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=230"
  },
  {
    "text": "and I'm browsing the Apple website for more information on AirPods. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=232"
  },
  {
    "text": "Now, I want to take a break without turning off the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=237"
  },
  {
    "text": "So I save my virtual machine as I quit the application.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=241"
  },
  {
    "text": "Later on, I relaunch the application, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=247"
  },
  {
    "text": "and my virtual machine resumes running right where I left off, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=250"
  },
  {
    "text": "with all my tabs open. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=254"
  },
  {
    "text": "Let's explore how to build this into your own application.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=257"
  },
  {
    "text": "Before saving the virtual machine, pause the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=262"
  },
  {
    "text": "This puts the virtual machine into a stable state, with execution suspended. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=266"
  },
  {
    "text": "Then, invoke the new saveMachineState API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=272"
  },
  {
    "text": "which writes a file to the URL you specify, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=277"
  },
  {
    "text": "containing all of the runtime state of the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=280"
  },
  {
    "text": "Everything you need to keep running it later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=284"
  },
  {
    "text": "External resources, like disk images, should be copied separately. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=288"
  },
  {
    "text": "Now that we've saved the virtual machine, let's restore it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=293"
  },
  {
    "text": "To restore the state of the virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=299"
  },
  {
    "text": "start by creating a new VZVirtualMachine from the same configuration.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=302"
  },
  {
    "text": "Instead of starting the virtual machine directly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=308"
  },
  {
    "text": "which cold-boots the virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=311"
  },
  {
    "text": "invoke the new restoreMachineState API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=315"
  },
  {
    "text": "passing in the URL of the file that was saved earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=319"
  },
  {
    "text": "And now, the virtual machine is in exactly the same state as before.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=323"
  },
  {
    "text": "You can resume running it right where it left off. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=330"
  },
  {
    "text": "When restoring a virtual machine from a previous save, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=334"
  },
  {
    "text": "there are a few things to keep in mind. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=337"
  },
  {
    "text": "First, a save file contains a virtual machine's data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=341"
  },
  {
    "text": "It needs to be protected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=346"
  },
  {
    "text": "These files are hardware encrypted ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=348"
  },
  {
    "text": "to provide the strongest possible guarantees. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=351"
  },
  {
    "text": "No other Mac or user account can read another's save file, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=355"
  },
  {
    "text": "or restore the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=359"
  },
  {
    "text": "Also, files saved today are versioned, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=362"
  },
  {
    "text": "so new capabilities can be added in the future. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=366"
  },
  {
    "text": "If the file format changes, and a save file cannot be restored, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=370"
  },
  {
    "text": "the framework will return specific error codes so your application can handle it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=375"
  },
  {
    "text": "When this happens, discard the file, reboot the virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=381"
  },
  {
    "text": "and you're back on track. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=386"
  },
  {
    "text": "Next, let's explore some of the new ways to build a virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=388"
  },
  {
    "text": "First is Network block device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=393"
  },
  {
    "text": "This allows a storage device to be attached to a virtual machine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=396"
  },
  {
    "text": "from over the network. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=399"
  },
  {
    "text": "Next is support for NVMe controller devices, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=401"
  },
  {
    "text": "an alternative to the virtio block device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=405"
  },
  {
    "text": "And finally, the Mac keyboard, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=409"
  },
  {
    "text": "which makes working in a virtual Mac more intuitive ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=411"
  },
  {
    "text": "by mapping Apple-specific keys, like the Globe key, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=414"
  },
  {
    "text": "directly through to the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=417"
  },
  {
    "text": "Let's start, with Network block device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=420"
  },
  {
    "text": "In Virtualization framework, storage is typically served locally, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=424"
  },
  {
    "text": "reading and writing a disk image on the same Mac. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=429"
  },
  {
    "text": "But in macOS Sonoma, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=433"
  },
  {
    "text": "Virtualization framework can serve storage remotely from a server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=436"
  },
  {
    "text": "The protocol that allows this is Network block device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=441"
  },
  {
    "text": "or NBD. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=445"
  },
  {
    "text": "Let's dive into how it works. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=447"
  },
  {
    "text": "Virtualization framework implements the client side of the NBD protocol. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=450"
  },
  {
    "text": "When a virtual machine accesses the disk, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=457"
  },
  {
    "text": "the request is forwarded to an NBD Server ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=460"
  },
  {
    "text": "that adheres to the same specification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=463"
  },
  {
    "text": "After doing whatever I/O it needs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=467"
  },
  {
    "text": "the NBD server responds with data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=471"
  },
  {
    "text": "This is extremely flexible for two reasons. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=475"
  },
  {
    "text": "First, the storage can now reside anywhere; ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=480"
  },
  {
    "text": "on the same Mac, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=485"
  },
  {
    "text": "or on a remote server over the network. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=487"
  },
  {
    "text": "And second, since the storage is managed by your own server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=491"
  },
  {
    "text": "you can implement whatever custom I/O you need, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=496"
  },
  {
    "text": "whether that be custom image formats, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=500"
  },
  {
    "text": "or even physical drives. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=503"
  },
  {
    "text": "All of this completely transparently to the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=505"
  },
  {
    "text": "Let's look at how to set this up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=509"
  },
  {
    "text": "In Virtualization framework API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=512"
  },
  {
    "text": "there are two parts to initializing a storage device.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=515"
  },
  {
    "text": "First you choose a device type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=520"
  },
  {
    "text": "This defines the interface that is presented to the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=523"
  },
  {
    "text": "And then you choose an attachment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=527"
  },
  {
    "text": "This selects how the data is actually represented on your Mac. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=530"
  },
  {
    "text": "In virtual machines, you can mix and match. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=535"
  },
  {
    "text": "Virtualization framework supports virtual devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=539"
  },
  {
    "text": "such as the virtio block device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=542"
  },
  {
    "text": "and the USB mass storage device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=545"
  },
  {
    "text": "And with any of these devices, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=549"
  },
  {
    "text": "you can use attachments such as the disk image attachment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=551"
  },
  {
    "text": "which reads and writes data on a disk image, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=555"
  },
  {
    "text": "or the new, Network Block Device attachment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=558"
  },
  {
    "text": "which reads and writes data on an NBD server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=561"
  },
  {
    "text": "Let's set up this NBD attachment in code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=565"
  },
  {
    "text": "To use this in your application, first specify a URL ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=569"
  },
  {
    "text": "that points to the NBD server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=573"
  },
  {
    "text": "This is a special URL that identifies a specific disk on a specific server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=576"
  },
  {
    "text": "Then initialize the new NBD storage attachment with this URL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=582"
  },
  {
    "text": "Finally, initialize a storage device with this attachment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=588"
  },
  {
    "text": "This example uses the virtio block device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=592"
  },
  {
    "text": "For most use cases, this is likely to be the most performant option. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=596"
  },
  {
    "text": "Since storage is being served over the network, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=602"
  },
  {
    "text": "the connection can be lost at any time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=605"
  },
  {
    "text": "You may want to take action when this happens, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=608"
  },
  {
    "text": "to pause the virtual machine, or re-establish the connection.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=611"
  },
  {
    "text": "If this is the case, you can attach a custom delegate class, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=617"
  },
  {
    "text": "which will be notified when the state of the connection changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=622"
  },
  {
    "text": "so you can run whatever code you need. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=626"
  },
  {
    "text": "Adding to Virtualization framework's storage options ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=629"
  },
  {
    "text": "is Non-Volatile Memory express, or NVMe. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=632"
  },
  {
    "text": "NVMe is a standardized technology enabled in many Linux kernels, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=637"
  },
  {
    "text": "and its applications are more specific, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=642"
  },
  {
    "text": "so let's start with why you might want to use it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=644"
  },
  {
    "text": "For a vast majority of use-cases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=648"
  },
  {
    "text": "the paravirtualized interface provided by virtio block storage ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=650"
  },
  {
    "text": "is the easiest and fastest to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=655"
  },
  {
    "text": "This is certainly the case for virtual Macs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=659"
  },
  {
    "text": "But some Linux virtual machines ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=663"
  },
  {
    "text": "don't have virtio drivers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=666"
  },
  {
    "text": "These may be kernels that are not built to run in virtual environments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=669"
  },
  {
    "text": "What these kernels often do have ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=674"
  },
  {
    "text": "are drivers for NVMe controller devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=677"
  },
  {
    "text": "In macOS Sonoma, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=681"
  },
  {
    "text": "NVMe controller devices are emulated by Virtualization framework, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=683"
  },
  {
    "text": "allowing more operating systems to be run in virtual machines. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=688"
  },
  {
    "text": "To configure NVMe, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=693"
  },
  {
    "text": "use the new device type when building your virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=695"
  },
  {
    "text": "NVMe is for Linux virtual machines only, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=700"
  },
  {
    "text": "and, of course, also supports NBD. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=703"
  },
  {
    "text": "And now, with the Mac keyboard, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=707"
  },
  {
    "text": "Apple-specific keypresses are captured by a virtual Mac. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=709"
  },
  {
    "text": "Meaning you can use the Globe key for features like language switching, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=713"
  },
  {
    "text": "or even emoting in a virtual Mac. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=717"
  },
  {
    "text": "Now let's talk about Rosetta 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=720"
  },
  {
    "text": "Rosetta 2, in a Linux virtual machine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=724"
  },
  {
    "text": "is the same technology used on macOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=726"
  },
  {
    "text": "And in macOS Sonoma, performance improvements mean ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=730"
  },
  {
    "text": "Rosetta 2 runs even faster in a virtual Linux environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=733"
  },
  {
    "text": "Let's dive into how this is possible.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=737"
  },
  {
    "text": "Rosetta 2 translates executable pages on-demand, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=741"
  },
  {
    "text": "which allows it to launch the executable much faster ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=745"
  },
  {
    "text": "than if it had to wait to translate the entire x86_64 application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=749"
  },
  {
    "text": "But this also means that while the application is running, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=755"
  },
  {
    "text": "Rosetta 2 must stop execution periodically ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=759"
  },
  {
    "text": "to translate new regions of code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=762"
  },
  {
    "text": "This overhead is likely to be the most noticeable ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=765"
  },
  {
    "text": "when the application has just started running, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=768"
  },
  {
    "text": "as code needs to be translated for the very first time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=772"
  },
  {
    "text": "But if I launched another application ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=776"
  },
  {
    "text": "that linked against the same libraries or ran the same executables, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=779"
  },
  {
    "text": "Rosetta 2 has to do all that work over again, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=784"
  },
  {
    "text": "even though that code has already been translated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=788"
  },
  {
    "text": "This problem can be solved with caching. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=791"
  },
  {
    "text": "Whenever a library or executable binary is translated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=795"
  },
  {
    "text": "Rosetta 2 saves the result in a cache on disk ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=799"
  },
  {
    "text": "and shares that with any other application that needs it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=803"
  },
  {
    "text": "avoiding unnecessary retranslation overhead. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=807"
  },
  {
    "text": "In macOS Sonoma, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=812"
  },
  {
    "text": "Virtualization framework brings this optimization to Linux virtual machines ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=813"
  },
  {
    "text": "with a new runtime daemon. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=818"
  },
  {
    "text": "There are two steps you will need to take, to set this up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=821"
  },
  {
    "text": "First, there is a new API to configure the communication channel ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=826"
  },
  {
    "text": "between the Rosetta 2 runtime and the new caching daemon. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=829"
  },
  {
    "text": "And then, you'll need to launch the daemon in the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=834"
  },
  {
    "text": "The Rosetta 2 runtime and the new daemon ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=838"
  },
  {
    "text": "will now run alongside each other in the virtual machine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=842"
  },
  {
    "text": "The two programs communicate with Virtualization framework ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=846"
  },
  {
    "text": "to establish a connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=850"
  },
  {
    "text": "Dynamic linker requests, among others, will be forwarded to the daemon, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=852"
  },
  {
    "text": "which manages the cache, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=857"
  },
  {
    "text": "and the Rosetta 2 runtime will fetch pre-translated binaries ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=858"
  },
  {
    "text": "directly from the daemon, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=862"
  },
  {
    "text": "eliminating the retranslation overhead. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=865"
  },
  {
    "text": "You'll see the biggest impact on exec-heavy tasks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=868"
  },
  {
    "text": "like compilation or package installation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=871"
  },
  {
    "text": "Virtualization framework allows you to bring so many great options ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=874"
  },
  {
    "text": "to your applications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=878"
  },
  {
    "text": "Let's talk about ways to get started. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=880"
  },
  {
    "text": "Consider using the resizable display ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=884"
  },
  {
    "text": "for both virtual Macs and Linux virtual machines. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=886"
  },
  {
    "text": "It significantly improves the user experience with a single line of code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=891"
  },
  {
    "text": "The Mac keyboard is specifically designed to work seamlessly ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=897"
  },
  {
    "text": "with the newest virtual Macs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=901"
  },
  {
    "text": "Configuring virtual Macs with this device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=904"
  },
  {
    "text": "is an easy way to boost the user experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=906"
  },
  {
    "text": "A few of these features are building blocks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=911"
  },
  {
    "text": "that you can use to build powerful experiences. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=914"
  },
  {
    "text": "The ability to save a virtual machine is one example. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=917"
  },
  {
    "text": "Start investigating how rewinding or saving progress ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=921"
  },
  {
    "text": "fits into your application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=924"
  },
  {
    "text": "And the flexibility offered by NBD is incredible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=927"
  },
  {
    "text": "NBD can unlock a lot of possibilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=932"
  },
  {
    "text": "for applications needing custom IO. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=935"
  },
  {
    "text": "This is just the beginning of what virtual machines can do in macOS Sonoma. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=939"
  },
  {
    "text": "Thank you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=946"
  },
  {
    "text": "The Virtualization team can't wait to see what you build. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=947"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10007/?time=951"
  }
]