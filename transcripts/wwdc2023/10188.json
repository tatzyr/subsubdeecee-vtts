[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=0"
  },
  {
    "text": "Tim: Hi, I'm Tim, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=10"
  },
  {
    "text": "I'm an engineer on the CloudKit team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=12"
  },
  {
    "text": "My colleague Aamer and I are here to talk about a new CloudKit API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=14"
  },
  {
    "text": "called CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=17"
  },
  {
    "text": "CKSyncEngine is designed to help sync data between the device and the cloud. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=19"
  },
  {
    "text": "First, I'll talk about the state of syncing to CloudKit on Apple platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=23"
  },
  {
    "text": "Next, I'll give an overview of what CKSyncEngine is and how it works. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=27"
  },
  {
    "text": "Then, you'll learn about how to get started with CKSyncEngine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=32"
  },
  {
    "text": "in your own project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=35"
  },
  {
    "text": "Once you're set up, you'll learn how to use the sync engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=37"
  },
  {
    "text": "to sync data across devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=39"
  },
  {
    "text": "Finally, you'll learn about best practices for testing ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=42"
  },
  {
    "text": "and debugging your integration with CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=45"
  },
  {
    "text": "First, the state of syncing to CloudKit.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=48"
  },
  {
    "text": "When you build a new app, people just expect their data to sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=54"
  },
  {
    "text": "They make something on their iPhone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=57"
  },
  {
    "text": "and when they open up their Mac, they expect it to be there too. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=59"
  },
  {
    "text": "From the outside, this looks like magic. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=62"
  },
  {
    "text": "Their data is in one place, and then it's everywhere. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=65"
  },
  {
    "text": "For you and me, it's not that easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=69"
  },
  {
    "text": "CloudKit itself isn't that complicated, but syncing in general is hard. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=71"
  },
  {
    "text": "When you bring multiple devices into the scenario, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=76"
  },
  {
    "text": "there's just a lot that can go wrong. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=79"
  },
  {
    "text": "So the simpler you can make your sync code, the better. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=81"
  },
  {
    "text": "And the best way to simplify your sync code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=85"
  },
  {
    "text": "is to write as little as possible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=87"
  },
  {
    "text": "Thankfully, you have some great API choices for syncing with CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=89"
  },
  {
    "text": "and these APIs do a lot of the heavy lifting for you.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=93"
  },
  {
    "text": "If you want a full-stack solution that includes local persistence, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=97"
  },
  {
    "text": "you can use NSPersistentCloudKitContainer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=100"
  },
  {
    "text": "If you want to bring your own local persistence, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=103"
  },
  {
    "text": "you can use the new CKSyncEngine API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=105"
  },
  {
    "text": "If you still think you need more fine-grained control, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=109"
  },
  {
    "text": "you can use CKDatabase and CKOperations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=111"
  },
  {
    "text": "But if you want to sync with CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=114"
  },
  {
    "text": "and if you're not using NSPersistentCloudKitContainer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=116"
  },
  {
    "text": "you should use CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=119"
  },
  {
    "text": "Sync involves many moving parts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=120"
  },
  {
    "text": "and using a higher level API like CKSyncEngine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=123"
  },
  {
    "text": "can help reduce complexity and improve your app's sync experience.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=125"
  },
  {
    "text": "At its core, sync is mostly just sending changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=130"
  },
  {
    "text": "from one device and fetching them on another, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=134"
  },
  {
    "text": "converting to and from CloudKit records when necessary. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=136"
  },
  {
    "text": "That's pretty easy to do on its own, but there's more than just that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=140"
  },
  {
    "text": "You need to learn about all the different operations and errors, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=144"
  },
  {
    "text": "monitor system conditions, listen for account changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=147"
  },
  {
    "text": "handle push notifications, manage your subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=150"
  },
  {
    "text": "track a bunch of state, and a whole lot more. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=153"
  },
  {
    "text": "When you use CKSyncEngine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=156"
  },
  {
    "text": "the amount of sync code you have to write ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=158"
  },
  {
    "text": "becomes much smaller and more focused. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=159"
  },
  {
    "text": "You only have to handle the things that are specific to your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=161"
  },
  {
    "text": "and the sync engine handles the rest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=164"
  },
  {
    "text": "In order to write a proper sync engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=167"
  },
  {
    "text": "you probably need several thousands of lines of code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=169"
  },
  {
    "text": "and then double that amount in your tests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=173"
  },
  {
    "text": "I actually heard a rumor that NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=176"
  },
  {
    "text": "is backed by over 70,000 lines of tests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=179"
  },
  {
    "text": "CKSyncEngine has quite a lot of tests as well, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=183"
  },
  {
    "text": "and that's 'cause it handles a lot of this stuff for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=185"
  },
  {
    "text": "So what is this new CKSyncEngine API? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=189"
  },
  {
    "text": "CKSyncEngine encapsulates the common logic for syncing with a CloudKit database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=193"
  },
  {
    "text": "It aims to provide a convenient API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=197"
  },
  {
    "text": "while also giving flexibility when necessary. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=200"
  },
  {
    "text": "It's designed to meet the needs of most apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=203"
  },
  {
    "text": "that would otherwise write their own custom sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=205"
  },
  {
    "text": "Generally, if you're looking to sync your app's private or shared data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=208"
  },
  {
    "text": "CKSyncEngine is a great choice. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=212"
  },
  {
    "text": "The data model you use with the sync engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=215"
  },
  {
    "text": "consists of records and zones, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=217"
  },
  {
    "text": "which are the same types of data used in the rest of CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=219"
  },
  {
    "text": "You can access any of this data using any existing CloudKit API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=222"
  },
  {
    "text": "Because of this, if you already have an existing CloudKit sync implementation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=227"
  },
  {
    "text": "CKSyncEngine can sync with that as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=230"
  },
  {
    "text": "The sync engine is being used by several apps and services across the system, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=233"
  },
  {
    "text": "including the Freeform app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=237"
  },
  {
    "text": "Another example is NSUbiquitousKeyValueStore, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=240"
  },
  {
    "text": "which was rewritten on top of the sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=244"
  },
  {
    "text": "This is a good example of a backward compatible use case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=246"
  },
  {
    "text": "In newer OSes it uses the sync engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=249"
  },
  {
    "text": "but it still syncs with previous versions as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=252"
  },
  {
    "text": "So if you already have a custom CloudKit sync implementation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=255"
  },
  {
    "text": "then you have the option to switch to CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=258"
  },
  {
    "text": "If the benefits sound enticing enough, you should consider switching, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=261"
  },
  {
    "text": "but it's not required. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=264"
  },
  {
    "text": "Sometimes, it's nice to just have less code to maintain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=267"
  },
  {
    "text": "You'll also be able to benefit whenever CKSyncEngine gets a new enhancement. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=271"
  },
  {
    "text": "As the platform evolves, the sync engine will evolve as well, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=275"
  },
  {
    "text": "making it easier and more efficient to sync as time goes on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=278"
  },
  {
    "text": "You might also benefit from the smaller API surface of CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=283"
  },
  {
    "text": "This allows you to focus on your app's specific data model and use case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=287"
  },
  {
    "text": "If you're considering using CKSyncEngine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=291"
  },
  {
    "text": "but you have some specific needs that it doesn't support, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=293"
  },
  {
    "text": "you can always build your own if you'd like. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=296"
  },
  {
    "text": "However, if you think your needs could be satisfied ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=298"
  },
  {
    "text": "by a new feature in CKSyncEngine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=301"
  },
  {
    "text": "consider filing a feedback with your use case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=303"
  },
  {
    "text": "After all, some of the best ideas for the sync engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=305"
  },
  {
    "text": "have come from developers like you.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=308"
  },
  {
    "text": "So how does the sync engine actually work? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=311"
  },
  {
    "text": "Generally, the sync engine acts as a conduit of data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=314"
  },
  {
    "text": "between your app and the CloudKit server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=317"
  },
  {
    "text": "Your app communicates with the sync engine in terms of records and zones. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=319"
  },
  {
    "text": "When there are changes to save, your app gives them to the sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=323"
  },
  {
    "text": "When it fetches these changes on another device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=327"
  },
  {
    "text": "it gives them to your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=329"
  },
  {
    "text": "That said, when the sync engine has work to do, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=331"
  },
  {
    "text": "it doesn't always do it immediately. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=333"
  },
  {
    "text": "If it needs to communicate with the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=336"
  },
  {
    "text": "it'll first consult with the system task scheduler. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=337"
  },
  {
    "text": "This is the same scheduler used across the OS for background task management, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=340"
  },
  {
    "text": "and it makes sure that the device is ready to sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=344"
  },
  {
    "text": "Once the device is ready, the scheduler runs the task, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=347"
  },
  {
    "text": "and the sync engine talks with the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=350"
  },
  {
    "text": "This is the basic flow of operation for the sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=352"
  },
  {
    "text": "More specifically, what does it look like ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=356"
  },
  {
    "text": "when the sync engine sends changes to the server? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=358"
  },
  {
    "text": "First, someone makes a modification to the data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=361"
  },
  {
    "text": "Maybe they typed something or they flipped a switch ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=364"
  },
  {
    "text": "or deleted an object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=367"
  },
  {
    "text": "Then, your app tells the sync engine that there's a pending change ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=369"
  },
  {
    "text": "to send to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=372"
  },
  {
    "text": "This lets the sync engine know that it has work to do. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=373"
  },
  {
    "text": "Next, the sync engine submits a task to the scheduler. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=377"
  },
  {
    "text": "Once the device is ready, the scheduler runs the task. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=380"
  },
  {
    "text": "When the task runs, the sync engine starts the process ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=384"
  },
  {
    "text": "of sending changes to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=387"
  },
  {
    "text": "In order to do that, it asks your app for the next batch of changes to send. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=389"
  },
  {
    "text": "If someone made a single modification, you might only have one pending change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=393"
  },
  {
    "text": "However, if someone imports a huge database of new data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=398"
  },
  {
    "text": "you might have hundreds or thousands of changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=401"
  },
  {
    "text": "Since there's a limit on how much can be sent to the server in a single request, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=405"
  },
  {
    "text": "the sync engine asks for these changes in batches. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=408"
  },
  {
    "text": "This also helps to reduce memory overhead by not bringing any records into memory ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=411"
  },
  {
    "text": "until they're actually needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=414"
  },
  {
    "text": "After you provide the next batch, the sync engine sends it to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=417"
  },
  {
    "text": "The server responds with the result of the operation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=421"
  },
  {
    "text": "including any information about the success or failure of these changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=424"
  },
  {
    "text": "Once the request finishes, the sync engine calls back to your app with the result. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=428"
  },
  {
    "text": "This is your opportunity to react to the success or failure of the operation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=432"
  },
  {
    "text": "If you have any more pending changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=437"
  },
  {
    "text": "the sync engine will continue to ask for batches ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=439"
  },
  {
    "text": "until there's nothing left to send. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=441"
  },
  {
    "text": "Now that one device has sent some data to the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=444"
  },
  {
    "text": "other devices will fetch that data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=447"
  },
  {
    "text": "When the server receives a new change, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=449"
  },
  {
    "text": "it sends a push notification to the other devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=451"
  },
  {
    "text": "that have access to that data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=454"
  },
  {
    "text": "CKSyncEngine automatically listens for these push notifications in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=456"
  },
  {
    "text": "When it receives a notification, it submits a task to the scheduler. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=460"
  },
  {
    "text": "When the scheduler task runs, the sync engine fetches from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=464"
  },
  {
    "text": "When it fetches new changes, it gives them to your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=469"
  },
  {
    "text": "This is your chance to persist these changes locally and show them in the UI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=472"
  },
  {
    "text": "And that's the basic flow of operations when using the sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=476"
  },
  {
    "text": "One thing all these flows have in common is the system scheduler. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=480"
  },
  {
    "text": "Generally, CKSyncEngine will consult the scheduler before doing anything. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=484"
  },
  {
    "text": "This is how it's able to automatically sync on your behalf.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=488"
  },
  {
    "text": "The scheduler monitors system conditions like network connectivity, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=493"
  },
  {
    "text": "battery level, resource usage, and more. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=496"
  },
  {
    "text": "It makes sure the device has met any prerequisite conditions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=499"
  },
  {
    "text": "before it tries to sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=501"
  },
  {
    "text": "By respecting the scheduler, the sync engine can ensure ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=504"
  },
  {
    "text": "a proper balance between user experience and device resources. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=506"
  },
  {
    "text": "In normal conditions, sync will be pretty fast, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=511"
  },
  {
    "text": "usually within a few seconds or so. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=514"
  },
  {
    "text": "However, if there's no network connection, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=516"
  },
  {
    "text": "or if the device's battery is low, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=518"
  },
  {
    "text": "then sync might be delayed or deferred. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=520"
  },
  {
    "text": "If the device is under a heavy load, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=523"
  },
  {
    "text": "you don't want your sync mechanism to interfere ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=525"
  },
  {
    "text": "with other more urgent tasks in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=527"
  },
  {
    "text": "By relying on the sync engine's automatic scheduling, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=531"
  },
  {
    "text": "you can be confident that you'll sync when you should, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=533"
  },
  {
    "text": "and not when you shouldn't. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=535"
  },
  {
    "text": "Not only is it more efficient, it's also just easier to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=538"
  },
  {
    "text": "If you don't have to worry about when to sync, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=541"
  },
  {
    "text": "you can focus on everything else. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=543"
  },
  {
    "text": "That said, there are legitimate use cases for manually performing a sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=546"
  },
  {
    "text": "You might have a pull-to-refresh UI that fetches immediately. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=551"
  },
  {
    "text": "Or you might have a button to back up now ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=554"
  },
  {
    "text": "that immediately sends any pending changes to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=556"
  },
  {
    "text": "Manually syncing can also be useful when writing automated tests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=560"
  },
  {
    "text": "It can help you simulate specific sync scenarios across multiple devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=564"
  },
  {
    "text": "where you need to control the order of events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=568"
  },
  {
    "text": "In general, we recommend that you rely on automatic sync scheduling. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=571"
  },
  {
    "text": "But, we understand that there are valid use cases for manual syncing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=574"
  },
  {
    "text": "and the sync engine has API to do that when necessary. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=578"
  },
  {
    "text": "And now, Aamer is going to talk about how to start using CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=581"
  },
  {
    "text": "Aamer: Thanks for that introduction, Tim. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=586"
  },
  {
    "text": "My name is Aamer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=589"
  },
  {
    "text": "I'm an engineer on the CloudKit Client team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=590"
  },
  {
    "text": "I'll now cover getting started with CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=593"
  },
  {
    "text": "Before you use CKSyncEngine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=597"
  },
  {
    "text": "there are a few things you need to do to set up your project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=599"
  },
  {
    "text": "These requirements are the same whether you're using CKSyncEngine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=603"
  },
  {
    "text": "or building your own custom CloudKit implementation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=607"
  },
  {
    "text": "First, you'll need a basic knowledge of CloudKit's fundamental data types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=610"
  },
  {
    "text": "CKRecord and CKRecordZone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=615"
  },
  {
    "text": "The sync engine API deals heavily in terms of records and zones, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=619"
  },
  {
    "text": "so you should understand what they are before diving in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=624"
  },
  {
    "text": "Next, you'll need to enable the CloudKit capability for your project in Xcode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=629"
  },
  {
    "text": "Finally, since the sync engine relies on push notifications to keep up to date, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=635"
  },
  {
    "text": "you'll also need to enable the remote notifications capability. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=641"
  },
  {
    "text": "Once you have all that, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=646"
  },
  {
    "text": "you're ready to initialize your sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=647"
  },
  {
    "text": "You should initialize your CKSyncEngine very soon after your app launches. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=651"
  },
  {
    "text": "When you initialize your sync engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=656"
  },
  {
    "text": "it will automatically start listening for push notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=658"
  },
  {
    "text": "and scheduler tasks in the background. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=661"
  },
  {
    "text": "These notifications and tasks might happen at any time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=665"
  },
  {
    "text": "and the sync engine needs to be initialized in order to handle them.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=669"
  },
  {
    "text": "The main means of communication between your app and CKSyncEngine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=675"
  },
  {
    "text": "is through a protocol called CKSyncEngineDelegate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=679"
  },
  {
    "text": "When initializing your sync engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=684"
  },
  {
    "text": "you'll need to provide an object that conforms to this protocol. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=686"
  },
  {
    "text": "In order to function properly and efficiently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=691"
  },
  {
    "text": "the sync engine tracks some internal state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=694"
  },
  {
    "text": "You'll also need to provide the last known version ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=698"
  },
  {
    "text": "of the sync engine state.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=700"
  },
  {
    "text": "While performing sync operations, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=704"
  },
  {
    "text": "it will occasionally give your delegate an updated version of this state ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=706"
  },
  {
    "text": "in the form of a state update event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=710"
  },
  {
    "text": "Whenever the sync engine gives you a new state serialization, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=714"
  },
  {
    "text": "you should persist it locally. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=718"
  },
  {
    "text": "This way, you can provide it the next time your process launches ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=720"
  },
  {
    "text": "and you initialize your sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=724"
  },
  {
    "text": "To help understand this, I'll explain it using a few code examples.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=728"
  },
  {
    "text": "In order to initialize a sync engine, you'll pass in a configuration object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=734"
  },
  {
    "text": "In the configuration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=740"
  },
  {
    "text": "you'll need to provide the database you want to sync with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=741"
  },
  {
    "text": "the last known version of the sync engine state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=744"
  },
  {
    "text": "and your delegate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=746"
  },
  {
    "text": "One of the functions in the delegate protocol is the handle event function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=749"
  },
  {
    "text": "This function is how the sync engine notifies your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=755"
  },
  {
    "text": "about different events that happen during normal sync operation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=758"
  },
  {
    "text": "For example, it'll post events when it fetches new data from the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=762"
  },
  {
    "text": "or when the account changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=767"
  },
  {
    "text": "One of these events is the state update event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=771"
  },
  {
    "text": "When the sync engine updates its internal state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=775"
  },
  {
    "text": "or when you update the state yourself, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=778"
  },
  {
    "text": "the sync engine will post a state update event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=780"
  },
  {
    "text": "In response to this event, you should locally persist ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=784"
  },
  {
    "text": "this new serialized version of the state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=787"
  },
  {
    "text": "In the example, you'll use this state serialization ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=791"
  },
  {
    "text": "the next time you initialize your sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=794"
  },
  {
    "text": "Now that the foundation is set up, I'll cover syncing with the sync engine.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=797"
  },
  {
    "text": "There are a few simple steps that allow you to send changes to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=803"
  },
  {
    "text": "First, add your pending record zone changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=808"
  },
  {
    "text": "and pending database changes to the sync engine state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=812"
  },
  {
    "text": "This will alert the sync engine that it should schedule a sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=816"
  },
  {
    "text": "The sync engine will ensure consistency and deduplicate these changes.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=821"
  },
  {
    "text": "Next, implement the delegate method nextRecordZoneChangeBatch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=828"
  },
  {
    "text": "The sync engine will call this to get the next batch of record zone changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=834"
  },
  {
    "text": "to send to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=838"
  },
  {
    "text": "Lastly, handle the events sentDatabaseChanges ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=840"
  },
  {
    "text": "and sentRecordZoneChanges. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=845"
  },
  {
    "text": "These events will post once changes are sent up to the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=847"
  },
  {
    "text": "Here's an example of sending changes to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=853"
  },
  {
    "text": "This application edits data and wants to sync new record changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=857"
  },
  {
    "text": "To do this, you'll tell the sync engine that you need to save that record ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=862"
  },
  {
    "text": "by adding a pending record zone change to the sync engine state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=867"
  },
  {
    "text": "When the sync engine is ready to sync the record, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=871"
  },
  {
    "text": "it will call the delegate method nextRecordZoneChangeBatch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=874"
  },
  {
    "text": "Here you'll return the next batch of changes to send to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=878"
  },
  {
    "text": "You initialize a RecordZoneChangeBatch ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=884"
  },
  {
    "text": "by providing the list of pending changes and a record provider. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=886"
  },
  {
    "text": "The list of pending changes contains the recordIDs to save or delete, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=892"
  },
  {
    "text": "and the record provider that will map those IDs to records ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=897"
  },
  {
    "text": "when the actual sync occurs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=900"
  },
  {
    "text": "Here's how your application can fetch changes from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=903"
  },
  {
    "text": "The sync engine automatically fetches changes for you from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=907"
  },
  {
    "text": "When it does, it will post the events fetchedDatabaseChanges ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=913"
  },
  {
    "text": "and fetchedRecordZoneChanges. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=917"
  },
  {
    "text": "Depending on your use case, you may want to listen for the events ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=921"
  },
  {
    "text": "willFetchChanges and didFetchChanges. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=924"
  },
  {
    "text": "For example, handing these events may be useful ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=929"
  },
  {
    "text": "if you want to perform any setup or cleanup tasks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=933"
  },
  {
    "text": "before or after fetching changes.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=935"
  },
  {
    "text": "Here's an example where our app fetches changes from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=939"
  },
  {
    "text": "When the sync engine fetches changes within a record zone ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=944"
  },
  {
    "text": "it will post the fetchedRecordZoneChanges event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=948"
  },
  {
    "text": "This event contains the modifications and deletions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=951"
  },
  {
    "text": "that were performed by another device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=955"
  },
  {
    "text": "When listening for this, you should check the fetched modifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=958"
  },
  {
    "text": "and fetched deletions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=962"
  },
  {
    "text": "When you receive modifications, you should persist the data locally. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=964"
  },
  {
    "text": "When you receive deletions, you should delete the data locally. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=969"
  },
  {
    "text": "Fetching database changes works very similarly ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=975"
  },
  {
    "text": "and can be handled with the same approach. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=978"
  },
  {
    "text": "Handling errors can be tricky. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=981"
  },
  {
    "text": "The sync engine helps with this too. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=984"
  },
  {
    "text": "The sync engine automatically handles transient errors ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=986"
  },
  {
    "text": "such as network issues, throttling, and account issues. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=990"
  },
  {
    "text": "The sync engine will automatically retry work that is affected by these errors. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=995"
  },
  {
    "text": "For other errors, your app will need to handle them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1001"
  },
  {
    "text": "Once you've resolved those errors, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1005"
  },
  {
    "text": "you should reschedule the work if necessary.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1007"
  },
  {
    "text": "This is an example of error handing when sending record zone changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1011"
  },
  {
    "text": "When the sentRecordZoneChanges event is posted, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1017"
  },
  {
    "text": "you should check the failedRecordSaves to see if any records failed to save.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1019"
  },
  {
    "text": "serverRecordChanged indicates that the record changed on the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1026"
  },
  {
    "text": "This means that another device saved a new version ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1030"
  },
  {
    "text": "the application hasn't fetched yet. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1033"
  },
  {
    "text": "You should resolve the conflict and reschedule the work.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1036"
  },
  {
    "text": "zoneNotFound indicates that the zone does not yet exist on the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1041"
  },
  {
    "text": "To resolve this, you may need to create the zone ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1046"
  },
  {
    "text": "and then reschedule the work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1049"
  },
  {
    "text": "The sync engine will always attempt to save zones first, and then records. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1052"
  },
  {
    "text": "networkFailure, networkUnavailable, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1058"
  },
  {
    "text": "serviceUnavailable, and requestRateLimited ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1061"
  },
  {
    "text": "are examples of transient errors that the sync engine will handle for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1064"
  },
  {
    "text": "You'll still receive these errors for your awareness ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1069"
  },
  {
    "text": "but you do not need to take action in response to them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1072"
  },
  {
    "text": "The sync engine will automatically retry for these errors ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1076"
  },
  {
    "text": "when system conditions permit.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1079"
  },
  {
    "text": "Another thing the sync engine helps with are account changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1083"
  },
  {
    "text": "iCloud account changes can happen at any time on a device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1087"
  },
  {
    "text": "The sync engine helps you manage and react to these.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1091"
  },
  {
    "text": "The sync engine listens for changes and will notify you ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1096"
  },
  {
    "text": "using the accountChange event to indicate sign in, sign out, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1100"
  },
  {
    "text": "or that the account switched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1105"
  },
  {
    "text": "Your application should prepare for the change depending on the type.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1108"
  },
  {
    "text": "The sync engine will not begin syncing with iCloud ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1114"
  },
  {
    "text": "until there is an account present on the device.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1117"
  },
  {
    "text": "You can initialize the sync engine at any time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1122"
  },
  {
    "text": "and it will automatically update you when there is an account change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1125"
  },
  {
    "text": "Sharing data with other users is a key part of CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1129"
  },
  {
    "text": "The sync engine makes life easier here too. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1134"
  },
  {
    "text": "The sync engine works with the CloudKit shared database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1138"
  },
  {
    "text": "You just create a sync engine per database that your application will work with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1143"
  },
  {
    "text": "For example, you can create a sync engine for the private database, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1148"
  },
  {
    "text": "and another sync engine for the shared database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1152"
  },
  {
    "text": "To learn more about sharing with CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1156"
  },
  {
    "text": "check out the \"Get the most out of CloudKit Sharing\" Tech Talk.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1158"
  },
  {
    "text": "That covers using CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1164"
  },
  {
    "text": "Now I'll cover how to test when using it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1167"
  },
  {
    "text": "Automated tests are the best way to ensure stability in your codebase ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1172"
  },
  {
    "text": "while rapidly developing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1176"
  },
  {
    "text": "Using the sync engine, you can simulate device-to-device user flows ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1178"
  },
  {
    "text": "using multiple CKSyncEngine instances.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1183"
  },
  {
    "text": "You should simulate edge cases that your app may encounter. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1188"
  },
  {
    "text": "To do this, you can intervene in the sync engine flow ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1192"
  },
  {
    "text": "by setting automaticallySync to false. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1196"
  },
  {
    "text": "Here is a test case that simulates a data conflict ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1200"
  },
  {
    "text": "between two devices and the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1203"
  },
  {
    "text": "The purpose of this test is to simulate the full flow users will take ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1207"
  },
  {
    "text": "when working with multiple devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1211"
  },
  {
    "text": "It also validates conflict resolution. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1213"
  },
  {
    "text": "First, simulate two devices using MySyncManager. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1218"
  },
  {
    "text": "In this example, MySyncManager creates a local database and sync engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1224"
  },
  {
    "text": "Device A sets the value to A and sends its changes to the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1230"
  },
  {
    "text": "Before device B fetches the changes from the server ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1237"
  },
  {
    "text": "we'll ask it to send its changes to the server too. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1240"
  },
  {
    "text": "Since device A saved to the server first, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1244"
  },
  {
    "text": "device B's save is expected to fail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1247"
  },
  {
    "text": "This will result in a server record changed error, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1251"
  },
  {
    "text": "which will exercise the local conflict resolution code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1255"
  },
  {
    "text": "This sample expects the conflict resolution ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1259"
  },
  {
    "text": "to prefer the data from the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1261"
  },
  {
    "text": "so the new value on device B ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1264"
  },
  {
    "text": "will be the value most recently sent to the server from device A.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1266"
  },
  {
    "text": "Here are a few key points that can help speed up testing and debugging. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1271"
  },
  {
    "text": "Understanding the sequence of events on each device will help pinpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1277"
  },
  {
    "text": "where in the flow your application may be having problems. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1281"
  },
  {
    "text": "Logging as much as possible when developing will help trace these flows, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1285"
  },
  {
    "text": "and compare logs across multiple devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1289"
  },
  {
    "text": "CloudKit will log each event that you receive, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1294"
  },
  {
    "text": "but you should also log the actions that surround them in your application.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1297"
  },
  {
    "text": "Logging record IDs and zone IDs can help debug what data is flowing ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1303"
  },
  {
    "text": "between a sync engine, the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1308"
  },
  {
    "text": "and other devices you may be syncing with.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1310"
  },
  {
    "text": "Writing tests that simulate each of your user flows ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1315"
  },
  {
    "text": "will help maintain stability as you grow your codebase.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1318"
  },
  {
    "text": "Look at timestamps when piecing the puzzle together. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1323"
  },
  {
    "text": "You may only have a few sync operations happening, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1327"
  },
  {
    "text": "or you may have many in a short time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1330"
  },
  {
    "text": "Ensuring you're tracing the right ones is key to debugging amongst multiple devices.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1333"
  },
  {
    "text": "These steps will help create and maintain a reliable, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1339"
  },
  {
    "text": "long-lasting application using CKSyncEngine.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1343"
  },
  {
    "text": "That concludes our talk on CKSyncEngine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1348"
  },
  {
    "text": "Take a look at the sync engine sample code to see a full working example in an app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1351"
  },
  {
    "text": "To dive in deeper, check out our CKSyncEngine documentation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1356"
  },
  {
    "text": "If you have any suggestions to improve the sync engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1361"
  },
  {
    "text": "please submit feedback for the CloudKit team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1364"
  },
  {
    "text": "We're excited to see what you create with it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1367"
  },
  {
    "text": "Thanks for watching. Have a great WWDC! ",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1371"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2023-10188/?time=1375"
  }
]