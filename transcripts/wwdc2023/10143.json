[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=0"
  },
  {
    "text": "Dave: Hi, I'm Dave Wendland, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=10"
  },
  {
    "text": "a developer advocate for our App Store Commerce team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=12"
  },
  {
    "text": "My colleague Alex and I will discuss the new App Store Server Library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=15"
  },
  {
    "text": "and how its set of functions will enable your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=19"
  },
  {
    "text": "to utilize an array of capabilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=22"
  },
  {
    "text": "from generating a JWT for the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=25"
  },
  {
    "text": "to migrating away from the verifyReceipt endpoint for purchase validation.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=29"
  },
  {
    "text": "When we look back, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=34"
  },
  {
    "text": "the App Store launched in 2008 when apps were either free or paid. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=35"
  },
  {
    "text": "Soon, we added in-app purchases, and ever since then, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=40"
  },
  {
    "text": "the developer community has grown in size and complexity across the globe. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=44"
  },
  {
    "text": "The App Store continues to roll out updates for developers and customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=49"
  },
  {
    "text": "to support the global and dynamic mobile app ecosystem.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=54"
  },
  {
    "text": "In 2021, we released the next era of StoreKit tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=59"
  },
  {
    "text": "with the revamped StoreKit Framework, App Store Server API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=63"
  },
  {
    "text": "and App Store Server Notifications v2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=67"
  },
  {
    "text": "With more updates in 2022 and again this year at WWDC 2023. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=70"
  },
  {
    "text": "These tools provide transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=76"
  },
  {
    "text": "and status in a signed JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=78"
  },
  {
    "text": "And they are designed to provide developers robust information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=82"
  },
  {
    "text": "client side and server side.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=85"
  },
  {
    "text": "This set of APIs inspired the App Store Server Library. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=89"
  },
  {
    "text": "We are proud to share that this library provides a set of functions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=93"
  },
  {
    "text": "which will make it easier for our developer community to adopt ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=97"
  },
  {
    "text": "and integrate the latest APIs available today and in the future. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=100"
  },
  {
    "text": "The library beta launch supports four languages: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=106"
  },
  {
    "text": "Swift, Java, Node, and Python, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=109"
  },
  {
    "text": "giving you the flexibility to choose the language ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=113"
  },
  {
    "text": "that best supports your backend and expertise.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=115"
  },
  {
    "text": "The App Store server library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=119"
  },
  {
    "text": "for each language is available on GitHub, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=121"
  },
  {
    "text": "and we look forward to your feedback ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=123"
  },
  {
    "text": "and contributions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=125"
  },
  {
    "text": "I've broken down what the library has to offer ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=127"
  },
  {
    "text": "into four key capabilities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=129"
  },
  {
    "text": "The first and most robust capability is with the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=133"
  },
  {
    "text": "By streamlining the JWT creation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=138"
  },
  {
    "text": "you can use any of the dozen different endpoints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=141"
  },
  {
    "text": "the App Store Server API offers.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=143"
  },
  {
    "text": "Next is a core capability to verify JWS signed data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=146"
  },
  {
    "text": "so you can ensure your transactions and server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=152"
  },
  {
    "text": "have been generated and signed by Apple.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=155"
  },
  {
    "text": "Next is the extract receipt transaction utility. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=159"
  },
  {
    "text": "This simple tool extracts a transaction identifier from an app receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=163"
  },
  {
    "text": "Doing this can alleviate your need to use the verifyReceipt endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=168"
  },
  {
    "text": "and enable you to migrate to the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=172"
  },
  {
    "text": "for your purchase validation and additional capabilities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=176"
  },
  {
    "text": "This provides a clear path to support your current and legacy app versions.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=180"
  },
  {
    "text": "Lastly, is the utility to generate subscription promotional offer signatures. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=185"
  },
  {
    "text": "This utility does the heavy lifting of signing and generating your offers ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=191"
  },
  {
    "text": "using your in-app purchase private key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=195"
  },
  {
    "text": "If you are not familiar with the subscription promotional offers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=198"
  },
  {
    "text": "learn more in our session titled \"Subscription Offers Best Practices.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=202"
  },
  {
    "text": "Now lets deep dive into three of those core library functions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=207"
  },
  {
    "text": "App Store Server API, signed data verification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=211"
  },
  {
    "text": "and moving to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=215"
  },
  {
    "text": "Let's get started with the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=218"
  },
  {
    "text": "The foundation to the Server API is the Get Transaction History endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=222"
  },
  {
    "text": "By simply using a transaction ID, this API provides a customer's ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=228"
  },
  {
    "text": "complete in-app purchase transaction history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=232"
  },
  {
    "text": "And it has even more capabilities beyond this endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=236"
  },
  {
    "text": "This API has a dozen endpoints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=239"
  },
  {
    "text": "all of which require a form of authentication, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=242"
  },
  {
    "text": "a JSON Web Token. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=245"
  },
  {
    "text": "Generating your JWT is a critical step, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=247"
  },
  {
    "text": "and if you aren't familiar with this process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=250"
  },
  {
    "text": "that is where the library comes in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=252"
  },
  {
    "text": "Over to Alex to demonstrate getting the library setup for use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=255"
  },
  {
    "text": "with the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=259"
  },
  {
    "text": "Alex: Hello, I'm Alex Baker, an App Store Server Engineer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=262"
  },
  {
    "text": "I'll demonstrate how to get started with the App Store Server Library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=265"
  },
  {
    "text": "and how you can use it to call the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=269"
  },
  {
    "text": "This demo will walk through collecting the necessary pieces of information ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=272"
  },
  {
    "text": "to configure the App Store Server Library, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=275"
  },
  {
    "text": "then show an example of creating an API client and calling the API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=278"
  },
  {
    "text": "I am starting in App Store Connect to get information I'll need ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=282"
  },
  {
    "text": "to use the App Store Server API with the library. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=285"
  },
  {
    "text": "Go to the Users and Access module...",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=289"
  },
  {
    "text": "Then the Keys tab, then the In-App Purchase option.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=294"
  },
  {
    "text": "There are a few pieces of useful information here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=299"
  },
  {
    "text": "First, the issuer ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=301"
  },
  {
    "text": "Next, I am going to generate a new private key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=304"
  },
  {
    "text": "I'll give it a name, then click Generate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=307"
  },
  {
    "text": "Generating the key provides two pieces of information: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=312"
  },
  {
    "text": "The key ID and the option to download the private key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=315"
  },
  {
    "text": "Downloading is only possible once. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=319"
  },
  {
    "text": "Switching to the Apple Public Key infrastructure website, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=322"
  },
  {
    "text": "focus on the Apple Root Certificates section in the upper left. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=325"
  },
  {
    "text": "Download the root certificates.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=328"
  },
  {
    "text": "Here is a simple Java project using the Gradle build system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=334"
  },
  {
    "text": "First, add a dependency on the App Store Server Library.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=338"
  },
  {
    "text": "Moving to the ExampleApp class, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=344"
  },
  {
    "text": "here are the pieces of information I obtained earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=346"
  },
  {
    "text": "the issuerId, the keyId, and the private key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=350"
  },
  {
    "text": "Additionally, store the bundleId of the app-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=353"
  },
  {
    "text": "in this demonstration, I am using sandbox-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=359"
  },
  {
    "text": "and store the appropriate enum value.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=362"
  },
  {
    "text": "Using these pieces of information, instantiate an AppStoreServerAPIClient. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=365"
  },
  {
    "text": "With this client, call the Request a Test Notification endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=370"
  },
  {
    "text": "which requests the App Store server send a notification with type TEST ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=374"
  },
  {
    "text": "to the URL you configured in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=377"
  },
  {
    "text": "Last, print the testNotificationToken. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=381"
  },
  {
    "text": "Running this, we will see the testNotificationToken printed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=384"
  },
  {
    "text": "and, as expected, we see this token.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=388"
  },
  {
    "text": "This demonstrated how to use the App Store Server library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=395"
  },
  {
    "text": "to simplify using the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=398"
  },
  {
    "text": "and the information you need from App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=400"
  },
  {
    "text": "Now back to Dave. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=402"
  },
  {
    "text": "Dave: Thank you, Alex. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=404"
  },
  {
    "text": "That demo really illustrates how quickly this library gets you set up ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=405"
  },
  {
    "text": "and generating a JWT for use with the Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=409"
  },
  {
    "text": "This library will have a meaningful impact ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=414"
  },
  {
    "text": "in reducing your implementation timelines when adopting our APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=416"
  },
  {
    "text": "While using the library is helpful and simple, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=422"
  },
  {
    "text": "there is nothing more critical ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=424"
  },
  {
    "text": "than storing your in-app purchase private key securely. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=426"
  },
  {
    "text": "And if you ever think your key has been compromised, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=429"
  },
  {
    "text": "generate a new key in App Store Connect anytime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=432"
  },
  {
    "text": "As you begin your development, we do recommend starting ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=436"
  },
  {
    "text": "with sandbox and TestFlight transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=439"
  },
  {
    "text": "And lastly, be sure to check regularly ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=442"
  },
  {
    "text": "for updated Apple root certificate authorities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=444"
  },
  {
    "text": "Now lets discuss why signed data verification ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=449"
  },
  {
    "text": "is a foundational action to your business with in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=451"
  },
  {
    "text": "First let's discuss what signed data contains and why it is important. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=456"
  },
  {
    "text": "StoreKit Signed data means it was generated and signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=460"
  },
  {
    "text": "by the App Store in a JSON Web Signature format ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=464"
  },
  {
    "text": "and contains data about the app purchases, in-app purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=468"
  },
  {
    "text": "customer events, and customer subscription status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=472"
  },
  {
    "text": "The two most common signed data payloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=476"
  },
  {
    "text": "are the JWS Transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=478"
  },
  {
    "text": "and JWS Renewal Info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=480"
  },
  {
    "text": "Then the appTransaction contains details ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=483"
  },
  {
    "text": "on the app version originally purchased ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=485"
  },
  {
    "text": "and the version currently installed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=488"
  },
  {
    "text": "on device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=490"
  },
  {
    "text": "And then we have ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=491"
  },
  {
    "text": "the App Store Server Notifications V2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=492"
  },
  {
    "text": "the notification itself is signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=495"
  },
  {
    "text": "and additionally may contain ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=498"
  },
  {
    "text": "a JWS Transaction and JWS Renewal Info.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=500"
  },
  {
    "text": "And as a reminder, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=505"
  },
  {
    "text": "you will only find this JWS signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=506"
  },
  {
    "text": "in StoreKit 2 on iOS 15 and later ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=509"
  },
  {
    "text": "and in the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=512"
  },
  {
    "text": "and App Store Server Notifications v2.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=514"
  },
  {
    "text": "It's recommended that you verify ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=518"
  },
  {
    "text": "the JWS signed data after any ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=520"
  },
  {
    "text": "of the following events: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=523"
  },
  {
    "text": "When delivering or unlocking content on device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=525"
  },
  {
    "text": "or when your server has received signed data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=529"
  },
  {
    "text": "whether that be from your own app, another server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=531"
  },
  {
    "text": "or App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=534"
  },
  {
    "text": "And lastly, when you receive a response from the App Store server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=537"
  },
  {
    "text": "Here's Alex to demo how to verify JWS signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=541"
  },
  {
    "text": "and how the library handles this for you.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=546"
  },
  {
    "text": "Alex: In this section, I'll show how to verify signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=549"
  },
  {
    "text": "from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=552"
  },
  {
    "text": "I'll describe the verification process you would need to perform. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=553"
  },
  {
    "text": "Then, we'll walk through how the App Store Server Library's ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=557"
  },
  {
    "text": "SignedDataVerifier class can perform this process for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=559"
  },
  {
    "text": "I would like to stress that using tools like the App Store Server Library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=564"
  },
  {
    "text": "is highly advisable when you are not familiar with the RFCs and protocols ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=567"
  },
  {
    "text": "behind the operations I am about to describe. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=571"
  },
  {
    "text": "Here is some signed data from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=574"
  },
  {
    "text": "It looks like there is a lot going on here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=576"
  },
  {
    "text": "Color coding reveals there are three sections. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=578"
  },
  {
    "text": "Each section is separated by a period ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=582"
  },
  {
    "text": "and is Base64 URL encoded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=583"
  },
  {
    "text": "The first and largest section is the header. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=586"
  },
  {
    "text": "Once decoded, the header is a JSON structure ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=589"
  },
  {
    "text": "with fields defined by the JWS specification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=592"
  },
  {
    "text": "In this case, our header only has two fields: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=595"
  },
  {
    "text": "First, the algorithm, which is always ES256. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=598"
  },
  {
    "text": "Next a field called x5c. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=603"
  },
  {
    "text": "This is an array of certificates that are used to calculate ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=605"
  },
  {
    "text": "the expected public key that signed the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=607"
  },
  {
    "text": "Let's review the certificate chain construction process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=611"
  },
  {
    "text": "The first certificate in the array is the leaf certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=614"
  },
  {
    "text": "This certificate's public key signed the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=617"
  },
  {
    "text": "To verify this certificate is from Apple, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=621"
  },
  {
    "text": "construct a chain of trust back to a known trusted source, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=623"
  },
  {
    "text": "in this case, an Apple root certificate authority.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=626"
  },
  {
    "text": "The next certificate in the array ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=630"
  },
  {
    "text": "is the Apple Worldwide Developer Relations intermediate certificate authority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=631"
  },
  {
    "text": "Think of this as a more specialized version ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=636"
  },
  {
    "text": "of the Apple Root Certificate Authority focused on developers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=638"
  },
  {
    "text": "The last certificate in the chain is an Apple root certificate authority ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=642"
  },
  {
    "text": "so that we understand which Apple authority originated this chain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=645"
  },
  {
    "text": "Reminder, it is important to verify the certificate exactly matches ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=649"
  },
  {
    "text": "a root certificate we previously obtained ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=652"
  },
  {
    "text": "from Apple's Public Key Infrastructure website.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=655"
  },
  {
    "text": "The first step is to verify ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=658"
  },
  {
    "text": "that each certificate is signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=659"
  },
  {
    "text": "by the previous certificate in the chain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=660"
  },
  {
    "text": "Then perform additional ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=663"
  },
  {
    "text": "verification steps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=664"
  },
  {
    "text": "like making sure each certificate has ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=665"
  },
  {
    "text": "valid dates, is properly formatted, etc. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=667"
  },
  {
    "text": "Next, validate that these certificates ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=670"
  },
  {
    "text": "are from Apple and that their purpose ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=673"
  },
  {
    "text": "is to sign App Store data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=674"
  },
  {
    "text": "as opposed to an unrelated use case, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=676"
  },
  {
    "text": "which would not be valid ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=678"
  },
  {
    "text": "to sign App Store data.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=679"
  },
  {
    "text": "To verify the leaf certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=681"
  },
  {
    "text": "confirm its purpose by checking ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=683"
  },
  {
    "text": "the presence of the object identifier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=684"
  },
  {
    "text": "or OID, for Mac App Store Receipt Signing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=686"
  },
  {
    "text": "For the intermediate certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=690"
  },
  {
    "text": "check that the intermediate authority OID ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=691"
  },
  {
    "text": "for Apple Worldwide Developer Relations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=693"
  },
  {
    "text": "Last, as stated before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=696"
  },
  {
    "text": "make sure the root certificate authority ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=699"
  },
  {
    "text": "is one of the certificates you stored ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=701"
  },
  {
    "text": "as an Apple Root Certificate Authority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=702"
  },
  {
    "text": "Now let's actually decode ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=705"
  },
  {
    "text": "a leaf certificate and observe how ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=707"
  },
  {
    "text": "to check these values.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=709"
  },
  {
    "text": "Here is the X.509 v3 extensions section ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=712"
  },
  {
    "text": "of a certificate as produced by the OpenSSL x509 command.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=715"
  },
  {
    "text": "At the bottom is the OID listed on the previous slide, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=721"
  },
  {
    "text": "indicating the certificate's purpose is App Store receipt signing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=725"
  },
  {
    "text": "However, there are some additional fields that are important to check.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=729"
  },
  {
    "text": "Here we see the authority information access section, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=734"
  },
  {
    "text": "which provides information about the issuer and, importantly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=737"
  },
  {
    "text": "provides information for checking if the certificate was revoked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=740"
  },
  {
    "text": "Using the Online Certificate Status Protocol, or OCSP. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=743"
  },
  {
    "text": "check if a certificate has been revoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=747"
  },
  {
    "text": "before proceeding with the verification process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=749"
  },
  {
    "text": "The process and cryptographic procedures for doing so are defined in RFC 6960.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=751"
  },
  {
    "text": "After verifying the certificate chain, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=758"
  },
  {
    "text": "check the JWS is signed by the leaf certificate's public key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=760"
  },
  {
    "text": "Take the leaf certificate from before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=764"
  },
  {
    "text": "extract the public key of the leaf certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=768"
  },
  {
    "text": "take the key and original JWS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=771"
  },
  {
    "text": "and pass them to a JWS signature verification function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=773"
  },
  {
    "text": "The verification function checks that the data is signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=778"
  },
  {
    "text": "by the public key and decodes the payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=780"
  },
  {
    "text": "The process is almost complete, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=783"
  },
  {
    "text": "but there is one additional verification step.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=785"
  },
  {
    "text": "Here is a decoded App Store Server TEST Notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=788"
  },
  {
    "text": "The previous steps verified the data came from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=792"
  },
  {
    "text": "However, also check that the notification is targeted ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=795"
  },
  {
    "text": "at your correct application and environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=798"
  },
  {
    "text": "Check the appAppleId and bundleId to confirm the notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=802"
  },
  {
    "text": "is targeted for your correct application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=806"
  },
  {
    "text": "Check the environment matches the expected environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=809"
  },
  {
    "text": "Just like the other steps in the verification process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=813"
  },
  {
    "text": "the App Store Server library also checks these when it performs the verification.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=816"
  },
  {
    "text": "That completes the process to verify signed data from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=821"
  },
  {
    "text": "Next, I'll expand my project from earlier to verify signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=825"
  },
  {
    "text": "using the SignedDataVerifier class included in the App Store Server Library. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=828"
  },
  {
    "text": "The SignedDataVerifier class performs the verification steps previously covered.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=832"
  },
  {
    "text": "In this demo, I'll get the test notification that I requested earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=837"
  },
  {
    "text": "and then validate and decode the signed notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=840"
  },
  {
    "text": "There is a small delay between requesting the test notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=843"
  },
  {
    "text": "and the notification being received on my server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=846"
  },
  {
    "text": "Therefore, add a five-second delay. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=848"
  },
  {
    "text": "Next, call the Get Test Notification Status endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=852"
  },
  {
    "text": "using the testNotificationToken obtained earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=855"
  },
  {
    "text": "Last, print the first few characters of the notification to confirm success. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=859"
  },
  {
    "text": "The Get Test Notification Status endpoint returns the result ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=863"
  },
  {
    "text": "of the send attempt, as well as the notification payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=866"
  },
  {
    "text": "The beginning of that payload is what we should see.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=870"
  },
  {
    "text": "As expected, I see the first few characters of the notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=877"
  },
  {
    "text": "Moving on, creating a signed data verifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=881"
  },
  {
    "text": "This requires three pieces of information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=884"
  },
  {
    "text": "starting with the list of Apple Root certificate authorities.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=887"
  },
  {
    "text": "The certificates I downloaded earlier are now in the resources folder. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=892"
  },
  {
    "text": "Import the root certificates into a Set.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=896"
  },
  {
    "text": "Since I am using sandbox, I don't require an app Apple ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=900"
  },
  {
    "text": "Pass null instead in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=904"
  },
  {
    "text": "Last, whether to perform revocation checking. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=908"
  },
  {
    "text": "Because the notification was just received, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=911"
  },
  {
    "text": "onlineChecks should be true. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=914"
  },
  {
    "text": "For notifications received months or years ago, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=916"
  },
  {
    "text": "this should be false because the certificates may have expired. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=918"
  },
  {
    "text": "Pass these fields into a new SignedDataVerifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=922"
  },
  {
    "text": "Then, pass in the notification received earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=926"
  },
  {
    "text": "print the result, and then run the program.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=929"
  },
  {
    "text": "Once the program is complete, the program will display ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=937"
  },
  {
    "text": "a verified and decoded notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=939"
  },
  {
    "text": "Since this is a test notification, this will have a type ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=941"
  },
  {
    "text": "of TEST and the app's bundle identifier in the payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=944"
  },
  {
    "text": "along with a few other fields.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=947"
  },
  {
    "text": "As expected, I see a decoded notification of type TEST.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=951"
  },
  {
    "text": "I expanded on our previous demo to demonstrate the SignedDataVerifier object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=956"
  },
  {
    "text": "Here’s Dave to review some best practices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=960"
  },
  {
    "text": "Dave: Wow, that really illustrates all the steps required ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=963"
  },
  {
    "text": "to verifying signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=966"
  },
  {
    "text": "and how the library can handle that complexity for you, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=968"
  },
  {
    "text": "so be sure to utilize the SignedDataVerifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=971"
  },
  {
    "text": "for your server-side validation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=975"
  },
  {
    "text": "An important reminder: when you verify data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=977"
  },
  {
    "text": "you still need to confirm the app and product identifiers ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=980"
  },
  {
    "text": "to ensure you are granting or revoking purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=984"
  },
  {
    "text": "for the correct app or service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=987"
  },
  {
    "text": "Lastly, as certificates expire and can be revoked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=989"
  },
  {
    "text": "don't hardcode any certificates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=993"
  },
  {
    "text": "client side or server side, and always validate that they are active. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=996"
  },
  {
    "text": "Now we'll review another App Store server utility to assist ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1000"
  },
  {
    "text": "with moving your server-side app receipt validation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1004"
  },
  {
    "text": "off the verifyReceipt endpoint and over to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1007"
  },
  {
    "text": "The App Store Server library offers a utility ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1012"
  },
  {
    "text": "to help specifically with this migration and ensures no app is left behind.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1015"
  },
  {
    "text": "When considering moving to the App Store Server API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1021"
  },
  {
    "text": "there are many reasons to prioritize this work in your roadmap. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1024"
  },
  {
    "text": "The API supports purchase validation and contains additional endpoints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1027"
  },
  {
    "text": "useful for customer support, appeasement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1032"
  },
  {
    "text": "and testing App Store Server Notifications V2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1034"
  },
  {
    "text": "As we continue to make updates and release new properties, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1038"
  },
  {
    "text": "these will be released only with the JWS signed data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1042"
  },
  {
    "text": "which is supported by StoreKit 2, App Store Server API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1045"
  },
  {
    "text": "and App Store Server Notifications V2.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1049"
  },
  {
    "text": "An additional benefit, the only data you need to record, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1052"
  },
  {
    "text": "is an original transaction ID or transaction ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1056"
  },
  {
    "text": "You no longer need to save base64 encoded receipts in your account system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1060"
  },
  {
    "text": "And with our continued investment in the latest APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1065"
  },
  {
    "text": "we have announced that verifyReceipt endpoint is now deprecated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1069"
  },
  {
    "text": "To learn more, check out the session \"What's new in App Store server APIs\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1073"
  },
  {
    "text": "for a detailed update and guidance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1078"
  },
  {
    "text": "Now here's Alex to share how the App Store server library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1081"
  },
  {
    "text": "will assist in your migration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1084"
  },
  {
    "text": "Alex? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1086"
  },
  {
    "text": "Alex: Thanks, Dave. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1087"
  },
  {
    "text": "Now let's walk through a flow diagram for App Receipts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1088"
  },
  {
    "text": "While StoreKit 2 and the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1092"
  },
  {
    "text": "are great tools to use, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1095"
  },
  {
    "text": "it is important to support clients on older devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1096"
  },
  {
    "text": "or users that have not updated recently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1099"
  },
  {
    "text": "and for which only App Receipts may be provided to your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1101"
  },
  {
    "text": "I'll show how these devices were supported previously, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1105"
  },
  {
    "text": "and then how you can continue to support these clients ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1107"
  },
  {
    "text": "following verifyReceipt's deprecation.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1110"
  },
  {
    "text": "First, the device sends a receipt to your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1114"
  },
  {
    "text": "In the old model, your server passes this receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1118"
  },
  {
    "text": "to verifyReceipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1120"
  },
  {
    "text": "and then receives the decoded receipt.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1122"
  },
  {
    "text": "The response contains an originalTransactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1126"
  },
  {
    "text": "which is passed to the Get Transaction History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1129"
  },
  {
    "text": "in the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1131"
  },
  {
    "text": "The App Store Server returns ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1135"
  },
  {
    "text": "signed transactions you use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1136"
  },
  {
    "text": "to provide service to the customer.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1137"
  },
  {
    "text": "Now that verifyReceipt is deprecated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1140"
  },
  {
    "text": "let's replace this section. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1142"
  },
  {
    "text": "The receipt utility in the App Store Server Library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1145"
  },
  {
    "text": "directly extracts a transaction ID from a receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1147"
  },
  {
    "text": "You pass the transaction ID to the App Store Server API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1150"
  },
  {
    "text": "removing the need to make two round trips. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1153"
  },
  {
    "text": "After this, store the revision from the endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1156"
  },
  {
    "text": "This removes the need to re-parse the entire history each time.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1159"
  },
  {
    "text": "Because the value extracted from the app receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1164"
  },
  {
    "text": "may or may not be an original transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1166"
  },
  {
    "text": "we are excited to announce that many of our endpoints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1170"
  },
  {
    "text": "including the Get Transaction History endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1172"
  },
  {
    "text": "now support any transaction ID as a parameter, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1175"
  },
  {
    "text": "not just an original transaction ID.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1178"
  },
  {
    "text": "Now I'll demonstrate extracting transaction IDs for use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1181"
  },
  {
    "text": "with the Get Transaction History endpoint using the App Store Server Library. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1184"
  },
  {
    "text": "Here I will take an app receipt, extract a transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1189"
  },
  {
    "text": "and call the Get Transaction History endpoint using the ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1193"
  },
  {
    "text": "First, the App Receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1196"
  },
  {
    "text": "You can get an App Receipt from a device or an App Store Server Notification V1. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1198"
  },
  {
    "text": "I have one here already. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1203"
  },
  {
    "text": "Next, create an instance of the ReceiptUtility class. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1205"
  },
  {
    "text": "To extract the transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1209"
  },
  {
    "text": "call the extract transaction ID from app receipt method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1211"
  },
  {
    "text": "Not all receipts will have a transaction ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1215"
  },
  {
    "text": "It is possible the user doesn't have any purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1217"
  },
  {
    "text": "Therefore, add a null check.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1220"
  },
  {
    "text": "To provide some more depth to this problem, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1224"
  },
  {
    "text": "imagine we want to get information about the most recent consumables ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1227"
  },
  {
    "text": "for this user and exclude revoked consumables. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1230"
  },
  {
    "text": "Create a Transaction History Request object, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1234"
  },
  {
    "text": "specify that only wanted are products of type CONSUMABLE ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1238"
  },
  {
    "text": "to exclude revoked transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1242"
  },
  {
    "text": "and that the data should be returned in descending order.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1244"
  },
  {
    "text": "We need two helper objects, a response variable, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1249"
  },
  {
    "text": "and a list of transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1252"
  },
  {
    "text": "A do while loop pages through the responses ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1255"
  },
  {
    "text": "from the transaction history endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1258"
  },
  {
    "text": "If this isn't the first request, fetch the revision token ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1260"
  },
  {
    "text": "from the previous response to keep paging through the data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1263"
  },
  {
    "text": "Then, call the Get Transaction History endpoint with the transaction ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1266"
  },
  {
    "text": "from the app receipt, the request object, and the revision. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1271"
  },
  {
    "text": "Finally, add all the transactions from the response to the transaction list. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1276"
  },
  {
    "text": "Repeat this process until the hasMore field is false in the response.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1281"
  },
  {
    "text": "Print out the transactions to see the result.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1287"
  },
  {
    "text": "Here I see a list of transactions returned from the API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1296"
  },
  {
    "text": "The could be decoded using the SignedDataVerifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1301"
  },
  {
    "text": "from the previous demo.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1303"
  },
  {
    "text": "Thanks for joining our final demonstration ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1306"
  },
  {
    "text": "that showed how you can use App Receipts with the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1308"
  },
  {
    "text": "Back to Dave to wrap us up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1311"
  },
  {
    "text": "Dave: I'm really excited about the new App Store Server library, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1313"
  },
  {
    "text": "and I see these capabilities easing your adoption of our APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1316"
  },
  {
    "text": "and transitioning to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1320"
  },
  {
    "text": "Here's a screenshot of the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1324"
  },
  {
    "text": "Java repository on Github. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1326"
  },
  {
    "text": "On this page, you can find links to our documentation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1329"
  },
  {
    "text": "submit pull requests, and find examples of how to use the library.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1332"
  },
  {
    "text": "You can download the App Store Server library BETA soon ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1337"
  },
  {
    "text": "and start planning your adoption of the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1340"
  },
  {
    "text": "We look forward to your feedback and feature requests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1344"
  },
  {
    "text": "Please contact us at Feedback Assistant and on Github. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1347"
  },
  {
    "text": "Thank you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1351"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10143/?time=1352"
  }
]