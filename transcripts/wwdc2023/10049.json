[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=0"
  },
  {
    "text": "Ben: Hi, I'm Ben Levine, an engineer on the Core ML team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=10"
  },
  {
    "text": "Today, I'm going to talk about what's new ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=14"
  },
  {
    "text": "when it comes to integrating Core ML into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=16"
  },
  {
    "text": "Building intelligent experiences in your app has never been easier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=19"
  },
  {
    "text": "The Xcode SDK provides a solid foundation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=23"
  },
  {
    "text": "for leveraging and deploying machine learning-powered features. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=26"
  },
  {
    "text": "A set of domain specific frameworks give you access ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=30"
  },
  {
    "text": "to built-in intelligence through simple APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=33"
  },
  {
    "text": "The capabilities they provide are powered by models trained and optimized by Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=36"
  },
  {
    "text": "These models are executed via Core ML. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=42"
  },
  {
    "text": "The Core ML framework provides the engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=45"
  },
  {
    "text": "for running machine learning models on-device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=47"
  },
  {
    "text": "It allows you to easily deploy models customized for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=50"
  },
  {
    "text": "It abstracts away the hardware details while leveraging ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=55"
  },
  {
    "text": "the high-performance compute capabilities of Apple silicon ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=58"
  },
  {
    "text": "with help from the Accelerate and Metal family of frameworks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=62"
  },
  {
    "text": "Core ML's mission is to help you integrate machine learning models into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=65"
  },
  {
    "text": "This year, our focus for Core ML was performance and flexibility. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=70"
  },
  {
    "text": "We made improvements in our workflow, API surface, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=75"
  },
  {
    "text": "and also our underlying inference engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=78"
  },
  {
    "text": "Before jumping into the workflow and highlighting new opportunities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=81"
  },
  {
    "text": "for you to optimize your Core ML integration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=85"
  },
  {
    "text": "here's an idea of the potential performance benefits ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=87"
  },
  {
    "text": "that you can get automatically by just updating to the latest OS.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=90"
  },
  {
    "text": "When comparing the relative prediction time between iOS 16 and 17, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=96"
  },
  {
    "text": "you'll observe that iOS 17 is simply faster for many of your models. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=101"
  },
  {
    "text": "This speedup in the inference engine comes with the OS ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=106"
  },
  {
    "text": "and doesn't require re-compilation of your models ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=109"
  },
  {
    "text": "or making any changes to your code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=111"
  },
  {
    "text": "The same is true for other platforms as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=114"
  },
  {
    "text": "Naturally, the amount of speedup is model and hardware dependent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=118"
  },
  {
    "text": "Moving to the agenda, I'll start with an overview of the workflow ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=122"
  },
  {
    "text": "when integrating Core ML into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=125"
  },
  {
    "text": "Along the way, I'll highlight optimization opportunities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=128"
  },
  {
    "text": "for different parts of the workflow. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=131"
  },
  {
    "text": "Then I'll focus on model integration and discuss new APIs and behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=134"
  },
  {
    "text": "for compute availability, model lifecycle, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=138"
  },
  {
    "text": "and asynchronous prediction ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=142"
  },
  {
    "text": "I'll start with an overview of the Core ML workflow. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=144"
  },
  {
    "text": "There are two phases for integrating Core ML into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=148"
  },
  {
    "text": "First is developing your model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=152"
  },
  {
    "text": "and second is using that model within your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=154"
  },
  {
    "text": "For model development, you have several options. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=157"
  },
  {
    "text": "One of the most convenient ways to develop your own model is to use Create ML. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=161"
  },
  {
    "text": "Create ML provides various templates for common machine learning tasks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=166"
  },
  {
    "text": "and can leverage the highly optimized models built into the OS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=170"
  },
  {
    "text": "It guides you through the model development workflow ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=175"
  },
  {
    "text": "and lets you interactively evaluate the results. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=177"
  },
  {
    "text": "If you want to learn more, check out this year's Create ML video.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=180"
  },
  {
    "text": "Another way to develop a model is to train one ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=185"
  },
  {
    "text": "using one of several python machine learning frameworks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=188"
  },
  {
    "text": "Then, use the CoreMLTools python package to convert to the Core ML model format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=192"
  },
  {
    "text": "Last, it's important you evaluate your model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=198"
  },
  {
    "text": "both in terms of accuracy and performance on Apple hardware. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=201"
  },
  {
    "text": "Using feedback from evaluation often results in revisiting ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=205"
  },
  {
    "text": "some of these steps to further optimize your model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=209"
  },
  {
    "text": "There are many opportunities for optimization in these steps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=212"
  },
  {
    "text": "For training, how you collect and choose your training data is important. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=216"
  },
  {
    "text": "It should be consistent with the data being passed to the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=221"
  },
  {
    "text": "when it's deployed and in your users' hands. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=224"
  },
  {
    "text": "The model architecture you choose is also important. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=227"
  },
  {
    "text": "You may be exploring multiple options, each with their own tradeoffs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=231"
  },
  {
    "text": "between training data requirements, accuracy, size, and performance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=234"
  },
  {
    "text": "Many of these tradeoffs may not be fully visible at training time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=240"
  },
  {
    "text": "and require a few iterations through the full development flow.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=244"
  },
  {
    "text": "Next is model conversion. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=247"
  },
  {
    "text": "Core ML tools offers various options to help optimize ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=250"
  },
  {
    "text": "the converted model's precision, footprint, and computation cost. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=253"
  },
  {
    "text": "You can select input and output formats that best match ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=258"
  },
  {
    "text": "your app's data flow to avoid unnecessary copies. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=261"
  },
  {
    "text": "If your input shape can vary, you can specify that variation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=265"
  },
  {
    "text": "rather than choosing just one shape ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=269"
  },
  {
    "text": "or switching amongst multiple shape-specific models. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=271"
  },
  {
    "text": "Compute precision can also be explicitly set for the whole model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=276"
  },
  {
    "text": "or individual operations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=279"
  },
  {
    "text": "Both float32 and float16 are available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=281"
  },
  {
    "text": "In addition to the precision of computation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=286"
  },
  {
    "text": "you also have some control over how your model parameters are represented. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=288"
  },
  {
    "text": "CoreMLTools comes with a set of utilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=293"
  },
  {
    "text": "for post-training weight quantization and compression. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=296"
  },
  {
    "text": "These utilities can help you significantly reduce the footprint of your model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=300"
  },
  {
    "text": "and improve performance on-device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=304"
  },
  {
    "text": "However, to achieve these benefits, there is some tradeoff in accuracy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=306"
  },
  {
    "text": "There are some new tools to help you in this space ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=312"
  },
  {
    "text": "There's a new optimize submodule in the CoreMLTools package. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=315"
  },
  {
    "text": "It unifies and updates the post-training compression utilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=320"
  },
  {
    "text": "and adds new quantization-aware training extensions for PyTorch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=323"
  },
  {
    "text": "This gives you access to data-driven optimizations ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=328"
  },
  {
    "text": "to help preserve accuracy for quantized models during training. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=331"
  },
  {
    "text": "This is coupled with new operations which support activation quantization ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=335"
  },
  {
    "text": "in Core ML's ML Program model type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=340"
  },
  {
    "text": "Check out this year's session ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=343"
  },
  {
    "text": "on compressing machine learning models with Core ML to learn more.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=345"
  },
  {
    "text": "Next is evaluation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=350"
  },
  {
    "text": "One option to evaluate your model is to run predictions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=352"
  },
  {
    "text": "on the converted model directly from your python code with CoreMLTools. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=355"
  },
  {
    "text": "It will use the same Core ML inference stack that your app code will use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=360"
  },
  {
    "text": "and lets you quickly check how your choices during model conversion ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=363"
  },
  {
    "text": "affect the model's accuracy and performance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=367"
  },
  {
    "text": "Xcode also provides some helpful tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=371"
  },
  {
    "text": "when it comes to evaluation and exploration of your models. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=373"
  },
  {
    "text": "Model previews are available for many common model types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=378"
  },
  {
    "text": "This lets you provide some sample inputs to the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=382"
  },
  {
    "text": "and preview the predicted output without having to write any code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=385"
  },
  {
    "text": "Core ML performance reports provide you a breakdown ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=390"
  },
  {
    "text": "of model computation performance for load, prediction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=392"
  },
  {
    "text": "and compilation times on any attached device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=396"
  },
  {
    "text": "Note that this can be useful to evaluate model architectures ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=400"
  },
  {
    "text": "even before you've trained them.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=403"
  },
  {
    "text": "Now, stepping back to the overall workflow, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=406"
  },
  {
    "text": "the next topic is model integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=408"
  },
  {
    "text": "Model integration is a part of developing your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=412"
  },
  {
    "text": "Just like any other resource you use in your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=415"
  },
  {
    "text": "you want to carefully manage and optimize how you use your Core ML model.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=418"
  },
  {
    "text": "There are three steps in model integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=424"
  },
  {
    "text": "You first write the application code to use the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=426"
  },
  {
    "text": "You have code for where and when to load the model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=429"
  },
  {
    "text": "how to prepare the model's input data, make predictions, and use the results.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=432"
  },
  {
    "text": "Then you compile this code along with the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=438"
  },
  {
    "text": "And third, you test, run, and profile the model running within your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=441"
  },
  {
    "text": "When it comes to profiling, you may find the Core ML ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=447"
  },
  {
    "text": "and Neural Engine instruments helpful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=450"
  },
  {
    "text": "This is also an iterative process of design and optimization ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=453"
  },
  {
    "text": "until you're ready to ship. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=456"
  },
  {
    "text": "There are several new additions this year for optimizing your model integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=459"
  },
  {
    "text": "First is compute availability. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=464"
  },
  {
    "text": "Core ML is supported on all Apple platforms ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=466"
  },
  {
    "text": "and by default considers all available compute ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=469"
  },
  {
    "text": "to optimize its execution. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=472"
  },
  {
    "text": "This includes the CPU, GPU, and Neural Engine when available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=474"
  },
  {
    "text": "However, the performance characteristics and availability of these compute devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=479"
  },
  {
    "text": "varies across supported hardware your app may run on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=484"
  },
  {
    "text": "This may impact your users' experience with your ML powered features ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=488"
  },
  {
    "text": "or influence your choice in models and configurations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=492"
  },
  {
    "text": "For example, some experiences may require models ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=495"
  },
  {
    "text": "running on the Neural Engine to meet performance or power requirements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=499"
  },
  {
    "text": "There's now a new API for runtime inspection of compute device availability. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=504"
  },
  {
    "text": "The MLComputeDevice enum captures the type of compute device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=509"
  },
  {
    "text": "and the specific compute device's properties within its associated value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=514"
  },
  {
    "text": "With the availableComputeDevices property on MLModel, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=519"
  },
  {
    "text": "you can inspect what devices are available to Core ML. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=523"
  },
  {
    "text": "For example, this code checks if there is a Neural Engine available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=527"
  },
  {
    "text": "More specifically, it checks if the collection ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=532"
  },
  {
    "text": "of all available compute devices contains one whose type is Neural Engine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=535"
  },
  {
    "text": "The next topic for model integration is understanding the model lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=540"
  },
  {
    "text": "I'll start by reviewing the different model asset types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=544"
  },
  {
    "text": "There are two kinds: source models and compiled models. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=548"
  },
  {
    "text": "The source model has a file extension of MLModel or MLPackage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=552"
  },
  {
    "text": "It's an open format designed for construction and editing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=557"
  },
  {
    "text": "The compiled model has a file extension of MLModelC. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=561"
  },
  {
    "text": "It's designed for runtime access. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=565"
  },
  {
    "text": "In most cases, you add a source model to your app target, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=568"
  },
  {
    "text": "then Xcode compiles the model and puts it in the app's resources. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=572"
  },
  {
    "text": "At runtime, in order to use your model, you instantiate an MLModel.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=577"
  },
  {
    "text": "Instantiation takes a URL to its compiled form ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=583"
  },
  {
    "text": "and an optional configuration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=586"
  },
  {
    "text": "The resulting MLModel has loaded all the necessary resources ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=589"
  },
  {
    "text": "for optimal inference based on the specified configuration ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=593"
  },
  {
    "text": "and device-specific hardware capabilities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=596"
  },
  {
    "text": "Here's a deeper look into what happens during this load. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=600"
  },
  {
    "text": "First, Core ML checks a cache ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=604"
  },
  {
    "text": "to see if it has already specialized the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=607"
  },
  {
    "text": "based on the configuration and device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=609"
  },
  {
    "text": "If it has, it loads the required resources from the cache and returns. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=612"
  },
  {
    "text": "This is called a cached load. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=617"
  },
  {
    "text": "If the configuration was not found in the cache, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=620"
  },
  {
    "text": "it then triggers a device-specialized compilation for it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=623"
  },
  {
    "text": "Once this process completes, it adds the output to the cache ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=627"
  },
  {
    "text": "and finishes the load from there. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=631"
  },
  {
    "text": "This is called an uncached load. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=634"
  },
  {
    "text": "For certain models, the uncached load can take a significant amount of time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=637"
  },
  {
    "text": "However, it's focused on optimizing the model for the device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=642"
  },
  {
    "text": "and making subsequent loads as fast as possible.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=645"
  },
  {
    "text": "During device specialization, Core ML first parses the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=650"
  },
  {
    "text": "and applies general optimization passes to it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=654"
  },
  {
    "text": "It then segments the chain of operations for specific compute devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=658"
  },
  {
    "text": "based on the estimated performance and hardware availability. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=662"
  },
  {
    "text": "This segmentation is then cached. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=666"
  },
  {
    "text": "The last step is for each of the segments to go through ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=669"
  },
  {
    "text": "a compute device specific compilation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=672"
  },
  {
    "text": "for the compute device they were assigned. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=674"
  },
  {
    "text": "This compilation includes further optimizations ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=677"
  },
  {
    "text": "for the specific compute device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=680"
  },
  {
    "text": "and outputs an artifact that the compute device can run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=682"
  },
  {
    "text": "Once complete, Core ML caches these artifacts ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=686"
  },
  {
    "text": "to be used for subsequent model loads.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=689"
  },
  {
    "text": "Core ML caches the specialized assets on the disk. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=693"
  },
  {
    "text": "They're tied to the model's path and configuration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=698"
  },
  {
    "text": "These assets are meant to persist across app launches and reboots of your device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=702"
  },
  {
    "text": "When the device's free disk space is running short, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=708"
  },
  {
    "text": "there has been a system update, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=711"
  },
  {
    "text": "or the compiled model has been deleted or modified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=713"
  },
  {
    "text": "the operating system deletes the cache. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=716"
  },
  {
    "text": "If this happens, the next model load will perform the device specialization again.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=719"
  },
  {
    "text": "In order to find out whether or not your model load is hitting the cache, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=725"
  },
  {
    "text": "you can trace your app with the Core ML Instrument ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=729"
  },
  {
    "text": "and look at the load event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=731"
  },
  {
    "text": "If it has the label \"prepare and cache,\" then it was an uncached load, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=733"
  },
  {
    "text": "so Core ML performed the device specialization ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=738"
  },
  {
    "text": "and cached the result. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=740"
  },
  {
    "text": "If the load event has the label \"cached,\" then it was a cached load ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=743"
  },
  {
    "text": "and did not incur a device specialization. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=747"
  },
  {
    "text": "This is new specifically for MLProgram models. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=750"
  },
  {
    "text": "Core ML performance reports can also give you visibility ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=754"
  },
  {
    "text": "into the cost of a load. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=757"
  },
  {
    "text": "By default, it shows the median cached load.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=760"
  },
  {
    "text": "It now has the option to display uncached load times as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=765"
  },
  {
    "text": "Since loading a model can be expensive in terms of latency and memory, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=770"
  },
  {
    "text": "here are some general best practices.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=774"
  },
  {
    "text": "First, don't load models during your app's launch on the UI thread. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=777"
  },
  {
    "text": "Instead, consider using the async loading API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=781"
  },
  {
    "text": "or lazily load the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=785"
  },
  {
    "text": "Next, keep the model loaded if the application will likely be running ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=788"
  },
  {
    "text": "many predictions in a row, rather than reloading the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=792"
  },
  {
    "text": "for each prediction in the sequence. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=795"
  },
  {
    "text": "Lastly, you can unload the model if your app won't use it for a while. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=798"
  },
  {
    "text": "This can help alleviate memory pressure, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=803"
  },
  {
    "text": "and thanks to the caching, subsequent loads should be faster. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=805"
  },
  {
    "text": "Once your model is loaded, it's time to think about ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=809"
  },
  {
    "text": "running predictions with the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=811"
  },
  {
    "text": "I'll jump into a demo to show the new async options.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=813"
  },
  {
    "text": "To show the new async prediction API, I'll be using an app which displays ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=818"
  },
  {
    "text": "a gallery of images and allows for applying filters to the images. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=822"
  },
  {
    "text": "I'll focus on a colorizing filter that uses a Core ML model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=826"
  },
  {
    "text": "which takes a grayscale image as input ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=830"
  },
  {
    "text": "and outputs a colorized version of the image. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=832"
  },
  {
    "text": "Here's an example of the app in action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=835"
  },
  {
    "text": "It starts by loading the original images, which are in grayscale, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=838"
  },
  {
    "text": "and then once I select the Colorized image mode, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=842"
  },
  {
    "text": "it colorizes the images using Core ML. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=845"
  },
  {
    "text": "As I scroll down, the model is definitely working, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=848"
  },
  {
    "text": "but it's a bit slower than I expected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=853"
  },
  {
    "text": "Also, if I scroll far down, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=855"
  },
  {
    "text": "I notice that it takes quite a while for the images to be colorized.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=859"
  },
  {
    "text": "As I scroll back up, it looks like it was spending time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=864"
  },
  {
    "text": "colorizing all of the images along the way. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=867"
  },
  {
    "text": "But in my SwiftUI code, I'm using a LazyVGrid to hold the images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=870"
  },
  {
    "text": "so it should be cancelling tasks when views go off screen. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=874"
  },
  {
    "text": "Let me take a look at my current implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=878"
  },
  {
    "text": "to try to understand why the performance is lacking ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=881"
  },
  {
    "text": "and also why it doesn't respect tasks being cancelled. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=884"
  },
  {
    "text": "This is the implementation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=887"
  },
  {
    "text": "Since the synchronous prediction API is not thread safe, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=890"
  },
  {
    "text": "the app has to ensure that predictions are run serially on the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=893"
  },
  {
    "text": "This is achieved by making ColorizingService an actor, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=898"
  },
  {
    "text": "which will only allow one call to the colorize method at a time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=901"
  },
  {
    "text": "This actor owns the colorizerModel, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=906"
  },
  {
    "text": "which is the auto-generated interface that is produced for the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=908"
  },
  {
    "text": "bundled with the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=911"
  },
  {
    "text": "The colorize method currently performs two operations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=914"
  },
  {
    "text": "It first prepares the input for the model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=918"
  },
  {
    "text": "which involves resizing the image to match the model's input size. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=920"
  },
  {
    "text": "It then runs the input through the model and gets the colorized output. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=924"
  },
  {
    "text": "I went ahead and captured an Instruments trace of the app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=929"
  },
  {
    "text": "running with the Core ML Instruments template.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=932"
  },
  {
    "text": "When looking at the Instruments trace, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=936"
  },
  {
    "text": "it shows that the predictions are run serially, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=938"
  },
  {
    "text": "which is ensured by the actor isolation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=941"
  },
  {
    "text": "However, there are gaps around each prediction ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=944"
  },
  {
    "text": "before the next one is run, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=947"
  },
  {
    "text": "which is contributing to the lack of performance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=949"
  },
  {
    "text": "These are a result of the actor isolation being wrapped around ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=952"
  },
  {
    "text": "not only the model prediction but also the input preparation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=955"
  },
  {
    "text": "One improvement would be to mark the input preparation as a non-isolated method, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=959"
  },
  {
    "text": "so it won't block the next colorize request from entering the actor. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=964"
  },
  {
    "text": "While this would help, the Core ML predictions themselves ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=968"
  },
  {
    "text": "would still be serialized, which is the bottleneck of my processing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=971"
  },
  {
    "text": "To take advantage of concurrency for the Core ML predictions themselves, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=975"
  },
  {
    "text": "an option I can consider is the batch prediction API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=979"
  },
  {
    "text": "It takes in a batch of inputs and runs them through the model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=983"
  },
  {
    "text": "Under the hood, Core ML will take advantage of concurrency when possible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=987"
  },
  {
    "text": "Making a batch version of the colorize method ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=992"
  },
  {
    "text": "is pretty straightforward. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=994"
  },
  {
    "text": "However, the challenging part is figuring out how I'll collect ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=995"
  },
  {
    "text": "the inputs into a batch and pass them to this method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=999"
  },
  {
    "text": "There are actually multiple aspects of this use case ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1003"
  },
  {
    "text": "that make it difficult to use the batch prediction API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1005"
  },
  {
    "text": "The batch API is best used when there's a known quantity of work to be done. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1009"
  },
  {
    "text": "In this case, the amount of images to be processed is not fixed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1014"
  },
  {
    "text": "but a function of screen size and the amount of scrolling done. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1018"
  },
  {
    "text": "I can pick a batch size myself, but I'll have to handle cases ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1022"
  },
  {
    "text": "where the batch size isn't met but still needs to be processed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1026"
  },
  {
    "text": "Also, I'll have a different UI experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1031"
  },
  {
    "text": "where images are colorized in batches. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1033"
  },
  {
    "text": "Lastly, I won't be able to cancel a batch even if the user scrolls away from it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1037"
  },
  {
    "text": "Because of these challenges, I'd rather stick with an API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1043"
  },
  {
    "text": "that handles one prediction at a time.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1046"
  },
  {
    "text": "This is where the new async prediction API can be very useful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1049"
  },
  {
    "text": "It's thread safe and works well for using Core ML alongside Swift concurrency. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1053"
  },
  {
    "text": "To switch to an async design for the code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1058"
  },
  {
    "text": "I first changed the colorize method to be async. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1061"
  },
  {
    "text": "I then added the await keyword in front of the prediction call, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1065"
  },
  {
    "text": "which is required to use the new async version of the API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1068"
  },
  {
    "text": "Then I changed ColorizingService to be a class rather than an actor. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1073"
  },
  {
    "text": "That way, multiple images can be colorized concurrently. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1077"
  },
  {
    "text": "Lastly, I added a cancellation check to the start of the method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1080"
  },
  {
    "text": "The async prediction API will do its best to respond to cancellation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1085"
  },
  {
    "text": "especially when multiple predictions are requested concurrently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1089"
  },
  {
    "text": "but it's best to include an extra check at the start in this case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1092"
  },
  {
    "text": "That way, it also avoids preparing the inputs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1096"
  },
  {
    "text": "if the task was cancelled before the colorize method was even entered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1099"
  },
  {
    "text": "Now I'll make these changes and re-run the app.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1103"
  },
  {
    "text": "Just as before, I'll set it to Colorized mode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1107"
  },
  {
    "text": "I can already see the images are being colorized much faster. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1111"
  },
  {
    "text": "And if I do a quick scroll to the bottom, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1115"
  },
  {
    "text": "the images load almost immediately. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1118"
  },
  {
    "text": "Scrolling up a bit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1121"
  },
  {
    "text": "I can verify the images are being colorized as I scroll back up, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1124"
  },
  {
    "text": "which means that the colorize calls were successfully cancelled the first time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1127"
  },
  {
    "text": "when I did the quick swipe to the bottom. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1131"
  },
  {
    "text": "When looking at a trace using this new async design, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1135"
  },
  {
    "text": "it shows the predictions are being run on multiple images concurrently. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1140"
  },
  {
    "text": "This is denoted by multiple prediction intervals stacked vertically. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1144"
  },
  {
    "text": "Since this model runs partially on the Neural Engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1148"
  },
  {
    "text": "it can also be observed in the Neural Engine Instrument as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1151"
  },
  {
    "text": "With the initial implementation, which colorized the images serially, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1156"
  },
  {
    "text": "colorizing the initial view of images without scrolling took about two seconds.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1160"
  },
  {
    "text": "After switching to the async implementation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1166"
  },
  {
    "text": "which colorized the images concurrently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1169"
  },
  {
    "text": "that time was cut in half to about one second. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1171"
  },
  {
    "text": "So overall, I was able to achieve about a 2x improvement ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1175"
  },
  {
    "text": "in total throughput by taking advantage of the async prediction API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1178"
  },
  {
    "text": "and concurrency with my Colorizer model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1182"
  },
  {
    "text": "However, it's important to note that the amount a given model and use case ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1186"
  },
  {
    "text": "may benefit from a concurrent design heavily depends on several factors, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1190"
  },
  {
    "text": "which include the model's operations, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1195"
  },
  {
    "text": "the compute units and hardware combination, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1198"
  },
  {
    "text": "and other work that the compute devices may be busy with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1201"
  },
  {
    "text": "Also, the ML program and Pipeline model types will provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1205"
  },
  {
    "text": "the best performance improvements from running predictions concurrently.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1209"
  },
  {
    "text": "Overall, when adding concurrency to your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1214"
  },
  {
    "text": "you should carefully profile the workload ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1217"
  },
  {
    "text": "to make sure it's actually benefiting your use case.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1219"
  },
  {
    "text": "Another important thing to keep in mind when adding concurrency to your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1223"
  },
  {
    "text": "is memory usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1227"
  },
  {
    "text": "Having many sets of model inputs and outputs loaded in memory concurrently ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1229"
  },
  {
    "text": "can greatly increase the peak memory usage of your application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1233"
  },
  {
    "text": "You can profile this by combining the Core ML Instrument ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1237"
  },
  {
    "text": "with the Allocations Instrument.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1240"
  },
  {
    "text": "The trace is showing that the memory usage of my app is rising quickly ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1244"
  },
  {
    "text": "as I load many inputs into memory to run through the colorizer model.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1247"
  },
  {
    "text": "A potential issue is that the colorize method from my code has no flow control, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1253"
  },
  {
    "text": "so the amount of images being colorized concurrently has no fixed limit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1258"
  },
  {
    "text": "This may not be an issue if the model inputs and outputs are small. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1263"
  },
  {
    "text": "However, if they're large, then having many sets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1267"
  },
  {
    "text": "of these inputs and outputs in memory at the same time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1270"
  },
  {
    "text": "can greatly increase the peak memory usage of the app.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1273"
  },
  {
    "text": "A way to improve this would be to add logic which limits ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1277"
  },
  {
    "text": "the maximum amount of in-flight predictions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1280"
  },
  {
    "text": "This will result in less inputs and outputs loaded in memory concurrently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1284"
  },
  {
    "text": "which will decrease the peak memory usage while running predictions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1288"
  },
  {
    "text": "In this example, if there are already two items being worked on, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1292"
  },
  {
    "text": "it defers new work items until a previous one has completed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1297"
  },
  {
    "text": "The best strategy will depend on your use case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1301"
  },
  {
    "text": "For example, when streaming data from a camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1305"
  },
  {
    "text": "you may simply want to drop work instead of deferring it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1308"
  },
  {
    "text": "This way, you avoid accumulating frames and doing work ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1311"
  },
  {
    "text": "that's no longer temporally relevant. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1315"
  },
  {
    "text": "Stepping back a bit, here's some general guidance ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1318"
  },
  {
    "text": "on when to use the different prediction APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1321"
  },
  {
    "text": "If you're in a synchronous context ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1324"
  },
  {
    "text": "and the time between each input being available is large ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1326"
  },
  {
    "text": "compared to the model latency, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1330"
  },
  {
    "text": "then the sync prediction API works well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1331"
  },
  {
    "text": "If your inputs become available in batches, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1335"
  },
  {
    "text": "then the batch prediction API is a natural fit.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1338"
  },
  {
    "text": "If you're in an async context ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1342"
  },
  {
    "text": "and have a large amount of inputs becoming available individually over time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1344"
  },
  {
    "text": "that's when the async API can be most useful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1348"
  },
  {
    "text": "To wrap up, as you move through the Core ML workflow, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1352"
  },
  {
    "text": "there are many opportunities for optimization ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1356"
  },
  {
    "text": "during both model development and model integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1358"
  },
  {
    "text": "New compute availability APIs can help you make decisions at runtime ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1362"
  },
  {
    "text": "based on what hardware is available on the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1367"
  },
  {
    "text": "Understanding the model lifecycle and caching behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1371"
  },
  {
    "text": "can help you best decide when and where to load and unload your model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1374"
  },
  {
    "text": "And lastly, the async prediction API can help you ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1379"
  },
  {
    "text": "integrate Core ML with other async Swift code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1382"
  },
  {
    "text": "and also improve throughput by supporting concurrent predictions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1385"
  },
  {
    "text": "This was Ben from the Core ML team, and I am not an AI.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10049/?time=1389"
  }
]