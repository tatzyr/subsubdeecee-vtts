[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=0"
  },
  {
    "text": "Jared: Hello, and welcome to \"What's new in Background Assets.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=10"
  },
  {
    "text": "My name is Jared, and I'm a software engineer here at Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=13"
  },
  {
    "text": "I'm really looking forward to sharing with you ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=16"
  },
  {
    "text": "everything that's new this year with Background Assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=17"
  },
  {
    "text": "Now, our team has changed a few things over the last year. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=21"
  },
  {
    "text": "However, I'd encourage you to check out my prior session ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=23"
  },
  {
    "text": "where Background Assets was introduced. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=26"
  },
  {
    "text": "There's a lot of detailed information in there ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=27"
  },
  {
    "text": "that this new session builds upon. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=29"
  },
  {
    "text": "In this session, I'll start by giving you an overview of Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=31"
  },
  {
    "text": "and why you should adopt it into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=35"
  },
  {
    "text": "Then, I'll discuss what's new this year in Background Assets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=38"
  },
  {
    "text": "which includes an entirely new feature that our team has been ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=40"
  },
  {
    "text": "really excited to share with you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=42"
  },
  {
    "text": "I'll then walk you through a sample implementation of Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=45"
  },
  {
    "text": "that you can even download yourself, and I'll show you how adopting ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=48"
  },
  {
    "text": "this technology can significantly improve the user experience of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=51"
  },
  {
    "text": "I'll then give you some guidance on debugging your app extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=55"
  },
  {
    "text": "and simulating its entry points. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=58"
  },
  {
    "text": "Okay! Let's go over a quick recap of Background Assets.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=60"
  },
  {
    "text": "One of the primary goals behind Background Assets is to prevent waiting. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=65"
  },
  {
    "text": "The last thing a user wants to experience is to launch your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=68"
  },
  {
    "text": "and have to wait for a large download to complete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=71"
  },
  {
    "text": "Background Assets solves this problem through a combination ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=74"
  },
  {
    "text": "of its framework and an associated app extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=77"
  },
  {
    "text": "This new technology was introduced in iOS 16.1 ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=80"
  },
  {
    "text": "alongside the initial release of macOS Ventura. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=83"
  },
  {
    "text": "It supports the ability to download additional content for your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=86"
  },
  {
    "text": "using your CDN provider or a server you manage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=89"
  },
  {
    "text": "For instance, this content may be fetched during an initial app install, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=93"
  },
  {
    "text": "when the app updates, or periodically in the background ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=97"
  },
  {
    "text": "when the user isn't using your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=100"
  },
  {
    "text": "Through the paired app extension, you are able to write code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=102"
  },
  {
    "text": "that runs when the app is not actively being used by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=105"
  },
  {
    "text": "This technology is currently supported on macOS, iOS, and iPadOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=110"
  },
  {
    "text": "so it's already available on your favorite platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=114"
  },
  {
    "text": "One of best parts about using Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=118"
  },
  {
    "text": "is that the extension has the ability to run ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=120"
  },
  {
    "text": "before the user has launched your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=122"
  },
  {
    "text": "This provides a way to start fetching assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=124"
  },
  {
    "text": "the moment your app is installed through the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=126"
  },
  {
    "text": "The extension may also be launched by the system periodically in the background. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=129"
  },
  {
    "text": "This is to ensure that any new or updated assets are present ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=133"
  },
  {
    "text": "when your app is launched by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=136"
  },
  {
    "text": "The extension is also used to service downloads when the app is not running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=139"
  },
  {
    "text": "For instance, when a file finishes downloading, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=143"
  },
  {
    "text": "the extension will be launched so that it can move the file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=146"
  },
  {
    "text": "to its final destination. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=148"
  },
  {
    "text": "Something to keep in mind is that the extension's runtime is limited. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=150"
  },
  {
    "text": "This is to ensure that the user's device is optimized for power and performance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=154"
  },
  {
    "text": "I'll go into more details about this shortly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=158"
  },
  {
    "text": "It's also important to know that the app extension you develop ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=161"
  },
  {
    "text": "to use with Background Assets is placed into a specialized sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=164"
  },
  {
    "text": "This is to ensure that the extension is only being used ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=167"
  },
  {
    "text": "to manage content via Background Assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=170"
  },
  {
    "text": "If you find that a capability or API is not available within the sandbox, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=172"
  },
  {
    "text": "please reach out to us through Feedback Assistant. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=176"
  },
  {
    "text": "I mentioned earlier that your app extension is invoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=179"
  },
  {
    "text": "during three system events: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=181"
  },
  {
    "text": "app install, app update, and periodically in the background. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=183"
  },
  {
    "text": "Let's take a look at how this lifecycle is managed.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=186"
  },
  {
    "text": "The lifecycle of your extension begins when the App Store installs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=190"
  },
  {
    "text": "or updates your app on the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=194"
  },
  {
    "text": "The Background Assets system service is then notified ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=197"
  },
  {
    "text": "and prevents the app from launching. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=199"
  },
  {
    "text": "The system then inspects your app bundle ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=202"
  },
  {
    "text": "and reads its Info.plist for the BAManifestURL key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=204"
  },
  {
    "text": "The system will begin downloading the manifest referenced by that key ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=208"
  },
  {
    "text": "and report progress of the download back to the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=211"
  },
  {
    "text": "Once your manifest has been downloaded, the system then wakes your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=216"
  },
  {
    "text": "by issuing a content request for the given install or update event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=219"
  },
  {
    "text": "The content request includes a path to the downloaded manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=224"
  },
  {
    "text": "Your extension should use the manifest to determine the URLs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=228"
  },
  {
    "text": "file sizes, and what assets to schedule for download. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=231"
  },
  {
    "text": "Then once your extension has determined what assets need to be downloaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=235"
  },
  {
    "text": "it will return those downloads as a set of BADownloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=239"
  },
  {
    "text": "The system then pauses your app extension, or sometimes terminates it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=242"
  },
  {
    "text": "to save power and performance on the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=246"
  },
  {
    "text": "The downloads will then begin and your extension will be notified ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=249"
  },
  {
    "text": "shortly after their completion.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=252"
  },
  {
    "text": "The periodic content request is nearly identical to the app install event, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=256"
  },
  {
    "text": "with the only key difference being that your device determines ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=259"
  },
  {
    "text": "when the event will occur. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=262"
  },
  {
    "text": "The device makes this decision based on how the user has been using their device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=263"
  },
  {
    "text": "Key factors such as Low Power Mode, Background App Refresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=268"
  },
  {
    "text": "or how frequently your app has been launched are all considered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=272"
  },
  {
    "text": "Now, let's dive a little deeper and look at the factors ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=275"
  },
  {
    "text": "that contribute to when your extension runs periodically.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=278"
  },
  {
    "text": "We care a lot about a device's overall performance and power usage, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=282"
  },
  {
    "text": "which is why Background Assets has limitations ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=286"
  },
  {
    "text": "placed on the extension's runtime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=288"
  },
  {
    "text": "This includes an enforcement on your extension's memory usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=290"
  },
  {
    "text": "If your extension exceeds a few megabytes of memory, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=294"
  },
  {
    "text": "it may be terminated by the system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=296"
  },
  {
    "text": "So you may want to consider memory mapping ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=299"
  },
  {
    "text": "any large files that your extension needs to read, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=301"
  },
  {
    "text": "as memory-mapped data backed by the device's storage ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=303"
  },
  {
    "text": "does not count against this limitation.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=306"
  },
  {
    "text": "When an app is initially installed, it is provided with a default allotment ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=310"
  },
  {
    "text": "of a few minutes of runtime per day. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=313"
  },
  {
    "text": "While this may not sound like much, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=315"
  },
  {
    "text": "with a properly designed extension, this can go a long way. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=317"
  },
  {
    "text": "The runtime also changes based on app usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=321"
  },
  {
    "text": "If an app hasn't been launched in some time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=324"
  },
  {
    "text": "the system may start throttling launches of the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=326"
  },
  {
    "text": "For instance, a rarely used app may see its runtime more heavily restricted, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=329"
  },
  {
    "text": "whereas a commonly used app may be given additional runtime.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=333"
  },
  {
    "text": "The BADownloaderExtension protocol defines functions that are used ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=338"
  },
  {
    "text": "as entry points into your app extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=341"
  },
  {
    "text": "The runtime starts being counted when a function is invoked by the system ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=344"
  },
  {
    "text": "and stops being counted when that function exits scope. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=347"
  },
  {
    "text": "Once your function exits scope ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=350"
  },
  {
    "text": "or your extension's runtime has been exhausted, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=352"
  },
  {
    "text": "the system may suspend or terminate the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=354"
  },
  {
    "text": "I'll provide an example in a moment.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=357"
  },
  {
    "text": "However, there is one exception ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=360"
  },
  {
    "text": "to function scope controlling the runtime of your extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=361"
  },
  {
    "text": "If an asynchronous exclusive control API is invoked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=364"
  },
  {
    "text": "your extension will be kept running up until the point ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=367"
  },
  {
    "text": "that its completion handler is invoked and returned. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=370"
  },
  {
    "text": "There are a couple of ways that the extension's runtime ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=373"
  },
  {
    "text": "may be controlled by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=375"
  },
  {
    "text": "For instance, if the device is in Low Power Mode ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=377"
  },
  {
    "text": "or has Background App Refresh disabled, whether that's globally ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=380"
  },
  {
    "text": "or for your specific app, then your extension will never run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=383"
  },
  {
    "text": "Previously, I mentioned how extension runtime is determined ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=388"
  },
  {
    "text": "based on function scope. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=391"
  },
  {
    "text": "Let's have a look at an example to better understand how that works.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=392"
  },
  {
    "text": "This code represents the extension's interface ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=397"
  },
  {
    "text": "that services your background downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=399"
  },
  {
    "text": "The BADownloaderExtension protocol defines the functions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=402"
  },
  {
    "text": "that the system will invoke into your extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=404"
  },
  {
    "text": "Now let's add one of the required functions to conform to this protocol. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=407"
  },
  {
    "text": "The \"downloads for request\" function is one of the primary entry points ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=412"
  },
  {
    "text": "into the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=416"
  },
  {
    "text": "Its BAContentRequest defines if it's being invoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=417"
  },
  {
    "text": "during an app install, app update, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=420"
  },
  {
    "text": "or as a part of a periodic check in the background. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=422"
  },
  {
    "text": "The manifestURL argument provides a path to a local file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=425"
  },
  {
    "text": "that was downloaded before the extension was invoked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=428"
  },
  {
    "text": "The manifest file is commonly used to compare what is currently downloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=431"
  },
  {
    "text": "versus what downloads might be available on the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=435"
  },
  {
    "text": "The function definition's return type requires ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=439"
  },
  {
    "text": "a set of download objects that conform to the BADownload type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=441"
  },
  {
    "text": "This means that answering this function's request ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=444"
  },
  {
    "text": "requires you to synchronously return any content needing to be downloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=446"
  },
  {
    "text": "before the function exits scope. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=450"
  },
  {
    "text": "However, in this contrived example, let's say that you invoke ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=452"
  },
  {
    "text": "a function called parseManifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=455"
  },
  {
    "text": "This function reads the downloaded manifest ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=457"
  },
  {
    "text": "and then returns the BADownload objects needing to be downloaded.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=459"
  },
  {
    "text": "However, let's say that the parseManifest function is poorly implemented ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=464"
  },
  {
    "text": "and takes 30 minutes to parse and construct the downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=468"
  },
  {
    "text": "This will end up exceeding the extension's runtime significantly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=471"
  },
  {
    "text": "and the extension will be terminated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=475"
  },
  {
    "text": "It's important to remember that the extension's runtime is calculated ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=477"
  },
  {
    "text": "from the moment the \"downloads for request\" function is called, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=480"
  },
  {
    "text": "up until the point it exits scope and returns. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=483"
  },
  {
    "text": "Let's take a look at another problematic example.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=487"
  },
  {
    "text": "Whenever any of the BADownloaderExtension protocol functions exit scope, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=491"
  },
  {
    "text": "the extension may become suspended and then terminated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=495"
  },
  {
    "text": "You'll notice that the protocol does not define any of its functions as mutating, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=498"
  },
  {
    "text": "and there's a good reason for this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=502"
  },
  {
    "text": "When your extension is terminated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=504"
  },
  {
    "text": "any instance variables or in-memory state will not be saved. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=506"
  },
  {
    "text": "If your extension needs to maintain any state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=510"
  },
  {
    "text": "you should serialize that state to disk. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=512"
  },
  {
    "text": "Next, let's talk about the API you'll use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=515"
  },
  {
    "text": "from both the extension and app to manage downloads.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=518"
  },
  {
    "text": "The download manager within the framework is the primary way ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=522"
  },
  {
    "text": "to communicate with the Background Assets system service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=524"
  },
  {
    "text": "The manager is a singleton object that can be used throughout your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=527"
  },
  {
    "text": "Using the manager, you can schedule downloads of your assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=531"
  },
  {
    "text": "in the background and promote ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=534"
  },
  {
    "text": "already scheduled downloads to the foreground. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=535"
  },
  {
    "text": "From the download manager, you can also manage downloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=538"
  },
  {
    "text": "that are currently in-flight, which I mentioned earlier could have been ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=540"
  },
  {
    "text": "scheduled by the extension before your app was ever launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=543"
  },
  {
    "text": "There's also a synchronization mechanism that you may use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=547"
  },
  {
    "text": "to ensure that both your app and its associated extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=549"
  },
  {
    "text": "are not performing similar operations at the same time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=552"
  },
  {
    "text": "The last thing I'd like to bring up about the download manager ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=556"
  },
  {
    "text": "is that it has a delegate for receiving callbacks about downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=558"
  },
  {
    "text": "similar to the BADownloaderExtension protocol. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=562"
  },
  {
    "text": "If you register a delegate on BADownloadManager, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=565"
  },
  {
    "text": "then it will receive those callbacks instead of your extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=567"
  },
  {
    "text": "This is useful as it provides your app a way ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=571"
  },
  {
    "text": "to manage its downloads while it is running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=573"
  },
  {
    "text": "Now that you've had a quick refresher about how to manage downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=576"
  },
  {
    "text": "let's talk about how you should manage those files ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=579"
  },
  {
    "text": "once they're already on the user's device.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=581"
  },
  {
    "text": "Any files you download with Background Assets are marked purgeable, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=584"
  },
  {
    "text": "which means that the system may remove them under critical circumstances. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=588"
  },
  {
    "text": "Think a system security update or if a user needs to capture a video ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=592"
  },
  {
    "text": "of their child's first step.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=595"
  },
  {
    "text": "However, if you modify or expand a downloaded asset, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=598"
  },
  {
    "text": "then those files are not tracked by the system ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=601"
  },
  {
    "text": "and therefore are not purgeable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=603"
  },
  {
    "text": "You should think carefully about how you modify assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=605"
  },
  {
    "text": "or extract data out of them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=607"
  },
  {
    "text": "If you incorrectly manage your downloaded assets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=610"
  },
  {
    "text": "you could increase the size of a user's backup of their device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=612"
  },
  {
    "text": "or prevent a critical security update from being downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=615"
  },
  {
    "text": "Therefore, you should try to store your downloaded assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=619"
  },
  {
    "text": "in your caches directory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=621"
  },
  {
    "text": "That way, the system knows that it can purge them ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=623"
  },
  {
    "text": "when it is critical to do so. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=625"
  },
  {
    "text": "Now that you have a full recap of how all of this works, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=628"
  },
  {
    "text": "let's take a look at what's new this year with Background Assets.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=630"
  },
  {
    "text": "Earlier this year, we introduced essential downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=635"
  },
  {
    "text": "which provides a way to fetch content while your app is installing or updating. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=638"
  },
  {
    "text": "This means that your downloads are completely integrated ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=643"
  },
  {
    "text": "into the iOS Home Screen, macOS Launchpad, and the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=645"
  },
  {
    "text": "To the end user, the download of your assets appear to them ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=649"
  },
  {
    "text": "as if the app is currently still being downloaded from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=653"
  },
  {
    "text": "This also means that while your essential downloads are in-flight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=657"
  },
  {
    "text": "your app cannot be launched by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=660"
  },
  {
    "text": "All the user can do is cancel or pause installation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=663"
  },
  {
    "text": "Since pauses are supported, your server should support HTTP ranges ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=666"
  },
  {
    "text": "so that resumes are possible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=670"
  },
  {
    "text": "Since essential downloads occur during app install, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=673"
  },
  {
    "text": "they take priority over any non-essential downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=675"
  },
  {
    "text": "Let's take a look. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=678"
  },
  {
    "text": "It all begins when your app is requested from the App Store or TestFlight. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=681"
  },
  {
    "text": "If the app's Info.plist contains essential asset keys, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=685"
  },
  {
    "text": "then progress is set up on the device and we go through this flow. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=689"
  },
  {
    "text": "Once your app has been downloaded and installed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=693"
  },
  {
    "text": "the system wakes your extension by issuing a request for content, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=695"
  },
  {
    "text": "which includes whether the request is for an app install, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=699"
  },
  {
    "text": "app update, or for a periodic fetch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=702"
  },
  {
    "text": "During this time, an authentication challenge may be sent ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=705"
  },
  {
    "text": "in order for the manifest to be downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=707"
  },
  {
    "text": "Your extension will then vend back a combination of essential ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=710"
  },
  {
    "text": "and non-essential downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=713"
  },
  {
    "text": "As a side note, it's important that your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=715"
  },
  {
    "text": "vends the downloads back quickly, as your app's download progress ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=717"
  },
  {
    "text": "will appear frozen to the user until this function returns.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=720"
  },
  {
    "text": "The moment the extension provides the downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=724"
  },
  {
    "text": "any downloads that were marked as essential will immediately begin. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=726"
  },
  {
    "text": "Your extension may also receive an additional authentication challenge ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=730"
  },
  {
    "text": "during this time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=733"
  },
  {
    "text": "Once all of your essential downloads have finished, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=736"
  },
  {
    "text": "the system will terminate your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=738"
  },
  {
    "text": "and the app will become launchable by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=740"
  },
  {
    "text": "The extension will then receive a batch of successful ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=743"
  },
  {
    "text": "and potentially failed downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=745"
  },
  {
    "text": "If there are any failed downloads you can re-enqueue them ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=747"
  },
  {
    "text": "as nonessential using BADownloadManager. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=750"
  },
  {
    "text": "As your extension is receiving completion messages ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=754"
  },
  {
    "text": "for essential downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=757"
  },
  {
    "text": "the system will immediately start downloading the nonessential assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=758"
  },
  {
    "text": "The nonessential downloads will then be sent to the extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=762"
  },
  {
    "text": "as they finish downloading. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=765"
  },
  {
    "text": "Now let's take a look at how essential downloads integrate ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=767"
  },
  {
    "text": "into the App Store installation progress on the iOS Home Screen. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=770"
  },
  {
    "text": "A percentage of the progress indicator is broken down ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=775"
  },
  {
    "text": "into the time it takes to download your base app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=777"
  },
  {
    "text": "plus the amount of time to do the install, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=780"
  },
  {
    "text": "followed by the amount of time necessary to download your essential assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=783"
  },
  {
    "text": "The new BAEssentialDownloadAllowance key defined in your app's Info.plist ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=787"
  },
  {
    "text": "is used to set up the initial overall progress indicator. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=792"
  },
  {
    "text": "Then once contentForRequest is invoked into your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=795"
  },
  {
    "text": "and your extension returns downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=798"
  },
  {
    "text": "the file size of each essential download is added together ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=800"
  },
  {
    "text": "to determine how much is actually being downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=804"
  },
  {
    "text": "If the amount that you schedule for download is significantly less ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=807"
  },
  {
    "text": "than the essential download allowance, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=810"
  },
  {
    "text": "then the progress indicator may move rather quickly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=812"
  },
  {
    "text": "You should aim to get your essential download allowance ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=815"
  },
  {
    "text": "close to what is actually being downloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=817"
  },
  {
    "text": "to ensure smooth progress for the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=819"
  },
  {
    "text": "It's important to keep in mind that everything we've discussed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=822"
  },
  {
    "text": "can be disabled by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=825"
  },
  {
    "text": "In the App Store settings pane, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=827"
  },
  {
    "text": "there is a section for disabling in-app content. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=828"
  },
  {
    "text": "While this doesn't disable Background Assets in its entirety, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=831"
  },
  {
    "text": "it does prevent essential assets from downloading ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=834"
  },
  {
    "text": "and the ability for the extension to run ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=837"
  },
  {
    "text": "before the app has been launched by the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=839"
  },
  {
    "text": "So it's important to think of essential assets as just that: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=841"
  },
  {
    "text": "essential but not a requirement for your app to launch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=844"
  },
  {
    "text": "Therefore, its important for your app to handle flows ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=847"
  },
  {
    "text": "where essential assets are not already on the device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=850"
  },
  {
    "text": "when your app is launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=853"
  },
  {
    "text": "The ability to use essential assets was actually introduced ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=855"
  },
  {
    "text": "earlier in the spring as part of iOS 16.4 and macOS Ventura 13.3. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=857"
  },
  {
    "text": "The new APIs are quite minimal and should be easily added ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=862"
  },
  {
    "text": "into your existing extension.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=865"
  },
  {
    "text": "The first API that was created to support essential downloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=868"
  },
  {
    "text": "was actually a new initializer on BAURLDownload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=871"
  },
  {
    "text": "There are two new arguments we've added specifically to support this feature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=875"
  },
  {
    "text": "The essential argument, as its name implies, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=879"
  },
  {
    "text": "specifies if the download should be marked as essential, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=881"
  },
  {
    "text": "where essential means contributing to the app's overall download ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=884"
  },
  {
    "text": "and installation progress. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=887"
  },
  {
    "text": "The file size argument is the size of the assets that will be downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=889"
  },
  {
    "text": "The file size must be accurate when creating essential downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=893"
  },
  {
    "text": "The system needs this information so that the app install progress ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=897"
  },
  {
    "text": "on the user's device is displayed properly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=900"
  },
  {
    "text": "If the file that Background Assets downloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=903"
  },
  {
    "text": "does not match the file size provided here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=905"
  },
  {
    "text": "then the download will fail if the download is marked as essential. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=907"
  },
  {
    "text": "If your extension does not know the size of the file, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=911"
  },
  {
    "text": "then the file size should be included in the BAManifestURL ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=914"
  },
  {
    "text": "that is provided to the extension before the extension is launched.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=917"
  },
  {
    "text": "Another API that was introduced provides an easy one-liner ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=922"
  },
  {
    "text": "for creating a nonessential representation of a download. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=926"
  },
  {
    "text": "Since essential downloads can only be enqueued ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=929"
  },
  {
    "text": "in the contentForRequest function, this API can be useful in many cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=931"
  },
  {
    "text": "For example, let's say fetching an essential download failed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=936"
  },
  {
    "text": "perhaps because of a networking issue ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=940"
  },
  {
    "text": "or the file was simply temporarily unavailable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=942"
  },
  {
    "text": "Well, in the background download failed function ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=945"
  },
  {
    "text": "within your extension, you can easily create ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=947"
  },
  {
    "text": "a nonessential representation of that download and re-enqueue it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=949"
  },
  {
    "text": "The download will then begin in the background ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=953"
  },
  {
    "text": "and your extension or app will be notified when it is completed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=955"
  },
  {
    "text": "Now let's take a look at some of the required keys ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=960"
  },
  {
    "text": "that need to be present in your app's Info.plist.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=961"
  },
  {
    "text": "In last year's session, I went over each of these keys in detail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=966"
  },
  {
    "text": "If you'd like a more in-depth explanation, I'd encourage you to check out that talk. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=969"
  },
  {
    "text": "It's important to keep in mind that these keys are required ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=973"
  },
  {
    "text": "not only to use the Background Assets framework, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=976"
  },
  {
    "text": "but are also necessary in order to submit your app to the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=978"
  },
  {
    "text": "There are two new keys this year that are required ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=983"
  },
  {
    "text": "to support essential assets: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=985"
  },
  {
    "text": "BAEssentialDownloadAllowance and BAEssentialMaxInstallSize. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=987"
  },
  {
    "text": "The essential download allowance is represented in bytes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=991"
  },
  {
    "text": "and defines an upper bound on how large the sum ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=994"
  },
  {
    "text": "of all of your essential assets will take to download. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=996"
  },
  {
    "text": "It's important to try to get this number as close as possible ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1000"
  },
  {
    "text": "to the size of the essential assets you enqueue ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1003"
  },
  {
    "text": "so that download progress is smooth for the user when they install your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1005"
  },
  {
    "text": "The other new key, BAEssentialMaxInstallSize, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1009"
  },
  {
    "text": "represents the maximum size of those assets extracted onto the user's device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1011"
  },
  {
    "text": "This number appears on the App Store as a way to tell users ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1016"
  },
  {
    "text": "how much storage your app will use after the essential assets have been installed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1018"
  },
  {
    "text": "That pretty much sums up the new APIs we've added for essential assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1023"
  },
  {
    "text": "As you just saw, adding essential assets support ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1027"
  },
  {
    "text": "to your existing app can be done with minimal code changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1029"
  },
  {
    "text": "It's really just that easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1032"
  },
  {
    "text": "Now for the fun part. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1033"
  },
  {
    "text": "Let's take a look at how you can extend an existing app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1035"
  },
  {
    "text": "that uses URLSession into using Background Assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1037"
  },
  {
    "text": "The app I'll be showing you today downloads WWDC Sessions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1040"
  },
  {
    "text": "just like this one, and stores them on your device for offline viewing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1044"
  },
  {
    "text": "Currently, the app has to be launched before the videos will download. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1048"
  },
  {
    "text": "By adopting Background Assets, we can eliminate this wait time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1052"
  },
  {
    "text": "by having the videos already downloaded before the app is launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1055"
  },
  {
    "text": "Let's have a look. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1059"
  },
  {
    "text": "Here's the app we'll be building upon today.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1061"
  },
  {
    "text": "You'll notice that the moment it is launched, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1065"
  },
  {
    "text": "sessions immediately begin downloading. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1066"
  },
  {
    "text": "The way this app currently works is that a manifest downloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1069"
  },
  {
    "text": "from a server, which contains a list of WWDC sessions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1072"
  },
  {
    "text": "After the manifest is fetched, the sessions start downloading ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1076"
  },
  {
    "text": "and then become viewable once tapped. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1079"
  },
  {
    "text": "Let's take a look at what's necessary to adopt Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1082"
  },
  {
    "text": "into this project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1085"
  },
  {
    "text": "Before you begin to use the Background Assets API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1087"
  },
  {
    "text": "the first thing to add are the initial Info.plist keys that I discussed earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1090"
  },
  {
    "text": "These key are required to be present in your app bundle's Info.plist file. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1094"
  },
  {
    "text": "The next thing you'll need to do is add a background download extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1098"
  },
  {
    "text": "and embed it into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1101"
  },
  {
    "text": "You'll want to make sure that your extension's bundle identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1103"
  },
  {
    "text": "is prefixed with your app's bundle identifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1105"
  },
  {
    "text": "You'll also want to ensure that both your app and its extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1108"
  },
  {
    "text": "are in a common app group, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1111"
  },
  {
    "text": "as the app group is how your extension shares downloaded assets with your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1113"
  },
  {
    "text": "The last thing you'll want to ensure is that both your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1118"
  },
  {
    "text": "and its extension are signed with your team identifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1120"
  },
  {
    "text": "With those steps out of the way, you can begin to adopt Background Assets.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1123"
  },
  {
    "text": "Here in front of you is the Xcode project for the app you just saw. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1128"
  },
  {
    "text": "I've already went and created the download extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1132"
  },
  {
    "text": "and embedded it into the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1134"
  },
  {
    "text": "I've also added the required Info.plist keys. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1137"
  },
  {
    "text": "With all of that out of the way, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1140"
  },
  {
    "text": "let's begin by navigating to the SessionManager.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1142"
  },
  {
    "text": "The SessionManager in this project currently uses URLSession ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1147"
  },
  {
    "text": "to fetch the latest downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1150"
  },
  {
    "text": "URLSession is a fantastic API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1152"
  },
  {
    "text": "We'll continue to use it within the app to fetch the manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1155"
  },
  {
    "text": "However, we'll migrate to using Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1158"
  },
  {
    "text": "to fetch the actual sessions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1161"
  },
  {
    "text": "This is so that the app can take advantage of promoting any assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1162"
  },
  {
    "text": "scheduled in the background by the extension we're about to create ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1165"
  },
  {
    "text": "to the foreground when the app is launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1168"
  },
  {
    "text": "To begin, we'll starting by importing the Background Assets framework module.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1171"
  },
  {
    "text": "I'll then scroll down and remove the variables associated with URLSession ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1178"
  },
  {
    "text": "as they are no longer needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1182"
  },
  {
    "text": "Now I'll navigate to the \"start download\" method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1184"
  },
  {
    "text": "As you can see, the existing code was tracking sessions to download ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1189"
  },
  {
    "text": "by the URLSession download task. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1192"
  },
  {
    "text": "This won't be necessary anymore, so let's remove it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1194"
  },
  {
    "text": "Here's where things begin to get interesting. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1198"
  },
  {
    "text": "When you work with Background Assets, its important to think about ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1201"
  },
  {
    "text": "your extension and app possibly running at the same time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1203"
  },
  {
    "text": "To coordinate this in a near effortless way, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1206"
  },
  {
    "text": "you'll need to use withExclusiveControl to guarantee ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1209"
  },
  {
    "text": "that any work that needs mutual exclusion with the other process can do so. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1212"
  },
  {
    "text": "Let's add that in now.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1216"
  },
  {
    "text": "As you can tell, this API is asynchronous and escaping. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1221"
  },
  {
    "text": "Any work scheduled inside the closure is guaranteed to run ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1224"
  },
  {
    "text": "independently from the extension if the extension also uses this API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1227"
  },
  {
    "text": "We'll implement the extension in a moment, but for now, let's focus on the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1232"
  },
  {
    "text": "Since we know we're running in a mutually exclusive context, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1236"
  },
  {
    "text": "let's ask the download manager if there are currently any downloads in-flight.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1239"
  },
  {
    "text": "There's no reason to reschedule a download ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1243"
  },
  {
    "text": "if the extension has already scheduled it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1245"
  },
  {
    "text": "However, one thing we can do is, if we find an existing download, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1247"
  },
  {
    "text": "we can promote it to the foreground.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1251"
  },
  {
    "text": "Promoting a download to the foreground can significantly decrease ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1255"
  },
  {
    "text": "the time it takes for a download to finish. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1258"
  },
  {
    "text": "Since the user is currently using the app, it's a great opportunity ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1261"
  },
  {
    "text": "to fetch the download as quickly as possible. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1264"
  },
  {
    "text": "The user might want to view it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1266"
  },
  {
    "text": "If the download does not already exist, we'll create it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1267"
  },
  {
    "text": "Then, regardless of if we just created the download ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1272"
  },
  {
    "text": "or if the extension did, we'll go ahead and start it in the foreground. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1275"
  },
  {
    "text": "Promoting a download from the background to the foreground ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1279"
  },
  {
    "text": "does not cause the download to restart, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1282"
  },
  {
    "text": "it is simply resumed from where it left off in that transition. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1284"
  },
  {
    "text": "The next thing on the list is to implement the BADownloadManagerDelegate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1287"
  },
  {
    "text": "but before I do that, I'll delete the old URLSessionDelegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1290"
  },
  {
    "text": "Now that the old delegate is gone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1299"
  },
  {
    "text": "let's create the Background Assets delegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1301"
  },
  {
    "text": "Since the session manager is now conforming to the delegate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1305"
  },
  {
    "text": "it's important that it's wired up to actually receive those messages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1308"
  },
  {
    "text": "So I'll go up to the initializer and wire that up now.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1311"
  },
  {
    "text": "Since BADownloadManager connects directly to the system scheduler, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1317"
  },
  {
    "text": "it's a singleton object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1320"
  },
  {
    "text": "Having this delegate attached to the download manager ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1322"
  },
  {
    "text": "will cause your app to receive messages over the extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1324"
  },
  {
    "text": "if your app is currently running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1327"
  },
  {
    "text": "Now let's head back to the functions we need to implement.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1329"
  },
  {
    "text": "For this app, there are three specific functions ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1335"
  },
  {
    "text": "on the delegate protocol that we'll be implementing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1337"
  },
  {
    "text": "The first is for progress handling. Let's implement that now.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1340"
  },
  {
    "text": "Before we start blindly updating progress in the UI, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1348"
  },
  {
    "text": "we'll make sure that the download we're receiving progress messages for ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1351"
  },
  {
    "text": "is something that the manifest is currently tracking. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1353"
  },
  {
    "text": "If a download is being tracked, we'll call updateDownloadProgress, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1356"
  },
  {
    "text": "which is a helper function within the app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1360"
  },
  {
    "text": "that sends the progress directly over to SwiftUI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1361"
  },
  {
    "text": "Next, I'll implement what happens when a download finishes.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1364"
  },
  {
    "text": "It starts pretty much the same way, which is to make sure ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1370"
  },
  {
    "text": "it's handling only downloads that are expected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1373"
  },
  {
    "text": "Then replaceItemAt is used to move the object from the temporary location ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1375"
  },
  {
    "text": "that Background Assets has given us to its final location. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1380"
  },
  {
    "text": "It's important to use move operations here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1384"
  },
  {
    "text": "as the system will track and purge the file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1386"
  },
  {
    "text": "if the device becomes low on space. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1388"
  },
  {
    "text": "So you should make sure that your app always checks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1390"
  },
  {
    "text": "to see if any files are missing and refetches it if it so needs to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1392"
  },
  {
    "text": "The last thing that happens here is, a Task is spawned ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1397"
  },
  {
    "text": "against the MainActor, the state is marked as downloaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1399"
  },
  {
    "text": "and the app begins fetching the session's thumbnail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1402"
  },
  {
    "text": "Now, I'd like to say that all downloads will succeed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1405"
  },
  {
    "text": "However, the unfortunate truth is that they can fail, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1408"
  },
  {
    "text": "whether that's because the server no longer has that resource ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1411"
  },
  {
    "text": "or there's a network issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1414"
  },
  {
    "text": "Background Assets does retry and wait for network connectivity problems, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1416"
  },
  {
    "text": "but after a certain point in time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1419"
  },
  {
    "text": "you have to know that the file is not on its way. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1421"
  },
  {
    "text": "Another thing to keep in mind is that downloads that are promoted ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1424"
  },
  {
    "text": "to the foreground will fail almost instantly ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1426"
  },
  {
    "text": "if there is a network connectivity issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1428"
  },
  {
    "text": "There's not much our app needs to do when a download fails. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1430"
  },
  {
    "text": "It could present UI or reschedule it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1432"
  },
  {
    "text": "but for this example, let's log that there was a problem.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1435"
  },
  {
    "text": "Since the delegate is now fully implemented, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1445"
  },
  {
    "text": "let's relaunch the app and see how it looks.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1447"
  },
  {
    "text": "Well, to no surprise, it looks identical, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1454"
  },
  {
    "text": "and that's what we really wanted to see here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1456"
  },
  {
    "text": "Adding Background Assets in place of URLSession is quite effortless. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1459"
  },
  {
    "text": "The next thing I'll show you is how to implement the app extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1463"
  },
  {
    "text": "for handling background downloading. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1466"
  },
  {
    "text": "Adding this app extension is how you can leverage Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1468"
  },
  {
    "text": "to fetch your content before your app is installed or updated ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1471"
  },
  {
    "text": "and is what provides the support for enqueuing essential assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1474"
  },
  {
    "text": "In essence, the extension is what is responsible ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1478"
  },
  {
    "text": "for scheduling downloads while your app is not running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1481"
  },
  {
    "text": "Let's have a look. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1483"
  },
  {
    "text": "Here we are in the background download handler, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1486"
  },
  {
    "text": "which receives messages within your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1488"
  },
  {
    "text": "related to Background Assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1490"
  },
  {
    "text": "From the extension, the first thing I'll do is create a logger ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1492"
  },
  {
    "text": "so that we can see from Console.app when our extension is running.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1494"
  },
  {
    "text": "Next, I'll implement the contentForRequest function ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1500"
  },
  {
    "text": "that's part of the BADownloaderExtension protocol.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1502"
  },
  {
    "text": "The first thing this extension will do is parse the manifest ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1507"
  },
  {
    "text": "that was predownloaded before the extension was launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1510"
  },
  {
    "text": "If the manifest that was downloaded is somehow invalid, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1513"
  },
  {
    "text": "the extension will be configured to enqueue no downloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1516"
  },
  {
    "text": "Once the extension knows that the manifest is valid, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1520"
  },
  {
    "text": "it is atomically saved into the app group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1523"
  },
  {
    "text": "This is so that the app and the extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1525"
  },
  {
    "text": "have the latest version of the manifest locally that they can reference later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1527"
  },
  {
    "text": "Since this save is done atomically, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1532"
  },
  {
    "text": "using withExclusiveControl is not necessary. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1533"
  },
  {
    "text": "The extension will then create a mutable set of download objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1537"
  },
  {
    "text": "that the extension will return to the system to be scheduled. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1539"
  },
  {
    "text": "As discussed earlier, essential downloads are only supported ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1543"
  },
  {
    "text": "during app installation or app update. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1546"
  },
  {
    "text": "I'll then iterate through the manifest for all sessions that are remote, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1549"
  },
  {
    "text": "which in this context means that they aren't downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1552"
  },
  {
    "text": "A BAURLDownload object is then created ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1556"
  },
  {
    "text": "for every download that needs to be scheduled. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1558"
  },
  {
    "text": "The download is given a unique identifier, a URLRequest, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1561"
  },
  {
    "text": "an annotation for if the download should be fetched as essential, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1565"
  },
  {
    "text": "its file size, the app group the asset will be downloaded into, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1568"
  },
  {
    "text": "and a relative priority to control which downloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1572"
  },
  {
    "text": "the scheduler should start first. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1574"
  },
  {
    "text": "One important thing to keep in mind is that any downloads marked as essential ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1577"
  },
  {
    "text": "must have an accurate file size, or the download will marked as a failure. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1580"
  },
  {
    "text": "This is to support smooth progress on the iOS Home Screen, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1585"
  },
  {
    "text": "macOS Launchpad, and the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1588"
  },
  {
    "text": "Now that we have support for enqueuing downloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1591"
  },
  {
    "text": "let's take a look at handling successful downloads.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1593"
  },
  {
    "text": "The extension processes downloads if the app is not running ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1597"
  },
  {
    "text": "or if the app doesn't have a delegate assigned to BADownloadManager. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1599"
  },
  {
    "text": "The first thing I'll implement in the download finished handler ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1603"
  },
  {
    "text": "will be asynchronously acquiring exclusive control. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1605"
  },
  {
    "text": "Since acquiring exclusive control is asynchronous, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1610"
  },
  {
    "text": "we need to hang on to the temporary file the extension just vended us. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1612"
  },
  {
    "text": "As you can see, I'm accomplishing this by moving the file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1616"
  },
  {
    "text": "into a temporary location that will outlive this function's scope. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1619"
  },
  {
    "text": "I'll also add a Swift defer to ensure that the ephemeral file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1623"
  },
  {
    "text": "that the extension downloads is always cleaned up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1626"
  },
  {
    "text": "Although the system will delete the file for you, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1629"
  },
  {
    "text": "it's best practice to manage it yourself. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1631"
  },
  {
    "text": "I'll then load the manifest from the app group ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1635"
  },
  {
    "text": "and verify its validity. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1636"
  },
  {
    "text": "The extension will then check to make sure the downloaded identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1639"
  },
  {
    "text": "being processed matches a session that is expected in the manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1642"
  },
  {
    "text": "Then the extension will move that file from its ephemeral location ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1647"
  },
  {
    "text": "to its final destination inside the app group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1650"
  },
  {
    "text": "A LocalSession is then constructed to quickly validate ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1654"
  },
  {
    "text": "that the session is downloaded into its appropriate location. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1657"
  },
  {
    "text": "The last thing to handle are failed downloads.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1661"
  },
  {
    "text": "An important thing that is commonly forgotten ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1666"
  },
  {
    "text": "is that if a BAManifestURL fails to download, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1668"
  },
  {
    "text": "the extension is actually notified about it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1671"
  },
  {
    "text": "Its type inherits from BAURLDownload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1673"
  },
  {
    "text": "However, that's not its exact internal type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1675"
  },
  {
    "text": "Therefore, the extension filters to ensure its only dealing ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1678"
  },
  {
    "text": "with BAURLDownload objects. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1681"
  },
  {
    "text": "Since essential assets download in the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1684"
  },
  {
    "text": "they only wait a few seconds for network connectivity ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1687"
  },
  {
    "text": "since those downloads impact app installation progress. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1689"
  },
  {
    "text": "Therefore, it can be a good idea to re-enqueue ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1692"
  },
  {
    "text": "essential downloads as nonessential if they happen to fail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1695"
  },
  {
    "text": "One way you can easily convert an essential download ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1699"
  },
  {
    "text": "into being nonessential is to use the new removingEssential() function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1701"
  },
  {
    "text": "That function returns a nonessential copy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1705"
  },
  {
    "text": "You then vend that copy to BADownloadManager's ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1708"
  },
  {
    "text": "scheduleDownload function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1710"
  },
  {
    "text": "The system will then fetch the download at an opportune time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1712"
  },
  {
    "text": "Now that our app and its extension have fully adopted Background Assets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1715"
  },
  {
    "text": "let's add some UI that indicates ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1719"
  },
  {
    "text": "that a specific session was downloaded as essential.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1720"
  },
  {
    "text": "Remember, essential means that app installation and app update ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1725"
  },
  {
    "text": "prohibit app launch until the assets are fully downloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1729"
  },
  {
    "text": "However, since the app being blocked from launching only occurs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1732"
  },
  {
    "text": "during an install from the App Store or TestFlight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1735"
  },
  {
    "text": "having an indicator present is a good way to visibly recognize this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1738"
  },
  {
    "text": "This indicator will be implemented in SwiftUI within the VideoSelector view.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1742"
  },
  {
    "text": "If the session is marked as essential in the manifest, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1748"
  },
  {
    "text": "a green circle is drawn in the navigation view. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1750"
  },
  {
    "text": "And that's all there is to it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1753"
  },
  {
    "text": "Now that you've seen just how easy it is to implement Background Assets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1756"
  },
  {
    "text": "let's take a look at debugging the extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1759"
  },
  {
    "text": "and simulating its entry points. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1761"
  },
  {
    "text": "As I discussed earlier, the extension launches ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1763"
  },
  {
    "text": "during an app install, app update, or periodically in the background. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1765"
  },
  {
    "text": "Since app installation is controlled by the App Store ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1769"
  },
  {
    "text": "and periodic events are controlled by the device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1772"
  },
  {
    "text": "you'll need a way to force your extension to launch in order to debug it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1774"
  },
  {
    "text": "Fortunately, our team has created a tool that ships with Xcode, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1778"
  },
  {
    "text": "which can be used to launch the extension and simulate its entry points. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1782"
  },
  {
    "text": "The tool is accessible from Terminal and can be launched ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1786"
  },
  {
    "text": "by entering xcrun backgroundassets-debug. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1789"
  },
  {
    "text": "There is also help information and a man page that goes along with it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1792"
  },
  {
    "text": "When using backgroundassets-debug, you pass in a simulate argument ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1796"
  },
  {
    "text": "that provides the ability to trigger different types of BAContentRequests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1799"
  },
  {
    "text": "When any of these simulation messages are sent to the device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1803"
  },
  {
    "text": "your extension's runtime is reset to help ease your debugging. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1806"
  },
  {
    "text": "backgroundassets-debug provides numerous features, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1811"
  },
  {
    "text": "including support for multiple devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1813"
  },
  {
    "text": "As long as the device is paired with your Mac, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1816"
  },
  {
    "text": "it can be used to simulate your extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1818"
  },
  {
    "text": "These commands may be sent over Bluetooth or Wi-Fi ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1821"
  },
  {
    "text": "so that your device doesn't have to be tethered to your Mac via USB. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1823"
  },
  {
    "text": "Lastly, Developer Mode must be turned on in order for the device ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1828"
  },
  {
    "text": "to honor simulation events triggered by backgroundassets-debug. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1831"
  },
  {
    "text": "This can be easily enabled from the Privacy & Security section ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1835"
  },
  {
    "text": "within your device's Settings app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1838"
  },
  {
    "text": "Now let's take a look at using the backgroundassets-debug tool ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1841"
  },
  {
    "text": "with the demo app we just built. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1844"
  },
  {
    "text": "Here we are in Terminal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1847"
  },
  {
    "text": "Since Xcode is installed on this Mac, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1849"
  },
  {
    "text": "I'll go ahead and list the connected devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1850"
  },
  {
    "text": "You'll see that there is currently only one connected device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1853"
  },
  {
    "text": "and that happens to be my iPhone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1856"
  },
  {
    "text": "You'll want to copy the device's UUID that you are choosing to simulate against. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1858"
  },
  {
    "text": "In the arguments provided, you see that the device's UUID is present ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1863"
  },
  {
    "text": "along with the app's bundle identifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1867"
  },
  {
    "text": "I'll be invoking the tool using the simulate argument ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1869"
  },
  {
    "text": "mixed with the app-install argument. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1871"
  },
  {
    "text": "This will cause the app extension to wake ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1873"
  },
  {
    "text": "as if it's being awoken during an initial app-install event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1875"
  },
  {
    "text": "Now that I've pressed enter, the tool tells you ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1879"
  },
  {
    "text": "that the app-install event has been sent to the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1881"
  },
  {
    "text": "Let's launch the app and see what it looks like.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1884"
  },
  {
    "text": "As you can see, all of the session videos have been enqueued for download. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1890"
  },
  {
    "text": "Some of them, as I'm speaking, have already finished downloading. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1893"
  },
  {
    "text": "And that's Background Assets in action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1896"
  },
  {
    "text": "If you're like me, you've probably already started thinking ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1899"
  },
  {
    "text": "about the many potential ways to reduce waiting in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1901"
  },
  {
    "text": "Now that I showed you how to debug your app extension, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1905"
  },
  {
    "text": "let's take a look at some important things to remember.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1907"
  },
  {
    "text": "Essential assets download with the app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1911"
  },
  {
    "text": "and contribute to app installation progress. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1913"
  },
  {
    "text": "Therefore, these types of assets are only schedulable ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1916"
  },
  {
    "text": "during a BAContentRequest install or update event within the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1919"
  },
  {
    "text": "If any essential downloads that were enqueued by the extension fail, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1924"
  },
  {
    "text": "the app will eventually still become launchable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1927"
  },
  {
    "text": "You must ensure that you re-enqueue your essential downloads as nonessential ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1930"
  },
  {
    "text": "either within the extension or on first app launch ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1933"
  },
  {
    "text": "if you require those assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1936"
  },
  {
    "text": "Any downloads not marked as essential are downloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1938"
  },
  {
    "text": "after the app is installed or updated and receive background download priority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1941"
  },
  {
    "text": "It's also important to remember ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1946"
  },
  {
    "text": "that the extension is limited by its memory usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1947"
  },
  {
    "text": "So make sure to debug your extension to ensure that the code you write ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1950"
  },
  {
    "text": "is well below the memory threshold. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1953"
  },
  {
    "text": "If your extension uses excessive memory, you will notice that it will crash ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1955"
  },
  {
    "text": "with a memory exception while debugging. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1959"
  },
  {
    "text": "If the extension crashes during an app install ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1961"
  },
  {
    "text": "or app update content request, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1964"
  },
  {
    "text": "then the app will become immediately launchable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1966"
  },
  {
    "text": "And finally, remember to make your app a good citizen ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1969"
  },
  {
    "text": "by managing the assets it downloads appropriately. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1971"
  },
  {
    "text": "One way to manage those assets is by placing them ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1974"
  },
  {
    "text": "into your app's caches directory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1977"
  },
  {
    "text": "So that's what we have this year for Background Assets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1979"
  },
  {
    "text": "If there's anything you should take away from this session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1981"
  },
  {
    "text": "it's to eliminate waiting in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1984"
  },
  {
    "text": "One way you can eliminate waiting is by adopting Background Assets ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1986"
  },
  {
    "text": "and using the new essential assets feature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1990"
  },
  {
    "text": "Make sure to utilize TestFlight before submitting the app to the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1992"
  },
  {
    "text": "By using TestFlight, you'll be able to see what it looks like ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1996"
  },
  {
    "text": "when your essential assets download with your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=1999"
  },
  {
    "text": "If at any point you find yourself with questions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2002"
  },
  {
    "text": "please check out the developer documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2004"
  },
  {
    "text": "and feel free to reach out on the Apple Developer Forums. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2006"
  },
  {
    "text": "I'd also like to encourage you to utilize Feedback Assistant. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2009"
  },
  {
    "text": "Our team is constantly improving Background Assets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2012"
  },
  {
    "text": "and we're looking forward to having you adopt it into your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2015"
  },
  {
    "text": "Oh, and if you haven't already, I'd recommend checking out ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2018"
  },
  {
    "text": "my prior session where Background Assets was introduced. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2021"
  },
  {
    "text": "There's a lot of additional information in there. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2024"
  },
  {
    "text": "And with that, thanks for joining me today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2027"
  },
  {
    "text": "On behalf of everyone at Apple, thanks for watching.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10108/?time=2029"
  }
]