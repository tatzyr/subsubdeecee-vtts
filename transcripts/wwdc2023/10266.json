[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=1"
  },
  {
    "text": "Robert: Hello My name is Robert Kendall-Kuppe and today I’ll be ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=10"
  },
  {
    "text": "talking to you about a new macOS feature we’re calling \"environment constraints.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=13"
  },
  {
    "text": "Feature-rich Mac apps are often more than just one process or file. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=18"
  },
  {
    "text": "Frameworks and libraries allow you to reuse code across your apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=22"
  },
  {
    "text": "or from other developers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=27"
  },
  {
    "text": "Helper tools, helper apps, and XPC services ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=30"
  },
  {
    "text": "allow you to split work up to reduce attack surface. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=32"
  },
  {
    "text": "Launch agents, launch daemons, and login items ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=36"
  },
  {
    "text": "allow you to do work in the background or at user login. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=38"
  },
  {
    "text": "And app extensions allow you to provide useful functionality in other apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=42"
  },
  {
    "text": "But your apps run in a potentially hostile environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=48"
  },
  {
    "text": "App architects need to consider the potential effects ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=51"
  },
  {
    "text": "of unknown software running alongside their software or using their frameworks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=53"
  },
  {
    "text": "Could execution of your helper tool or XPC service give an attacker access ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=58"
  },
  {
    "text": "to your keychain data? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=62"
  },
  {
    "text": "What about your iCloud data or some other privilege? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=64"
  },
  {
    "text": "What could happen if unexpected code was injected into your process? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=67"
  },
  {
    "text": "Just like in real parent-child relationships, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=72"
  },
  {
    "text": "parent processes have a huge amount of influence over how a child behaves. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=75"
  },
  {
    "text": "On macOS, the power to posix_spawn another process ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=80"
  },
  {
    "text": "gives the parent the ability to control nearly all input to the child. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=83"
  },
  {
    "text": "The parent process can also limit the child’s access to system resources. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=87"
  },
  {
    "text": "This level of control can cause the child to load unexpected code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=92"
  },
  {
    "text": "to run unexpected features, or to behave in ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=96"
  },
  {
    "text": "that make the process more vulnerable to attack. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=99"
  },
  {
    "text": "Beyond the parent-child relationship, though, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=102"
  },
  {
    "text": "processes place trust in the disk layout in which they spawn. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=104"
  },
  {
    "text": "Malicious processes that can modify files on disk may be able to ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=108"
  },
  {
    "text": "feed unexpected data to a victim process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=113"
  },
  {
    "text": "remove runtime protections from a victim process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=115"
  },
  {
    "text": "gain persistent execution on the system, or steal the privileges of a process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=118"
  },
  {
    "text": "In the face of all those threats, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=125"
  },
  {
    "text": "macOS provides you with tools to secure your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=126"
  },
  {
    "text": "In particular, you can adopt the App Sandbox ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=129"
  },
  {
    "text": "to limit the impact if your app is compromised. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=132"
  },
  {
    "text": "And you can adopt Hardened Runtime and library validation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=134"
  },
  {
    "text": "to protect the integrity of your processes at run time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=137"
  },
  {
    "text": "Gatekeeper and Notarization also help to keep customer systems free ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=140"
  },
  {
    "text": "of known malicious code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=143"
  },
  {
    "text": "Thinking about the threats I mentioned before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=146"
  },
  {
    "text": "we realized that our existing protections focus on running processes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=148"
  },
  {
    "text": "rather than their execution environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=152"
  },
  {
    "text": "That's why we’re introducing environment constraints. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=154"
  },
  {
    "text": "Environment constraints give you a new level of control ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=158"
  },
  {
    "text": "over the circumstances under which your processes can run ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=160"
  },
  {
    "text": "and the ways you can mix code in a process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=163"
  },
  {
    "text": "In the remainder of this talk, we’ll discuss how environment constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=168"
  },
  {
    "text": "fit into the security architecture of macOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=172"
  },
  {
    "text": "how environment constraints are structured, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=175"
  },
  {
    "text": "and how you can adopt environment constraints in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=178"
  },
  {
    "text": "Let’s take a step back for a moment and talk about the macOS security stack. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=182"
  },
  {
    "text": "By default, macOS leverages all these technologies ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=187"
  },
  {
    "text": "to secure the boot chain, ensure the integrity of the OS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=190"
  },
  {
    "text": "enforce privilege separation, and protect users from malicious software. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=193"
  },
  {
    "text": "In macOS Ventura, we started using environment constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=199"
  },
  {
    "text": "to better protect the relationships between operating system processes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=202"
  },
  {
    "text": "They provide a new dimension of security for the OS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=205"
  },
  {
    "text": "In macOS Sonoma, we’ve expanded our use of environment constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=208"
  },
  {
    "text": "and opened them up for you to use in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=212"
  },
  {
    "text": "So what are environment constraints? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=215"
  },
  {
    "text": "Fundamentally, they are a way to describe code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=218"
  },
  {
    "text": "not just what the code is, but how the code is expected to exist ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=221"
  },
  {
    "text": "and run on the system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=224"
  },
  {
    "text": "In macOS, we use environment constraints for a variety of purposes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=227"
  },
  {
    "text": "For example, to help ensure processes are using trusted bundle resources, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=230"
  },
  {
    "text": "we require OS processes to run from the Signed System Volume. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=235"
  },
  {
    "text": "To ensure that privileged daemons ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=240"
  },
  {
    "text": "aren’t run with unexpected arguments or Mach ports, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=242"
  },
  {
    "text": "we require that system daemons be run only based on their protected launchd.plist. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=244"
  },
  {
    "text": "To reduce the attack surface of system apps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=250"
  },
  {
    "text": "we require that they be run from Launch Services as applications ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=253"
  },
  {
    "text": "and to ensure that user approval for background items has teeth, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=256"
  },
  {
    "text": "we use environment constraints to detect changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=260"
  },
  {
    "text": "Now you may be asking. \"Does my app need to adopt environment constraints?\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=263"
  },
  {
    "text": "I want to emphasize that environment constraints are completely optional, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=268"
  },
  {
    "text": "but they can reduce the attack surface of any app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=271"
  },
  {
    "text": "We’ll discuss some more specific example use cases later in this talk. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=274"
  },
  {
    "text": "I’ll note, though, that environment constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=278"
  },
  {
    "text": "may be particularly useful if your app has multiple processes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=280"
  },
  {
    "text": "or loads code signed by different developer teams. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=285"
  },
  {
    "text": "There are a few different types of environment constraints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=289"
  },
  {
    "text": "so let’s talk about launch constraints first. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=291"
  },
  {
    "text": "Launch constraints are embedded into a specific binary ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=294"
  },
  {
    "text": "and define either properties of that process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=297"
  },
  {
    "text": "properties of the processes that can be its parent, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=300"
  },
  {
    "text": "or properties of the processes that can be responsible for it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=303"
  },
  {
    "text": "We’ll refer to these properties as \"self constraints\", ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=307"
  },
  {
    "text": "\"parent process constraints\", and \"responsible process constraints\". ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=310"
  },
  {
    "text": "You can apply all three to your binary or pick the ones that make the most sense. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=314"
  },
  {
    "text": "A process with an embedded launch constraint will not run ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=318"
  },
  {
    "text": "if any of the required properties are not satisfied. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=321"
  },
  {
    "text": "Now let's walk through some process relationships ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=326"
  },
  {
    "text": "and talk about how you can use launch constraints to secure them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=328"
  },
  {
    "text": "First assume that MyDemo.app is your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=332"
  },
  {
    "text": "You can set a self constraint on my MyDemo.app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=335"
  },
  {
    "text": "to require that it launch as an application from Launch Services. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=337"
  },
  {
    "text": "When your app requests a connection to your XPC service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=341"
  },
  {
    "text": "launchd spawns the XPC service and is the parent of that XPC service ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=345"
  },
  {
    "text": "but your app is \"responsible\" for that XPC service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=349"
  },
  {
    "text": "You could set a responsible process constraint on MyXPCDemo.xpc ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=354"
  },
  {
    "text": "to indicate that only MyDemo.app should be responsible for it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=358"
  },
  {
    "text": "If your app later uses NSTask or posix_spawn to launch a helper, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=364"
  },
  {
    "text": "then it is both the parent of and responsible for that helper. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=368"
  },
  {
    "text": "You could set a parent process constraint on MyFirstHelper ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=373"
  },
  {
    "text": "to require that only MyDemo.app can be its parent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=376"
  },
  {
    "text": "Then if the first helper posix_spawns a second helper, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=381"
  },
  {
    "text": "the first helper is the parent of the second helper, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=384"
  },
  {
    "text": "but the app is responsible for the second helper. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=387"
  },
  {
    "text": "For MySecondHelper, you could set a parent process constraint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=392"
  },
  {
    "text": "to require that it only be launched by MyFirstHelper ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=395"
  },
  {
    "text": "and you could set a responsible process constraint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=398"
  },
  {
    "text": "to require that only MyDemo.app be responsible for it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=400"
  },
  {
    "text": "You can also specify an environment constraint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=405"
  },
  {
    "text": "in your launchd plists for launch agents and launch daemons. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=408"
  },
  {
    "text": "When you register your plist using the SMAppService API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=411"
  },
  {
    "text": "the OS will enforce that only a process that meets the constraint ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=415"
  },
  {
    "text": "will be launched on behalf of your plist. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=419"
  },
  {
    "text": "This feature is useful to ensure that malicious code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=421"
  },
  {
    "text": "doesn’t gain persistent execution based on user approval ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=424"
  },
  {
    "text": "of your app’s background activities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=428"
  },
  {
    "text": "Finally, you can use library load constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=431"
  },
  {
    "text": "to specifically control the code that can load in your address space. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=433"
  },
  {
    "text": "Before library load constraints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=437"
  },
  {
    "text": "you could either adopt library validation or not. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=438"
  },
  {
    "text": "Library validation allows your process to load code that you signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=441"
  },
  {
    "text": "or code that is signed by Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=446"
  },
  {
    "text": "With library load constraints, you can describe ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=448"
  },
  {
    "text": "a less restrictive set of code than library validation would allow ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=450"
  },
  {
    "text": "while preventing arbitrary code from being loaded into your process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=454"
  },
  {
    "text": "Note, though, that you cannot exclude Apple-signed code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=458"
  },
  {
    "text": "from loading in your process and you need to specify ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=461"
  },
  {
    "text": "one or more properties to allow your own code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=464"
  },
  {
    "text": "Now that you know what environment constraints are ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=468"
  },
  {
    "text": "and how they can be used, let's discuss how they are defined. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=470"
  },
  {
    "text": "Environment constraints describe a set of conditions that code must meet. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=475"
  },
  {
    "text": "They are encoded as a dictionary where keys represent either ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=479"
  },
  {
    "text": "facts that must be true about the code or operators that indicate ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=482"
  },
  {
    "text": "a required relationship between facts or predicates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=485"
  },
  {
    "text": "At the top level, implicitly, the result of each key-value pair ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=489"
  },
  {
    "text": "is ANDed together to decide whether the constraint is satisfied. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=493"
  },
  {
    "text": "Note that because these are dictionaries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=497"
  },
  {
    "text": "each key can only appear once per dictionary level. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=499"
  },
  {
    "text": "Let's take a look at some facts you might want to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=503"
  },
  {
    "text": "On the left are the relevant environment constraint keys ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=506"
  },
  {
    "text": "and on the right is output from the codesign command. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=508"
  },
  {
    "text": "The signing-identifier key allows you to specify a string ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=511"
  },
  {
    "text": "that should be unique to a given piece of code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=515"
  },
  {
    "text": "but which stays the same across versions of that code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=517"
  },
  {
    "text": "The signing-identifier key refers to the identifier field in codesign output. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=520"
  },
  {
    "text": "The cdhash key allows you to specify a unique hash ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=526"
  },
  {
    "text": "for the code that should be allowed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=529"
  },
  {
    "text": "and the team-identifier key allows you to specify code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=532"
  },
  {
    "text": "signed by a specific development team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=534"
  },
  {
    "text": "While facts indicate specific properties of code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=537"
  },
  {
    "text": "operators can be used to logically combine sets of facts ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=540"
  },
  {
    "text": "or to define sets of acceptable values for facts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=544"
  },
  {
    "text": "As you might expect, the $and and $or operators ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=548"
  },
  {
    "text": "allow you to specify dictionaries of predicates ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=550"
  },
  {
    "text": "that will be logically combined after they are decided. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=552"
  },
  {
    "text": "The $and-array and $or-array operators exist to limit dictionary nesting ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=557"
  },
  {
    "text": "in cases where you may want to AND multiple $or predicates ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=561"
  },
  {
    "text": "or OR multiple $and predicates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=565"
  },
  {
    "text": "And finally, the $in operator allows you to specify an array ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=568"
  },
  {
    "text": "of values that will satisfy a fact. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=571"
  },
  {
    "text": "Let's walk through this example constraint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=573"
  },
  {
    "text": "On the left, we have a plist representation of the constraint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=575"
  },
  {
    "text": "On the right is pseudo-code showing what the XML means. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=579"
  },
  {
    "text": "At the top level of the plist, there is one key, $or-array. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=584"
  },
  {
    "text": "The value is an array of three tuples. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=589"
  },
  {
    "text": "Each tuple contains an operator and a dictionary ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=591"
  },
  {
    "text": "to which that operator will be applied, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=594"
  },
  {
    "text": "so that means that this constraint allows all code signed by your team identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=596"
  },
  {
    "text": "or library B signed by the second team identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=601"
  },
  {
    "text": "or library C signed by the third team identifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=606"
  },
  {
    "text": "For the first tuple, since it is a single element, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=610"
  },
  {
    "text": "we could also have used the $or operator. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=613"
  },
  {
    "text": "Now that we can define constraints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=616"
  },
  {
    "text": "let's look at how you can adopt them in your project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=618"
  },
  {
    "text": "For the purpose of this discussion, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=621"
  },
  {
    "text": "consider a main app that contains a launch agent, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=622"
  },
  {
    "text": "a helper tool, a framework that includes an XPC service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=626"
  },
  {
    "text": "and a library signed by another development team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=630"
  },
  {
    "text": "Now let's consider some potential problems that environment constraints can mitigate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=634"
  },
  {
    "text": "Perhaps you have assigned some privilege to a helper tool, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=638"
  },
  {
    "text": "like access to your keychain data or access to your iCloud container. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=642"
  },
  {
    "text": "You may want to ensure that the helper tool ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=647"
  },
  {
    "text": "can only be launched by your app and not anything else. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=649"
  },
  {
    "text": "You can ensure that only your app can launch your helper tool ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=653"
  },
  {
    "text": "by setting a parent process constraint on the helper tool. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=657"
  },
  {
    "text": "To do this, create a code requirement plist file ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=660"
  },
  {
    "text": "that requires your team identifier and the signing identifier of your main app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=663"
  },
  {
    "text": "Then add the constraint to your helper tool’s signing configuration ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=668"
  },
  {
    "text": "in the \"Launch Constraint Parent Process Plist\" setting. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=672"
  },
  {
    "text": "Let’s take a closer look. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=675"
  },
  {
    "text": "Here I have a demo project in Xcode with the properties I mentioned. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=678"
  },
  {
    "text": "MyDemo.app is the Main app target and demohelper is a helper tool. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=683"
  },
  {
    "text": "Let’s launch the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=689"
  },
  {
    "text": "When I press this button, the app spawns the helper tool, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=693"
  },
  {
    "text": "then the helper tool does some work and provides a response to the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=698"
  },
  {
    "text": "Let's look at the signature of demohelper in Terminal.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=702"
  },
  {
    "text": "We can see that it has no launch constraints set ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=712"
  },
  {
    "text": "and we can run demohelper. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=715"
  },
  {
    "text": "But look at that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=721"
  },
  {
    "text": "If we run demohelper with the --cloud argument, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=724"
  },
  {
    "text": "then demohelper can access the app’s iCloud data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=726"
  },
  {
    "text": "We don't want an arbitrary process to be able to run demohelper ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=729"
  },
  {
    "text": "and alter our iCloud data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=732"
  },
  {
    "text": "Let’s go back to Xcode and set a parent constraint on demohelper.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=736"
  },
  {
    "text": "Here I have a constraint plist file already populated ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=742"
  },
  {
    "text": "to identify the main app MyDemo.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=745"
  },
  {
    "text": "Let's add the constraint to our signing configuration.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=750"
  },
  {
    "text": "Now let’s rebuild the app.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=759"
  },
  {
    "text": "We can launch the app again...",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=765"
  },
  {
    "text": "And the main app can still spawn the helper.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=771"
  },
  {
    "text": "But when we go back to Terminal... ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=778"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=780"
  },
  {
    "text": "We can see that now demohelper has a launch constraint... ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=788"
  },
  {
    "text": "and it can no longer be run from Terminal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=794"
  },
  {
    "text": "When a launch is blocked because of a launch constraint violation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=798"
  },
  {
    "text": "a crash report is generated showing that the constraint was violated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=801"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=806"
  },
  {
    "text": "Now let's talk about a few more problems that environment constraints can mitigate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=813"
  },
  {
    "text": "We encourage you to use XPC services to separate privileges ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=816"
  },
  {
    "text": "between different processes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=820"
  },
  {
    "text": "But when you build XPC services, it is possible to extract those services ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=822"
  },
  {
    "text": "from your bundle and call them from other code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=826"
  },
  {
    "text": "If you have assigned some privilege to your XPC service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=828"
  },
  {
    "text": "you need to ensure that ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=831"
  },
  {
    "text": "only expected processes can gain access to that privilege. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=832"
  },
  {
    "text": "One way to ensure that only your code can access that XPC service ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=837"
  },
  {
    "text": "is to set a responsible process launch constraint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=841"
  },
  {
    "text": "Here we show a launch constraint plist that allows code signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=844"
  },
  {
    "text": "by your team with a list of signing identifiers for each of the processes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=847"
  },
  {
    "text": "in the bundle that should be able to access the XPC service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=851"
  },
  {
    "text": "You can add the constraint to your signing configuration ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=855"
  },
  {
    "text": "in the \"Launch Constraint Responsible Process Plist\" setting. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=857"
  },
  {
    "text": "Another problem to consider. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=862"
  },
  {
    "text": "Starting in macOS Ventura, users are asked to approve background tasks ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=864"
  },
  {
    "text": "installed on behalf of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=868"
  },
  {
    "text": "This means that users expect that work to happen only on behalf of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=870"
  },
  {
    "text": "If an attacker can replace the code that your plist expects to run, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=874"
  },
  {
    "text": "the attacker may gain persistent background execution ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=878"
  },
  {
    "text": "on behalf of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=880"
  },
  {
    "text": "To ensure that your registered plist can only be used to run the code you expect, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=882"
  },
  {
    "text": "you can set a launchd plist constraint using the SpawnConstraint key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=886"
  },
  {
    "text": "Here you can see a complete launchd plist with a SpawnConstraint key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=891"
  },
  {
    "text": "This constraint identifies our team and the DemoMenuBar agent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=896"
  },
  {
    "text": "Finally, let's talk about library loading. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=902"
  },
  {
    "text": "If you are obligated to link a library from another development team ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=904"
  },
  {
    "text": "without modification, then to get your app notarized ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=907"
  },
  {
    "text": "with hardened runtime, you'll have to adopt ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=910"
  },
  {
    "text": "the disable-library-validation entitlement. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=912"
  },
  {
    "text": "Unfortunately, that means your app can now load code signed by anyone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=916"
  },
  {
    "text": "not just the trusted developer you got the library from. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=920"
  },
  {
    "text": "To address this problem, you can adopt a library load constraint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=923"
  },
  {
    "text": "Here we show a constraint that will allow you to load any code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=927"
  },
  {
    "text": "signed by your team or the trusted library supplier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=930"
  },
  {
    "text": "You could also constrain this further to a specific library ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=933"
  },
  {
    "text": "or set of libraries using one or more signing-identifier facts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=936"
  },
  {
    "text": "As with launch constraints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=940"
  },
  {
    "text": "library load constraints get signed in to your process ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=942"
  },
  {
    "text": "when you set the \"Library Load Constraint Plist\" setting ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=945"
  },
  {
    "text": "in your Xcode signing configuration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=947"
  },
  {
    "text": "So where are environment constraints available? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=951"
  },
  {
    "text": "Library load constraints and launchd plist constraints ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=953"
  },
  {
    "text": "can be included in apps targeting any macOS version. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=956"
  },
  {
    "text": "They are enforced starting in macOS Sonoma. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=959"
  },
  {
    "text": "Launch constraints can be added to apps targeting macOS 13.3 or later ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=962"
  },
  {
    "text": "and they are enforced starting in macOS 13.3. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=967"
  },
  {
    "text": "Note the supported set of keys and values that can be used ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=970"
  },
  {
    "text": "in environment constraints may change across macOS versions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=973"
  },
  {
    "text": "Refer to the documentation for complete availability information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=977"
  },
  {
    "text": "Take a look at the process relationships, launchd plists, and libraries in your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=981"
  },
  {
    "text": "to see if you can use environment constraints to make your app more secure. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=986"
  },
  {
    "text": "Thanks for watching. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=990"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10266/?time=992"
  }
]