[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=0"
  },
  {
    "text": "Nikolas: Hello and welcome to \"Support external cameras in your iPadOS app.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=10"
  },
  {
    "text": "I'm Nikolas Gelo from the Camera Software team, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=14"
  },
  {
    "text": "and this session about how your iPad app can start using external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=17"
  },
  {
    "text": "Stage Manager's powerful set of features include the ability ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=21"
  },
  {
    "text": "to extend your iPad's display across multiple screens. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=24"
  },
  {
    "text": "And with iPadOS 17, your app can start using external cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=28"
  },
  {
    "text": "such as the one in the Apple Studio Display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=32"
  },
  {
    "text": "On this iPad Pro, FaceTime is open, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=35"
  },
  {
    "text": "and it's using the camera in the display that it's connected to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=38"
  },
  {
    "text": "This is great because now the people on the other side of the call ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=41"
  },
  {
    "text": "have a better viewing angle of me when I run the app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=44"
  },
  {
    "text": "on this big Apple Studio Display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=46"
  },
  {
    "text": "I can also use Center Stage with it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=49"
  },
  {
    "text": "which helps keep me in the frame as I move around.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=51"
  },
  {
    "text": "FaceTime, Code Scanner, and WebKit use external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=58"
  },
  {
    "text": "and they are great examples of what your app can do. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=62"
  },
  {
    "text": "When using monitors that don't have built-in cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=65"
  },
  {
    "text": "like the Apple Pro Display XDR, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=67"
  },
  {
    "text": "people often place a USB camera on top of it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=69"
  },
  {
    "text": "If the USB camera is connected to the monitor, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=72"
  },
  {
    "text": "then when the monitor is plugged into the iPad, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=75"
  },
  {
    "text": "the camera will also be available to your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=78"
  },
  {
    "text": "Your iPad app can use external cameras and webcams ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=81"
  },
  {
    "text": "to take photos and record movies. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=84"
  },
  {
    "text": "They also support other system camera features, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=86"
  },
  {
    "text": "like the Portrait Blur and Studio Light video effects ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=88"
  },
  {
    "text": "available from Control Center.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=91"
  },
  {
    "text": "iPads with USB-C connectors support external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=94"
  },
  {
    "text": "Your app can use devices that conform to the USB Video Class, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=98"
  },
  {
    "text": "or UVC, specification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=102"
  },
  {
    "text": "It defines a standard for USB devices to support video streaming. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=104"
  },
  {
    "text": "And there are many popular cameras your app can use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=109"
  },
  {
    "text": "Some external cameras have built-in microphones, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=112"
  },
  {
    "text": "which are also available to your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=115"
  },
  {
    "text": "Some manufacturers make non-camera devices that conform to the UVC spec, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=117"
  },
  {
    "text": "like HDMI switchers that change between multiple inputs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=121"
  },
  {
    "text": "to output a single video stream. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=125"
  },
  {
    "text": "iPadOS allows your app to use devices like these. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=127"
  },
  {
    "text": "External camera support is a great enhancement ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=131"
  },
  {
    "text": "to iPad's rich media ecosystem. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=134"
  },
  {
    "text": "I'll show how your app can use them by starting with discovery and usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=136"
  },
  {
    "text": "Next, I'll circle back and demystify video rotation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=141"
  },
  {
    "text": "Then I'll cover how your app can use microphones ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=145"
  },
  {
    "text": "that are included with external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=148"
  },
  {
    "text": "And lastly, I'll discuss best practices for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=150"
  },
  {
    "text": "First up, I'll discuss how your iPad app can start using external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=154"
  },
  {
    "text": "iPad apps use the camera for many features, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=159"
  },
  {
    "text": "like taking photos, recording movies, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=161"
  },
  {
    "text": "or sending camera frames over the network for video calls. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=164"
  },
  {
    "text": "The AVFoundation framework allows your app to use built-in and external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=167"
  },
  {
    "text": "specifically, with its AVCapture-prefixed classes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=172"
  },
  {
    "text": "Let's review how an app can use the camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=176"
  },
  {
    "text": "First, an app uses AVCaptureDevices, which represent cameras and microphones. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=179"
  },
  {
    "text": "Then they are wrapped in AVCaptureDeviceInputs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=184"
  },
  {
    "text": "which allow them to be plugged into an AVCaptureSession. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=188"
  },
  {
    "text": "The AVCaptureSession is the central control object of the AVCapture graph.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=191"
  },
  {
    "text": "AVCaptureOutputs render data from inputs in various ways. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=196"
  },
  {
    "text": "The MovieFileOutput records QuickTime movies. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=200"
  },
  {
    "text": "The PhotoOutput captures high-quality stills and Live Photos. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=203"
  },
  {
    "text": "Data outputs, such as the VideoDataOutput or AudioDataOutput, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=207"
  },
  {
    "text": "deliver video or audio buffers from the camera or mic to your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=211"
  },
  {
    "text": "And there are other kinds of data outputs, such as Metadata and Depth. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=217"
  },
  {
    "text": "For live camera preview, there's a special type of output, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=222"
  },
  {
    "text": "the AVCaptureVideoPreviewLayer, which is a subclass of CALayer.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=225"
  },
  {
    "text": "Data flows from the capture inputs to compatible outputs ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=230"
  },
  {
    "text": "through AVCaptureConnections. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=234"
  },
  {
    "text": "These classes are available on iOS, macOS, and tvOS.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=236"
  },
  {
    "text": "If you're new to AVCapture, I invite you to learn more ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=242"
  },
  {
    "text": "at the Capture Setup start page on developer.apple.com.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=245"
  },
  {
    "text": "New in iPadOS 17, your app can access external cameras with AVCapture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=250"
  },
  {
    "text": "If your app already uses built-in cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=256"
  },
  {
    "text": "you can make simple updates to start using external ones. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=258"
  },
  {
    "text": "Discovering them is easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=261"
  },
  {
    "text": "Each external camera is represented by an AVCaptureDevice instance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=263"
  },
  {
    "text": "And you can find them with existing API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=268"
  },
  {
    "text": "from AVCaptureDevice and AVCaptureDeviceDiscoverySession. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=270"
  },
  {
    "text": "There are three main attributes of an AVCaptureDevice: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=275"
  },
  {
    "text": "Its media type, device type, and position. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=278"
  },
  {
    "text": "External cameras provide video media data just like built-in cameras do. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=282"
  },
  {
    "text": "And their device type is external. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=286"
  },
  {
    "text": "For macOS app developers who are familiar with using external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=289"
  },
  {
    "text": "this deprecates the external unknown device type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=293"
  },
  {
    "text": "Because external cameras can move independently from the iPad, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=297"
  },
  {
    "text": "their device position is unspecified. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=301"
  },
  {
    "text": "These three attributes can be used ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=304"
  },
  {
    "text": "to find external cameras with the AVCapture API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=306"
  },
  {
    "text": "It's easy to start using external cameras in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=310"
  },
  {
    "text": "In this session, I'll modify the popular sample camera app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=313"
  },
  {
    "text": "AVCam, to stream from the external camera in an Apple Studio Display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=316"
  },
  {
    "text": "You can download the completed version of AVCam with all of the changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=321"
  },
  {
    "text": "I make in this session from developer.apple.com.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=325"
  },
  {
    "text": "Currently, the app uses built-in cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=329"
  },
  {
    "text": "and it lets the user switch between a front and rear-facing camera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=332"
  },
  {
    "text": "when a button is pressed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=334"
  },
  {
    "text": "When AVCam launches, it starts with a rear-facing camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=336"
  },
  {
    "text": "I'll change the code to have the app prefer looking ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=340"
  },
  {
    "text": "for an external camera before a built-in one.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=342"
  },
  {
    "text": "With the iPad connected to the Apple Studio Display, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=348"
  },
  {
    "text": "I'll run the app, and when it launches, it will use the external camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=351"
  },
  {
    "text": "This is great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=358"
  },
  {
    "text": "AVCam is now using an external camera, and all it needed was a few lines of code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=359"
  },
  {
    "text": "The AVCaptureVideoPreviewLayer mirrors external cameras by default, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=364"
  },
  {
    "text": "which is suitable for using the camera in the Apple Studio Display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=368"
  },
  {
    "text": "You can disable this behavior if you prefer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=371"
  },
  {
    "text": "I'll describe how to do this in the best practices section ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=374"
  },
  {
    "text": "at the end of this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=377"
  },
  {
    "text": "Now I'll move the app to the iPad's display.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=379"
  },
  {
    "text": "And just for fun, I'll unplug the external camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=384"
  },
  {
    "text": "Uh-oh, the app's camera preview is frozen, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=389"
  },
  {
    "text": "and it's not using any camera now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=392"
  },
  {
    "text": "AVCam will need more changes to handle connection and disconnection events ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=395"
  },
  {
    "text": "of external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=398"
  },
  {
    "text": "External cameras require special care because, unlike built-in ones, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=400"
  },
  {
    "text": "the user can connect and disconnect them from the iPad at any time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=404"
  },
  {
    "text": "Your app can monitor these events to know when a camera has become available ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=408"
  },
  {
    "text": "or can no longer be used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=412"
  },
  {
    "text": "If the same physical device is reconnected, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=414"
  },
  {
    "text": "it will be represented using a new instance of AVCaptureDevice. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=417"
  },
  {
    "text": "There is existing API your app can use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=421"
  },
  {
    "text": "to listen for connection and disconnection events.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=424"
  },
  {
    "text": "You can key-value observe the isConnected property on AVCaptureDevice ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=428"
  },
  {
    "text": "or the devices property on an AVCaptureDeviceDiscoverySession ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=433"
  },
  {
    "text": "that updates as cameras come and go. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=438"
  },
  {
    "text": "AVCaptureDevices also post notifications when their connection status changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=441"
  },
  {
    "text": "and your app can observe them to monitor a camera's availability. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=445"
  },
  {
    "text": "The system calls key value observation code ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=450"
  },
  {
    "text": "and posts notifications on background queues. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=452"
  },
  {
    "text": "So be sure to synchronize your handling ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=455"
  },
  {
    "text": "with your AVCaptureSession queue and the main thread.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=457"
  },
  {
    "text": "Going back to AVCam, I'll add some code to listen ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=462"
  },
  {
    "text": "for connection and disconnection events of an external camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=464"
  },
  {
    "text": "After the app looks for the default device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=468"
  },
  {
    "text": "it observes when the camera is disconnected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=471"
  },
  {
    "text": "And when that happens, AVCam switches to a built-in camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=474"
  },
  {
    "text": "Now when the app launches, it still uses an external camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=478"
  },
  {
    "text": "And when it disconnects, the app switches to a built-in camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=482"
  },
  {
    "text": "But when the external camera is reconnected, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=490"
  },
  {
    "text": "AVCam doesn't switch to it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=492"
  },
  {
    "text": "How should AVCam handle external cameras being connected while it's running? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=498"
  },
  {
    "text": "Should it switch to it after I've plugged it in? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=501"
  },
  {
    "text": "A tricky aspect of adopting external cameras in your iPad app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=505"
  },
  {
    "text": "is handling connection and disconnection events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=508"
  },
  {
    "text": "To make this easier, iPadOS is introducing API ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=511"
  },
  {
    "text": "for automatic camera selection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=515"
  },
  {
    "text": "The API allows your app to integrate with the operating system ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=518"
  },
  {
    "text": "to use the best available camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=521"
  },
  {
    "text": "It is another way for your app to change cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=523"
  },
  {
    "text": "macOS Ventura introduced API for automatic camera selection ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=527"
  },
  {
    "text": "to support Continuity Camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=531"
  },
  {
    "text": "The behaviors I describe in this session are specific to iOS.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=533"
  },
  {
    "text": "For more information on how to use this API for Mac, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=538"
  },
  {
    "text": "see our previous session \"Bringing Continuity Camera to your macOS app\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=540"
  },
  {
    "text": "from 2022 and its section \"Building a magical experience.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=545"
  },
  {
    "text": "Automatic camera selection works by using two new class properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=551"
  },
  {
    "text": "introduced to AVCaptureDevice on iOS: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=554"
  },
  {
    "text": "userPreferredCamera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=557"
  },
  {
    "text": "and systemPreferredCamera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=560"
  },
  {
    "text": "Both of these properties are key-value observable.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=563"
  },
  {
    "text": "userPreferredCamera is a read/write property ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=567"
  },
  {
    "text": "that indicates the user's choice of what camera should be used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=569"
  },
  {
    "text": "It should be set whenever a user picks a camera in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=573"
  },
  {
    "text": "Doing so allows the system to learn the user's preference.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=577"
  },
  {
    "text": "systemPreferredCamera is a read-only property ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=583"
  },
  {
    "text": "which specifies the best camera to use as determined by the system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=585"
  },
  {
    "text": "By default, the system recommends using the front camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=590"
  },
  {
    "text": "but if you would like to use a back camera instead, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=594"
  },
  {
    "text": "your app can inform the system of its desired behavior. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=597"
  },
  {
    "text": "As different cameras are chosen by the user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=600"
  },
  {
    "text": "the recommendation changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=602"
  },
  {
    "text": "But you might be wondering how the system know which camera is best. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=604"
  },
  {
    "text": "I'll dive into that in a bit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=608"
  },
  {
    "text": "I'll first describe AVCaptureDevice's userPreferredCamera property. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=609"
  },
  {
    "text": "For this property, the system stores a short history ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=614"
  },
  {
    "text": "of chosen cameras for each app across launches and system reboots. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=617"
  },
  {
    "text": "It allows your app to combine the user's history ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=622"
  },
  {
    "text": "with the system's knowledge of which cameras are currently connected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=625"
  },
  {
    "text": "So if a camera is disconnected, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=629"
  },
  {
    "text": "the system returns the next available camera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=632"
  },
  {
    "text": "based on the user's history.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=634"
  },
  {
    "text": "If there is no user selection history, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=637"
  },
  {
    "text": "or none of the preferred cameras are connected, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=639"
  },
  {
    "text": "the system will always try to return a camera that's ready to use ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=642"
  },
  {
    "text": "and prioritize cameras that have been previously streamed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=645"
  },
  {
    "text": "Your app can use this property to let the system store ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=649"
  },
  {
    "text": "your user's camera preference.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=651"
  },
  {
    "text": "AVCaptureDevice's systemPreferredCamera property ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=655"
  },
  {
    "text": "intelligently returns the best camera to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=658"
  },
  {
    "text": "It first checks the user's preference. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=660"
  },
  {
    "text": "And when the user connects an external camera to the iPad, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=663"
  },
  {
    "text": "the system returns the new device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=666"
  },
  {
    "text": "This is because, when a user connects a new camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=669"
  },
  {
    "text": "they're implicitly indicating their intent to use it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=672"
  },
  {
    "text": "These two inputs determine the system preferred camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=675"
  },
  {
    "text": "The automatic camera selection API is flexible for an app ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=680"
  },
  {
    "text": "to choose how it integrates with the system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=683"
  },
  {
    "text": "While only iPad supports external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=686"
  },
  {
    "text": "iPhone apps can also use the API for its user preferred camera storage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=689"
  },
  {
    "text": "Some apps allow users to change cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=693"
  },
  {
    "text": "while others stick to one without giving a way to switch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=695"
  },
  {
    "text": "The API allows apps to choose between automatic and manual camera selection.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=699"
  },
  {
    "text": "FaceTime, Code Scanner, and WebKit are great examples ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=705"
  },
  {
    "text": "that have different camera selection behaviors to suit their needs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=708"
  },
  {
    "text": "When FaceTime launches, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=712"
  },
  {
    "text": "it always uses the front or external camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=714"
  },
  {
    "text": "And during calls, it allows users to switch between built-in cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=717"
  },
  {
    "text": "But when an external camera is used, it hides the camera switch button. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=721"
  },
  {
    "text": "FaceTime enables this behavior by setting userPreferredCamera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=726"
  },
  {
    "text": "when it switches devices and observing the systemPreferredCamera property ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=729"
  },
  {
    "text": "for when an external device is plugged in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=734"
  },
  {
    "text": "It also makes its own decisions for when it is appropriate ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=737"
  },
  {
    "text": "to use the automatic camera selection API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=740"
  },
  {
    "text": "For example, while you can use the back camera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=743"
  },
  {
    "text": "in a FaceTime Video call, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=745"
  },
  {
    "text": "it always uses the front or external camera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=747"
  },
  {
    "text": "on the main screen that shows the list of calls. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=749"
  },
  {
    "text": "Code Scanner, available from Control Center, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=752"
  },
  {
    "text": "has different behavior. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=755"
  },
  {
    "text": "It uses the back-facing camera when it launches, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=756"
  },
  {
    "text": "and it doesn't allow the user to change cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=759"
  },
  {
    "text": "but it does listen to the systemPreferredCamera property ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=762"
  },
  {
    "text": "and switches when notified. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=765"
  },
  {
    "text": "The WebKit framework allows webpages to access the iPad's cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=768"
  },
  {
    "text": "While it allows switching to any camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=773"
  },
  {
    "text": "it returns the system preferred camera as the first one in its list. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=775"
  },
  {
    "text": "Now that I've shown you how automatic camera selection works, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=779"
  },
  {
    "text": "I'll add support for it in AVCam. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=782"
  },
  {
    "text": "AVCam is a traditional photography app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=784"
  },
  {
    "text": "since you can take photos and record movies with it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=787"
  },
  {
    "text": "It's different from FaceTime and Code Scanner, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=790"
  },
  {
    "text": "which are communication and utility apps, respectively, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=792"
  },
  {
    "text": "and WebKit, which is a system framework. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=796"
  },
  {
    "text": "Now instead of needing a series of \"if, else if\" statements ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=799"
  },
  {
    "text": "to find the external camera with fallbacks, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=802"
  },
  {
    "text": "AVCam just needs one line to get the system preferred camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=805"
  },
  {
    "text": "Since this is the first time the app is using the automatic camera selection API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=809"
  },
  {
    "text": "the system returns the built-in front camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=813"
  },
  {
    "text": "But AVCam prefers to continue starting with the back camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=815"
  },
  {
    "text": "Before it gets the system preferred camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=819"
  },
  {
    "text": "the app checks if this is the first time it has queried for it ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=821"
  },
  {
    "text": "by looking for a value stored in the app's user defaults. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=824"
  },
  {
    "text": "If no value is saved, then the app hasn't set its initial state ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=828"
  },
  {
    "text": "for automatic camera selection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=831"
  },
  {
    "text": "So if this is the first time launching, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=834"
  },
  {
    "text": "the app sets the user preferred camera to be the back device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=836"
  },
  {
    "text": "The app finds the back camera using an AVCaptureDeviceDiscoverySession, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=840"
  },
  {
    "text": "which sorts the list of the devices using the provided device types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=844"
  },
  {
    "text": "Then it sets the user preferred camera and saves a value ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=848"
  },
  {
    "text": "in the app's user preferences, so it only does this setup once.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=851"
  },
  {
    "text": "To handle connections and disconnections of external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=856"
  },
  {
    "text": "it doesn't have to observe the connection status of a specific camera anymore. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=859"
  },
  {
    "text": "Instead, AVCam key value observes the system preferred camera property. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=864"
  },
  {
    "text": "This allows it to automatically switch to the best available camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=869"
  },
  {
    "text": "In its KVO handling, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=873"
  },
  {
    "text": "the app gets the new system preferred camera and switches to it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=875"
  },
  {
    "text": "but what if AVCam is in the middle of a recording? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=879"
  },
  {
    "text": "The app shouldn't interrupt the recording by switching cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=881"
  },
  {
    "text": "So the app only switches if it is not in the middle of a recording. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=885"
  },
  {
    "text": "Then when the movie recording finishes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=889"
  },
  {
    "text": "the app queries for the system preferred camera ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=891"
  },
  {
    "text": "to see if it is different from what it is currently using. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=893"
  },
  {
    "text": "If the system preferred camera did change, the app switches to it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=897"
  },
  {
    "text": "This way it doesn't interrupt the recording. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=901"
  },
  {
    "text": "Decisions like these are steps you'll have to make ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=904"
  },
  {
    "text": "when adopting external cameras and the automatic camera selection API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=906"
  },
  {
    "text": "Do what makes the most sense for your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=910"
  },
  {
    "text": "AVCam has a button to switch cameras and behaves by changing ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=913"
  },
  {
    "text": "between front and back devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=917"
  },
  {
    "text": "On this iPad Pro, there are multiple cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=919"
  },
  {
    "text": "that can be used at both positions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=922"
  },
  {
    "text": "So AVCam has some logic for choosing which camera to use at a given position. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=924"
  },
  {
    "text": "How should the button work now that the app supports external cameras? ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=929"
  },
  {
    "text": "I'll choose to treat an external camera like it is front-facing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=933"
  },
  {
    "text": "The camera in this Apple Studio Display is facing me ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=937"
  },
  {
    "text": "like the iPad's built-in front camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=940"
  },
  {
    "text": "If the changeCamera function has no specific device to switch to, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=943"
  },
  {
    "text": "the app checks the position of the current device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=947"
  },
  {
    "text": "In the switch statement that checks the current device's position, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=950"
  },
  {
    "text": "the app looks for a rear-facing camera if it is currently using one ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=953"
  },
  {
    "text": "with an unspecified or front position. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=956"
  },
  {
    "text": "External cameras report that their position is unspecified. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=959"
  },
  {
    "text": "And if the app is using a rear-facing camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=963"
  },
  {
    "text": "it switches to an external device if one is available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=966"
  },
  {
    "text": "Otherwise, it switches to a built-in front facing camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=970"
  },
  {
    "text": "To find external cameras, the app creates ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=974"
  },
  {
    "text": "a AVCaptureDeviceDiscoverySession using the external device type, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=977"
  },
  {
    "text": "the video media type, and unspecified device position.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=981"
  },
  {
    "text": "Then in the switch statement when the current device's position is back, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=987"
  },
  {
    "text": "it first looks for an external camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=992"
  },
  {
    "text": "And if one is not found, it switches to a built-in front facing camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=994"
  },
  {
    "text": "Then when the app finds the camera it would like to use, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=999"
  },
  {
    "text": "it tells the system of the selection ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1002"
  },
  {
    "text": "by setting the userPreferredCamera class property on AVCaptureDevice. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1005"
  },
  {
    "text": "Setting this property allows the system to learn the user's preferences.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1010"
  },
  {
    "text": "You can choose how your app will support external cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1015"
  },
  {
    "text": "and how to allow a user to switch between them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1017"
  },
  {
    "text": "For AVCam, I chose to allow a user to switch ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1020"
  },
  {
    "text": "between front, back, and external cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1023"
  },
  {
    "text": "by treating external cameras like they are front-facing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1026"
  },
  {
    "text": "This way, the camera switch button only changes between two devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1029"
  },
  {
    "text": "AVCam is almost ready to support external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1033"
  },
  {
    "text": "There is just one more aspect to handle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1036"
  },
  {
    "text": "This whole time I've been using AVCam, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1039"
  },
  {
    "text": "the iPad has been mounted in landscape with the USB-C port on the right. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1041"
  },
  {
    "text": "If I rotate the iPad, the external camera's preview is now upside down.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1044"
  },
  {
    "text": "But the external camera in the display hasn't moved. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1052"
  },
  {
    "text": "Just the iPad has.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1055"
  },
  {
    "text": "AVCam doesn't have this rotation problem with built-in cameras though. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1060"
  },
  {
    "text": "This is because the app doesn't know how to orient external cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1063"
  },
  {
    "text": "whose position is independent from the iPad. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1066"
  },
  {
    "text": "AVCam will need further modifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1070"
  },
  {
    "text": "to properly display an external camera's video preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1072"
  },
  {
    "text": "Next up, I'll discuss why video rotation is important ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1075"
  },
  {
    "text": "so that live preview and captured photos and movies appear correctly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1078"
  },
  {
    "text": "Video rotation is not a new concept for camera apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1083"
  },
  {
    "text": "But when using external cameras, it is important to know ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1086"
  },
  {
    "text": "that they move independently from the iPad. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1089"
  },
  {
    "text": "Apps are used to built-in cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1092"
  },
  {
    "text": "And because of this, they rely on the iPad's orientation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1094"
  },
  {
    "text": "to rotate the camera's video and use the AVCaptureVideoOrientation enum. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1097"
  },
  {
    "text": "This is what AVCam was doing in the previous demo. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1102"
  },
  {
    "text": "It tried rotating the external camera to match the iPad's orientation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1105"
  },
  {
    "text": "In iPadOS 17, AVCaptureVideoOrientation is deprecated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1110"
  },
  {
    "text": "as well as the API that use this enum. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1114"
  },
  {
    "text": "It describes how the iPad is oriented ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1117"
  },
  {
    "text": "and assumes the camera rotates with the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1119"
  },
  {
    "text": "It's not expressive enough for orienting external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1122"
  },
  {
    "text": "which move independently. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1125"
  },
  {
    "text": "To use this enum, an app typically converts from UIDeviceOrientation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1127"
  },
  {
    "text": "which also describes the iPad and is an indirect signal for orienting a camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1131"
  },
  {
    "text": "So we're introducing new API to handle video rotation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1136"
  },
  {
    "text": "New to all platforms, including iPadOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1140"
  },
  {
    "text": "the AVCaptureDeviceRotationCoordinator class can help properly orient any camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1143"
  },
  {
    "text": "The class's initializer takes an AVCaptureDevice ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1148"
  },
  {
    "text": "and optionally a CALayer that displays the camera's video preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1151"
  },
  {
    "text": "Apps often use AVCaptureVideoPreviewLayer ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1156"
  },
  {
    "text": "or AVSampleBufferDisplayLayer to show camera preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1159"
  },
  {
    "text": "Both of these are subclasses of CALayer and can be passed to the initializer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1162"
  },
  {
    "text": "Apps that use Metal or other rendering methods ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1167"
  },
  {
    "text": "can simply pass the layer of the UIView displaying the camera's preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1169"
  },
  {
    "text": "The coordinator has two properties: ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1174"
  },
  {
    "text": "A video rotation angle for horizon-level preview ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1177"
  },
  {
    "text": "and a separate angle for horizon-level capture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1180"
  },
  {
    "text": "Both of these read-only properties return an angle in degrees ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1183"
  },
  {
    "text": "and are key-value observable.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1186"
  },
  {
    "text": "Previewing and capturing content horizon-level means ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1189"
  },
  {
    "text": "that the video frames from the camera are always upright ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1192"
  },
  {
    "text": "relative to gravity, no matter if the device is in portrait, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1195"
  },
  {
    "text": "landscape, or upside down.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1198"
  },
  {
    "text": "Use the videoRotationAngleForHorizonLevelPreview ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1202"
  },
  {
    "text": "to display video frames in the CALayer passed to the coordinator's initializer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1205"
  },
  {
    "text": "It describes how much rotation to apply for preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1210"
  },
  {
    "text": "The angle is relative to the UIKit and SwiftUI coordinate systems.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1214"
  },
  {
    "text": "The videoRotationAngleForHorizonLevelCapture ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1219"
  },
  {
    "text": "allows your app to take photos and movies, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1222"
  },
  {
    "text": "so they are always upright when someone views them later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1224"
  },
  {
    "text": "This property describes the physical orientation of the camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1228"
  },
  {
    "text": "And its value may be different than the angle the app needs for preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1232"
  },
  {
    "text": "These two properties have different purposes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1235"
  },
  {
    "text": "To explain video rotation, I'll start with scenarios ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1238"
  },
  {
    "text": "you are familiar with when using built-in cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1241"
  },
  {
    "text": "Later, when I modify AVCam, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1243"
  },
  {
    "text": "I'll explain how these concepts apply to external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1246"
  },
  {
    "text": "The camera app on iPhone is a good example of the differences ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1249"
  },
  {
    "text": "between the video rotation angles for horizon-level preview and capture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1252"
  },
  {
    "text": "In this example of the app displaying the back camera's preview, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1256"
  },
  {
    "text": "the iPhone is in portrait. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1259"
  },
  {
    "text": "The UIKit coordinate system's origin is at the top left of the drawing area, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1262"
  },
  {
    "text": "where its positive x-axis extends to the right ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1266"
  },
  {
    "text": "and positive y-axis extends down. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1268"
  },
  {
    "text": "The back camera sensor's coordinate system has a different origin.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1271"
  },
  {
    "text": "The camera sensor first scans along the height of the phone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1275"
  },
  {
    "text": "then along the width. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1278"
  },
  {
    "text": "To account for the physical orientation of the camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1280"
  },
  {
    "text": "the app rotates the camera's video frames 90 degrees for preview in the UI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1283"
  },
  {
    "text": "It also rotates photos and movies it captures, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1288"
  },
  {
    "text": "so they are upright when viewed later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1290"
  },
  {
    "text": "It has different behavior when the iPhone is in landscape. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1293"
  },
  {
    "text": "The app only displays the UI in portrait, no matter the device's orientation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1297"
  },
  {
    "text": "You can tell based on where the home affordance indicator is. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1302"
  },
  {
    "text": "For Camera app on iPhone, it always stays on the side with the port. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1305"
  },
  {
    "text": "The UIKit coordinate system's origin is still at the top left of the drawing area, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1310"
  },
  {
    "text": "and in this case, it stays fixed to a single location on the device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1314"
  },
  {
    "text": "since the app's UI only supports one orientation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1318"
  },
  {
    "text": "And the back camera sensor's coordinate system still differs from the UI's. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1322"
  },
  {
    "text": "Since the app only displays the UI in portrait, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1326"
  },
  {
    "text": "it applies a constant 90 degrees of rotation for preview, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1329"
  },
  {
    "text": "no matter the iPhone's orientation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1332"
  },
  {
    "text": "But unlike for preview, the app applies a different amount ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1335"
  },
  {
    "text": "of rotation when taking photos and movies when the iPhone is in landscape. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1338"
  },
  {
    "text": "When the iPhone is in the camera sensor's native orientation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1342"
  },
  {
    "text": "the app does not need to rotate photos or movies for them to appear upright. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1345"
  },
  {
    "text": "All of this talk of rotation really makes your head spin. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1351"
  },
  {
    "text": "But the AVCaptureDeviceRotationCoordinator takes care of this complexity ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1354"
  },
  {
    "text": "and provides correct angles to preview and capture from all cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1358"
  },
  {
    "text": "Rely on it to provide angles rather than trying to calculate them yourself. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1363"
  },
  {
    "text": "As your app switches cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1368"
  },
  {
    "text": "be sure to create a new rotation coordinator. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1369"
  },
  {
    "text": "To apply video rotation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1373"
  },
  {
    "text": "use the angles the coordinator provides with new API on AVCaptureConnection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1375"
  },
  {
    "text": "Only connections that deliver video or depth media data support rotation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1380"
  },
  {
    "text": "To check whether a connection supports an angle, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1385"
  },
  {
    "text": "you can call its isVideoRotationAngleSupported method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1387"
  },
  {
    "text": "To have the connection perform rotation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1391"
  },
  {
    "text": "set its videoRotationAngle property to a supported value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1393"
  },
  {
    "text": "Use videoRotationAngleForHorizonLevelPreview ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1397"
  },
  {
    "text": "to display the camera preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1400"
  },
  {
    "text": "Apps using AVCaptureVideoPreviewLayer can apply the property's value ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1402"
  },
  {
    "text": "to an AVCaptureConnection instance's videoRotationAngle property. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1406"
  },
  {
    "text": "Apps can also use it when displaying buffers ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1411"
  },
  {
    "text": "from a video data output in a CALayer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1413"
  },
  {
    "text": "To synchronize with system animations, change the preview rotation immediately ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1416"
  },
  {
    "text": "in your app's key value observation code.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1421"
  },
  {
    "text": "Your app can expect to receive updates to this property on the main queue ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1424"
  },
  {
    "text": "to update its UI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1427"
  },
  {
    "text": "Not all apps use AVCaptureVideoPreviewLayer ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1429"
  },
  {
    "text": "for displaying camera preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1432"
  },
  {
    "text": "Some apps display buffers from a video data output ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1434"
  },
  {
    "text": "when applying custom effects or filters. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1437"
  },
  {
    "text": "One option for displaying custom preview is to use the AVSampleBufferDisplayLayer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1440"
  },
  {
    "text": "Avoid requesting rotation by setting the angle ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1446"
  },
  {
    "text": "on the video data output's AVCaptureConnection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1449"
  },
  {
    "text": "Changing the connection's angle causes a frame delivery interruption ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1452"
  },
  {
    "text": "as the capture render pipeline reconfigures itself ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1455"
  },
  {
    "text": "to apply the new amount of rotation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1458"
  },
  {
    "text": "Instead, rotate the CALayer displaying the camera preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1461"
  },
  {
    "text": "Doing so allows your app's camera preview to rotate smoothly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1466"
  },
  {
    "text": "Use videoRotationAngleForHorizonLevelCapture ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1471"
  },
  {
    "text": "when photos and movies, so they're level relative to gravity. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1474"
  },
  {
    "text": "Your app can apply the property's value on capture connections ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1478"
  },
  {
    "text": "to a photo output or movie file output. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1481"
  },
  {
    "text": "Alternatively, if your app uses a video data output ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1485"
  },
  {
    "text": "with an AVAssetWriter for recording custom movies, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1487"
  },
  {
    "text": "avoid rotating the video with AVCaptureConnection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1490"
  },
  {
    "text": "Instead, set the rotation with an AVAssetWriterInput instance's ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1494"
  },
  {
    "text": "transform property, which alters the output file's metadata. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1498"
  },
  {
    "text": "With this approach, video apps apply the rotation during playback, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1503"
  },
  {
    "text": "which uses less energy than rotating each frame with the capture connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1506"
  },
  {
    "text": "Your app needs to convert the rotation angle from degrees ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1512"
  },
  {
    "text": "because an asset writer input uses a CGAffineTransform ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1514"
  },
  {
    "text": "that applies rotations in radians.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1518"
  },
  {
    "text": "Some outputs efficiently apply rotation without added overhead. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1521"
  },
  {
    "text": "For instance, a movie file output applies rotation using a QuickTime track matrix. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1525"
  },
  {
    "text": "The photo output handles orientation with Exif tags. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1531"
  },
  {
    "text": "And the preview layer transforms its contents to perform rotations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1535"
  },
  {
    "text": "However, your app may increase a device's power consumption ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1539"
  },
  {
    "text": "if has the video or depth data outputs perform rotation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1542"
  },
  {
    "text": "because they use more memory and energy to rotate their buffers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1545"
  },
  {
    "text": "Instead, your app can take a more efficient approach ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1549"
  },
  {
    "text": "by rotating the CALayer that previews buffers from video or depth outputs.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1552"
  },
  {
    "text": "Use AVCaptureDeviceRotationCoordinator on all available platforms, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1558"
  },
  {
    "text": "including iOS, tvOS, and macOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1562"
  },
  {
    "text": "Mac Catalyst and iOS apps on Mac can also use it.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1566"
  },
  {
    "text": "Your app can use the rotation coordinator to correctly orient photos or movies ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1570"
  },
  {
    "text": "and display video preview for any camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1574"
  },
  {
    "text": "And it helps your app handle complex layouts ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1577"
  },
  {
    "text": "with Stage Manager or when it is on an external display.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1579"
  },
  {
    "text": "Now it's time for the final changes to support external cameras in AVCam. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1584"
  },
  {
    "text": "When configuring the capture session, the app sets up its camera preview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1588"
  },
  {
    "text": "So it creates a device rotation coordinator, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1593"
  },
  {
    "text": "which gives the app the rotation angles it needs for preview and capture.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1595"
  },
  {
    "text": "When creating a coordinator, the app updates the preview layer ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1600"
  },
  {
    "text": "with the current rotation angle for preview.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1604"
  },
  {
    "text": "It also observes changes to the angle and updates the preview.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1607"
  },
  {
    "text": "When AVCam switches devices, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1612"
  },
  {
    "text": "it also creates a new rotation coordinator, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1614"
  },
  {
    "text": "so the preview looks right for the new camera.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1616"
  },
  {
    "text": "When taking photos, the app uses the rotation angle ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1620"
  },
  {
    "text": "for capture to make sure they're upright when someone views them later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1623"
  },
  {
    "text": "And it does the same when recording movies.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1627"
  },
  {
    "text": "With these changes, AVCam is ready to support external cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1631"
  },
  {
    "text": "Now when I rotate the iPad, the external camera appears correctly.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1635"
  },
  {
    "text": "We've covered a lot so far in this session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1646"
  },
  {
    "text": "and I thank you for following along with me. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1648"
  },
  {
    "text": "Now that I've shown how your iPad app can use external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1651"
  },
  {
    "text": "I'll discuss how you can also use microphones included with these devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1654"
  },
  {
    "text": "Some webcams and displays include mics. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1658"
  },
  {
    "text": "When they are plugged into an iPad, they can be used by your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1661"
  },
  {
    "text": "iPadOS 17 has improved support for external microphones ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1665"
  },
  {
    "text": "on iPads with USB-C. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1668"
  },
  {
    "text": "Telephony apps that use Core Audio's AUVoiceIO audio unit ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1670"
  },
  {
    "text": "can now use external microphones like those included with webcams or displays. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1674"
  },
  {
    "text": "Previously, the only external wired devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1679"
  },
  {
    "text": "these apps could use were headset mics. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1681"
  },
  {
    "text": "AUVoiceIO is a popular interface, since it performs echo cancellation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1684"
  },
  {
    "text": "and new tunings have been introduced for external mics. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1689"
  },
  {
    "text": "Voice Isolation mode available from Control Center ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1692"
  },
  {
    "text": "removes unwanted background noise, such as typing on keyboards, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1695"
  },
  {
    "text": "mouse clicks, or leaf blowers running somewhere in the neighborhood. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1699"
  },
  {
    "text": "Your app can use this system feature with external microphones.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1703"
  },
  {
    "text": "The iOS audio routing system allows only one microphone to be used at a time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1707"
  },
  {
    "text": "It also automatically changes to the last connected microphone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1712"
  },
  {
    "text": "This is because, just like when connecting a camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1715"
  },
  {
    "text": "the user is indicating the newly connected microphone should be used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1718"
  },
  {
    "text": "On iOS, the system returns only one AVCaptureDevice for the microphone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1723"
  },
  {
    "text": "You can find it by searching for the device with the audio media type ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1727"
  },
  {
    "text": "or with the new microphone device type, which deprecates builtInMicrophone ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1731"
  },
  {
    "text": "because not all mics are built-in to the iPad. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1736"
  },
  {
    "text": "The audio routing system decides which available microphone to use, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1739"
  },
  {
    "text": "be it built-in or external. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1743"
  },
  {
    "text": "When the system changes the input route, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1745"
  },
  {
    "text": "the microphone AVCaptureDevice's localizedName property changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1747"
  },
  {
    "text": "to reflect the device in use.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1750"
  },
  {
    "text": "Your app can use AVAudioSession for more control over the microphone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1753"
  },
  {
    "text": "You can use it to configure your app's audio behaviors ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1757"
  },
  {
    "text": "by setting a category or mode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1760"
  },
  {
    "text": "And you can choose to use a specific mic, like one included with an external camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1762"
  },
  {
    "text": "by setting the preferred input. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1767"
  },
  {
    "text": "For the final topic of this session, I'll discuss some best practices ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1769"
  },
  {
    "text": "for your app when using external cameras.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1773"
  },
  {
    "text": "As you begin adoption, consider what makes most sense for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1777"
  },
  {
    "text": "Earlier, I showed how FaceTime, Code Scanner, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1780"
  },
  {
    "text": "and WebKit chose to support external cameras differently. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1783"
  },
  {
    "text": "Use them as examples of different ways your app can adopt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1786"
  },
  {
    "text": "Configure your iPad for wireless debugging with Xcode ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1790"
  },
  {
    "text": "while the USB-C port is in use by an external camera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1793"
  },
  {
    "text": "Some capabilities that your app can expect from built-in cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1797"
  },
  {
    "text": "may not be supported by external devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1800"
  },
  {
    "text": "For example, if your app relies on depth data capture for some feature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1802"
  },
  {
    "text": "you might have to disable it when an external camera is in use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1806"
  },
  {
    "text": "Apps that use multiple cameras at the same time ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1810"
  },
  {
    "text": "with an AVCaptureMultiCamSession can add external cameras ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1812"
  },
  {
    "text": "for creative capture setups. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1816"
  },
  {
    "text": "iPadOS gives external cameras some treatment ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1818"
  },
  {
    "text": "that it also applies to front-facing cameras. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1821"
  },
  {
    "text": "The AVCaptureVideoPreviewLayer mirrors external cameras by default. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1823"
  },
  {
    "text": "This works well when the camera is facing the iPad user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1827"
  },
  {
    "text": "But this isn't suitable for all use cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1831"
  },
  {
    "text": "If your app's users stream from HDMI switchers ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1833"
  },
  {
    "text": "or point the external camera away from them, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1836"
  },
  {
    "text": "consider allowing users to disable preview mirroring. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1838"
  },
  {
    "text": "In a previous section, I described camera rotation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1842"
  },
  {
    "text": "While your app likely won't need to apply video rotation ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1845"
  },
  {
    "text": "for an external camera, be aware that if you do, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1848"
  },
  {
    "text": "the system rotates external cameras clockwise towards the scene it is facing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1851"
  },
  {
    "text": "This is the same way it applies rotation for built-in cameras.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1855"
  },
  {
    "text": "Prepare your app to handle cameras with different capabilities.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1860"
  },
  {
    "text": "For example, some external cameras may only report two formats, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1864"
  },
  {
    "text": "like a VGA format of 640x480 ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1867"
  },
  {
    "text": "and an HD format of 1280x720. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1870"
  },
  {
    "text": "And some external cameras support pixel formats ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1874"
  },
  {
    "text": "that are not typically used on iOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1876"
  },
  {
    "text": "We've chosen to convert these to more common formats ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1878"
  },
  {
    "text": "that iOS camera apps are used to handling. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1881"
  },
  {
    "text": "Uncompressed formats like yuvs and 2vuy are converted to 420v. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1884"
  },
  {
    "text": "And compressed formats like streaming JPEG and H264 are converted to 420f.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1890"
  },
  {
    "text": "Because an external camera can have formats of any size, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1896"
  },
  {
    "text": "it may not support all AVCaptureSessionPresets. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1899"
  },
  {
    "text": "For example, the HD 4K preset requires the device to have a compatible format.",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1903"
  },
  {
    "text": "Your app can check whether it can use a preset ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1909"
  },
  {
    "text": "by calling the supportsSessionPreset method on AVCaptureDevice. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1911"
  },
  {
    "text": "Your app can configure an external camera, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1916"
  },
  {
    "text": "including changing its resolution, frame rate, and zoom factor. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1918"
  },
  {
    "text": "iPadOS supports a limited set of the camera controls ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1922"
  },
  {
    "text": "available in the USB Video Class specification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1925"
  },
  {
    "text": "So query the AVCaptureDevice for its capabilities. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1928"
  },
  {
    "text": "Let's wrap up everything I just talked about. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1932"
  },
  {
    "text": "I showed how you can discover and use external cameras, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1935"
  },
  {
    "text": "how to properly rotate a camera's video frames, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1939"
  },
  {
    "text": "using external microphones, ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1942"
  },
  {
    "text": "and lastly, best practices for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1944"
  },
  {
    "text": "We're excited to see how you start using external cameras in your iPad app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1948"
  },
  {
    "text": "Thank you, and I hope your app rocks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1952"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2023/10106/?time=1954"
  }
]