[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=0"
  },
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=3"
  },
  {
    "text": "Hi. My name is Ellie Epskamp-Hunt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=9"
  },
  {
    "text": "I work as a Safari engineer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=11"
  },
  {
    "text": "Today, I'm giving an overview ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=13"
  },
  {
    "text": "of some new Web Extensions API avilable in Safari.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=14"
  },
  {
    "text": "Last year, Safari added support ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=18"
  },
  {
    "text": "for the Web Extensions API on macOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=20"
  },
  {
    "text": "It's been amazing to see all of the new Safari extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=22"
  },
  {
    "text": "that have shipped over the past year ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=25"
  },
  {
    "text": "that use this new API support. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=26"
  },
  {
    "text": "And with this release, we're really excited ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=29"
  },
  {
    "text": "to bring web extensions to iOS and iPadOS.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=31"
  },
  {
    "text": "You can learn more about extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=35"
  },
  {
    "text": "on these new platforms in its own dedicated session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=37"
  },
  {
    "text": "\"Meet Safari Web Extensions on iOS.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=40"
  },
  {
    "text": "And if you wanna learn more ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=42"
  },
  {
    "text": "about Safari Web Extensions in general, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=43"
  },
  {
    "text": "you can check out last year's session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=45"
  },
  {
    "text": "Today, we're covering three new extension APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=47"
  },
  {
    "text": "First, we'll talk about non-persistent background pages, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=49"
  },
  {
    "text": "which are a way to structure your extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=52"
  },
  {
    "text": "for better performance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=53"
  },
  {
    "text": "Then, I'll introduce a content-blocking API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=56"
  },
  {
    "text": "for web extensions called declarative net request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=58"
  },
  {
    "text": "And at the end, we'll look at how extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=60"
  },
  {
    "text": "can customize new tabs in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=62"
  },
  {
    "text": "Before we learn more about this new API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=64"
  },
  {
    "text": "let's talk about persistent background pages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=67"
  },
  {
    "text": "Web extensions are made ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=69"
  },
  {
    "text": "using JavaScript, HTML, and CSS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=70"
  },
  {
    "text": "Some extensions have a script that run in the background ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=73"
  },
  {
    "text": "of the browser called a background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=75"
  },
  {
    "text": "It doesn't have any visible UI, but it can react to events ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=78"
  },
  {
    "text": "like a tab opening or a message ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=80"
  },
  {
    "text": "from another part of the extension.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=82"
  },
  {
    "text": "A persistent background page never closes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=84"
  },
  {
    "text": "So, if I have two extensions turned on in my browser, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=87"
  },
  {
    "text": "there'll be two background pages constantly running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=90"
  },
  {
    "text": "And if I use eight extensions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=93"
  },
  {
    "text": "that's eight extension processes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=95"
  },
  {
    "text": "running in the background at all times. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=97"
  },
  {
    "text": "We can see there's a problem here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=99"
  },
  {
    "text": "Persistent background pages are like these invisible tabs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=101"
  },
  {
    "text": "that a user can never close, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=103"
  },
  {
    "text": "and they eat up memory and increase CPU usage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=105"
  },
  {
    "text": "Users shouldn't have to make a compromise ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=108"
  },
  {
    "text": "between using their extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=110"
  },
  {
    "text": "and getting great performance out of their browser. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=111"
  },
  {
    "text": "So instead, extensions can adopt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=113"
  },
  {
    "text": "a non-persistent background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=115"
  },
  {
    "text": "These types of pages can come and go as needed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=117"
  },
  {
    "text": "making your extension more performant ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=119"
  },
  {
    "text": "and giving your users a better browsing experience overall.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=121"
  },
  {
    "text": "If you're developing for iOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=125"
  },
  {
    "text": "your extension must have a non-persistent background page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=127"
  },
  {
    "text": "because of the resource constraints on iOS devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=130"
  },
  {
    "text": "So now that we have an understanding of the reasons ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=133"
  },
  {
    "text": "to use a non-persistent background page, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=135"
  },
  {
    "text": "let's take a look at how they work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=137"
  },
  {
    "text": "The lifetime of a non-persistent background page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=139"
  },
  {
    "text": "is structured around events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=141"
  },
  {
    "text": "A background page registers event listeners ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=142"
  },
  {
    "text": "in order to react to things that happen in the browser ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=145"
  },
  {
    "text": "like a tab closing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=147"
  },
  {
    "text": "or a message from another part of the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=148"
  },
  {
    "text": "And those events help the browser to determine ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=150"
  },
  {
    "text": "if your background page should be loaded or unloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=153"
  },
  {
    "text": "Let's take a look at an example. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=155"
  },
  {
    "text": "When your extension is turned on or updated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=157"
  },
  {
    "text": "your background page will be loaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=159"
  },
  {
    "text": "and it will register event listeners. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=161"
  },
  {
    "text": "For the sake of this example, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=163"
  },
  {
    "text": "let's say that this background page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=164"
  },
  {
    "text": "has exactly one listener ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=165"
  },
  {
    "text": "for a message from a content script. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=167"
  },
  {
    "text": "If time passes and our content script ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=169"
  },
  {
    "text": "doesn't send any messages, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=171"
  },
  {
    "text": "the background page will be unloaded by the browser ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=172"
  },
  {
    "text": "because of that inactivity.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=174"
  },
  {
    "text": "But if our content script sends a message, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=177"
  },
  {
    "text": "the background page will be woken up ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=181"
  },
  {
    "text": "so it can receive and react to that message.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=182"
  },
  {
    "text": "And after the event happens, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=186"
  },
  {
    "text": "the background page will stay loaded.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=188"
  },
  {
    "text": "But if time passes again and no more events fire, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=191"
  },
  {
    "text": "the background page will unload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=194"
  },
  {
    "text": "So with that mental model in mind, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=196"
  },
  {
    "text": "we can talk about how to actually implement ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=198"
  },
  {
    "text": "a non-persistent background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=199"
  },
  {
    "text": "First, you'll add the \"persistent\" key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=202"
  },
  {
    "text": "to the background section of your manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=204"
  },
  {
    "text": "And then you might have to make a couple more changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=207"
  },
  {
    "text": "to your background script. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=209"
  },
  {
    "text": "Because your background page can be unloaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=211"
  },
  {
    "text": "you'll need to use the storage API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=213"
  },
  {
    "text": "to write information to disk as needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=215"
  },
  {
    "text": "Use browser.storage to maintain information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=217"
  },
  {
    "text": "across the lifetime of your background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=219"
  },
  {
    "text": "Next, you'll need to register your event listeners ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=221"
  },
  {
    "text": "at the top level of your script. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=223"
  },
  {
    "text": "Do not register listeners in the completion handler ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=225"
  },
  {
    "text": "of another event listener. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=228"
  },
  {
    "text": "And you'll want to use the browser.alarms API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=230"
  },
  {
    "text": "instead of timers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=232"
  },
  {
    "text": "A timer won't be invoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=233"
  },
  {
    "text": "if the background page has unloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=235"
  },
  {
    "text": "Now let's talk about some code you want to avoid. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=237"
  },
  {
    "text": "Remove calls to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=240"
  },
  {
    "text": "browser.extension. getBackgroundPage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=241"
  },
  {
    "text": "It won't wake up the background page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=243"
  },
  {
    "text": "if it's already been unloaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=245"
  },
  {
    "text": "And finally, you'll need to remove ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=247"
  },
  {
    "text": "any webRequest listeners. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=248"
  },
  {
    "text": "webRequest is an API that lets you analyze web traffic, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=250"
  },
  {
    "text": "and the frequency at which webRequest events fire ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=253"
  },
  {
    "text": "make this API incompatible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=255"
  },
  {
    "text": "with non-persistent background pages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=257"
  },
  {
    "text": "So to see how this all works together, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=259"
  },
  {
    "text": "let's try it out in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=261"
  },
  {
    "text": "I'm using a modified version of the sample code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=262"
  },
  {
    "text": "from last year's session about Safari extensions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=265"
  },
  {
    "text": "This extension can replace words in web pages with emoji ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=267"
  },
  {
    "text": "and reports how many total replacements have happened. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=271"
  },
  {
    "text": "First, let's see what this extension does ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=274"
  },
  {
    "text": "without making any changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=276"
  },
  {
    "text": "Because we have left out the \"persistent\" key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=277"
  },
  {
    "text": "in the manifest, the background page is persistent by default. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=279"
  },
  {
    "text": "I'll build and run the app containing the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=282"
  },
  {
    "text": "And then I'll turn it on in Safari's preferences. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=285"
  },
  {
    "text": "Now I'll use the extension on a web page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=288"
  },
  {
    "text": "Let's go to this Wikipedia article about fish, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=290"
  },
  {
    "text": "and I'll use the popover to interact with the extension.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=293"
  },
  {
    "text": "When I click the \"replace words\" button, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=298"
  },
  {
    "text": "every instance of the word \"fish\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=300"
  },
  {
    "text": "was replaced with a fish emoji. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=301"
  },
  {
    "text": "If I click the popover again, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=303"
  },
  {
    "text": "I can see my total number of words that've been replaced. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=305"
  },
  {
    "text": "The background page for this extension is in charge ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=309"
  },
  {
    "text": "of keeping track of that replacement count. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=311"
  },
  {
    "text": "Let's head to Activity Monitor ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=313"
  },
  {
    "text": "to take a look at our extension process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=315"
  },
  {
    "text": "Here we can see the web process ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=317"
  },
  {
    "text": "where all our extension code is running. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=319"
  },
  {
    "text": "Because our extension uses a persistent background page, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=321"
  },
  {
    "text": "this process will always be running when Safari is running, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=324"
  },
  {
    "text": "even when I stop using this extension hours later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=326"
  },
  {
    "text": "So let's make this extension a little better ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=330"
  },
  {
    "text": "and make its background page non-persistent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=332"
  },
  {
    "text": "The first thing I'll do is add the \"persistent\" key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=335"
  },
  {
    "text": "to the background section of my manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=337"
  },
  {
    "text": "And let's stop here and see if our extension still works. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=339"
  },
  {
    "text": "I'll build the app containing my extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=342"
  },
  {
    "text": "I'll come back to Safari and reload the page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=345"
  },
  {
    "text": "Then I'll replace some words. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=348"
  },
  {
    "text": "After that, I'll briefly wait, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=350"
  },
  {
    "text": "giving the background page some time to go idle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=351"
  },
  {
    "text": "For the purpose of this demo, I've modified Safari ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=354"
  },
  {
    "text": "to unload background pages much faster than normal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=356"
  },
  {
    "text": "We can verify that the background page has, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=359"
  },
  {
    "text": "in fact, unloaded in the develop menu, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=362"
  },
  {
    "text": "under Web Extension Background Pages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=363"
  },
  {
    "text": "This is also where you can inspect your background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=366"
  },
  {
    "text": "Note that if you choose to inspect the page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=369"
  },
  {
    "text": "when it's unloaded, it will immediately load. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=371"
  },
  {
    "text": "Now that the background page is unloaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=373"
  },
  {
    "text": "let's open the popover again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=375"
  },
  {
    "text": "Instead of our expected count of 564, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=376"
  },
  {
    "text": "we see zero words replaced. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=379"
  },
  {
    "text": "So we've got a bug in our extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=381"
  },
  {
    "text": "We need to go back and make some more changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=383"
  },
  {
    "text": "so that our extension works correctly ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=385"
  },
  {
    "text": "with a non-persistent background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=387"
  },
  {
    "text": "Here we are in the code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=389"
  },
  {
    "text": "for the background page of the extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=390"
  },
  {
    "text": "This background page does two things. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=392"
  },
  {
    "text": "It either adds one to the word replacement count, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=394"
  },
  {
    "text": "or it reports the current count. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=396"
  },
  {
    "text": "The global variable is what's causing our bug. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=398"
  },
  {
    "text": "When the background page is reloaded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=401"
  },
  {
    "text": "the count is reset to 0. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=402"
  },
  {
    "text": "So instead of maintaining that state ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=404"
  },
  {
    "text": "that 564 words were replaced, we lose it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=406"
  },
  {
    "text": "So to get around this, let's use the browser.storage API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=409"
  },
  {
    "text": "to save and load our word count as needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=412"
  },
  {
    "text": "First, we'll add some code to load that count from storage.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=415"
  },
  {
    "text": "I'll parse the result from the storage API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=420"
  },
  {
    "text": "to get the value that I want.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=423"
  },
  {
    "text": "And I'll save that value back to storage ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=426"
  },
  {
    "text": "whenever it's updated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=428"
  },
  {
    "text": "And then I'll bring that onMessage listener ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=431"
  },
  {
    "text": "into the body of the storage callback.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=433"
  },
  {
    "text": "But wait. We've got a problem. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=439"
  },
  {
    "text": "We know that event listeners must be registered ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=442"
  },
  {
    "text": "at the top level of our script, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=444"
  },
  {
    "text": "so this isn't going to work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=446"
  },
  {
    "text": "So let's restructure things here ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=448"
  },
  {
    "text": "and bring the storage call into the body of the listener.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=450"
  },
  {
    "text": "And because we are using the storage API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=457"
  },
  {
    "text": "we need to add the storage permission to the manifest.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=459"
  },
  {
    "text": "Now I'll rebuild the app and test my extension again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=465"
  },
  {
    "text": "I'll do the exact same thing as before. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=470"
  },
  {
    "text": "I'll view that Wikipedia page about fish and reload the page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=473"
  },
  {
    "text": "Then I'll replace some words and wait for a moment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=477"
  },
  {
    "text": "giving our background some time to unload.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=479"
  },
  {
    "text": "Great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=485"
  },
  {
    "text": "Our popover now reports ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=486"
  },
  {
    "text": "the correct number of words replaced. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=488"
  },
  {
    "text": "We took an extension with a persistent background page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=490"
  },
  {
    "text": "and successfully converted it ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=492"
  },
  {
    "text": "to use a non-persistent background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=494"
  },
  {
    "text": "And if we go back to Activity Monitor, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=496"
  },
  {
    "text": "the extension process is no longer present ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=498"
  },
  {
    "text": "after the background page has unloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=500"
  },
  {
    "text": "because we did this work ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=502"
  },
  {
    "text": "to adopt a non-persistent background page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=503"
  },
  {
    "text": "That was an overview of non-persistent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=506"
  },
  {
    "text": "background page support in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=508"
  },
  {
    "text": "Remember, if you are developing an extension for iOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=510"
  },
  {
    "text": "you'll have to adopt a non-persistent background page.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=512"
  },
  {
    "text": "Next, let's take a look at declarative net request, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=517"
  },
  {
    "text": "a new content-blocking API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=519"
  },
  {
    "text": "Safari has supported Content Blocker Extensions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=521"
  },
  {
    "text": "built using WebKit Content Rule List, since 2015. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=524"
  },
  {
    "text": "There are a couple improvements to them this year, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=527"
  },
  {
    "text": "which you can check out ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=529"
  },
  {
    "text": "in Apple's updated documentation.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=530"
  },
  {
    "text": "However, web extensions haven't had ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=533"
  },
  {
    "text": "that kind of fast, privacy-preserving, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=535"
  },
  {
    "text": "content-blocking capability until now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=538"
  },
  {
    "text": "The declarative net request API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=540"
  },
  {
    "text": "which was recently introduced by Chrome, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=542"
  },
  {
    "text": "checks all of those boxes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=544"
  },
  {
    "text": "Let's go over the basics.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=546"
  },
  {
    "text": "The content-blocking rules ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=550"
  },
  {
    "text": "are written in a JSON format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=551"
  },
  {
    "text": "Those JSON rules are logically grouped ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=554"
  },
  {
    "text": "into files called rulesets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=556"
  },
  {
    "text": "and there's JavaScript API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=557"
  },
  {
    "text": "that lets you individually toggle these rulesets on or off. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=559"
  },
  {
    "text": "And because Chrome supports this API as well, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=562"
  },
  {
    "text": "you can write one content blocker that can run ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=565"
  },
  {
    "text": "in multiple browsers across multiple platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=567"
  },
  {
    "text": "Let's go over how to write content-blocking rules ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=569"
  },
  {
    "text": "using declarative net request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=572"
  },
  {
    "text": "The first step is to specify a ruleset ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=574"
  },
  {
    "text": "in the extension's manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=576"
  },
  {
    "text": "Here, I've declared one ruleset. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=578"
  },
  {
    "text": "You'll also need to add ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=581"
  },
  {
    "text": "the declarative net request permission. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=582"
  },
  {
    "text": "Here's an example of a declarative net request rule ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=584"
  },
  {
    "text": "that would go inside the file we specified in the ruleset. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=586"
  },
  {
    "text": "It has four pieces.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=589"
  },
  {
    "text": "There's a unique ID along with a priority, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=592"
  },
  {
    "text": "which determines the order in which the rules are applied.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=595"
  },
  {
    "text": "The action piece of the rule allows you to block, allow, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=599"
  },
  {
    "text": "or upgrade the scheme of a resource. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=602"
  },
  {
    "text": "And the condition is where you tell Safari where ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=604"
  },
  {
    "text": "and under what conditions to run this rule. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=606"
  },
  {
    "text": "In the condition dictionary of this rule, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=609"
  },
  {
    "text": "there are two keys. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=611"
  },
  {
    "text": "\"regexFilter\" is matched against the resource URL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=612"
  },
  {
    "text": "and the \"resourceTypes\" array specifies the types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=615"
  },
  {
    "text": "of resources that will be blocked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=618"
  },
  {
    "text": "Let's go into more detail about what's supported ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=620"
  },
  {
    "text": "in this condition dictionary.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=622"
  },
  {
    "text": "Here are all the resource types you can target ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=625"
  },
  {
    "text": "using a declarative net request rule.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=628"
  },
  {
    "text": "The \"excludedResourceTypes\" key lets you specify the types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=632"
  },
  {
    "text": "that you don't wanna match against.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=635"
  },
  {
    "text": "The \"domainType key\" allows you to block a resource ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=638"
  },
  {
    "text": "based on the relation of the domain ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=641"
  },
  {
    "text": "of the resource being loaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=642"
  },
  {
    "text": "and the domain of the document. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=644"
  },
  {
    "text": "A \"first-party\" load is any load where the URL ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=646"
  },
  {
    "text": "has the same security origin as the document. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=648"
  },
  {
    "text": "Every other case is \"third-party.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=651"
  },
  {
    "text": "And finally, the \"Case-Sensitive\" key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=654"
  },
  {
    "text": "allows you to control whether the regexFilter ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=656"
  },
  {
    "text": "is case sensitive or not. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=658"
  },
  {
    "text": "By default, it's true.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=660"
  },
  {
    "text": "So now, let's build a web extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=663"
  },
  {
    "text": "that blocks content using the declarative net request API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=665"
  },
  {
    "text": "The first thing I'll do is add ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=668"
  },
  {
    "text": "a declarative net request section to the manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=670"
  },
  {
    "text": "Inside that declarative net request section, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=673"
  },
  {
    "text": "I'll add a ruleset by writing an ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=675"
  },
  {
    "text": "a bool to indicate that it's on, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=677"
  },
  {
    "text": "and a path to the JSON file containing my rules. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=679"
  },
  {
    "text": "And while we're in the manifest, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=682"
  },
  {
    "text": "I'll also add the declarative net request permission. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=683"
  },
  {
    "text": "From here, let's go into the ruleset JSON file.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=686"
  },
  {
    "text": "I'll write a rule to block images on all web pages.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=691"
  },
  {
    "text": "I'll build the app containing the extension and open Safari.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=697"
  },
  {
    "text": "Notice how this extension doesn't have the ability ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=703"
  },
  {
    "text": "to see any browsing history or web page contents, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=705"
  },
  {
    "text": "even though it will be able to block content ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=708"
  },
  {
    "text": "across all web pages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=709"
  },
  {
    "text": "Before I turn on the extension, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=711"
  },
  {
    "text": "I'm going to open a WebKit blog post with some images in it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=713"
  },
  {
    "text": "We can see that there are two images on this web page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=716"
  },
  {
    "text": "If I come back to preferences, and turn on the extension, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=720"
  },
  {
    "text": "and then reload the page, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=722"
  },
  {
    "text": "the images will be blocked.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=724"
  },
  {
    "text": "Now let's go to another web page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=730"
  },
  {
    "text": "like this Wikipedia page about fish. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=731"
  },
  {
    "text": "Images are also blocked here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=734"
  },
  {
    "text": "but I'd actually prefer if I could see images ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=736"
  },
  {
    "text": "on this particular page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=738"
  },
  {
    "text": "So let's modify our extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=739"
  },
  {
    "text": "so that images are blocked everywhere except here.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=741"
  },
  {
    "text": "I'll come back to Xcode and write a rule ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=744"
  },
  {
    "text": "to allow images on this page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=746"
  },
  {
    "text": "The action type of this rule will be \"allow,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=749"
  },
  {
    "text": "and it will be a higher-priority rule ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=751"
  },
  {
    "text": "than our first blocking rule. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=753"
  },
  {
    "text": "I'll rebuild my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=754"
  },
  {
    "text": "and then I'll come back to Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=756"
  },
  {
    "text": "I'll reload the page.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=758"
  },
  {
    "text": "But this new rule didn't work ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=762"
  },
  {
    "text": "because I'm still not seeing any images.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=764"
  },
  {
    "text": "I'll look in extension preferences ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=769"
  },
  {
    "text": "for any error messages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=770"
  },
  {
    "text": "Okay, it looks like I used an empty array ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=773"
  },
  {
    "text": "for the resource types key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=776"
  },
  {
    "text": "instead of an array with the string \"image.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=777"
  },
  {
    "text": "I'll come back to Xcode to fix my mistake.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=782"
  },
  {
    "text": "I'll rebuild and come back to Safari's preferences ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=785"
  },
  {
    "text": "to verify that the error message is gone.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=787"
  },
  {
    "text": "Then, I'll reload the page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=797"
  },
  {
    "text": "And great, images are no longer being blocked ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=800"
  },
  {
    "text": "on this Wikipedia page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=802"
  },
  {
    "text": "So that was an overview of how to build a web extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=804"
  },
  {
    "text": "that can block content on the web. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=807"
  },
  {
    "text": "You can consult Apple's documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=809"
  },
  {
    "text": "for more information on how to use declarative net request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=811"
  },
  {
    "text": "Finally, let's take a look at how extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=814"
  },
  {
    "text": "can customize new tabs in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=816"
  },
  {
    "text": "We know that users love to personalize their browser, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=818"
  },
  {
    "text": "and extensions are a great way to do that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=821"
  },
  {
    "text": "The new tab override API allows extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=822"
  },
  {
    "text": "to take over the new tab page in Safari ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=825"
  },
  {
    "text": "and customize it completely. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=827"
  },
  {
    "text": "This API is already publicly available ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=829"
  },
  {
    "text": "in Safari 14.1. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=831"
  },
  {
    "text": "New tab overrides are declared in the manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=833"
  },
  {
    "text": "And when the user turns on an extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=837"
  },
  {
    "text": "with a new tab override, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=838"
  },
  {
    "text": "they make a choice on whether or not ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=840"
  },
  {
    "text": "to let that extension take over new tabs in Safari.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=841"
  },
  {
    "text": "Here's how you'd point out your new tab override page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=846"
  },
  {
    "text": "in the manifest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=849"
  },
  {
    "text": "Let's build an extension that uses this new API together. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=850"
  },
  {
    "text": "I'm going to add a new tab override ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=854"
  },
  {
    "text": "to the Sea Creator extension. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=856"
  },
  {
    "text": "Our goal is to have a fun web page appear ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=857"
  },
  {
    "text": "every time we open a new tab in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=860"
  },
  {
    "text": "I'll start by declaring that my HTML page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=862"
  },
  {
    "text": "is a new tab override in the manifest.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=865"
  },
  {
    "text": "I have some existing HTML and CSS files ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=869"
  },
  {
    "text": "that I'd like to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=872"
  },
  {
    "text": "They are in my extension's resources folder. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=873"
  },
  {
    "text": "I just need to add them to the Xcode project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=876"
  },
  {
    "text": "If you've never added a file to an Xcode project, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=879"
  },
  {
    "text": "don't worry. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=881"
  },
  {
    "text": "It's pretty easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=882"
  },
  {
    "text": "I'll click File, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=884"
  },
  {
    "text": "Add Files to Sea Creator, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=886"
  },
  {
    "text": "and then select the files I want to add, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=888"
  },
  {
    "text": "making sure they're a part ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=890"
  },
  {
    "text": "of the extension target and not the app target.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=891"
  },
  {
    "text": "This HTML creates a colorful page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=898"
  },
  {
    "text": "with a fun fact. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=900"
  },
  {
    "text": "So let's run the app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=902"
  },
  {
    "text": "and in Safari, I'll turn on the extension.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=903"
  },
  {
    "text": "I get this prompt, asking me if I want this extension ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=909"
  },
  {
    "text": "to be able to take over my new tabs and windows. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=911"
  },
  {
    "text": "I'll allow it to do so.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=914"
  },
  {
    "text": "If I wanted to make changes to this later, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=919"
  },
  {
    "text": "I can come into General settings.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=921"
  },
  {
    "text": "But now, when I create new tabs in Safari, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=925"
  },
  {
    "text": "my new tab page appears. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=927"
  },
  {
    "text": "It looks pretty good! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=929"
  },
  {
    "text": "But I wanna make a couple of tweaks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=931"
  },
  {
    "text": "My new tab override page doesn't have a very nice title.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=934"
  },
  {
    "text": "So back in Xcode, I'll add a title ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=940"
  },
  {
    "text": "so my pages look good in Safari's tab bar.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=942"
  },
  {
    "text": "I can also pick a different theme color ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=948"
  },
  {
    "text": "if I want something distinct ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=950"
  },
  {
    "text": "from the one Safari inferred from the page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=951"
  },
  {
    "text": "This meta tag I'm using isn't specific to new tab overrides. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=954"
  },
  {
    "text": "It will work on any web page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=957"
  },
  {
    "text": "If you wanna learn more ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=959"
  },
  {
    "text": "about the changes to Safari's UI, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=960"
  },
  {
    "text": "be sure to checkout the session called ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=962"
  },
  {
    "text": "\"Design for Safari 15.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=964"
  },
  {
    "text": "Let's see how that looks now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=969"
  },
  {
    "text": "I'll build again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=971"
  },
  {
    "text": "And back in Safari, I'll create a new tab. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=974"
  },
  {
    "text": "Great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=977"
  },
  {
    "text": "We successfully added a new tab override ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=979"
  },
  {
    "text": "to the Sea Creator extension.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=981"
  },
  {
    "text": "And that was a look at how extensions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=984"
  },
  {
    "text": "can customize new tabs in Safari. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=986"
  },
  {
    "text": "Today, we discussed three new Web Extension APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=989"
  },
  {
    "text": "available in Safari on macOS and iOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=991"
  },
  {
    "text": "I encourage you to download the sample projects associated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=994"
  },
  {
    "text": "with this session and play around with the new APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=997"
  },
  {
    "text": "I showed you how these extensions work on macOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=999"
  },
  {
    "text": "but they work on iOS as well.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1002"
  },
  {
    "text": "We'd also love to know what you think. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1005"
  },
  {
    "text": "You can use Feedback Assistant to file bugs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1007"
  },
  {
    "text": "or you can come chat with us ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1009"
  },
  {
    "text": "on the Safari Developer Forums. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1010"
  },
  {
    "text": "And finally, check out the other sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1013"
  },
  {
    "text": "I mentioned today if you haven't already. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1014"
  },
  {
    "text": "Thank you and have a great WWDC. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1017"
  },
  {
    "text": "[ethereal percussion music]",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10027/?time=1019"
  }
]