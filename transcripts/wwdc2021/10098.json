[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=0"
  },
  {
    "text": "♪ Bass music playing ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=2"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=5"
  },
  {
    "text": "♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=7"
  },
  {
    "text": "David Stites: Hi, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=9"
  },
  {
    "text": "and welcome to \"Showcase app data in Spotlight\".",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=10"
  },
  {
    "text": "My name is David Stites, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=13"
  },
  {
    "text": "and I am an engineer on the Core Data team.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=14"
  },
  {
    "text": "In this session, I am excited to show you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=17"
  },
  {
    "text": "how to add Spotlight indexing in your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=20"
  },
  {
    "text": "using NSCoreDataCoreSpotlightDelegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=23"
  },
  {
    "text": "The agenda for this session is to learn about the ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=26"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=28"
  },
  {
    "text": "and why you should use it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=31"
  },
  {
    "text": "setup a simple implementation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=33"
  },
  {
    "text": "learn how to customize that implementation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=36"
  },
  {
    "text": "and lastly, validate the code by adding full-text search.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=39"
  },
  {
    "text": "First, let's look at Core Data and Spotlight.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=43"
  },
  {
    "text": "People are going to create and store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=48"
  },
  {
    "text": "a lot of great and important content in your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=50"
  },
  {
    "text": "As their use of your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=53"
  },
  {
    "text": "and the size of their data set increases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=54"
  },
  {
    "text": "they're going to want to be able to quickly find that data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=57"
  },
  {
    "text": "both inside the app using standard search methods ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=60"
  },
  {
    "text": "and outside the app, for example, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=63"
  },
  {
    "text": "in Spotlight search.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=66"
  },
  {
    "text": "Wouldn't it be great to have data inside your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=68"
  },
  {
    "text": "show up in Spotlight? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=71"
  },
  {
    "text": "Well, this is where Core Data can help you.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=73"
  },
  {
    "text": "The NSCoreDataCore SpotlightDelegate object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=77"
  },
  {
    "text": "does all the heavy lifting and provides a set of APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=79"
  },
  {
    "text": "that quickly and efficiently indexes content ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=83"
  },
  {
    "text": "provided by your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=86"
  },
  {
    "text": "You just have to turn it on! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=87"
  },
  {
    "text": "Once indexed, search results will also appear ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=90"
  },
  {
    "text": "in the Spotlight search user interface outside your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=93"
  },
  {
    "text": "The Spotlight delegate automatically processes changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=98"
  },
  {
    "text": "to your graph's managed objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=101"
  },
  {
    "text": "and then updates the Spotlight index accordingly.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=103"
  },
  {
    "text": "In addition, it provides robust index management capabilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=106"
  },
  {
    "text": "to interact with the private, on-device-only index ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=110"
  },
  {
    "text": "and allows you to tailor the index results to your liking.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=114"
  },
  {
    "text": "In fact, any content that is in your persistent store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=118"
  },
  {
    "text": "is eligible to be indexed.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=122"
  },
  {
    "text": "The reasons to use the Spotlight delegate are threefold: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=125"
  },
  {
    "text": "(1) the Spotlight delegate maintains feature parity ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=129"
  },
  {
    "text": "with Core Spotlight APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=133"
  },
  {
    "text": "(2) it removes a lot of necessary implementation code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=136"
  },
  {
    "text": "and (3) it provides a great additional feature set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=141"
  },
  {
    "text": "that we'll be discussing later in this session.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=145"
  },
  {
    "text": "To illustrate my previous point, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=149"
  },
  {
    "text": "this is a very simple implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=151"
  },
  {
    "text": "using the Core Spotlight APIs that only adds items ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=153"
  },
  {
    "text": "to a search index and reduces it to... this! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=157"
  },
  {
    "text": "Two lines! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=161"
  },
  {
    "text": "Simple, easy to read and maintain.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=163"
  },
  {
    "text": "I mean, come on, who doesn't prefer less code? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=165"
  },
  {
    "text": "Let's take a look at how to get setup and running right away.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=169"
  },
  {
    "text": "This simple example will cover deciding what to index ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=173"
  },
  {
    "text": "and creating the delegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=176"
  },
  {
    "text": "Throughout this session, I will be referring ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=178"
  },
  {
    "text": "to an app called Tags that I wrote for myself, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=180"
  },
  {
    "text": "which is a simple photo tagging application.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=184"
  },
  {
    "text": "This sample app will incorporate many of the APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=187"
  },
  {
    "text": "I am discussing today.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=190"
  },
  {
    "text": "Prior to adding Spotlight support, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=192"
  },
  {
    "text": "you can see that all the tag and photo data is trapped ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=194"
  },
  {
    "text": "inside Tags as there are no Spotlight search query results ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=197"
  },
  {
    "text": "for \"Natural Bridges State Park\".",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=201"
  },
  {
    "text": "Let's change that! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=204"
  },
  {
    "text": "The first step in any implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=205"
  },
  {
    "text": "using the NSCoreDataCoreSpotlightDelegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=207"
  },
  {
    "text": "is to decide what you're going to index in Spotlight.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=210"
  },
  {
    "text": "What gets indexed in Spotlight is completely up to you.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=214"
  },
  {
    "text": "In Tags, I've decided to index ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=217"
  },
  {
    "text": "the userSpecifiedName attribute on the entity Photo ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=220"
  },
  {
    "text": "and the name attribute on the entity Tag.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=224"
  },
  {
    "text": "To prepare the model for indexing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=228"
  },
  {
    "text": "I've opened the project's Core Data model in Xcode, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=230"
  },
  {
    "text": "selected each attribute I want to index, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=232"
  },
  {
    "text": "and have ticked the Index in Spotlight checkbox ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=235"
  },
  {
    "text": "in the attributes inspector.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=238"
  },
  {
    "text": "Our work continues in the Core Data model editor, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=241"
  },
  {
    "text": "as it's required to set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=244"
  },
  {
    "text": "the Core Data Spotlight display name.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=246"
  },
  {
    "text": "The Core Data Spotlight display name is an NSExpression.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=249"
  },
  {
    "text": "At indexing time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=253"
  },
  {
    "text": "this expression is evaluated with each managed object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=255"
  },
  {
    "text": "that has properties indexed by Spotlight ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=258"
  },
  {
    "text": "and the result is saved.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=260"
  },
  {
    "text": "Later, when the Spotlight search user interface is shown, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=263"
  },
  {
    "text": "these stored results are used as the “display name” ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=267"
  },
  {
    "text": "for the search result.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=270"
  },
  {
    "text": "What is an NSExpression? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=273"
  },
  {
    "text": "Well, an expression can be as simple as evaluating a key path, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=275"
  },
  {
    "text": "in this case Tag.name.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=279"
  },
  {
    "text": "This object has quite a few more tricks it can do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=282"
  },
  {
    "text": "besides evaluating key paths, however.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=285"
  },
  {
    "text": "In this example, it is doing some math for you.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=288"
  },
  {
    "text": "The expression can be even more complex, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=291"
  },
  {
    "text": "such as calculating the standard deviation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=294"
  },
  {
    "text": "of a set of numbers.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=296"
  },
  {
    "text": "In Tags, the Spotlight display name ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=299"
  },
  {
    "text": "is set to userSpecifiedName on the entity Photo, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=302"
  },
  {
    "text": "and name on the entity Tag.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=306"
  },
  {
    "text": "Now that the model is prepared for indexing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=309"
  },
  {
    "text": "let's create the Spotlight delegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=311"
  },
  {
    "text": "Beginning in iOS 15 and macOS Monterey, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=315"
  },
  {
    "text": "the initializer forStoreWith: model: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=319"
  },
  {
    "text": "is now deprecated.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=321"
  },
  {
    "text": "The new way initialize a Spotlight delegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=324"
  },
  {
    "text": "is using forStoreWith: coordinator:.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=326"
  },
  {
    "text": "By adopting the new designated initializer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=328"
  },
  {
    "text": "it is no longer required to add an instance ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=331"
  },
  {
    "text": "of the Spotlight delegate to the store options ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=333"
  },
  {
    "text": "prior to adding the store to the coordinator.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=336"
  },
  {
    "text": "However, you must call startSpotlightIndexing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=339"
  },
  {
    "text": "for the Spotlight delegate to start its work.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=342"
  },
  {
    "text": "I want to call out a couple requirements ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=347"
  },
  {
    "text": "to using the NSCoreDataCoreSpotlightDelegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=348"
  },
  {
    "text": "The store type of the store to be indexed must be SQLite ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=352"
  },
  {
    "text": "and must have persistent history tracking enabled.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=356"
  },
  {
    "text": "And with that, you're done! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=359"
  },
  {
    "text": "That's it! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=361"
  },
  {
    "text": "You don't need to do anything else ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=362"
  },
  {
    "text": "and your data will be indexed in Spotlight.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=364"
  },
  {
    "text": "I just demonstrated how easy it is to add Spotlight indexing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=368"
  },
  {
    "text": "to my Tags app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=372"
  },
  {
    "text": "Now that I've described the basics, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=373"
  },
  {
    "text": "let's customize that implementation a bit.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=375"
  },
  {
    "text": "The first way to customize the implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=378"
  },
  {
    "text": "is by defining a domain and index name.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=381"
  },
  {
    "text": "To start off, I'll define a class, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=384"
  },
  {
    "text": "TagsSpotlightDelegate, which is a subclass of ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=387"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=390"
  },
  {
    "text": "Now, I'll override domainName and indexName ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=394"
  },
  {
    "text": "with an implementation.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=397"
  },
  {
    "text": "Overriding these selectors tells Spotlight where to store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=399"
  },
  {
    "text": "the indexed data and allows you to better identify it later, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=402"
  },
  {
    "text": "especially if you have multiple indices.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=406"
  },
  {
    "text": "If you do not override domainIdentifier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=409"
  },
  {
    "text": "the default domain identifier is the store identifier.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=412"
  },
  {
    "text": "If you do not override indexName, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=416"
  },
  {
    "text": "the default index name is nil.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=418"
  },
  {
    "text": "The next step in customizing the Spotlight delegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=422"
  },
  {
    "text": "is defining an attribute set.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=425"
  },
  {
    "text": "In the setup portion of this session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=428"
  },
  {
    "text": "the NSCoreDataCore SpotlightDelegate object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=430"
  },
  {
    "text": "defined the attribute set returned to Spotlight for us, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=433"
  },
  {
    "text": "simply by ticking the check box Index in Spotlight.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=437"
  },
  {
    "text": "Now, I am going to demonstrate exactly how to specify ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=441"
  },
  {
    "text": "the attributes that will be used for indexing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=444"
  },
  {
    "text": "Specifying which attributes that should be indexed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=448"
  },
  {
    "text": "allows more explicit control over what's indexed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=451"
  },
  {
    "text": "and how it's searched for.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=454"
  },
  {
    "text": "To do that, use CSSearchableItemAttributeSet.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=456"
  },
  {
    "text": "An attribute set contains a number of predefined properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=460"
  },
  {
    "text": "allowing you to specify the metadata to display ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=464"
  },
  {
    "text": "about the specified managed object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=467"
  },
  {
    "text": "when it appears as a search result.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=469"
  },
  {
    "text": "The attributes you choose depend completely on your domain.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=472"
  },
  {
    "text": "You can use predefined properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=476"
  },
  {
    "text": "available in CSSearchableItemAttributeSet ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=478"
  },
  {
    "text": "or you can define your own properties.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=482"
  },
  {
    "text": "The Tags app uses the predefined properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=485"
  },
  {
    "text": "keywords, displayName, and thumbnailData.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=488"
  },
  {
    "text": "It's important to note that you should only modify ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=493"
  },
  {
    "text": "an attribute set on one thread at a time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=495"
  },
  {
    "text": "as concurrent access to the properties in an attribute set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=498"
  },
  {
    "text": "has undefined behavior.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=501"
  },
  {
    "text": "Back in the TagsSpotlightDelegate class, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=504"
  },
  {
    "text": "let's see how this works by overriding ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=506"
  },
  {
    "text": "attributeSet (for object:).",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=508"
  },
  {
    "text": "In the override implementation, begin by determining ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=511"
  },
  {
    "text": "if the object is a Photo type object.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=513"
  },
  {
    "text": "Next, initialize an attributeSet with the content type .image.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=516"
  },
  {
    "text": "Then, set the properties identifier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=522"
  },
  {
    "text": "displayName, and thumbnailData on the attribute set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=526"
  },
  {
    "text": "using the appropriate attributes from the Photo object.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=529"
  },
  {
    "text": "Now, append tags from the Photo object tag set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=535"
  },
  {
    "text": "to the keywords array on the attribute set.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=538"
  },
  {
    "text": "It is worth mentioning at this point ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=541"
  },
  {
    "text": "that if your model indexes a relationship, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=543"
  },
  {
    "text": "attributeSet (for object:) must be overridden ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=546"
  },
  {
    "text": "so that it defines what about that relationship ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=549"
  },
  {
    "text": "in particular is indexed.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=551"
  },
  {
    "text": "Lastly, return the attribute set.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=555"
  },
  {
    "text": "Since the model is also indexing Tag objects, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=559"
  },
  {
    "text": "the code needs to handle the case of a Tag.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=562"
  },
  {
    "text": "For that, create an attribute set with the contentType .text, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=565"
  },
  {
    "text": "set the display name to the name of the tag, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=570"
  },
  {
    "text": "and then return the attribute set.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=573"
  },
  {
    "text": "As a last step, remove the Core Data Spotlight display name ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=577"
  },
  {
    "text": "that was set in the model editor in a previous step.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=581"
  },
  {
    "text": "Let's go further and define an event loop ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=585"
  },
  {
    "text": "for starting and stopping indexing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=588"
  },
  {
    "text": "Earlier, when we setup the Spotlight delegate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=592"
  },
  {
    "text": "startSpotlightIndexing was called immediately after ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=594"
  },
  {
    "text": "creating the Spotlight delegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=598"
  },
  {
    "text": "To give you precise control over when the ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=600"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=602"
  },
  {
    "text": "is performing indexing work, stopSpotlightIndexing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=604"
  },
  {
    "text": "has also been added to the framework.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=608"
  },
  {
    "text": "Using these two selectors in concert gives you the ability ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=611"
  },
  {
    "text": "to start and stop indexing work as necessary, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=614"
  },
  {
    "text": "say, in the case where your app is performing intense CPU ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=618"
  },
  {
    "text": "or disk activity operations.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=621"
  },
  {
    "text": "Now, let's add some support for being notified ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=625"
  },
  {
    "text": "when index updates complete.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=628"
  },
  {
    "text": "When a change occurs to an entity or entities ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=631"
  },
  {
    "text": "that is indexed in Spotlight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=634"
  },
  {
    "text": "that index is updated asynchronously.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=637"
  },
  {
    "text": "In iOS 15 and macOS Monterey, the Core Data framework ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=641"
  },
  {
    "text": "has added index update notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=645"
  },
  {
    "text": "To be informed when the index update is complete, subscribe to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=648"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate .indexDidUpdateNotification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=652"
  },
  {
    "text": "which is posted by the Spotlight delegate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=657"
  },
  {
    "text": "These notifications will be posted after processing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=661"
  },
  {
    "text": "a call to save: on NSManagedObjectContext ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=664"
  },
  {
    "text": "or after the completion of batch operations.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=667"
  },
  {
    "text": "Let's see this in action.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=671"
  },
  {
    "text": "First, check to see if indexing is enabled.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=674"
  },
  {
    "text": "If it is, then register for the indexDidUpdateNotification.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=678"
  },
  {
    "text": "Then, in the handler, inspect the notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=683"
  },
  {
    "text": "which will have a userInfo dictionary ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=686"
  },
  {
    "text": "that contains two key-value pairs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=689"
  },
  {
    "text": "similar to a remote change notification: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=691"
  },
  {
    "text": "an NSString UUID of the store that for which ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=695"
  },
  {
    "text": "the Spotlight delegate updated its index, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=698"
  },
  {
    "text": "and the persistent history token of the store for which ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=702"
  },
  {
    "text": "the Spotlight delegate updated its index.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=706"
  },
  {
    "text": "You can use both of these keys to determine ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=710"
  },
  {
    "text": "if the store you're interested in has been indexed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=712"
  },
  {
    "text": "up to the latest persistent history token.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=715"
  },
  {
    "text": "If indexing is not enabled, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=719"
  },
  {
    "text": "you can remove yourself as an observer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=721"
  },
  {
    "text": "from the notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=723"
  },
  {
    "text": "Prior to this year, the only way to delete data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=727"
  },
  {
    "text": "indexed by your app was to either implement ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=730"
  },
  {
    "text": "the Core Spotlight APIs to remove the index entries ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=732"
  },
  {
    "text": "or delete the entire client graph in Core Data.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=736"
  },
  {
    "text": "Crucially, new in iOS 15 and macOS Monterey, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=741"
  },
  {
    "text": "Core Data has given the developer a new way to manage ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=745"
  },
  {
    "text": "the Spotlight index without deleting the client graph, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=748"
  },
  {
    "text": "which is a great win for user privacy! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=752"
  },
  {
    "text": "First, the code will stop indexing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=756"
  },
  {
    "text": "Then, call deleteSpotlightIndex.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=759"
  },
  {
    "text": "Lastly, handle any resulting error in the completion handler.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=763"
  },
  {
    "text": "Note that calling this method may return errors ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=767"
  },
  {
    "text": "from lower-layer dependencies, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=770"
  },
  {
    "text": "such as Core Data and Core Spotlight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=772"
  },
  {
    "text": "and you should be prepared to handle those.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=774"
  },
  {
    "text": "Now that I've shown you how to customize an implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=778"
  },
  {
    "text": "of the Spotlight delegate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=781"
  },
  {
    "text": "let's validate our setup by adding full-text search ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=782"
  },
  {
    "text": "to the Tags app using the Core Spotlight APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=785"
  },
  {
    "text": "The results will be what was previously indexed.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=789"
  },
  {
    "text": "Start by defining an extension for PhotosViewController ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=793"
  },
  {
    "text": "that adopts the UISearchResultsUpdating protocol ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=796"
  },
  {
    "text": "and a function ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=800"
  },
  {
    "text": "updateSearchResults (for controller).",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=801"
  },
  {
    "text": "The Tags user interface has a UISearchController.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=805"
  },
  {
    "text": "We'll get the user input ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=809"
  },
  {
    "text": "from that search controller's search bar.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=810"
  },
  {
    "text": "If the user input is empty, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=813"
  },
  {
    "text": "fetch all the images from our data provider ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=815"
  },
  {
    "text": "and then reload the collection view ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=817"
  },
  {
    "text": "as there is no search query.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=819"
  },
  {
    "text": "Now let's handle the case where there is a search query.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=822"
  },
  {
    "text": "To start, sanitize the user input string ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=826"
  },
  {
    "text": "by escaping it.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=829"
  },
  {
    "text": "Next, define a query string ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=831"
  },
  {
    "text": "using the user's sanitized input string.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=833"
  },
  {
    "text": "Query strings operate on the values associated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=836"
  },
  {
    "text": "with a property in a ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=839"
  },
  {
    "text": "CSSearchableItemAttributeSet object.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=840"
  },
  {
    "text": "In this case, the code will be operating on the ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=844"
  },
  {
    "text": "Keywords attribute that was set in a previous step.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=847"
  },
  {
    "text": "In the search query, the modifiers c, d, and w ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=851"
  },
  {
    "text": "are being used.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=855"
  },
  {
    "text": "c is for case insensitive.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=857"
  },
  {
    "text": "d is for diacritic insensitive.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=860"
  },
  {
    "text": "And w is for a word-based search.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=862"
  },
  {
    "text": "Now, create a CSSearchQuery object by specifying ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=867"
  },
  {
    "text": "the formatted query string that was just created ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=870"
  },
  {
    "text": "and an array of attribute names that correspond ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=874"
  },
  {
    "text": "to properties defined by CSSearchableItemAttributeSet.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=877"
  },
  {
    "text": "This search query object manages the criteria ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=882"
  },
  {
    "text": "to apply when searching app content ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=885"
  },
  {
    "text": "that you have previously indexed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=887"
  },
  {
    "text": "using the Spotlight delegate APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=889"
  },
  {
    "text": "Following that, set the foundItemsHandler.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=893"
  },
  {
    "text": "This handler will be called repetitively with items ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=896"
  },
  {
    "text": "that match the search query previously defined.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=898"
  },
  {
    "text": "In the completionHandler for the query, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=902"
  },
  {
    "text": "which will be called once, check for an error ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=904"
  },
  {
    "text": "and potentially perform some error handling.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=907"
  },
  {
    "text": "Absent an error, dispatch a block ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=911"
  },
  {
    "text": "onto the main queue to use our data provider ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=913"
  },
  {
    "text": "to perform a fetch for the items Spotlight found ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=916"
  },
  {
    "text": "and load them in the user interface.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=920"
  },
  {
    "text": "Lastly, and most importantly, don't forget to start the query.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=923"
  },
  {
    "text": "Now that the Tags app has a Spotlight delegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=928"
  },
  {
    "text": "indexing its content, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=931"
  },
  {
    "text": "the data has been freed from within the app! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=932"
  },
  {
    "text": "When I go to Spotlight, and I search for a tag ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=936"
  },
  {
    "text": "I have previously added, it returns two results: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=938"
  },
  {
    "text": "the tag name itself and the specific photo that I tagged ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=942"
  },
  {
    "text": "with the keyword \"Natural Bridges State Park\".",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=946"
  },
  {
    "text": "Wrapping up, we've learned about the ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=951"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=952"
  },
  {
    "text": "and how it can help your users find their content ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=955"
  },
  {
    "text": "inside your app and outside your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=957"
  },
  {
    "text": "in Spotlight search, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=960"
  },
  {
    "text": "setup the Spotlight delegate quickly and easily ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=961"
  },
  {
    "text": "to start indexing without a huge code burden, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=964"
  },
  {
    "text": "and customized our Spotlight delegate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=967"
  },
  {
    "text": "using some of the new APIs available to you this release.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=970"
  },
  {
    "text": "I hope you've found this information useful ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=975"
  },
  {
    "text": "and that you'll consider adopting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=977"
  },
  {
    "text": "NSCoreDataCoreSpotlightDelegate in your project ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=979"
  },
  {
    "text": "to help users find their content.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=982"
  },
  {
    "text": "Have a great WWDC! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=984"
  },
  {
    "text": "♪",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10098/?time=987"
  }
]