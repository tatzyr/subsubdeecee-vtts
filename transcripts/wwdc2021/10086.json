[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=0"
  },
  {
    "text": "Nihar: Hello, and welcome to \"What's new in CloudKit.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=9"
  },
  {
    "text": "My name is Nihar Sharma ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=12"
  },
  {
    "text": "and I'm an engineer on the CloudKit team, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=14"
  },
  {
    "text": "and I'll be joined by my colleague Qian. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=16"
  },
  {
    "text": "We're going to start by highlighting some changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=18"
  },
  {
    "text": "to the CloudKit API that take advantage of Swift concurrency. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=21"
  },
  {
    "text": "Then, Qian will walk us through ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=25"
  },
  {
    "text": "the use of encrypted fields on records.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=27"
  },
  {
    "text": "Finally, we'll dig deeper into a new feature ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=32"
  },
  {
    "text": "that allows you to easily share record zones.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=34"
  },
  {
    "text": "First up, we have CloudKit and Swift concurrency. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=38"
  },
  {
    "text": "As a bit of background, CloudKit is a framework ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=41"
  },
  {
    "text": "that gives your application access to a database on iCloud. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=44"
  },
  {
    "text": "This is exposed in the API as a CKContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=48"
  },
  {
    "text": "through which you can access multiple CKDatabases.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=51"
  },
  {
    "text": "Each container has one public database ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=55"
  },
  {
    "text": "where all users can potentially read and write records. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=57"
  },
  {
    "text": "If the device has a logged-in iCloud account, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=61"
  },
  {
    "text": "then your app also has access to a private database, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=64"
  },
  {
    "text": "which contains that user's data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=67"
  },
  {
    "text": "And if your app supports sharing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=70"
  },
  {
    "text": "then data which is shared to the current iCloud user ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=72"
  },
  {
    "text": "will be available to your app in the shared CKDatabase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=75"
  },
  {
    "text": "When writing code against CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=79"
  },
  {
    "text": "there are two general areas of API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=81"
  },
  {
    "text": "First, the functions, which are available ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=84"
  },
  {
    "text": "on CKContainer and CKDatabase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=86"
  },
  {
    "text": "This API is useful for new adopters of CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=89"
  },
  {
    "text": "and is meant to provide a low barrier to entry. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=93"
  },
  {
    "text": "Instead of providing you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=96"
  },
  {
    "text": "with all of the available configurations, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=97"
  },
  {
    "text": "the framework chooses a default behavior, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=100"
  },
  {
    "text": "which is most appropriate for a UI application ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=102"
  },
  {
    "text": "that the user is interacting with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=104"
  },
  {
    "text": "Next is the Operation API, which is exposed as ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=106"
  },
  {
    "text": "a set of NSOperation subclasses. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=110"
  },
  {
    "text": "This API provides a number of features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=113"
  },
  {
    "text": "not available as CKContainer or CKDatabase functions.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=115"
  },
  {
    "text": "This includes sending and receiving batches of items ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=120"
  },
  {
    "text": "in a single round-trip to the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=122"
  },
  {
    "text": "paging through large result sets ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=125"
  },
  {
    "text": "by incrementally fetching them from the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=127"
  },
  {
    "text": "requesting database and record zone changes from the server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=130"
  },
  {
    "text": "since some point in the past, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=134"
  },
  {
    "text": "and lastly, grouping different operations together. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=136"
  },
  {
    "text": "This allows them to be logged as a unit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=139"
  },
  {
    "text": "and lets you inform the system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=141"
  },
  {
    "text": "about the size of your operation-spanning workload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=143"
  },
  {
    "text": "Many developers eventually use this API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=146"
  },
  {
    "text": "when writing production-quality code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=149"
  },
  {
    "text": "Taking advantage of the new Swift concurrency functionality, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=151"
  },
  {
    "text": "CloudKit has made several improvements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=154"
  },
  {
    "text": "First, I'll cover how you can use ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=157"
  },
  {
    "text": "the new Swift async/await feature alongside CloudKit APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=160"
  },
  {
    "text": "Then, I'll talk about new API that helps to clarify ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=164"
  },
  {
    "text": "the difference between a per-item ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=167"
  },
  {
    "text": "and a per-operation callback, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=169"
  },
  {
    "text": "and how CloudKit takes advantage of the Swift.Result type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=171"
  },
  {
    "text": "to clarify the role of parameters to those callbacks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=174"
  },
  {
    "text": "And finally, I'll go over enhancements we've made ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=178"
  },
  {
    "text": "to our container and database functions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=181"
  },
  {
    "text": "which help bring over some of the features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=183"
  },
  {
    "text": "and configurability previously available ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=184"
  },
  {
    "text": "only via the operation APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=187"
  },
  {
    "text": "CloudKit API is introducing async variants ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=190"
  },
  {
    "text": "for functions on container and database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=193"
  },
  {
    "text": "You can use async functions to improve your code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=196"
  },
  {
    "text": "that deals with concurrency. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=198"
  },
  {
    "text": "It helps with making error handling more natural, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=201"
  },
  {
    "text": "and simplifies the visual control flow in your code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=203"
  },
  {
    "text": "For more detail on async functions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=207"
  },
  {
    "text": "please refer to the \"Meet async/await in Swift\" session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=208"
  },
  {
    "text": "Let's check out an example.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=212"
  },
  {
    "text": "This snippet is taken from the PrivateDatabase code sample. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=216"
  },
  {
    "text": "This is one of several CloudKit-specific code samples ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=220"
  },
  {
    "text": "that Apple recently posted to GitHub, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=223"
  },
  {
    "text": "and they are available to you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=225"
  },
  {
    "text": "This specific function wants to delete a record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=227"
  },
  {
    "text": "from the server and inform the caller when it's done.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=230"
  },
  {
    "text": "Note that there are many optionals ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=234"
  },
  {
    "text": "and conditional unwrappings sprinkled around. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=235"
  },
  {
    "text": "And when you first try to understand this function, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=238"
  },
  {
    "text": "the control flow isn't immediately obvious.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=240"
  },
  {
    "text": "Now, let's compare this to code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=245"
  },
  {
    "text": "updated to use CloudKit's async functions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=246"
  },
  {
    "text": "Here, the optionals and unwrappings ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=249"
  },
  {
    "text": "have been eliminated, and the control flow is linear ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=251"
  },
  {
    "text": "and easier to follow.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=254"
  },
  {
    "text": "I'm happy to say that each of our code samples ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=256"
  },
  {
    "text": "on the GitHub repository have updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=258"
  },
  {
    "text": "which demonstrate how the code can be ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=260"
  },
  {
    "text": "similarly refactored to use Swift concurrency.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=262"
  },
  {
    "text": "Let's talk about per-item callbacks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=267"
  },
  {
    "text": "As an example, here's a CKFetchRecordsOperation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=270"
  },
  {
    "text": "sending four CKRecord.IDs to the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=274"
  },
  {
    "text": "to ideally get back four CKRecord payloads. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=277"
  },
  {
    "text": "This operation can go one of three different ways.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=281"
  },
  {
    "text": "In the first case, the operation succeeds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=285"
  },
  {
    "text": "There are no errors, your records are successfully ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=288"
  },
  {
    "text": "fetched from the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=291"
  },
  {
    "text": "The second possibility ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=294"
  },
  {
    "text": "is that you hit an operation-wide error. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=295"
  },
  {
    "text": "This is an error that causes the entire operation to fail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=298"
  },
  {
    "text": "As an example, maybe the device lacks a network connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=302"
  },
  {
    "text": "In that case, the entire operation would fail ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=306"
  },
  {
    "text": "with a networkUnavailable error code.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=308"
  },
  {
    "text": "Here's the third option. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=313"
  },
  {
    "text": "In this scenario, your operation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=314"
  },
  {
    "text": "has successfully round-tripped to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=316"
  },
  {
    "text": "The server has successfully returned ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=319"
  },
  {
    "text": "three of the requested CKRecords, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=321"
  },
  {
    "text": "alongside an error indicating ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=323"
  },
  {
    "text": "that the fourth requested record does not exist. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=325"
  },
  {
    "text": "In this example, the per-item error ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=328"
  },
  {
    "text": "is unknownItem, and it gets bundled ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=330"
  },
  {
    "text": "into a per-operation error called partialFailure. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=333"
  },
  {
    "text": "So, how is this handled in code? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=336"
  },
  {
    "text": "On top, CKFetchRecordsOperation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=339"
  },
  {
    "text": "declares its perRecordCompletionBlock ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=341"
  },
  {
    "text": "and per-operation completion block, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=344"
  },
  {
    "text": "alongside a sample implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=346"
  },
  {
    "text": "of each of these on the bottom.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=348"
  },
  {
    "text": "Note the overlap between these two callbacks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=352"
  },
  {
    "text": "From the missing record example from before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=355"
  },
  {
    "text": "the code expects a per-item error twice-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=357"
  },
  {
    "text": "once as a top-level unknownItem error in the per-item callback ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=360"
  },
  {
    "text": "and again bundled inside a partialFailure error ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=365"
  },
  {
    "text": "in the per-operation callback. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=368"
  },
  {
    "text": "Similarly, it also expects per-item successes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=371"
  },
  {
    "text": "in two places for the records which are fetched successfully-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=373"
  },
  {
    "text": "first, as a top-level parameter to a per-item callback, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=376"
  },
  {
    "text": "and once again, wrapped in the recordsByRecordID dictionary ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=380"
  },
  {
    "text": "of successful results in the per-operation callback.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=384"
  },
  {
    "text": "By leveraging Swift.Result type, CloudKit has replaced ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=388"
  },
  {
    "text": "both of these callbacks to make the API clearer.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=391"
  },
  {
    "text": "Notice the top-level of separation of block parameters ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=396"
  },
  {
    "text": "in the new result-based callbacks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=399"
  },
  {
    "text": "perRecordResultBlock has an ID, identifying the item ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=402"
  },
  {
    "text": "that CloudKit is calling back about. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=406"
  },
  {
    "text": "And it has its per-item result. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=408"
  },
  {
    "text": "The result is now strongly typed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=411"
  },
  {
    "text": "so you know you're getting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=413"
  },
  {
    "text": "either a successfully fetched CKRecord payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=414"
  },
  {
    "text": "or a per-item error.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=417"
  },
  {
    "text": "Similarly, the operation-scoped completion block ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=420"
  },
  {
    "text": "has also been updated to an operation-scoped result block ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=422"
  },
  {
    "text": "which no longer duplicates any success or failure ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=425"
  },
  {
    "text": "already reported by the per-item result block.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=428"
  },
  {
    "text": "So, CloudKit has now formally separated their concerns. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=432"
  },
  {
    "text": "One block is used exclusively for per-item reporting, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=435"
  },
  {
    "text": "and another exclusively for per-operation reporting.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=438"
  },
  {
    "text": "Going back to our missing record example, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=442"
  },
  {
    "text": "the expectation is three invocations of the per-item ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=444"
  },
  {
    "text": "result block with successfully fetched CKRecord payloads, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=448"
  },
  {
    "text": "one invocation of the per-item result block ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=451"
  },
  {
    "text": "with an unknownItem error, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=454"
  },
  {
    "text": "and one invocation of the per-operation result block ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=456"
  },
  {
    "text": "with no error, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=458"
  },
  {
    "text": "as the operation succeeded overall. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=460"
  },
  {
    "text": "One of CloudKit's new improvements is to surface ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=462"
  },
  {
    "text": "separate per-item and per-operation callbacks ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=465"
  },
  {
    "text": "everywhere. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=467"
  },
  {
    "text": "Previously, only the highlighted operations ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=469"
  },
  {
    "text": "have had per-item callbacks that surface per-item errors.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=471"
  },
  {
    "text": "I'm happy to announce that all CKOperations ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=476"
  },
  {
    "text": "now expose per-item callbacks that pass back ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=479"
  },
  {
    "text": "per-item errors when appropriate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=482"
  },
  {
    "text": "Now, let's take a look at some enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=484"
  },
  {
    "text": "and expansions we've made to our container and database APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=486"
  },
  {
    "text": "The enhancements take the form of new functions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=490"
  },
  {
    "text": "on CKContainer and CKDatabase.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=493"
  },
  {
    "text": "Together, these new functions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=496"
  },
  {
    "text": "make a large chunk of CKOperation APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=498"
  },
  {
    "text": "available as functions on CKContainer and CKDatabase.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=500"
  },
  {
    "text": "Importantly, this isn't a one-to-one mapping ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=505"
  },
  {
    "text": "of the operation API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=507"
  },
  {
    "text": "Instead, we've leveraged default parameters ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=509"
  },
  {
    "text": "and the Swift.Result type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=512"
  },
  {
    "text": "to craft an API that is approachable, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=513"
  },
  {
    "text": "powerful, and works with async/await. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=516"
  },
  {
    "text": "That is, each new function is exposed twice-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=519"
  },
  {
    "text": "once taking a completionHandler, and again as an async function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=522"
  },
  {
    "text": "With this enhanced API, functions on the container ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=526"
  },
  {
    "text": "and database now support some of the features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=530"
  },
  {
    "text": "from the Operation API, like batching multiple items, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=533"
  },
  {
    "text": "paging through large data sets, and fetching changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=536"
  },
  {
    "text": "You can also group function invocations together ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=540"
  },
  {
    "text": "for logging, and informing the system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=542"
  },
  {
    "text": "about combined workload size.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=545"
  },
  {
    "text": "Function invocations can now also be configured, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=547"
  },
  {
    "text": "such as by setting timeouts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=550"
  },
  {
    "text": "So, how does this work? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=551"
  },
  {
    "text": "Here, once again, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=555"
  },
  {
    "text": "is the GitHub PrivateDatabase code sample we saw earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=556"
  },
  {
    "text": "using async functions to delete a record.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=559"
  },
  {
    "text": "Let's see how this code can be updated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=563"
  },
  {
    "text": "to take advantage of item batching. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=565"
  },
  {
    "text": "I'm going to change the behavior of this function ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=568"
  },
  {
    "text": "to delete two records atomically ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=570"
  },
  {
    "text": "by taking advantage of the enhanced function API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=572"
  },
  {
    "text": "on database.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=575"
  },
  {
    "text": "Notice the separation of concerns. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=578"
  },
  {
    "text": "The highlighted areas operate at the function scope. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=581"
  },
  {
    "text": "They kick off the function and catch ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=584"
  },
  {
    "text": "any function-scoped errors that are thrown.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=586"
  },
  {
    "text": "And if the function successfully completes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=590"
  },
  {
    "text": "this highlighted area will inspect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=592"
  },
  {
    "text": "the per-item successes or failures. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=594"
  },
  {
    "text": "We have similar examples covering each of these features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=598"
  },
  {
    "text": "in the code sample repositories on GitHub, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=601"
  },
  {
    "text": "and the notes for this session ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=603"
  },
  {
    "text": "will include links to those repositories. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=605"
  },
  {
    "text": "We hope you'll find them useful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=607"
  },
  {
    "text": "And with that, I'd like to turn it over ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=609"
  },
  {
    "text": "to Qian to walk us through encrypted fields. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=612"
  },
  {
    "text": "Thanks, Nihar. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=616"
  },
  {
    "text": "I'm Qian, and I will be talking about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=618"
  },
  {
    "text": "a new feature in CloudKit that will make it super easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=620"
  },
  {
    "text": "to protect your users' data privacy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=622"
  },
  {
    "text": "To do this, I will first give an overview of how CloudKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=625"
  },
  {
    "text": "protects your users' data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=628"
  },
  {
    "text": "then I'll introduce the new data encryption feature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=630"
  },
  {
    "text": "and finally, some prerequisites ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=633"
  },
  {
    "text": "on the userâ€™s account for encryption. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=635"
  },
  {
    "text": "At Apple, privacy is one of our core values ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=638"
  },
  {
    "text": "that we build into all of our products. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=641"
  },
  {
    "text": "As the framework that powers many Apple apps and services, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=644"
  },
  {
    "text": "CloudKit has been innovating privacy technologies constantly ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=647"
  },
  {
    "text": "to offer protection for any data stored and synced with CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=651"
  },
  {
    "text": "Firstly, let me review how CloudKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=656"
  },
  {
    "text": "protects your users' data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=658"
  },
  {
    "text": "CloudKit's approach includes two primary data protection methods, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=660"
  },
  {
    "text": "account-based protection and cryptographic protection.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=664"
  },
  {
    "text": "Any data stored with CloudKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=668"
  },
  {
    "text": "is by default protected by account-based authentication. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=670"
  },
  {
    "text": "This includes your CloudKit-backed apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=674"
  },
  {
    "text": "and all the Apple CloudKit-backed apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=676"
  },
  {
    "text": "Upon storage and retrieval, CloudKit uses secure tokens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=679"
  },
  {
    "text": "to enforce that only authorized users can access their data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=682"
  },
  {
    "text": "and not Apple nor any third party.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=686"
  },
  {
    "text": "As a reminder, only data in private ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=690"
  },
  {
    "text": "and shared databases are covered by account-based protection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=693"
  },
  {
    "text": "In those databases, data either belongs to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=696"
  },
  {
    "text": "or is shared to a specific iCloud account, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=700"
  },
  {
    "text": "and access to the shared data needs authentication. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=703"
  },
  {
    "text": "However, in public databases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=707"
  },
  {
    "text": "data can be accessed by all users, and therefore, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=709"
  },
  {
    "text": "account-based data protection is not applicable by default.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=712"
  },
  {
    "text": "Now, moving on to the other data protection technology-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=718"
  },
  {
    "text": "cryptographic protection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=721"
  },
  {
    "text": "CloudKit provides cryptographic protection for sensitive data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=723"
  },
  {
    "text": "stored in Apple-owned apps and services ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=727"
  },
  {
    "text": "as well as all of your users' data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=729"
  },
  {
    "text": "stored in the form of CKAsset. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=731"
  },
  {
    "text": "These data are preprocessed and encrypted locally ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=734"
  },
  {
    "text": "before it's sent to the CloudKit server for storage, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=737"
  },
  {
    "text": "and is decrypted locally upon retrieval.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=740"
  },
  {
    "text": "This encryption functionality uses key material that is ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=745"
  },
  {
    "text": "stored in the iCloud Keychain belonging ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=748"
  },
  {
    "text": "to the iCloud account signed in on the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=750"
  },
  {
    "text": "It's also compatible with ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=754"
  },
  {
    "text": "CloudKit's sharing functionality, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=755"
  },
  {
    "text": "ensuring that only the users on the CKShare ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=756"
  },
  {
    "text": "can decrypt the relevant encrypted fields.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=760"
  },
  {
    "text": "Cryptographic protection adds another layer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=764"
  },
  {
    "text": "on top of account-based protection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=767"
  },
  {
    "text": "Because even if an unauthorized party somehow bypasses ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=769"
  },
  {
    "text": "the authorization, they cannot decrypt the data retrieved.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=773"
  },
  {
    "text": "Cryptographic protection should be used for data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=778"
  },
  {
    "text": "that is sensitive or private to your users. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=780"
  },
  {
    "text": "Many CloudKit-backed apps within Apple ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=783"
  },
  {
    "text": "take advantage of this functionality ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=786"
  },
  {
    "text": "with Photos and Notes as two examples.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=789"
  },
  {
    "text": "Until now, CloudKit's protection for your users' non-asset data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=793"
  },
  {
    "text": "provides account-based protection by default. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=798"
  },
  {
    "text": "CloudKit is now offering the cryptographic protection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=801"
  },
  {
    "text": "in addition to save you from all the key derivation, management, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=805"
  },
  {
    "text": "and the encryption/decryption processes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=809"
  },
  {
    "text": "and this will help you build CloudKit-backed apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=812"
  },
  {
    "text": "with stronger than ever privacy promises.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=815"
  },
  {
    "text": "Let's check out the new API to help you do that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=820"
  },
  {
    "text": "You can add any key value pair in the new property ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=823"
  },
  {
    "text": "encryptedValues on CKRecords for encryption, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=826"
  },
  {
    "text": "and the same exact property to get back ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=830"
  },
  {
    "text": "the decrypted original value.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=833"
  },
  {
    "text": "I'm going to go over how the encryptedValues API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=837"
  },
  {
    "text": "enables you to sync encrypted data over the CloudKit server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=840"
  },
  {
    "text": "Here, you have two devices and one CloudKit server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=844"
  },
  {
    "text": "If you set the encryptedValues key value pair, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=848"
  },
  {
    "text": "CloudKit will automatically ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=851"
  },
  {
    "text": "encrypt the record values locally ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=852"
  },
  {
    "text": "in CKModifyRecordsOperation to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=855"
  },
  {
    "text": "On another device, after retrieving the records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=858"
  },
  {
    "text": "from the server, you can call the same API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=862"
  },
  {
    "text": "and CloudKit will automatically unwrap the key value pair.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=864"
  },
  {
    "text": "You only need minimum code changed to achieve this process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=869"
  },
  {
    "text": "On the first device, using the encryptedValues API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=873"
  },
  {
    "text": "you can set the key value pair on the record. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=877"
  },
  {
    "text": "In this case, the key is \"encryptedStringField\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=879"
  },
  {
    "text": "and the value is a string object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=883"
  },
  {
    "text": "After that, you can then call CKModifyRecordsOperation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=886"
  },
  {
    "text": "to save the new records to the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=889"
  },
  {
    "text": "On the second device, you can call CKFetchRecordsOperation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=894"
  },
  {
    "text": "to retrieve the encrypted record, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=898"
  },
  {
    "text": "and by using the same encryptedValues property, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=900"
  },
  {
    "text": "you get the string back. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=904"
  },
  {
    "text": "That's it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=906"
  },
  {
    "text": "One simple property will handle all of the encryption ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=907"
  },
  {
    "text": "and decryption processes for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=910"
  },
  {
    "text": "And you can encrypt almost all of the CKRecord value types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=912"
  },
  {
    "text": "except for CKReference ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=916"
  },
  {
    "text": "because they need to be visible to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=918"
  },
  {
    "text": "Note that because CKAsset field, as mentioned previously, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=922"
  },
  {
    "text": "already employs encryption by default, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=925"
  },
  {
    "text": "they cannot be set as an encryptedValue.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=928"
  },
  {
    "text": "You can visualize the encrypted fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=933"
  },
  {
    "text": "by going to the CloudKit database schema, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=935"
  },
  {
    "text": "just like for the regular fields. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=937"
  },
  {
    "text": "There is a CloudKit Console session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=941"
  },
  {
    "text": "\"Meet CloudKit Console,\" that shows you other changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=943"
  },
  {
    "text": "made to the Console, and feel free to check it out. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=946"
  },
  {
    "text": "In the Console, all encrypted fields will ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=949"
  },
  {
    "text": "be shown in the drop-down for record value data types.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=952"
  },
  {
    "text": "They will have the prefix \"encrypted\" such as ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=957"
  },
  {
    "text": "\"Encrypted Double,\" \"Encrypted Timestamp,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=960"
  },
  {
    "text": "to help you differentiate them from the unencrypted ones. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=962"
  },
  {
    "text": "You can also manage encrypted fields through ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=966"
  },
  {
    "text": "the CloudKit Console directly, without any code change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=969"
  },
  {
    "text": "For example, you can add a new encrypted field ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=973"
  },
  {
    "text": "to a new record type in your development database schema.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=975"
  },
  {
    "text": "Moving on to the prerequisite ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=981"
  },
  {
    "text": "on accounts for operations involving encryption. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=983"
  },
  {
    "text": "As any other operations in private and shared databases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=986"
  },
  {
    "text": "they require a valid logged-in account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=990"
  },
  {
    "text": "You need to check the status of your ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=994"
  },
  {
    "text": "current account in your initialization logic by calling ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=995"
  },
  {
    "text": "CKContainer accountStatus(completionHandler:).",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=999"
  },
  {
    "text": "As a reminder, the status will need ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1005"
  },
  {
    "text": "to be \"available\" for operations in private and shared databases.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1007"
  },
  {
    "text": "Any other states will result in error: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1013"
  },
  {
    "text": "\"CKErrorNotAuthenticated,\" including the new state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1016"
  },
  {
    "text": "temporarilyUnavailable, introduced this year to indicate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1020"
  },
  {
    "text": "that an account is logged in but not ready, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1024"
  },
  {
    "text": "and you may direct users to verify their credentials ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1027"
  },
  {
    "text": "in the Settings app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1029"
  },
  {
    "text": "If your user's account is not in \"available\" state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1033"
  },
  {
    "text": "you should listen to CKAccountChanged notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1036"
  },
  {
    "text": "which posts whenever the account changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1040"
  },
  {
    "text": "to be notified when the state may be ready.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1042"
  },
  {
    "text": "That's all you need to know about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1046"
  },
  {
    "text": "encrypting data with CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1048"
  },
  {
    "text": "It will protect your users' data and will save you all the time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1050"
  },
  {
    "text": "and energy from implementing your own custom solution. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1053"
  },
  {
    "text": "Now, back to my amazing colleague Nihar ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1057"
  },
  {
    "text": "to talk about zone sharing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1059"
  },
  {
    "text": "Thanks, Qian! Let's talk about CloudKit sharing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1061"
  },
  {
    "text": "CloudKit is your secure, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1066"
  },
  {
    "text": "privacy-conscious iCloud database in the sky ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1068"
  },
  {
    "text": "that helps you store and sync user data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1071"
  },
  {
    "text": "across all of your users' devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1073"
  },
  {
    "text": "iOS 10 and macOS Sierra introduced CloudKit sharing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1076"
  },
  {
    "text": "a way to securely share data with other iCloud users. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1080"
  },
  {
    "text": "Before diving into what's new in sharing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1084"
  },
  {
    "text": "let's take a closer look at how CloudKit sharing works today.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1087"
  },
  {
    "text": "As a reminder, CloudKit sharing is initiated via the creation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1092"
  },
  {
    "text": "of a CKShare object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1095"
  },
  {
    "text": "which separates the data being shared ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1097"
  },
  {
    "text": "from sharing-related details, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1100"
  },
  {
    "text": "like who the data is being shared with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1102"
  },
  {
    "text": "what permissions those share participants have, et cetera.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1104"
  },
  {
    "text": "Behind the scenes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1108"
  },
  {
    "text": "CloudKit establishes cryptographic access ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1109"
  },
  {
    "text": "to the shared data for participants, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1111"
  },
  {
    "text": "on top of requiring account-based authentication ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1113"
  },
  {
    "text": "for all requests.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1116"
  },
  {
    "text": "Now, there are two main ways that you can ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1120"
  },
  {
    "text": "add sharing support in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1122"
  },
  {
    "text": "You can either get started quickly by using ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1124"
  },
  {
    "text": "the system-provided UI for share management, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1127"
  },
  {
    "text": "vended via UICloudSharingController on iOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1129"
  },
  {
    "text": "and NSSharingService on macOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1133"
  },
  {
    "text": "Or, you can also build your own custom UI ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1136"
  },
  {
    "text": "for letting users interact with the share setup ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1138"
  },
  {
    "text": "by using these framework operations.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1141"
  },
  {
    "text": "Like I mentioned earlier, CKShares separate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1144"
  },
  {
    "text": "what's being shared from who it's shared with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1148"
  },
  {
    "text": "Today, we're going to be focusing on the first half ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1151"
  },
  {
    "text": "of that equation, and more specifically, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1153"
  },
  {
    "text": "take a look at a couple of different ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1156"
  },
  {
    "text": "you can model your data, and how that affects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1158"
  },
  {
    "text": "the way that you leverage the CloudKit sharing APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1161"
  },
  {
    "text": "Let's start with an example that takes advantage ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1166"
  },
  {
    "text": "of existing CloudKit sharing functionality. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1168"
  },
  {
    "text": "iCloud Drive folder sharing is built on top of CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1172"
  },
  {
    "text": "Let's see how you could go about building something ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1176"
  },
  {
    "text": "similar in your own apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1178"
  },
  {
    "text": "So, the data model here ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1181"
  },
  {
    "text": "represents a filesystem hierarchy, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1182"
  },
  {
    "text": "and so you would start off with records of type \"file\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1185"
  },
  {
    "text": "and \"folder,\" and you want to give users ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1187"
  },
  {
    "text": "the ability to easily share any folder record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1190"
  },
  {
    "text": "along with all of the records, file or folder, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1192"
  },
  {
    "text": "that are contained within it.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1195"
  },
  {
    "text": "The way to represent this hierarchical relationship ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1199"
  },
  {
    "text": "in CloudKit and leverage it for sharing is to use ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1202"
  },
  {
    "text": "CKRecord.parent references from child to parent records.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1205"
  },
  {
    "text": "This makes it so that CloudKit will ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1211"
  },
  {
    "text": "treat the resulting hierarchy as a single shareable unit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1212"
  },
  {
    "text": "and so you'll want to go ahead and add those references here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1216"
  },
  {
    "text": "This is very important ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1220"
  },
  {
    "text": "and what makes parent references special in CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1221"
  },
  {
    "text": "Note that if you don't plan to support sharing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1225"
  },
  {
    "text": "you don't need to use parent references, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1227"
  },
  {
    "text": "and any plain CKReference field in your own schema will suffice.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1229"
  },
  {
    "text": "With that set up, folder sharing can now ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1236"
  },
  {
    "text": "be supported simply by initializing a CKShare, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1238"
  },
  {
    "text": "with the folder record as a CKShare's root record.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1241"
  },
  {
    "text": "Using the folder as the root record means ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1246"
  },
  {
    "text": "that CloudKit will automatically share ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1248"
  },
  {
    "text": "all records that are part of the parent-reference based ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1250"
  },
  {
    "text": "hierarchy ultimately pointing at that folder record. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1253"
  },
  {
    "text": "This also means that records added ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1257"
  },
  {
    "text": "or removed from this hierarchy at a later point ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1259"
  },
  {
    "text": "are automatically shared or unshared respectively. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1262"
  },
  {
    "text": "So how is this simple folder sharing model set up in code? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1266"
  },
  {
    "text": "Continuing our example, here are the two file records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1271"
  },
  {
    "text": "along with the folder record to be shared ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1274"
  },
  {
    "text": "in a custom zone in the private database.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1277"
  },
  {
    "text": "First, the parent references are set on both ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1281"
  },
  {
    "text": "file records pointing to the folder record, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1283"
  },
  {
    "text": "and the file records are then saved. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1286"
  },
  {
    "text": "Note that it is good practice to save ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1290"
  },
  {
    "text": "the parent references as early as possible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1292"
  },
  {
    "text": "in order to minimize the number of records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1294"
  },
  {
    "text": "that need to be modified when the folder is being shared.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1297"
  },
  {
    "text": "Then, all three records are shared by initializing a CKShare ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1302"
  },
  {
    "text": "with our folder as the root record, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1306"
  },
  {
    "text": "and saving the CKShare along with the folder record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1308"
  },
  {
    "text": "in the private database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1311"
  },
  {
    "text": "Note that since the parent references were previously ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1313"
  },
  {
    "text": "saved to the server, only the root folder record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1316"
  },
  {
    "text": "needs to be modified along with the share at share-time.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1319"
  },
  {
    "text": "And that's it, your app is now sharing folder records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1324"
  },
  {
    "text": "along with the records underneath them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1328"
  },
  {
    "text": "CloudKit can support multiple CKShares within the same zone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1330"
  },
  {
    "text": "as long as their record hierarchies don't overlap.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1334"
  },
  {
    "text": "Now, let's say instead of a hierarchical folder ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1339"
  },
  {
    "text": "sharing model, you have records representing a few distinct ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1341"
  },
  {
    "text": "types in your zone, and no logical hierarchy between them.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1344"
  },
  {
    "text": "In other words, the zone is being treated as ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1349"
  },
  {
    "text": "a bucket of records, and you want to quickly ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1351"
  },
  {
    "text": "get started with sharing all of the records in it.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1353"
  },
  {
    "text": "Ideally, you'd just be able to mark an entire record zone as ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1357"
  },
  {
    "text": "\"shared\" without manipulating any records within it.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1360"
  },
  {
    "text": "Now, with zone sharing, you can do just that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1366"
  },
  {
    "text": "So, let's set this up in code.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1369"
  },
  {
    "text": "All you need to do is to use the new initializer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1372"
  },
  {
    "text": "for CKShare that takes a record zone ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1375"
  },
  {
    "text": "for an existing zone in the private database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1378"
  },
  {
    "text": "Once this new zone-wide share record is saved, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1381"
  },
  {
    "text": "all records that exist in this zone on the server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1384"
  },
  {
    "text": "are automatically shared, and sharing new records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1387"
  },
  {
    "text": "or unsharing records going forward works by simply ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1390"
  },
  {
    "text": "adding or removing those records from the zone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1393"
  },
  {
    "text": "The entire record zone can be unshared at any point ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1397"
  },
  {
    "text": "by deleting the zone-wide share record. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1399"
  },
  {
    "text": "Let's dive a little deeper into these new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1402"
  },
  {
    "text": "zone-wide share records.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1405"
  },
  {
    "text": "For convenience, the zone-wide share record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1409"
  },
  {
    "text": "always has a well-known record name, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1412"
  },
  {
    "text": "CKRecordNameZoneWideShare, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1414"
  },
  {
    "text": "which can be used along with the zone ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1416"
  },
  {
    "text": "to create the full share record ID.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1419"
  },
  {
    "text": "Zones using zone sharing do not require any parent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1422"
  },
  {
    "text": "references to be set up between records in that zone.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1425"
  },
  {
    "text": "Note that since zone sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1430"
  },
  {
    "text": "only allows a single share record per zone, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1431"
  },
  {
    "text": "this flavor of sharing cannot coexist ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1434"
  },
  {
    "text": "with hierarchical shares within the same zone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1436"
  },
  {
    "text": "So, you can either have one or more hierarchical shares ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1439"
  },
  {
    "text": "in a zone, or a single zone-wide share record.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1443"
  },
  {
    "text": "You can save zone-wide shares in any non-default ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1448"
  },
  {
    "text": "record zone, and these are also marked ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1450"
  },
  {
    "text": "with a new zone capability, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1452"
  },
  {
    "text": "CKRecordZoneCapability ZoneWideSharing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1454"
  },
  {
    "text": "All existing CloudKit sharing mechanics past the creation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1460"
  },
  {
    "text": "of the CKShare record remain the same and are fully supported ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1463"
  },
  {
    "text": "for zone-wide shares, with one exception. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1466"
  },
  {
    "text": "Since there are no longer any root-records ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1470"
  },
  {
    "text": "when using zone sharing, related properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1472"
  },
  {
    "text": "on CKShareMetadata, like hierarchicalRootRecordID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1474"
  },
  {
    "text": "and rootRecord, will be nil when accepting zone shares.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1478"
  },
  {
    "text": "Similarly, when using CKFetchShareMetadataOperation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1483"
  },
  {
    "text": "to bootstrap a custom share acceptance flow, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1486"
  },
  {
    "text": "properties \"shouldFetchRootRecord\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1489"
  },
  {
    "text": "and \"rootRecordDesiredKeys\" will be ignored by the system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1491"
  },
  {
    "text": "when fetching share metadata for zone-wide shares.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1495"
  },
  {
    "text": "So, there are now two flavors of CloudKit sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1499"
  },
  {
    "text": "available depending upon your data model.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1501"
  },
  {
    "text": "If your app's schema logically forms hierarchies ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1505"
  },
  {
    "text": "and hierarchical trees make sense as shareable units, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1507"
  },
  {
    "text": "then continue to use CKRecord parent references to represent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1510"
  },
  {
    "text": "those hierarchies, and then share their root records. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1514"
  },
  {
    "text": "At Apple, we do this for Notes, Reminders, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1518"
  },
  {
    "text": "and iCloud Drive folder sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1520"
  },
  {
    "text": "in a similar fashion to that explored today.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1522"
  },
  {
    "text": "And for all other cases, you can now efficiently share ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1526"
  },
  {
    "text": "an entire record zone simply by creating ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1529"
  },
  {
    "text": "a single zone-wide share record ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1532"
  },
  {
    "text": "and take full advantage of CloudKit sharing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1534"
  },
  {
    "text": "At Apple, we already leverage zone sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1538"
  },
  {
    "text": "for several features, like HomeKit secure video sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1540"
  },
  {
    "text": "and HomePod multiuser.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1543"
  },
  {
    "text": "So today we explored how you can start writing CloudKit code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1546"
  },
  {
    "text": "in a new way using async/await in Swift, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1550"
  },
  {
    "text": "including enhancements to the per-item progress ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1554"
  },
  {
    "text": "and error reporting APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1557"
  },
  {
    "text": "We talked about how you can leverage encrypted fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1560"
  },
  {
    "text": "on your records for sensitive user data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1562"
  },
  {
    "text": "taking advantage of Apple's commitment to user privacy, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1565"
  },
  {
    "text": "without rolling your own cryptography.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1568"
  },
  {
    "text": "And we learned about a faster way to get started ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1572"
  },
  {
    "text": "with CloudKit sharing when your data model ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1574"
  },
  {
    "text": "isn't hierarchical with zone sharing.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1576"
  },
  {
    "text": "There's some great new documentation on these ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1580"
  },
  {
    "text": "features and more available for you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1582"
  },
  {
    "text": "on developer.apple.com, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1585"
  },
  {
    "text": "so please take a look. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1587"
  },
  {
    "text": "There are many related sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1588"
  },
  {
    "text": "in the \"Explore CloudKit\" collection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1590"
  },
  {
    "text": "for you to check out as well, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1592"
  },
  {
    "text": "including one from Core Data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1593"
  },
  {
    "text": "introducing sharing functionality ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1595"
  },
  {
    "text": "built on top of CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1597"
  },
  {
    "text": "Thank you, and hope you have a great WWDC. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1598"
  },
  {
    "text": "[upbeat music]",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10086/?time=1602"
  }
]