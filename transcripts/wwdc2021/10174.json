[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=0"
  },
  {
    "text": "Hello, and welcome to WWDC. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=9"
  },
  {
    "text": "I'm Tori, and I'm so excited to talk to you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=11"
  },
  {
    "text": "about the new features we have coming for your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=14"
  },
  {
    "text": "and to help set some guidelines for running an effective server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=16"
  },
  {
    "text": "to track the status of all of your in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=19"
  },
  {
    "text": "So, let's dive right in.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=22"
  },
  {
    "text": "This session is part two of a three-session series ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=24"
  },
  {
    "text": "focusing on in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=27"
  },
  {
    "text": "If you've not already watched \"Meet StoreKit 2\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=30"
  },
  {
    "text": "or \"Support customers and handle refunds,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=32"
  },
  {
    "text": "I recommend you take a look after this session ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=35"
  },
  {
    "text": "so you can get the full story.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=37"
  },
  {
    "text": "For this session, we're going to focus on ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=39"
  },
  {
    "text": "the server and how you can build your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=41"
  },
  {
    "text": "to manage your in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=44"
  },
  {
    "text": "To get us started in this session, let's first talk about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=46"
  },
  {
    "text": "some of the reasons it's useful to have a server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=49"
  },
  {
    "text": "Having a server is useful for several reasons, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=52"
  },
  {
    "text": "and, in the case of in-app purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=55"
  },
  {
    "text": "most of them revolve around tracking status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=57"
  },
  {
    "text": "When you have a server, we're able to notify you in real time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=59"
  },
  {
    "text": "when the status of one of your in-app purchases changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=63"
  },
  {
    "text": "through App Store server notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=66"
  },
  {
    "text": "and you can call us on-demand ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=67"
  },
  {
    "text": "to check status at any time using server-to-server APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=69"
  },
  {
    "text": "Having a server allows you to validate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=74"
  },
  {
    "text": "customer access to your content, even if their device is offline ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=76"
  },
  {
    "text": "or if the status changes outside the app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=80"
  },
  {
    "text": "so you know if your customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=83"
  },
  {
    "text": "is still subscribed after a renewal ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=84"
  },
  {
    "text": "or if the coins they bought in your game have been refunded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=86"
  },
  {
    "text": "If you already have a server, you may have set one up ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=89"
  },
  {
    "text": "for some of these reasons. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=92"
  },
  {
    "text": "If you don't have a server and are thinking of building one, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=94"
  },
  {
    "text": "these are strong reasons to consider, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=96"
  },
  {
    "text": "as they give you more control of your content. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=99"
  },
  {
    "text": "Even when you have a server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=101"
  },
  {
    "text": "our story still begins on an iPhone, iPad, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=102"
  },
  {
    "text": "or other device with an in-app purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=105"
  },
  {
    "text": "When you send information about that purchase to your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=108"
  },
  {
    "text": "including things like the transactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=111"
  },
  {
    "text": "originalTransactionId, and the receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=114"
  },
  {
    "text": "you're now able to track that purchase from your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=116"
  },
  {
    "text": "by communicating directly with our server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=119"
  },
  {
    "text": "Today, this involves using APIs like verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=122"
  },
  {
    "text": "or frameworks like App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=125"
  },
  {
    "text": "We only want to make integrating with our server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=128"
  },
  {
    "text": "even better for you, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=130"
  },
  {
    "text": "which brings us to today's content. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=131"
  },
  {
    "text": "I'll review all of the changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=133"
  },
  {
    "text": "we have coming on the server side ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=135"
  },
  {
    "text": "and how you can integrate with these ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=137"
  },
  {
    "text": "to build a better, stronger server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=139"
  },
  {
    "text": "To start with, I will go through validating access ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=142"
  },
  {
    "text": "with App Store Receipts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=144"
  },
  {
    "text": "tracking status with App Store Server APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=146"
  },
  {
    "text": "then I will dive into ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=150"
  },
  {
    "text": "how you can track status passively ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=152"
  },
  {
    "text": "with App Store server notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=153"
  },
  {
    "text": "I will also go over what this means ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=156"
  },
  {
    "text": "for managing family sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=158"
  },
  {
    "text": "and how you can test your server in sandbox.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=160"
  },
  {
    "text": "Let's get started with validating status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=165"
  },
  {
    "text": "using receipts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=167"
  },
  {
    "text": "Today, our receipts are in the unified app receipt format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=169"
  },
  {
    "text": "To get the JSON version of the receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=172"
  },
  {
    "text": "you either have to do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=174"
  },
  {
    "text": "an on-device receipt verification in your app or, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=176"
  },
  {
    "text": "since we're talking about the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=178"
  },
  {
    "text": "call our server-to-server verifyReceipt endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=180"
  },
  {
    "text": "When you call us server-to-server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=184"
  },
  {
    "text": "you get this decoded receipt, plus any new transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=186"
  },
  {
    "text": "in a latest_receipt_info section, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=189"
  },
  {
    "text": "upcoming renewal information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=191"
  },
  {
    "text": "in a pending_renewal_info section, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=193"
  },
  {
    "text": "and a latest_receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=195"
  },
  {
    "text": "This receipt can be huge, and it contains transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=196"
  },
  {
    "text": "from your entire app, whether they are non-consumables, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=199"
  },
  {
    "text": "consumables, subscriptions, or non-renewing subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=202"
  },
  {
    "text": "This provides you with a ton of information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=207"
  },
  {
    "text": "but we wonder if it can be too much. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=209"
  },
  {
    "text": "Additionally, with StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=212"
  },
  {
    "text": "we're introducing new signed transactions in a JWS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=214"
  },
  {
    "text": "or JSON web signature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=217"
  },
  {
    "text": "format on the client side, and we want to provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=219"
  },
  {
    "text": "the same thing to you on the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=222"
  },
  {
    "text": "Why did we decide to introduce signed transactions? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=225"
  },
  {
    "text": "At Apple, we care about security. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=227"
  },
  {
    "text": "Using JWS to sign these transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=229"
  },
  {
    "text": "will increase security ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=232"
  },
  {
    "text": "through signing and signature verification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=234"
  },
  {
    "text": "Additionally, the transactions are easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=237"
  },
  {
    "text": "to decode and to verify, so much so that you can do it ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=239"
  },
  {
    "text": "on your server without having to call us. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=243"
  },
  {
    "text": "Let's take a look at these signed transactions now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=246"
  },
  {
    "text": "Our signed transactions consist of three strings ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=249"
  },
  {
    "text": "separated by a period. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=251"
  },
  {
    "text": "The first string is a base64-encoded JSON header, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=253"
  },
  {
    "text": "then a base64-encoded JSON payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=256"
  },
  {
    "text": "followed by a signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=259"
  },
  {
    "text": "If you base64 decode the header, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=261"
  },
  {
    "text": "it contains the signing algorithm we used, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=263"
  },
  {
    "text": "as well as an x5C claim. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=265"
  },
  {
    "text": "This contains the certificate chain you need ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=268"
  },
  {
    "text": "to verify the signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=270"
  },
  {
    "text": "We'll get back to verifying the signature in a bit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=272"
  },
  {
    "text": "Next, if you base64 decode the payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=274"
  },
  {
    "text": "you'll see the receipt JSON. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=278"
  },
  {
    "text": "That means all you need to do to decode the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=280"
  },
  {
    "text": "is base64 decode the payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=283"
  },
  {
    "text": "a simple operation that you can do on your own ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=285"
  },
  {
    "text": "on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=288"
  },
  {
    "text": "Let's take a quick look at the decoded transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=290"
  },
  {
    "text": "Just glancing at it, you may notice that some ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=292"
  },
  {
    "text": "data types have changed from strings in the previous receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=294"
  },
  {
    "text": "to more appropriate data types, like numbers or booleans. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=297"
  },
  {
    "text": "Also notice that we have reduced date formats ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=301"
  },
  {
    "text": "to only one, milliseconds since epoch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=304"
  },
  {
    "text": "We've also added a few new fields. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=306"
  },
  {
    "text": "We've added a field called \"type,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=309"
  },
  {
    "text": "which tells you the content type the transaction applies to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=311"
  },
  {
    "text": "We also added a field called \"appAccountToken.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=313"
  },
  {
    "text": "When you provide this value to StoreKit at buy time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=317"
  },
  {
    "text": "in your StoreKit 2 app, we persist it on the server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=320"
  },
  {
    "text": "to return it in each of your transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=323"
  },
  {
    "text": "We will also return this ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=326"
  },
  {
    "text": "not only in the new signed transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=328"
  },
  {
    "text": "but also in our existing unified app receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=330"
  },
  {
    "text": "for each transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=333"
  },
  {
    "text": "The next two fields I want to call out here ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=335"
  },
  {
    "text": "aren't really new, but rather renamed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=336"
  },
  {
    "text": "We have renamed cancellation_date ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=340"
  },
  {
    "text": "and cancellation_reason to revocation_date ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=342"
  },
  {
    "text": "and revocation_reason to make it more clear ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=344"
  },
  {
    "text": "that the presence of these fields indicate that service ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=347"
  },
  {
    "text": "should be revoked, as of the revocation date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=349"
  },
  {
    "text": "These last two fields may look new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=352"
  },
  {
    "text": "but are really a simplification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=354"
  },
  {
    "text": "of some information from our previous receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=356"
  },
  {
    "text": "We've combined isTrialPeriod, isIntroOfferPeriod, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=359"
  },
  {
    "text": "promotionalOfferIdentifier, and offerCodeRefName ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=362"
  },
  {
    "text": "into offerType and offerIdentifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=366"
  },
  {
    "text": "offerType tells you what type of offer your customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=370"
  },
  {
    "text": "has applied to this period, with 1 for an intro offer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=372"
  },
  {
    "text": "2 for a subscription offer, and 3 for an offer code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=376"
  },
  {
    "text": "If the offer type is 2 or 3, you'll also see a value ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=381"
  },
  {
    "text": "in the offer identifier field ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=384"
  },
  {
    "text": "with either the promotional offer ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=386"
  },
  {
    "text": "or the offerCodeRefName. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=388"
  },
  {
    "text": "Now, I want to talk about verifying ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=390"
  },
  {
    "text": "the signature portion of the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=392"
  },
  {
    "text": "Verifying the signature is an option for you to validate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=395"
  },
  {
    "text": "that the transaction came from Apple and is trustworthy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=398"
  },
  {
    "text": "If you only want to see the contents of the transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=401"
  },
  {
    "text": "this step is not required. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=404"
  },
  {
    "text": "However, to verify the signature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=406"
  },
  {
    "text": "you will need to use the claims available ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=408"
  },
  {
    "text": "in the header portion of the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=410"
  },
  {
    "text": "Use the alg claim to know what signing algorithm we used, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=414"
  },
  {
    "text": "and use the certificate chain in the array in the x5c claim.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=417"
  },
  {
    "text": "Once you have these two things, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=423"
  },
  {
    "text": "you can use your favorite cryptographic library ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=425"
  },
  {
    "text": "to verify the signature of the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=427"
  },
  {
    "text": "So that covers our changes for App Store Receipts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=430"
  },
  {
    "text": "or, as we call them now, signed transactions.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=433"
  },
  {
    "text": "Now, let's move on to how you can check status with APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=438"
  },
  {
    "text": "So while you don't need an API like today's verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=441"
  },
  {
    "text": "to verify the validity of your signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=445"
  },
  {
    "text": "or to decode the transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=447"
  },
  {
    "text": "we still wanted to build APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=449"
  },
  {
    "text": "that would help you on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=451"
  },
  {
    "text": "That is why we're introducing a brand-new library ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=453"
  },
  {
    "text": "of App Store Server APIs this year at WWDC ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=456"
  },
  {
    "text": "that will provide you with some new features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=460"
  },
  {
    "text": "previously unavailable to you on your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=462"
  },
  {
    "text": "and will also make use of our new signed transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=465"
  },
  {
    "text": "So we're going to talk about two brand-new APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=467"
  },
  {
    "text": "right now: the subscription status API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=470"
  },
  {
    "text": "and the in-app purchase history API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=473"
  },
  {
    "text": "First, I wanna talk about the subscription status API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=475"
  },
  {
    "text": "The subscription status API provides the latest status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=478"
  },
  {
    "text": "of your auto-renewable subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=482"
  },
  {
    "text": "indicated by an originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=484"
  },
  {
    "text": "from your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=486"
  },
  {
    "text": "With this API, you'll get a quick answer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=487"
  },
  {
    "text": "as to your subscriber's status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=489"
  },
  {
    "text": "You'll quickly know whether their subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=492"
  },
  {
    "text": "is active, expired, in a grace period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=494"
  },
  {
    "text": "or other states, with one simple check. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=496"
  },
  {
    "text": "Let's take a look at it now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=499"
  },
  {
    "text": "The request to this API is simple, requiring only ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=501"
  },
  {
    "text": "an originalTransactionId in the URL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=504"
  },
  {
    "text": "The response from this API contains a status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=507"
  },
  {
    "text": "for every subscription your customer is subscribed to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=510"
  },
  {
    "text": "in your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=512"
  },
  {
    "text": "grouped by a subscriptionGroupIdentifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=514"
  },
  {
    "text": "For each subscriptionGroupIdentifier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=517"
  },
  {
    "text": "we provide a list of the latest transactions, with an entry ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=519"
  },
  {
    "text": "for each originalTransactionId in the subscription group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=522"
  },
  {
    "text": "Each entry in this array contains a status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=526"
  },
  {
    "text": "the originalTransactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=529"
  },
  {
    "text": "the signedTransactionInfo, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=532"
  },
  {
    "text": "and a signedRenewalInfo, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=534"
  },
  {
    "text": "also signed in a JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=536"
  },
  {
    "text": "Let's take a closer look at that status field now.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=539"
  },
  {
    "text": "The status field will give you a quick answer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=543"
  },
  {
    "text": "as to the status of your subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=545"
  },
  {
    "text": "so you can know whether to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=547"
  },
  {
    "text": "unlock service for your subscriber. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=548"
  },
  {
    "text": "We're starting with five possible values for status: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=551"
  },
  {
    "text": "1, meaning that the subscription is active; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=555"
  },
  {
    "text": "2, meaning that the subscription is expired; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=557"
  },
  {
    "text": "3, meaning that the subscription is in a billing retry period; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=561"
  },
  {
    "text": "4, meaning that the subscription is in a grace period; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=564"
  },
  {
    "text": "and 5, meaning that the subscription access ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=568"
  },
  {
    "text": "has been revoked due to a cancellation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=571"
  },
  {
    "text": "or some other event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=573"
  },
  {
    "text": "Looking at the status field gives you a quick answer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=575"
  },
  {
    "text": "about your subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=578"
  },
  {
    "text": "For more information on that status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=579"
  },
  {
    "text": "you can look at the payload of the signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=582"
  },
  {
    "text": "and the payload of the signed renewal info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=585"
  },
  {
    "text": "To decode the signedRenewalInfo, follow the same steps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=588"
  },
  {
    "text": "as you would for the signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=591"
  },
  {
    "text": "by base64 decoding the payload portion.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=594"
  },
  {
    "text": "You can additionally verify the signature ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=598"
  },
  {
    "text": "of the signedRenewalInfo in the same manner, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=600"
  },
  {
    "text": "using the header. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=603"
  },
  {
    "text": "Once decoded, you will see something like this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=604"
  },
  {
    "text": "The renewal info contains the same fields we offer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=608"
  },
  {
    "text": "in the pending renewal info section of verifyReceipt today ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=611"
  },
  {
    "text": "with some updates such as including only one date format ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=614"
  },
  {
    "text": "and making some fields booleans or numbers where applicable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=618"
  },
  {
    "text": "We will also be adding our new fields offerType ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=622"
  },
  {
    "text": "and offerIdentifier to the signedRenewalInfo. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=625"
  },
  {
    "text": "This will let you know if the customer plans to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=628"
  },
  {
    "text": "redeem an offer at their next renewal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=630"
  },
  {
    "text": "In addition to the subscription status API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=633"
  },
  {
    "text": "we want to provide a way for you to get all of the transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=635"
  },
  {
    "text": "associated with your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=639"
  },
  {
    "text": "much like we provide in the latest_receipt_info section ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=640"
  },
  {
    "text": "of verifyReceipt today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=643"
  },
  {
    "text": "For this reason, we're also adding ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=645"
  },
  {
    "text": "an in-app purchase history API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=648"
  },
  {
    "text": "The in-app purchase history API will provide the history of all ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=650"
  },
  {
    "text": "transactions for your app, much like you receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=653"
  },
  {
    "text": "in the latest_receipt_info section of verifyReceipt today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=656"
  },
  {
    "text": "The key difference here is each transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=660"
  },
  {
    "text": "will be in the new signed transaction info format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=662"
  },
  {
    "text": "and the API will be paginated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=665"
  },
  {
    "text": "to control the size of the response you receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=667"
  },
  {
    "text": "from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=670"
  },
  {
    "text": "The initial request for this is, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=672"
  },
  {
    "text": "like the subscription status API, quite simple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=673"
  },
  {
    "text": "We require only an originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=677"
  },
  {
    "text": "from you to process your request.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=680"
  },
  {
    "text": "In the response you'll receive app metadata, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=683"
  },
  {
    "text": "like your app's Apple ID and bundle ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=686"
  },
  {
    "text": "and an array of the latest 20 transactions for your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=688"
  },
  {
    "text": "in our new signed transaction info format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=692"
  },
  {
    "text": "We return 20 signed transaction infos to you per request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=694"
  },
  {
    "text": "If you have more transactions, look to the hasMore ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=698"
  },
  {
    "text": "and revision values in the response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=701"
  },
  {
    "text": "hasMore will be true ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=704"
  },
  {
    "text": "if there are more transactions remaining for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=705"
  },
  {
    "text": "In this case, make another request, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=709"
  },
  {
    "text": "passing the revision token as a query parameter, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=711"
  },
  {
    "text": "to get the next 20 transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=714"
  },
  {
    "text": "Repeat this until hasMore is false. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=716"
  },
  {
    "text": "Now let's pivot and talk about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=719"
  },
  {
    "text": "how all of the App Store Server APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=721"
  },
  {
    "text": "will be consistent with each other. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=724"
  },
  {
    "text": "They will all be behind JWT — or JSON web token — authentication, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=726"
  },
  {
    "text": "support our new signed transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=731"
  },
  {
    "text": "and feature JSON request and response formats. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=733"
  },
  {
    "text": "And best of all, they all key off of an originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=736"
  },
  {
    "text": "that you provide in the request, rather than requiring ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=740"
  },
  {
    "text": "a receipt and a shared secret in the request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=743"
  },
  {
    "text": "Now, I want to cover JWT authentication. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=746"
  },
  {
    "text": "All of our new App Store Server APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=749"
  },
  {
    "text": "will make use of JSON Web Token, or JWT, authentication. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=751"
  },
  {
    "text": "We chose this to increase the security ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=755"
  },
  {
    "text": "of communication between our server and yours. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=758"
  },
  {
    "text": "To generate this JWT, you will need to download ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=761"
  },
  {
    "text": "a private key from App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=764"
  },
  {
    "text": "This process will automatically register ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=766"
  },
  {
    "text": "the public key with our server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=769"
  },
  {
    "text": "Then you must sign the token using the ES256 algorithm ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=771"
  },
  {
    "text": "before calling our server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=774"
  },
  {
    "text": "To generate your private key in App Store Connect, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=776"
  },
  {
    "text": "navigate to the Users and Access page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=779"
  },
  {
    "text": "and visit the Keys tab. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=781"
  },
  {
    "text": "Select the in-app purchase keys option, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=783"
  },
  {
    "text": "and you'll see a page like this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=786"
  },
  {
    "text": "Add a key and give it a name. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=788"
  },
  {
    "text": "Save the key in a safe place, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=790"
  },
  {
    "text": "as you can only download it once, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=792"
  },
  {
    "text": "and take note of the key ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=794"
  },
  {
    "text": "Now, let's take a look at what this JWT actually looks like. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=796"
  },
  {
    "text": "A JWT consists of three parts: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=800"
  },
  {
    "text": "a header, a payload, and a signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=803"
  },
  {
    "text": "In the header, you should include the key ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=806"
  },
  {
    "text": "of your private key ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=808"
  },
  {
    "text": "and the algorithm used for signing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=810"
  },
  {
    "text": "We require an elliptic curve signature ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=812"
  },
  {
    "text": "with a SHA 256 hash, or ES256. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=814"
  },
  {
    "text": "You will also include the type of the token, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=818"
  },
  {
    "text": "which, in this case, is always JWT. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=820"
  },
  {
    "text": "The payload should include your issuer ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=824"
  },
  {
    "text": "You can find this value in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=826"
  },
  {
    "text": "You will include the time the token was issued ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=829"
  },
  {
    "text": "and the time it should expire, in seconds since epoch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=831"
  },
  {
    "text": "The difference between these two times should be ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=835"
  },
  {
    "text": "no more than an hour. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=837"
  },
  {
    "text": "Include the audience, which is always appstoreconnect-v1.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=839"
  },
  {
    "text": "You'll have to generate a nonce, or a one-time unique string. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=843"
  },
  {
    "text": "Finally, you'll have to include the bundle identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=847"
  },
  {
    "text": "of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=850"
  },
  {
    "text": "Once you have all of this information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=852"
  },
  {
    "text": "you have to implement the signing of this token ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=854"
  },
  {
    "text": "using the ES256 algorithm, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=856"
  },
  {
    "text": "or an elliptic curve signature with a SHA 256 hash. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=859"
  },
  {
    "text": "Before I move on, let's review the key takeaways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=863"
  },
  {
    "text": "of our App Store Server APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=866"
  },
  {
    "text": "First, we've separated determining status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=868"
  },
  {
    "text": "from looking up the history of transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=871"
  },
  {
    "text": "as these are separate functions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=874"
  },
  {
    "text": "Next, these APIs require ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=876"
  },
  {
    "text": "only the originalTransactionId in the request, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=878"
  },
  {
    "text": "meaning that you can take the signed transactions you receive, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=881"
  },
  {
    "text": "either from your app or from a response from our server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=884"
  },
  {
    "text": "store the fields you're interested in, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=888"
  },
  {
    "text": "including originalTransactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=890"
  },
  {
    "text": "and then get rid of the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=892"
  },
  {
    "text": "There is no need to store signed transactions anymore ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=895"
  },
  {
    "text": "as we have guided you to do with receipts in the past. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=898"
  },
  {
    "text": "So that covers how you can check your customer status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=901"
  },
  {
    "text": "with our new App Store Server APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=904"
  },
  {
    "text": "Now, I want to go over how we are making ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=907"
  },
  {
    "text": "our App Store server notifications consistent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=909"
  },
  {
    "text": "and how you can track status using notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=912"
  },
  {
    "text": "Let's first start with a quick review ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=915"
  },
  {
    "text": "of App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=917"
  },
  {
    "text": "We've discussed App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=919"
  },
  {
    "text": "for a few years now, so let's review why they're useful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=922"
  },
  {
    "text": "With App Store server notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=925"
  },
  {
    "text": "you can receive notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=928"
  },
  {
    "text": "when the status of one of your transactions changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=929"
  },
  {
    "text": "directly from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=932"
  },
  {
    "text": "When you receive the notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=935"
  },
  {
    "text": "you can update your status immediately, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=937"
  },
  {
    "text": "without your customer having to open the app on their phone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=939"
  },
  {
    "text": "With App Store server notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=943"
  },
  {
    "text": "you also don't need to call us for status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=945"
  },
  {
    "text": "We'll just tell you when something changes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=947"
  },
  {
    "text": "They are one of the most powerful tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=950"
  },
  {
    "text": "your server can take advantage of. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=952"
  },
  {
    "text": "Our goal for this year ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=955"
  },
  {
    "text": "is to make App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=956"
  },
  {
    "text": "even more powerful by making use of our new, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=958"
  },
  {
    "text": "easy-to-use signed transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=962"
  },
  {
    "text": "In addition to this, we will update the notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=965"
  },
  {
    "text": "to make sure only one notification is sent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=968"
  },
  {
    "text": "for one user action, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=970"
  },
  {
    "text": "we will update the payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=972"
  },
  {
    "text": "and the entire payload will be signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=974"
  },
  {
    "text": "using JWS to enhance security. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=976"
  },
  {
    "text": "We'll also allow you to opt in to the v2 notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=979"
  },
  {
    "text": "when you're ready and will continue sending ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=982"
  },
  {
    "text": "the existing notifications for some time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=984"
  },
  {
    "text": "This is our current notification offering for v1 notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=987"
  },
  {
    "text": "There are 11 total types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=991"
  },
  {
    "text": "including everything from INITIAL_BUY to REVOKE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=993"
  },
  {
    "text": "With v2 notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=996"
  },
  {
    "text": "we're deprecating four of our notification types: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=997"
  },
  {
    "text": "INITIAL_BUY, INTERACTIVE_RENEWAL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1000"
  },
  {
    "text": "CANCEL, and PRICE_INCREASE_CONSENT. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1003"
  },
  {
    "text": "But we're adding five new types: SUBSCRIBED, OFFER_REDEEMED, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1005"
  },
  {
    "text": "EXPIRED, GRACE_PERIOD_EXPIRED, and PRICE_INCREASE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1010"
  },
  {
    "text": "In addition to the new notification types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1014"
  },
  {
    "text": "we're adding a new field called \"substate\" to the notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1016"
  },
  {
    "text": "This will help you narrow a more general notification type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1020"
  },
  {
    "text": "to a specific user action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1023"
  },
  {
    "text": "Currently, substates apply to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1025"
  },
  {
    "text": "six of our v2 notification types: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1027"
  },
  {
    "text": "SUBSCRIBED, DID_CHANGE_RENEWAL_STATUS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1030"
  },
  {
    "text": "DID_CHANGE_RENEWAL_PREFERENCES, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1033"
  },
  {
    "text": "OFFER_REDEEMED, EXPIRED, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1036"
  },
  {
    "text": "and PRICE_INCREASE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1038"
  },
  {
    "text": "Let's take a look at some examples ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1040"
  },
  {
    "text": "of how substates apply to these notification types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1042"
  },
  {
    "text": "First, I want to talk about the SUBSCRIBED notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1045"
  },
  {
    "text": "and its substates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1048"
  },
  {
    "text": "When a customer makes a first-time purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1050"
  },
  {
    "text": "you will receive SUBSCRIBED with a substate of INITIAL_BUY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1052"
  },
  {
    "text": "When a customer resubscribes to the same SKU ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1057"
  },
  {
    "text": "or a different SKU, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1059"
  },
  {
    "text": "you will receive SUBSCRIBED with a substate of RESUBSCRIBE, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1061"
  },
  {
    "text": "as long as the subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1065"
  },
  {
    "text": "is within the same subscription group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1066"
  },
  {
    "text": "One of our new notification types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1069"
  },
  {
    "text": "without an equivalent type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1071"
  },
  {
    "text": "in v1 App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1072"
  },
  {
    "text": "is the OFFER_REDEEMED notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1075"
  },
  {
    "text": "So I want to take a look at this example. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1077"
  },
  {
    "text": "OFFER_REDEEMED is received ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1079"
  },
  {
    "text": "whenever a customer redeems a promotional offer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1081"
  },
  {
    "text": "If the customer redeems an offer for a first-time purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1084"
  },
  {
    "text": "you'll receive OFFER_REDEEMED with a substate of INITIAL_BUY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1087"
  },
  {
    "text": "If the customer redeems an offer to resubscribe ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1092"
  },
  {
    "text": "to the same inactive subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1094"
  },
  {
    "text": "you'll receive OFFER_REDEEMED with a substate of RESUBSCRIBE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1097"
  },
  {
    "text": "If the customer redeems an offer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1101"
  },
  {
    "text": "to upgrade their active subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1103"
  },
  {
    "text": "you'll receive OFFER_REDEEMED with a substate of UPGRADE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1105"
  },
  {
    "text": "If the customer redeems an offer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1109"
  },
  {
    "text": "to downgrade their active subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1110"
  },
  {
    "text": "you'll receive OFFER_REDEEMED with a substate of DOWNGRADE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1113"
  },
  {
    "text": "Additionally, if the customer redeems an offer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1117"
  },
  {
    "text": "to resubscribe to their active subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1120"
  },
  {
    "text": "after canceling within the same period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1122"
  },
  {
    "text": "you will receive OFFER_REDEEMED ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1125"
  },
  {
    "text": "with a substate of AUTO_RENEW_ENABLED.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1127"
  },
  {
    "text": "Now, let's look at EXPIRED. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1130"
  },
  {
    "text": "With the new EXPIRED notification type, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1132"
  },
  {
    "text": "you'll receive EXPIRED when the subscription expires ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1134"
  },
  {
    "text": "after the customer has disabled auto renew ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1137"
  },
  {
    "text": "with a substate of VOLUNTARY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1139"
  },
  {
    "text": "If a subscription expires because the billing retry period ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1142"
  },
  {
    "text": "has ended without a successful recovery, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1145"
  },
  {
    "text": "you will receive EXPIRED with a substate of BILLING_RETRY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1147"
  },
  {
    "text": "Additionally, if a subscription expires because the customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1151"
  },
  {
    "text": "has not consented to a price increase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1155"
  },
  {
    "text": "you'll receive EXPIRED with a substate of PRICE_INCREASE. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1157"
  },
  {
    "text": "So combining the v2 notification types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1161"
  },
  {
    "text": "plus their applicable substates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1164"
  },
  {
    "text": "we now cover over 20 different ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1165"
  },
  {
    "text": "customer life cycle events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1168"
  },
  {
    "text": "Just looking at the notification type should be enough ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1170"
  },
  {
    "text": "to get a general idea of what has changed in your purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1173"
  },
  {
    "text": "but looking at the substate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1176"
  },
  {
    "text": "will help you get a more specific state ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1178"
  },
  {
    "text": "if you want to go into more detail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1180"
  },
  {
    "text": "Now let's take a quick look at the new payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1182"
  },
  {
    "text": "For v2 notifications we will always include ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1186"
  },
  {
    "text": "the same set of fields, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1188"
  },
  {
    "text": "regardless of the notification type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1190"
  },
  {
    "text": "The notification type, the subtype, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1192"
  },
  {
    "text": "the notification version, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1195"
  },
  {
    "text": "which will be 2 if you subscribed to v2 notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1196"
  },
  {
    "text": "the environment the notification applies to, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1200"
  },
  {
    "text": "some app metadata like bundle ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1203"
  },
  {
    "text": "the app Apple ID, and bundle version, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1206"
  },
  {
    "text": "the latest transaction for the affected in-app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1209"
  },
  {
    "text": "in our new signedTransactionInfo format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1212"
  },
  {
    "text": "and the latest renewal info for the in-app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1214"
  },
  {
    "text": "in our new signedRenewalInfo format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1216"
  },
  {
    "text": "These changes will make the notifications easier to parse ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1218"
  },
  {
    "text": "and hopefully easier to adopt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1222"
  },
  {
    "text": "as they make use of our new signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1224"
  },
  {
    "text": "and only contain information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1226"
  },
  {
    "text": "about the affected in-app purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1228"
  },
  {
    "text": "As I mentioned earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1230"
  },
  {
    "text": "the entire payload will be signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1232"
  },
  {
    "text": "to increase the security and trustworthiness ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1233"
  },
  {
    "text": "of our notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1235"
  },
  {
    "text": "The payload we just saw is unsigned for readability, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1237"
  },
  {
    "text": "but the signing will be similar ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1240"
  },
  {
    "text": "to how we are signing transactions and renewal info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1242"
  },
  {
    "text": "in a JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1244"
  },
  {
    "text": "We want you to be able to opt in to v2 notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1246"
  },
  {
    "text": "when you're ready. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1249"
  },
  {
    "text": "For this reason, we're adding an option ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1250"
  },
  {
    "text": "to the notification URL in App Store Connect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1252"
  },
  {
    "text": "to allow you to select ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1255"
  },
  {
    "text": "your App Store server notification version. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1256"
  },
  {
    "text": "To do this, go to your App's page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1259"
  },
  {
    "text": "and scroll to the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1262"
  },
  {
    "text": "App Store Server Notifications section. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1263"
  },
  {
    "text": "If you select the production server URL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1266"
  },
  {
    "text": "you now have the option to choose version 1 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1269"
  },
  {
    "text": "or version 2 App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1271"
  },
  {
    "text": "When these changes launch later this year, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1275"
  },
  {
    "text": "you'll be able to opt in ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1277"
  },
  {
    "text": "to version 2 App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1278"
  },
  {
    "text": "So now, I want to go over some example scenarios ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1281"
  },
  {
    "text": "using our new App Store server notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1284"
  },
  {
    "text": "starting with the first-time purchase of a subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1286"
  },
  {
    "text": "For a first-time subscription purchase in your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1290"
  },
  {
    "text": "you'll receive a signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1292"
  },
  {
    "text": "as a result of the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1294"
  },
  {
    "text": "You can choose to verify this on your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1296"
  },
  {
    "text": "and send the originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1299"
  },
  {
    "text": "and other relevant fields to your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1301"
  },
  {
    "text": "or send the signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1303"
  },
  {
    "text": "to your server for verification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1305"
  },
  {
    "text": "and choose which fields to store in your database at that time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1307"
  },
  {
    "text": "Around the same time, you'll receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1310"
  },
  {
    "text": "a SUBSCRIBED notification with a substate of INITIAL_BUY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1312"
  },
  {
    "text": "Now that the signed transaction info in the notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1316"
  },
  {
    "text": "contains the app account token, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1319"
  },
  {
    "text": "you can immediately link this notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1321"
  },
  {
    "text": "to your in-app user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1323"
  },
  {
    "text": "even if communication is lost between your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1324"
  },
  {
    "text": "and your app after the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1327"
  },
  {
    "text": "There's no need to call our server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1329"
  },
  {
    "text": "to verify the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1331"
  },
  {
    "text": "You may call our server at any time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1333"
  },
  {
    "text": "if you wish to check the status or in-app purchase history API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1335"
  },
  {
    "text": "by sending us the originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1339"
  },
  {
    "text": "Now I've covered purchasing a subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1342"
  },
  {
    "text": "Let's move onto subscription renewal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1345"
  },
  {
    "text": "Now we've reached the renewal of this subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1347"
  },
  {
    "text": "If this subscription renews successfully, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1350"
  },
  {
    "text": "you will receive a notification type DID_RENEW. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1352"
  },
  {
    "text": "You can look at the signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1355"
  },
  {
    "text": "and the signed renewal info in the payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1358"
  },
  {
    "text": "to verify the next renewal date of your subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1360"
  },
  {
    "text": "and your customer's renewal preferences ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1362"
  },
  {
    "text": "for their next renewal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1365"
  },
  {
    "text": "You can also schedule a job ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1367"
  },
  {
    "text": "to call our subscription status API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1368"
  },
  {
    "text": "to check the status of your subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1370"
  },
  {
    "text": "at its renewal time as a fail-over mechanism. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1372"
  },
  {
    "text": "Once again, there's no need to call us ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1375"
  },
  {
    "text": "to verify the transaction you receive in the notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1378"
  },
  {
    "text": "Of course, auto-renew doesn't always go according to plan, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1381"
  },
  {
    "text": "especially if there is a billing issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1385"
  },
  {
    "text": "So now, I want to cover grace period and billing retry. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1387"
  },
  {
    "text": "Now let's suppose that your subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1391"
  },
  {
    "text": "did not renew as expected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1393"
  },
  {
    "text": "When this happens, we notify you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1395"
  },
  {
    "text": "with a DID_FAIL_TO_RENEW notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1396"
  },
  {
    "text": "If you have grace period enabled ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1399"
  },
  {
    "text": "and the subscription exits the grace period ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1401"
  },
  {
    "text": "without renewing successfully, we send you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1403"
  },
  {
    "text": "a GRACE_PERIOD_EXPIRED notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1406"
  },
  {
    "text": "and you can know that your customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1408"
  },
  {
    "text": "has entered the billing retry period. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1410"
  },
  {
    "text": "If the subscription still is not recovered ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1412"
  },
  {
    "text": "during the billing retry period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1414"
  },
  {
    "text": "we'll send you an EXPIRED notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1416"
  },
  {
    "text": "with a substage of BILLING_RETRY. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1418"
  },
  {
    "text": "If we recover the billing of the subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1421"
  },
  {
    "text": "during the grace period or the billing retry period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1423"
  },
  {
    "text": "we'll send you a DID_RECOVER notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1426"
  },
  {
    "text": "No matter the outcome of the renewal, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1429"
  },
  {
    "text": "we notify you of the result with a v2 notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1431"
  },
  {
    "text": "containing a signed transaction info and signed renewal info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1435"
  },
  {
    "text": "You can call the subscription status or history API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1439"
  },
  {
    "text": "at any point in this process ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1441"
  },
  {
    "text": "to double check your subscription status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1443"
  },
  {
    "text": "Now, we realize subscriptions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1446"
  },
  {
    "text": "are not the only thing customers will purchase in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1448"
  },
  {
    "text": "So now let's pivot and cover what to expect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1451"
  },
  {
    "text": "during a first-time purchase of a consumable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1454"
  },
  {
    "text": "For a first-time purchase for a consumable on your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1456"
  },
  {
    "text": "you'll receive a signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1459"
  },
  {
    "text": "as a result of the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1462"
  },
  {
    "text": "You can choose to verify this on your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1463"
  },
  {
    "text": "and send the originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1465"
  },
  {
    "text": "and other relevant fields to your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1468"
  },
  {
    "text": "or send the signed transaction info to your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1470"
  },
  {
    "text": "for verification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1472"
  },
  {
    "text": "and choose which fields to store in your database at that time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1474"
  },
  {
    "text": "Keep note of the originalTransactionId always, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1477"
  },
  {
    "text": "as you might need it later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1480"
  },
  {
    "text": "For consumables and other content types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1482"
  },
  {
    "text": "like non-consumables and non-renewing subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1484"
  },
  {
    "text": "not much changes over the life cycle of that purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1487"
  },
  {
    "text": "unless the customer requests a refund. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1490"
  },
  {
    "text": "So I want to cover that case now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1493"
  },
  {
    "text": "Now, suppose your customer requests a refund ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1496"
  },
  {
    "text": "for their consumable purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1498"
  },
  {
    "text": "We'll send you a REFUND notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1500"
  },
  {
    "text": "containing the revocation date and revocation reason ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1502"
  },
  {
    "text": "in the signed transaction info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1506"
  },
  {
    "text": "You can know to stop providing access ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1508"
  },
  {
    "text": "to the consumable purchase after the revocation date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1510"
  },
  {
    "text": "Should you be concerned about the status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1513"
  },
  {
    "text": "of your consumable purchase at any time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1515"
  },
  {
    "text": "you can call the in-app history API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1517"
  },
  {
    "text": "and look for it in the response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1519"
  },
  {
    "text": "Canceled consumables will always be included, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1521"
  },
  {
    "text": "so you will know if the transaction status has changed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1524"
  },
  {
    "text": "Now I want to talk about outages. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1527"
  },
  {
    "text": "Sometimes, despite best efforts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1530"
  },
  {
    "text": "you may experience an outage on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1532"
  },
  {
    "text": "Now I'll cover how you can help your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1534"
  },
  {
    "text": "recover from an outage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1536"
  },
  {
    "text": "If you experience an outage on your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1538"
  },
  {
    "text": "and you miss App Store server notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1540"
  },
  {
    "text": "you'll want to know what has changed in the interim. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1543"
  },
  {
    "text": "The in-app history API is your solution here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1546"
  },
  {
    "text": "Simply call the API for each customer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1549"
  },
  {
    "text": "providing any originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1551"
  },
  {
    "text": "from your app, and you'll get ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1554"
  },
  {
    "text": "the latest history of transactions for your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1555"
  },
  {
    "text": "so you can update your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1557"
  },
  {
    "text": "You can then call the subscription status API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1560"
  },
  {
    "text": "to get the latest subscription status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1562"
  },
  {
    "text": "for each of your subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1564"
  },
  {
    "text": "Now I want to cover one final case-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1566"
  },
  {
    "text": "migrating to signed transactions on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1569"
  },
  {
    "text": "This is especially important ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1571"
  },
  {
    "text": "if you'll be ready to update your server before your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1573"
  },
  {
    "text": "or if you're still receiving the unified app receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1575"
  },
  {
    "text": "from older versions of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1578"
  },
  {
    "text": "Migrating to signed transactions on your server is easy, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1579"
  },
  {
    "text": "as it only requires an originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1583"
  },
  {
    "text": "You can easily convert the unified app receipts ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1586"
  },
  {
    "text": "your server receives from your app to JWS receipts ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1588"
  },
  {
    "text": "so your server can be compatible with our App Store server APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1592"
  },
  {
    "text": "and App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1595"
  },
  {
    "text": "To do this, first call verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1598"
  },
  {
    "text": "with the unified app receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1600"
  },
  {
    "text": "and pull all of the unique originalTransactionIds ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1602"
  },
  {
    "text": "from the response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1605"
  },
  {
    "text": "Call the in-app purchase history API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1606"
  },
  {
    "text": "for one of these originalTransactionIds ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1608"
  },
  {
    "text": "to get the history for your app in signed transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1610"
  },
  {
    "text": "Then call the subscription status API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1614"
  },
  {
    "text": "for a subscription originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1616"
  },
  {
    "text": "to get signed transactions and signedRenewalInformation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1619"
  },
  {
    "text": "for all of your customer subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1622"
  },
  {
    "text": "Write down any relevant data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1624"
  },
  {
    "text": "from the payload of the signed transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1626"
  },
  {
    "text": "and you're all set to continue using these APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1628"
  },
  {
    "text": "and to receive v2 App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1631"
  },
  {
    "text": "So now I've covered all of the changes we have coming ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1634"
  },
  {
    "text": "for App Store Server Notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1637"
  },
  {
    "text": "and how you can use notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1639"
  },
  {
    "text": "to check your customer status.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1640"
  },
  {
    "text": "Now I want to talk about how we are making it ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1644"
  },
  {
    "text": "even easier for you to manage family sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1646"
  },
  {
    "text": "for in-app purchases from your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1649"
  },
  {
    "text": "Family sharing for in-app purchases is currently supported ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1651"
  },
  {
    "text": "for auto-renewable subscriptions and non-consumable purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1655"
  },
  {
    "text": "if you have enabled family sharing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1658"
  },
  {
    "text": "for that in-app purchase in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1660"
  },
  {
    "text": "Right now, we provide a field called inAppOwnershipType ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1663"
  },
  {
    "text": "to indicate if a transaction is family shared or purchased, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1667"
  },
  {
    "text": "and we support a subset of notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1671"
  },
  {
    "text": "for family members: REVOKE, DID_RECOVER, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1673"
  },
  {
    "text": "and DID_FAIL_TO_RENEW. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1676"
  },
  {
    "text": "The in-app ownership type field ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1678"
  },
  {
    "text": "and the existing supported notification types ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1680"
  },
  {
    "text": "will remain with our new signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1683"
  },
  {
    "text": "and App Store server notifications v2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1685"
  },
  {
    "text": "However, coming later this year, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1688"
  },
  {
    "text": "we're adding more support for App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1690"
  },
  {
    "text": "for family members. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1693"
  },
  {
    "text": "For v1 notifications, we're adding ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1694"
  },
  {
    "text": "DID_CHANGE_RENEWAL_STATUS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1697"
  },
  {
    "text": "DID_CHANGE_RENEWAL_PREF, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1699"
  },
  {
    "text": "DID_RENEW, and INTERACTIVE_RENEWAL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1701"
  },
  {
    "text": "For v2 notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1704"
  },
  {
    "text": "we're adding even more support for family members. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1706"
  },
  {
    "text": "In addition to DID_CHANGE_RENEWAL_STATUS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1708"
  },
  {
    "text": "DID_CHANGE_RENEWAL_PREF, and DID_RENEW, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1711"
  },
  {
    "text": "we're adding support for SUBSCRIBED, EXPIRED, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1714"
  },
  {
    "text": "GRACE_PERIOD_EXPIRED, and OFFER_REDEEMED ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1717"
  },
  {
    "text": "for purchasers as well as for family members. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1721"
  },
  {
    "text": "This will make it even easier for you to track the status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1724"
  },
  {
    "text": "of all your customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1727"
  },
  {
    "text": "both purchasers and family members, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1729"
  },
  {
    "text": "through App Store server notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1731"
  },
  {
    "text": "So with the changes we have coming for notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1733"
  },
  {
    "text": "for family members this year, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1736"
  },
  {
    "text": "this should make managing family sharing for in-app purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1737"
  },
  {
    "text": "even easier for you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1740"
  },
  {
    "text": "when coupled with our existing family sharing functionality. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1742"
  },
  {
    "text": "Now I want to wrap up with one more thing: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1746"
  },
  {
    "text": "testing your server in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1749"
  },
  {
    "text": "We want you to feel confident in your app and your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1751"
  },
  {
    "text": "So we want you to be able ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1754"
  },
  {
    "text": "to integrate with our new App Store Server APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1756"
  },
  {
    "text": "and App Store server notifications in sandbox ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1759"
  },
  {
    "text": "before production. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1761"
  },
  {
    "text": "For the App Store Server APIs we discussed today, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1763"
  },
  {
    "text": "that means that they are fully testable in sandbox, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1766"
  },
  {
    "text": "and live, starting now! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1768"
  },
  {
    "text": "This includes the subscription status API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1771"
  },
  {
    "text": "and the in-app purchase history API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1773"
  },
  {
    "text": "In addition to this, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1775"
  },
  {
    "text": "we're adding a few other new features in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1777"
  },
  {
    "text": "Coming later this year, you will be able to add ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1780"
  },
  {
    "text": "a sandbox-specific notification URL in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1782"
  },
  {
    "text": "With this addition, you can keep your production ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1786"
  },
  {
    "text": "and sandbox notifications completely separate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1789"
  },
  {
    "text": "Additionally, you'll also be able to choose ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1792"
  },
  {
    "text": "your sandbox notification version ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1795"
  },
  {
    "text": "so you can test v2 notifications in sandbox before production. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1797"
  },
  {
    "text": "Last year, we brought you some exciting sandbox improvements, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1802"
  },
  {
    "text": "like resetting trial eligibility ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1805"
  },
  {
    "text": "and providing a Manage Subscriptions page in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1807"
  },
  {
    "text": "We want to continue making testing in sandbox easier ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1811"
  },
  {
    "text": "and are adding a few new enhancements this year. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1814"
  },
  {
    "text": "These are clearing purchase history for a sandbox Apple ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1817"
  },
  {
    "text": "changing sandbox account region, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1822"
  },
  {
    "text": "and adjusting subscription renewal rate in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1824"
  },
  {
    "text": "Additionally, as a security enhancement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1827"
  },
  {
    "text": "we are returning an error from verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1830"
  },
  {
    "text": "for TestFlight receipts ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1833"
  },
  {
    "text": "when we detect the customer is no longer a TestFlight user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1834"
  },
  {
    "text": "These new sandbox enhancements will be accessible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1838"
  },
  {
    "text": "from the Sandbox Testers page in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1840"
  },
  {
    "text": "To clear purchase history, select edit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1843"
  },
  {
    "text": "then toggle a tester, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1846"
  },
  {
    "text": "and select the clear purchase history button. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1848"
  },
  {
    "text": "Once you confirm clearing purchase history for a tester, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1851"
  },
  {
    "text": "the action cannot be reversed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1854"
  },
  {
    "text": "So remember the testers you've selected this option for. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1856"
  },
  {
    "text": "Clearing purchase history ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1860"
  },
  {
    "text": "is a powerful new testing tool for you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1861"
  },
  {
    "text": "that enables you to purchase something again ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1863"
  },
  {
    "text": "without creating a new account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1865"
  },
  {
    "text": "It also allows you to have a fresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1868"
  },
  {
    "text": "empty receipt for testing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1869"
  },
  {
    "text": "To change account region ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1872"
  },
  {
    "text": "or adjust subscription renewal rate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1873"
  },
  {
    "text": "navigate back to the testers page ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1875"
  },
  {
    "text": "and select a tester row.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1877"
  },
  {
    "text": "In the tester settings, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1881"
  },
  {
    "text": "you will see the new options to change App Store region ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1882"
  },
  {
    "text": "and to adjust subscription renewal rate.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1885"
  },
  {
    "text": "You can change the account region for a tester ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1889"
  },
  {
    "text": "by selecting the desired region. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1891"
  },
  {
    "text": "This makes it possible to test in 175 storefronts in sandbox, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1894"
  },
  {
    "text": "all with one tester account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1899"
  },
  {
    "text": "Our final new sandbox feature ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1902"
  },
  {
    "text": "is adjusting your subscription renewal rate in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1903"
  },
  {
    "text": "To edit this, select your desired renewal rate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1907"
  },
  {
    "text": "from the drop-down. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1910"
  },
  {
    "text": "Right now, a month correlates to 5 minutes in sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1911"
  },
  {
    "text": "We'll give you some more options ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1915"
  },
  {
    "text": "to adjust the renewal rate for your testers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1916"
  },
  {
    "text": "Adjusting the subscription renewal rate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1920"
  },
  {
    "text": "gives you more time to do things like cancel, upgrade, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1922"
  },
  {
    "text": "or downgrade a subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1925"
  },
  {
    "text": "and it allows you to rapidly speed up renewals ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1927"
  },
  {
    "text": "to simulate longer-term customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1929"
  },
  {
    "text": "That is everything we have coming to sandbox this year. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1932"
  },
  {
    "text": "We hope you love testing with these new features. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1935"
  },
  {
    "text": "So we've covered a lot of new information today, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1938"
  },
  {
    "text": "and now I want you to be able to explore all of it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1940"
  },
  {
    "text": "I hope you take some time to update your apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1943"
  },
  {
    "text": "and servers to adopt our new JWS receipts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1945"
  },
  {
    "text": "Make use of our new App Store Server APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1949"
  },
  {
    "text": "especially in sandbox, where they are live right now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1951"
  },
  {
    "text": "And enroll in App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1954"
  },
  {
    "text": "if you haven't already ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1956"
  },
  {
    "text": "and get ready for the v2 update coming later this year. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1958"
  },
  {
    "text": "Our new sandbox enhancements are also coming later this year. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1962"
  },
  {
    "text": "Make use of these to enhance your sandbox testing experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1965"
  },
  {
    "text": "Finally, check out the other two sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1969"
  },
  {
    "text": "from this year in this series, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1971"
  },
  {
    "text": "\"Meet StoreKit 2\" and \"Support customers and handle refunds.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1973"
  },
  {
    "text": "For more background on App Store server notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1977"
  },
  {
    "text": "and how you can set them up, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1980"
  },
  {
    "text": "check out \"What's new with in-app purchase\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1982"
  },
  {
    "text": "from WWDC 2020 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1984"
  },
  {
    "text": "and \"In-app purchases and using server-to-server notifications\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1986"
  },
  {
    "text": "from WWDC 2019. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1989"
  },
  {
    "text": "Our receipts, APIs, and notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1992"
  },
  {
    "text": "are three powerful tools you have ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1995"
  },
  {
    "text": "to manage your in-app purchases from your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=1998"
  },
  {
    "text": "By taking advantage of these, you can make your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2000"
  },
  {
    "text": "and your app more powerful than ever. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2003"
  },
  {
    "text": "Please take advantage of all the new features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2005"
  },
  {
    "text": "we've gone over today, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2008"
  },
  {
    "text": "and we look forward to hearing your feedback. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2009"
  },
  {
    "text": "Thanks so much for listening today, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2011"
  },
  {
    "text": "and enjoy the rest of WWDC. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2013"
  },
  {
    "text": "[upbeat music]",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10174/?time=2017"
  }
]