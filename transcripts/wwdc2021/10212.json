[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=0"
  },
  {
    "text": "Welcome! My name is Kacper. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=9"
  },
  {
    "text": "I'm a Performance Tools Engineer at Apple, and today, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=11"
  },
  {
    "text": "together with Sergio, we'll be talking about the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=14"
  },
  {
    "text": "HTTP Traffic Instrument available in Instruments 13. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=16"
  },
  {
    "text": "This Instrument, contained in the Network template, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=22"
  },
  {
    "text": "allows you to inspect HTTP traffic ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=25"
  },
  {
    "text": "coming from your application ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=27"
  },
  {
    "text": "through the Apple Networking stack.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=28"
  },
  {
    "text": "This approach comes with multiple benefits. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=32"
  },
  {
    "text": "It just works on all Apple devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=35"
  },
  {
    "text": "The entire traffic going through the URL loading system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=38"
  },
  {
    "text": "is exposed, even the ones sent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=41"
  },
  {
    "text": "with the new HTTP/3 protocol or over VPN. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=43"
  },
  {
    "text": "Because of the system integration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=48"
  },
  {
    "text": "it attributes traffic to processes running on it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=49"
  },
  {
    "text": "and since it's instrumenting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=53"
  },
  {
    "text": "Apple Networking frameworks, it even reveals requests ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=54"
  },
  {
    "text": "hitting the on-disk cache or networking errors. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=57"
  },
  {
    "text": "All of this exposed in the context ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=60"
  },
  {
    "text": "of higher-level API concepts that you are familiar with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=62"
  },
  {
    "text": "such as URLSessions and URLSessionTasks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=66"
  },
  {
    "text": "This tool will help you understand ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=70"
  },
  {
    "text": "how your usage of the API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=71"
  },
  {
    "text": "translates to the lifetime of network requests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=73"
  },
  {
    "text": "In this hands-on session, we will first get you familiar ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=77"
  },
  {
    "text": "with how the Instruments UI reflects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=80"
  },
  {
    "text": "the API concepts you are using.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=82"
  },
  {
    "text": "After this quick introduction, we will transition to four demos ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=85"
  },
  {
    "text": "that will illustrate how you can use the tool ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=89"
  },
  {
    "text": "to detect both performance and correctness problems. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=91"
  },
  {
    "text": "And even if your app seems to work flawlessly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=95"
  },
  {
    "text": "you will learn how to verify that it does ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=98"
  },
  {
    "text": "what you think by auditing the traffic coming from it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=101"
  },
  {
    "text": "Let's get started with how the Networking API maps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=105"
  },
  {
    "text": "to the Instruments visualization. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=108"
  },
  {
    "text": "This is how the HTTP Traffic trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=110"
  },
  {
    "text": "is displayed in Instruments when I recorded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=112"
  },
  {
    "text": "my system traffic using the Network template. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=115"
  },
  {
    "text": "Navigation is structured around the track hierarchy, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=118"
  },
  {
    "text": "and that's what we will cover in detail first. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=121"
  },
  {
    "text": "The HTTP Traffic Instrument located at the top level ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=124"
  },
  {
    "text": "shows you an overview of how many ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=127"
  },
  {
    "text": "URLSession tasks were running in your trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=129"
  },
  {
    "text": "at any given time, ideal for detecting spots ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=132"
  },
  {
    "text": "with increased HTTP Traffic activity in your app's lifetime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=135"
  },
  {
    "text": "The next hierarchy level shows a breakdown ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=139"
  },
  {
    "text": "of activity by process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=141"
  },
  {
    "text": "In addition to traffic from all of the debuggable processes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=144"
  },
  {
    "text": "it allows you to inspect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=147"
  },
  {
    "text": "background traffic initiated by them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=148"
  },
  {
    "text": "Contained below each process are all URLSessions used by it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=151"
  },
  {
    "text": "And these correspond ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=155"
  },
  {
    "text": "to the URLSession objects you create in code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=156"
  },
  {
    "text": "The graph at this level allows you to inspect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=160"
  },
  {
    "text": "all individual task intervals. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=163"
  },
  {
    "text": "To get a better mapping between your session objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=166"
  },
  {
    "text": "and the visualization, you can name them in code by setting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=168"
  },
  {
    "text": "the sessionDescription property on a session instance.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=172"
  },
  {
    "text": "On the last level, the traffic is broken down ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=177"
  },
  {
    "text": "by requested domains. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=180"
  },
  {
    "text": "Graphs on this level show more details about tasks, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=182"
  },
  {
    "text": "including individual transactions that make up ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=185"
  },
  {
    "text": "the tasks and their states.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=188"
  },
  {
    "text": "To get a better understanding of what tasks ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=192"
  },
  {
    "text": "and transactions are, let's analyze an example.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=194"
  },
  {
    "text": "Here are a few tasks that are loading data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=201"
  },
  {
    "text": "from the selected domain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=203"
  },
  {
    "text": "Let's focus on one of them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=205"
  },
  {
    "text": "to analyze the structure of a task.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=206"
  },
  {
    "text": "This single task interval has a lot of information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=212"
  },
  {
    "text": "We can represent this in a more abstract manner to understand ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=215"
  },
  {
    "text": "how Instruments visualization maps to the API being used.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=219"
  },
  {
    "text": "At the top level, we have a task object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=225"
  },
  {
    "text": "A task is made up of one or more transactions.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=229"
  },
  {
    "text": "A transaction is a pair of an HTTP request ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=234"
  },
  {
    "text": "and the corresponding response.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=237"
  },
  {
    "text": "The task level is the representation of how ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=242"
  },
  {
    "text": "your code interacts with the API of the URL Loading System. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=244"
  },
  {
    "text": "When you create a task and call resume on it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=248"
  },
  {
    "text": "the task interval starts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=251"
  },
  {
    "text": "And it ends ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=254"
  },
  {
    "text": "right before your completion block is called.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=255"
  },
  {
    "text": "Each task can be given a semantic name using ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=260"
  },
  {
    "text": "the taskDescription property, which will be used ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=263"
  },
  {
    "text": "to label the interval in Instruments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=267"
  },
  {
    "text": "We also show the task identifier as part of the task label. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=270"
  },
  {
    "text": "You can use it to cross-reference ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=275"
  },
  {
    "text": "the task with other data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=276"
  },
  {
    "text": "If your task finishes with an error, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=279"
  },
  {
    "text": "its description will be presented ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=282"
  },
  {
    "text": "on the interval label for easier debugging. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=283"
  },
  {
    "text": "As we mentioned before, a task can be made up ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=287"
  },
  {
    "text": "of multiple transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=290"
  },
  {
    "text": "Let's talk about these now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=292"
  },
  {
    "text": "Here we have a task to load the start page of apple.com. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=294"
  },
  {
    "text": "However, this URL is not the canonical URL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=299"
  },
  {
    "text": "The task requests apple.com, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=303"
  },
  {
    "text": "but the preferred domain is www.apple.com. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=305"
  },
  {
    "text": "When we create this task, the URL loading system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=310"
  },
  {
    "text": "initially creates a request to apple.com. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=312"
  },
  {
    "text": "Shortly after, it receives a redirect response ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=317"
  },
  {
    "text": "from the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=319"
  },
  {
    "text": "stating that the preferred URL is actually www.apple.com.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=321"
  },
  {
    "text": "By default, we follow redirects, so instead of returning ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=327"
  },
  {
    "text": "the 301 response, the URL loading system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=330"
  },
  {
    "text": "will create a new transaction to now load the preferred URL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=333"
  },
  {
    "text": "The response from this second, successful transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=338"
  },
  {
    "text": "is what is returned back to the task.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=341"
  },
  {
    "text": "As mentioned before, a transaction represents ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=346"
  },
  {
    "text": "the combination of the HTTP request and response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=349"
  },
  {
    "text": "It aligns with what URLSession does under the hood ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=353"
  },
  {
    "text": "to handle your task ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=356"
  },
  {
    "text": "and contains all of the information of the HTTP layer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=358"
  },
  {
    "text": "like the requested URL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=362"
  },
  {
    "text": "information about the transferred data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=363"
  },
  {
    "text": "and much more.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=365"
  },
  {
    "text": "Just like for the task, the transaction label ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=368"
  },
  {
    "text": "gives you an overview of the transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=371"
  },
  {
    "text": "Mainly, you get information about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=374"
  },
  {
    "text": "the request and the response.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=376"
  },
  {
    "text": "The track hierarchy tells you the domain ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=380"
  },
  {
    "text": "that is requested, while you can find ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=382"
  },
  {
    "text": "the path and query on the label itself.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=384"
  },
  {
    "text": "In addition to that, the interval label ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=388"
  },
  {
    "text": "displays the HTTP version, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=391"
  },
  {
    "text": "the HTTP Method, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=394"
  },
  {
    "text": "and whether the request sent an Authorization ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=396"
  },
  {
    "text": "or a Cookie header. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=399"
  },
  {
    "text": "These are often useful to understand ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=401"
  },
  {
    "text": "authentication flows at a glance.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=403"
  },
  {
    "text": "For the response, you get the status code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=407"
  },
  {
    "text": "whether the response contained a cookie, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=410"
  },
  {
    "text": "and the content type of the response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=413"
  },
  {
    "text": "How long the request and the response took, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=417"
  },
  {
    "text": "as well as more detailed timing information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=419"
  },
  {
    "text": "about other work that is part of the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=422"
  },
  {
    "text": "is captured by the transaction states. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=425"
  },
  {
    "text": "Let's analyze them in the context ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=428"
  },
  {
    "text": "of a containing task. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=429"
  },
  {
    "text": "The start of the transaction is the point in time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=432"
  },
  {
    "text": "when the URL Loading System ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=435"
  },
  {
    "text": "creates the transaction for making this request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=437"
  },
  {
    "text": "It first checks whether we have a valid cached response already. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=441"
  },
  {
    "text": "And if that's not the case, it will try to schedule ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=445"
  },
  {
    "text": "the request on a connection.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=447"
  },
  {
    "text": "Next, the transaction may have to wait a bit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=452"
  },
  {
    "text": "in the Blocked state, waiting for an available connection.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=454"
  },
  {
    "text": "The Sending Request state starts when the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=460"
  },
  {
    "text": "is finally handled by a connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=463"
  },
  {
    "text": "It ends once we send the last byte ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=466"
  },
  {
    "text": "of the request onto the network. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=468"
  },
  {
    "text": "Next, the transaction goes into an idle ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=471"
  },
  {
    "text": "Waiting for Response state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=474"
  },
  {
    "text": "followed by Receiving Response, which will track the span ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=476"
  },
  {
    "text": "from the first to the last byte received from the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=479"
  },
  {
    "text": "The whole transaction will complete shortly ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=484"
  },
  {
    "text": "after the last byte is received, once the URL Loading system ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=486"
  },
  {
    "text": "has determined whether this was a successful response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=490"
  },
  {
    "text": "In practice, the cache lookup and sending state ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=494"
  },
  {
    "text": "for a GET request are usually much shorter, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=497"
  },
  {
    "text": "so it's more likely to appear like this.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=500"
  },
  {
    "text": "To show you some practical examples, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=505"
  },
  {
    "text": "I would like to hand over to my colleague, Sergio. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=507"
  },
  {
    "text": "He will walk you through an app he recently started developing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=510"
  },
  {
    "text": "to illustrate how the HTTP Instrument can help you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=513"
  },
  {
    "text": "with fixing performance and correctness issues. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=516"
  },
  {
    "text": "Thanks, Kacper. Hello, everyone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=520"
  },
  {
    "text": "My name is Sergio Lopez, and I've been working ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=522"
  },
  {
    "text": "on this app for dog lovers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=524"
  },
  {
    "text": "Think of it like a social media platform but for dog pictures... ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=526"
  },
  {
    "text": "only! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=530"
  },
  {
    "text": "People can post images of dogs and you get ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=531"
  },
  {
    "text": "a stream of the most recent uploads! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=533"
  },
  {
    "text": "So when I open the app, it loads ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=535"
  },
  {
    "text": "several new dog images, but I noticed that it takes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=537"
  },
  {
    "text": "quite some time for them to finish loading.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=540"
  },
  {
    "text": "Let's profile the app with the new HTTP Traffic ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=545"
  },
  {
    "text": "instrument to help us improve this situation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=548"
  },
  {
    "text": "In the \"Product\" menu, I'll choose ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=552"
  },
  {
    "text": "the \"Profile\" option to profile my app in Instruments.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=554"
  },
  {
    "text": "This will build my app in the release configuration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=559"
  },
  {
    "text": "to ensure I'm profiling my app as it would run for my users, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=562"
  },
  {
    "text": "with all optimizations turned on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=565"
  },
  {
    "text": "Once the build is finished, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=569"
  },
  {
    "text": "Instruments will launch automatically. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=570"
  },
  {
    "text": "Upon starting, the standard template chooser ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=572"
  },
  {
    "text": "of Instruments is displayed.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=575"
  },
  {
    "text": "In our case, I wanna choose the Network ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=579"
  },
  {
    "text": "template on the bottom left, which gives us more information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=581"
  },
  {
    "text": "about general network connections my app makes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=584"
  },
  {
    "text": "but also contains the new HTTP Tracing functionality.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=586"
  },
  {
    "text": "The track area now contains two tracks, one for each instrument. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=598"
  },
  {
    "text": "The bottom track is the existing Network Connections instrument, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=603"
  },
  {
    "text": "and the top track is the new HTTP Traffic instrument. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=606"
  },
  {
    "text": "We'll focus on this new instrument today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=610"
  },
  {
    "text": "All I need to do now is hit \"record.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=613"
  },
  {
    "text": "Instruments will then start my app and start recording.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=615"
  },
  {
    "text": "Before you can use this tool, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=621"
  },
  {
    "text": "you need to confirm that you understand ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=623"
  },
  {
    "text": "the implications of capturing the networking traffic. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=625"
  },
  {
    "text": "It's very powerful, especially if you record all processes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=627"
  },
  {
    "text": "The data captured includes everything that is sent, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=631"
  },
  {
    "text": "which may be personal and sensitive information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=633"
  },
  {
    "text": "even up to user credentials. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=636"
  },
  {
    "text": "So, you should be very careful with the resulting trace files, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=638"
  },
  {
    "text": "and we want you to be aware. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=641"
  },
  {
    "text": "So let me confirm this.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=642"
  },
  {
    "text": "The app was launched ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=647"
  },
  {
    "text": "and the images were slow to load.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=648"
  },
  {
    "text": "I will now stop the recording.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=653"
  },
  {
    "text": "Let's zoom in to the data we recorded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=658"
  },
  {
    "text": "by using Option-click and dragging ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=659"
  },
  {
    "text": "over the area covering our HTTP traffic.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=661"
  },
  {
    "text": "Clicking on the disclosure indicator ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=668"
  },
  {
    "text": "in the \"HTTP Traffic\" track on the top left ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=670"
  },
  {
    "text": "will reveal the full track hierarchy ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=673"
  },
  {
    "text": "that Kacper described earlier.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=675"
  },
  {
    "text": "I'll also increase the track height to show all intervals.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=680"
  },
  {
    "text": "At the top, there's the first task ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=692"
  },
  {
    "text": "that queries the server for the list of images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=694"
  },
  {
    "text": "which appear on the \"Latest\" section of the app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=696"
  },
  {
    "text": "When this task completes, we create a new task to load ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=701"
  },
  {
    "text": "a thumbnail for every image on the list that we received.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=704"
  },
  {
    "text": "I will now click-drag over the area covering the time frame ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=709"
  },
  {
    "text": "it took to fetch the list of images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=712"
  },
  {
    "text": "followed by the many requests ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=715"
  },
  {
    "text": "to retrieve each individual image.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=716"
  },
  {
    "text": "By click-dragging over this area, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=724"
  },
  {
    "text": "a tool tip will be displayed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=726"
  },
  {
    "text": "showing the duration of the selected time range. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=727"
  },
  {
    "text": "Overall, it took more than 7 seconds ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=730"
  },
  {
    "text": "to finish loading the initial screen.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=732"
  },
  {
    "text": "The first few images load fairly quick. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=736"
  },
  {
    "text": "But as I scroll down, tasks that were started later ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=738"
  },
  {
    "text": "took longer to complete, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=741"
  },
  {
    "text": "as noted by the increasing blocked states in purple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=742"
  },
  {
    "text": "Seems like a congestion issue, where we have too many ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=746"
  },
  {
    "text": "requests in parallel. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=748"
  },
  {
    "text": "Let's investigate one of the later tasks.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=750"
  },
  {
    "text": "By hovering over the task, the tool tip shows us ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=757"
  },
  {
    "text": "the duration of the task ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=759"
  },
  {
    "text": "and any of the child intervals we are hovering over. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=761"
  },
  {
    "text": "This task was blocked for the majority of the time.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=764"
  },
  {
    "text": "To understand why it was blocked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=769"
  },
  {
    "text": "let's switch the track display ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=771"
  },
  {
    "text": "to the \"HTTP Transactions by Connection\" view.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=773"
  },
  {
    "text": "In the track sidebar on the left, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=778"
  },
  {
    "text": "under the domain name, there's a downwards arrow ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=779"
  },
  {
    "text": "we can click to switch the track display.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=782"
  },
  {
    "text": "Currently, we are drawing \"Tasks.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=787"
  },
  {
    "text": "Let's switch to displaying \"HTTP Transactions by Connection.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=790"
  },
  {
    "text": "This view will only display the transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=798"
  },
  {
    "text": "and instead of grouping them by task, we can now ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=801"
  },
  {
    "text": "find out which connection they got scheduled on.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=804"
  },
  {
    "text": "The transactions are grouped by the connection they used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=808"
  },
  {
    "text": "Overall, there were six connections ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=812"
  },
  {
    "text": "available to handle these transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=815"
  },
  {
    "text": "Let's analyze the transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=817"
  },
  {
    "text": "issued on Connection 1 and investigate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=819"
  },
  {
    "text": "some of the thumbnail loading transactions further. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=821"
  },
  {
    "text": "From the top down, it's noticeable ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=825"
  },
  {
    "text": "that each transaction is taking longer to complete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=827"
  },
  {
    "text": "The purple blocked state for each ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=829"
  },
  {
    "text": "successive transaction is increasing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=831"
  },
  {
    "text": "In fact, there's a pretty clear staircase pattern here.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=834"
  },
  {
    "text": "Each transaction is blocked, until the previous transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=839"
  },
  {
    "text": "on the same connection has finished. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=843"
  },
  {
    "text": "Only then can it send its request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=845"
  },
  {
    "text": "This pattern repeats for each subsequent transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=847"
  },
  {
    "text": "This is called \"Head of Line Blocking\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=851"
  },
  {
    "text": "and is one of the problems of using HTTP/1.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=854"
  },
  {
    "text": "The frustrating part is that these transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=858"
  },
  {
    "text": "aren't doing anything for the majority of the time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=861"
  },
  {
    "text": "Instead, they spend most of their time blocked or waiting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=863"
  },
  {
    "text": "for the response from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=866"
  },
  {
    "text": "We could be sending another request ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=868"
  },
  {
    "text": "for the next transaction in line while waiting for the response ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=870"
  },
  {
    "text": "of a previous transaction on the same connection, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=873"
  },
  {
    "text": "but that's not supported by HTTP/1. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=876"
  },
  {
    "text": "Head-of-line blocking is one of the main limitations ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=879"
  },
  {
    "text": "of HTTP/1, and one of the main improvements ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=882"
  },
  {
    "text": "of HTTP/2 is to avoid that effect by multiplexing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=885"
  },
  {
    "text": "several requests to the same server onto a single connection.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=888"
  },
  {
    "text": "In HTTP/2, we can actually start sending ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=894"
  },
  {
    "text": "a second request while the first one is waiting for its response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=896"
  },
  {
    "text": "Your app does not need to do anything to support it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=900"
  },
  {
    "text": "All Apple platforms support HTTP/2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=903"
  },
  {
    "text": "and starting in iOS 15 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=906"
  },
  {
    "text": "and macOS Monterey, HTTP/3 is supported as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=909"
  },
  {
    "text": "The client will pick the most modern HTTP version ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=913"
  },
  {
    "text": "the server supports. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=915"
  },
  {
    "text": "If you wanna learn more about the differences between HTTP/1 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=917"
  },
  {
    "text": "and HTTP/2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=921"
  },
  {
    "text": "and the additional benefits HTTP/3 provides, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=923"
  },
  {
    "text": "please watch the \"Accelerate networking ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=927"
  },
  {
    "text": "with HTTP/3 and QUIC\" session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=929"
  },
  {
    "text": "I've taken this trace, showed it to our server folks, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=933"
  },
  {
    "text": "and managed to convince them that we should ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=936"
  },
  {
    "text": "really support HTTP/2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=938"
  },
  {
    "text": "Now, let's run my app with the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=940"
  },
  {
    "text": "server enhancements.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=942"
  },
  {
    "text": "Wow, this already feels faster! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=945"
  },
  {
    "text": "Let's confirm this with Instruments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=948"
  },
  {
    "text": "So here's a trace I recorded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=950"
  },
  {
    "text": "after we turned on server support for HTTP/2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=951"
  },
  {
    "text": "In the domain-specific track, none of our thumbnail-loading ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=955"
  },
  {
    "text": "tasks seem to be blocked anymore for an extended amount of time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=958"
  },
  {
    "text": "That's good! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=961"
  },
  {
    "text": "Let's switch to the \"HTTP Transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=962"
  },
  {
    "text": "by Connection\" view again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=965"
  },
  {
    "text": "The first thing we notice is that there is ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=975"
  },
  {
    "text": "only one connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=977"
  },
  {
    "text": "This is because we no longer need multiple connections ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=978"
  },
  {
    "text": "to send concurrent requests, which also means we only need ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=981"
  },
  {
    "text": "to pay the connection setup cost once. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=984"
  },
  {
    "text": "Focusing on the individual thumbnail-loading transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=989"
  },
  {
    "text": "we notice that they basically spend ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=992"
  },
  {
    "text": "no time in the \"blocked\" state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=993"
  },
  {
    "text": "In fact, the amount of time is so small ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=995"
  },
  {
    "text": "that it's not visible at this zoom level. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=997"
  },
  {
    "text": "Eventually all transactions finish sending ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1000"
  },
  {
    "text": "their requests and are left waiting for a response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1003"
  },
  {
    "text": "As I scroll down, we can notice that responses ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1007"
  },
  {
    "text": "are making progress at the same time.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1010"
  },
  {
    "text": "All in all, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1014"
  },
  {
    "text": "we are done with all requests in under 3 seconds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1017"
  },
  {
    "text": "This is twice as fast as before. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1020"
  },
  {
    "text": "Now that I've talked to the server folks ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1022"
  },
  {
    "text": "and switched from HTTP/1.1 to HTTP/2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1024"
  },
  {
    "text": "our images are loading much faster. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1027"
  },
  {
    "text": "Let me relaunch the app and show you what else we can do. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1030"
  },
  {
    "text": "When I tap on an image, the app loads the full-resolution ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1034"
  },
  {
    "text": "picture and shows how far away this photo was taken from me. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1037"
  },
  {
    "text": "There's also a heart icon at the top right ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1041"
  },
  {
    "text": "that allows you to favorite that specific picture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1043"
  },
  {
    "text": "To do so, I need an account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1046"
  },
  {
    "text": "I allow people to use the app and browse the pictures ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1048"
  },
  {
    "text": "without an account, but to save favorited images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1050"
  },
  {
    "text": "sync them between devices, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1053"
  },
  {
    "text": "and to upload new pictures, you need an account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1055"
  },
  {
    "text": "So let me log in here.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1058"
  },
  {
    "text": "Great. Let me favorite another picture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1064"
  },
  {
    "text": "Oh, this dog looks cute! Let me add it to my favorites. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1067"
  },
  {
    "text": "Wait, why do I have to log in again if I just did? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1070"
  },
  {
    "text": "This isn't right. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1073"
  },
  {
    "text": "My app should remember my log-in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1074"
  },
  {
    "text": "This worked before. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1076"
  },
  {
    "text": "I'm gonna dismiss the log-in screen, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1077"
  },
  {
    "text": "as I don't want to log in again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1079"
  },
  {
    "text": "I previously recorded a trace file ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1083"
  },
  {
    "text": "after reproducing the issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1085"
  },
  {
    "text": "Let me open it with instruments to analyze the recording. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1087"
  },
  {
    "text": "On the left, there's the task that corresponds ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1089"
  },
  {
    "text": "to when I pressed the favorite button for the first time.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1092"
  },
  {
    "text": "To the right of it, there's the task that was ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1096"
  },
  {
    "text": "issued after I returned to the latest tab, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1098"
  },
  {
    "text": "and the stream of images were refreshed.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1101"
  },
  {
    "text": "Then, there's the task to load the full-resolution image ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1104"
  },
  {
    "text": "after I tapped on another dog picture.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1107"
  },
  {
    "text": "And to the far right, there's the task corresponding ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1111"
  },
  {
    "text": "to the second time I tapped the favorite button.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1114"
  },
  {
    "text": "The first task interval actually contains two transactions.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1117"
  },
  {
    "text": "The first transaction received a 401-status code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1127"
  },
  {
    "text": "This was expected since we were not logged in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1130"
  },
  {
    "text": "The transaction is drawn in orange to indicate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1133"
  },
  {
    "text": "that this is not a success on the HTTP level.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1136"
  },
  {
    "text": "Then, there's a large, empty area in the task, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1142"
  },
  {
    "text": "which represents the time I spent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1145"
  },
  {
    "text": "entering the user name and password.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1147"
  },
  {
    "text": "As soon as I'm done entering these credentials, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1155"
  },
  {
    "text": "we retry the transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1157"
  },
  {
    "text": "The green color of the interval and the 201-status code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1160"
  },
  {
    "text": "indicates it succeeded this time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1163"
  },
  {
    "text": "This interaction of an authentication challenge, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1165"
  },
  {
    "text": "entering a password, and retrying the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1168"
  },
  {
    "text": "is another case the URL Loading system handles for us, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1171"
  },
  {
    "text": "so these two transactions belong to the same task object.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1175"
  },
  {
    "text": "Zooming out, we find the second attempt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1181"
  },
  {
    "text": "at favoriting an image on the right. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1184"
  },
  {
    "text": "The task object is displayed in gray, as my dismissing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1186"
  },
  {
    "text": "of the log-in screen caused the task to be canceled, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1189"
  },
  {
    "text": "which is also visible in its label. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1193"
  },
  {
    "text": "The transaction interval is displayed in orange, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1195"
  },
  {
    "text": "as we got a 401 response from the server again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1198"
  },
  {
    "text": "This task occurred after I attempted to like ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1201"
  },
  {
    "text": "another dog picture and was ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1203"
  },
  {
    "text": "prompted with the log-in for a second time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1205"
  },
  {
    "text": "We use a very basic log-in system, where the user sends ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1208"
  },
  {
    "text": "their credentials the first time, but once the server ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1211"
  },
  {
    "text": "verified the user credentials, it sets a cookie, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1213"
  },
  {
    "text": "identifying the user, such that no credentials ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1216"
  },
  {
    "text": "need to be provided on following requests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1218"
  },
  {
    "text": "So I would've expected this task to have sent the proper cookie. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1221"
  },
  {
    "text": "Let's determine whether that happened. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1226"
  },
  {
    "text": "As Kacper explained earlier, there should be a small ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1227"
  },
  {
    "text": "cookie icon here next to the HTTP method, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1230"
  },
  {
    "text": "had this transaction sent a Cookie header. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1233"
  },
  {
    "text": "But there's no such icon here, which means no cookie was sent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1236"
  },
  {
    "text": "So that part isn't working. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1240"
  },
  {
    "text": "Now the question is, did the server not ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1241"
  },
  {
    "text": "provide us with a cookie, or is the client not ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1243"
  },
  {
    "text": "sending one, even though it got one? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1245"
  },
  {
    "text": "To find out, we need to investigate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1247"
  },
  {
    "text": "the previous transaction, and check ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1249"
  },
  {
    "text": "whether we got a cookie from the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1251"
  },
  {
    "text": "Here is the previous transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1253"
  },
  {
    "text": "the successful one from the first log-in request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1255"
  },
  {
    "text": "This one does have a cookie icon in the response portion ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1258"
  },
  {
    "text": "of the transaction label, so the server did send a cookie. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1261"
  },
  {
    "text": "That's interesting. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1265"
  },
  {
    "text": "So why didn't we send the cookie in the next transaction? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1267"
  },
  {
    "text": "To get more information about this transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1270"
  },
  {
    "text": "and investigate the cookie in detail, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1272"
  },
  {
    "text": "I will switch to the \"Transactions\" list ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1274"
  },
  {
    "text": "in the detail view at the bottom.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1276"
  },
  {
    "text": "The transaction is already selected here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1285"
  },
  {
    "text": "since the time cursor is placed inside of it in the track view.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1287"
  },
  {
    "text": "The extended detail view in the bottom right ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1292"
  },
  {
    "text": "shows all request and response headers ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1294"
  },
  {
    "text": "of the currently-selected transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1296"
  },
  {
    "text": "And here is the Set-Cookie header that we expect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1300"
  },
  {
    "text": "At first glance, this cookie seems fine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1303"
  },
  {
    "text": "But oh, wait, do you see the expiry date? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1307"
  },
  {
    "text": "It's March 2020. That's in the past! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1309"
  },
  {
    "text": "So the server did send a cookie, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1312"
  },
  {
    "text": "but it's an expired cookie. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1314"
  },
  {
    "text": "No one likes expired cookies! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1316"
  },
  {
    "text": "This will lead the URLSession to not send the cookie, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1319"
  },
  {
    "text": "as it will only send cookies that are still valid.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1321"
  },
  {
    "text": "This is a server-side bug. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1325"
  },
  {
    "text": "I could send the trace file over to our server folks ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1327"
  },
  {
    "text": "for them to investigate the issue and have it resolved. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1329"
  },
  {
    "text": "Now that we fixed the cookie issue, I can favorite ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1332"
  },
  {
    "text": "a couple more pictures without being prompted to log in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1335"
  },
  {
    "text": "In addition to the \"Latest\" tab, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1338"
  },
  {
    "text": "there's also a \"Favorite\" tab, where we display a list ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1340"
  },
  {
    "text": "of all the dog images that the user has favorited. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1342"
  },
  {
    "text": "Let's switch to that tab.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1345"
  },
  {
    "text": "Great, there are a few favorites here that I added yesterday, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1348"
  },
  {
    "text": "but for some reason, my recent favorites aren't showing up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1351"
  },
  {
    "text": "Let's try again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1354"
  },
  {
    "text": "Let's pick this dog, who seems to be enjoying a bath, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1356"
  },
  {
    "text": "and let me favorite it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1358"
  },
  {
    "text": "Let's go back to my favorites and check if it appears.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1360"
  },
  {
    "text": "Hm, it's still not there. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1365"
  },
  {
    "text": "Let's use Instruments again to figure out what's going on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1366"
  },
  {
    "text": "I prepared a trace file for this already. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1370"
  },
  {
    "text": "I expect to find a task loading the list of favorites ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1372"
  },
  {
    "text": "in the track view, but it's not visible at first glance. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1375"
  },
  {
    "text": "Let me choose the track for my server domain, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1379"
  },
  {
    "text": "to display only the requests issued to that domain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1382"
  },
  {
    "text": "We could then go to the detail view at the bottom, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1386"
  },
  {
    "text": "which contains a list of all tasks for this domain.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1389"
  },
  {
    "text": "There's quite a few requests here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1392"
  },
  {
    "text": "Let me use the detail filter at the bottom left ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1394"
  },
  {
    "text": "to search for all requests related to \"Favorites,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1397"
  },
  {
    "text": "so I can verify whether we even made a request.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1400"
  },
  {
    "text": "Upon filtering, the results show we sent ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1407"
  },
  {
    "text": "several requests to load the list of favorites here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1409"
  },
  {
    "text": "Let's focus on the track view.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1412"
  },
  {
    "text": "The cursor got positioned at the start of the task I selected ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1416"
  },
  {
    "text": "down in the detail view, so that makes it fairly easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1419"
  },
  {
    "text": "to find it in the track view above. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1422"
  },
  {
    "text": "Let's zoom in to double-check.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1425"
  },
  {
    "text": "So this was the first time we loaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1435"
  },
  {
    "text": "the list of favorites on the initial app launch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1436"
  },
  {
    "text": "This is fine.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1439"
  },
  {
    "text": "Here, I favorited a new image, and after that, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1446"
  },
  {
    "text": "we loaded the favorites again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1450"
  },
  {
    "text": "Well, there's a task interval here, but it's very short.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1455"
  },
  {
    "text": "Yeah, this GET request only took a couple of milliseconds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1465"
  },
  {
    "text": "That's too fast to get a server response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1467"
  },
  {
    "text": "Let's switch to the \"HTTP transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1470"
  },
  {
    "text": "by connection\" view again to get more details.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1473"
  },
  {
    "text": "The first thing we notice is that this transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1480"
  },
  {
    "text": "is not executed on a Connection, but on \"Local Cache.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1482"
  },
  {
    "text": "This shows us that the request was never sent on the network, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1485"
  },
  {
    "text": "but rather loaded from the local cache. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1488"
  },
  {
    "text": "This also explains why there is no \"Waiting for Response\" state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1491"
  },
  {
    "text": "since the transaction did not wait for a server.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1494"
  },
  {
    "text": "So that's the problem: our request is cached, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1499"
  },
  {
    "text": "so we don't actually ask the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1502"
  },
  {
    "text": "and always get the cached response back. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1503"
  },
  {
    "text": "One way to fix this would be to tell the server to set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1505"
  },
  {
    "text": "a cache-control header, to never cache this response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1507"
  },
  {
    "text": "What we want is to reload the images every time the user ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1510"
  },
  {
    "text": "goes to the favorites tab and new images have been added. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1513"
  },
  {
    "text": "What we don't want is to load the whole list ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1517"
  },
  {
    "text": "of images if there was no such change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1519"
  },
  {
    "text": "A good trade-off would be if we could ask the server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1522"
  },
  {
    "text": "\"Hey, did anything change? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1525"
  },
  {
    "text": "If so, please let me know.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1527"
  },
  {
    "text": "That's actually something we can do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1530"
  },
  {
    "text": "by setting a cache-policy on the request.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1531"
  },
  {
    "text": "To update the code, let me go back to the task view ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1535"
  },
  {
    "text": "and select the task in question.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1538"
  },
  {
    "text": "For each URLSession Task that got executed here...",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1548"
  },
  {
    "text": "We display the backtrace on the right, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1554"
  },
  {
    "text": "where \"resume\" was called on the task.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1556"
  },
  {
    "text": "It was resumed in the method sync, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1561"
  },
  {
    "text": "in the ImageCollection type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1562"
  },
  {
    "text": "Let me open this in Xcode to make the change here.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1564"
  },
  {
    "text": "Here, I have my URLRequest, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1569"
  },
  {
    "text": "and now I wanna set my cache policy.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1570"
  },
  {
    "text": "The cache policy I want is reloadRevalidatingCacheData, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1575"
  },
  {
    "text": "which means that we ignore the local cache ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1579"
  },
  {
    "text": "and will make a request to the server to check ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1581"
  },
  {
    "text": "whether our cache is still valid. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1583"
  },
  {
    "text": "If so, the server will send a 304 response code ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1585"
  },
  {
    "text": "to let us know to use the local cache. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1588"
  },
  {
    "text": "If not, it will send the new data back. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1591"
  },
  {
    "text": "Let's give it a try.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1594"
  },
  {
    "text": "So these are my current favorited images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1607"
  },
  {
    "text": "and the dog taking a bath has been added. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1608"
  },
  {
    "text": "Let's add another one.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1611"
  },
  {
    "text": "Now, let's check the \"Favorite\" tab. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1615"
  },
  {
    "text": "The image I just favorited now properly appears. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1618"
  },
  {
    "text": "OK, great! That's fixed now as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1621"
  },
  {
    "text": "Back to my colleague Kacper to cover checking ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1624"
  },
  {
    "text": "that your app and dependencies behave like you'd expect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1627"
  },
  {
    "text": "Just like Sergio showed before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1629"
  },
  {
    "text": "when I click on the \"Favorite\" tab ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1631"
  },
  {
    "text": "without being logged in, the log-in view is presented. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1633"
  },
  {
    "text": "We already added Sign In with Apple ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1637"
  },
  {
    "text": "to make the log-in experience seamless. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1639"
  },
  {
    "text": "However, our company has several pet-themed apps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1642"
  },
  {
    "text": "and another team is working on a shared log-in SDK to allow ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1646"
  },
  {
    "text": "users to reuse their account between the applications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1649"
  },
  {
    "text": "This SDK is currently in development, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1653"
  },
  {
    "text": "and the other team has asked us whether it could ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1656"
  },
  {
    "text": "replace our classic log-in screen. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1658"
  },
  {
    "text": "I got the SDK binary, called Pets, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1661"
  },
  {
    "text": "which is distributed as an xcframework ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1664"
  },
  {
    "text": "so that it can be used on all platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1667"
  },
  {
    "text": "Integrating it into my Xcode project is as easy as dragging ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1671"
  },
  {
    "text": "and dropping it in the embedded frameworks section. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1675"
  },
  {
    "text": "Now, all that is left is to add a button to our existing view. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1678"
  },
  {
    "text": "I will navigate to the source code of our Log-inView.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1683"
  },
  {
    "text": "I will first import the framework, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1689"
  },
  {
    "text": "and then add the button to our SwiftUI VStack, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1692"
  },
  {
    "text": "just below the Sign In with Apple.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1695"
  },
  {
    "text": "Let's refresh our Swift UI Preview.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1700"
  },
  {
    "text": "Here it is. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1705"
  },
  {
    "text": "\"Sign In with Pets\" button ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1706"
  },
  {
    "text": "appeared on the preview, exactly where I want it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1707"
  },
  {
    "text": "That was, indeed, a really easy integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1711"
  },
  {
    "text": "I am curious to check how quick this new log-in method will be. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1714"
  },
  {
    "text": "And to measure this, I'll profile my application ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1717"
  },
  {
    "text": "with Instruments by using Product Profile Action.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1720"
  },
  {
    "text": "I am choosing Network template. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1730"
  },
  {
    "text": "And clicking \"record\" button ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1733"
  },
  {
    "text": "in the toolbar to launch the app.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1735"
  },
  {
    "text": "My app has now launched. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1743"
  },
  {
    "text": "I can now switch to the Log-in View. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1745"
  },
  {
    "text": "Instruments is showing all of the networking traffic ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1748"
  },
  {
    "text": "occurring in the meantime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1751"
  },
  {
    "text": "I will expand it to inspect my app's URL session.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1753"
  },
  {
    "text": "Here it is. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1759"
  },
  {
    "text": "But wait. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1760"
  },
  {
    "text": "I would expect only my main app URLSession to be here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1762"
  },
  {
    "text": "but seems that the Pets framework we just integrated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1765"
  },
  {
    "text": "is making requests from its own session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1768"
  },
  {
    "text": "without me even clicking on the log-in button. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1771"
  },
  {
    "text": "That's unexpected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1773"
  },
  {
    "text": "Let's stop the recording right now to investigate it further.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1775"
  },
  {
    "text": "I will zoom in to a few first requests, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1782"
  },
  {
    "text": "using option-click and drag.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1784"
  },
  {
    "text": "There's many requests to some analytics endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1790"
  },
  {
    "text": "and to get more details, I can click on this ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1793"
  },
  {
    "text": "\"Pets Sign On Network\" session ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1795"
  },
  {
    "text": "and list all of them in the detail view.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1797"
  },
  {
    "text": "All of them are POST requests, and when I click on one, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1803"
  },
  {
    "text": "I can see the backtrace on the right that tells us ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1807"
  },
  {
    "text": "which part of the code the request originated from.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1810"
  },
  {
    "text": "So seems that request is going through CFNetwork, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1816"
  },
  {
    "text": "invoked by Pets, just as expected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1819"
  },
  {
    "text": "But when we navigate deeper, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1822"
  },
  {
    "text": "it seems like CoreLocation is being involved. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1824"
  },
  {
    "text": "That's really suspicious, especially because ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1827"
  },
  {
    "text": "I didn't perform any action to trigger it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1830"
  },
  {
    "text": "I wonder if my location is being sent back ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1833"
  },
  {
    "text": "to the server and that's why CoreLocation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1835"
  },
  {
    "text": "and CFNetwork are in the same backtrace.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1838"
  },
  {
    "text": "I will verify that by inspecting ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1842"
  },
  {
    "text": "the corresponding HTTP transactions for these tasks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1844"
  },
  {
    "text": "To do this, I will switch detail ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1848"
  },
  {
    "text": "from the list of tasks to the list of transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1850"
  },
  {
    "text": "And select one of them.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1854"
  },
  {
    "text": "In the extended detail on the bottom right, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1858"
  },
  {
    "text": "it's visible that this request contains some ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1860"
  },
  {
    "text": "pretty standard headers, nothing to worry about. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1862"
  },
  {
    "text": "But wait, look at the request body. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1866"
  },
  {
    "text": "It's including my location coordinates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1869"
  },
  {
    "text": "and that's really bad. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1871"
  },
  {
    "text": "Sending this information violates users' privacy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1873"
  },
  {
    "text": "We don't want to gather their location ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1877"
  },
  {
    "text": "without their consent and without a good reason. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1878"
  },
  {
    "text": "So far, our app only requests this permission for legitimate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1882"
  },
  {
    "text": "purposes that make the user experience better. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1886"
  },
  {
    "text": "At this point, I will not go any further ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1889"
  },
  {
    "text": "with this SDK integration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1891"
  },
  {
    "text": "Instead, I will file a bug report ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1894"
  },
  {
    "text": "on the other team to inform them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1896"
  },
  {
    "text": "about this unacceptable behavior that I detected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1898"
  },
  {
    "text": "And I can even use this Instruments trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1901"
  },
  {
    "text": "to generate necessary information for the bug report. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1903"
  },
  {
    "text": "Let's save it on my desktop first.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1907"
  },
  {
    "text": "I will name it \"PrivacyViolation\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1911"
  },
  {
    "text": "and hit \"save.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1915"
  },
  {
    "text": "xctrace, command line tool bundled with Instruments, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1918"
  },
  {
    "text": "can be used to export this trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1921"
  },
  {
    "text": "to the HTTP Archive format, which is an industry standard ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1923"
  },
  {
    "text": "for exchange of information about HTTP Traffic. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1926"
  },
  {
    "text": "To do this, I can simply run xctrace export command, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1931"
  },
  {
    "text": "with input of my trace, and HAR export flag. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1935"
  },
  {
    "text": "Let's run it now.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1940"
  },
  {
    "text": "This command generates a file that I can now attach ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1944"
  },
  {
    "text": "in the bug report. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1947"
  },
  {
    "text": "Someone receiving it can inspect the recorded information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1948"
  },
  {
    "text": "in any tool that supports HAR, even if they don't have ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1951"
  },
  {
    "text": "Instruments installed on their machine.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1955"
  },
  {
    "text": "HAR itself is a JSON-based format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1958"
  },
  {
    "text": "so it can also be opened ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1961"
  },
  {
    "text": "in the text editor or easily processed using scripts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1962"
  },
  {
    "text": "And even though it doesn't contain ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1966"
  },
  {
    "text": "instruments-specific details, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1968"
  },
  {
    "text": "like URLSessions or backtraces, that still should be enough ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1970"
  },
  {
    "text": "for the other team to investigate this issue.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1974"
  },
  {
    "text": "And that's how you can use HTTP Traffic Instrument ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1978"
  },
  {
    "text": "to diagnose source and content of traffic coming from ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1981"
  },
  {
    "text": "your application to make sure that you are in control ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1984"
  },
  {
    "text": "of what your app does at runtime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1988"
  },
  {
    "text": "Now that you're familiar with using the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1990"
  },
  {
    "text": "HTTP Traffic Instrument, go ahead and target your apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1993"
  },
  {
    "text": "to detect problems just like the ones we showed you today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=1996"
  },
  {
    "text": "For easier debugging and having more context while doing so, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2001"
  },
  {
    "text": "name your URLSession and task objects.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2004"
  },
  {
    "text": "Always aim for adopting latest networking protocols. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2009"
  },
  {
    "text": "And even if you don't find any performance or correctness ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2013"
  },
  {
    "text": "issues with your app, go ahead and verify ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2017"
  },
  {
    "text": "by how much data you're sending ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2020"
  },
  {
    "text": "to get rid of any unnecessary traffic. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2022"
  },
  {
    "text": "Thank you for watching today, and we hope you have ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2024"
  },
  {
    "text": "a great time tracing your app's HTTP traffic. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2027"
  },
  {
    "text": "[upbeat music]",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10212/?time=2030"
  }
]