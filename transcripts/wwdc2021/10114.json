[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=0"
  },
  {
    "text": "♪ Bass music playing ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=5"
  },
  {
    "text": "♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=7"
  },
  {
    "text": "Ross LeBeau: Hi, and welcome to WWDC21. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=9"
  },
  {
    "text": "My name is Ross LeBeau, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=12"
  },
  {
    "text": "and I'm an engineer on the StoreKit team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=13"
  },
  {
    "text": "Today, we're going to be talking about StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=16"
  },
  {
    "text": "and this is actually one of three sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=18"
  },
  {
    "text": "designed to help you implement client-side code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=20"
  },
  {
    "text": "build out your server for in-app purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=22"
  },
  {
    "text": "and support your customers and handle refunds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=24"
  },
  {
    "text": "This session is Meet StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=27"
  },
  {
    "text": "and you can find the other two sessions here at WWDC21. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=29"
  },
  {
    "text": "This session will focus on client-side features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=33"
  },
  {
    "text": "and implementation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=35"
  },
  {
    "text": "So let's get started! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=36"
  },
  {
    "text": "Since StoreKit was introduced in iOS 3, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=39"
  },
  {
    "text": "it's created great opportunities for you and your businesses. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=41"
  },
  {
    "text": "Today, it exists on four Apple platforms ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=44"
  },
  {
    "text": "and supports everything from games to news apps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=47"
  },
  {
    "text": "indie titles to international hits. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=49"
  },
  {
    "text": "Over the years, we've introduced great features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=52"
  },
  {
    "text": "such as offer codes, Family Sharing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=54"
  },
  {
    "text": "and StoreKit testing in Xcode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=56"
  },
  {
    "text": "But this year, we decided to go back to the beginning. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=58"
  },
  {
    "text": "Today, I'm excited to introduce you to StoreKit 2! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=62"
  },
  {
    "text": "StoreKit 2 is a brand new set of modern and flexible Swift APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=66"
  },
  {
    "text": "for working with In-App Purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=70"
  },
  {
    "text": "across iOS, macOS, tvOS, and watchOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=72"
  },
  {
    "text": "We've taken a new look at StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=77"
  },
  {
    "text": "with a Swift-first mindset. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=78"
  },
  {
    "text": "We embraced some of the newest language features, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=81"
  },
  {
    "text": "like Swift concurrency using the async/await pattern, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=83"
  },
  {
    "text": "to create simple yet powerful APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=86"
  },
  {
    "text": "We've also made some huge updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=89"
  },
  {
    "text": "to the in-app purchase transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=91"
  },
  {
    "text": "making them much easier to work with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=93"
  },
  {
    "text": "while also providing more information and high security. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=95"
  },
  {
    "text": "And we've added more powerful APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=99"
  },
  {
    "text": "specifically for subscriptions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=101"
  },
  {
    "text": "in order to give you deeper insight that you can use ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=103"
  },
  {
    "text": "to grow your business. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=105"
  },
  {
    "text": "StoreKit 2 APIs live inside the same StoreKit framework ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=107"
  },
  {
    "text": "that exists today ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=110"
  },
  {
    "text": "and focus on the core in-app purchase experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=112"
  },
  {
    "text": "rather than replacing every API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=114"
  },
  {
    "text": "The new StoreKit 2 APIs are comprised of five major areas: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=117"
  },
  {
    "text": "Products, Purchases, Transaction info, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=121"
  },
  {
    "text": "Transaction history, and subscription status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=125"
  },
  {
    "text": "Today I'm going to give you an overview of each of these areas, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=129"
  },
  {
    "text": "and my colleague Jakob will be showing you how to use ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=133"
  },
  {
    "text": "the corresponding StoreKit 2 APIs in real code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=135"
  },
  {
    "text": "So first, let's start with the building blocks of StoreKit: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=138"
  },
  {
    "text": "products and purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=141"
  },
  {
    "text": "The StoreKit 2 product struct is a supercharged version ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=144"
  },
  {
    "text": "of the StoreKit product object you're used to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=147"
  },
  {
    "text": "To start, we've added additional data to it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=149"
  },
  {
    "text": "such as the product type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=151"
  },
  {
    "text": "and extended subscription information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=153"
  },
  {
    "text": "With StoreKit 2, we're making it easier to do things ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=156"
  },
  {
    "text": "like find out if the customer is eligible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=158"
  },
  {
    "text": "for your introductory offer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=160"
  },
  {
    "text": "We're also making StoreKit 2 products ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=163"
  },
  {
    "text": "forward-compatible with new features. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=164"
  },
  {
    "text": "We've accomplished this by adding a wrapping type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=167"
  },
  {
    "text": "called BackingValue ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=169"
  },
  {
    "text": "that allows you to retrieve data contained in the product ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=171"
  },
  {
    "text": "by subscripting the products directly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=173"
  },
  {
    "text": "This means that if we add data to products in the future, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=176"
  },
  {
    "text": "you'll always be able to access them in StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=178"
  },
  {
    "text": "even on SDKs and devices running operating systems ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=181"
  },
  {
    "text": "that have older versions of StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=183"
  },
  {
    "text": "This means that you can use the latest features ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=186"
  },
  {
    "text": "to provide new functionality ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=188"
  },
  {
    "text": "to a larger section of your customer base. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=189"
  },
  {
    "text": "With StoreKit 2, you request products by calling ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=193"
  },
  {
    "text": "a static function on the product type itself. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=195"
  },
  {
    "text": "This requests product metadata from the App Store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=198"
  },
  {
    "text": "just like the existing SKProductsRequest does. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=201"
  },
  {
    "text": "But thanks to the new Swift concurrency async/await pattern, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=204"
  },
  {
    "text": "the StoreKit 2 product request requires just one line of code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=207"
  },
  {
    "text": "Similarly, purchasing a product in StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=211"
  },
  {
    "text": "is another simple, one-line task. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=214"
  },
  {
    "text": "Purchase is now an instance method on the product type, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=217"
  },
  {
    "text": "meaning you can take those products you just retrieved ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=220"
  },
  {
    "text": "and call purchase directly on them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=222"
  },
  {
    "text": "Since the purchase method also uses async/await, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=224"
  },
  {
    "text": "you get the result of your purchase inline in your code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=227"
  },
  {
    "text": "Now we know that not every purchase is the same. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=231"
  },
  {
    "text": "If you want to modify purchase behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=234"
  },
  {
    "text": "beyond the default settings, StoreKit 2 has Purchase options. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=236"
  },
  {
    "text": "A Purchase option is an item ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=241"
  },
  {
    "text": "that describes a single property of a purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=243"
  },
  {
    "text": "You can compose Purchase options into a set ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=246"
  },
  {
    "text": "which you pass into the purchase method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=248"
  },
  {
    "text": "StoreKit 2 includes purchase options for things ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=251"
  },
  {
    "text": "such as quantity and promotional offers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=253"
  },
  {
    "text": "And in StoreKit 2, we're adding a new option ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=256"
  },
  {
    "text": "called App account token. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=258"
  },
  {
    "text": "The App account token is a way for you to keep track ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=260"
  },
  {
    "text": "of which of your app's user accounts ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=262"
  },
  {
    "text": "began and completed a transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=264"
  },
  {
    "text": "It’s an opaque token that you generate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=267"
  },
  {
    "text": "which you can link to accounts that your app owns. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=270"
  },
  {
    "text": "It's easy to generate an App account token, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=273"
  },
  {
    "text": "because the only requirement is that it conforms ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=275"
  },
  {
    "text": "to the UUID format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=277"
  },
  {
    "text": "You send up an App account token on the purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=279"
  },
  {
    "text": "as a Purchase option, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=281"
  },
  {
    "text": "and this token is returned in the transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=282"
  },
  {
    "text": "for that purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=284"
  },
  {
    "text": "The App account token stays in the transaction info forever, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=287"
  },
  {
    "text": "even across devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=290"
  },
  {
    "text": "If your app supports its own account system, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=291"
  },
  {
    "text": "this can help you keep track of which purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=294"
  },
  {
    "text": "each in-app account has made, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=296"
  },
  {
    "text": "regardless of the Apple ID or device ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=298"
  },
  {
    "text": "that was used to purchase them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=300"
  },
  {
    "text": "So, we've talked about getting products from the App Store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=302"
  },
  {
    "text": "and initiating a purchase; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=304"
  },
  {
    "text": "now what happens when that purchase completes? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=306"
  },
  {
    "text": "As you might expect, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=309"
  },
  {
    "text": "StoreKit is going to return a successful transaction to you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=310"
  },
  {
    "text": "along with cryptographically signed information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=313"
  },
  {
    "text": "Sounds familiar, right? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=315"
  },
  {
    "text": "Well, StoreKit 2 is bringing the biggest update ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=317"
  },
  {
    "text": "to in-app purchase transactions ever. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=320"
  },
  {
    "text": "To start, StoreKit 2 will be providing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=322"
  },
  {
    "text": "an individually signed object for every transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=324"
  },
  {
    "text": "Not only that, but starting in StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=328"
  },
  {
    "text": "in-app purchase transaction info will now be provided ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=331"
  },
  {
    "text": "in a very common, easy-to-work-with format: JSON. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=333"
  },
  {
    "text": "And since we know that secure cryptographic signing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=337"
  },
  {
    "text": "is an important part of StoreKit purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=340"
  },
  {
    "text": "we're now using a common standard used across the web ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=342"
  },
  {
    "text": "known as JSON Web Signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=345"
  },
  {
    "text": "Plus, all the information contained in the signed object ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=347"
  },
  {
    "text": "will now be available through native StoreKit APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=350"
  },
  {
    "text": "making it easy to work with this data in your app's code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=353"
  },
  {
    "text": "In fact, we'll show you just how easy it is. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=356"
  },
  {
    "text": "Here's Jakob with a demonstration of these APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=359"
  },
  {
    "text": "in real code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=361"
  },
  {
    "text": "Jakob Swank: Hi, I'm Jakob. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=363"
  },
  {
    "text": "I'm an engineer on the StoreKit team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=364"
  },
  {
    "text": "I'm really excited today to be showing you how easy it is ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=367"
  },
  {
    "text": "to get up and running with StoreKit 2 in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=370"
  },
  {
    "text": "On the right, I have an app I'm building called Pocket Cars. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=373"
  },
  {
    "text": "You can download the sample code for this app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=377"
  },
  {
    "text": "in the resources section of this session and follow along. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=380"
  },
  {
    "text": "The app has two main views. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=384"
  },
  {
    "text": "There's a view for my collected cars and a view for my store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=386"
  },
  {
    "text": "Let's go over to the store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=390"
  },
  {
    "text": "Currently, my store is empty ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=393"
  },
  {
    "text": "because I have no products available for sale. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=395"
  },
  {
    "text": "I'm going to go ahead and implement those now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=398"
  },
  {
    "text": "To get up and running quickly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=401"
  },
  {
    "text": "I'm using StoreKit testing in Xcode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=402"
  },
  {
    "text": "This allows me to build and test my store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=406"
  },
  {
    "text": "before defining products in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=408"
  },
  {
    "text": "In my Xcode project, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=413"
  },
  {
    "text": "I've already created a StoreKit configuration file ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=415"
  },
  {
    "text": "defining the products I want to sell. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=418"
  },
  {
    "text": "This is the same configuration file I was using for StoreKit; ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=422"
  },
  {
    "text": "I don't need to change or migrate anything. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=426"
  },
  {
    "text": "Here, I also have a plist ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=430"
  },
  {
    "text": "containing all my product identifiers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=433"
  },
  {
    "text": "It's included as a resource file built into my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=436"
  },
  {
    "text": "so I can use it at runtime. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=439"
  },
  {
    "text": "To display these products in my store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=443"
  },
  {
    "text": "I first need to make a product request ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=445"
  },
  {
    "text": "using a set of the product identifiers I want to display. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=448"
  },
  {
    "text": "With StoreKit 2, I can do this ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=452"
  },
  {
    "text": "simply by calling a static method on the Product struct. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=454"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=459"
  },
  {
    "text": "After I receive the products from the App Store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=464"
  },
  {
    "text": "I want to separate them by type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=467"
  },
  {
    "text": "I can do this easily with StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=470"
  },
  {
    "text": "since the Product type now provides a property ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=472"
  },
  {
    "text": "for the type as it's defined on the App Store server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=475"
  },
  {
    "text": "In my app, I'm selling three types of products: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=484"
  },
  {
    "text": "fuel, cars, and a navigation package. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=487"
  },
  {
    "text": "Fuel is a consumable product -- once I use it, it's gone -- ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=490"
  },
  {
    "text": "so I'll put all the consumables in to the fuel array. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=496"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=499"
  },
  {
    "text": "Cars are a non-consumable. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=506"
  },
  {
    "text": "Once I purchase a car, I own it forever. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=509"
  },
  {
    "text": "So I'll put all the non-consumables ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=511"
  },
  {
    "text": "into the cars array. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=513"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=516"
  },
  {
    "text": "The navigation package is a subscription product ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=523"
  },
  {
    "text": "with three levels of service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=526"
  },
  {
    "text": "My customers can subscribe to one level of service at a time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=529"
  },
  {
    "text": "and they are billed periodically. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=532"
  },
  {
    "text": "Also, they can upgrade or downgrade at any time ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=535"
  },
  {
    "text": "if they want to change their level of service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=537"
  },
  {
    "text": "The App Store will return a Product ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=540"
  },
  {
    "text": "for each level of service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=542"
  },
  {
    "text": "so I'll put all the auto-renewable subscriptions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=544"
  },
  {
    "text": "into the subscriptions array. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=547"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=550"
  },
  {
    "text": "I also want to sort my products within each type by price, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=556"
  },
  {
    "text": "lowest to highest. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=559"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=561"
  },
  {
    "text": "Let's run my app and check out what I've done so far.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=565"
  },
  {
    "text": "Now I'll navigate to the store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=574"
  },
  {
    "text": "Wow! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=576"
  },
  {
    "text": "Before, my store was empty, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=577"
  },
  {
    "text": "but now it's looking pretty great ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=579"
  },
  {
    "text": "with all my products displayed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=581"
  },
  {
    "text": "With just one line of code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=583"
  },
  {
    "text": "I was able to request my app's products from the App Store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=585"
  },
  {
    "text": "then I was able to group and sort those products ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=588"
  },
  {
    "text": "based only on the metadata I received ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=591"
  },
  {
    "text": "which made it easy to build my store UI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=593"
  },
  {
    "text": "Now my products are looking great, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=597"
  },
  {
    "text": "but if I tap a buy button, nothing happens. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=599"
  },
  {
    "text": "That's because the purchase method in my store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=602"
  },
  {
    "text": "doesn't do anything. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=605"
  },
  {
    "text": "It should initiate the purchase with StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=607"
  },
  {
    "text": "We can do this simply by calling the purchase method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=610"
  },
  {
    "text": "on the product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=613"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=615"
  },
  {
    "text": "As Ross mentioned, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=625"
  },
  {
    "text": "StoreKit 2 was built from the ground up ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=627"
  },
  {
    "text": "to use the new concurrency capabilities of Swift. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=629"
  },
  {
    "text": "This allows my app to keep the code for purchasing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=632"
  },
  {
    "text": "and processing the result of that purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=635"
  },
  {
    "text": "all within the same context ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=638"
  },
  {
    "text": "in order to keep my code easy to read. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=640"
  },
  {
    "text": "When a purchase completes, a PurchaseResult is returned. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=643"
  },
  {
    "text": "This PurchaseResult lets me know ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=647"
  },
  {
    "text": "whether the purchase was successful ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=649"
  },
  {
    "text": "or if it completed in some other non-error state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=651"
  },
  {
    "text": "such as the user cancelled the purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=655"
  },
  {
    "text": "or the purchase needs some extra bank validation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=658"
  },
  {
    "text": "or approval from a parent. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=661"
  },
  {
    "text": "To handle each case, I'll just switch over them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=663"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=666"
  },
  {
    "text": "If the PurchaseResult is in the success state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=672"
  },
  {
    "text": "I also get a verification result. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=675"
  },
  {
    "text": "A verification result contains two cases: ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=679"
  },
  {
    "text": "verified and unverified. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=682"
  },
  {
    "text": "In StoreKit 2, the transaction type contains the JWS payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=685"
  },
  {
    "text": "which represents the signed transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=690"
  },
  {
    "text": "Every time my app receives a transaction from StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=694"
  },
  {
    "text": "the transaction has passed through a verification process ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=698"
  },
  {
    "text": "to confirm whether the payload is signed by the App Store ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=701"
  },
  {
    "text": "for my app for this device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=705"
  },
  {
    "text": "You heard that right. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=708"
  },
  {
    "text": "StoreKit 2 does transaction verification for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=709"
  },
  {
    "text": "Of course, how I choose to handle the verification result ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=713"
  },
  {
    "text": "is entirely up to me and the needs of my business. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=716"
  },
  {
    "text": "For my app, I'm going to make sure ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=721"
  },
  {
    "text": "this transaction I received from StoreKit has been verified. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=723"
  },
  {
    "text": "Here in my store, I'll create a checkVerified method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=727"
  },
  {
    "text": "I can use for any VerificationResult. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=731"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=734"
  },
  {
    "text": "If the result is unverified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=739"
  },
  {
    "text": "I throw my own failedVerification error ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=741"
  },
  {
    "text": "to alert other parts of my app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=744"
  },
  {
    "text": "If the result is verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=746"
  },
  {
    "text": "I unwrap the transaction and return it to the caller. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=748"
  },
  {
    "text": "Now I can use this checkVerified method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=752"
  },
  {
    "text": "on the results of the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=754"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=757"
  },
  {
    "text": "Finally, with my transaction verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=769"
  },
  {
    "text": "I deliver the content to my user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=772"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=775"
  },
  {
    "text": "After the user has the content, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=783"
  },
  {
    "text": "I need to make sure I tell StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=785"
  },
  {
    "text": "to finish the transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=787"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=789"
  },
  {
    "text": "Then I need to return it so my UI can get updated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=795"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=799"
  },
  {
    "text": "My app has an account database I maintain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=803"
  },
  {
    "text": "I want to include my app's current logged in user ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=806"
  },
  {
    "text": "with the StoreKit purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=809"
  },
  {
    "text": "so this information is always available to my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=811"
  },
  {
    "text": "when it gets the App Store signed transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=814"
  },
  {
    "text": "I can do this by creating an appAccountToken purchase option ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=817"
  },
  {
    "text": "using a tokenized version of my logged-in account ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=821"
  },
  {
    "text": "and passing that option to the purchase method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=825"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=829"
  },
  {
    "text": "OK. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=839"
  },
  {
    "text": "We're all set with my purchase method implementation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=840"
  },
  {
    "text": "Let's run my app again.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=843"
  },
  {
    "text": "Now we're back in my store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=853"
  },
  {
    "text": "and I'm feeling pretty adventurous. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=854"
  },
  {
    "text": "So I'm going to purchase a motorcycle ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=856"
  },
  {
    "text": "because I've always wanted one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=858"
  },
  {
    "text": "There's the payment sheet from StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=862"
  },
  {
    "text": "showing me the purchase has been initiated properly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=864"
  },
  {
    "text": "I'll tap to confirm the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=867"
  },
  {
    "text": "StoreKit then displays an alert ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=872"
  },
  {
    "text": "showing the purchase was successful. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=874"
  },
  {
    "text": "After I dismiss that alert, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=876"
  },
  {
    "text": "my buy button changes to a green checkmark ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=878"
  },
  {
    "text": "showing my app trusts the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=881"
  },
  {
    "text": "and my motorcycle has been delivered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=883"
  },
  {
    "text": "There's one more important thing I want to note here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=887"
  },
  {
    "text": "As I said previously, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=890"
  },
  {
    "text": "sometimes a customer will have to do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=891"
  },
  {
    "text": "some extra verification on their account ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=893"
  },
  {
    "text": "or they'll need a parent's approval ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=896"
  },
  {
    "text": "before a purchase will complete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=897"
  },
  {
    "text": "In these cases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=900"
  },
  {
    "text": "the purchase result I receive from product.purchase() ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=901"
  },
  {
    "text": "will be in a pending state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=905"
  },
  {
    "text": "This means after the customer completes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=908"
  },
  {
    "text": "the account verification or their parent gives approval, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=910"
  },
  {
    "text": "my app should update the UI to reflect the completed purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=914"
  },
  {
    "text": "To listen for these transaction updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=919"
  },
  {
    "text": "I need to iterate over a static property ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=922"
  },
  {
    "text": "on the transaction type.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=924"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=931"
  },
  {
    "text": "This property is an infinite async sequence. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=935"
  },
  {
    "text": "That means it will continue iterating ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=938"
  },
  {
    "text": "over transaction updates as they come in from StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=940"
  },
  {
    "text": "until I choose to cancel or break out of the for loop. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=943"
  },
  {
    "text": "Here I'm creating a detach task ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=948"
  },
  {
    "text": "which will return a task handle I can use ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=951"
  },
  {
    "text": "to explicitly cancel my update listener ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=953"
  },
  {
    "text": "when the store is deallocated. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=956"
  },
  {
    "text": "Just like all transactions I receive from StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=959"
  },
  {
    "text": "I want to check if the verification result is verified ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=962"
  },
  {
    "text": "before delivering content to the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=966"
  },
  {
    "text": "I can use my previously defined checkVerified method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=969"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=974"
  },
  {
    "text": "And, just like with a purchase response, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=987"
  },
  {
    "text": "once I have my verified transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=989"
  },
  {
    "text": "I need to deliver the content to my user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=992"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=995"
  },
  {
    "text": "And of course, I always need to finish my transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1000"
  },
  {
    "text": "It's very important I start my transaction update listener ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1007"
  },
  {
    "text": "as soon as my app launches so I don't miss a single one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1011"
  },
  {
    "text": "I'm going to do this as soon as my store is created, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1014"
  },
  {
    "text": "which happens right around app launch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1017"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1020"
  },
  {
    "text": "In order to test my update listener, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1029"
  },
  {
    "text": "I'm going to enable Ask To Buy in my Xcode test environment ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1031"
  },
  {
    "text": "to simulate a purchase response in a pending state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1035"
  },
  {
    "text": "To do this, I select my StoreKit configuration file ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1039"
  },
  {
    "text": "and in the Editor menu, I select Enable Ask To Buy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1044"
  },
  {
    "text": "Let's run my app again and do a purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1049"
  },
  {
    "text": "This time, after I confirm on the payment sheet, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1063"
  },
  {
    "text": "I see a new alert from StoreKit saying I need to ask permission ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1066"
  },
  {
    "text": "to complete the purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1070"
  },
  {
    "text": "I'll go ahead and tap Ask. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1072"
  },
  {
    "text": "The purchase response is returned to my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1076"
  },
  {
    "text": "in a pending state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1078"
  },
  {
    "text": "To approve the purchase, I'm going to open ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1080"
  },
  {
    "text": "the StoreKit testing in Xcode transaction manager ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1082"
  },
  {
    "text": "and click the Approve button in the top-right corner.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1085"
  },
  {
    "text": "Great! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1093"
  },
  {
    "text": "Immediately after I approved the transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1094"
  },
  {
    "text": "my update listener received the verification result ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1097"
  },
  {
    "text": "and the UI immediately changed to show the approved purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1100"
  },
  {
    "text": "Now I have a brand-new, standard 5-seater to cruise around in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1105"
  },
  {
    "text": "I just showed you how easy it is to request products, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1110"
  },
  {
    "text": "start a purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1113"
  },
  {
    "text": "react to different purchase results, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1115"
  },
  {
    "text": "verify the integrity of a transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1117"
  },
  {
    "text": "and receive updates from the App Store for pending transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1120"
  },
  {
    "text": "all using StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1124"
  },
  {
    "text": "Now let's go back to Ross for an introduction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1126"
  },
  {
    "text": "on working with your user's transaction history ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1128"
  },
  {
    "text": "and subscription status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1131"
  },
  {
    "text": "Ross: Wow!  It’s pretty amazing to see these new APIs in action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1133"
  },
  {
    "text": "And automatic validation, what more could you want? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1137"
  },
  {
    "text": "What's that? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1141"
  },
  {
    "text": "You love cryptography ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1142"
  },
  {
    "text": "and you still want to validate the data yourself? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1143"
  },
  {
    "text": "Not to worry. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1145"
  },
  {
    "text": "StoreKit 2's automatic validation ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1147"
  },
  {
    "text": "raises the bar for security, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1149"
  },
  {
    "text": "but it isn't meant to completely replace your own validation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1151"
  },
  {
    "text": "As always, security lies on a spectrum ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1154"
  },
  {
    "text": "of strength, time, and complexity. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1156"
  },
  {
    "text": "I'll give you the scoop on validation a bit later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1159"
  },
  {
    "text": "First, if you're as excited about StoreKit 2 transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1162"
  },
  {
    "text": "as I am, you'll love to hear ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1165"
  },
  {
    "text": "that we're giving you lots of new ways to work with them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1167"
  },
  {
    "text": "We're adding a new set of APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1170"
  },
  {
    "text": "for querying completed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1171"
  },
  {
    "text": "in the user's transaction history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1173"
  },
  {
    "text": "In StoreKit 2, you can access ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1176"
  },
  {
    "text": "all of the user's past transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1178"
  },
  {
    "text": "with a single API call. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1180"
  },
  {
    "text": "You can also access the latest transaction for a product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1182"
  },
  {
    "text": "So if you want to see just the most recent renewal ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1185"
  },
  {
    "text": "of a subscription, you can. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1187"
  },
  {
    "text": "And we know that the number one thing you need to know ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1189"
  },
  {
    "text": "is what products the user has paid for access to right now. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1193"
  },
  {
    "text": "So we've distilled that information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1197"
  },
  {
    "text": "into a single function called CurrentEntitlements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1198"
  },
  {
    "text": "Current entitlements contains all of the non-consumables ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1202"
  },
  {
    "text": "in the user's transaction history, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1204"
  },
  {
    "text": "as well as all of the subscription transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1206"
  },
  {
    "text": "that are currently active. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1209"
  },
  {
    "text": "With this, you have all of the information you need ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1210"
  },
  {
    "text": "to unlock everything the user has paid for in your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1213"
  },
  {
    "text": "And since this represents only things ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1216"
  },
  {
    "text": "that the user should have access to right now, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1218"
  },
  {
    "text": "any transactions that have been revoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1220"
  },
  {
    "text": "are not included in the response. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1222"
  },
  {
    "text": "Consumables are also not included, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1224"
  },
  {
    "text": "since they’re not a persistent part of the transaction history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1226"
  },
  {
    "text": "Now, you must be thinking, \"I can't wait! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1230"
  },
  {
    "text": "When can I start calling these in my app?\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1232"
  },
  {
    "text": "Well, with StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1235"
  },
  {
    "text": "every transaction a user has ever completed ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1236"
  },
  {
    "text": "is available to your app as soon as you ask for it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1239"
  },
  {
    "text": "This means that when a user installs your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1241"
  },
  {
    "text": "on a new device, you'll be able to tell ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1244"
  },
  {
    "text": "which products they are entitled to get access to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1245"
  },
  {
    "text": "on the very first time your app is opened. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1247"
  },
  {
    "text": "Furthermore, transaction history will automatically update ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1250"
  },
  {
    "text": "across users' devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1254"
  },
  {
    "text": "When your customer makes a purchase on one device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1256"
  },
  {
    "text": "your app will be able to see the purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1259"
  },
  {
    "text": "on every other device it's installed on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1261"
  },
  {
    "text": "In fact, if your app is running ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1264"
  },
  {
    "text": "when a purchase is made on another device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1265"
  },
  {
    "text": "you'll be notified about the new transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1268"
  },
  {
    "text": "Jakob mentioned that it's important ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1270"
  },
  {
    "text": "to listen for transactions as soon as your app starts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1272"
  },
  {
    "text": "and this is just one more reason that's true. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1274"
  },
  {
    "text": "So, all of this means ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1277"
  },
  {
    "text": "that users won't need to restore completed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1278"
  },
  {
    "text": "when your app is reinstalled or downloaded on a new device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1281"
  },
  {
    "text": "Everything should automatically be fetched by StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1284"
  },
  {
    "text": "and stay up to date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1286"
  },
  {
    "text": "But people use their Apple devices in millions of ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1288"
  },
  {
    "text": "in millions of places. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1291"
  },
  {
    "text": "In the rare case that a user thinks ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1293"
  },
  {
    "text": "they should have a transaction but you don't see it, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1294"
  },
  {
    "text": "you can use the App Store sync API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1297"
  },
  {
    "text": "This immediately resynchronizes all StoreKit 2 transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1299"
  },
  {
    "text": "This is a replacement for the ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1304"
  },
  {
    "text": "restoreCompletedTransactions API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1305"
  },
  {
    "text": "and you should provide UI in your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1307"
  },
  {
    "text": "that allows users to initiate the sync. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1309"
  },
  {
    "text": "However, thanks to StoreKit 2's automatic synchronization, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1311"
  },
  {
    "text": "it should be very rare ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1314"
  },
  {
    "text": "that a user needs to initiate a sync manually. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1316"
  },
  {
    "text": "Automatic synchronization should cover the majority of cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1318"
  },
  {
    "text": "If a user does need to initiate a manual sync, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1322"
  },
  {
    "text": "they will be required to authenticate their account. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1325"
  },
  {
    "text": "For this reason, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1327"
  },
  {
    "text": "you should only use this API in response to user input. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1329"
  },
  {
    "text": "Finally, all transactions made using StoreKit 2 APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1333"
  },
  {
    "text": "are available in the original StoreKit APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1336"
  },
  {
    "text": "and vice versa. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1339"
  },
  {
    "text": "So if your app has existing transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1340"
  },
  {
    "text": "you will be able to see them in the StoreKit 2 APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1342"
  },
  {
    "text": "as soon as you start using them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1345"
  },
  {
    "text": "New purchases made with the original StoreKit APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1347"
  },
  {
    "text": "will be available via StoreKit 2 APIs immediately, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1349"
  },
  {
    "text": "and purchases made with StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1352"
  },
  {
    "text": "will also be available inside the unified receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1354"
  },
  {
    "text": "when it is refreshed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1356"
  },
  {
    "text": "In addition to transaction history, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1358"
  },
  {
    "text": "StoreKit 2 is also adding ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1360"
  },
  {
    "text": "for you to get detailed information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1362"
  },
  {
    "text": "about a user's subscription status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1363"
  },
  {
    "text": "The subscription status has three parts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1367"
  },
  {
    "text": "The first is the latest transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1370"
  },
  {
    "text": "This conveniently lets you access the last transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1372"
  },
  {
    "text": "that occurred for this subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1375"
  },
  {
    "text": "and it's the same as if you called ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1376"
  },
  {
    "text": "the latest transaction we talked about at earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1378"
  },
  {
    "text": "The second is the renewal state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1381"
  },
  {
    "text": "This is an enumeration that tells you ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1383"
  },
  {
    "text": "the current state of the subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1385"
  },
  {
    "text": "If you just want to know what's going on ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1387"
  },
  {
    "text": "with the subscription right now, just look at this value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1388"
  },
  {
    "text": "It'll tell you if it's currently subscribed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1392"
  },
  {
    "text": "expired, in the grace period, and more. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1394"
  },
  {
    "text": "We've designed it to give you a single place to look ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1398"
  },
  {
    "text": "in order to make it easy to base app logic off this value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1400"
  },
  {
    "text": "And the final part of the subscription status is the renewal info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1404"
  },
  {
    "text": "This is where you can see all of the details ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1408"
  },
  {
    "text": "about a user's subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1410"
  },
  {
    "text": "It contains all kinds of information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1412"
  },
  {
    "text": "that isn't in the transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1413"
  },
  {
    "text": "because this data can actually change without a transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1415"
  },
  {
    "text": "For example, in the renewal info, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1419"
  },
  {
    "text": "you can find the auto-renew status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1421"
  },
  {
    "text": "which tells you if the user has auto-renew turned on or off ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1423"
  },
  {
    "text": "for this subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1426"
  },
  {
    "text": "You can even see the product ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1428"
  },
  {
    "text": "that their auto-renewal is set for. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1429"
  },
  {
    "text": "So if a user has recently downgraded their subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1432"
  },
  {
    "text": "you can see that right here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1434"
  },
  {
    "text": "and maybe use that as an opportunity to present them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1436"
  },
  {
    "text": "with a winback offer to stay at the higher tier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1438"
  },
  {
    "text": "If the subscription is already expired, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1441"
  },
  {
    "text": "you can use the renewal info to see the expiration reason. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1443"
  },
  {
    "text": "And the full renewal info has all this data and more, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1446"
  },
  {
    "text": "plus another critical feature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1449"
  },
  {
    "text": "That's right, all you cryptography buffs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1451"
  },
  {
    "text": "the renewal info is signed using JWS! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1453"
  },
  {
    "text": "Just like the transaction info, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1456"
  },
  {
    "text": "the renewal info is a critical part of unlocking service ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1458"
  },
  {
    "text": "and making marketing decisions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1461"
  },
  {
    "text": "So we're giving you the confidence to know ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1462"
  },
  {
    "text": "that it's valid and directly from Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1464"
  },
  {
    "text": "And, to answer the question ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1466"
  },
  {
    "text": "that I'm sure is running through your head right now, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1468"
  },
  {
    "text": "yes, StoreKit 2 will automatically validate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1470"
  },
  {
    "text": "the renewal info for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1473"
  },
  {
    "text": "One final thing to know about the subscription status APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1475"
  },
  {
    "text": "is that they return an array of statuses. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1479"
  },
  {
    "text": "This is because, in some cases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1481"
  },
  {
    "text": "users can have multiple subscriptions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1483"
  },
  {
    "text": "to the same product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1485"
  },
  {
    "text": "For example, a user may have subscribed to your product, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1486"
  },
  {
    "text": "and then also receive a subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1489"
  },
  {
    "text": "through Family Sharing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1491"
  },
  {
    "text": "You should check the array ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1493"
  },
  {
    "text": "to see what the highest level of service they're entitled to is. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1494"
  },
  {
    "text": "Now I'll hand it back to Jakob to show you what it looks like ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1497"
  },
  {
    "text": "to work with these transaction history ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1500"
  },
  {
    "text": "and subscription status APIs in your app code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1502"
  },
  {
    "text": "Jakob: Thanks, Ross. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1505"
  },
  {
    "text": "Let's go back to the app I've been working on ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1507"
  },
  {
    "text": "and update it to use the new transaction history ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1509"
  },
  {
    "text": "and subscription status APIs Ross just talked about. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1511"
  },
  {
    "text": "You'll notice the motorcycle I previously purchased ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1515"
  },
  {
    "text": "doesn't have a green check, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1518"
  },
  {
    "text": "and after I navigate away from my store view, then back, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1519"
  },
  {
    "text": "the standard 5-seater doesn't have a green check either. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1523"
  },
  {
    "text": "As a user, I can't tell what I've already purchased. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1527"
  },
  {
    "text": "This is a problem easily solved with StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1531"
  },
  {
    "text": "At any time, my app can query StoreKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1534"
  },
  {
    "text": "for which products have been purchased ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1537"
  },
  {
    "text": "so I can keep my app's UI always up to date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1539"
  },
  {
    "text": "Over in my Store.swift file, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1543"
  },
  {
    "text": "the isPurchased method currently returns only false. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1545"
  },
  {
    "text": "Let's fix that with a simple call ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1549"
  },
  {
    "text": "to Transaction.latest(for:). ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1551"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1554"
  },
  {
    "text": "Then pass in my product identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1558"
  },
  {
    "text": "to get the most recent transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1560"
  },
  {
    "text": "This StoreKit method returns another verification result ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1563"
  },
  {
    "text": "telling me the transaction has passed through ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1567"
  },
  {
    "text": "StoreKit 2's verification check. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1569"
  },
  {
    "text": "I'll confirm the transaction is verified and unwrap it ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1572"
  },
  {
    "text": "using the checkVerified method I wrote previously. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1575"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1579"
  },
  {
    "text": "Then, I'll make sure my app doesn't deliver content ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1590"
  },
  {
    "text": "for a transaction that has been refunded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1592"
  },
  {
    "text": "by checking revocationDate equals nil. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1595"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1598"
  },
  {
    "text": "Also, subscriptions where my customer has upgraded ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1608"
  },
  {
    "text": "to a higher level of service in the middle of the period ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1611"
  },
  {
    "text": "will have the isUpgraded flag set to true. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1614"
  },
  {
    "text": "I want to make sure my app is delivering ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1618"
  },
  {
    "text": "the highest level of service my customer has subscribed to, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1620"
  },
  {
    "text": "so the isPurchased method should ignore ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1623"
  },
  {
    "text": "any upgraded transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1626"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1628"
  },
  {
    "text": "For a subscription product, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1634"
  },
  {
    "text": "the transaction type tells only part of the story. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1636"
  },
  {
    "text": "In addition to the date of the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1640"
  },
  {
    "text": "and the expiration date of the subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1642"
  },
  {
    "text": "I also want to know when the next renewal date is, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1645"
  },
  {
    "text": "and whether my customer has turned off the auto-renewal ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1648"
  },
  {
    "text": "for their subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1651"
  },
  {
    "text": "or whether their next renewal period ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1652"
  },
  {
    "text": "will change the level of service they're subscribed to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1654"
  },
  {
    "text": "To get all this information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1658"
  },
  {
    "text": "StoreKit 2 offers a subscription status API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1660"
  },
  {
    "text": "In my SubscriptionsView.swift file, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1664"
  },
  {
    "text": "the updateSubscriptionStatus method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1667"
  },
  {
    "text": "is responsible for getting the subscription status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1669"
  },
  {
    "text": "from StoreKit and displaying it to the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1672"
  },
  {
    "text": "Because all of my subscription products ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1676"
  },
  {
    "text": "belong to the same group, I can use any of them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1678"
  },
  {
    "text": "to get the current status for the group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1681"
  },
  {
    "text": "I'll just choose the first subscription product ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1684"
  },
  {
    "text": "from the store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1686"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1688"
  },
  {
    "text": "Once I have a product, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1692"
  },
  {
    "text": "I can get the status property from the subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1693"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1697"
  },
  {
    "text": "It's that easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1700"
  },
  {
    "text": "As Ross mentioned, it's possible for a user ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1702"
  },
  {
    "text": "to be paying for their own personal subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1704"
  },
  {
    "text": "while they also have a subscription being shared ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1707"
  },
  {
    "text": "by a family member. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1709"
  },
  {
    "text": "So the status property will return an array ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1711"
  },
  {
    "text": "containing all the statuses for each subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1714"
  },
  {
    "text": "Now, they could have a standard tier shared with them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1718"
  },
  {
    "text": "while they've personally subscribed to the pro tier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1722"
  },
  {
    "text": "I want to make sure my user is able to get ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1726"
  },
  {
    "text": "the highest level of service they have access to, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1728"
  },
  {
    "text": "so I'll iterate through each status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1731"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1734"
  },
  {
    "text": "Next, I'll check whether the status ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1741"
  },
  {
    "text": "has a state of expired or revoked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1743"
  },
  {
    "text": "I want to ignore these cases ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1748"
  },
  {
    "text": "and not display anything to the user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1750"
  },
  {
    "text": "For all other cases, I'll get the renewalInfo ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1753"
  },
  {
    "text": "and make sure it's verified ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1756"
  },
  {
    "text": "using the checkVerified method on my store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1758"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1762"
  },
  {
    "text": "Once I confirm the renewalInfo is verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1774"
  },
  {
    "text": "I'll compare the level of service ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1777"
  },
  {
    "text": "to the previous products. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1779"
  },
  {
    "text": "This check will get the corresponding product ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1785"
  },
  {
    "text": "for the subscription status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1788"
  },
  {
    "text": "then it will compare with any previous product, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1790"
  },
  {
    "text": "and if it's a higher tier, we set highestStatus ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1793"
  },
  {
    "text": "and highestProduct to the new subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1797"
  },
  {
    "text": "Once I've checked all my statuses ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1801"
  },
  {
    "text": "and I've determined the highest level of service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1803"
  },
  {
    "text": "I'll set the status and current subscription of my view. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1805"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1810"
  },
  {
    "text": "Let's build and run now.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1823"
  },
  {
    "text": "Over in my store view, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1832"
  },
  {
    "text": "the products I previously purchased ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1833"
  },
  {
    "text": "now show a green checkmark to indicate I already own them ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1835"
  },
  {
    "text": "and I don't need to buy them again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1839"
  },
  {
    "text": "Let's see what happens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1841"
  },
  {
    "text": "when I purchase one of my subscription products.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1842"
  },
  {
    "text": "After I confirm the purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1849"
  },
  {
    "text": "the status is displayed right in my store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1851"
  },
  {
    "text": "I can let my user know what they're subscribed to ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1854"
  },
  {
    "text": "and when their subscription will renew ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1857"
  },
  {
    "text": "all using APIs built into StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1859"
  },
  {
    "text": "Now how about this My Cars view? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1863"
  },
  {
    "text": "It should show all of my purchased products, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1866"
  },
  {
    "text": "but currently it's empty. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1869"
  },
  {
    "text": "To fill this in, I could iterate through all my products, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1871"
  },
  {
    "text": "then get the latest transaction for each, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1874"
  },
  {
    "text": "check the transaction's expiration date ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1877"
  },
  {
    "text": "and whether it has been refunded, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1879"
  },
  {
    "text": "but that sounds like a lot. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1881"
  },
  {
    "text": "Thankfully, I can use the power of StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1883"
  },
  {
    "text": "and a new, simple, and convenient API ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1886"
  },
  {
    "text": "to get all my user's valid transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1889"
  },
  {
    "text": "called currentEntitlements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1891"
  },
  {
    "text": "Over in the My Cars view, I have this method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1894"
  },
  {
    "text": "to refresh my purchased products when the view is loaded. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1896"
  },
  {
    "text": "Just like with transaction updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1901"
  },
  {
    "text": "I iterate over the current entitlements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1903"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1906"
  },
  {
    "text": "But unlike transaction updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1910"
  },
  {
    "text": "the current entitlement's async sequence is finite, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1912"
  },
  {
    "text": "so it won't wait in the for loop forever, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1915"
  },
  {
    "text": "delivering new entitlements as the user makes more purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1918"
  },
  {
    "text": "For each entitlement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1922"
  },
  {
    "text": "I want to check the verification result ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1923"
  },
  {
    "text": "as I do with every other transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1926"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1929"
  },
  {
    "text": "Once I know they're verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1932"
  },
  {
    "text": "I'll filter the entitlements into different arrays ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1933"
  },
  {
    "text": "by switching over the productType property, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1936"
  },
  {
    "text": "just like I did with my original product request. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1938"
  },
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1942"
  },
  {
    "text": "Current entitlements will only return transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1946"
  },
  {
    "text": "for non-consumable and auto-renewable products. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1948"
  },
  {
    "text": "I can ignore any other product type ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1952"
  },
  {
    "text": "to complete my switch statement ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1955"
  },
  {
    "text": "and keep the Swift compiler happy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1957"
  },
  {
    "text": "Once I have the transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1959"
  },
  {
    "text": "I need to get the associated product to display in my UI. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1961"
  },
  {
    "text": "For non-consumable transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1966"
  },
  {
    "text": "I'll search the cars product array for the product identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1968"
  },
  {
    "text": "matching this transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1971"
  },
  {
    "text": "And likewise, I'll search the subscriptions product array ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1977"
  },
  {
    "text": "to match any auto-renewable transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1980"
  },
  {
    "text": "Let's run again and check out my UI.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1987"
  },
  {
    "text": "Now, when I go into the My Cars view, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1996"
  },
  {
    "text": "I see everything I've purchased. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=1999"
  },
  {
    "text": "All my cars are grouped together at the top ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2001"
  },
  {
    "text": "and my subscription is below. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2003"
  },
  {
    "text": "Now my app has a full working store and it looks awesome! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2006"
  },
  {
    "text": "And that's how you can use the transaction history ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2010"
  },
  {
    "text": "and subscription status APIs to make informed decisions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2013"
  },
  {
    "text": "in your app about what UI your users see. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2016"
  },
  {
    "text": "Now let's go back to Ross who will talk more in depth ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2020"
  },
  {
    "text": "on the JSON Web Signature object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2022"
  },
  {
    "text": "Ross: Thanks again for the fantastic demo, Jakob. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2026"
  },
  {
    "text": "You can really see how the new transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2029"
  },
  {
    "text": "and subscription APIs come in handy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2031"
  },
  {
    "text": "Now that we've seen the two ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2034"
  },
  {
    "text": "that StoreKit 2 uses JWS for security, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2035"
  },
  {
    "text": "I promised we'd take a closer look at it ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2038"
  },
  {
    "text": "and how you can do your own validation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2040"
  },
  {
    "text": "JSON Web Signature is comprised of three parts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2043"
  },
  {
    "text": "The first is the header, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2046"
  },
  {
    "text": "which contains metadata about the object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2048"
  },
  {
    "text": "This contains crucial information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2050"
  },
  {
    "text": "such as which algorithm is used for signing ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2052"
  },
  {
    "text": "and where to find the certificate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2054"
  },
  {
    "text": "used to validate the signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2056"
  },
  {
    "text": "StoreKit 2 currently uses an ECDSA algorithm, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2058"
  },
  {
    "text": "which is supported natively in Swift with CryptoKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2061"
  },
  {
    "text": "For the certificate, StoreKit 2 uses the x5c header, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2065"
  },
  {
    "text": "which indicates that the entire certificate chain ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2068"
  },
  {
    "text": "is included in the JWS data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2071"
  },
  {
    "text": "This means that no internet connection is necessary ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2073"
  },
  {
    "text": "in order to validate these JWS signatures. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2075"
  },
  {
    "text": "The next part of the JWS data is the payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2080"
  },
  {
    "text": "This is the main information such as transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2083"
  },
  {
    "text": "product ID, purchase date, and so on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2086"
  },
  {
    "text": "Once you've validated the signature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2090"
  },
  {
    "text": "this is where you go to read all the data you want to know ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2092"
  },
  {
    "text": "about the transaction or subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2094"
  },
  {
    "text": "And the final part of the JWS data is the signature itself. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2097"
  },
  {
    "text": "This is generated using both the header and the payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2101"
  },
  {
    "text": "Validating the JWS signature ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2105"
  },
  {
    "text": "is a well-documented part of the standard, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2107"
  },
  {
    "text": "so I recommend going straight to the original source ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2109"
  },
  {
    "text": "if you're interested in writing your own implementation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2111"
  },
  {
    "text": "I've included a link to this document in the resources ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2114"
  },
  {
    "text": "associated with this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2116"
  },
  {
    "text": "Once you've validated the signature from the JWS data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2118"
  },
  {
    "text": "there are just a couple more things you should do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2121"
  },
  {
    "text": "to make sure the signed info is valid for your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2123"
  },
  {
    "text": "and the current device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2125"
  },
  {
    "text": "First, you should make sure that the bundle ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2127"
  },
  {
    "text": "present in the signed info payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2129"
  },
  {
    "text": "matches the bundle ID of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2131"
  },
  {
    "text": "We recommend that for added security, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2133"
  },
  {
    "text": "you embed your app's bundle ID somewhere in the app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2135"
  },
  {
    "text": "rather than relying on an API call, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2138"
  },
  {
    "text": "and use that value to compare it to the bundle ID in the payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2140"
  },
  {
    "text": "And the final thing you should do ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2144"
  },
  {
    "text": "is perform a device validation check. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2145"
  },
  {
    "text": "This ensures that the signed info was actually generated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2148"
  },
  {
    "text": "for the device it currently on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2150"
  },
  {
    "text": "Use the StoreKit 2 API AppStore.deviceVerificationID ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2153"
  },
  {
    "text": "to retrieve the current device verification identifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2157"
  },
  {
    "text": "Then, take the device verification nonce ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2160"
  },
  {
    "text": "from the signed info ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2162"
  },
  {
    "text": "and append the device verification identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2164"
  },
  {
    "text": "you just got from StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2166"
  },
  {
    "text": "Perform a SHA384 hash on this value and compare the result ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2168"
  },
  {
    "text": "to the device verification field from the signed info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2172"
  },
  {
    "text": "If they match, then the signed info was generated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2175"
  },
  {
    "text": "for this device and your signed info validation is complete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2177"
  },
  {
    "text": "One final thing to note is that these new JWS objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2181"
  },
  {
    "text": "are for in-app purchase only. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2184"
  },
  {
    "text": "So if you need to validate the app receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2186"
  },
  {
    "text": "you should use the existing API and process for that. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2188"
  },
  {
    "text": "And of course, we are offering new App Store server APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2192"
  },
  {
    "text": "for these new JWS objects, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2195"
  },
  {
    "text": "so you can retrieve and validate them directly on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2197"
  },
  {
    "text": "Well, I hope you were as excited to meet StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2201"
  },
  {
    "text": "as we were to introduce it to you today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2203"
  },
  {
    "text": "StoreKit 2 is making in-app purchase even better ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2206"
  },
  {
    "text": "with new APIs that give you more information ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2208"
  },
  {
    "text": "and are easier to use than ever. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2211"
  },
  {
    "text": "This includes new JSON-based info objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2213"
  },
  {
    "text": "for each transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2215"
  },
  {
    "text": "as well as APIs to give you transaction details ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2217"
  },
  {
    "text": "and historical transaction data in your native code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2220"
  },
  {
    "text": "Combine that with the new subscription status APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2223"
  },
  {
    "text": "and StoreKit 2 unlocks a wealth of possibilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2226"
  },
  {
    "text": "for your in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2228"
  },
  {
    "text": "To learn even more about in-app purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2231"
  },
  {
    "text": "I encourage you to watch these other sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2233"
  },
  {
    "text": "for server-side coding and supporting customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2235"
  },
  {
    "text": "Jakob and I are thrilled ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2238"
  },
  {
    "text": "we could introduce you to StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2239"
  },
  {
    "text": "Thanks for joining us at WWDC21! ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2241"
  },
  {
    "text": "♪",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10114/?time=2244"
  }
]