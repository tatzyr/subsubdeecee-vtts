[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=1"
  },
  {
    "text": "Hi. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=9"
  },
  {
    "text": "My name is Yann, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=10"
  },
  {
    "text": "and I'd like to tell you about ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=11"
  },
  {
    "text": "a new way to connect your Bluetooth devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=12"
  },
  {
    "text": "to Apple Watch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=14"
  },
  {
    "text": "First, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=16"
  },
  {
    "text": "I'll review how Core Bluetooth works on watchOS 7. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=17"
  },
  {
    "text": "Then I'll talk about an exciting new feature in watchOS 8. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=20"
  },
  {
    "text": "And I'll discuss the best ways ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=25"
  },
  {
    "text": "to design your accessories and your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=27"
  },
  {
    "text": "to work with Apple Watch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=29"
  },
  {
    "text": "Let's start with how Core Bluetooth works today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=31"
  },
  {
    "text": "You can only connect to Bluetooth devices ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=34"
  },
  {
    "text": "while your app is in the foreground ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=36"
  },
  {
    "text": "or during a background session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=39"
  },
  {
    "text": "This is great when a person wants to focus on your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=41"
  },
  {
    "text": "to get information from their accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=44"
  },
  {
    "text": "But what if you wanted to have a complication ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=46"
  },
  {
    "text": "with information from your accessory? ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=49"
  },
  {
    "text": "Currently, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=52"
  },
  {
    "text": "the complication could not be updated ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=53"
  },
  {
    "text": "unless a person opened your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=55"
  },
  {
    "text": "Now in watchOS 8, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=57"
  },
  {
    "text": "you can connect your Bluetooth accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=59"
  },
  {
    "text": "during Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=61"
  },
  {
    "text": "This enables you to update your complications ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=63"
  },
  {
    "text": "with information from your accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=66"
  },
  {
    "text": "or send local notification if its battery is running low. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=68"
  },
  {
    "text": "With my example temperature sensor, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=71"
  },
  {
    "text": "now I can update the temperature in a complication, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=74"
  },
  {
    "text": "so I can see it whenever I glance at my watch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=78"
  },
  {
    "text": "We are using a temperature sensor ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=82"
  },
  {
    "text": "in our example, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=83"
  },
  {
    "text": "but it could be any accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=85"
  },
  {
    "text": "that someone would want to see at-a-glance information about.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=87"
  },
  {
    "text": "To start using Bluetooth during Background App Refresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=92"
  },
  {
    "text": "simply add bluetooth-central ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=95"
  },
  {
    "text": "to UIBackgroundModes in your Info.plist. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=98"
  },
  {
    "text": "This may also appear as \"Required background modes\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=102"
  },
  {
    "text": "and \"App communicates using CoreBluetooth.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=106"
  },
  {
    "text": "Here's a table showing differences between platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=110"
  },
  {
    "text": "These are the current ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=114"
  },
  {
    "text": "supported configurations ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=115"
  },
  {
    "text": "for Bluetooth Low Energy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=116"
  },
  {
    "text": "Let's dive into how your accessory communicates ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=119"
  },
  {
    "text": "with Apple Watch.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=122"
  },
  {
    "text": "Let's say a user has already paired with your accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=124"
  },
  {
    "text": "and they open your Watch app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=128"
  },
  {
    "text": "Your app tries to connect to your accessory, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=131"
  },
  {
    "text": "and as soon as an advertisement is seen, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=133"
  },
  {
    "text": "a Bluetooth LE connection is established. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=136"
  },
  {
    "text": "When a user exits your watchOS app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=139"
  },
  {
    "text": "the Bluetooth connection will terminate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=142"
  },
  {
    "text": "The Bluetooth connection won't be available ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=144"
  },
  {
    "text": "until the next time your watchOS app has runtime available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=146"
  },
  {
    "text": "Let's analyze what happens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=150"
  },
  {
    "text": "during your next background app refresh ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=152"
  },
  {
    "text": "on watchOS 8. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=154"
  },
  {
    "text": "Your app initiate a connection to a known peripheral, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=156"
  },
  {
    "text": "and the next time an advertisement is received, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=159"
  },
  {
    "text": "Apple Watch will connect to your accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=161"
  },
  {
    "text": "As soon as you're finished retrieving data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=165"
  },
  {
    "text": "you can terminate the Bluetooth connection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=167"
  },
  {
    "text": "and process the data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=170"
  },
  {
    "text": "Background App Refresh can happen at any time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=172"
  },
  {
    "text": "so your accessory should advertise as often as possible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=175"
  },
  {
    "text": "when it has an important update to display on Apple Watch.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=179"
  },
  {
    "text": "Now, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=183"
  },
  {
    "text": "let's say your accessory advertises very rarely ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=184"
  },
  {
    "text": "to conserve power. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=186"
  },
  {
    "text": "It is possible ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=188"
  },
  {
    "text": "that no advertisement will be received ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=189"
  },
  {
    "text": "during the Background App Refresh ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=191"
  },
  {
    "text": "and no connection will occur. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=193"
  },
  {
    "text": "Background App Refresh is not guaranteed to happen ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=195"
  },
  {
    "text": "at a specific time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=198"
  },
  {
    "text": "so your accessory must advertise frequently ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=200"
  },
  {
    "text": "whenever it has important updates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=202"
  },
  {
    "text": "One possible strategy ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=205"
  },
  {
    "text": "is to buffer sensor data on your accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=206"
  },
  {
    "text": "When it's close to the buffer limit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=209"
  },
  {
    "text": "increase its advertisement rates ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=211"
  },
  {
    "text": "to increase the chances of reconnection to Apple Watch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=213"
  },
  {
    "text": "As a guide, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=217"
  },
  {
    "text": "you should advertise at least every two seconds ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=219"
  },
  {
    "text": "in ideal RF conditions.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=221"
  },
  {
    "text": "If you expect your device to work ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=223"
  },
  {
    "text": "in a more challenging RF condition, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=225"
  },
  {
    "text": "your accessory should advertise more frequently ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=228"
  },
  {
    "text": "to increase the chances of reconnection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=230"
  },
  {
    "text": "Let's look at how your app will interact ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=232"
  },
  {
    "text": "with Core Bluetooth ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=235"
  },
  {
    "text": "and how watchOS will interact with your Bluetooth accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=237"
  },
  {
    "text": "This is a time diagram flow. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=242"
  },
  {
    "text": "Time advances from top to the bottom. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=244"
  },
  {
    "text": "Let's start with what happens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=248"
  },
  {
    "text": "when your app is in the foreground. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=250"
  },
  {
    "text": "Your accessory is advertising. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=253"
  },
  {
    "text": "You can scan for a new device ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=255"
  },
  {
    "text": "to detect your Bluetooth accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=257"
  },
  {
    "text": "Once your device has been discovered, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=259"
  },
  {
    "text": "you can initiate a connection to it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=262"
  },
  {
    "text": "As soon as Apple Watch receives an advertisement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=265"
  },
  {
    "text": "it will connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=268"
  },
  {
    "text": "Once you're done with the Bluetooth connection, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=270"
  },
  {
    "text": "you can call cancelPeripheralConnection, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=272"
  },
  {
    "text": "which will disconnect your Bluetooth device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=276"
  },
  {
    "text": "Then, at a later point, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=279"
  },
  {
    "text": "when the Apple Watch screen goes off, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=282"
  },
  {
    "text": "your watchOS app will be suspended. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=284"
  },
  {
    "text": "Now, let's take a look at what happens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=287"
  },
  {
    "text": "in the next Background App Refresh.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=289"
  },
  {
    "text": "Note that the time elapsed is not to scale. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=292"
  },
  {
    "text": "If your app needs to reconnect to your Bluetooth accessory, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=296"
  },
  {
    "text": "it can initiate a connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=299"
  },
  {
    "text": "Here the connection gets established. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=302"
  },
  {
    "text": "As mentioned before, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=304"
  },
  {
    "text": "we highly recommend to only connect to your accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=306"
  },
  {
    "text": "for only the amount of time you need. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=309"
  },
  {
    "text": "You should retrieve the data you need ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=312"
  },
  {
    "text": "and then request a disconnection during Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=313"
  },
  {
    "text": "In this case, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=318"
  },
  {
    "text": "data transfer completes ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=320"
  },
  {
    "text": "and the app cancel the peripheral connection.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=322"
  },
  {
    "text": "Let's look at another potential user flow. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=326"
  },
  {
    "text": "In this one, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=328"
  },
  {
    "text": "the Bluetooth Accessory is not near the Apple Watch ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=330"
  },
  {
    "text": "or not advertising during the Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=333"
  },
  {
    "text": "Here's how you should manage this ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=337"
  },
  {
    "text": "during Background App Refresh period. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=339"
  },
  {
    "text": "First, you will connect to a peripheral, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=342"
  },
  {
    "text": "but there are no advertisements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=345"
  },
  {
    "text": "When the expiration handler is called, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=348"
  },
  {
    "text": "you should ask to cancel the connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=350"
  },
  {
    "text": "This way, you will have a clean slate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=353"
  },
  {
    "text": "and can ask to reconnect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=355"
  },
  {
    "text": "at the beginning of the next Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=357"
  },
  {
    "text": "It is also a good practice to cancel the connection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=361"
  },
  {
    "text": "before the expiration handler is called ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=364"
  },
  {
    "text": "in order to save battery. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=366"
  },
  {
    "text": "If you need to reconnect at the next Background App Refresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=369"
  },
  {
    "text": "you can issue a connectPeripheral again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=373"
  },
  {
    "text": "As soon as Apple Watch sees the advertisement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=376"
  },
  {
    "text": "it will connect to your accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=380"
  },
  {
    "text": "At this point, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=382"
  },
  {
    "text": "you can fetch and download ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=383"
  },
  {
    "text": "all the data you need. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=385"
  },
  {
    "text": "Then, you can disconnect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=387"
  },
  {
    "text": "as soon as you are done ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=388"
  },
  {
    "text": "with the connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=389"
  },
  {
    "text": "Let's look at the final flow, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=392"
  },
  {
    "text": "where we see what happens ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=393"
  },
  {
    "text": "if you don't disconnect during Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=395"
  },
  {
    "text": "Initiate a connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=399"
  },
  {
    "text": "As soon as Apple Watch sees advertisement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=401"
  },
  {
    "text": "it will establish a connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=404"
  },
  {
    "text": "Here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=406"
  },
  {
    "text": "let's say your app didn't have time to retrieve all the data ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=407"
  },
  {
    "text": "before Background App Refresh expires. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=410"
  },
  {
    "text": "In this case, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=413"
  },
  {
    "text": "Core Bluetooth would automatically terminate ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=414"
  },
  {
    "text": "the connection at the end of the next Background App Refresh.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=416"
  },
  {
    "text": "At the next Background App Refresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=422"
  },
  {
    "text": "your app will get the event didDisconnectPeripheral. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=424"
  },
  {
    "text": "At this point, if your app needs to, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=428"
  },
  {
    "text": "it can initiate a Bluetooth connection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=431"
  },
  {
    "text": "or it can wait till the next Background App Refresh. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=434"
  },
  {
    "text": "We highly recommend to only connect to your accessory ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=437"
  },
  {
    "text": "for only the amount of time it needs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=440"
  },
  {
    "text": "Your app should request a disconnection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=443"
  },
  {
    "text": "during the Background App Refresh.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=445"
  },
  {
    "text": "Let's take a closer look at the code to implement this.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=450"
  },
  {
    "text": "When someone launches your app in the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=454"
  },
  {
    "text": "it can discover peripheral and connect to them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=457"
  },
  {
    "text": "The didDiscoverPeripheral delegate method ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=461"
  },
  {
    "text": "is called when an advertisement is detected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=465"
  },
  {
    "text": "If you have used CoreBluetooth in the past, this is familiar.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=468"
  },
  {
    "text": "Now let's look at what happens during Background App Refresh.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=473"
  },
  {
    "text": "The handleBackgroundTasks delegate method is called. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=478"
  },
  {
    "text": "You can start any of your background work, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=482"
  },
  {
    "text": "and in our case, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=485"
  },
  {
    "text": "we want to connect to our Bluetooth peripheral. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=486"
  },
  {
    "text": "During the Background App Refresh, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=489"
  },
  {
    "text": "just before termination, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=491"
  },
  {
    "text": "you also get a notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=493"
  },
  {
    "text": "that the Background App Refresh is about to finish. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=495"
  },
  {
    "text": "This is a new API in watchOS 8. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=498"
  },
  {
    "text": "You can use this to cancel any existing work ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=501"
  },
  {
    "text": "and prepare your application to go into suspended mode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=504"
  },
  {
    "text": "Then set the task as completed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=508"
  },
  {
    "text": "Also, when getting background runtime, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=511"
  },
  {
    "text": "you need to determine what will be the behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=514"
  },
  {
    "text": "when your Bluetooth device disconnects. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=516"
  },
  {
    "text": "Remember that the callback didDisconnectPeripheral ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=519"
  },
  {
    "text": "can happen while in the foreground ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=523"
  },
  {
    "text": "or in Background App Refresh ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=525"
  },
  {
    "text": "and happens on all platforms.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=527"
  },
  {
    "text": "Here, when we have the didDisconnectPeripheral, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=530"
  },
  {
    "text": "we call a function called didCompleteDisconnection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=534"
  },
  {
    "text": "that resides in your WatchKit Extension delegate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=538"
  },
  {
    "text": "This way, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=542"
  },
  {
    "text": "the behavior of this function is specific to watchOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=543"
  },
  {
    "text": "What the function didCompleteDisconnection does ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=547"
  },
  {
    "text": "is verify that we are in a Background App Refresh ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=551"
  },
  {
    "text": "and if so, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=554"
  },
  {
    "text": "indicates that the task is complete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=555"
  },
  {
    "text": "This will terminate the Background App Refresh.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=558"
  },
  {
    "text": "Let's talk about best practices ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=562"
  },
  {
    "text": "for using Core Bluetooth on Apple Watch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=563"
  },
  {
    "text": "For first-time device setup, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=566"
  },
  {
    "text": "your app must be running in the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=569"
  },
  {
    "text": "meaning the user is actively using your Watch app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=571"
  },
  {
    "text": "Scan for new peripherals at this time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=575"
  },
  {
    "text": "Once your app discovers a peripheral, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=578"
  },
  {
    "text": "it can set up the initial Bluetooth connection. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=580"
  },
  {
    "text": "It can also pair to your device if needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=584"
  },
  {
    "text": "Once your app exits the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=586"
  },
  {
    "text": "it cannot scan for new peripheral. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=589"
  },
  {
    "text": "Instead, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=591"
  },
  {
    "text": "it should request a connection ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=592"
  },
  {
    "text": "to a previously discovered peripheral. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=594"
  },
  {
    "text": "Once connected, retrieve the data needed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=597"
  },
  {
    "text": "Once finished retrieving the data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=600"
  },
  {
    "text": "your app should disconnect from the peripheral ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=602"
  },
  {
    "text": "to preserve battery. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=604"
  },
  {
    "text": "If your app doesn't disconnect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=606"
  },
  {
    "text": "before Background App Refresh ends, ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=608"
  },
  {
    "text": "Core Bluetooth will automatically disconnect ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=610"
  },
  {
    "text": "from your accessory. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=612"
  },
  {
    "text": "You can only reconnect when your app has runtime.",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=614"
  },
  {
    "text": "I encourage you to join our lab this week ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=618"
  },
  {
    "text": "if you have any questions about Core Bluetooth. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=620"
  },
  {
    "text": "Thanks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=622"
  },
  {
    "text": "[music]",
    "link": "https://developer.apple.com/videos/play/wwdc2021/10005/?time=624"
  }
]