[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=0"
  },
  {
    "text": "Gabriel Ting: Hello, and welcome to our session, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=9"
  },
  {
    "text": "\"Explore in-app purchase integration and migration.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=11"
  },
  {
    "text": "This session is divided into two parts: one dedicated to migrating ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=14"
  },
  {
    "text": "to the App Store Server API, and one dedicated to migrating ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=17"
  },
  {
    "text": "to App Store Server Notifications Version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=20"
  },
  {
    "text": "My name is Gabriel, and I am discussing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=22"
  },
  {
    "text": "how to migrate to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=24"
  },
  {
    "text": "Alex Baker: My name is Alex, and I will walk you through ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=27"
  },
  {
    "text": "migrating to App Store Server Notifications Version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=29"
  },
  {
    "text": "Gabriel: Let's first begin with a brief introduction of the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=33"
  },
  {
    "text": "and App Store Server Notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=36"
  },
  {
    "text": "We introduced the App Store Server API last year as a powerful, secure, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=38"
  },
  {
    "text": "and efficient way to obtain data and perform operations from your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=42"
  },
  {
    "text": "We aim to give you just the data that you need, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=45"
  },
  {
    "text": "signed in the JSON Web Signature or JWS format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=48"
  },
  {
    "text": "so that you can verify that the data you receive is untampered with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=51"
  },
  {
    "text": "intended for you, and signed by the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=55"
  },
  {
    "text": "For example, one of our App Store Server API endpoints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=58"
  },
  {
    "text": "the Get Transaction History endpoint, in combination with the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=60"
  },
  {
    "text": "filter and sort features, allow you to fetch any set of transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=63"
  },
  {
    "text": "that you specify, with just an originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=67"
  },
  {
    "text": "On the pane of App Store Server Notifications Version 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=70"
  },
  {
    "text": "with the increased number of states of a subscription that can be represented, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=73"
  },
  {
    "text": "Notifications Version 2 will update you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=76"
  },
  {
    "text": "of all possible states of a subscription, in real time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=79"
  },
  {
    "text": "We aim to proactively provide all the information that you need ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=82"
  },
  {
    "text": "to know about what's going on with your subscribers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=85"
  },
  {
    "text": "without having to ask us for the information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=87"
  },
  {
    "text": "Alex will walk you through this more in his portion of this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=90"
  },
  {
    "text": "If using these features with ease and efficacy interests you, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=93"
  },
  {
    "text": "this session is for you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=96"
  },
  {
    "text": "We will walk you through how to get started using the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=97"
  },
  {
    "text": "and App Store Server Notifications Version 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=101"
  },
  {
    "text": "as well as some migration tips and best practices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=103"
  },
  {
    "text": "For additional information on each of these, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=106"
  },
  {
    "text": "please refer to these additional sessions listed below.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=108"
  },
  {
    "text": "So let's get started discussing migrating to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=113"
  },
  {
    "text": "First off, we will be discussing how to start using the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=117"
  },
  {
    "text": "Second, we will dive into some of the details of signing JSON Web Tokens. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=122"
  },
  {
    "text": "Third, we will demonstrate how to verify signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=126"
  },
  {
    "text": "you receive from the App Store are genuine. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=129"
  },
  {
    "text": "Finally, we will discuss how to migrate from verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=133"
  },
  {
    "text": "to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=136"
  },
  {
    "text": "Let's get started. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=139"
  },
  {
    "text": "First, let's get into talking about how to use the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=140"
  },
  {
    "text": "with different versions of StoreKit, first with just original StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=143"
  },
  {
    "text": "then with just StoreKit 2, then discussing methods to support both ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=147"
  },
  {
    "text": "simultaneously for both clients using iOS versions that support StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=150"
  },
  {
    "text": "namely those on iOS 15 or greater, and those that do not.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=154"
  },
  {
    "text": "First off, let's take a look at what requests ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=159"
  },
  {
    "text": "to the App Store Server API look like. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=161"
  },
  {
    "text": "We see that the five APIs listed here utilize originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=163"
  },
  {
    "text": "as a path parameter. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=167"
  },
  {
    "text": "This allows you to easily call these APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=169"
  },
  {
    "text": "using the originalTransactionIds that you receive from receipts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=171"
  },
  {
    "text": "signed transactions, signed renewals, and notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=174"
  },
  {
    "text": "Next is the Look Up Order ID endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=178"
  },
  {
    "text": "This endpoint instead uses the orderId provided by a customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=180"
  },
  {
    "text": "for support queries. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=184"
  },
  {
    "text": "This is so that you can better assist with questions directly from the customer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=185"
  },
  {
    "text": "as the customer is provided an orderId in customer receipts for each transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=189"
  },
  {
    "text": "but is not provided an originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=193"
  },
  {
    "text": "This ensures that you can directly respond to customer inquiries ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=196"
  },
  {
    "text": "with data customers have on hand. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=198"
  },
  {
    "text": "The last endpoints listed here are notification related, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=201"
  },
  {
    "text": "which Alex will touch on in his portion of this session.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=204"
  },
  {
    "text": "Next, let's look at where you can get the originalTransactionIds from ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=208"
  },
  {
    "text": "in Original StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=211"
  },
  {
    "text": "When you call verifyReceipt with the unified app receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=213"
  },
  {
    "text": "the originalTransactionId you'll use when calling the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=216"
  },
  {
    "text": "comes back in the in_app field ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=219"
  },
  {
    "text": "in the receipts for each of the transactions this user purchased, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=221"
  },
  {
    "text": "as well as in the latest_receipt_info and pending_renewal_info. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=224"
  },
  {
    "text": "Now that we know how to get the originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=228"
  },
  {
    "text": "from Original StoreKit transactions, let's look at the whole flow ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=231"
  },
  {
    "text": "between a customer, the App Store Server, and your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=234"
  },
  {
    "text": "First, obtain the app receipt on your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=239"
  },
  {
    "text": "Next, take the app receipt and call verifyReceipt with it from your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=242"
  },
  {
    "text": "This will return the decoded receipt. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=248"
  },
  {
    "text": "From the decoded receipt, gather all of the originalTransactionIds ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=251"
  },
  {
    "text": "in precisely the same ways I previously showed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=254"
  },
  {
    "text": "Next, you can call the Get Transaction History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=257"
  },
  {
    "text": "with any one of the gathered originalTransactionIds, which will return ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=260"
  },
  {
    "text": "the history of transactions for this user as signed transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=264"
  },
  {
    "text": "These transactions include non-consumables, refunded consumables, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=267"
  },
  {
    "text": "non-renewing subscriptions, and auto-renewing subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=271"
  },
  {
    "text": "Then, if you want to get the latest signed transaction and signed renewal information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=274"
  },
  {
    "text": "for a specific subscription, call the Get All Subscription Statuses endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=278"
  },
  {
    "text": "with the corresponding originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=283"
  },
  {
    "text": "This will return all of the signed transactions and renewals ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=285"
  },
  {
    "text": "for the subscription that corresponds to the given originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=288"
  },
  {
    "text": "Next, let's look at where the originalTransactionId is ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=292"
  },
  {
    "text": "in the case of StoreKit 2 transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=295"
  },
  {
    "text": "This is the code on the client to obtain an originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=298"
  },
  {
    "text": "from a transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=301"
  },
  {
    "text": "On devices that support StoreKit 2– ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=303"
  },
  {
    "text": "namely devices that are on iOS 15 or later– ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=305"
  },
  {
    "text": "you can get the originalID property on a verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=308"
  },
  {
    "text": "decoded transaction to get the originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=311"
  },
  {
    "text": "Now, looking at the server side, here is an example of a signed JWS transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=315"
  },
  {
    "text": "which is the data type that you receive in signed transactions and signed renewals ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=319"
  },
  {
    "text": "from the App Store Server API and App Store Server Notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=324"
  },
  {
    "text": "Here, we see that originalTransactionId is a top level field.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=328"
  },
  {
    "text": "Next, let's look at the whole flow between a customer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=334"
  },
  {
    "text": "the App Store Server, and your server for StoreKit 2 transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=337"
  },
  {
    "text": "First, take the signed transaction on the device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=341"
  },
  {
    "text": "With StoreKit 2, you can verify this transaction on-device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=344"
  },
  {
    "text": "Using the on-device status listener, transaction listener, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=348"
  },
  {
    "text": "or last transaction will keep you updated on latest transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=351"
  },
  {
    "text": "cancellations, and refunds, which can then be sent to your server for record-keeping. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=354"
  },
  {
    "text": "For example, these are updated on subscription renewals, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=358"
  },
  {
    "text": "subscription offer redemptions, expirations, and more.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=361"
  },
  {
    "text": "Send the transaction to your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=365"
  },
  {
    "text": "In combination with App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=367"
  },
  {
    "text": "which Alex will dive more into in the following section, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=370"
  },
  {
    "text": "you can keep up-to-date with the latest status and state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=372"
  },
  {
    "text": "of a subscription without having to call the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=375"
  },
  {
    "text": "When you do need to perform an operation on a subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=379"
  },
  {
    "text": "such as extending the renewal date of a subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=382"
  },
  {
    "text": "you can use the originalTransactionId from the signed transaction to call ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=385"
  },
  {
    "text": "corresponding endpoints and get back the data that you need. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=389"
  },
  {
    "text": "Now that we've seen how to use the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=393"
  },
  {
    "text": "with original StoreKit and StoreKit 2, let's talk about how to support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=396"
  },
  {
    "text": "both StoreKit and StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=399"
  },
  {
    "text": "You can take advantage of the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=402"
  },
  {
    "text": "without fully adopting StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=404"
  },
  {
    "text": "As shown previously, you can get the originalTransactionId ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=407"
  },
  {
    "text": "from a receipt in Original StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=410"
  },
  {
    "text": "You can also get the originalTransactionID in StoreKit 2 from a JWS transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=412"
  },
  {
    "text": "You can also use the App Store Server API independently of any other APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=419"
  },
  {
    "text": "It is not tied to using a specific version of other APIs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=424"
  },
  {
    "text": "In terms of App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=427"
  },
  {
    "text": "it can be used with either version 1 or version 2 notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=429"
  },
  {
    "text": "We do recommend using version 2 because it notifies you of changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=433"
  },
  {
    "text": "to subscriptions as they occur, uses the secure JWS format, and more, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=436"
  },
  {
    "text": "which Alex will dive into more in his part of this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=441"
  },
  {
    "text": "However, you can use the App Store Server API separately, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=444"
  },
  {
    "text": "with version 1 notifications or without notifications at all. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=447"
  },
  {
    "text": "Next, let's discuss how you can process new purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=451"
  },
  {
    "text": "after you completed the migration steps I previously walked through. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=454"
  },
  {
    "text": "To support new purchases on devices using original StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=458"
  },
  {
    "text": "you can take new receipts as they come, sending them to your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=461"
  },
  {
    "text": "and do precisely the same steps as I previously showed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=465"
  },
  {
    "text": "while collecting new data along the way– ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=468"
  },
  {
    "text": "call verifyReceipt with the new receipts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=470"
  },
  {
    "text": "and get the decoded receipt with the new originalTransactionId in latest_receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=472"
  },
  {
    "text": "correlate those originalTransactionIds with other originalTransactionIds ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=477"
  },
  {
    "text": "in the in_app section of the receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=481"
  },
  {
    "text": "to group together your transaction information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=483"
  },
  {
    "text": "Then, you can take the new originalTransactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=486"
  },
  {
    "text": "and call the App Store Server API as needed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=488"
  },
  {
    "text": "such as if you need to call the Get All Subscription Statuses endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=491"
  },
  {
    "text": "to get you the latest status of the corresponding subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=494"
  },
  {
    "text": "Now that we've covered how to use the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=498"
  },
  {
    "text": "with both Original StoreKit and StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=501"
  },
  {
    "text": "let's dive into some of the details of signing JSON Web Tokens, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=503"
  },
  {
    "text": "a requirement to call the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=506"
  },
  {
    "text": "In order to authenticate that your developer account is the caller ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=509"
  },
  {
    "text": "of the App Store Server API, we use JSON Web Tokens, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=513"
  },
  {
    "text": "also known as JWTs, to authenticate requests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=516"
  },
  {
    "text": "This token must be included in every request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=519"
  },
  {
    "text": "as an authorization header in calls from your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=522"
  },
  {
    "text": "A JWT consists of a header, a payload, and signature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=525"
  },
  {
    "text": "Next, we'll go into how to construct a JWT specific to your application.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=529"
  },
  {
    "text": "Here, we can see how a JSON Web Token is composed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=535"
  },
  {
    "text": "as well as the structure of the header and payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=537"
  },
  {
    "text": "The token itself can be broken into three parts, separated by periods: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=540"
  },
  {
    "text": "the base 64 encoded header, the base 64 encoded payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=544"
  },
  {
    "text": "and then the signature, which is composed of the base 64 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=549"
  },
  {
    "text": "encoded header and payload, signed using your signing secret. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=551"
  },
  {
    "text": "The header is composed of these fields that contain metadata ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=556"
  },
  {
    "text": "about how to sign your data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=559"
  },
  {
    "text": "One of the important fields here is the key ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=561"
  },
  {
    "text": "which is your private key ID in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=564"
  },
  {
    "text": "This needs to match the key you use to sign the JWT.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=567"
  },
  {
    "text": "The payload contains additional information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=572"
  },
  {
    "text": "about your specific application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=574"
  },
  {
    "text": "Please refer to the article \"Creating API Keys to Use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=577"
  },
  {
    "text": "With the App Store Server API\" for additional information and guidance ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=580"
  },
  {
    "text": "on how to obtain your API Key. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=583"
  },
  {
    "text": "For details on each of these fields, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=586"
  },
  {
    "text": "please refer to the article \"Generating Tokens for API Requests.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=588"
  },
  {
    "text": "Once you have the header and payload with all the appropriate information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=593"
  },
  {
    "text": "next you will sign the JWT ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=597"
  },
  {
    "text": "using the certificate that corresponds to the keyId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=598"
  },
  {
    "text": "Here is the core pseudocode that you can use, regardless of language. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=602"
  },
  {
    "text": "First, make sure that you have the private key that corresponds ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=606"
  },
  {
    "text": "to the key id provided in the header that we just looked at. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=609"
  },
  {
    "text": "Then, call the signing function that your JWT library exposes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=612"
  },
  {
    "text": "with your private key, header, and payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=616"
  },
  {
    "text": "Since the header contains the signing algorithm, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=619"
  },
  {
    "text": "the JWT library signs it according to the provided algorithm.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=621"
  },
  {
    "text": "Finally, here is an example usage of this token when authenticating a cURL call ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=627"
  },
  {
    "text": "to the Get All Subscription Statuses endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=631"
  },
  {
    "text": "Replace ${token} and ${originalTransactionId} ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=634"
  },
  {
    "text": "with the values of the token you generated ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=636"
  },
  {
    "text": "and your desired originalTransactionId, respectively. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=638"
  },
  {
    "text": "Next, let's talk about how to verify that the signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=641"
  },
  {
    "text": "you receive are for you and signed by the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=645"
  },
  {
    "text": "Signed transactions are, in essence, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=649"
  },
  {
    "text": "JavaScript Object Notation, or JSON objects ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=651"
  },
  {
    "text": "that are cryptographically signed such that if they are tampered with ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=654"
  },
  {
    "text": "between the App Store and your server, you can detect it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=657"
  },
  {
    "text": "Signed transactions are signed in the JSON Web Signature, or JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=660"
  },
  {
    "text": "The signed transactions that the App Store sends you will arrive in the JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=664"
  },
  {
    "text": "By verifying the JWSs you receive, you will verify that the data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=669"
  },
  {
    "text": "came from the App Store, and the contents are untampered with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=672"
  },
  {
    "text": "Now, let's look at how to verify a signed transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=676"
  },
  {
    "text": "First, base 64 decode the header. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=680"
  },
  {
    "text": "Then, one can determine what signing algorithm to use via the alg claim. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=683"
  },
  {
    "text": "This will be used as part of verifying the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=687"
  },
  {
    "text": "The certificate chain in the x5c claim is issued by Apple, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=691"
  },
  {
    "text": "and validation of the claim indicates that the data is ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=694"
  },
  {
    "text": "properly signed and untampered with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=697"
  },
  {
    "text": "Please refer to the App Store developer documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=699"
  },
  {
    "text": "for further information on how to verify JWSs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=702"
  },
  {
    "text": "In essence, the x5c chain is a chain of certificates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=706"
  },
  {
    "text": "Successful verification of the certificate chain tells you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=710"
  },
  {
    "text": "that the data can be trusted and that the data is signed by Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=713"
  },
  {
    "text": "Order matters for the certificate chain. First comes the root certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=717"
  },
  {
    "text": "This root certificate may be followed by additional certificates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=721"
  },
  {
    "text": "where each of these certificates are signed by the previous certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=724"
  },
  {
    "text": "I will refer to the last certificate in the chain as the leaf certificate.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=728"
  },
  {
    "text": "The first certificate is referred to as the root certificate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=733"
  },
  {
    "text": "and is self-signed. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=736"
  },
  {
    "text": "This certificate should match the root certificate you obtain ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=738"
  },
  {
    "text": "from Apple's Certificate Authority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=740"
  },
  {
    "text": "If the certificates do not match, the chain should not be trusted. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=742"
  },
  {
    "text": "The leaf certificate, the last certificate in the chain, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=747"
  },
  {
    "text": "is the certificate that is used to sign the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=749"
  },
  {
    "text": "Here is an example of what the header ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=753"
  },
  {
    "text": "of a JWS the App Store sends may look like. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=755"
  },
  {
    "text": "First is the algorithm used to sign the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=758"
  },
  {
    "text": "Next is the x5c certificate chain, with the certificates listed in order.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=762"
  },
  {
    "text": "Now, let's look at what generating an x5c certificate chain looks like ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=768"
  },
  {
    "text": "from a high-level overview. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=772"
  },
  {
    "text": "We start off with the root certificate from Apple's Certificate Authority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=773"
  },
  {
    "text": "Then, the root certificate is used to sign the intermediate signing certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=777"
  },
  {
    "text": "The intermediate signing certificate is then used to sign the leaf certificate.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=782"
  },
  {
    "text": "Now that we've covered what generating an x5c certificate chain looks like, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=788"
  },
  {
    "text": "let's look at what verifying a chain looks like. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=792"
  },
  {
    "text": "Starting at the leaf certificate, we ensure that it was signed ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=794"
  },
  {
    "text": "by the intermediate signing certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=797"
  },
  {
    "text": "Then we ensure that the intermediate signing certificate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=800"
  },
  {
    "text": "was signed by the root certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=803"
  },
  {
    "text": "Additionally, the root certificate should match ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=805"
  },
  {
    "text": "the one from the Apple Certificate Authority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=807"
  },
  {
    "text": "If all of these steps are successful, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=809"
  },
  {
    "text": "then the entire chain is verified as legitimate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=811"
  },
  {
    "text": "Let's talk about a method to verify the certificate chain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=815"
  },
  {
    "text": "Here is a command to verify the x5c certificate chain using OpenSSL. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=818"
  },
  {
    "text": "Breaking this into pieces, the command verify, broadly speaking, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=823"
  },
  {
    "text": "allows you to pass in certificates for verification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=826"
  },
  {
    "text": "The flag trusted allows you to provide a certificate to trust– ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=829"
  },
  {
    "text": "in other words, a certificate that will be used to verify the following certificates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=833"
  },
  {
    "text": "in this case, we are passing in the root certificate you obtained ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=837"
  },
  {
    "text": "from the Apple Certificate Authority, and thus can be trusted. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=840"
  },
  {
    "text": "We'll use this to verify the WWDR certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=844"
  },
  {
    "text": "the next certificate in the chain.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=847"
  },
  {
    "text": "The untrusted flag allows you to provide the certificate or certificates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=850"
  },
  {
    "text": "that you wish to verify using the certificate that you trust. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=854"
  },
  {
    "text": "Here, we first pass in the WWDR certificate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=858"
  },
  {
    "text": "from the Apple Certificate Authority, which is signed by the root certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=861"
  },
  {
    "text": "This should match the second certificate in the x5c chain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=865"
  },
  {
    "text": "And finally, the leaf certificate here is the last certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=869"
  },
  {
    "text": "which is signed by the previous certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=873"
  },
  {
    "text": "In the case of a successful verification, a success code is returned. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=876"
  },
  {
    "text": "You may then proceed to use the decoded information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=881"
  },
  {
    "text": "In the case of an unsuccessful verification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=884"
  },
  {
    "text": "determine the issue based on the returned error code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=886"
  },
  {
    "text": "If not possible to verify, this data may be tampered with and should not be used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=889"
  },
  {
    "text": "Please refer to the App Store developer documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=893"
  },
  {
    "text": "for complete instructions on verifying an x5c certificate chain using OpenSSL.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=896"
  },
  {
    "text": "Here is some pseudocode for how one might go about verifying a signed transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=902"
  },
  {
    "text": "First, obtain the JWS you wish to verify. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=906"
  },
  {
    "text": "Then, take the certificate your JWS library requires for verification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=910"
  },
  {
    "text": "Call the verify function of your JWS library, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=914"
  },
  {
    "text": "using the appropriate certificate. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=917"
  },
  {
    "text": "The certificate that signs the JWS is the leaf certificate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=919"
  },
  {
    "text": "though some libraries require passing in the entire chain.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=922"
  },
  {
    "text": "In the case that the call succeeded, then you can proceed on with your tasks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=927"
  },
  {
    "text": "In the case that this was the result of a call to the App Store Server API, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=931"
  },
  {
    "text": "then you can proceed to store the validated data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=935"
  },
  {
    "text": "As for the case of notifications, Alex will go more into this ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=938"
  },
  {
    "text": "in his portion of this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=941"
  },
  {
    "text": "In the case that the JWS cannot be validated, do not use the JWS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=944"
  },
  {
    "text": "This may mean that it has been tampered with or was not sent by the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=948"
  },
  {
    "text": "Alex will dive more into how to better ensure security when using notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=952"
  },
  {
    "text": "Please refer to the App Store developer documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=957"
  },
  {
    "text": "for complete instructions on verifying and handling a JWS.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=959"
  },
  {
    "text": "Now, let's review some use cases for migration from verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=964"
  },
  {
    "text": "to the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=968"
  },
  {
    "text": "First, let's look at the case where you want to check ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=970"
  },
  {
    "text": "what the latest status is for any given subscriber. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=973"
  },
  {
    "text": "This keeps you up to date with any changes to an individual subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=976"
  },
  {
    "text": "Previously, to obtain the most up-to-date status ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=980"
  },
  {
    "text": "of a subscriber, one had to call verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=982"
  },
  {
    "text": "and determine the status of the subscription based on fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=985"
  },
  {
    "text": "such as expiration intent, grace_period_expires_date, et cetera. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=988"
  },
  {
    "text": "Now, with the App Store Server API, the Get All Subscription Statuses endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=992"
  },
  {
    "text": "can be called to obtain the latest status of a subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=996"
  },
  {
    "text": "with a status field containing the current status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=998"
  },
  {
    "text": "as well as the latest, most up-to-date ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1001"
  },
  {
    "text": "signed transaction and renewal information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1003"
  },
  {
    "text": "Let's look at a flow of how you could execute on this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1005"
  },
  {
    "text": "First, for any decoded receipt that you have, you can obtain ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1008"
  },
  {
    "text": "the originalTransactionIds from it just in the way that I showed previously. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1011"
  },
  {
    "text": "Then, you can call the Get All Subscription Statuses endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1015"
  },
  {
    "text": "for that originalTransactionId, which will return the latest ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1018"
  },
  {
    "text": "signed transactions and renewals for that transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1022"
  },
  {
    "text": "Next, let's look at the case of obtaining the latest transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1024"
  },
  {
    "text": "Obtaining the latest transactions informs you of what a user has purchased, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1028"
  },
  {
    "text": "what has renewed, if there are any changes to a user's subscription, and more. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1032"
  },
  {
    "text": "Previously, to obtain the latest transactions for a user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1036"
  },
  {
    "text": "one had to call verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1039"
  },
  {
    "text": "and use the in_app array and examine latest_receipt_info, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1041"
  },
  {
    "text": "which contained all of the transactions for a user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1044"
  },
  {
    "text": "With the App Store Server API, to obtain the latest transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1047"
  },
  {
    "text": "the Get Transaction History endpoint allows you to fetch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1051"
  },
  {
    "text": "the full purchase history for a user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1053"
  },
  {
    "text": "Furthermore, pagination combined with the new filter and sort features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1056"
  },
  {
    "text": "that is covered in the WWDC22 talk, \"What's new with in-app purchase,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1060"
  },
  {
    "text": "ensures that you can efficiently fetch precisely the data that you need.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1063"
  },
  {
    "text": "Let's look at a flow of what this may entail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1068"
  },
  {
    "text": "With any originalTransactionId belonging to that user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1071"
  },
  {
    "text": "you can call the Get Transaction History endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1073"
  },
  {
    "text": "which will return the history of transactions for this user ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1076"
  },
  {
    "text": "as signed transactions, filtered, sorted, and paginated to your specifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1079"
  },
  {
    "text": "Finally, let’s look at the case of adopting appAccountToken. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1086"
  },
  {
    "text": "The appAccountToken field allows you to provide a UUID ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1089"
  },
  {
    "text": "that associates a StoreKit 2 transaction with a user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1092"
  },
  {
    "text": "Then, on signed transactions, signed renewals, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1095"
  },
  {
    "text": "and notifications for that transaction, the appAccountToken will appear. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1098"
  },
  {
    "text": "Previously, there was not support for appAccountToken with original StoreKit, , ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1102"
  },
  {
    "text": "as it was a feature that was new to StoreKit2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1105"
  },
  {
    "text": "Now, we added support for supplying a UUID in the field applicationUsername ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1109"
  },
  {
    "text": "in Original StoreKit to support compatibility ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1113"
  },
  {
    "text": "with Original StoreKit clients. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1116"
  },
  {
    "text": "Under this condition, that UUID will support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1118"
  },
  {
    "text": "all the functionality that appAccountToken does. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1120"
  },
  {
    "text": "The appAccountToken then comes back in verifyReceipt for Original StoreKit users, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1123"
  },
  {
    "text": "and also appears for both Original StoreKit and StoreKit 2 users ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1127"
  },
  {
    "text": "in calls to the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1131"
  },
  {
    "text": "and notifications from App Store Server Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1133"
  },
  {
    "text": "That's it for the App Store Server API portion of this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1136"
  },
  {
    "text": "Next, here's Alex to cover migrating to App Store Server Notifications Version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1139"
  },
  {
    "text": "Alex: Thanks, Gabriel. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1144"
  },
  {
    "text": "My name is Alex, and I'm excited to be here today ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1145"
  },
  {
    "text": "to discuss App Store Server Notifications Version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1147"
  },
  {
    "text": "First, we'll be covering how to get started with version 2 notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1151"
  },
  {
    "text": "Next, how version 2 notifications differ and build upon other models available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1155"
  },
  {
    "text": "Third, we'll talk about recovering in the case of missed notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1161"
  },
  {
    "text": "and some of the new resources available to help accomplish this task. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1164"
  },
  {
    "text": "Last, how notifications can provide insight into customer behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1169"
  },
  {
    "text": "and create additional opportunities for being informed ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1172"
  },
  {
    "text": "about the subscription lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1174"
  },
  {
    "text": "Let's go over a brief introduction into what notifications are ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1177"
  },
  {
    "text": "and who can use them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1180"
  },
  {
    "text": "App Store Server Notifications are messages we send you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1182"
  },
  {
    "text": "whenever certain actions are taken by users of your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1185"
  },
  {
    "text": "These notifications broadly fall into two categories, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1189"
  },
  {
    "text": "subscription updates and refund updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1192"
  },
  {
    "text": "although we're always working to cover additional scenarios. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1194"
  },
  {
    "text": "We provide these notifications to help fill in gaps into user actions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1197"
  },
  {
    "text": "that may not be available to you in the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1200"
  },
  {
    "text": "As an example, one of our most common use cases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1203"
  },
  {
    "text": "is the renewal of a subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1206"
  },
  {
    "text": "A user may not be in the app when this transaction becomes available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1208"
  },
  {
    "text": "App Store Server Notifications help account for this issue ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1212"
  },
  {
    "text": "by proactively sending the latest transaction information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1215"
  },
  {
    "text": "directly to your servers when the subscription renews. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1217"
  },
  {
    "text": "Version 2 notifications share many similarities with the StoreKit 2 model ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1220"
  },
  {
    "text": "and the App Store Server API you just heard about from Gabriel. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1224"
  },
  {
    "text": "However, while they work well together, they are all independent tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1227"
  },
  {
    "text": "that can be adopted at different times. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1231"
  },
  {
    "text": "Most importantly, you can continue to support clients ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1233"
  },
  {
    "text": "where StoreKit 2 is not available, pre iOS-15 clients, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1236"
  },
  {
    "text": "while utilizing Version 2 Server Notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1240"
  },
  {
    "text": "We've worked to make Version 2 notifications one of our most ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1243"
  },
  {
    "text": "in-depth and flexible tools for providing information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1246"
  },
  {
    "text": "about a user throughout the entire subscription lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1249"
  },
  {
    "text": "We'll go more in-depth in this later in the presentation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1252"
  },
  {
    "text": "but notifications provide information that is almost impossible to capture ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1254"
  },
  {
    "text": "for actions taken outside of the app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1258"
  },
  {
    "text": "I hope I've interested you in the concept of notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1261"
  },
  {
    "text": "and Version 2 notifications in particular. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1263"
  },
  {
    "text": "Before we go further, while this presentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1266"
  },
  {
    "text": "walks you through getting started and best practices ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1269"
  },
  {
    "text": "for receiving notifications, it doesn't tell the whole story. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1271"
  },
  {
    "text": "Please refer to these recent videos for more information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1274"
  },
  {
    "text": "about notifications and how they can meet various use cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1276"
  },
  {
    "text": "Let's look at getting Version 2 notifications set up. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1280"
  },
  {
    "text": "We're going to walk through how to set up your notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1283"
  },
  {
    "text": "all the way to receiving your first one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1285"
  },
  {
    "text": "First, go to your app's page in App Store Connect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1287"
  },
  {
    "text": "Scrolling down, you will see a section for App Store Server Notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1292"
  },
  {
    "text": "Here you'll see options for both production and sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1297"
  },
  {
    "text": "Each environment can contain a separate URL ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1301"
  },
  {
    "text": "and a separate notification version. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1303"
  },
  {
    "text": "Here is an example of the options page for production settings. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1307"
  },
  {
    "text": "Sandbox settings are exactly the same. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1310"
  },
  {
    "text": "We recommend, especially if you are a Version 1 notification user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1313"
  },
  {
    "text": "that you first try Version 2 notifications in the sandbox environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1317"
  },
  {
    "text": "This is a great place to become comfortable with notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1321"
  },
  {
    "text": "without impacting your production setup. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1324"
  },
  {
    "text": "Select the Set Up Sandbox button, provide your server's URL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1327"
  },
  {
    "text": "and select Version 2 Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1331"
  },
  {
    "text": "Before triggering notifications, confirm you have a valid ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1335"
  },
  {
    "text": "HTTPS certificate for your server endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1338"
  },
  {
    "text": "Also confirm you have allowed Apple's public IPs access to your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1341"
  },
  {
    "text": "Some of the most common failures when setting up notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1345"
  },
  {
    "text": "relate to firewalls and certificates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1347"
  },
  {
    "text": "These are also great to check if you suddenly stop receiving notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1350"
  },
  {
    "text": "as an initial troubleshooting step. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1353"
  },
  {
    "text": "Now you are ready to receive your first notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1356"
  },
  {
    "text": "In Sandbox, notifications can be triggered ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1359"
  },
  {
    "text": "by a variety of actions, like buying an in-app subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1361"
  },
  {
    "text": "However, for ease of use while testing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1364"
  },
  {
    "text": "we recommend triggering a notification using the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1367"
  },
  {
    "text": "Request a Test Notification endpoint, part of the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1369"
  },
  {
    "text": "This endpoint helps to automate the notification testing process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1374"
  },
  {
    "text": "After triggering the Request a Test Notification endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1377"
  },
  {
    "text": "you should expect to see a notification arrive soon. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1379"
  },
  {
    "text": "If you are having issues receiving notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1382"
  },
  {
    "text": "please refer the to new Get Test Notification Status endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1384"
  },
  {
    "text": "which can provide a brief status about why the notification failed to be delivered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1387"
  },
  {
    "text": "For example, a status like SSL_ISSUE would be ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1391"
  },
  {
    "text": "a clue to double-check your HTTPS certificates. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1394"
  },
  {
    "text": "We recommend triggering a test notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1397"
  },
  {
    "text": "whenever you are performing a configuration change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1400"
  },
  {
    "text": "This is a great way to confirm you can still receive notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1402"
  },
  {
    "text": "after the change. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1405"
  },
  {
    "text": "Now, let's move on to understanding the notification you've just received.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1406"
  },
  {
    "text": "Just like transactions we saw earlier from Gabriel, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1412"
  },
  {
    "text": "notifications are also in the JWS format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1414"
  },
  {
    "text": "Let's go over how to decode and verify a notification payload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1417"
  },
  {
    "text": "First, when receiving a notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1422"
  },
  {
    "text": "you'll want to extract the signedPayload field of the JSON body. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1424"
  },
  {
    "text": "Next, you'll perform the exact same steps Gabriel walked you through earlier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1429"
  },
  {
    "text": "for verifying a signed transaction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1432"
  },
  {
    "text": "You'll follow the same steps to verify signed data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1435"
  },
  {
    "text": "whether it is a signed notification payload from a notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1437"
  },
  {
    "text": "or a signed transaction from the App Store Server API. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1440"
  },
  {
    "text": "Next, it is important to verify which app the notification is for. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1444"
  },
  {
    "text": "If you have multiple apps sharing the same endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1449"
  },
  {
    "text": "this is a good place to determine the target app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1452"
  },
  {
    "text": "It is also important to confirm that the app the notification is targeted for ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1455"
  },
  {
    "text": "is your app, and the notification was not intended for another developer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1459"
  },
  {
    "text": "Last, one more useful check is to make sure that the environment ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1464"
  },
  {
    "text": "of the notification matches your expected environment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1467"
  },
  {
    "text": "either Production or Sandbox. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1470"
  },
  {
    "text": "Because App Store Connect allows separate URLs for each environment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1472"
  },
  {
    "text": "it is possible to enforce this requirement, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1475"
  },
  {
    "text": "or, if the URLs are shared, guarantee you are ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1477"
  },
  {
    "text": "storing and processing notifications separately based on the environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1481"
  },
  {
    "text": "At this point, the JWS is fully validated and can be stored for further processing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1486"
  },
  {
    "text": "We recommend, besides some basic checks, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1490"
  },
  {
    "text": "that your server process the notification asynchronously. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1493"
  },
  {
    "text": "If processing of the notification takes too long, our server will record a timeout ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1496"
  },
  {
    "text": "and assume the notification was not delivered successfully. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1500"
  },
  {
    "text": "We will then resend the notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1503"
  },
  {
    "text": "Therefore, moving time-intensive processing outside this function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1506"
  },
  {
    "text": "helps to ensure that the App Store server records your notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1510"
  },
  {
    "text": "as sent successfully and removes the need for your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1513"
  },
  {
    "text": "to reprocess the notifications upon a retry. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1516"
  },
  {
    "text": "Now, let's go over the body of the notification after verification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1519"
  },
  {
    "text": "The first fields are notification type and the optional subtype. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1524"
  },
  {
    "text": "Combined, these tell you the scenario the notification is for. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1528"
  },
  {
    "text": "These fields also help show what has changed since the last notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1532"
  },
  {
    "text": "and provide information about why these changes occurred. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1535"
  },
  {
    "text": "The notificationUUID is a unique identifier per notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1538"
  },
  {
    "text": "If the server retries a notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1543"
  },
  {
    "text": "the retried notification contains the same notificationUUID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1545"
  },
  {
    "text": "This helps detect cases where your server processed the notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1549"
  },
  {
    "text": "but did not respond with a successful HTTP response code in a timely manner. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1552"
  },
  {
    "text": "We recommend adding duplicate notification detection due to retries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1557"
  },
  {
    "text": "based on this field. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1561"
  },
  {
    "text": "The signedDate field tells you when the notification was created. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1563"
  },
  {
    "text": "This is especially useful for detecting retried notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1567"
  },
  {
    "text": "Next, the appAppleId and bundleId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1570"
  },
  {
    "text": "These are important for detecting the target application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1573"
  },
  {
    "text": "As we discussed earlier, it is important that you check these fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1576"
  },
  {
    "text": "and confirm they match expected values to prevent replay attacks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1579"
  },
  {
    "text": "Additionally, make sure the environment of the notification matches ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1583"
  },
  {
    "text": "the expected environment, that sandbox notifications aren't being ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1586"
  },
  {
    "text": "recorded as production data, and vice versa.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1589"
  },
  {
    "text": "Last, the actual signedTransactionInfo and optional signedRenewalInfo. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1593"
  },
  {
    "text": "These will be the latest status of the underlying purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1598"
  },
  {
    "text": "at the time of signing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1601"
  },
  {
    "text": "At this point, having parsed the notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1603"
  },
  {
    "text": "you are left with the latest transaction and renewal information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1605"
  },
  {
    "text": "and the latest reason for the change in status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1608"
  },
  {
    "text": "Now that we've covered setting up and receiving a specific notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1611"
  },
  {
    "text": "let's examine the Version 2 notification model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1615"
  },
  {
    "text": "how notifications can fit together to track the subscription lifecycle, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1617"
  },
  {
    "text": "and the design decisions behind Version 2 notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1620"
  },
  {
    "text": "through a comparison with Version 1 notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1623"
  },
  {
    "text": "Version 2 adopts a different philosophy when sending information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1626"
  },
  {
    "text": "about the state of a purchase. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1629"
  },
  {
    "text": "Instead of sending the entire recent history every notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1630"
  },
  {
    "text": "Version 2 notifications focus only on sending the latest information: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1634"
  },
  {
    "text": "the latest transaction information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1637"
  },
  {
    "text": "and in the case of subscriptions, the pending renewal information as well.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1639"
  },
  {
    "text": "With notifications, we work to provide information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1644"
  },
  {
    "text": "on every step of the subscription lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1647"
  },
  {
    "text": "Therefore, notifications only contain the latest information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1650"
  },
  {
    "text": "about the purchase or subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1653"
  },
  {
    "text": "Together, these notifications create a complete timeline ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1656"
  },
  {
    "text": "of a subscription's status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1659"
  },
  {
    "text": "If you need to view the entire transaction history and don't have access ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1661"
  },
  {
    "text": "to the notification history, this pairs well with ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1664"
  },
  {
    "text": "the Get Transaction History endpoint which lets you query ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1666"
  },
  {
    "text": "a user's entire transaction history in a paginated and filterable context. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1669"
  },
  {
    "text": "Second, version 1 notifications do not require clients use StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1674"
  },
  {
    "text": "And that's right, neither does version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1678"
  },
  {
    "text": "In fact, no matter what framework is used on the client side, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1681"
  },
  {
    "text": "you can start enjoying the benefits of version 2 notifications today. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1684"
  },
  {
    "text": "Last, version 2 notifications work to enhance the level of detail provided ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1689"
  },
  {
    "text": "and expand cases covered by adding additional types ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1694"
  },
  {
    "text": "and adding the new subtype field. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1696"
  },
  {
    "text": "Through this, we are able to cover more scenarios ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1699"
  },
  {
    "text": "and provide notifications at every step of the subscription lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1701"
  },
  {
    "text": "Some of the notable scenarios we've added include expiration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1704"
  },
  {
    "text": "more granular information related to changes in auto renewal status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1708"
  },
  {
    "text": "and more scenarios around the refund process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1711"
  },
  {
    "text": "Now, to illustrate the complexity of the scenarios covered ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1714"
  },
  {
    "text": "and provide a more concrete example, let's look at how notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1717"
  },
  {
    "text": "can inform you of each step a subscription takes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1720"
  },
  {
    "text": "from start to finish. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1723"
  },
  {
    "text": "Let's imagine a user before a subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1725"
  },
  {
    "text": "Upon subscribing, the user moves into the renewing subscription state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1729"
  },
  {
    "text": "and a SUBSCRIBED with subtype INITIAL_BUY notification is sent, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1732"
  },
  {
    "text": "or an OFFER_REDEEMED with subtype INITIAL_BUY if an offer was used. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1736"
  },
  {
    "text": "Contained in the notification would be the first signed transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1740"
  },
  {
    "text": "and the signed renewal information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1743"
  },
  {
    "text": "Time passes, and the subscription renews, staying in the renewing state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1746"
  },
  {
    "text": "Upon each renewal, we send a DID_RENEW notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1750"
  },
  {
    "text": "with the next signed transaction information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1752"
  },
  {
    "text": "Whenever the user deactivates auto renewal, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1756"
  },
  {
    "text": "they move to the expiring subscription state, and you will receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1759"
  },
  {
    "text": "a DID_CHANGE_RENEWAL_STATUS ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1762"
  },
  {
    "text": "with subtype AUTO_RENEW_DISABLED notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1763"
  },
  {
    "text": "If they don't reenable auto renewal, at the end of the period they move ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1768"
  },
  {
    "text": "to the expired state, and you will receive an EXPIRED ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1771"
  },
  {
    "text": "with subtype VOLUNTARY notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1774"
  },
  {
    "text": "Now, you might be wondering, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1776"
  },
  {
    "text": "where are all the other notification types? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1778"
  },
  {
    "text": "Here is the subscription lifecycle, as seen through notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1783"
  },
  {
    "text": "There is a lot going on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1786"
  },
  {
    "text": "And this diagram doesn't even tell the whole story. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1789"
  },
  {
    "text": "The refund/revocation lifecycle isn't included here, for example. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1792"
  },
  {
    "text": "This diagram illustrates the vast array of scenarios ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1797"
  },
  {
    "text": "that version 2 notifications cover and that they work to inform you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1799"
  },
  {
    "text": "of each step of the subscription lifecycle.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1802"
  },
  {
    "text": "The other point I would make is that we work to cover ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1806"
  },
  {
    "text": "every possible transition state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1808"
  },
  {
    "text": "This helps to increase the utility of notifications by becoming a single source ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1810"
  },
  {
    "text": "for tracking subscriptions and improves confidence ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1814"
  },
  {
    "text": "that you are seeing every step of the subscriber's journey. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1816"
  },
  {
    "text": "However, even though all of this data is here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1820"
  },
  {
    "text": "you don't need to work with every type available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1822"
  },
  {
    "text": "Even just processing notifications related to renewal preference changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1825"
  },
  {
    "text": "for example, can provide value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1828"
  },
  {
    "text": "Especially if you are just getting started, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1831"
  },
  {
    "text": "begin with the notification types that are most useful for your situation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1833"
  },
  {
    "text": "Now, let's cover what happens after you've got your server set up, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1837"
  },
  {
    "text": "everything is running smoothly, but, alas, your server goes down. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1840"
  },
  {
    "text": "Whether it was for a few days, a few minutes, or you think you might have ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1844"
  },
  {
    "text": "missed just one, let's go over some steps to help resolve this issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1847"
  },
  {
    "text": "Let's image your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1850"
  },
  {
    "text": "It is set up successfully and is receiving notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1852"
  },
  {
    "text": "At some point, your server has an issue and is unable to receive notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1856"
  },
  {
    "text": "We are still attempting to send messages to your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1861"
  },
  {
    "text": "but now those requests begin to fail. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1864"
  },
  {
    "text": "There are several ways to deal with this scenario. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1866"
  },
  {
    "text": "The first is just to wait. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1868"
  },
  {
    "text": "If we don't receive a successful status code from your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1870"
  },
  {
    "text": "or couldn't connect to it at all, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1873"
  },
  {
    "text": "we will retry notifications according to our documented retry policy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1874"
  },
  {
    "text": "For version 2 notifications, we retry after each attempt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1878"
  },
  {
    "text": "first after a 1-hour delay, then a 12-hour delay, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1881"
  },
  {
    "text": "24-, 48-, and finally 72-hour delay. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1885"
  },
  {
    "text": "Waiting works great for outages less than an hour, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1888"
  },
  {
    "text": "as notifications will be retried an hour after the first failure.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1891"
  },
  {
    "text": "At some point your server recovers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1896"
  },
  {
    "text": "and you start receiving notifications again. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1897"
  },
  {
    "text": "First, you receive a new notification, unrelated to the missed notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1901"
  },
  {
    "text": "Notifications are retried with a delay, so as soon as your server comes online, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1906"
  },
  {
    "text": "you will not immediately receive all missed notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1909"
  },
  {
    "text": "Some time passes and you start to receive the notifications you missed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1913"
  },
  {
    "text": "interspersed with new notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1917"
  },
  {
    "text": "This brings up the question, how can you detect if a notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1921"
  },
  {
    "text": "is the original or a retried notification? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1924"
  },
  {
    "text": "Let's examine a notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1927"
  },
  {
    "text": "In this notification, we're just showing a few fields.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1930"
  },
  {
    "text": "Notifications contain a signedDate field. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1934"
  },
  {
    "text": "This field can be useful for detecting retries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1937"
  },
  {
    "text": "by comparing the signing date with the time the notification was received. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1940"
  },
  {
    "text": "If you see notifications with a signing date significantly earlier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1943"
  },
  {
    "text": "than the date you received the notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1947"
  },
  {
    "text": "this indicates you may have experienced an outage.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1948"
  },
  {
    "text": "Imagine in this scenario the notifications labeled 6 and 3 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1952"
  },
  {
    "text": "were for the same subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1956"
  },
  {
    "text": "This could be determined by comparing the originalTransactionIds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1958"
  },
  {
    "text": "In this case, just because notification 3 was received after notification 6 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1961"
  },
  {
    "text": "does not mean it contains newer information than notification 6. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1966"
  },
  {
    "text": "Other times, a notification may have been received by your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1971"
  },
  {
    "text": "but it failed to respond with a successful HTTP 200 status code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1974"
  },
  {
    "text": "This can cause a notification to be redelivered to your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1978"
  },
  {
    "text": "As discussed earlier, make sure to check the notificationUUID field ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1982"
  },
  {
    "text": "to deduplicate these requests. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1986"
  },
  {
    "text": "You may see significant numbers of retried notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1988"
  },
  {
    "text": "even though you successfully recorded the notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1991"
  },
  {
    "text": "In this case, make sure you are responding ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1994"
  },
  {
    "text": "with an HTTP 200 response every time you receive a notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1995"
  },
  {
    "text": "Additionally, make sure that you are doing so in a timely manner, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=1999"
  },
  {
    "text": "and are not doing extensive processing before responding successfully, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2003"
  },
  {
    "text": "to prevent us from recording a timeout and resending the notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2007"
  },
  {
    "text": "Sometimes, especially with longer outages, the next retry may be hours or days away, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2010"
  },
  {
    "text": "or for an extended outage, retries may have been exhausted. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2015"
  },
  {
    "text": "The next option for recovering from missed notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2019"
  },
  {
    "text": "is the Get Notification History endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2022"
  },
  {
    "text": "We've just announced the new Get Notification History endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2025"
  },
  {
    "text": "which provides a six-month history of notifications we have sent your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2028"
  },
  {
    "text": "Refer to \"What's new with in-app purchases\" video ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2032"
  },
  {
    "text": "for an overview of this endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2034"
  },
  {
    "text": "along with other great features we are announcing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2036"
  },
  {
    "text": "Here we will be focusing on best practices when using this endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2038"
  },
  {
    "text": "and scenarios where it can assist. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2041"
  },
  {
    "text": "After an outage is resolved, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2044"
  },
  {
    "text": "note the start and end timestamps of the outage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2045"
  },
  {
    "text": "The Get Notification History endpoint allows queries to be made ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2048"
  },
  {
    "text": "over a specific timespan. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2051"
  },
  {
    "text": "By specifying the start and end times of the outage, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2053"
  },
  {
    "text": "you can only process notifications that you likely missed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2055"
  },
  {
    "text": "instead of requiring paging through the entire history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2058"
  },
  {
    "text": "This will help improve the speed of recovery ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2061"
  },
  {
    "text": "and reduce work reprocessing already-recorded notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2063"
  },
  {
    "text": "Next, the Get Notification History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2067"
  },
  {
    "text": "allows you to filter by type of notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2069"
  },
  {
    "text": "If you have experience an extended outage and expect a significant ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2072"
  },
  {
    "text": "number of notifications, consider filtering by type, and starting ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2075"
  },
  {
    "text": "with types that may have immediate impact, like DID_RENEW and EXPIRED. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2078"
  },
  {
    "text": "These will help you take action on the most relevant cases first. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2082"
  },
  {
    "text": "One tip when passing notification types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2086"
  },
  {
    "text": "if the notificationSubtype field is omitted, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2089"
  },
  {
    "text": "this will only return notifications that also do not have a subtype. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2091"
  },
  {
    "text": "Therefore, for the example shown for the DID_RENEW notificationType, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2095"
  },
  {
    "text": "this would not return DID_RENEW notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2099"
  },
  {
    "text": "with subtype BILLING_RECOVERY.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2101"
  },
  {
    "text": "Last, the Get Notification History endpoint allows filtering ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2105"
  },
  {
    "text": "to a specific user by using an originalTransactionId. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2107"
  },
  {
    "text": "Thinking back to the subscription lifecycle, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2111"
  },
  {
    "text": "we've worked to make sure every step of a user's journey ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2113"
  },
  {
    "text": "is covered by notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2116"
  },
  {
    "text": "Therefore, if you find yourself jumping around in unexpected ways, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2118"
  },
  {
    "text": "for example from a renewing subscription straight to expiration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2121"
  },
  {
    "text": "this may indicate that you missed a notification for that user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2124"
  },
  {
    "text": "This can also be useful in a customer-support context ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2127"
  },
  {
    "text": "if a user's account is in a different state than you would expect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2130"
  },
  {
    "text": "In these cases, you can send a query for that user's notification history.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2133"
  },
  {
    "text": "Let's go over the response from the Get Notification History endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2138"
  },
  {
    "text": "Only certain values are shown in the response for simplicity.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2142"
  },
  {
    "text": "The values returned in the response are in the notificationHistory array.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2146"
  },
  {
    "text": "Each entry in the array represents a single notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2152"
  },
  {
    "text": "The signed payload field contains the exact notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2156"
  },
  {
    "text": "that was sent to you.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2159"
  },
  {
    "text": "Second, we have the firstSendAttemptResult field. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2162"
  },
  {
    "text": "This field contains one of several values based on the result ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2165"
  },
  {
    "text": "of the initial notification attempt as recorded by our servers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2168"
  },
  {
    "text": "In the successful case, this will be the value SUCCESS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2171"
  },
  {
    "text": "However, as we've just been discussing, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2174"
  },
  {
    "text": "sometimes notifications fail to reach your server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2176"
  },
  {
    "text": "These messages are meant to be a general guide to help point you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2179"
  },
  {
    "text": "in the direction of the issue, to simplify the resolution process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2182"
  },
  {
    "text": "For example, we see SSL_ISSUE here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2185"
  },
  {
    "text": "This indicates there is a problem with the SSL certificate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2188"
  },
  {
    "text": "or process on the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2191"
  },
  {
    "text": "This field provides improved visibility into diagnosing servers issues ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2193"
  },
  {
    "text": "beyond seeing the notification did not arrive. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2196"
  },
  {
    "text": "We also provide this same field in the Get Test Notification Status endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2199"
  },
  {
    "text": "to provide this functionality when using test notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2202"
  },
  {
    "text": "These can be used to help while onboarding or during troubleshooting, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2205"
  },
  {
    "text": "or retrospectively during determining the root cause of an outage. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2209"
  },
  {
    "text": "Notifications may not cover all cases of a user's history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2212"
  },
  {
    "text": "You may have just adopted notifications and have existing users ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2215"
  },
  {
    "text": "with histories not covered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2218"
  },
  {
    "text": "You also may wish to examine a history longer than the retention period ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2220"
  },
  {
    "text": "of notifications in the Get Notification History endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2223"
  },
  {
    "text": "That's where the Get Transaction History endpoint enters the picture. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2226"
  },
  {
    "text": "This endpoint, as we saw earlier in the presentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2229"
  },
  {
    "text": "from Gabriel, solves these issues by providing histories ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2231"
  },
  {
    "text": "for your customers that cover cases before you started using notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2234"
  },
  {
    "text": "Now, let's go over how notifications can provide insight ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2238"
  },
  {
    "text": "and opportunities above and beyond the purchase history. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2241"
  },
  {
    "text": "One of the new additions in Version 2 notifications is the subtype field, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2245"
  },
  {
    "text": "adding additional context to the notificationType field. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2249"
  },
  {
    "text": "This field is meant to provide more detail in certain scenarios, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2252"
  },
  {
    "text": "like EXPIRED or DID_CHANGE_RENEWAL_STATUS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2255"
  },
  {
    "text": "For example, with EXPIRED, the action you take is usually the same, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2258"
  },
  {
    "text": "mark the subscription as inactive and revoke access to the product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2261"
  },
  {
    "text": "However, it can often be useful to understand why the user expired. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2265"
  },
  {
    "text": "Was it due to a billing issue, voluntary choice, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2269"
  },
  {
    "text": "or a price increase that was never accepted? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2271"
  },
  {
    "text": "Another notification, DID_CHANGE_RENEWAL_STATUS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2273"
  },
  {
    "text": "is a great example of gaining additional information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2276"
  },
  {
    "text": "and opportunities when using notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2279"
  },
  {
    "text": "On the surface, it looks to be of low priority. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2281"
  },
  {
    "text": "No action needs to be immediately taken. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2284"
  },
  {
    "text": "The important notification for revoking access to the product ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2286"
  },
  {
    "text": "is the EXPIRED notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2289"
  },
  {
    "text": "Don't be fooled. There is a lot of opportunity here. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2291"
  },
  {
    "text": "One, this notification is a great opportunity ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2294"
  },
  {
    "text": "to attempt to win back the customer before their subscription expires. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2296"
  },
  {
    "text": "Especially since deactivating auto renewal may occur ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2300"
  },
  {
    "text": "outside the application, this can be the only trigger ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2302"
  },
  {
    "text": "to be informed in this change in renewal status before the expiration date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2305"
  },
  {
    "text": "This notification also provides insight into customer behavior. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2309"
  },
  {
    "text": "This notification can be used to determine ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2312"
  },
  {
    "text": "when in the renewal period subscribers are cancelling. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2314"
  },
  {
    "text": "Is it the day before renewal? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2316"
  },
  {
    "text": "Are new subscribers deactivating auto-renewal ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2317"
  },
  {
    "text": "soon after signing up for your service? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2319"
  },
  {
    "text": "This type of information can be important for understanding ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2322"
  },
  {
    "text": "the causes of cancellation and improving your product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2323"
  },
  {
    "text": "Last, certain scenarios may never be reflected ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2327"
  },
  {
    "text": "in a user's history without notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2330"
  },
  {
    "text": "For example, a user may deactivate but then reactivate auto-renewal, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2332"
  },
  {
    "text": "before their subscription period has expired. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2337"
  },
  {
    "text": "Because this all occurs within a subscription period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2339"
  },
  {
    "text": "there is no effect on the subscription's long-term status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2342"
  },
  {
    "text": "These decisions can be important for understanding your customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2345"
  },
  {
    "text": "and notifications provide information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2348"
  },
  {
    "text": "to detect and record these types of scenarios. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2349"
  },
  {
    "text": "Overall, notifications work to enhance and create opportunities ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2353"
  },
  {
    "text": "for understanding customer behavior by providing information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2356"
  },
  {
    "text": "at every step of the customer journey, covering more scenarios than ever before. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2359"
  },
  {
    "text": "In conclusion, today we've covered both the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2363"
  },
  {
    "text": "and App Store Server Notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2366"
  },
  {
    "text": "These are available to improve the capabilities ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2369"
  },
  {
    "text": "surrounding managing and tracking purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2370"
  },
  {
    "text": "They use updated message types and cover more cases than ever before. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2373"
  },
  {
    "text": "These systems are available for all clients ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2377"
  },
  {
    "text": "and cross-compatible with both Original StoreKit and StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2379"
  },
  {
    "text": "and can improve your ability to monitor the subscription lifecycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2382"
  },
  {
    "text": "Last, these tools are already available in both Sandbox and Production ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2386"
  },
  {
    "text": "and are a great addition to any system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2389"
  },
  {
    "text": "Thank you for joining us, and have a great WWDC.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10040/?time=2391"
  }
]