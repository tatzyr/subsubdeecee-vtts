[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=0"
  },
  {
    "text": "- Hi! I'm Kent and I'm an engineer on the CloudKit team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=9"
  },
  {
    "text": "I'm excited to introduce a new library that you can use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=13"
  },
  {
    "text": "to access CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=16"
  },
  {
    "text": "First, I'll cover how to configure this new library. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=18"
  },
  {
    "text": "And then you'll learn how to manage your schema, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=21"
  },
  {
    "text": "as well as how to access user data with CKTool JS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=23"
  },
  {
    "text": "Let's begin! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=27"
  },
  {
    "text": "CloudKit is a persistence technology ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=29"
  },
  {
    "text": "that lets you store your app's data in iCloud within containers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=31"
  },
  {
    "text": "By using CloudKit in your app, you can also have your data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=35"
  },
  {
    "text": "stay up to date across devices and on the web.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=39"
  },
  {
    "text": "For building your apps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=42"
  },
  {
    "text": "you can access iCloud storage using the CloudKit framework on Apple platforms ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=44"
  },
  {
    "text": "or CloudKit JS on the web. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=48"
  },
  {
    "text": "To implement automation and tooling, Xcode provides cktool for use on macOS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=51"
  },
  {
    "text": "And now you have a new way to automate changes and interact with iCloud, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=57"
  },
  {
    "text": "using CKTool JS.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=60"
  },
  {
    "text": "CKTool JS lets you perform the same operations ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=63"
  },
  {
    "text": "as the cktool command-line utility introduced in Xcode 13 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=66"
  },
  {
    "text": "and supports similar use cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=70"
  },
  {
    "text": "In fact, CKTool JS is used to implement features in CloudKit Console ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=73"
  },
  {
    "text": "such as adding record types and querying records.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=77"
  },
  {
    "text": "With CKTool JS, you can manage your app containers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=81"
  },
  {
    "text": "and perform schema operations, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=83"
  },
  {
    "text": "such as resetting and applying updates to your schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=85"
  },
  {
    "text": "This is something that you couldn't do from JavaScript before.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=89"
  },
  {
    "text": "CKTool JS lets you fetch existing records using their unique identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=93"
  },
  {
    "text": "or through complex queries. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=97"
  },
  {
    "text": "And it lets you create new records and update them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=99"
  },
  {
    "text": "CKTool JS ships with strict type definitions for TypeScript. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=103"
  },
  {
    "text": "These type definitions enable compile-time checking ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=107"
  },
  {
    "text": "that flags incorrect usage of the client library ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=109"
  },
  {
    "text": "and it enables code completion in supported IDEs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=112"
  },
  {
    "text": "You'll find editing CKTool JS code easier because of this.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=115"
  },
  {
    "text": "Additionally, this new library ships with support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=120"
  },
  {
    "text": "for both Node.js and browsers out of the box. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=122"
  },
  {
    "text": "CKTool JS is distributed as a set of npm packages, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=125"
  },
  {
    "text": "which allows you to integrate it as part of your JavaScript build pipeline. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=129"
  },
  {
    "text": "Doing so enables features such as tree-shaking and bundling. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=133"
  },
  {
    "text": "You can also track updates to these packages ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=138"
  },
  {
    "text": "because their release history is transparently available from npm.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=140"
  },
  {
    "text": "The following packages are part of the CKTool JS distribution. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=146"
  },
  {
    "text": "Note that these packages are within the @apple scope ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=149"
  },
  {
    "text": "and follow the convention of using cktool. at the start of the name. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=153"
  },
  {
    "text": "The main package that you'll use is cktool.database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=158"
  },
  {
    "text": "To enable communication with iCloud, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=162"
  },
  {
    "text": "you'll also need to use one other package for your target platform, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=164"
  },
  {
    "text": "cktool.target.nodejs for Node.js ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=168"
  },
  {
    "text": "or cktool.target.browser for web browsers.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=172"
  },
  {
    "text": "cktool.database automatically pulls in three more packages-- ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=177"
  },
  {
    "text": "cktool.core, cktool.api.base, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=181"
  },
  {
    "text": "and cktool.api.database. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=186"
  },
  {
    "text": "Since CKTool JS communicates directly with iCloud, it must first be authorized. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=190"
  },
  {
    "text": "Depending on the operation that you want to call, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=195"
  },
  {
    "text": "you'll either need a management token or a user token. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=198"
  },
  {
    "text": "Both kinds of tokens are obtainable from CloudKit Console.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=201"
  },
  {
    "text": "Management tokens are used to access management operations ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=205"
  },
  {
    "text": "and are scoped to a team and user. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=208"
  },
  {
    "text": "Such operations include enabling schema import and export, schema validation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=211"
  },
  {
    "text": "and resetting the container to production. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=216"
  },
  {
    "text": "User tokens are scoped to teams and containers and enable access ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=219"
  },
  {
    "text": "to private user data within those containers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=222"
  },
  {
    "text": "To learn how to obtain these authorization tokens as well as ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=226"
  },
  {
    "text": "continuous integration with CloudKit, check out ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=229"
  },
  {
    "text": "\"Automate CloudKit tests with cktool and declarative schema\" from WWDC21.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=232"
  },
  {
    "text": "Any time you want to use CKTool JS in your scripts, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=238"
  },
  {
    "text": "you'll first need to configure it for use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=241"
  },
  {
    "text": "But before I dive into configuring CKTool JS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=243"
  },
  {
    "text": "I'll do a quick review of what makes up a CloudKit schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=246"
  },
  {
    "text": "In CloudKit, data is stored in a structured way. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=249"
  },
  {
    "text": "Data that has the same kinds of values are stored together as records. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=253"
  },
  {
    "text": "Records are instances of record types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=258"
  },
  {
    "text": "and the properties of a record that a record type describes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=260"
  },
  {
    "text": "are known as fields. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=263"
  },
  {
    "text": "In addition to your user-defined fields, CloudKit adds system fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=265"
  },
  {
    "text": "such as recordName, which is the ID of the record. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=269"
  },
  {
    "text": "I'll use examples from a coin collection app I've been working on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=272"
  },
  {
    "text": "I want to store a collection of countries, so I have a record type ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=275"
  },
  {
    "text": "to describe what kinds of properties I need to store for them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=279"
  },
  {
    "text": "I'm storing names and ISO codes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=282"
  },
  {
    "text": "and I'm naming the record type, \"Countries.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=285"
  },
  {
    "text": "ISO codes uniquely identify a country, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=287"
  },
  {
    "text": "so it's important to include them in my record type.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=289"
  },
  {
    "text": "I create some records of type Countries to store this information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=293"
  },
  {
    "text": "along with their names.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=295"
  },
  {
    "text": "I also have a record type for coins of particular countries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=298"
  },
  {
    "text": "and I want to relate them to one another. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=301"
  },
  {
    "text": "The Coins record type stores the relationship from a coin to its country.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=303"
  },
  {
    "text": "Record types and relationships combine to make a schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=310"
  },
  {
    "text": "I can consider the current state of these elements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=313"
  },
  {
    "text": "to be the current version of my schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=315"
  },
  {
    "text": "As you develop your apps, you'll evolve your schema, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=318"
  },
  {
    "text": "and over the lifetime of your app, you'll likely have several versions of it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=321"
  },
  {
    "text": "While my app's schema describes the structure of the data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=326"
  },
  {
    "text": "I want to store in iCloud, my app container is where that data is stored. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=329"
  },
  {
    "text": "A container has a unique identifier and is associated with a developer team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=333"
  },
  {
    "text": "There are two environments to keep in mind when working with CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=338"
  },
  {
    "text": "The development environment is a safe place to make changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=343"
  },
  {
    "text": "without disrupting users. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=346"
  },
  {
    "text": "This is where you should be testing and developing changes to your schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=347"
  },
  {
    "text": "When users interact with your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=351"
  },
  {
    "text": "they'll be interacting with the production environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=353"
  },
  {
    "text": "The production environment contains the live data for your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=356"
  },
  {
    "text": "Now that I've reviewed how CloudKit stores data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=359"
  },
  {
    "text": "I'll cover how to configure CKTool JS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=362"
  },
  {
    "text": "Because CKTool JS talks with iCloud, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=365"
  },
  {
    "text": "you'll need to gather a few pieces of information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=367"
  },
  {
    "text": "so that it knows how to work with the right container ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=369"
  },
  {
    "text": "and that your script is authorized to do so.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=372"
  },
  {
    "text": "You'll need your team ID and the container ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=375"
  },
  {
    "text": "for the container you want to work with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=378"
  },
  {
    "text": "You'll need a management token in order to work with schemas, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=380"
  },
  {
    "text": "and if your script will access data, you'll need a user token as well. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=383"
  },
  {
    "text": "All these values can be obtained from CloudKit Console. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=387"
  },
  {
    "text": "You'll also need to specify which environment, development or production, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=390"
  },
  {
    "text": "your script will run in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=394"
  },
  {
    "text": "I'll use development as an example going forward. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=395"
  },
  {
    "text": "Anytime you configure CKTool JS for use, you'll need these values. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=398"
  },
  {
    "text": "For my examples, I'm writing scripts for Node.js. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=403"
  },
  {
    "text": "You import objects and functions from CKTool JS in order to use them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=406"
  },
  {
    "text": "In this case, you can import these symbols using CommonJS require statements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=411"
  },
  {
    "text": "Once you've gathered your configuration information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=416"
  },
  {
    "text": "you'll create objects to hold that information. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=419"
  },
  {
    "text": "To store your auth tokens, you create an object ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=422"
  },
  {
    "text": "to hold your management token and, if you have one, your user token. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=424"
  },
  {
    "text": "Since teamId, containerId and environment are common values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=428"
  },
  {
    "text": "that are passed to CKTool JS, you can create an object to hold these values. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=432"
  },
  {
    "text": "You instantiate a Configuration object that tells CKTool JS ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=437"
  },
  {
    "text": "how to talk with iCloud by using the createConfiguration factory function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=440"
  },
  {
    "text": "createConfiguration is platform-specific. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=446"
  },
  {
    "text": "In this case, it'll return an appropriate configuration for Node.js, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=448"
  },
  {
    "text": "since that's the function that was imported from the target package. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=452"
  },
  {
    "text": "You then pass the configuration object and the security object declared earlier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=455"
  },
  {
    "text": "to initialize an API object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=460"
  },
  {
    "text": "API objects contain asynchronous methods that allow you to talk to iCloud. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=462"
  },
  {
    "text": "You've now completed the steps to use CKTool JS in your scripts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=467"
  },
  {
    "text": "Let's learn about how you can use CKTool JS ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=471"
  },
  {
    "text": "to manage your container's schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=474"
  },
  {
    "text": "In my app, I want to store information such as ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=476"
  },
  {
    "text": "an American dime issued in 2007. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=480"
  },
  {
    "text": "This coin is composed of copper and nickel ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=482"
  },
  {
    "text": "and the value stamped on it is 1/10th of an American dollar. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=485"
  },
  {
    "text": "After thinking about how to store this data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=488"
  },
  {
    "text": "I decided to store information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=491"
  },
  {
    "text": "about the coin's composition ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=492"
  },
  {
    "text": "as records separate from ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=494"
  },
  {
    "text": "the other details about the coin. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=496"
  },
  {
    "text": "So I store the copper percentage for the dime ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=498"
  },
  {
    "text": "and its nickel percentage ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=500"
  },
  {
    "text": "in separate records.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=502"
  },
  {
    "text": "I identified two record types ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=504"
  },
  {
    "text": "that I want in my container's schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=506"
  },
  {
    "text": "Coins, which stores its country reference, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=508"
  },
  {
    "text": "issue year, and nominal value. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=511"
  },
  {
    "text": "And a Components record type ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=513"
  },
  {
    "text": "that stores a reference to a coin it describes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=515"
  },
  {
    "text": "and the material and its percentage in the coin. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=517"
  },
  {
    "text": "Now that I've determined the schema for my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=520"
  },
  {
    "text": "I can create a text file in CloudKit Schema Language to describe it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=523"
  },
  {
    "text": "The convention is to use the .ckdb extension for your schema file.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=526"
  },
  {
    "text": "For more information about CloudKit Schema Language, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=532"
  },
  {
    "text": "refer to \"Integrating a Text-Based Schema into Your Workflow\" documentation article.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=534"
  },
  {
    "text": "The schema file you create for your container can be applied using CKTool JS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=540"
  },
  {
    "text": "Before you apply a new schema, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=545"
  },
  {
    "text": "you'll typically reset the container's development schema ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=547"
  },
  {
    "text": "to match the one in production. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=550"
  },
  {
    "text": "You can do this with the resetToProduction method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=552"
  },
  {
    "text": "You call this method by passing the defaultArgs object ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=555"
  },
  {
    "text": "that you declared earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=558"
  },
  {
    "text": "If your schema isn't in production, all record types are deleted. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=560"
  },
  {
    "text": "Otherwise, this will revert the development schema ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=564"
  },
  {
    "text": "to the state of the production environment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=566"
  },
  {
    "text": "Note that this is an asynchronous call, so this method returns a promise object.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=569"
  },
  {
    "text": "CKTool JS has methods that let you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=575"
  },
  {
    "text": "export and import your container's schema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=577"
  },
  {
    "text": "The exportSchema and importSchema methods let you do this ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=580"
  },
  {
    "text": "and are named from the perspective of the container. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=583"
  },
  {
    "text": "So you download a schema to be exported ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=586"
  },
  {
    "text": "from the container using exportSchema, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=588"
  },
  {
    "text": "and you upload a schema to be imported ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=591"
  },
  {
    "text": "into the container using importSchema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=593"
  },
  {
    "text": "Together, these allow you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=596"
  },
  {
    "text": "to manage your schema's evolution.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=598"
  },
  {
    "text": "You can create a help function to apply the schema to the container. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=601"
  },
  {
    "text": "First, import the File object from CKTool JS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=605"
  },
  {
    "text": "then import the fs and path modules from Node.js. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=608"
  },
  {
    "text": "Now define an asynchronous function that will do the following: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=612"
  },
  {
    "text": "It reads the schema file's contents into a Node.js buffer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=616"
  },
  {
    "text": "It creates a CKTool JS File instance for upload. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=619"
  },
  {
    "text": "Finally, it uploads the file's contents to the server using importSchema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=623"
  },
  {
    "text": "Note that the defaultArgs object that was declared earlier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=628"
  },
  {
    "text": "is passed to importSchema. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=631"
  },
  {
    "text": "Now you can put it together. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=633"
  },
  {
    "text": "Because resetToProduction and the helper function used to import a schema ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=635"
  },
  {
    "text": "are asynchronous, you need to ensure that they run in the correct order. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=639"
  },
  {
    "text": "To do that you chain the promises. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=642"
  },
  {
    "text": "If an error occurs, the promise will reject. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=645"
  },
  {
    "text": "In addition to the management capabilities that CKTool JS has, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=648"
  },
  {
    "text": "it also allows you to work with reading and writing data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=652"
  },
  {
    "text": "Field values that are used in CKTool JS records ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=655"
  },
  {
    "text": "are type and ranged checked on the client side ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=659"
  },
  {
    "text": "before they're sent to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=661"
  },
  {
    "text": "If the value passed in is not the right kind of value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=663"
  },
  {
    "text": "or is outside of the allowed range of the value, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=667"
  },
  {
    "text": "an exception will be thrown. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=669"
  },
  {
    "text": "For large numbers that can't be represented natively in JavaScript, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=671"
  },
  {
    "text": "there are CKTool JS types that are used instead. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=674"
  },
  {
    "text": "For example, to coerce a number to a CKTool JS Int64, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=678"
  },
  {
    "text": "you use the toInt64 function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=682"
  },
  {
    "text": "To coerce a number to a Double floating point value, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=686"
  },
  {
    "text": "you use the toDouble function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=688"
  },
  {
    "text": "If you're writing TypeScript, the compiler will flag ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=690"
  },
  {
    "text": "incorrect value type usages if these coercion functions are not used.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=693"
  },
  {
    "text": "Field values in CKTool JS records ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=698"
  },
  {
    "text": "are created using field value factory functions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=700"
  },
  {
    "text": "For a coin issued in 2007, I'd pass that value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=704"
  },
  {
    "text": "to the makeRecordFieldValue.int64 factory function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=707"
  },
  {
    "text": "in order to create a record field value that contains an Int64. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=712"
  },
  {
    "text": "In general, if a factory function can't create a record field value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=716"
  },
  {
    "text": "from the value passed in, it'll throw an exception.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=719"
  },
  {
    "text": "Here, I've created an object to hold common values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=723"
  },
  {
    "text": "that I send to methods that work with records. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=726"
  },
  {
    "text": "Since containerId, environment, databaseType and zoneName ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=729"
  },
  {
    "text": "are often required, I'm including those in this databaseArgs object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=732"
  },
  {
    "text": "To query for records, I use the queryRecords method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=737"
  },
  {
    "text": "To make this easier, I create a helper function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=741"
  },
  {
    "text": "that finds a country matching its unique 3 character ISO code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=744"
  },
  {
    "text": "In this case, I pass the contents of the databaseArgs object, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=748"
  },
  {
    "text": "in addition to a body that contains the query. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=752"
  },
  {
    "text": "For the query object, I'm specifying the recordType value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=755"
  },
  {
    "text": "as well as a single filter object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=759"
  },
  {
    "text": "The filter object describes a query where the country's isoCode3 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=762"
  },
  {
    "text": "is equal to the one this function is seeking. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=766"
  },
  {
    "text": "If successful, the collection of found records ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=770"
  },
  {
    "text": "will be in the response.result.records property. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=772"
  },
  {
    "text": "I return the first object from this collection.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=776"
  },
  {
    "text": "To make converting raw values into field values that createRecord can use, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=779"
  },
  {
    "text": "I have a helper function called makeCoinFieldValues to do this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=784"
  },
  {
    "text": "For each raw property for my coin that I want to convert to field values, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=788"
  },
  {
    "text": "I call the appropriate RecordFieldValue factory function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=793"
  },
  {
    "text": "For the country field, however, I need to create a reference. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=796"
  },
  {
    "text": "I use the passed-in country record name to make a reference ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=800"
  },
  {
    "text": "from this coin record to the corresponding country record.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=803"
  },
  {
    "text": "Here, I create a helper function that takes coin record field values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=807"
  },
  {
    "text": "and sends the createRecord request to the server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=811"
  },
  {
    "text": "In this function, I'm passing the content of databaseArgs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=815"
  },
  {
    "text": "declared earlier and a body. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=817"
  },
  {
    "text": "The body dictionary contains the recordType and field values. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=820"
  },
  {
    "text": "If successful, response.result.record is returned.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=823"
  },
  {
    "text": "Before calling the helper function, I need to fetch the correct ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=828"
  },
  {
    "text": "country record that will be referenced from this coin. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=832"
  },
  {
    "text": "I use the country query function defined earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=835"
  },
  {
    "text": "I then call coinCreateRecord by passing it a field values dictionary ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=838"
  },
  {
    "text": "which is created with the makeCoinFieldValues helper function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=843"
  },
  {
    "text": "that I wrote earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=846"
  },
  {
    "text": "The raw coin values are passed to that helper function. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=848"
  },
  {
    "text": "This will asynchronously create the record and return the new record.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=851"
  },
  {
    "text": "To update a record, use the updateRecord method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=857"
  },
  {
    "text": "I create a helper function that updates a coin matching the record name ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=860"
  },
  {
    "text": "with the fields passed to this helper. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=864"
  },
  {
    "text": "I then call updateRecord with the contents of the databaseArgs object, recordName, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=867"
  },
  {
    "text": "and a body that contains the record type and the new record's field values. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=872"
  },
  {
    "text": "If successful, the updated record will be in the ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=877"
  },
  {
    "text": "response.result.record property, which I return from the helper function.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=879"
  },
  {
    "text": "To update the coin record I created earlier, I call this helper function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=885"
  },
  {
    "text": "passing in its record name and field values to update. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=889"
  },
  {
    "text": "The field values are created with makeCoinFieldValues.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=892"
  },
  {
    "text": "To delete a record, I call the async deleteRecord method on the API object. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=897"
  },
  {
    "text": "I pass in the contents of the databaseArgs object ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=902"
  },
  {
    "text": "as well as the recordName of the record to delete. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=904"
  },
  {
    "text": "I hope you've enjoyed getting to know CKTool JS. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=907"
  },
  {
    "text": "Try it out for yourself: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=910"
  },
  {
    "text": "Configure CKTool JS for your automation and tooling purposes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=912"
  },
  {
    "text": "Reset and import your schemas ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=916"
  },
  {
    "text": "as well as read and write your data using JavaScript. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=917"
  },
  {
    "text": "For usage of CKTool JS in continuous integration scenarios, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=920"
  },
  {
    "text": "check out the CloudKit sample repo on GitHub. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=924"
  },
  {
    "text": "And for more detailed documentation, check out CKTool JS on developer.apple.com. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=927"
  },
  {
    "text": "Thanks for joining me today, and enjoy the rest of WWDC22.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10116/?time=932"
  }
]