[
  {
    "text": "♪ ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=0"
  },
  {
    "text": "Ciao, my name is Geppy Parziale, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=9"
  },
  {
    "text": "and I am a machine learning engineer here at Apple. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=12"
  },
  {
    "text": "Today, I want to walk you through the journey of building an app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=15"
  },
  {
    "text": "that uses machine learning to solve a problem ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=18"
  },
  {
    "text": "that would usually require an expert to perform some very specialized work.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=21"
  },
  {
    "text": "This journey gives me the opportunity to show you how to add ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=27"
  },
  {
    "text": "open source machine learning models to your apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=31"
  },
  {
    "text": "and create fantastic new experiences. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=33"
  },
  {
    "text": "During the journey, I will also highlight ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=37"
  },
  {
    "text": "a few of the many tools, frameworks, and APIs available for you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=39"
  },
  {
    "text": "in the Apple development ecosystem to build apps using machine learning.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=44"
  },
  {
    "text": "When building an app, you, the developer, go through a series of decisions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=49"
  },
  {
    "text": "that hopefully will bring the best experience to your users. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=53"
  },
  {
    "text": "And this is also true when adding machine learning functionality to applications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=57"
  },
  {
    "text": "During the development, you could ask: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=64"
  },
  {
    "text": "should I use machine learning to build this feature? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=67"
  },
  {
    "text": "How can I get a machine learning model? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=70"
  },
  {
    "text": "How do I make that model compatible with Apple platforms? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=74"
  },
  {
    "text": "Will that model work for my specific use case? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=78"
  },
  {
    "text": "Does it run on the Apple Neural Engine? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=82"
  },
  {
    "text": "So let's take this journey together. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=86"
  },
  {
    "text": "I want to build an app that allows me to add realistic colors ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=89"
  },
  {
    "text": "to my family black and white photos that I found in an old box in my basement.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=93"
  },
  {
    "text": "Of course, a professional photographer could do this with some manual work, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=99"
  },
  {
    "text": "spending some time in a photo editing tool. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=104"
  },
  {
    "text": "Instead, what if I want to automate this process ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=107"
  },
  {
    "text": "and apply the colorization in just a few seconds? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=110"
  },
  {
    "text": "This seems to be a perfect task for machine learning.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=114"
  },
  {
    "text": "Apple offers a tremendous amount of frameworks and tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=118"
  },
  {
    "text": "that can help you build and integrate ML functionality in your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=122"
  },
  {
    "text": "They provide everything from data processing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=126"
  },
  {
    "text": "to model training and inference. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=129"
  },
  {
    "text": "For this journey, I am going to use a few of them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=132"
  },
  {
    "text": "But remember, you have many to choose from ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=135"
  },
  {
    "text": "depending on the specific machine learning task that you are developing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=139"
  },
  {
    "text": "The process I use when developing a machine learning feature ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=142"
  },
  {
    "text": "in my apps goes through a set of stages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=145"
  },
  {
    "text": "First, I search for the right machine learning model ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=149"
  },
  {
    "text": "in either scientific publication or specialized website.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=152"
  },
  {
    "text": "I searched for photo colorization, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=158"
  },
  {
    "text": "and I found a model called Colorizer that may work for what I need. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=160"
  },
  {
    "text": "Here is an example of the colorization I can get using this model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=166"
  },
  {
    "text": "Here is another one.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=173"
  },
  {
    "text": "And here is another one. Really great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=176"
  },
  {
    "text": "Let me show you how it works. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=180"
  },
  {
    "text": "The Colorizer model expects a black and white image as input. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=183"
  },
  {
    "text": "The Python source code I found converts any RGB image to a LAB color space image.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=187"
  },
  {
    "text": "This color space has 3 channels: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=195"
  },
  {
    "text": "one represents the image lightness or L channel, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=198"
  },
  {
    "text": "and the other two represent the color components. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=202"
  },
  {
    "text": "The color components are discarded ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=205"
  },
  {
    "text": "while the lightness becomes the input of the colorizer model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=207"
  },
  {
    "text": "The model then estimates two new color components ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=212"
  },
  {
    "text": "that, combined with the input L channel, provide the resulting image with color.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=215"
  },
  {
    "text": "It's time now to make this model compatible with my app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=221"
  },
  {
    "text": "To achieve this, I can convert the original PyTorch model ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=225"
  },
  {
    "text": "to Core ML format using coremltools. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=229"
  },
  {
    "text": "Here is the simple Python script I used to convert the PyTorch model to Core ML.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=233"
  },
  {
    "text": "First, I import the PyTorch model architecture and weights.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=239"
  },
  {
    "text": "Then I trace the imported model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=244"
  },
  {
    "text": "Finally, I convert the PyTorch model to Core ML and save it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=247"
  },
  {
    "text": "Once the model is in the Core ML format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=252"
  },
  {
    "text": "I need to verify that the conversion worked correctly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=255"
  },
  {
    "text": "I can do that directly in Python again using coremltools. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=259"
  },
  {
    "text": "And this is easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=263"
  },
  {
    "text": "I import the image in RGB color space ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=265"
  },
  {
    "text": "and convert it to Lab color space.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=268"
  },
  {
    "text": "Then I separate the lightness from the color channels and discard them.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=272"
  },
  {
    "text": "I run the prediction using the Core ML model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=278"
  },
  {
    "text": "And finally, compose the input lightness ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=282"
  },
  {
    "text": "with the estimated color components and convert to RGB.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=284"
  },
  {
    "text": "This allows me to verify that functionality of the converted model ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=289"
  },
  {
    "text": "matches the functionality of the original PyTorch model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=293"
  },
  {
    "text": "I call this stage Model Verification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=297"
  },
  {
    "text": "However, there is another important check to be done. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=301"
  },
  {
    "text": "I need to understand if this model can run fast enough on my target device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=305"
  },
  {
    "text": "So I would need to assess the model on device ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=310"
  },
  {
    "text": "and make sure it would provide the best user experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=313"
  },
  {
    "text": "The new Core ML Performance report, available now in Xcode 14, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=317"
  },
  {
    "text": "performs a time-based analysis of a Core ML model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=322"
  },
  {
    "text": "I just need to drag and drop the model into Xcode ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=326"
  },
  {
    "text": "and create a performance report in a few seconds.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=329"
  },
  {
    "text": "Using this tool, I can see that estimated prediction time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=333"
  },
  {
    "text": "is almost 90 milliseconds on an iPad Pro with M1 and iPadOS 16.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=337"
  },
  {
    "text": "And this is perfect for my photo colorization app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=344"
  },
  {
    "text": "If you want to know more about Performance Report in Xcode, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=348"
  },
  {
    "text": "I suggest you to watch this year’s session \"Optimize your Core ML usage\". ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=351"
  },
  {
    "text": "So Performance Report can help you make an assessment of the model ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=356"
  },
  {
    "text": "and make sure it provides the best on-device user experience.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=361"
  },
  {
    "text": "Now that I am sure about the functionality and performance of my model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=365"
  },
  {
    "text": "let me integrate it into my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=369"
  },
  {
    "text": "The integration process is identical to what I have done until now in Python, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=373"
  },
  {
    "text": "but this time I can do it seamlessly in Swift ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=378"
  },
  {
    "text": "using Xcode and all the other tools you are familiar with.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=380"
  },
  {
    "text": "Remember the model, now in Core ML format, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=386"
  },
  {
    "text": "expects a single channel image representing its lightness.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=389"
  },
  {
    "text": "So similarly to what I did previously in Python, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=394"
  },
  {
    "text": "I need to convert any RGB input image to an image using the Lab color space.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=397"
  },
  {
    "text": "I could write this transformation in multiple ways: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=405"
  },
  {
    "text": "directly in Swift with vImage, or using Metal.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=408"
  },
  {
    "text": "Exploring deeper in the documentation, I found that the Core Image framework ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=413"
  },
  {
    "text": "provides something that can help me with this.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=417"
  },
  {
    "text": "So let me show you how to achieve the RGB to LAB conversion ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=422"
  },
  {
    "text": "and run the prediction using the Core ML model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=426"
  },
  {
    "text": "Here is the Swift code to extract the lightness ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=430"
  },
  {
    "text": "from an RGB image and pass it to the Core ML model. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=433"
  },
  {
    "text": "First, I convert the RGB image into LAB and extract the lightness.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=437"
  },
  {
    "text": "Then, I convert lightness to a CGImage ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=443"
  },
  {
    "text": "and prepare the input for the Core ML model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=447"
  },
  {
    "text": "Finally, I run the prediction. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=451"
  },
  {
    "text": "To extract the L channel from the input RGB image, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=453"
  },
  {
    "text": "I first convert the RGB image into a LAB image, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=457"
  },
  {
    "text": "using the new CIFilter convertRGBtoLab. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=461"
  },
  {
    "text": "The values of the lightness are set between 0 and 100.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=465"
  },
  {
    "text": "Then, I multiply the Lab image with a color matrix ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=471"
  },
  {
    "text": "and discard the color channels and return the lightness to the caller. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=474"
  },
  {
    "text": "Let's now analyze what happens at the output of the model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=479"
  },
  {
    "text": "The Core ML model returns two MLShapedArrays ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=484"
  },
  {
    "text": "containing the estimated color components.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=487"
  },
  {
    "text": "So after the prediction, I convert the two MLShapedArray into two CIImages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=492"
  },
  {
    "text": "Finally, I combine them with the model input lightness. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=499"
  },
  {
    "text": "This generates a new LAB image that I convert to RGB and return it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=503"
  },
  {
    "text": "To convert the two MLShapedArrays into two CIImages, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=510"
  },
  {
    "text": "I first extract the values from each shaped array. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=514"
  },
  {
    "text": "Then, I create two core images representing the two color channels ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=518"
  },
  {
    "text": "and return them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=522"
  },
  {
    "text": "To combine the lightness with the estimated color channels, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=524"
  },
  {
    "text": "I use a custom CIKernel that takes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=527"
  },
  {
    "text": "the three channels as input and returns a CIImage.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=531"
  },
  {
    "text": "Then, I use the new CIFilter convertLabToRGB ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=536"
  },
  {
    "text": "to convert the Lab image to RGB and return it to the caller. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=540"
  },
  {
    "text": "This is the source code for the custom CIKernel I use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=545"
  },
  {
    "text": "to combine the lightness with the two estimated color channels ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=548"
  },
  {
    "text": "in a single CIImage.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=552"
  },
  {
    "text": "For more information about the new CI filters to convert RGB images ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=554"
  },
  {
    "text": "to LAB images and vice versa, please refer to the session ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=559"
  },
  {
    "text": "\"Display EDR content with Core Image, Metal, and SwiftUI.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=563"
  },
  {
    "text": "Now that I completed the integration of this ML feature in my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=569"
  },
  {
    "text": "let's see it in action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=572"
  },
  {
    "text": "But wait. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=574"
  },
  {
    "text": "How will I colorize my old family photos in real time with my application? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=576"
  },
  {
    "text": "I could spend some time to digitize each of them and import them in my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=581"
  },
  {
    "text": "I think I have a better idea. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=586"
  },
  {
    "text": "What if I use my iPad camera to scan these photos ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=588"
  },
  {
    "text": "and colorize them live? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=591"
  },
  {
    "text": "I think it would be really fun, and I have everything I need to accomplish this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=594"
  },
  {
    "text": "But first, I have to solve a problem.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=598"
  },
  {
    "text": "My model needs 90 milliseconds to process an image. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=602"
  },
  {
    "text": "If I want to process a video, I would need something faster.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=606"
  },
  {
    "text": "For a smooth user experience, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=611"
  },
  {
    "text": "I'd like to run the device camera at least 30 fps.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=613"
  },
  {
    "text": "That means the camera will produce a frame about every 30 milliseconds.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=617"
  },
  {
    "text": "But since the model needs about 90 milliseconds to colorize a video frame, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=624"
  },
  {
    "text": "I am going to lose 2 or 3 frames during each colorization.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=628"
  },
  {
    "text": "The total prediction time of a model is a function of both its architecture ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=635"
  },
  {
    "text": "as well as the compute units operations it gets mapped to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=639"
  },
  {
    "text": "Looking at the performance report again, I notice that my model has a total ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=644"
  },
  {
    "text": "of 61 operations running on a combination of the neural engine and CPU.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=648"
  },
  {
    "text": "If I want a faster prediction time, I will have to change the model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=655"
  },
  {
    "text": "I decided to experiment with the model's architecture ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=660"
  },
  {
    "text": "and explore some alternatives that may be faster. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=663"
  },
  {
    "text": "However, a change in the architecture means I need to retrain the network.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=667"
  },
  {
    "text": "Apple offers different solutions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=673"
  },
  {
    "text": "that allow me to train machine learning models directly on my Mac.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=675"
  },
  {
    "text": "In my case, since the original model was developed in PyTorch, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=680"
  },
  {
    "text": "I decided to use the new PyTorch on Metal, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=685"
  },
  {
    "text": "so I can take advantage of the tremendous hardware acceleration ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=687"
  },
  {
    "text": "provided by Apple Silicon.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=691"
  },
  {
    "text": "If you are interested in knowing more about the PyTorch accelerated with Metal, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=695"
  },
  {
    "text": "please check the session, \"Accelerate machine learning with Metal\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=700"
  },
  {
    "text": "Because of this change, our journey needs to take a step back.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=706"
  },
  {
    "text": "After retraining, I will have to convert the result ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=710"
  },
  {
    "text": "to Core ML format and run the verification again.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=713"
  },
  {
    "text": "This time, model integration consists ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=719"
  },
  {
    "text": "of simply swapping the old model with the new one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=721"
  },
  {
    "text": "After retraining a few candidate alternative models, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=724"
  },
  {
    "text": "I have verified one that will meet my requirements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=728"
  },
  {
    "text": "Here it is with the corresponding performance report. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=731"
  },
  {
    "text": "It runs entirely on the neural engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=736"
  },
  {
    "text": "and the prediction time is now around 16 milliseconds, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=738"
  },
  {
    "text": "which works for video.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=742"
  },
  {
    "text": "But Performance Report tells me only one aspect of the performance of my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=747"
  },
  {
    "text": "Indeed, after running my app, I notice immediately ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=753"
  },
  {
    "text": "that colorization is not as smooth as I expect. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=756"
  },
  {
    "text": "So what happens in my app at runtime? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=760"
  },
  {
    "text": "In order to understand that, I can use the new Core ML template in Instruments.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=765"
  },
  {
    "text": "Analyzing the initial portion of the Core ML trace, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=772"
  },
  {
    "text": "after loading the model, I notice that the app accumulates predictions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=775"
  },
  {
    "text": "And this is unexpected. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=780"
  },
  {
    "text": "Instead, I'd expect to have a single prediction per frame.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=782"
  },
  {
    "text": "Zooming in the trace and checking the very first predictions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=788"
  },
  {
    "text": "I observe that the app requests a second Core ML prediction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=792"
  },
  {
    "text": "before the first one is finished.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=796"
  },
  {
    "text": "Here, the Neural Engine is still working on the first request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=799"
  },
  {
    "text": "when the second is given to Core ML.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=803"
  },
  {
    "text": "Similarly, the third prediction starts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=807"
  },
  {
    "text": "while still processing the second one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=810"
  },
  {
    "text": "Even after four predictions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=813"
  },
  {
    "text": "the lag between the request and execution ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=815"
  },
  {
    "text": "is already about 20 milliseconds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=819"
  },
  {
    "text": "Instead, I need to make sure that a new prediction starts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=822"
  },
  {
    "text": "only if the previous one is finished to avoid cascading these lags.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=825"
  },
  {
    "text": "While fixing this problem, I also found out that I accidentally set ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=831"
  },
  {
    "text": "the camera frame rate to 60 fps instead of the desired 30fps.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=835"
  },
  {
    "text": "After making sure that the apps process a new frame ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=843"
  },
  {
    "text": "after the previous prediction completes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=846"
  },
  {
    "text": "and setting the camera frame rate to 30 fps, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=848"
  },
  {
    "text": "I can see that Core ML dispatches correctly a single prediction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=852"
  },
  {
    "text": "to the Apple Neural Engine, and now the app runs smoothly.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=855"
  },
  {
    "text": "So we reached the end of our journey.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=862"
  },
  {
    "text": "Let's test the app on my old family photos.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=866"
  },
  {
    "text": "Here are my black and white photos that I found in my basement. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=874"
  },
  {
    "text": "They capture some of the places in Italy I visited a long time ago.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=878"
  },
  {
    "text": "Here is a great photo of the Colosseum in Rome.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=889"
  },
  {
    "text": "The color of the walls and the sky are so realistic.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=893"
  },
  {
    "text": "Let's check this one.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=899"
  },
  {
    "text": "This is Castel del Monte in the South of Italy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=903"
  },
  {
    "text": "Really nice.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=906"
  },
  {
    "text": "And this is my hometown, Grottaglie. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=909"
  },
  {
    "text": "Adding colors to these images triggered so many memories.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=912"
  },
  {
    "text": "Notice that I am applying the colorization only to the photo ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=917"
  },
  {
    "text": "while keeping the rest of the scene black and white.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=920"
  },
  {
    "text": "Here, I am taking advantage of the rectangle detection algorithm ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=926"
  },
  {
    "text": "available in the Vision framework. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=929"
  },
  {
    "text": "Using VNDetectRectangleRequest, I can isolate the photo in the scene ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=932"
  },
  {
    "text": "and use it as input to the Colorizer model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=937"
  },
  {
    "text": "And now let me recap.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=941"
  },
  {
    "text": "During our journey, I explored the enormous amount of frameworks, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=944"
  },
  {
    "text": "APIs, and tools Apple provides to prepare, integrate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=949"
  },
  {
    "text": "and evaluate machine learning functionality for your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=952"
  },
  {
    "text": "I started this journey identifying a problem ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=956"
  },
  {
    "text": "that required an open source machine learning model to solve it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=959"
  },
  {
    "text": "I found an open source model with desired functionality ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=963"
  },
  {
    "text": "and made it compatible with Apple platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=966"
  },
  {
    "text": "I assessed the model performance directly on the device ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=970"
  },
  {
    "text": "using the new Performance Report. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=973"
  },
  {
    "text": "I integrated the model in my app using the tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=976"
  },
  {
    "text": "and the frameworks you are familiar with.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=979"
  },
  {
    "text": "I optimized the model using the new Core ML Template in Instruments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=982"
  },
  {
    "text": "With Apple tools and frameworks, I can take care of each phase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=987"
  },
  {
    "text": "of the development process directly on Apple devices and platforms ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=990"
  },
  {
    "text": "from data preparation, training, integration, and optimization.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=994"
  },
  {
    "text": "Today, we just scratched the surface of what you, the developer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1000"
  },
  {
    "text": "can achieve with the frameworks and tools Apple provides you. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1004"
  },
  {
    "text": "Please, refer to previous sessions, linked to this, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1009"
  },
  {
    "text": "for additional inspiring ideas to bring machine learning to your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1012"
  },
  {
    "text": "Explore and try frameworks and tools. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1016"
  },
  {
    "text": "Take advantage of the great synergy between software and hardware ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1019"
  },
  {
    "text": "to accelerate your machine learning features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1023"
  },
  {
    "text": "and enrich the user experience of your apps. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1026"
  },
  {
    "text": "Have a great WWDC, and arrivederci.  ♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10017/?time=1029"
  }
]