[
  {
    "text": " ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1"
  },
  {
    "text": "Hi, I'm Nick Gillett, an engineer here at Apple on the Core Data team. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=9"
  },
  {
    "text": "In this session, I'll show you how to use our developer tools to learn more ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=14"
  },
  {
    "text": "about your applications that use NSPersistentCloudKitContainer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=18"
  },
  {
    "text": "We'll begin with a detailed look at how to explore applications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=21"
  },
  {
    "text": "in a productive and educational way.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=25"
  },
  {
    "text": "Then, we'll use some of my favorite tools to analyze how applications behave. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=28"
  },
  {
    "text": "And finally, we'll look at how you can provide detailed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=33"
  },
  {
    "text": "actionable feedback about your experiences with NSPersistentCloudKitContainer.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=37"
  },
  {
    "text": "I like to think of engineering a bit like the water cycle. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=42"
  },
  {
    "text": "Typically, I begin working on a feature by exploring the space ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=46"
  },
  {
    "text": "that feature exists in. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=50"
  },
  {
    "text": "Then, based on the things I learn, I use a combination of tools and tests ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=51"
  },
  {
    "text": "to analyze my work in a reproducible environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=57"
  },
  {
    "text": "Finally, I review the results with my peers and coworkers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=60"
  },
  {
    "text": "and collect their feedback.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=65"
  },
  {
    "text": "The goal of this cycle is to durably capture the things I learn ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=67"
  },
  {
    "text": "as I work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=70"
  },
  {
    "text": "Apple platforms include a great selection of tools like Xcode, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=72"
  },
  {
    "text": "Instruments, and XCTest that I use to capture what I learn. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=76"
  },
  {
    "text": "Those tools also make it possible to collect a wealth ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=81"
  },
  {
    "text": "of diagnostic information I can use to provide actionable feedback.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=84"
  },
  {
    "text": "This session references a lot of knowledge from years past. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=90"
  },
  {
    "text": "I've discussed NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=94"
  },
  {
    "text": "and the Core Data CloudKit Sample application I'll be showing today ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=97"
  },
  {
    "text": "in detail in the sessions \"Build Apps that share data through CloudKit and Core Data\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=101"
  },
  {
    "text": "and in the session \"Using Core Data with CloudKit.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=106"
  },
  {
    "text": "I'll also demonstrate how to use Xcode and Instruments to run tests ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=111"
  },
  {
    "text": "and the Device organizer to capture data from devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=116"
  },
  {
    "text": "If you need to, I recommend you review the sessions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=120"
  },
  {
    "text": "\"Getting Started With Instruments\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=123"
  },
  {
    "text": "and \"Diagnose performance issues with the Xcode Organizer\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=125"
  },
  {
    "text": "to learn more about these two important pieces of the toolchain. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=129"
  },
  {
    "text": "All right, let's get started with the first part of the cycle, exploration. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=134"
  },
  {
    "text": "For me, the primary goal of exploration is to learn. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=139"
  },
  {
    "text": "I want to challenge and verify all of the assumptions I have ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=144"
  },
  {
    "text": "about how an application will work.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=147"
  },
  {
    "text": "I might ask: What happens if I tap this button? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=150"
  },
  {
    "text": "Does NSPersistentCloudKitContainer sync when I save data to a persistent store? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=154"
  },
  {
    "text": "Does an application run out of memory when working with a large data set? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=159"
  },
  {
    "text": "From Core Data's perspective, all of these questions are influenced ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=164"
  },
  {
    "text": "by the data an application works with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=168"
  },
  {
    "text": "For example, the Core Data CloudKit sample application uses this data model.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=171"
  },
  {
    "text": "It manages a set of posts which have some text fields for a title and content.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=178"
  },
  {
    "text": "Posts can be related to attachments, generally images, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=184"
  },
  {
    "text": "which can be quite large.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=187"
  },
  {
    "text": "The ImageData is therefore stored across a to-one relationship ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=190"
  },
  {
    "text": "so that it can be loaded on demand. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=194"
  },
  {
    "text": "And I'm going to focus my exploration on that data set, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=197"
  },
  {
    "text": "specifically what happens to the sample application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=201"
  },
  {
    "text": "as I change the shape, structure, and variance of that data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=204"
  },
  {
    "text": "Since its release, the sample application has included a built-in way to explore it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=210"
  },
  {
    "text": "The Generate 1000 Posts button does exactly what it says on the label.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=216"
  },
  {
    "text": "When tapped, it generates a sample data set ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=221"
  },
  {
    "text": "of 1,000 posts with a short title. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=224"
  },
  {
    "text": "The Posts table view easily handles this level of data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=227"
  },
  {
    "text": "So the next question I would ask is, how can I explore a data set ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=230"
  },
  {
    "text": "of a different shape or size in this application? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=234"
  },
  {
    "text": "The Generate 1000 Posts button runs what I like to call ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=239"
  },
  {
    "text": "an algorithmic data generator. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=242"
  },
  {
    "text": "Algorithmic data generators follow a set of predetermined rules ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=245"
  },
  {
    "text": "like \"insert 1000 objects\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=249"
  },
  {
    "text": "or \"make sure that every field has a value, or that no fields have values.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=251"
  },
  {
    "text": "We, as it turns out, are also data generators. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=257"
  },
  {
    "text": "We can hand-craft specific data sets in code, in SQL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=261"
  },
  {
    "text": "or by interacting directly with an application, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=265"
  },
  {
    "text": "and these generated data sets can be preserved ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=268"
  },
  {
    "text": "for later use or analysis.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=271"
  },
  {
    "text": "To explore a larger data set, I can define a new data generator, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=274"
  },
  {
    "text": "the LargeDataGenerator, and give it a single method, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=279"
  },
  {
    "text": "generateData, to build my new data set. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=282"
  },
  {
    "text": "With just two for loops, I can generate a set of 60 posts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=286"
  },
  {
    "text": "that each have 11 image attachments associated with them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=289"
  },
  {
    "text": "That's 660 images in total. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=294"
  },
  {
    "text": "At an average size of 10-20 megabytes per image, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=297"
  },
  {
    "text": "the generated data set consumes almost 10GB of data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=300"
  },
  {
    "text": "With such a simple interface, data generators are easily invoked ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=306"
  },
  {
    "text": "in tests like this one. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=310"
  },
  {
    "text": "This single line of code generates over 10GB of representative data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=312"
  },
  {
    "text": "for this test to use.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=317"
  },
  {
    "text": "Additionally, we can build validation methods in the tests ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=320"
  },
  {
    "text": "that verify the data generator behaves correctly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=324"
  },
  {
    "text": "like asserting that each post does indeed get 11 image attachments.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=327"
  },
  {
    "text": "Of course, this wouldn't be a talk about NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=333"
  },
  {
    "text": "if we didn't sync this data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=337"
  },
  {
    "text": "So let's craft a new test to do just that.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=339"
  },
  {
    "text": "The first thing I'll need is an instance of NSPersistentCloudKitContainer to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=343"
  },
  {
    "text": "I've created a helper method to make that easy. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=349"
  },
  {
    "text": "Next, I use the LargeDataGenerator ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=352"
  },
  {
    "text": "to populate the container with my desired data set.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=355"
  },
  {
    "text": "And finally, I wait for the container to finish exporting the data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=359"
  },
  {
    "text": "In this specific test, I wait for up to 20 minutes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=364"
  },
  {
    "text": "to give the large data set time to upload.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=367"
  },
  {
    "text": "The eagle eyed among you may have noticed that this test appears ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=371"
  },
  {
    "text": "to be doing a lot of waiting for different types of events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=375"
  },
  {
    "text": "Here, when I create the container, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=378"
  },
  {
    "text": "I wait for the container to finish setting up.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=381"
  },
  {
    "text": "And here, I use a helper method I wrote to create XCTestExpectations ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=384"
  },
  {
    "text": "for an export event from the container.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=389"
  },
  {
    "text": "Let's look at that in detail.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=392"
  },
  {
    "text": "This method takes a desired event type and an instance ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=394"
  },
  {
    "text": "of NSPersistentCloudKitContainer as an argument. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=398"
  },
  {
    "text": "It creates one expectation for each persistent store in the container ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=401"
  },
  {
    "text": "using XCTestCase's expectationForNotification method ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=405"
  },
  {
    "text": "to observe NSPersistentCloudKitContainer's eventChanged notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=410"
  },
  {
    "text": "In the notification handler block, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=415"
  },
  {
    "text": "I verify that the incoming event ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=417"
  },
  {
    "text": "is of the correct type ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=419"
  },
  {
    "text": "for the specific store this expectation is for, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=421"
  },
  {
    "text": "and that it's finished by checking endDate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=424"
  },
  {
    "text": "is not equal to nil.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=426"
  },
  {
    "text": "By using this technique, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=428"
  },
  {
    "text": "we can strongly associate points of control in our tests ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=430"
  },
  {
    "text": "with events from NSPersistentCloudKitContainer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=434"
  },
  {
    "text": "Back in my test, I add a new container to import the data that was just exported. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=437"
  },
  {
    "text": "This technique uses a trick. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=444"
  },
  {
    "text": "It creates a new instance ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=446"
  },
  {
    "text": "of NSPersistentCloudKitContainer with empty store files. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=447"
  },
  {
    "text": "This allows the test to take advantage ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=451"
  },
  {
    "text": "of NSPersistentCloudKitContainer's first-time import ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=453"
  },
  {
    "text": "to explore what happens when all of this data is downloaded by a device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=457"
  },
  {
    "text": "Now, tests are great, but sometimes I want to feel ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=462"
  },
  {
    "text": "how a data set behaves in an application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=465"
  },
  {
    "text": "To do that, I can bind data generators to a user interface, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=468"
  },
  {
    "text": "as we have done in the sample application.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=472"
  },
  {
    "text": "When I tap the Generate Large Data button, I can watch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=476"
  },
  {
    "text": "the data generator populate the data set. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=479"
  },
  {
    "text": "On a second device, I can watch the table view populate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=482"
  },
  {
    "text": "as NSPersistentCloudKitContainer makes progress downloading the generated data. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=486"
  },
  {
    "text": "Tapping on an individual post allows me to see the attachments download ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=492"
  },
  {
    "text": "and populate incrementally, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=496"
  },
  {
    "text": "just as they would for a user of this application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=498"
  },
  {
    "text": "This specific user interface is driven by an alert controller.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=502"
  },
  {
    "text": "The LargeDataGenerator's simple interface makes it easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=507"
  },
  {
    "text": "to add a new alert action with just these two lines of code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=510"
  },
  {
    "text": "It's clear, concise, and easily understood.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=514"
  },
  {
    "text": "In this section, we've explored the behavior of an application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=519"
  },
  {
    "text": "using the concept of a data generator.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=523"
  },
  {
    "text": "Data generators can be driven in our applications any way we choose, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=526"
  },
  {
    "text": "whether that be by tests or custom UI, as I've demonstrated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=531"
  },
  {
    "text": "or by something like a command line argument, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=535"
  },
  {
    "text": "or anything else that happens to work for your specific use case. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=537"
  },
  {
    "text": "Now that we know how to populate an application with data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=541"
  },
  {
    "text": "we're ready to analyze how that changes application behavior. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=545"
  },
  {
    "text": "In this section, we'll learn about some tools and techniques ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=548"
  },
  {
    "text": "to analyze how an application behaves ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=552"
  },
  {
    "text": "with a large data set.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=554"
  },
  {
    "text": "Specifically, we'll use Instruments to analyze the time and memory complexity ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=556"
  },
  {
    "text": "of the data set created by the LargeDataGenerator.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=561"
  },
  {
    "text": "Then, we'll look at the wealth of information available to us ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=565"
  },
  {
    "text": "in the system logs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=569"
  },
  {
    "text": "There we can find a record of activity from NSPersistentCloudKitContainer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=570"
  },
  {
    "text": "CloudKit, the system scheduler, and from push notifications. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=575"
  },
  {
    "text": "Let's get stared with Instruments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=579"
  },
  {
    "text": "One reason I love tests is that Xcode makes it easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=582"
  },
  {
    "text": "to analyze the behavior of a test. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=586"
  },
  {
    "text": "In my test case, I can right-click on the test disclosure ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=589"
  },
  {
    "text": "in the gutter and select Profile. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=592"
  },
  {
    "text": "Xcode will build the tests and then automatically launch instruments.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=595"
  },
  {
    "text": "I can double-click the Time Profiler instrument ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=600"
  },
  {
    "text": "to examine where my test spends time doing work.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=602"
  },
  {
    "text": "When I click the record button, Instruments will launch the application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=607"
  },
  {
    "text": "and execute the selected test. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=611"
  },
  {
    "text": "This test appears to be taking quite a while to run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=614"
  },
  {
    "text": "Let's skip ahead and see why.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=618"
  },
  {
    "text": "Instruments has already selected the main thread, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=621"
  },
  {
    "text": "and on the right side, I can see the heaviest stack trace of the test run.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=624"
  },
  {
    "text": "Let's make that a little easier to read.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=630"
  },
  {
    "text": "There we go. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=636"
  },
  {
    "text": "Now, if I scroll to the bottom, I can see the LargeDataGenerator is ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=638"
  },
  {
    "text": "spending a lot of time generating thumbnails. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=642"
  },
  {
    "text": "How would we decide if this is a bug or a feature? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=645"
  },
  {
    "text": "In the LargeDataGenerator, I have this line of code that generates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=650"
  },
  {
    "text": "a new thumbnail for each attachment. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=653"
  },
  {
    "text": "However, I know from the application's data model that thumbnails are special. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=656"
  },
  {
    "text": "They're computed on demand from the related imageData. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=661"
  },
  {
    "text": "That means this line is unnecessary, and my data generator is wasting ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=665"
  },
  {
    "text": "a lot of time on them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=669"
  },
  {
    "text": "So I can just remove it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=671"
  },
  {
    "text": "Let's see how that changes the performance of the test.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=674"
  },
  {
    "text": "After rebuilding the app with the updated data generator, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=677"
  },
  {
    "text": "I can rerun the test in Instruments. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=680"
  },
  {
    "text": "And honestly I don't see much of change, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=683"
  },
  {
    "text": "but after a few more seconds, the test completes. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=689"
  },
  {
    "text": "That's a lot faster than the previous run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=692"
  },
  {
    "text": "Let's see where the test spent most of its time.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=695"
  },
  {
    "text": "In the right drawer, I now see that the heaviest stack trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=703"
  },
  {
    "text": "is saving images to the persistent store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=706"
  },
  {
    "text": "and that's exactly what I would expect for a test that manages this much data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=710"
  },
  {
    "text": "That one change reduced the runtime of the generateData test ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=715"
  },
  {
    "text": "from this to this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=719"
  },
  {
    "text": "It executes in one tenth the time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=722"
  },
  {
    "text": "Analyzing tests in this way doesn't always uncover bugs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=725"
  },
  {
    "text": "Sometimes we just learn more ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=729"
  },
  {
    "text": "about where an application is spending time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=731"
  },
  {
    "text": "when working with a specific data set. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=733"
  },
  {
    "text": "But either way, though, it's valuable learning.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=736"
  },
  {
    "text": "So that's how the Time Profiler instrument can help explore ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=739"
  },
  {
    "text": "where an application spends time with a data set. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=743"
  },
  {
    "text": "Now, because of the size of this data set, I'm also curious how much memory ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=746"
  },
  {
    "text": "the test uses. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=751"
  },
  {
    "text": "So let's give it a run using the Allocations instrument. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=753"
  },
  {
    "text": "I'll use Xcode to launch Instruments to profile my test.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=757"
  },
  {
    "text": "Instead of selecting the Time Profiler instrument, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=762"
  },
  {
    "text": "I'll double-click Allocations...",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=764"
  },
  {
    "text": "And then click Record.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=771"
  },
  {
    "text": "Even though this test is executing quickly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=782"
  },
  {
    "text": "itâ€™s using a lot of memory, over 10GB, in fact. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=785"
  },
  {
    "text": "This tells me that nearly the entire data set ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=790"
  },
  {
    "text": "is being kept in memory during the test run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=793"
  },
  {
    "text": "Let's find out why.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=795"
  },
  {
    "text": "I can select a range of allocations to look at. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=799"
  },
  {
    "text": "In the bottom pane, I can see that there are a number of large allocations.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=802"
  },
  {
    "text": "I can dig into those by clicking this disclosure, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=807"
  },
  {
    "text": "and then click on one of the large data blobs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=811"
  },
  {
    "text": "that's been allocated for the test. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=813"
  },
  {
    "text": "This specific blob was allocated but not freed for almost two seconds. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=816"
  },
  {
    "text": "That's an eternity in test time. Why was it alive so long? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=821"
  },
  {
    "text": "I can explore that by expanding the stack trace on the right.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=826"
  },
  {
    "text": "From experience, the allocation and deallocation stack trace ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=833"
  },
  {
    "text": "tell me that this object was faulted by CoreData ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=837"
  },
  {
    "text": "and then released when the managed object context finished its work. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=840"
  },
  {
    "text": "That's usually an indication that the object was retained by a fetch, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=845"
  },
  {
    "text": "an autoreleasepool, or an object in the test.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=849"
  },
  {
    "text": "The problematic section of code is here in my verifier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=855"
  },
  {
    "text": "I load an image from an attachment and verify it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=859"
  },
  {
    "text": "However, this keeps the attachment and the associated image data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=862"
  },
  {
    "text": "registered with the managed object context.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=866"
  },
  {
    "text": "There are a number of ways we could try to resolve this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=869"
  },
  {
    "text": "For example, in a table view, we could use a batched fetch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=873"
  },
  {
    "text": "to free the images as the table scrolls over the posts. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=877"
  },
  {
    "text": "However, this test is executing far too quickly for that to be effective. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=881"
  },
  {
    "text": "I need to change my approach. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=886"
  },
  {
    "text": "Instead of verifying by fetching posts, I can fetch attachments instead. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=888"
  },
  {
    "text": "If I also fetch only the objectIDs, the managed object context ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=894"
  },
  {
    "text": "won't capture any of the loaded objects until I ask it to.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=897"
  },
  {
    "text": "I can use NSManagedObjectContext's objectWithID method ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=903"
  },
  {
    "text": "to fetch the attachments as I go for validation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=907"
  },
  {
    "text": "Finally, for every 10 attachments I validate, I reset the context, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=911"
  },
  {
    "text": "freeing all of the cached state and the associated memory.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=916"
  },
  {
    "text": "If I rerun the test with this change, I can see that it results ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=921"
  },
  {
    "text": "in a much more predictable and tunable level of memory consumption.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=925"
  },
  {
    "text": "In fact, the verifier uses even less memory ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=930"
  },
  {
    "text": "than the LargeDataGenerator does ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=932"
  },
  {
    "text": "when it inserts these objects.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=934"
  },
  {
    "text": "Let's drill down into a specific allocation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=938"
  },
  {
    "text": "to learn how the fix works.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=941"
  },
  {
    "text": "First, I'll select a range of allocations to work with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=944"
  },
  {
    "text": "Then, I'll select a specific size to examine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=947"
  },
  {
    "text": "I need to enable destroyed objects to find the ones that were freed during this time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=954"
  },
  {
    "text": "and then I can select a specific allocation to examine.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=960"
  },
  {
    "text": "On the right side, Instruments shows me an allocation stack trace, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=965"
  },
  {
    "text": "but I want to know where it was freed, so I'll select the deallocation event. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=970"
  },
  {
    "text": "I happen to know that this stack trace means ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=975"
  },
  {
    "text": "that NSManagedObjectContext is asynchronously deallocating ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=978"
  },
  {
    "text": "the object that retained this blob, freeing the consumed memory.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=981"
  },
  {
    "text": "This technique allows me to establish a high water mark for the test, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=987"
  },
  {
    "text": "enabling it to run on systems with less memory.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=991"
  },
  {
    "text": "By combining tests with Instruments, I've been able to discover ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=995"
  },
  {
    "text": "that this specific test had some less-than-desirable behavior. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=998"
  },
  {
    "text": "I made targeted changes to address that behavior directly ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1003"
  },
  {
    "text": "and then verify the results. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1006"
  },
  {
    "text": "Additionally, the system logs also contain ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1009"
  },
  {
    "text": "a wealth of information about an application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1012"
  },
  {
    "text": "and the system services it depends on, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1015"
  },
  {
    "text": "like CloudKit, scheduling, and push notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1017"
  },
  {
    "text": "I'm going to sync a single post between my MacBook Pro and my iPhone. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1022"
  },
  {
    "text": "When I insert a new post on my Mac, give a short title, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1028"
  },
  {
    "text": "and let it upload to iCloud, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1032"
  },
  {
    "text": "the system logs capture a number of events.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1034"
  },
  {
    "text": "When it syncs to my iPhone, sometimes even capturing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1038"
  },
  {
    "text": "intermediate state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1041"
  },
  {
    "text": "the system logs capture a corresponding set of events. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1043"
  },
  {
    "text": "On the MacBook Pro, NSPersistentCloudKitContainer does work ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1047"
  },
  {
    "text": "inside of the application process, in this case, CoreDataCloudKitDemo. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1051"
  },
  {
    "text": "When data is written to a persistent store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1057"
  },
  {
    "text": "it asks a system service called DASD ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1059"
  },
  {
    "text": "if now is a good time to export that data to CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1063"
  },
  {
    "text": "If it is, DASD will tell NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1067"
  },
  {
    "text": "to run an activity. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1071"
  },
  {
    "text": "NSPersistentCloudKitContainer will then schedule work ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1073"
  },
  {
    "text": "with a process called cloudd ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1077"
  },
  {
    "text": "to export the changed objects to CloudKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1079"
  },
  {
    "text": "We can observe logs from each of these processes using the Console app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1082"
  },
  {
    "text": "For application logs, we simply look for the application process, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1087"
  },
  {
    "text": "CoreDataCloudKitDemo. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1091"
  },
  {
    "text": "Here, I've selected one that shows an export completing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1094"
  },
  {
    "text": "For scheduling logs, we want to look at logs from the process dasd ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1098"
  },
  {
    "text": "and from the application's specific store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1103"
  },
  {
    "text": "Here, I've selected the start of an export activity ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1106"
  },
  {
    "text": "for the application's private store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1110"
  },
  {
    "text": "Let's examine this log in a bit more detail.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1112"
  },
  {
    "text": "Activities created by NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1116"
  },
  {
    "text": "with dasd follow a specific format. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1119"
  },
  {
    "text": "The activity identifier is composed of a specific prefix ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1123"
  },
  {
    "text": "that NSPersistentCloudKitContainer uses along with the store identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1127"
  },
  {
    "text": "for the store the activity belongs to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1132"
  },
  {
    "text": "The dasd logs include information about how the service decides ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1135"
  },
  {
    "text": "if an activity can run. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1139"
  },
  {
    "text": "Policies that affect the application's ability to do work ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1141"
  },
  {
    "text": "will be listed in the log along with a final decision.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1145"
  },
  {
    "text": "Finally, the process cloudd logs information from CloudKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1150"
  },
  {
    "text": "and I like to filter these logs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1154"
  },
  {
    "text": "by the container identifier I'm working with. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1156"
  },
  {
    "text": "Here I've selected the corresponding modify records operation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1159"
  },
  {
    "text": "for the export I mentioned earlier.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1163"
  },
  {
    "text": "When changes are imported on a receiving device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1166"
  },
  {
    "text": "there is one additional process to observe. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1169"
  },
  {
    "text": "The process apsd is responsible for receiving push notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1173"
  },
  {
    "text": "and forwarding them to the application.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1178"
  },
  {
    "text": "That causes NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1181"
  },
  {
    "text": "to initiate a series of activities similar to the export process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1184"
  },
  {
    "text": "It asks dasd for time to perform an import ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1188"
  },
  {
    "text": "and then works with cloudd to fetch all of the updated objects from CloudKit ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1192"
  },
  {
    "text": "and import them into the local store.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1196"
  },
  {
    "text": "Apsd logs when it receives a push notification for an application, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1200"
  },
  {
    "text": "and this log captures a number of important details.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1205"
  },
  {
    "text": "The log message includes the container identifier here ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1210"
  },
  {
    "text": "as well as the subscription name and zone identifier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1213"
  },
  {
    "text": "that triggered the push notification. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1216"
  },
  {
    "text": "These are managed by NSPersistentCloudKitContainer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1219"
  },
  {
    "text": "and will always start with the prefix com.apple.coredata.cloudkit.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1222"
  },
  {
    "text": "Now the console app is great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1229"
  },
  {
    "text": "But when I'm developing on my Mac, I like to use the log stream command ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1231"
  },
  {
    "text": "in Terminal to display these logs alongside my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1235"
  },
  {
    "text": "I open one terminal window or tab for each of the following predicates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1240"
  },
  {
    "text": "first the application. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1244"
  },
  {
    "text": "Next, the logs from cloudd so I can see what's happening with the CloudKit server. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1246"
  },
  {
    "text": "Next, apsd for push notification logs. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1252"
  },
  {
    "text": "And finally, dasd so I can see what's happening with activities ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1256"
  },
  {
    "text": "that NSPersistentCloudKitContainer schedules on my behalf. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1260"
  },
  {
    "text": "These predicates can also be used to guide your queries in the console app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1264"
  },
  {
    "text": "There's so much information available to us on the devices we use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1271"
  },
  {
    "text": "The challenge, really, is knowing what tools to use to find and analyze it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1275"
  },
  {
    "text": "With just Instruments, we can learn about a host of topics like runtime ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1279"
  },
  {
    "text": "and memory performance and so much more. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1284"
  },
  {
    "text": "The system logs capture events that describe the work an application does ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1287"
  },
  {
    "text": "and what the system is doing for it behind the scenes.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1291"
  },
  {
    "text": "The last phase of my development cycle ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1294"
  },
  {
    "text": "is collecting and providing actionable feedback. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1297"
  },
  {
    "text": "In this section, I'll demonstrate how to collect diagnostic information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1300"
  },
  {
    "text": "from devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1304"
  },
  {
    "text": "Our goal is to use this information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1305"
  },
  {
    "text": "to generate feedback that's actionable and aligned with a specific goal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1308"
  },
  {
    "text": "These techniques can help you collect feedback ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1312"
  },
  {
    "text": "from any device, whether it's one you own or a customer device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1315"
  },
  {
    "text": "There are three steps to gathering diagnostic information from a device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1319"
  },
  {
    "text": "First, we'll need to install the CloudKit logging profile, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1324"
  },
  {
    "text": "which enables logs that can be used to identify issues ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1327"
  },
  {
    "text": "and triage them effectively. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1330"
  },
  {
    "text": "Next, we'll collect a sysdiagnose from the affected device. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1333"
  },
  {
    "text": "And finally, if we have physical access to the device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1337"
  },
  {
    "text": "we can also collect the persistent store files from Xcode. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1341"
  },
  {
    "text": "To install the the logging profile, we simply visit the Profile and Logs page ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1345"
  },
  {
    "text": "on the developer portal. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1349"
  },
  {
    "text": "I can search for the CloudKit profile and tap the profile link to download it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1351"
  },
  {
    "text": "On some devices, a notification will appear to install the profile. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1356"
  },
  {
    "text": "However, here on iOS, we'll need to install it manually ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1361"
  },
  {
    "text": "via the Settings app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1364"
  },
  {
    "text": "In Settings, I can navigate to tap on the Profile Downloaded cell. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1367"
  },
  {
    "text": "Then I can tap on the downloaded profile to install it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1372"
  },
  {
    "text": "Follow the steps to complete the installation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1376"
  },
  {
    "text": "After the profile is installed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1380"
  },
  {
    "text": "the device can be rebooted, and it will take effect.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1382"
  },
  {
    "text": "Once the device has rebooted, we can reproduce the behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1389"
  },
  {
    "text": "we want to capture and then take a sysdiagnose.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1392"
  },
  {
    "text": "Taking a sysdiagnose is done using a keychord, a special series of buttons. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1396"
  },
  {
    "text": "These are described in the instructions page for the profile. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1401"
  },
  {
    "text": "I happen to know that for an iPhone, we hold the volume buttons ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1405"
  },
  {
    "text": "and the side button for a couple of seconds ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1409"
  },
  {
    "text": "and then release it. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1411"
  },
  {
    "text": "After a short while, a sysdiagnose will be available in Settings. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1413"
  },
  {
    "text": "The instructions for finding it are included in the instructions file ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1417"
  },
  {
    "text": "for a profile.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1421"
  },
  {
    "text": "In Settings I navigate to Privacy & Security, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1423"
  },
  {
    "text": "Analytics and Improvements, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1428"
  },
  {
    "text": "then choose Analytics Data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1430"
  },
  {
    "text": "and scroll through the logs until I find the sysdiagnose.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1432"
  },
  {
    "text": "If I tap on the sysdiagnose and then tap the Share button, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1437"
  },
  {
    "text": "I can choose a number of ways to share it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1441"
  },
  {
    "text": "For example, I like to AirDrop them to my Mac for analysis.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1444"
  },
  {
    "text": "Finally, if possible, I can collect the store files ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1448"
  },
  {
    "text": "from Xcode using the Device Organizer.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1451"
  },
  {
    "text": "I can collect the files from this iPhone ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1454"
  },
  {
    "text": "by clicking on the Sample Application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1456"
  },
  {
    "text": "in the installed apps list, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1458"
  },
  {
    "text": "clicking on the disclosure button, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1460"
  },
  {
    "text": "choosing Download Container, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1462"
  },
  {
    "text": "and saving that to my Downloads directory.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1464"
  },
  {
    "text": "With all of that done, both the system logs and the store files ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1470"
  },
  {
    "text": "are now available for analysis. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1474"
  },
  {
    "text": "We already talked about the log stream command, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1476"
  },
  {
    "text": "but with a sysdiagnose, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1478"
  },
  {
    "text": "I can use the log show command to print out logs from the sysdiagnose. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1480"
  },
  {
    "text": "Here, I've copied the predicate for the apsd logs we talked about earlier.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1485"
  },
  {
    "text": "The final argument to the log show command is the logarchive to use. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1491"
  },
  {
    "text": "If nothing is specified, it will display the system logs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1496"
  },
  {
    "text": "from the machine its running on. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1499"
  },
  {
    "text": "Here, I have specified system_logs.logarchive ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1501"
  },
  {
    "text": "so that it reads the logs I took from the sysdiagnose. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1505"
  },
  {
    "text": "For example, I can specify a precise time range ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1508"
  },
  {
    "text": "to focus on the time when an event I'm interested in occurred.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1511"
  },
  {
    "text": "I can also combine many of the predicates we discussed earlier ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1516"
  },
  {
    "text": "to form a unified log of all the activity relevant to an application, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1520"
  },
  {
    "text": "beginning with the application logs here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1525"
  },
  {
    "text": "the cloudd logs here, apsd logs here, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1528"
  },
  {
    "text": "and finally dasd logs here.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1533"
  },
  {
    "text": "This powerful command can be included in feedback reports ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1536"
  },
  {
    "text": "or shared with teammates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1540"
  },
  {
    "text": "to allow everyone to focus on a specific set of logs for analysis.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1541"
  },
  {
    "text": "In this session, we talked about how you can explore application behavior ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1546"
  },
  {
    "text": "with data generators, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1550"
  },
  {
    "text": "analyze applications with instruments and the system logs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1552"
  },
  {
    "text": "and provide or collect actionable feedback ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1556"
  },
  {
    "text": "from applications that use NSPersistentCloudKitContainer.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1559"
  },
  {
    "text": "I'm Nick Gillett, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1563"
  },
  {
    "text": "and it's been my pleasure to bring you this presentation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1564"
  },
  {
    "text": "Thanks for watching, stay active, close your rings, and have a great WWDC.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1568"
  },
  {
    "text": "",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10119/?time=1574"
  }
]