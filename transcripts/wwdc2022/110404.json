[
  {
    "text": "♪ instrumental hip hop music ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=0"
  },
  {
    "text": "Hi, I’m David Wendland, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=9"
  },
  {
    "text": "a Commerce Technical Advocate for the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=11"
  },
  {
    "text": "Today, I’ll show you how your app can deliver a first class experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=14"
  },
  {
    "text": "by proactively identifying a customer's new, current, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=18"
  },
  {
    "text": "and past purchases, without the customer taking any action. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=21"
  },
  {
    "text": "I’ll cover how to do this with StoreKit 2 and the original StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=25"
  },
  {
    "text": "so you can optimize your app's onboarding experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=30"
  },
  {
    "text": "for all your customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=33"
  },
  {
    "text": "Let me start by defining proactive in-app purchase restore. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=36"
  },
  {
    "text": "This means that when a customer launches your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=39"
  },
  {
    "text": "you use the data readily available, on device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=42"
  },
  {
    "text": "to proactively check for the transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=45"
  },
  {
    "text": "in order to determine if they are a new or existing customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=48"
  },
  {
    "text": "and doing so without requiring any customer action, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=53"
  },
  {
    "text": "not even tapping a \"Restore Purchases\" button or entering a password. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=56"
  },
  {
    "text": "This enables you to tailor your app experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=61"
  },
  {
    "text": "to your customer's purchase history and state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=64"
  },
  {
    "text": "so your app unlocks products or services for your current customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=67"
  },
  {
    "text": "or your app merchandises your latest product offering to new customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=72"
  },
  {
    "text": "or for those past subscribers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=76"
  },
  {
    "text": "you present them subscription offers to win them back. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=78"
  },
  {
    "text": "This is what proactive restore is about, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=81"
  },
  {
    "text": "using StoreKit to optimize your app's experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=84"
  },
  {
    "text": "for new, existing, and past customers, on all of their devices, automatically. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=87"
  },
  {
    "text": "Let’s look at this example. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=93"
  },
  {
    "text": "Here we have our Ocean Journal app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=95"
  },
  {
    "text": "This is a common merchandising experience, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=98"
  },
  {
    "text": "where the customer has a few different calls to action to choose from. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=100"
  },
  {
    "text": "Either I can attempt to buy the in-app purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=104"
  },
  {
    "text": "and authenticate with biometrics, such as FaceID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=107"
  },
  {
    "text": "or if I’ve created an app account, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=110"
  },
  {
    "text": "I could sign in and possibly use Keychain to enter my password, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=112"
  },
  {
    "text": "or if I believe I’m an active subscriber, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=116"
  },
  {
    "text": "I could use the \"Restore Purchases\" button. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=118"
  },
  {
    "text": "For your active subscribers on a new device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=121"
  },
  {
    "text": "knowing which option to choose isn’t always clear to them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=123"
  },
  {
    "text": "And with the data readily available to your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=127"
  },
  {
    "text": "this experience can be streamlined ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=130"
  },
  {
    "text": "with our proactive in-app purchase restore best practice.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=132"
  },
  {
    "text": "So, if I launched this app on a new device but was already an active subscriber, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=136"
  },
  {
    "text": "upon launch, the app would proactively restore my service, automatically, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=141"
  },
  {
    "text": "without requiring any action from me. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=146"
  },
  {
    "text": "So here the app recognized my Pro subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=148"
  },
  {
    "text": "and loaded my favorite beach, complete with surf conditions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=151"
  },
  {
    "text": "and enabled the live cam feature. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=154"
  },
  {
    "text": "This experience differentiates your app from the others ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=157"
  },
  {
    "text": "and I will cover how to do this with StoreKit 2 on iOS 15 and newer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=161"
  },
  {
    "text": "Additionally, if your app supports previous versions of iOS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=165"
  },
  {
    "text": "I will cover how to create this same great experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=169"
  },
  {
    "text": "with original StoreKit and the verifyReceipt endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=171"
  },
  {
    "text": "With that background, here’s what I’ll cover. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=175"
  },
  {
    "text": "First, I’ll describe in detail the core customer product states ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=178"
  },
  {
    "text": "that your app uses to generate personalized experiences ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=182"
  },
  {
    "text": "based on the customer's in-app purchases with StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=186"
  },
  {
    "text": "Then I'll review the steps to implement, using StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=190"
  },
  {
    "text": "complete with sample code using the SK Demo app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=194"
  },
  {
    "text": "Let’s look at each in-app purchase type, their core customer product states, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=199"
  },
  {
    "text": "and review a few examples of a personalized onboarding experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=203"
  },
  {
    "text": "To start, the in-app purchase types that apply ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=208"
  },
  {
    "text": "to proactive restore are non-consumables, non-renewing subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=210"
  },
  {
    "text": "and auto-renewable subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=215"
  },
  {
    "text": "as they are all persistent in the customer's transaction history ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=217"
  },
  {
    "text": "and will always be available with StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=220"
  },
  {
    "text": "Therefore your app can identify per customer their purchase state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=223"
  },
  {
    "text": "for each product or subscription group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=227"
  },
  {
    "text": "For non-renewing and auto-renewable subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=231"
  },
  {
    "text": "I will use the term \"subscriptions\" to reference them both ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=234"
  },
  {
    "text": "as we review the customer product states. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=237"
  },
  {
    "text": "Here are the three core states your app can personalize against. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=241"
  },
  {
    "text": "Let’s review in-depth new customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=245"
  },
  {
    "text": "This state represents a signed in App Store Apple ID ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=248"
  },
  {
    "text": "that does not have any current or past in-app purchase transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=251"
  },
  {
    "text": "This state is typically used as the app’s default merchandising experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=256"
  },
  {
    "text": "Our Ocean Journal app is merchandising its monthly and annual subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=261"
  },
  {
    "text": "with a one month free trial. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=265"
  },
  {
    "text": "Looking at our second core state, we have Purchased and Active Subscriber. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=268"
  },
  {
    "text": "In this state, a customer has an active transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=273"
  },
  {
    "text": "and your app is obligated to grant the customer access ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=276"
  },
  {
    "text": "to the purchased product or service. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=279"
  },
  {
    "text": "Here, our Ocean Journal app immediately presents the customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=281"
  },
  {
    "text": "their preferred beach with the premium live beach cam. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=284"
  },
  {
    "text": "No buy buttons are visible, as service was proactively restored. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=288"
  },
  {
    "text": "For each purchased product or active subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=293"
  },
  {
    "text": "the transaction has a static and unique original transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=296"
  },
  {
    "text": "which persists for the customer's Apple ID and storefront. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=300"
  },
  {
    "text": "To maintain status of the customer's transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=304"
  },
  {
    "text": "associate the original transaction IDs with an account on your system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=307"
  },
  {
    "text": "It can be either an anonymous account, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=312"
  },
  {
    "text": "or an account that the user created with your system. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=314"
  },
  {
    "text": "Knowing the original transaction ID is critical ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=317"
  },
  {
    "text": "when leveraging the power of App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=320"
  },
  {
    "text": "allowing your server to remain current on the transaction status. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=323"
  },
  {
    "text": "One scenario to highlight is when a customer's subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=327"
  },
  {
    "text": "failed to auto-renew, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=330"
  },
  {
    "text": "therefore it falls into what we call the billing retry state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=332"
  },
  {
    "text": "where we attempt to recover the subscription for up to 60 days. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=335"
  },
  {
    "text": "If you have opted in to the Billing grace period feature in App Store Connect, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=339"
  },
  {
    "text": "then subscribers in billing retry with grace period ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=343"
  },
  {
    "text": "would continue to have access to their subscription service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=346"
  },
  {
    "text": "while we attempt to recover their subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=348"
  },
  {
    "text": "And while they have still access to your service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=352"
  },
  {
    "text": "be sure to present them a simple call to action ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=354"
  },
  {
    "text": "to resolve their payment issue. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=357"
  },
  {
    "text": "To learn more about Billing retry and Billing grace period, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=359"
  },
  {
    "text": "check out our sessions links and resources ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=362"
  },
  {
    "text": "about reducing involuntary subscriber loss. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=364"
  },
  {
    "text": "The final core state is the inactive purchase or inactive subscriber. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=368"
  },
  {
    "text": "This state represents customers who previously made in-app purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=373"
  },
  {
    "text": "but are no longer entitled to that product or service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=377"
  },
  {
    "text": "due to expiry or if revoked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=380"
  },
  {
    "text": "These transactions are persistent and contain an original transaction ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=384"
  },
  {
    "text": "which allows you to maintain status across devices and platforms. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=388"
  },
  {
    "text": "For Subscriptions, inactive is determined by the expires date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=392"
  },
  {
    "text": "And for all in-app purchase types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=397"
  },
  {
    "text": "they can be inactive if there is a revocation date. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=398"
  },
  {
    "text": "This occurs when a transaction has been refunded ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=402"
  },
  {
    "text": "or if access granted through Family Sharing has been revoked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=404"
  },
  {
    "text": "For your inactive subscribers, due to expiration or revoked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=408"
  },
  {
    "text": "consider presenting subscription offers to win them back. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=412"
  },
  {
    "text": "And for those in the billing retry state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=416"
  },
  {
    "text": "don’t forget to present them that same call to action ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=418"
  },
  {
    "text": "to resolve their payment details. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=421"
  },
  {
    "text": "In review, here are the three core customer product states your app will use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=423"
  },
  {
    "text": "to proactively restore in-app purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=428"
  },
  {
    "text": "and tailor your app's experience to your customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=431"
  },
  {
    "text": "Let's see how these experiences look side-by-side with our Ocean Journal app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=435"
  },
  {
    "text": "New customers will see your latest product offering and introductory offers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=441"
  },
  {
    "text": "Your current active customers will have the feeling it just works, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=446"
  },
  {
    "text": "as your app has streamlined access to your products and services ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=449"
  },
  {
    "text": "on all of their devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=453"
  },
  {
    "text": "And for your inactive subscribers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=455"
  },
  {
    "text": "you can present them your latest win-back offers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=457"
  },
  {
    "text": "using offer codes or promotional offers.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=459"
  },
  {
    "text": "Okay, we’ve covered the three core customer product states, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=463"
  },
  {
    "text": "and how supporting these states alone is a huge win for your customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=467"
  },
  {
    "text": "But of course, there are opportunities to take the experience further. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=471"
  },
  {
    "text": "Your app could expand or refine the customer experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=474"
  },
  {
    "text": "to fit your product offering, business model, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=477"
  },
  {
    "text": "policies, and prioritizations. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=480"
  },
  {
    "text": "But here are few things to consider ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=482"
  },
  {
    "text": "when preparing to implement proactive restore into your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=484"
  },
  {
    "text": "If you support multiple products or subscription groups, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=489"
  },
  {
    "text": "the customer's state is determined for each product and each subscription group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=492"
  },
  {
    "text": "Therefore, you may need to account for hybrid states ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=498"
  },
  {
    "text": "or any other dependencies. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=500"
  },
  {
    "text": "Consider any off-platform activity ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=503"
  },
  {
    "text": "and how that factors into your customer's product state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=506"
  },
  {
    "text": "And be sure to check out App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=510"
  },
  {
    "text": "as these are critical to maintaining status, server-to-server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=513"
  },
  {
    "text": "for all in-app purchase types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=516"
  },
  {
    "text": "And with Version 2, the new notification types and subtypes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=519"
  },
  {
    "text": "support 28 unique events, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=523"
  },
  {
    "text": "sent securely to your server in near real time. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=525"
  },
  {
    "text": "Learn more about integrating or migrating to Version 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=528"
  },
  {
    "text": "in the session, \"Explore in-app purchase integration and migration.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=532"
  },
  {
    "text": "Alex and Gabriel also cover compatibility with StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=537"
  },
  {
    "text": "and the original StoreKit framework, and best practices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=540"
  },
  {
    "text": "We’ve talked through the customer product states to support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=544"
  },
  {
    "text": "and what that experience can be for your customers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=547"
  },
  {
    "text": "Now let’s walk through the implementation details. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=551"
  },
  {
    "text": "I’ll be using our SK Demo App ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=554"
  },
  {
    "text": "that we’ve updated with proactive restore using StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=556"
  },
  {
    "text": "Note that the SK Demo app will be available for download with this session. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=560"
  },
  {
    "text": "Let's review the SK Demo’s default experience for new customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=564"
  },
  {
    "text": "those without any active in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=568"
  },
  {
    "text": "To view our products, tap the “Shop” button, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=571"
  },
  {
    "text": "where up top we have our inventory of available cars ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=574"
  },
  {
    "text": "as non-consumable in-app purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=578"
  },
  {
    "text": "And then we have our navigation service as a monthly auto-renewable subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=581"
  },
  {
    "text": "which offers three different levels of service for customers to choose from. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=585"
  },
  {
    "text": "And down below, we have a non-renewing subscription option, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=590"
  },
  {
    "text": "providing one-time access. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=593"
  },
  {
    "text": "This covers our app's new customer experience, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=595"
  },
  {
    "text": "when no products have been purchased. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=598"
  },
  {
    "text": "Now let's look at how our app is able to determine ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=600"
  },
  {
    "text": "if the customer has current or past purchases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=603"
  },
  {
    "text": "It requires your app to execute three steps ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=607"
  },
  {
    "text": "immediately upon app launch. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=610"
  },
  {
    "text": "What is most important is that these steps are completed ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=612"
  },
  {
    "text": "before a \"Buy\" button is merchandised to the customer.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=615"
  },
  {
    "text": "The first step is your app will need to begin listening ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=619"
  },
  {
    "text": "for transactions from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=622"
  },
  {
    "text": "This is an App Store best practice, as transactions can show up at any time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=625"
  },
  {
    "text": "from features such as Family Sharing Ask to Buy, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=630"
  },
  {
    "text": "code redemptions, subscription auto-renewals, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=633"
  },
  {
    "text": "or when a purchase gets interrupted. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=635"
  },
  {
    "text": "In addition, your app can receive revoked transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=638"
  },
  {
    "text": "where access is lost due to a refund ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=642"
  },
  {
    "text": "or is no longer shared via Family sharing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=644"
  },
  {
    "text": "This will apply more in subsequent app launches, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=647"
  },
  {
    "text": "when access has already been granted ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=649"
  },
  {
    "text": "and their state is moving from active to inactive. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=652"
  },
  {
    "text": "If transactions are found, they are considered unfinished transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=656"
  },
  {
    "text": "and need to be validated, delivered to the customer, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=660"
  },
  {
    "text": "and marked as finished. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=663"
  },
  {
    "text": "This ensures your app won’t miss any transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=665"
  },
  {
    "text": "and delivers a great customer experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=668"
  },
  {
    "text": "Now let’s look at how our SK Demo app listens for transactions in StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=671"
  },
  {
    "text": "Here I’m using the function listenForTransactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=676"
  },
  {
    "text": "It will return any unfinished transactions or updates to a transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=678"
  },
  {
    "text": "for the signed-in App Store customer. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=683"
  },
  {
    "text": "For any transactions found, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=686"
  },
  {
    "text": "here, StoreKit 2 will verify the authenticity of these transactions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=688"
  },
  {
    "text": "And then, after my app delivers the content, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=692"
  },
  {
    "text": "grants access, or updates the customer product status, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=695"
  },
  {
    "text": "I will then finish the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=698"
  },
  {
    "text": "to indicate to the App Store that the purchase has been delivered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=700"
  },
  {
    "text": "Once a transaction is finished, it will no longer be returned to your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=704"
  },
  {
    "text": "on any device, via StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=708"
  },
  {
    "text": "That first step is critical for all apps ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=711"
  },
  {
    "text": "and will occur on every app launch going forward. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=714"
  },
  {
    "text": "Step 2 is determining that customer product state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=718"
  },
  {
    "text": "and this is done by proactively requesting the customer's active transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=721"
  },
  {
    "text": "using currentEntitlements. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=726"
  },
  {
    "text": "And specifically for auto-renewable subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=728"
  },
  {
    "text": "to account for the customer's renewal state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=731"
  },
  {
    "text": "such as cancelled, billing retry, or pending downgrades, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=733"
  },
  {
    "text": "you will additionally use Product.SubscriptionInfo.RenewalState. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=736"
  },
  {
    "text": "Let’s look at the SK Demo app and see how we accomplish this. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=742"
  },
  {
    "text": "This starts with the function, updateCustomerProductStatus, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=747"
  },
  {
    "text": "which keeps track of the customer's product states ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=750"
  },
  {
    "text": "for each of our persistent in-app purchase types. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=753"
  },
  {
    "text": "I then loop through each of the purchase types ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=757"
  },
  {
    "text": "using StoreKit 2’s currentEntitlements method. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=760"
  },
  {
    "text": "This returns transactions for products that the customer may be entitled to. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=764"
  },
  {
    "text": "And we record these transactions per product type. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=769"
  },
  {
    "text": "Here, for our non-consumables products, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=772"
  },
  {
    "text": "and here for our non-renewing subscription product. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=775"
  },
  {
    "text": "In order to determine if they are an active, or inactive subscriber, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=778"
  },
  {
    "text": "I’ve added additional logic to calculate an expiration date ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=783"
  },
  {
    "text": "for our non-renewing subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=786"
  },
  {
    "text": "And lastly, I will check for an active auto-renewable subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=789"
  },
  {
    "text": "and apply that state to the subscription group. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=794"
  },
  {
    "text": "To account for inactive states such as billing retry, expired, and revoked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=797"
  },
  {
    "text": "our variable subscription group status uses ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=802"
  },
  {
    "text": "Product.SubscriptionInfo.RenewalState ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=804"
  },
  {
    "text": "Now that we've retrieved the user's transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=809"
  },
  {
    "text": "and determined the customer status for each product or subscription group, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=811"
  },
  {
    "text": "our app has logic to personalize the app experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=815"
  },
  {
    "text": "for the various use cases. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=818"
  },
  {
    "text": "Let’s take a look at the SK Demo app source code. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=820"
  },
  {
    "text": "If no active transactions are determined ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=824"
  },
  {
    "text": "for all three in-app purchase product types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=827"
  },
  {
    "text": "the customer will then see the default new customer experience ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=829"
  },
  {
    "text": "that we reviewed earlier, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=832"
  },
  {
    "text": "where they will have a simple call to action to our \"Shop\" page. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=834"
  },
  {
    "text": "If the customer has any active purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=838"
  },
  {
    "text": "then upon app launch, they will see their purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=841"
  },
  {
    "text": "and update \"Buy\" buttons on all products accordingly. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=844"
  },
  {
    "text": "So here for non-consumables, we present what they’ve purchased ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=848"
  },
  {
    "text": "and the app either shows their purchased non-consumables, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=851"
  },
  {
    "text": "or the app provides a call to action ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=854"
  },
  {
    "text": "for the customer to visit the shop experience. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=856"
  },
  {
    "text": "For active products, here we handle if the customer is ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=859"
  },
  {
    "text": "an active subscriber of the navigation service ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=861"
  },
  {
    "text": "for non-renewable subscriptions and auto-renewable subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=865"
  },
  {
    "text": "And in our last portion, we account for inactive subscribers. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=869"
  },
  {
    "text": "Those with subscriptions that have expired, been revoked, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=872"
  },
  {
    "text": "or are in the billing retry state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=875"
  },
  {
    "text": "Okay, let's now go to the SK Demo app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=878"
  },
  {
    "text": "We want to simulate an active customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=881"
  },
  {
    "text": "for both a non-consumable and auto-renewable subscription. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=884"
  },
  {
    "text": "So if I purchase the race car and subscribe to the pro navigation, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=888"
  },
  {
    "text": "the demo app will apply green checkmarks ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=892"
  },
  {
    "text": "to indicate the app has confirmed those purchases were successful, verified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=894"
  },
  {
    "text": "and has enabled them. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=899"
  },
  {
    "text": "With these purchases, my customer product state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=901"
  },
  {
    "text": "for the non-consumable is purchased. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=903"
  },
  {
    "text": "And for our subscription, I’m an active subscriber. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=906"
  },
  {
    "text": "Now, if I install the app on a new device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=910"
  },
  {
    "text": "when I launch the SK Demo app for the first time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=912"
  },
  {
    "text": "it will proactively perform steps one, two, and three. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=915"
  },
  {
    "text": "Here you see our demo app has proactively restored access to both of my purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=919"
  },
  {
    "text": "without any action from me. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=924"
  },
  {
    "text": "As this is a demo app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=926"
  },
  {
    "text": "that is the extent of products being delivered. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=927"
  },
  {
    "text": "But in your app, this process would ensure these active customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=930"
  },
  {
    "text": "are not offered products to purchase that they already own, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=933"
  },
  {
    "text": "and that those products and services are enabled for them automatically.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=937"
  },
  {
    "text": "For your current customers, this is great. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=941"
  },
  {
    "text": "No need to require customers to sign-in or tap \"Restore Purchases.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=944"
  },
  {
    "text": "It just worked. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=948"
  },
  {
    "text": "Your app can use the APIs and data readily available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=949"
  },
  {
    "text": "So we’ve covered the three steps to do this with StoreKit 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=953"
  },
  {
    "text": "Now I want to discuss how to implement this same experience for your customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=957"
  },
  {
    "text": "on previous versions of iOS ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=961"
  },
  {
    "text": "where you cannot leverage the power of StoreKit 2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=963"
  },
  {
    "text": "With original StoreKit, you will perform the same steps as StoreKit 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=966"
  },
  {
    "text": "to determine the customer product state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=970"
  },
  {
    "text": "by proactively restoring in-app purchases on iOS 7 or later. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=972"
  },
  {
    "text": "To do this, it will require your server to use the verifyReceipt endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=977"
  },
  {
    "text": "to validate and retrieve the latest transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=982"
  },
  {
    "text": "in order to determine customer's product state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=985"
  },
  {
    "text": "The app receipt is present on-device when an app is installed from App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=989"
  },
  {
    "text": "But keep in mind, when testing with Sandbox or TestFlight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=994"
  },
  {
    "text": "the app receipt is only present ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=998"
  },
  {
    "text": "after an in-app purchase has been completed or restored. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=999"
  },
  {
    "text": "If your app finds no app receipt present, this should only occur in Sandbox ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1003"
  },
  {
    "text": "and your app can consider this scenario the same as a new customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1008"
  },
  {
    "text": "where no in-app purchases are found. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1012"
  },
  {
    "text": "An app receipt created in the past is sufficient ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1015"
  },
  {
    "text": "to retrieve the latest transactions from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1018"
  },
  {
    "text": "Therefore, no customer actions like a \"Restore Purchase,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1021"
  },
  {
    "text": "or receiptRefresh are necessary. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1024"
  },
  {
    "text": "Just include the shared secret with your request to verifyReceipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1026"
  },
  {
    "text": "in order to receive transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1030"
  },
  {
    "text": "for non-consumables, non-renewing subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1033"
  },
  {
    "text": "and auto-renewable subscriptions. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1036"
  },
  {
    "text": "Let’s look back at the three implementation steps we reviewed earlier. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1039"
  },
  {
    "text": "The difference lies within Step 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1043"
  },
  {
    "text": "where you identify the customer's product state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1045"
  },
  {
    "text": "How we determine customer product state starts with the app receipt on device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1049"
  },
  {
    "text": "that, in turn, your server validates with the App Store verifyReceipt endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1054"
  },
  {
    "text": "Let’s look at this process. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1059"
  },
  {
    "text": "First, we need to retrieve the App Receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1061"
  },
  {
    "text": "and be sure you are using the appStoreReceiptURL property, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1064"
  },
  {
    "text": "as you can see in this sample from our developer documentation. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1068"
  },
  {
    "text": "With the app receipt, let’s see how this is sent from the device ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1072"
  },
  {
    "text": "to your server and the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1076"
  },
  {
    "text": "Your app on a device is here on the left. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1080"
  },
  {
    "text": "it will first, retrieve the app receipt, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1082"
  },
  {
    "text": "and send it to your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1085"
  },
  {
    "text": "then validate it with the App Store verifyReceipt endpoint. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1088"
  },
  {
    "text": "From that response, you will determine customer product state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1092"
  },
  {
    "text": "and send those states to your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1096"
  },
  {
    "text": "To determine customer product state, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1099"
  },
  {
    "text": "we used the Entitlement Engine ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1102"
  },
  {
    "text": "from WWDC2020. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1103"
  },
  {
    "text": "It’s updated to support non-consumables and non-renewing subscriptions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1106"
  },
  {
    "text": "and now handles the new customer state when there are no in-app purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1111"
  },
  {
    "text": "To learn more about using our Entitlement Engine, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1116"
  },
  {
    "text": "I encourage you to check out the \"Architecting for subscriptions\" session ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1119"
  },
  {
    "text": "and download the sample project. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1123"
  },
  {
    "text": "You can find links to this session and more with this video’s resources.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1125"
  },
  {
    "text": "That completes Step 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1130"
  },
  {
    "text": "where your app will receive the customer product state from your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1132"
  },
  {
    "text": "Now your app will personalize the app experience immediately on launch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1136"
  },
  {
    "text": "using the StoreKit 2 and original StoreKit frameworks. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1140"
  },
  {
    "text": "I want to share some final best practices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1145"
  },
  {
    "text": "First, continue providing a \"Restore Purchases\" button within your app. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1148"
  },
  {
    "text": "While not used often, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1152"
  },
  {
    "text": "it does give customers an opportunity to force an app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1153"
  },
  {
    "text": "to restore their Apple ID’s transactions in case of an issue ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1156"
  },
  {
    "text": "or if the customer uses a different Apple ID. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1160"
  },
  {
    "text": "When your app first proactively restores a customer's in-app purchases on a device, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1164"
  },
  {
    "text": "it’s recommended to optimize your app and store data securely ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1169"
  },
  {
    "text": "to assist in determining customer product state. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1173"
  },
  {
    "text": "CloudKit is a feature to consider with its flexibility, security, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1176"
  },
  {
    "text": "and ability to sync across a customer's devices. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1180"
  },
  {
    "text": "Testing your implementation is critical when using StoreKit. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1185"
  },
  {
    "text": "And with StoreKit 2, you can test your proactive restore implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1188"
  },
  {
    "text": "with Sandbox, TestFlight and Xcode StoreKit testing. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1192"
  },
  {
    "text": "And if you are using original StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1197"
  },
  {
    "text": "it’s important to remember an app receipt may not be present ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1199"
  },
  {
    "text": "when testing in Sandbox and TestFlight, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1203"
  },
  {
    "text": "while it is always present when the app is installed from the App Store. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1206"
  },
  {
    "text": "If an app receipt isn’t present, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1210"
  },
  {
    "text": "it is suggested your app uses its default new customer experience, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1211"
  },
  {
    "text": "and ensure you have a Restore Purchases button readily available. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1216"
  },
  {
    "text": "In conclusion, update your app to proactively check for purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1220"
  },
  {
    "text": "without any customer action, no taps or authentication. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1223"
  },
  {
    "text": "Allow your app to tailor the customer's experience immediately at launch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1228"
  },
  {
    "text": "to fit your new, active, and inactive customers' product states. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1233"
  },
  {
    "text": "Maintain status on all your customer's transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1238"
  },
  {
    "text": "server to server, for all in-app purchase types, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1242"
  },
  {
    "text": "by implementing App Store Server Notifications Version 2. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1245"
  },
  {
    "text": "This enables your backend to know in near real-time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1249"
  },
  {
    "text": "any change that has occurred with a transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1252"
  },
  {
    "text": "such as refunds, or revoked transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1255"
  },
  {
    "text": "or subscription renewals, billing retry, and expirations.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1258"
  },
  {
    "text": "Thank you for watching, and be sure to check out ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1263"
  },
  {
    "text": "this additional session, \"What's new with in-app purchases”, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1265"
  },
  {
    "text": "where Dani and Ian will tell you about all the great updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1269"
  },
  {
    "text": "to StoreKit, the Server API, and Server Notifications Version 2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1271"
  },
  {
    "text": "Thank you. Take care. ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1276"
  },
  {
    "text": "♪ ♪",
    "link": "https://developer.apple.com/videos/play/wwdc2022-110404/?time=1278"
  }
]