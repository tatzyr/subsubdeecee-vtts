[
  {
    "text": "♪ Mellow instrumental hip-hop music ♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=0"
  },
  {
    "text": "♪ ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=3"
  },
  {
    "text": "Dani Chootong: Hello, and welcome to ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=9"
  },
  {
    "text": "\"What's new with in-app purchase.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=10"
  },
  {
    "text": "I'm Dani, and I'm an engineer on the StoreKit team.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=13"
  },
  {
    "text": "Today I'll be presenting with my colleague Ian, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=16"
  },
  {
    "text": "and we'll be going over the new improvements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=19"
  },
  {
    "text": "we're bringing to in-app purchase this year.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=20"
  },
  {
    "text": "Last year, we introduced StoreKit 2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=23"
  },
  {
    "text": "a set of new APIs designed from the ground up ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=26"
  },
  {
    "text": "to make it simple to integrate in-app purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=29"
  },
  {
    "text": "StoreKit 2 uses modern language features, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=32"
  },
  {
    "text": "including Swift concurrency using the async/await pattern.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=34"
  },
  {
    "text": "On the server side, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=38"
  },
  {
    "text": "we complemented these new StoreKit features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=39"
  },
  {
    "text": "with an entirely new set of App Store Server endpoints.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=41"
  },
  {
    "text": "These server endpoints make it easy to retrieve ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=45"
  },
  {
    "text": "transaction information and check subscription status ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=47"
  },
  {
    "text": "on your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=49"
  },
  {
    "text": "We also released Version 2 of App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=52"
  },
  {
    "text": "to make tracking the subscription lifecycle ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=55"
  },
  {
    "text": "on your server easier than ever.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=57"
  },
  {
    "text": "Today I'll be going over these new APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=60"
  },
  {
    "text": "as well as enhancements we're bringing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=62"
  },
  {
    "text": "to the new StoreKit models.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=64"
  },
  {
    "text": "Then, Ian will walk you through ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=67"
  },
  {
    "text": "some exciting new server updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=69"
  },
  {
    "text": "including App Store Server API enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=71"
  },
  {
    "text": "and brand-new APIs for App Store Server Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=73"
  },
  {
    "text": "First, I'll go over the new App Transaction API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=77"
  },
  {
    "text": "for verifying the purchase of your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=80"
  },
  {
    "text": "Next, I'll dig into some new properties we've added ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=83"
  },
  {
    "text": "to our StoreKit models.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=86"
  },
  {
    "text": "I'll introduce you to the new SwiftUI friendly APIs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=88"
  },
  {
    "text": "for redeeming subscription offer codes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=92"
  },
  {
    "text": "and asking a customer to review your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=94"
  },
  {
    "text": "Then, I'll introduce you to StoreKit Messages, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=97"
  },
  {
    "text": "an API used to display ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=99"
  },
  {
    "text": "App Store messages to your customers.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=101"
  },
  {
    "text": "And finally, I'll go over an enhancement we're adding ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=104"
  },
  {
    "text": "to preserve Application Username when you're migrating ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=106"
  },
  {
    "text": "from the original to the modern StoreKit APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=109"
  },
  {
    "text": "Throughout this presentation, I'll be using my favorite app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=112"
  },
  {
    "text": "Food Truck.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=115"
  },
  {
    "text": "In the Food Truck app, I manage a pop-up donut food truck ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=117"
  },
  {
    "text": "that visits various cities to make donut deliveries.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=119"
  },
  {
    "text": "So, let's get started! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=122"
  },
  {
    "text": "Meet App Transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=125"
  },
  {
    "text": "The App Transaction is our new API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=126"
  },
  {
    "text": "for verifying the purchase of your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=129"
  },
  {
    "text": "The App Transaction represents the signed information ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=132"
  },
  {
    "text": "for the purchase of your app for the device it's running on.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=134"
  },
  {
    "text": "It's signed using JWS, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=138"
  },
  {
    "text": "and it replaces the app detail portion of the app receipt ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=141"
  },
  {
    "text": "from the original StoreKit API.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=144"
  },
  {
    "text": "Just like transaction verification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=147"
  },
  {
    "text": "StoreKit performs automatic verification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=149"
  },
  {
    "text": "of the app transaction for you.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=151"
  },
  {
    "text": "However, if you wish, you can also perform ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=154"
  },
  {
    "text": "your own validation.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=157"
  },
  {
    "text": "Validating a JWS signature is a well-documented standard.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=159"
  },
  {
    "text": "You can refer to the public documentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=163"
  },
  {
    "text": "to implement your own validation.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=165"
  },
  {
    "text": "StoreKit takes care of automatically updating ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=168"
  },
  {
    "text": "the App Transaction when necessary.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=170"
  },
  {
    "text": "However, in the rare case that the user ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=172"
  },
  {
    "text": "thinks there's something wrong, it can be refreshed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=174"
  },
  {
    "text": "You should provide UI in your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=177"
  },
  {
    "text": "to allow your customers to refresh the app transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=179"
  },
  {
    "text": "This should only be used in response to user action, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=183"
  },
  {
    "text": "as refreshing the App Transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=186"
  },
  {
    "text": "prompts the user to authenticate.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=187"
  },
  {
    "text": "Preventing fraud isn't the only reason to love App Transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=191"
  },
  {
    "text": "If you're looking to switch business models from a paid app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=195"
  },
  {
    "text": "to a free app that offers in-app purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=198"
  },
  {
    "text": "if you're curious about which of your customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=201"
  },
  {
    "text": "preordered your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=203"
  },
  {
    "text": "or even if you just want to know when your app was purchased, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=205"
  },
  {
    "text": "these are all situations you can handle with App Transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=207"
  },
  {
    "text": "In the app receipt, the receipt payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=211"
  },
  {
    "text": "combine the purchase data about your application ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=213"
  },
  {
    "text": "along with all the in-app purchases that have occurred.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=216"
  },
  {
    "text": "These are now broken up into two separate components ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=219"
  },
  {
    "text": "in StoreKit.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=221"
  },
  {
    "text": "The first of these is the Transaction History.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=223"
  },
  {
    "text": "StoreKit's transaction APIs give you insight ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=226"
  },
  {
    "text": "into the user's entire in-app purchase history, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=228"
  },
  {
    "text": "right on the device.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=231"
  },
  {
    "text": "These APIs allow you to find the exact information you need, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=232"
  },
  {
    "text": "including the user's latest transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=236"
  },
  {
    "text": "unfinished transactions, and current entitlements.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=238"
  },
  {
    "text": "If you prefer to perform these calculations on your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=242"
  },
  {
    "text": "you can also get the user's purchase history ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=245"
  },
  {
    "text": "from the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=247"
  },
  {
    "text": "Ian will have some exciting updates on this ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=249"
  },
  {
    "text": "later this session.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=251"
  },
  {
    "text": "And the second component is the App Transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=253"
  },
  {
    "text": "which contains the data you need to make sure ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=256"
  },
  {
    "text": "that your app is valid for the device it's running on.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=258"
  },
  {
    "text": "It's easy to verify the purchase of your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=260"
  },
  {
    "text": "using App Transaction, and in just a moment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=263"
  },
  {
    "text": "I'll be going over an example of how you can use it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=265"
  },
  {
    "text": "But first, let me give you some background ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=268"
  },
  {
    "text": "about my favorite app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=270"
  },
  {
    "text": "With Food Truck, I'm able to make donut deliveries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=272"
  },
  {
    "text": "check in on a basic social feed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=274"
  },
  {
    "text": "and visualize my sales history.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=276"
  },
  {
    "text": "Keeping all this information in a database ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=279"
  },
  {
    "text": "is an ongoing cost for my app, so to help me cover the costs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=281"
  },
  {
    "text": "I'm going to turn the yearly sales history chart ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=285"
  },
  {
    "text": "into a onetime purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=287"
  },
  {
    "text": "Additionally, I want to enhance the social feed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=289"
  },
  {
    "text": "So instead of just seeing what others are saying ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=292"
  },
  {
    "text": "about my food truck, I want to provide the tools ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=294"
  },
  {
    "text": "so I can engage with my customers as well.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=296"
  },
  {
    "text": "This will be a subscription service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=299"
  },
  {
    "text": "and I'll have a monthly and a yearly plan.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=300"
  },
  {
    "text": "Food Truck began as a paid app, but I'm going to make the switch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=304"
  },
  {
    "text": "to a free app that offers in-app purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=307"
  },
  {
    "text": "But I don't want my existing customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=310"
  },
  {
    "text": "who already purchased Food Truck to feel left out.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=311"
  },
  {
    "text": "So, I'll be using the App Transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=315"
  },
  {
    "text": "to make sure that the customers who purchased Food Truck ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=317"
  },
  {
    "text": "continue to have access to the premium content they paid for.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=320"
  },
  {
    "text": "Here's the timeline for Food Truck.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=324"
  },
  {
    "text": "At the initial release, Food Truck started out ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=326"
  },
  {
    "text": "as a paid app that cost $4.99.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=329"
  },
  {
    "text": "Version 1.0 offered donut deliveries, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=331"
  },
  {
    "text": "a basic social feed, and sales history charts.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=334"
  },
  {
    "text": "Later, at the release of version 8.0, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=337"
  },
  {
    "text": "my business model changed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=339"
  },
  {
    "text": "Food Truck is now free, but includes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=342"
  },
  {
    "text": "a variety of in-app purchases which unlock premium features.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=343"
  },
  {
    "text": "The yearly sales history chart is now a nonconsumable ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=347"
  },
  {
    "text": "onetime purchase, and now there's ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=350"
  },
  {
    "text": "a new subscription service for a premium social feed ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=352"
  },
  {
    "text": "that gives you advanced engagement tools.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=355"
  },
  {
    "text": "Now let's take a look at two different types of customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=358"
  },
  {
    "text": "who might be affected by this.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=360"
  },
  {
    "text": "Alice found out about my Food Truck app in version 2.5, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=363"
  },
  {
    "text": "and she decided she wants to share her passion for donuts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=366"
  },
  {
    "text": "in the digital world.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=369"
  },
  {
    "text": "So, she purchased my app for $4.99 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=371"
  },
  {
    "text": "and began her donut delivery journey.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=373"
  },
  {
    "text": "A second customer, Bob, finds out about my Food Truck app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=376"
  },
  {
    "text": "though a friend and downloads it for free ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=379"
  },
  {
    "text": "in the App Store in version 8.2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=381"
  },
  {
    "text": "In this scenario, Alice, who purchased my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=383"
  },
  {
    "text": "before it became free, should still have access ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=386"
  },
  {
    "text": "to all the premium content she already paid for.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=388"
  },
  {
    "text": "She still has the option to purchase the premium ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=393"
  },
  {
    "text": "social feed subscription, but I don't want to deny her ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=395"
  },
  {
    "text": "the yearly sales history chart that was initially included.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=397"
  },
  {
    "text": "Bob, however, got my app for free.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=402"
  },
  {
    "text": "I know then not to unlock features and content ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=404"
  },
  {
    "text": "until they complete the in-app purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=407"
  },
  {
    "text": "So, let's see how we can achieve this ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=409"
  },
  {
    "text": "with App Transaction in code.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=411"
  },
  {
    "text": "I'll start off by fetching the app transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=413"
  },
  {
    "text": "by calling AppTransaction.shared.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=415"
  },
  {
    "text": "This call gets me a VerificationResult ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=419"
  },
  {
    "text": "containing my app transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=421"
  },
  {
    "text": "Within the result, the AppTransaction type ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=423"
  },
  {
    "text": "contains the JWS payload.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=425"
  },
  {
    "text": "Next, I'll switch on the result.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=429"
  },
  {
    "text": "If the result is unverified, this would be a good time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=431"
  },
  {
    "text": "to alert the user that their app purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=434"
  },
  {
    "text": "could not be verified by the App Store, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=436"
  },
  {
    "text": "and then, I can prompt them to refresh the app transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=438"
  },
  {
    "text": "At this time, I'll offer a minimal experience for my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=442"
  },
  {
    "text": "If the result is verified, I'm going to use this as ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=446"
  },
  {
    "text": "an opportunity to check whether the user has purchased my app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=448"
  },
  {
    "text": "Customers that purchased my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=451"
  },
  {
    "text": "should be granted the services they paid for.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=453"
  },
  {
    "text": "For this, I'll use the original app version property.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=456"
  },
  {
    "text": "This property lets me know the app version in which ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=459"
  },
  {
    "text": "the customer had downloaded my app for the very first time.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=461"
  },
  {
    "text": "Version 8.0 is the version in which my app became free ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=466"
  },
  {
    "text": "with in-app purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=469"
  },
  {
    "text": "I'm going to pass the customer's original app version ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=471"
  },
  {
    "text": "to my function which checks if the user purchased my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=473"
  },
  {
    "text": "before version 8.0.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=477"
  },
  {
    "text": "And with that, I can make an informed decision about ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=478"
  },
  {
    "text": "how I should go about providing premium content to my users.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=481"
  },
  {
    "text": "For customers like Alice, who purchased my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=485"
  },
  {
    "text": "I'm going to provide the content the user is entitled to ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=488"
  },
  {
    "text": "that they had at the time of purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=490"
  },
  {
    "text": "In my case, I'm going to unlock the yearly sales history chart ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=493"
  },
  {
    "text": "for her deliveries.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=495"
  },
  {
    "text": "Also, I want to check any additional in-app purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=498"
  },
  {
    "text": "they may have made so I can provide that as well.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=500"
  },
  {
    "text": "Otherwise, I can be confident that the user downloaded my app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=505"
  },
  {
    "text": "after I switched my business model, like Bob.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=507"
  },
  {
    "text": "This can be a good time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=511"
  },
  {
    "text": "to check the user's current entitlements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=512"
  },
  {
    "text": "so I can unlock the features and content they paid for.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=513"
  },
  {
    "text": "And with just a few lines of code, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=517"
  },
  {
    "text": "I was able to verify the purchase of my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=519"
  },
  {
    "text": "check whether the user downloaded ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=521"
  },
  {
    "text": "the paid version of my app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=523"
  },
  {
    "text": "and I can immediately start providing my premium content, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=524"
  },
  {
    "text": "whether the customer purchased my app or not.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=527"
  },
  {
    "text": "With App Transaction, you can easily support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=532"
  },
  {
    "text": "your customers whether they're early supporters ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=534"
  },
  {
    "text": "or if they've just recently downloaded your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=536"
  },
  {
    "text": "Now I'd like to move on to the new properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=539"
  },
  {
    "text": "we're adding to our StoreKit models.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=541"
  },
  {
    "text": "The first of these properties is the price locale.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=544"
  },
  {
    "text": "The price locale is now included in StoreKit products.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=547"
  },
  {
    "text": "You may already be familiar with price locale ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=550"
  },
  {
    "text": "from interfacing with our original purchase APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=552"
  },
  {
    "text": "Next, I'll dig into the server environment property.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=556"
  },
  {
    "text": "Now, you can tell the server environment ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=559"
  },
  {
    "text": "a transaction or renewal info occurred in.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=561"
  },
  {
    "text": "Then, I'll move onto the recent subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=565"
  },
  {
    "text": "start date property.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=567"
  },
  {
    "text": "You can use this as a tool to make informed decisions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=568"
  },
  {
    "text": "for your customers based on their subscription patterns.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=571"
  },
  {
    "text": "And lastly, I'll go over some special considerations ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=575"
  },
  {
    "text": "for these properties when you're using them ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=577"
  },
  {
    "text": "with StoreKit Testing in Xcode.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=579"
  },
  {
    "text": "These properties return sentinel values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=581"
  },
  {
    "text": "in older operating systems, and I'll explain what this means ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=583"
  },
  {
    "text": "in just a bit.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=586"
  },
  {
    "text": "The StoreKit APIs were designed with flexibility in mind, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=588"
  },
  {
    "text": "so I'm proud to announce ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=591"
  },
  {
    "text": "that you can take advantage of these new properties ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=593"
  },
  {
    "text": "on devices as far back as last year's operating systems, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=595"
  },
  {
    "text": "even though they did not originally ship with them.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=598"
  },
  {
    "text": "All you'll need to make this happen is to use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=601"
  },
  {
    "text": "Xcode 14 to build your app, and you'll have access ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=604"
  },
  {
    "text": "to these properties in the previous operating systems.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=607"
  },
  {
    "text": "This is possible because the implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=610"
  },
  {
    "text": "for these properties are compiled into your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=612"
  },
  {
    "text": "so when your customers update to the new version, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=614"
  },
  {
    "text": "they'll be able to get the benefits of these enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=616"
  },
  {
    "text": "without needing to update their operating system.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=619"
  },
  {
    "text": "There is one thing to keep in mind ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=621"
  },
  {
    "text": "when using these properties, though.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=623"
  },
  {
    "text": "These properties will return sentinel values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=626"
  },
  {
    "text": "when you're using StoreKit testing in Xcode ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=628"
  },
  {
    "text": "in these older operating systems.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=630"
  },
  {
    "text": "When I say sentinel values, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=632"
  },
  {
    "text": "I'm referring to placeholder values that signal ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=633"
  },
  {
    "text": "that these are not real values you should work with, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=636"
  },
  {
    "text": "and I'll explain why this occurs.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=638"
  },
  {
    "text": "The sandbox and production environments ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=641"
  },
  {
    "text": "make use of these properties by extracting the values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=643"
  },
  {
    "text": "from the App Store server response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=645"
  },
  {
    "text": "StoreKit testing in Xcode, however, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=648"
  },
  {
    "text": "is a local testing environment that operates independently ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=650"
  },
  {
    "text": "from the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=652"
  },
  {
    "text": "This means we're not able to backport the value of these ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=654"
  },
  {
    "text": "properties to the previous operating systems there.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=657"
  },
  {
    "text": "You can easily get around this limitation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=660"
  },
  {
    "text": "by updating your test device to a new operating system, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=662"
  },
  {
    "text": "and you'll be all set to test these values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=665"
  },
  {
    "text": "in the local environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=667"
  },
  {
    "text": "Let's discuss some situations that demonstrate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=668"
  },
  {
    "text": "how you can start using these new properties, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=670"
  },
  {
    "text": "the first of which is price locale.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=673"
  },
  {
    "text": "StoreKit products already have a display price property ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=675"
  },
  {
    "text": "to label the purchase price, but with price locale, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=678"
  },
  {
    "text": "you can format numbers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=681"
  },
  {
    "text": "deriving from the product's decimal price.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=682"
  },
  {
    "text": "If you have a yearly subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=685"
  },
  {
    "text": "you might use this as an opportunity ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=687"
  },
  {
    "text": "to show your customers how much it would cost them per month.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=689"
  },
  {
    "text": "In this example, you can see that the yearly subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=692"
  },
  {
    "text": "amounts to $4.17 per month.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=695"
  },
  {
    "text": "Or perhaps you'd want to show them ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=698"
  },
  {
    "text": "how much they would save if they purchased your yearly service ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=700"
  },
  {
    "text": "over your monthly service.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=702"
  },
  {
    "text": "With this information, your customers can make ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=704"
  },
  {
    "text": "informed decisions when they're considering ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=706"
  },
  {
    "text": "your purchase options.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=708"
  },
  {
    "text": "Now, let's move on to the environment property.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=711"
  },
  {
    "text": "The environment property is available ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=714"
  },
  {
    "text": "in the Transaction and renewal Info.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=715"
  },
  {
    "text": "This property tells you the server environment ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=717"
  },
  {
    "text": "in which the transaction or renewal info originated in, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=719"
  },
  {
    "text": "which could be Xcode, sandbox, or production.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=722"
  },
  {
    "text": "Your app may communicate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=726"
  },
  {
    "text": "transaction information to your server after a customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=727"
  },
  {
    "text": "makes a purchase for bookkeeping and analytics.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=729"
  },
  {
    "text": "When your app generates these transactions, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=733"
  },
  {
    "text": "it could be from any one of these server environments.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=735"
  },
  {
    "text": "Like most of you, I don't want to add noise ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=738"
  },
  {
    "text": "to my analytics with irrelevant test data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=739"
  },
  {
    "text": "So, knowing the environment can help you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=742"
  },
  {
    "text": "filter out unnecessary information from being sent up ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=745"
  },
  {
    "text": "to your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=747"
  },
  {
    "text": "Finally, let's take a look at ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=749"
  },
  {
    "text": "the recent subscription start date.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=750"
  },
  {
    "text": "The recent subscription start date is available ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=752"
  },
  {
    "text": "within a product's subscription information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=754"
  },
  {
    "text": "and it represents the most recent period ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=757"
  },
  {
    "text": "of continuous subscription.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=759"
  },
  {
    "text": "A subscription is considered continuous if there is no more ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=761"
  },
  {
    "text": "than a 60-day gap between any two subscribed periods.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=764"
  },
  {
    "text": "Keep in mind that this period can contain gaps ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=768"
  },
  {
    "text": "where the customer was not subscribed to your product, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=770"
  },
  {
    "text": "so don't use this as an indicator ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=773"
  },
  {
    "text": "for the number of days a customer has been subscribed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=774"
  },
  {
    "text": "The recent subscription start date can help you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=779"
  },
  {
    "text": "determine a pattern of loyalty between you and your customers.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=781"
  },
  {
    "text": "For your loyal customers, you might offer them a reward ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=785"
  },
  {
    "text": "as a way to keep them engaged with your product.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=787"
  },
  {
    "text": "Or if you notice that a customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=790"
  },
  {
    "text": "has unsubscribed from your service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=792"
  },
  {
    "text": "you can use it as a chance to win back a lapsed customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=794"
  },
  {
    "text": "by offering them an incentive to start using your product again.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=796"
  },
  {
    "text": "I mentioned earlier that we'd take a closer look ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=801"
  },
  {
    "text": "at the sentinel values for these properties.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=803"
  },
  {
    "text": "As a reminder, when I say sentinel values, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=806"
  },
  {
    "text": "I'm referring to placeholder values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=808"
  },
  {
    "text": "that serve as an indicator of the absence of a real value.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=810"
  },
  {
    "text": "The sentinel values for these properties are easy to identify.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=814"
  },
  {
    "text": "When you're dealing with price locale, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=818"
  },
  {
    "text": "the sentinel value is a locale with the identifier xx_XX.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=819"
  },
  {
    "text": "For the environment property, it'll be an empty string.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=825"
  },
  {
    "text": "And finally, for the recent subscription start date, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=829"
  },
  {
    "text": "this value is Date.distantPast.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=831"
  },
  {
    "text": "Luckily, the occurrence of these sentinel values ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=834"
  },
  {
    "text": "are predictable -- you'll only encounter them ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=836"
  },
  {
    "text": "if you're using StoreKit testing in Xcode ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=838"
  },
  {
    "text": "in older operating systems, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=840"
  },
  {
    "text": "and you can get around this by updating your test device.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=842"
  },
  {
    "text": "So now you've seen the enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=845"
  },
  {
    "text": "we've made to our StoreKit models.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=847"
  },
  {
    "text": "And my favorite part is, they're backward compatible ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=849"
  },
  {
    "text": "all the way back to the operating system ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=851"
  },
  {
    "text": "in which the models were introduced, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=853"
  },
  {
    "text": "so your customers can see the benefits right away ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=855"
  },
  {
    "text": "just by updating your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=857"
  },
  {
    "text": "When you perform arithmetic with price values, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=859"
  },
  {
    "text": "the price locale helps you correctly format it ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=862"
  },
  {
    "text": "so that it matches the App Store's locale.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=864"
  },
  {
    "text": "For transactions and subscription information, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=866"
  },
  {
    "text": "the environment tells you exactly ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=869"
  },
  {
    "text": "where they originated from, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=870"
  },
  {
    "text": "so if you store this data on your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=872"
  },
  {
    "text": "you can act on it accordingly depending on the environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=873"
  },
  {
    "text": "The recent subscription start date helps you understand ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=877"
  },
  {
    "text": "customer loyalty, so you can tailor specific offers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=880"
  },
  {
    "text": "to long-time customers, or maybe you can provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=882"
  },
  {
    "text": "an incentive for customers who have unsubscribed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=885"
  },
  {
    "text": "And in case you were wondering, yes, the environment ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=889"
  },
  {
    "text": "and recent subscription start date are also available ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=892"
  },
  {
    "text": "via App Store Server API and App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=895"
  },
  {
    "text": "which Ian will discuss.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=899"
  },
  {
    "text": "Now I'd like talk about the new SwiftUI APIs we're providing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=901"
  },
  {
    "text": "for redeeming offer codes and requesting a review.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=904"
  },
  {
    "text": "Offer codes can help you acquire, retain, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=908"
  },
  {
    "text": "and win back subscribers by providing subscriptions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=911"
  },
  {
    "text": "at a discount or free for a limited time.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=914"
  },
  {
    "text": "Now in App Store Connect, you can create uniquely named ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=916"
  },
  {
    "text": "custom codes.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=919"
  },
  {
    "text": "There, you can set a maximum redemption limit ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=920"
  },
  {
    "text": "and you can choose whether or not to set an expiration.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=923"
  },
  {
    "text": "Let's look at the SwiftUI implementation to present ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=926"
  },
  {
    "text": "an offer code redemption sheet straight from your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=928"
  },
  {
    "text": "Here, I've got a SwiftUI view ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=932"
  },
  {
    "text": "with a button to trigger the offer code redeem sheet.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=934"
  },
  {
    "text": "The offer code redemption sheet ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=936"
  },
  {
    "text": "now has its own view modifier in SwiftUI.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=938"
  },
  {
    "text": "The view modifier is easy to use, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=942"
  },
  {
    "text": "it just needs a binding Boolean to start the process.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=944"
  },
  {
    "text": "And once the offer code sheet is dismissed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=947"
  },
  {
    "text": "you'll get a result representing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=949"
  },
  {
    "text": "whether or not the sheet presented successfully.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=951"
  },
  {
    "text": "When a customer redeems an offer code for your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=954"
  },
  {
    "text": "the resulting transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=957"
  },
  {
    "text": "is sent to the transaction listener.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=958"
  },
  {
    "text": "So, be sure to set up a transaction listener ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=962"
  },
  {
    "text": "as soon as your app launches to receive new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=964"
  },
  {
    "text": "and updated transactions while your app is running.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=966"
  },
  {
    "text": "The offer code view modifier is available starting on iOS 16.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=969"
  },
  {
    "text": "Next, I'd like to talk about updates to request review.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=974"
  },
  {
    "text": "Getting customer feedback is important.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=978"
  },
  {
    "text": "Potential new customers might use reviews ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=981"
  },
  {
    "text": "as a deciding factor in their decision to download your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=983"
  },
  {
    "text": "Others might want to leave a review as a way to provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=987"
  },
  {
    "text": "feedback or suggestions.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=989"
  },
  {
    "text": "Either way, we want to give you the tools to make it easy ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=992"
  },
  {
    "text": "for you to request a rating from your customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=994"
  },
  {
    "text": "so you can let them know you're listening ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=997"
  },
  {
    "text": "and you can continue engaging with them.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=999"
  },
  {
    "text": "Let's review the code.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1001"
  },
  {
    "text": "Here I have a very simple view ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1004"
  },
  {
    "text": "to demonstrate the Request Review APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1005"
  },
  {
    "text": "In SwiftUI, there's now an environment value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1008"
  },
  {
    "text": "called requestReview.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1010"
  },
  {
    "text": "You can use this value to get an instance ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1012"
  },
  {
    "text": "of the RequestReviewAction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1014"
  },
  {
    "text": "and when you're ready to request a rating, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1016"
  },
  {
    "text": "simply call the instance as a function ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1018"
  },
  {
    "text": "to request to display the review prompt.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1020"
  },
  {
    "text": "You can decide the right time to request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1023"
  },
  {
    "text": "a review for your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1025"
  },
  {
    "text": "However, you should be aware that the prompt will only be ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1026"
  },
  {
    "text": "displayed to customers a maximum of three times ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1029"
  },
  {
    "text": "within a 365-day period.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1032"
  },
  {
    "text": "And you shouldn't ask customers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1034"
  },
  {
    "text": "to review the same version of your app multiple times.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1036"
  },
  {
    "text": "Avoid interrupting customers with a review prompt.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1039"
  },
  {
    "text": "A good time to ask for a review could be after they've ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1042"
  },
  {
    "text": "had a positive interaction, such as completing a purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1044"
  },
  {
    "text": "on an e-commerce app, or completing a level in a game.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1047"
  },
  {
    "text": "Finally, customers can disable requests from ever appearing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1051"
  },
  {
    "text": "on their device, so you shouldn't request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1053"
  },
  {
    "text": "a review as a result of a user action.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1055"
  },
  {
    "text": "These APIs are really going to come in handy ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1059"
  },
  {
    "text": "for your SwiftUI apps.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1062"
  },
  {
    "text": "Next, I'd like to introduce you ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1063"
  },
  {
    "text": "to our new API for StoreKit messages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1065"
  },
  {
    "text": "A StoreKit message represents a sheet that appears over ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1068"
  },
  {
    "text": "your app to display important information to the user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1071"
  },
  {
    "text": "Messages are vended by the App Store.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1074"
  },
  {
    "text": "Each message has a reason, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1077"
  },
  {
    "text": "which is included in the message metadata.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1078"
  },
  {
    "text": "StoreKit messages are retrieved ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1081"
  },
  {
    "text": "when your app comes to the foreground.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1083"
  },
  {
    "text": "As an example, let's take a look at ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1085"
  },
  {
    "text": "one of the message reasons -- price increase consent.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1087"
  },
  {
    "text": "When you increase the price of a subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1090"
  },
  {
    "text": "and it requires user consent, the App Store will inform ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1093"
  },
  {
    "text": "affected subscribers through email, push notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1095"
  },
  {
    "text": "and an in-app price consent sheet.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1099"
  },
  {
    "text": "In this case, the App Store requires that the user ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1101"
  },
  {
    "text": "agrees to the new price of your subscription ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1103"
  },
  {
    "text": "before it renews at the higher price.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1105"
  },
  {
    "text": "So, if you decide to charge more for your subscription, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1108"
  },
  {
    "text": "a price increase consent sheet may appear ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1110"
  },
  {
    "text": "when a user opens your app if they haven't already responded ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1112"
  },
  {
    "text": "to your price increase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1116"
  },
  {
    "text": "By default, StoreKit messages appear over your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1118"
  },
  {
    "text": "when the user brings your app to the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1120"
  },
  {
    "text": "and it may ask the user to take some action ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1122"
  },
  {
    "text": "relating to your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1124"
  },
  {
    "text": "Let's review this.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1126"
  },
  {
    "text": "The entire process starts with your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1128"
  },
  {
    "text": "When your app enters the foreground, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1131"
  },
  {
    "text": "StoreKit knows to check ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1133"
  },
  {
    "text": "if there's pending messages to display.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1134"
  },
  {
    "text": "And if there are, StoreKit checks in with the App Store.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1136"
  },
  {
    "text": "The App Store returns information about the message ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1140"
  },
  {
    "text": "to StoreKit.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1141"
  },
  {
    "text": "At this time, StoreKit checks whether your app ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1143"
  },
  {
    "text": "is set up to receive messages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1145"
  },
  {
    "text": "You can do this by setting up a message listener in your app, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1147"
  },
  {
    "text": "which I'll get into shortly.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1150"
  },
  {
    "text": "If your app has set up a message listener, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1152"
  },
  {
    "text": "StoreKit sends information about the message to your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1154"
  },
  {
    "text": "Now's your chance to decide whether or not it's a good time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1157"
  },
  {
    "text": "for your app to display the message, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1160"
  },
  {
    "text": "or if you want to defer the presentation for later.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1162"
  },
  {
    "text": "If you don't set up a message listener, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1165"
  },
  {
    "text": "StoreKit displays the message right away ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1168"
  },
  {
    "text": "by presenting the message sheet over your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1169"
  },
  {
    "text": "I'll go over how to do this in code.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1172"
  },
  {
    "text": "But before I do that, I'll explain a situation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1174"
  },
  {
    "text": "in which it would be useful to control the presentation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1176"
  },
  {
    "text": "of an App Store message.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1178"
  },
  {
    "text": "In the Food Truck app, I'm able to customize the donuts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1181"
  },
  {
    "text": "I'm delivering to different cities.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1183"
  },
  {
    "text": "If a message gets delivered to my app during this time, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1185"
  },
  {
    "text": "it would be confusing to the user if they're suddenly ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1188"
  },
  {
    "text": "interrupted by a message sheet, so I'm going to be implementing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1190"
  },
  {
    "text": "the messages API to make sure this doesn't happen ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1193"
  },
  {
    "text": "by controlling when incoming messages are presented.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1196"
  },
  {
    "text": "Now let's get into the code.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1199"
  },
  {
    "text": "Here, I have a simple view for the donut editor.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1201"
  },
  {
    "text": "As I mentioned earlier, pending messages are sent ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1204"
  },
  {
    "text": "each time your app comes to the foreground.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1206"
  },
  {
    "text": "So, I want to set up a message listener in each view ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1209"
  },
  {
    "text": "in which I want to defer the presentation of a message.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1212"
  },
  {
    "text": "I'll add a binding array to collect all the messages ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1215"
  },
  {
    "text": "that are delivered to my app while I'm in the editing view.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1217"
  },
  {
    "text": "This is important, because if I don't set up a message listener, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1220"
  },
  {
    "text": "StoreKit is going to display the message sheet right away ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1224"
  },
  {
    "text": "when my app comes to the foreground.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1226"
  },
  {
    "text": "As soon as the view appears, I set up my message listener.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1228"
  },
  {
    "text": "I'll do this by setting up a task that iterates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1232"
  },
  {
    "text": "over a static property on the message type.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1234"
  },
  {
    "text": "This property is an async sequence, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1237"
  },
  {
    "text": "and I'm able to receive messages as they come in.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1239"
  },
  {
    "text": "For my use case, I'm going to save the message ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1242"
  },
  {
    "text": "in the pendingMessages array.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1244"
  },
  {
    "text": "Since pending messages get delivered each time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1246"
  },
  {
    "text": "your app enters the foreground, your app could receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1248"
  },
  {
    "text": "the same message more than once, so I have this condition ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1250"
  },
  {
    "text": "to avoid adding duplicate messages to my array.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1253"
  },
  {
    "text": "Then, once the view dismisses, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1256"
  },
  {
    "text": "I'll display the messages in the parent view.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1258"
  },
  {
    "text": "This is the parent view which holds a navigation link ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1261"
  },
  {
    "text": "to the donut editor.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1263"
  },
  {
    "text": "Here, I've collected all the pending messages ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1265"
  },
  {
    "text": "I need to display in this pendingMessages array.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1267"
  },
  {
    "text": "So how do I display these pending messages? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1270"
  },
  {
    "text": "Well, now there's an environment value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1273"
  },
  {
    "text": "displayStoreKitMessage.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1275"
  },
  {
    "text": "This gets you an instance of a DisplayMessageAction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1277"
  },
  {
    "text": "which you can then use to display a given message.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1279"
  },
  {
    "text": "When the view appears, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1283"
  },
  {
    "text": "I'll iterate through the pending messages ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1284"
  },
  {
    "text": "and call displayStoreKitMessage ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1285"
  },
  {
    "text": "passing in the message I want to display.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1287"
  },
  {
    "text": "StoreKit takes care of presenting the message sheet.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1290"
  },
  {
    "text": "Earlier, I mentioned that the same message ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1294"
  },
  {
    "text": "may get delivered to your app more than once.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1296"
  },
  {
    "text": "That's because a message doesn't get marked as read ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1298"
  },
  {
    "text": "until it's presented to the user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1300"
  },
  {
    "text": "So, StoreKit makes sure that each unique message ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1302"
  },
  {
    "text": "is only presented once.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1305"
  },
  {
    "text": "And that was a quick implementation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1308"
  },
  {
    "text": "of the Messages API.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1310"
  },
  {
    "text": "Remember, StoreKit messages are sent to your app each time ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1312"
  },
  {
    "text": "it comes to the foreground, so you'll want to set up ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1315"
  },
  {
    "text": "a message listener in each view in which you want to control ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1318"
  },
  {
    "text": "the timing of when the messages are presented.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1321"
  },
  {
    "text": "You can ensure customers have a great experience by making sure ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1324"
  },
  {
    "text": "message sheets don't appear at unexpected moments.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1327"
  },
  {
    "text": "Or perhaps you want to tailor your logic ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1330"
  },
  {
    "text": "for certain messages types.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1332"
  },
  {
    "text": "With a price increase consent message, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1334"
  },
  {
    "text": "you may want to educate your customer ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1336"
  },
  {
    "text": "about the additional value you're providing ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1337"
  },
  {
    "text": "before the price increase consent sheet appears.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1339"
  },
  {
    "text": "Finally, let's review how StoreKit preserves ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1343"
  },
  {
    "text": "the applicationUsername as an appAccountToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1345"
  },
  {
    "text": "after a user makes a purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1348"
  },
  {
    "text": "If you have a user account system on your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1351"
  },
  {
    "text": "chances are you're already making use ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1354"
  },
  {
    "text": "of the applicationUsername property.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1355"
  },
  {
    "text": "The applicationUsername is a string that you create ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1358"
  },
  {
    "text": "to associate a transaction with a user account on your service.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1361"
  },
  {
    "text": "In the original API for in-app purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1365"
  },
  {
    "text": "you set the applicationUsername value when you add a payment ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1368"
  },
  {
    "text": "to the payment queue.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1370"
  },
  {
    "text": "Although the applicationUsername accepts any string, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1373"
  },
  {
    "text": "we recommend that you provide the string representation ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1376"
  },
  {
    "text": "of a UUID.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1379"
  },
  {
    "text": "When you provide it a UUID string, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1381"
  },
  {
    "text": "StoreKit persists the value and you'll see it ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1384"
  },
  {
    "text": "in the transaction that the queue updates.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1386"
  },
  {
    "text": "If you don't provide a UUID string ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1388"
  },
  {
    "text": "for the applicationUsername, StoreKit may not persist it.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1390"
  },
  {
    "text": "There's no guarantee the value will persist ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1393"
  },
  {
    "text": "between the time you add the payment transaction to the queue ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1395"
  },
  {
    "text": "and when the queue updates the transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1398"
  },
  {
    "text": "When you provide the string representation of a UUID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1401"
  },
  {
    "text": "you can identify which of your app's user accounts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1405"
  },
  {
    "text": "began and completed a transaction.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1407"
  },
  {
    "text": "In the modern StoreKit APIs, we implement this concept ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1410"
  },
  {
    "text": "as a purchase option called appAccountToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1413"
  },
  {
    "text": "and it requires a UUID format.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1415"
  },
  {
    "text": "Now, when you set the applicationUsername ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1419"
  },
  {
    "text": "to a UUID string during payment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1421"
  },
  {
    "text": "the App Store server stores it as an appAccountToken.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1424"
  },
  {
    "text": "So you'll see its UUID appear in the signed transaction info ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1427"
  },
  {
    "text": "returned by the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1431"
  },
  {
    "text": "and in V2 App Store Server Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1433"
  },
  {
    "text": "And as a UUID, it's compatible with the appAccountToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1437"
  },
  {
    "text": "in the modern StoreKit transaction APIs.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1440"
  },
  {
    "text": "So, now you can be sure that when you update your codebase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1443"
  },
  {
    "text": "to the modern StoreKit APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1446"
  },
  {
    "text": "the UUID you used for the applicationUsername ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1448"
  },
  {
    "text": "is preserved as an appAccountToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1451"
  },
  {
    "text": "in the StoreKit transactions.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1452"
  },
  {
    "text": "We touched on a lot of things today.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1455"
  },
  {
    "text": "Before moving on to the server updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1458"
  },
  {
    "text": "let's review this year's StoreKit updates.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1460"
  },
  {
    "text": "We discussed validating your app's purchase ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1464"
  },
  {
    "text": "with App Transaction, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1466"
  },
  {
    "text": "redeeming an offer code and requesting a review in SwiftUI, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1468"
  },
  {
    "text": "and controlling the presentation of StoreKit messages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1471"
  },
  {
    "text": "We talked about new price locale, environment, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1475"
  },
  {
    "text": "and recent subscription start date properties.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1478"
  },
  {
    "text": "And, we went over the importance of using ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1481"
  },
  {
    "text": "a string representation of a UUID for the applicationUsername ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1483"
  },
  {
    "text": "to persist it as an app account token.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1488"
  },
  {
    "text": "I highly recommend you check out our other session ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1490"
  },
  {
    "text": "\"What's new in StoreKit testing.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1493"
  },
  {
    "text": "And if you need a refresher on the StoreKit 2 APIs, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1496"
  },
  {
    "text": "check out last year's session \"Meet StoreKit 2.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1498"
  },
  {
    "text": "Now I'd like to hand it over to Ian ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1501"
  },
  {
    "text": "to walk you through the updates to the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1503"
  },
  {
    "text": "Ian Zanger: Thanks, Dani.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1506"
  },
  {
    "text": "Hi, everyone. My name is Ian, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1507"
  },
  {
    "text": "and I'm an engineer on the App Store Server team.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1509"
  },
  {
    "text": "Now that you've heard the latest ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1512"
  },
  {
    "text": "about in-app purchase with StoreKit, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1514"
  },
  {
    "text": "I'm going to switch gears and talk about the server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1516"
  },
  {
    "text": "First, I'll review some recent developments from the past year ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1519"
  },
  {
    "text": "before moving on to some exciting new updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1523"
  },
  {
    "text": "coming to the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1525"
  },
  {
    "text": "and App Store Server Notifications Version 2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1527"
  },
  {
    "text": "Let's get started.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1532"
  },
  {
    "text": "Last year was big.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1534"
  },
  {
    "text": "We brought you an entirely new suite of endpoints ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1536"
  },
  {
    "text": "with the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1539"
  },
  {
    "text": "and App Store Server Notifications V2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1541"
  },
  {
    "text": "including full sandbox testing support ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1544"
  },
  {
    "text": "for all these new features.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1546"
  },
  {
    "text": "We shared how you can use the Get Transaction History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1548"
  },
  {
    "text": "to get the full history of a user's in-app purchases, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1552"
  },
  {
    "text": "or the Get All Subscription Statuses endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1555"
  },
  {
    "text": "to stay up to date with the current state ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1559"
  },
  {
    "text": "of a user's subscriptions.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1561"
  },
  {
    "text": "Both of these endpoints conveniently key ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1563"
  },
  {
    "text": "off of a user's originalTransactionId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1565"
  },
  {
    "text": "so you can access this trove of data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1569"
  },
  {
    "text": "by storing just this one simple value.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1571"
  },
  {
    "text": "We also covered how version 2 ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1574"
  },
  {
    "text": "of App Store Server Notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1576"
  },
  {
    "text": "can simplify event processing on your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1579"
  },
  {
    "text": "and complement the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1582"
  },
  {
    "text": "With V2 notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1585"
  },
  {
    "text": "the App Store server calls your server directly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1587"
  },
  {
    "text": "providing in-app purchase updates as they happen.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1590"
  },
  {
    "text": "The streamlined notification type and subtype ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1593"
  },
  {
    "text": "make it easy to understand what's happening.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1597"
  },
  {
    "text": "You can use these to track changes ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1600"
  },
  {
    "text": "related to in-app subscriptions and other events.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1602"
  },
  {
    "text": "With all of these data sources, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1605"
  },
  {
    "text": "we wanted to make that data as easy as possible to parse.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1607"
  },
  {
    "text": "Receipts are now a thing of the past, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1611"
  },
  {
    "text": "as these new services provide in-app data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1613"
  },
  {
    "text": "in signed JSON format, so you can easily parse it ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1616"
  },
  {
    "text": "and trust that it came from the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1620"
  },
  {
    "text": "Last year was a big year for the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1624"
  },
  {
    "text": "It may have been big for you as well ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1627"
  },
  {
    "text": "if you worked to update your server code ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1630"
  },
  {
    "text": "to leverage all these new features.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1632"
  },
  {
    "text": "Rest assured that effort will continue to pay off ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1635"
  },
  {
    "text": "as we bring powerful new enhancements and features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1638"
  },
  {
    "text": "to App Store Server API and App Store Server Notifications V2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1641"
  },
  {
    "text": "That's our year in review, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1647"
  },
  {
    "text": "but if you'd like more of a refresher ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1648"
  },
  {
    "text": "after hearing this year's updates, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1650"
  },
  {
    "text": "be sure to check out the WWDC21 sessions titled ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1652"
  },
  {
    "text": "\"Manage in-app purchases on your server,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1656"
  },
  {
    "text": "\"Meet StoreKit 2,\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1660"
  },
  {
    "text": "and \"Support customers and handle refunds.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1662"
  },
  {
    "text": "Now let's move on to brand-new updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1665"
  },
  {
    "text": "coming to the App Store server for WWDC22.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1668"
  },
  {
    "text": "First I'll share some updates to transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1673"
  },
  {
    "text": "and renewal info fields.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1676"
  },
  {
    "text": "Next I'll tell you about new enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1678"
  },
  {
    "text": "to the App Store Server API.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1681"
  },
  {
    "text": "And finally, I'll share exciting new features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1683"
  },
  {
    "text": "coming to App Store Server Notifications V2.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1686"
  },
  {
    "text": "Now let's dive in with the first of our new topics: ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1691"
  },
  {
    "text": "new fields found in transaction and renewal info.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1694"
  },
  {
    "text": "Earlier, you heard from Dani about a couple new fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1698"
  },
  {
    "text": "coming to the transaction and renewal info ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1701"
  },
  {
    "text": "of in-app purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1704"
  },
  {
    "text": "These fields, environment and recentSubscriptionStartDate, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1706"
  },
  {
    "text": "are also coming to the transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1710"
  },
  {
    "text": "and renewal info payloads ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1712"
  },
  {
    "text": "you receive from the App Store Server API ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1713"
  },
  {
    "text": "and in V2 App Store Server Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1716"
  },
  {
    "text": "Let's take a fresh look at the data you can expect to receive ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1720"
  },
  {
    "text": "from the App Store server with these new fields included.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1724"
  },
  {
    "text": "First is the transaction info payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1728"
  },
  {
    "text": "which we can see here after decoding.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1730"
  },
  {
    "text": "Down at the bottom, you can see our new field: environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1733"
  },
  {
    "text": "You can use it to tell, at a glance, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1737"
  },
  {
    "text": "whether the transaction took place ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1739"
  },
  {
    "text": "in the production or sandbox environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1741"
  },
  {
    "text": "Next is the renewal info payload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1744"
  },
  {
    "text": "also seen here after decoding.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1747"
  },
  {
    "text": "As you can see, the environment field is also available here ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1750"
  },
  {
    "text": "for your reference.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1753"
  },
  {
    "text": "Additionally, recentSubscriptionStartDate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1755"
  },
  {
    "text": "will now appear in every renewal info payload.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1758"
  },
  {
    "text": "This is the start date of the user's first ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1761"
  },
  {
    "text": "subscription purchase in their most recent string of renewals, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1763"
  },
  {
    "text": "ignoring any gaps of 60 days or fewer.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1767"
  },
  {
    "text": "recentSubscriptionStartDate is an easy way to get an idea ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1772"
  },
  {
    "text": "of a customer's loyalty at a glance.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1775"
  },
  {
    "text": "But if you'd like more detail, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1778"
  },
  {
    "text": "including the timing and length of any gaps in service, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1780"
  },
  {
    "text": "you can call the Get Transaction History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1783"
  },
  {
    "text": "and examine the full history ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1787"
  },
  {
    "text": "of a user's subscription renewal purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1788"
  },
  {
    "text": "Or for even more detail, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1791"
  },
  {
    "text": "with App Store Server Notifications V2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1794"
  },
  {
    "text": "the App Store server automatically sends updates ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1796"
  },
  {
    "text": "about user subscriptions to your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1799"
  },
  {
    "text": "These notifications give you maximum insight ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1803"
  },
  {
    "text": "into the timing of events like renewal preference changes, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1805"
  },
  {
    "text": "offer redemptions, billing failures, and more.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1809"
  },
  {
    "text": "As you can see, recentSubscriptionStartDate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1814"
  },
  {
    "text": "rounds out a suite of options ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1817"
  },
  {
    "text": "for determining customer loyalty.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1819"
  },
  {
    "text": "Use these tools to target offers ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1821"
  },
  {
    "text": "and reward your most loyal customers.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1823"
  },
  {
    "text": "Now let's move on to some convenient new enhancements ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1827"
  },
  {
    "text": "to the Get Transaction History endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1830"
  },
  {
    "text": "With the Get Transaction History endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1833"
  },
  {
    "text": "you can fetch the full history of a user's purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1836"
  },
  {
    "text": "in your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1839"
  },
  {
    "text": "The endpoint response is paginated ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1841"
  },
  {
    "text": "so you can process this data in reasonable chunks.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1843"
  },
  {
    "text": "Each response contains a revision token that you provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1846"
  },
  {
    "text": "in the next request in order to get the next page.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1849"
  },
  {
    "text": "And the pages are sorted by modified date, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1853"
  },
  {
    "text": "meaning each subsequent page contains transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1856"
  },
  {
    "text": "that are more recently modified.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1859"
  },
  {
    "text": "Let's take a look at how this works.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1862"
  },
  {
    "text": "You call the Get Transaction History endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1865"
  },
  {
    "text": "and provide an originalTransactionId.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1868"
  },
  {
    "text": "The App Store server will return up to 20 signed transactions ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1872"
  },
  {
    "text": "for that user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1876"
  },
  {
    "text": "It will also return an updated revision value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1878"
  },
  {
    "text": "that you will provide in your next page request for this user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1881"
  },
  {
    "text": "You'll know there's more data available ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1885"
  },
  {
    "text": "when the hasMore field in the response is true.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1887"
  },
  {
    "text": "Let's say in this case ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1891"
  },
  {
    "text": "that there's another page of data available.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1892"
  },
  {
    "text": "You make another request to the endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1895"
  },
  {
    "text": "and you include that revision value from the first response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1897"
  },
  {
    "text": "You receive the next page of data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1901"
  },
  {
    "text": "including an updated revision value.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1903"
  },
  {
    "text": "hasMore is now false, so you know you're up to date ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1906"
  },
  {
    "text": "with the latest transaction data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1909"
  },
  {
    "text": "Except this time, you notice something ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1912"
  },
  {
    "text": "about the final transaction in the response; ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1914"
  },
  {
    "text": "you've seen it before! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1916"
  },
  {
    "text": "It was one of the original 20 you received ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1918"
  },
  {
    "text": "in response to your first request.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1921"
  },
  {
    "text": "This means the transaction must have been modified, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1923"
  },
  {
    "text": "so it was put back at the top of the sort order.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1926"
  },
  {
    "text": "Now, you can examine the data of that transaction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1930"
  },
  {
    "text": "and take note of what's changed.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1933"
  },
  {
    "text": "In this instance, you notice the revocationDate ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1935"
  },
  {
    "text": "and revocationReason fields are now populated, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1938"
  },
  {
    "text": "meaning the transaction was revoked.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1941"
  },
  {
    "text": "You can take action by revoking any content ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1944"
  },
  {
    "text": "associated with the purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1946"
  },
  {
    "text": "It's a good idea to store the revision value ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1949"
  },
  {
    "text": "from this final response alongside ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1952"
  },
  {
    "text": "the originalTransactionId you used to identify the user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1954"
  },
  {
    "text": "The next time you call the endpoint for this user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1959"
  },
  {
    "text": "you can provide that revision and know ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1961"
  },
  {
    "text": "that you're getting back only fresh transaction data ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1964"
  },
  {
    "text": "that has been modified since your last request.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1967"
  },
  {
    "text": "As you've seen, the Get Transaction History endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1970"
  },
  {
    "text": "provides you a simple way to retrieve a comprehensive set ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1974"
  },
  {
    "text": "of in-app purchase data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1977"
  },
  {
    "text": "But maybe sometimes it can be a bit too comprehensive.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1980"
  },
  {
    "text": "Some users have lengthy purchase histories ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1983"
  },
  {
    "text": "dating back several years.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1986"
  },
  {
    "text": "For these users, this endpoint could return ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1989"
  },
  {
    "text": "hundreds of purchases of a variety of types.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1992"
  },
  {
    "text": "Even with pages, this can be a lot to handle.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=1996"
  },
  {
    "text": "That's why this year, we're enhancing this endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2000"
  },
  {
    "text": "with a variety of new sort and filter options.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2002"
  },
  {
    "text": "Now, you can tell us exactly the data you want from the start, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2007"
  },
  {
    "text": "saving processing time on your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2011"
  },
  {
    "text": "and reducing the number of network calls ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2013"
  },
  {
    "text": "needed to retrieve all available pages.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2015"
  },
  {
    "text": "You can sort by descending modified date ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2019"
  },
  {
    "text": "if you're interested in seeing the most recently ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2021"
  },
  {
    "text": "modified purchases on the first page of results.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2023"
  },
  {
    "text": "You can also filter by several useful fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2027"
  },
  {
    "text": "such as product type, product ID, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2030"
  },
  {
    "text": "Family sharing status, and more.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2034"
  },
  {
    "text": "To apply these new sort and filter options, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2036"
  },
  {
    "text": "just append them as query parameters to your request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2039"
  },
  {
    "text": "to the Get Transaction History endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2043"
  },
  {
    "text": "Let's take a closer look at how that works.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2046"
  },
  {
    "text": "Here you can see all the new parameter options.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2049"
  },
  {
    "text": "These may look familiar, since most are taken directly ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2052"
  },
  {
    "text": "from the transaction info payload.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2055"
  },
  {
    "text": "You can mix and match these parameters ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2058"
  },
  {
    "text": "to get very specific results.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2060"
  },
  {
    "text": "For example, maybe we want to fetch ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2062"
  },
  {
    "text": "only the nonconsumable purchases a user has made ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2064"
  },
  {
    "text": "since the beginning of this year.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2068"
  },
  {
    "text": "We also want to exclude any revoked purchases.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2071"
  },
  {
    "text": "We will build our custom request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2074"
  },
  {
    "text": "by setting the productType to NON_CONSUMABLE ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2076"
  },
  {
    "text": "and specifying the startDate as the beginning of this year ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2079"
  },
  {
    "text": "represented in milliseconds.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2083"
  },
  {
    "text": "Finally, we'll set excludeRevoked to true.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2085"
  },
  {
    "text": "And that's our request! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2089"
  },
  {
    "text": "Since we did not specify a sort order, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2090"
  },
  {
    "text": "the response will default to sorting ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2093"
  },
  {
    "text": "by ascending modified date.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2095"
  },
  {
    "text": "Now even with a request as specific as this, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2098"
  },
  {
    "text": "there could be multiple pages of purchases to retrieve.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2100"
  },
  {
    "text": "For follow-up requests, we should make sure ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2104"
  },
  {
    "text": "to include the exact same query parameters, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2106"
  },
  {
    "text": "in addition to the revision from the previous response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2109"
  },
  {
    "text": "For even more flexibility, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2112"
  },
  {
    "text": "three of the filter fields support multiple values, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2114"
  },
  {
    "text": "so you can filter to only those purchases ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2118"
  },
  {
    "text": "that match at least one of the provided values.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2120"
  },
  {
    "text": "These fields are productType, productId, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2124"
  },
  {
    "text": "and subscriptionGroupIdentifier.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2128"
  },
  {
    "text": "To provide multiple values for these parameters, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2132"
  },
  {
    "text": "simply define them multiple times.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2135"
  },
  {
    "text": "Next let's move on to App Store Server Notification updates.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2139"
  },
  {
    "text": "With App Store Server Notifications V2, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2144"
  },
  {
    "text": "you can take your server to the next level.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2147"
  },
  {
    "text": "V2 notifications give detailed insights ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2150"
  },
  {
    "text": "about in-app purchase events ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2153"
  },
  {
    "text": "that you can't get anywhere else.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2155"
  },
  {
    "text": "These are especially useful for tracking the lifecycle ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2157"
  },
  {
    "text": "of autorenewable subscriptions offered in your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2161"
  },
  {
    "text": "You can use these insights to retain customers, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2165"
  },
  {
    "text": "win back those that have churned, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2168"
  },
  {
    "text": "resolve customer support requests, and more.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2170"
  },
  {
    "text": "With all of these benefits, you might wonder how to get started.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2175"
  },
  {
    "text": "As with any new feature, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2179"
  },
  {
    "text": "the sandbox testing environment is the best place to start.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2181"
  },
  {
    "text": "That's why last year, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2184"
  },
  {
    "text": "we added the ability to set a separate server URL ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2186"
  },
  {
    "text": "in App Store Connect for receiving ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2189"
  },
  {
    "text": "App Store Server Notifications in sandbox.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2191"
  },
  {
    "text": "After registering your server URL, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2195"
  },
  {
    "text": "you'll want to confirm your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2197"
  },
  {
    "text": "is receiving notifications from the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2199"
  },
  {
    "text": "You might set up a sandbox account ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2203"
  },
  {
    "text": "just to trigger a notification through a user action.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2205"
  },
  {
    "text": "For example, let's say you perform a first time buy ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2209"
  },
  {
    "text": "of a subscription using that sandbox account.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2212"
  },
  {
    "text": "You should receive a V2 notification of type SUBSCRIBED ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2216"
  },
  {
    "text": "and subtype INITIAL_BUY.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2220"
  },
  {
    "text": "But what if that notification doesn't come? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2223"
  },
  {
    "text": "You might wonder if there was an issue with your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2225"
  },
  {
    "text": "or the steps you took to trigger a notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2228"
  },
  {
    "text": "This situation can generate a lot of uncertainty ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2232"
  },
  {
    "text": "right as you're getting started.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2235"
  },
  {
    "text": "We want to simplify this experience and give you a way ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2236"
  },
  {
    "text": "to easily verify that App Store Server Notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2239"
  },
  {
    "text": "can reach your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2243"
  },
  {
    "text": "That's why this year, we're introducing the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2245"
  },
  {
    "text": "Request a Test Notification endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2247"
  },
  {
    "text": "By calling this simple endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2251"
  },
  {
    "text": "you can ask us to send a V2 Notification of type TEST ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2252"
  },
  {
    "text": "to the server URL registered for your app in App Store Connect.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2257"
  },
  {
    "text": "The new TEST notification type is used exclusively ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2262"
  },
  {
    "text": "for this endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2265"
  },
  {
    "text": "You can call the endpoint in sandbox or production ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2267"
  },
  {
    "text": "to test your saved URL for either environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2271"
  },
  {
    "text": "Use this new endpoint to quickly test new server URLs ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2275"
  },
  {
    "text": "and configurations.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2279"
  },
  {
    "text": "Let's see how this simplifies first-time setup.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2281"
  },
  {
    "text": "Now, if you're just looking to trigger your first notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2284"
  },
  {
    "text": "there's no need to set up a sandbox account ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2288"
  },
  {
    "text": "or perform a purchase.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2290"
  },
  {
    "text": "Just call the new endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2292"
  },
  {
    "text": "in whichever environment you want to test ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2294"
  },
  {
    "text": "and you'll receive an HTTP 200 response ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2296"
  },
  {
    "text": "confirming your request.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2300"
  },
  {
    "text": "The response will contain a new field, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2302"
  },
  {
    "text": "testNotificationToken, which identifies the test notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2305"
  },
  {
    "text": "your server will receive.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2309"
  },
  {
    "text": "We will come back to this field later.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2311"
  },
  {
    "text": "Shortly afterward, your server should receive a V2 notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2314"
  },
  {
    "text": "of type TEST at the URL saved in App Store Connect.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2318"
  },
  {
    "text": "Now let's see how to call this endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2323"
  },
  {
    "text": "Just send a simple POST request to this new path ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2326"
  },
  {
    "text": "on the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2329"
  },
  {
    "text": "You'll receive an HTTP 200 response ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2332"
  },
  {
    "text": "and know that your request has been submitted.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2335"
  },
  {
    "text": "The response will contain that new field I mentioned, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2338"
  },
  {
    "text": "testNotificationToken.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2341"
  },
  {
    "text": "Take note of this for later.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2343"
  },
  {
    "text": "Soon you'll receive a signed TEST Notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2346"
  },
  {
    "text": "Here's what that notification will look like ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2350"
  },
  {
    "text": "once it's decoded.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2352"
  },
  {
    "text": "You'll notice it contains all the usual top-level fields ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2354"
  },
  {
    "text": "of a V2 notification, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2357"
  },
  {
    "text": "including the new notificationType, TEST.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2359"
  },
  {
    "text": "The contents of the data object are a bit shorter ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2363"
  },
  {
    "text": "than a normal notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2366"
  },
  {
    "text": "Since this is just a test, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2367"
  },
  {
    "text": "there are no transaction-related data to include, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2369"
  },
  {
    "text": "so we omit transaction-specific fields, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2372"
  },
  {
    "text": "most notably the signedTransactionInfo.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2375"
  },
  {
    "text": "When calling the new Request a Test Notification endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2380"
  },
  {
    "text": "keep in mind that App Store Server Notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2383"
  },
  {
    "text": "are sent asynchronously.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2386"
  },
  {
    "text": "Your successful call to the endpoint ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2388"
  },
  {
    "text": "will return an HTTP 200 but the actual test notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2390"
  },
  {
    "text": "will arrive separately, a short while later.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2395"
  },
  {
    "text": "Given that this endpoint is all about ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2399"
  },
  {
    "text": "testing your server configuration, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2401"
  },
  {
    "text": "you might be wondering what to do when that test fails.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2403"
  },
  {
    "text": "In other words, what if the test notification doesn't arrive? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2407"
  },
  {
    "text": "To further enhance your testing capabilities, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2412"
  },
  {
    "text": "we're releasing the Get Test Notification Status endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2414"
  },
  {
    "text": "which you will use in conjunction ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2418"
  },
  {
    "text": "with the Request a Test Notification endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2420"
  },
  {
    "text": "With this new endpoint, you can check on the status ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2424"
  },
  {
    "text": "of a previously requested TEST notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2426"
  },
  {
    "text": "The endpoint response will tell you if the App Store server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2430"
  },
  {
    "text": "was able to reach your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2433"
  },
  {
    "text": "and successfully send the TEST notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2435"
  },
  {
    "text": "If the send failed, it will give you an idea of why, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2439"
  },
  {
    "text": "so you can better troubleshoot your server configuration.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2442"
  },
  {
    "text": "Let's check out how you'll use this endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2446"
  },
  {
    "text": "Send a GET request to this path on the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2450"
  },
  {
    "text": "In the path, include the testNotificationToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2454"
  },
  {
    "text": "you received from the Request a Test Notification endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2458"
  },
  {
    "text": "This will tell us which test notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2462"
  },
  {
    "text": "you want to check the status of.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2464"
  },
  {
    "text": "Now for the response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2467"
  },
  {
    "text": "The signedPayload field contains the TEST notification payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2469"
  },
  {
    "text": "that the App Store server attempted to send ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2473"
  },
  {
    "text": "to your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2475"
  },
  {
    "text": "And the firstSendAttemptResult field indicates the result ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2477"
  },
  {
    "text": "of that send attempt.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2481"
  },
  {
    "text": "Here, SUCCESS indicates that the send was successful, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2483"
  },
  {
    "text": "meaning the App Store server received an HTTP 200 response ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2487"
  },
  {
    "text": "from your server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2491"
  },
  {
    "text": "If the send was unsuccessful, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2494"
  },
  {
    "text": "you'll instead see one of several different error values.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2496"
  },
  {
    "text": "These values indicate the error the App Store server experienced ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2500"
  },
  {
    "text": "trying to reach your server with the test notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2504"
  },
  {
    "text": "With this information, you can troubleshoot your server issue, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2508"
  },
  {
    "text": "request new test notifications as needed, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2511"
  },
  {
    "text": "and get your server running reliably.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2514"
  },
  {
    "text": "Collectively, these test notification endpoints ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2518"
  },
  {
    "text": "are simple to use and can save you a lot of trouble ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2520"
  },
  {
    "text": "when setting up or reconfiguring your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2523"
  },
  {
    "text": "to receive V2 App Store Server Notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2526"
  },
  {
    "text": "Now with the help of these endpoints, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2531"
  },
  {
    "text": "you can set up your server and confirm it's running smoothly.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2533"
  },
  {
    "text": "But servers aren't perfect and outages happen.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2537"
  },
  {
    "text": "How do you recover when your server goes down, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2540"
  },
  {
    "text": "leading you to miss App Store Server Notifications? ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2543"
  },
  {
    "text": "The current solution to this is a retry system.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2546"
  },
  {
    "text": "When the App Store server fails to reach your server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2550"
  },
  {
    "text": "it initiates a retry process.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2553"
  },
  {
    "text": "It will retry sending the same notification up to five times, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2556"
  },
  {
    "text": "with a longer wait between each attempt.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2560"
  },
  {
    "text": "These retries take place only in the production environment.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2563"
  },
  {
    "text": "Retries help you eventually recover from an outage, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2567"
  },
  {
    "text": "but they're not perfect for every situation.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2570"
  },
  {
    "text": "For example, some outages can be extensive.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2573"
  },
  {
    "text": "If your server is down long enough ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2577"
  },
  {
    "text": "to miss the final retry attempt from the App Store server, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2578"
  },
  {
    "text": "that notification is lost.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2582"
  },
  {
    "text": "Or more commonly, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2585"
  },
  {
    "text": "your server could experience a very brief issue, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2586"
  },
  {
    "text": "during which it misses only a handful of notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2589"
  },
  {
    "text": "But missing even a single notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2593"
  },
  {
    "text": "means some of your customer records are out of date ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2596"
  },
  {
    "text": "for at least an hour.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2598"
  },
  {
    "text": "Yet you don't know which ones! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2600"
  },
  {
    "text": "Clearly, server outages are stressful, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2603"
  },
  {
    "text": "and recovering from them can be a complex task.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2606"
  },
  {
    "text": "That's why we want to make it as easy as possible ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2609"
  },
  {
    "text": "to recover missed App Store Server Notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2611"
  },
  {
    "text": "so you can get your server back on track as soon as possible.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2615"
  },
  {
    "text": "That's why this year, we are introducing the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2619"
  },
  {
    "text": "Get Notification History endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2622"
  },
  {
    "text": "With this endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2625"
  },
  {
    "text": "you can fetch the history of V2 App Store Server Notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2626"
  },
  {
    "text": "generated for your app.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2631"
  },
  {
    "text": "Whether your server successfully received a notification or not, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2633"
  },
  {
    "text": "that notification will appear in the response of this endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2638"
  },
  {
    "text": "When calling this endpoint, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2642"
  },
  {
    "text": "you'll specify a date range of notifications to fetch.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2644"
  },
  {
    "text": "With WWDC, we have started recording this data, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2648"
  },
  {
    "text": "and we will build up to the cap of the latest six months ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2651"
  },
  {
    "text": "of rolling history being available.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2655"
  },
  {
    "text": "You can optionally filter your request by type and subtype, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2658"
  },
  {
    "text": "or fetch just a single user's notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2662"
  },
  {
    "text": "by providing an originalTransactionId.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2665"
  },
  {
    "text": "And the existing retry system is still available, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2669"
  },
  {
    "text": "so you can use it in tandem with this new endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2671"
  },
  {
    "text": "Let's take a look at how you'll call this endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2675"
  },
  {
    "text": "You'll send a POST request to this new path ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2679"
  },
  {
    "text": "on the App Store server.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2681"
  },
  {
    "text": "In the request body, you'll include a startDate and endDate.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2683"
  },
  {
    "text": "The response will contain only notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2688"
  },
  {
    "text": "we first attempted to send in this window.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2691"
  },
  {
    "text": "Keep in mind that the earliest notifications available ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2694"
  },
  {
    "text": "will be those sent six months before the date of your request.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2698"
  },
  {
    "text": "Optionally, you can specify a notificationType ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2702"
  },
  {
    "text": "and notificationSubtype.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2706"
  },
  {
    "text": "If you do, the history will be filtered to only notifications ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2708"
  },
  {
    "text": "that match both of these values.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2712"
  },
  {
    "text": "Keep in mind that some notifications have no subtype.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2715"
  },
  {
    "text": "Alternatively, you can provide ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2719"
  },
  {
    "text": "an originalTransactionId of a user, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2721"
  },
  {
    "text": "to fetch the notification history of only that user.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2723"
  },
  {
    "text": "Finally, you should provide a paginationToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2728"
  },
  {
    "text": "as a query parameter for every follow-up request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2731"
  },
  {
    "text": "in order to get the next page.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2734"
  },
  {
    "text": "Make sure you use the same request body ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2737"
  },
  {
    "text": "for follow-up requests, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2739"
  },
  {
    "text": "changing only this paginationToken.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2741"
  },
  {
    "text": "Now let's take a look at the response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2744"
  },
  {
    "text": "The notificationHistory array contains up to 20 notifications, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2747"
  },
  {
    "text": "with the oldest notifications first.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2751"
  },
  {
    "text": "Each entry in this array represents a notification ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2755"
  },
  {
    "text": "and inside you'll find the signedPayload, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2759"
  },
  {
    "text": "which you can decode as usual to view the transaction data.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2762"
  },
  {
    "text": "The data within is identical to the payload ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2767"
  },
  {
    "text": "the App Store server sent in the original notification.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2770"
  },
  {
    "text": "You'll see that we've also brought the new ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2774"
  },
  {
    "text": "firstSendAttemptResult field to this endpoint response.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2776"
  },
  {
    "text": "You can use this field to look for sequences of timeouts ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2780"
  },
  {
    "text": "and other errors to better understand why your server ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2784"
  },
  {
    "text": "missed notifications in the past.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2787"
  },
  {
    "text": "The response also contains a paginationToken ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2790"
  },
  {
    "text": "if there are more pages to retrieve.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2793"
  },
  {
    "text": "You should provide this in your next request ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2796"
  },
  {
    "text": "in order to get the next page of notifications.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2798"
  },
  {
    "text": "You'll know there are more pages to retrieve ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2801"
  },
  {
    "text": "as long as the hasMore field is true.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2803"
  },
  {
    "text": "And that's everything you need to know ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2807"
  },
  {
    "text": "about this useful new endpoint.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2809"
  },
  {
    "text": "That concludes our App Store server updates for today.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2812"
  },
  {
    "text": "Every server feature announced today is available now ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2816"
  },
  {
    "text": "in both sandbox and production.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2819"
  },
  {
    "text": "We hope you'll take advantage of these new features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2822"
  },
  {
    "text": "to make your server the best it can be.",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2824"
  },
  {
    "text": "For more great content on using a server with in-app purchase, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2827"
  },
  {
    "text": "including how to use the latest features ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2831"
  },
  {
    "text": "while supporting legacy clients, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2833"
  },
  {
    "text": "I encourage you to check out another session at WWDC22, ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2835"
  },
  {
    "text": "\"Explore in-app purchase integration and migration.\" ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2840"
  },
  {
    "text": "Both: Thanks for joining us at WWDC22! ",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2844"
  },
  {
    "text": "♪",
    "link": "https://developer.apple.com/videos/play/wwdc2022-10007/?time=2847"
  }
]