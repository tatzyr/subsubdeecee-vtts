WEBVTT

00:00:00.000 --> 00:00:03.000
♪ Nhạc cụ hip-hip êm dịu ♪

00:00:03.000 --> 00:00:10.000
♪

00:00:10.000 --> 00:00:21.000
Xin chào, tôi là Vidhi Goel, và trong video này, tôi sẽ nói về cách giảm sự chậm trễ của mạng trong các ứng dụng của bạn và làm cho chúng phản hồi nhanh hơn.

00:00:21.000 --> 00:00:29.000
Đầu tiên, tôi sẽ giải thích tại sao việc giảm độ trễ là rất quan trọng trong việc làm cho ứng dụng của bạn đáp ứng.

00:00:29.000 --> 00:00:40.000
Tiếp theo, tôi sẽ xem qua danh sách những việc bạn có thể làm trong ứng dụng và trên máy chủ của mình để loại bỏ sự chậm trễ không cần thiết.

00:00:40.000 --> 00:00:47.000
Cuối cùng, tôi sẽ chỉ ra những gì bạn có thể làm để giảm sự chậm trễ trong chính mạng.

00:00:47.000 --> 00:00:55.000
Độ trễ mạng là thời gian cần thiết để dữ liệu đi từ điểm cuối này sang điểm cuối khác.

00:00:55.000 --> 00:01:01.000
Nó xác định nội dung có thể được gửi đến ứng dụng của bạn nhanh như thế nào.

00:01:01.000 --> 00:01:11.000
Tất cả các ứng dụng sử dụng mạng có thể bị ảnh hưởng bởi các giao dịch mạng chậm dẫn đến trải nghiệm ứng dụng kém.

00:01:11.000 --> 00:01:20.000
Ví dụ, các cuộc gọi video đôi khi có thể bị đóng băng hoặc trở nên chậm trễ, điều này có thể làm gián đoạn các cuộc họp.

00:01:20.000 --> 00:01:31.000
Để giải quyết vấn đề này, mọi người thường gọi cho nhà cung cấp dịch vụ của họ để nâng cấp băng thông của họ, tuy nhiên, vấn đề vẫn tồn tại.

00:01:31.000 --> 00:01:40.000
Để tìm ra nguyên nhân gốc rễ của vấn đề này, bạn cần hiểu cách các gói ứng dụng của bạn di chuyển trong mạng.

00:01:40.000 --> 00:01:48.000
Khi ứng dụng hoặc khuôn khổ của bạn yêu cầu dữ liệu từ máy chủ, các gói tin sẽ được gửi đi bởi ngăn xếp mạng.

00:01:48.000 --> 00:01:56.000
Người ta thường giả định rằng các gói tin đi trực tiếp đến máy chủ mà không có sự chậm trễ trong mạng.

00:01:56.000 --> 00:02:05.000
Nhưng, trên thực tế, liên kết chậm nhất của mạng thường có một hàng đợi lớn các gói để xử lý.

00:02:05.000 --> 00:02:16.000
Vì vậy, gói từ ứng dụng của bạn thực sự đợi phía sau hàng đợi lớn này cho đến khi các gói phía trước được xử lý.

00:02:16.000 --> 00:02:24.000
Việc xếp hàng ở liên kết chậm nhất này làm tăng thời lượng của mỗi chuyến đi khứ hồi giữa ứng dụng và máy chủ của bạn.

00:02:24.000 --> 00:02:34.000
Vấn đề này trở nên trầm trọng hơn khi phải mất nhiều chuyến đi khứ hồi để nhận được phản hồi đầu tiên cho yêu cầu ứng dụng của bạn.

00:02:34.000 --> 00:02:50.000
Ví dụ, thời gian để nhận gói phản hồi đầu tiên khi sử dụng TLS 1.2 qua TCP là thời lượng của mỗi chuyến khứ hồi nhân với bốn chuyến đi.

00:02:50.000 --> 00:03:02.000
Cho rằng mỗi thời gian khứ hồi đã bị thổi phồng bằng cách xếp hàng trong mạng, tổng thời gian kết quả đơn giản là quá dài.

00:03:02.000 --> 00:03:15.000
Có hai yếu tố nhân lên với nhau để xác định khả năng phản hồi của ứng dụng của bạn: thời lượng của mỗi chuyến khứ hồi và số lượng chuyến khứ hồi.

00:03:15.000 --> 00:03:24.000
Giảm những thứ này sẽ làm giảm độ trễ ứng dụng của bạn và tăng khả năng phản hồi của ứng dụng.

00:03:24.000 --> 00:03:33.000
Đã có một nghiên cứu kiểm tra tác động của việc tăng băng thông so với giảm độ trễ đối với thời gian tải trang.

00:03:33.000 --> 00:03:44.000
Trong thử nghiệm đầu tiên, độ trễ được giữ cố định và băng thông được tăng dần từ 1 lên 10Mbps.

00:03:44.000 --> 00:03:56.000
Lúc đầu, việc tăng băng thông từ 1 lên 2Mbps giúp giảm thời gian tải trang gần 40%, điều này thật tuyệt.

00:03:56.000 --> 00:04:07.000
Nhưng sau 4Mbps, mỗi lần tăng gia tăng dẫn đến hầu như không có sự cải thiện nào trong thời gian tải trang.

00:04:07.000 --> 00:04:14.000
Đây là lý do tại sao các ứng dụng có thể chậm ngay cả sau khi nâng cấp lên Gigabit Internet.

00:04:14.000 --> 00:04:28.000
Mặt khác, kết quả cho bài kiểm tra độ trễ cho thấy cứ mỗi 20 mili giây giảm độ trễ, có sự cải thiện tuyến tính về thời gian tải trang.

00:04:28.000 --> 00:04:35.000
Và những kết quả này áp dụng cho tất cả các hoạt động mạng trong ứng dụng của bạn.

00:04:35.000 --> 00:04:45.000
Bây giờ, tôi sẽ xem xét một vài hành động đơn giản mà bạn có thể thực hiện để giảm độ trễ và làm cho ứng dụng của bạn phản hồi nhanh hơn.

00:04:45.000 --> 00:04:57.000
Bạn có thể giảm đáng kể độ trễ của ứng dụng bằng cách áp dụng các giao thức hiện đại như IPv6, TLS 1.3 và HTTP/3.

00:04:57.000 --> 00:05:12.000
Và tất cả những gì bạn cần làm là sử dụng URLSession và Network.framework APIs trong ứng dụng của bạn và các giao thức này sẽ được sử dụng tự động khi chúng được bật trên máy chủ của bạn.

00:05:12.000 --> 00:05:32.000
Kể từ khi triển khai, chúng tôi đã thấy sự gia tăng liên tục trong việc sử dụng HTTP/3 và chỉ trong vòng một năm, 20 phần trăm lưu lượng truy cập web đã sử dụng HTTP/3 và nó tiếp tục phát triển.

00:05:32.000 --> 00:05:42.000
So sánh lưu lượng truy cập Safari cho các phiên bản HTTP khác nhau, HTTP/3 là nhanh nhất trong số đó.

00:05:42.000 --> 00:05:57.000
Các yêu cầu HTTP/3 mất hơn một nửa thời gian so với HTTP/1, khi xem thời gian hoàn thành yêu cầu trung bình là bội số của thời gian khứ hồi.

00:05:57.000 --> 00:06:03.000
Điều này có nghĩa là các yêu cầu ứng dụng của bạn sẽ hoàn thành nhanh hơn nhiều.

00:06:03.000 --> 00:06:15.000
Khi một thiết bị chuyển từ Wi-Fi sang mạng di động, cần có thời gian để thiết lập lại các kết nối mới và điều đó có thể khiến ứng dụng của bạn bị đình trệ.

00:06:15.000 --> 00:06:20.000
Sử dụng di chuyển kết nối sẽ loại bỏ những gian hàng đó.

00:06:20.000 --> 00:06:32.000
Để chọn tham gia, hãy đặt thuộc tính multipathServiceType thành .handover trên cấu hình URLSession của bạn hoặc trên NWParameters của bạn.

00:06:32.000 --> 00:06:39.000
Bật tùy chọn này và đảm bảo nó hoạt động với ứng dụng của bạn.

00:06:39.000 --> 00:06:52.000
Nếu bạn thiết kế giao thức của riêng mình sử dụng UDP trực tiếp, iOS 16 và macOS Ventura giới thiệu một cách tốt hơn để gửi datagrams.

00:06:52.000 --> 00:07:07.000
Biểu đồ dữ liệu QUIC cung cấp nhiều lợi ích so với UDP đơn giản, điều quan trọng nhất là biểu đồ dữ liệu QUIC phản ứng với tắc nghẽn trong mạng, điều này giữ thời gian khứ hồi thấp và giảm mất gói.

00:07:07.000 --> 00:07:19.000
Để chọn tham gia vào máy khách, hãy đặt isDatagram thành true trên các tùy chọn QUIC của bạn và đặt kích thước khung datagram tối đa mà bạn muốn sử dụng.

00:07:19.000 --> 00:07:27.000
Sau khi tạo luồng datagram, bạn có thể gửi và nhận trên đó giống như bất kỳ luồng QUIC nào khác.

00:07:27.000 --> 00:07:32.000
Bây giờ bạn đã biết phải làm gì trong ứng dụng của mình để giảm độ trễ.

00:07:32.000 --> 00:07:39.000
Tiếp theo, tôi sẽ giải thích cách các máy chủ tác động đến khả năng phản hồi của ứng dụng của bạn.

00:07:39.000 --> 00:07:49.000
Mặc dù thường xuyên chạy trên phần cứng hàng đầu, nhưng có thể máy chủ của bạn thực sự trở thành lý do cho sự chậm chạp trong ứng dụng của bạn.

00:07:49.000 --> 00:08:03.000
Chúng tôi đã giới thiệu công cụ chất lượng mạng trong macOS Monterey và bạn có thể sử dụng công cụ này để đo độ phồng bộ đệm trong mạng của nhà cung cấp dịch vụ cũng như trên máy chủ của bạn.

00:08:03.000 --> 00:08:09.000
Bạn cần cấu hình máy chủ của mình để hoạt động như một điểm đến cho công cụ chất lượng mạng.

00:08:09.000 --> 00:08:22.000
Khi bạn đã làm điều đó, hãy chạy công cụ networkQuality, trước tiên là chống lại máy chủ mặc định của Apple và sau đó chống lại máy chủ được định cấu hình của riêng bạn.

00:08:22.000 --> 00:08:35.000
Nếu công cụ đạt điểm cao khi sử dụng máy chủ mặc định, nhưng không tốt lắm khi nói chuyện với máy chủ của riêng bạn, có thể có chỗ để cải thiện khả năng phản hồi của máy chủ của bạn.

00:08:35.000 --> 00:08:50.000
Bây giờ, tôi sẽ chỉ cho bạn một ví dụ về việc chúng tôi đã sử dụng kỹ thuật này để cải thiện điều gì đó mà tất cả các bạn đang làm ngay bây giờ - phát trực tuyến video.

00:08:50.000 --> 00:09:01.000
Bạn có thể đã có trải nghiệm khi bạn bỏ qua một nơi khác trong video và cuối cùng bạn phải chờ đợi rất lâu trong khi nó lặp lại.

00:09:01.000 --> 00:09:08.000
Vì vậy, chúng tôi đã điều tra lý do cho sự chậm chạp này trong việc truy cập ngẫu nhiên.

00:09:08.000 --> 00:09:18.000
Chúng tôi đã sử dụng công cụ chất lượng mạng để kiểm tra hành vi của máy chủ phát trực tuyến và chúng tôi thấy rằng điểm phản hồi kém.

00:09:18.000 --> 00:09:23.000
Ở phía bên phải, tôi đã phát trực tuyến một video WWDC.

00:09:23.000 --> 00:09:26.000
Sau đó, tôi đã bỏ qua phía trước trong video.

00:09:26.000 --> 00:09:32.000
Màn hình không hiển thị bất cứ thứ gì trong khi video được đệm lại.

00:09:32.000 --> 00:09:36.000
Sau vài giây, video xuất hiện.

00:09:36.000 --> 00:09:46.000
Với sự trợ giúp của đầu ra chi tiết từ công cụ chất lượng mạng trên macOS, chúng tôi nhận thấy rằng có rất nhiều hàng đợi tại máy chủ.

00:09:46.000 --> 00:09:52.000
Vì vậy, chúng tôi đã xem xét cấu hình máy chủ.

00:09:52.000 --> 00:10:09.000
Cụ thể, chúng tôi đã xem xét các kích thước bộ đệm TCP, TLS và HTTP, được định cấu hình lần lượt thành 4MB, 256KB và 4MB.

00:10:09.000 --> 00:10:14.000
Bộ đệm rất lớn vì RAM rất dồi dào.

00:10:14.000 --> 00:10:22.000
Nhưng chỉ vì một số bộ đệm là tốt, không phải lúc nào cũng có nghĩa là bộ đệm nhiều hơn sẽ tốt hơn.

00:10:22.000 --> 00:10:41.000
Các phép đo khả năng phản hồi của chúng tôi đã làm nổi bật vấn đề chính xác này - một gói mới được tạo đã được xếp hàng phía sau dữ liệu cũ trong các bộ đệm lớn này và điều này đã tạo ra rất nhiều độ trễ bổ sung trong việc cung cấp gói gần đây nhất.

00:10:41.000 --> 00:10:57.000
Vì vậy, chúng tôi đã giảm kích thước bộ đệm xuống còn 256KB cho HTTP, 16KB cho TLS và 128KB cho TCP.

00:10:57.000 --> 00:11:05.000
Đây là tệp cấu hình cho Máy chủ Lưu lượng Apache hiển thị các tùy chọn đã được định cấu hình.

00:11:05.000 --> 00:11:16.000
Dấu nước thấp không gửi TCP được đặt thành 128KB cùng với các tùy chọn khác được bật để giảm bộ đệm.

00:11:16.000 --> 00:11:28.000
Đối với TLS, chúng tôi đã bật kích thước bản ghi động và đối với HTTP/2, chúng tôi đã giảm kích thước khối bộ đệm và dấu nước thấp.

00:11:28.000 --> 00:11:41.000
Chúng tôi khuyên bạn nên sử dụng các cấu hình này cho Máy chủ lưu lượng truy cập Apache của bạn và nếu bạn đang sử dụng một máy chủ web khác, hãy tìm kiếm các tùy chọn tương đương của nó.

00:11:41.000 --> 00:11:47.000
Sau khi thực hiện những thay đổi này, chúng tôi đã chạy lại công cụ chất lượng mạng.

00:11:47.000 --> 00:11:52.000
Và lần này chúng tôi có điểm RPM cao!

00:11:52.000 --> 00:12:03.000
Ở bên phải, tôi đã phát trực tuyến cùng một video, nhưng lần này khi tôi bỏ qua phía trước, video sẽ tiếp tục ngay lập tức.

00:12:03.000 --> 00:12:11.000
Bằng cách loại bỏ hàng đợi không cần thiết tại máy chủ, chúng tôi đã làm cho quyền truy cập ngẫu nhiên phản hồi nhanh hơn nhiều.

00:12:11.000 --> 00:12:24.000
Bất kể ứng dụng của bạn sử dụng mạng như thế nào, những thay đổi này trên máy chủ của bạn có thể làm cho ứng dụng của bạn phản hồi nhanh hơn và mang lại trải nghiệm người dùng tốt hơn.

00:12:24.000 --> 00:12:29.000
Đó là cách để cải thiện ứng dụng và cập nhật máy chủ của bạn.

00:12:29.000 --> 00:12:37.000
Có một yếu tố thứ ba ảnh hưởng lớn đến khả năng phản hồi; bản thân mạng.

00:12:37.000 --> 00:12:44.000
Apple đã giới thiệu công cụ chất lượng mạng trong iOS 15 và macOS Monterey.

00:12:44.000 --> 00:12:52.000
Kể từ đó, những người khác đã sử dụng cùng một phương pháp luận để phát triển các bài kiểm tra chất lượng mạng.

00:12:52.000 --> 00:12:56.000
Dạng sóng đã khởi động một thử nghiệm Bufferbloat.

00:12:56.000 --> 00:13:03.000
Có một triển khai mã nguồn mở của bài kiểm tra khả năng phản hồi, được viết bằng Go.

00:13:03.000 --> 00:13:11.000
Và Ookla đã thêm phép đo khả năng đáp ứng vào ứng dụng Speedtest của họ.

00:13:11.000 --> 00:13:24.000
Ứng dụng của Ookla hiển thị thời gian khứ hồi tính bằng mili giây và nếu bạn chia 60.000 cho con số đó, bạn sẽ nhận được số chuyến đi khứ hồi mỗi phút, hoặc RPM.

00:13:24.000 --> 00:13:30.000
Bạn có thể sử dụng những công cụ này để đo lường mạng của chính bạn đang hoạt động tốt như thế nào.

00:13:30.000 --> 00:13:37.000
Cách tốt nhất để hiểu sự chậm trễ trong mạng là với một ứng dụng nhạy cảm với độ trễ.

00:13:37.000 --> 00:13:43.000
Vì vậy, tôi sẽ cho bạn thấy trải nghiệm chia sẻ màn hình của tôi với một máy từ xa.

00:13:43.000 --> 00:13:54.000
Tôi thiết lập các điều kiện mạng để bắt chước một mạng truy cập đại diện, với lưu lượng truy cập từ các thiết bị khác chia sẻ mạng đó.

00:13:54.000 --> 00:14:01.000
Tại đây, tôi đã đăng nhập vào máy từ xa của mình bằng cách sử dụng Chia sẻ màn hình.

00:14:01.000 --> 00:14:09.000
Tôi đã nhấp vào các menu Finder khác nhau nhưng màn hình hiển thị của mỗi menu rất chậm chạp.

00:14:09.000 --> 00:14:21.000
Để kiểm tra xem sự tương tác này bị trì hoãn đến mức nào, tôi đã khởi chạy một ứng dụng hiển thị thời gian trên máy cục bộ của mình và tôi đã khởi chạy cùng một ứng dụng trên máy từ xa của mình.

00:14:21.000 --> 00:14:34.000
Mặc dù thời gian trên các máy tính này được đồng bộ hóa, màn hình từ xa của tôi không cập nhật thường xuyên và hiển thị thời gian bị trì hoãn vài giây.

00:14:34.000 --> 00:14:50.000
Lý do cho việc cập nhật bị trì hoãn này là sự hiện diện của một hàng đợi lớn ở liên kết chậm nhất của mạng và các gói từ ứng dụng Chia sẻ Màn hình bị kẹt trong hàng đợi lớn này.

00:14:50.000 --> 00:14:59.000
Để giải quyết vấn đề xếp hàng này, Apple đang làm việc với cộng đồng mạng trên một công nghệ mới có tên L4S.

00:14:59.000 --> 00:15:06.000
Nó có sẵn dưới dạng bản beta trong iOS 16 và macOS Ventura.

00:15:06.000 --> 00:15:14.000
L4S giảm đáng kể độ trễ xếp hàng và cũng đạt được tổn thất tắc nghẽn bằng không.

00:15:14.000 --> 00:15:29.000
Để giữ một hàng đợi ngắn nhất quán, mạng báo hiệu rõ ràng tắc nghẽn thay vì bỏ các gói tin và người gửi điều chỉnh tốc độ gửi của nó dựa trên phản hồi tắc nghẽn từ mạng.

00:15:29.000 --> 00:15:41.000
Điều này giúp bạn có thể giữ hàng đợi rất thấp trong mạng mà không làm mất bất kỳ gói nào và điều đó sẽ làm cho ứng dụng của bạn có khả năng phản hồi cao.

00:15:41.000 --> 00:15:48.000
Bây giờ, hãy xem L4S đã cải thiện Chia sẻ Màn hình như thế nào.

00:15:48.000 --> 00:15:57.000
Ở đây, tôi đã sử dụng cùng một máy và cùng một mạng ngoại trừ lần này, tôi đã bật L4S.

00:15:57.000 --> 00:16:02.000
Khi tôi nhấp vào các menu Finder khác nhau, chúng sẽ mở ngay lập tức.

00:16:02.000 --> 00:16:06.000
Tôi đã khởi chạy ứng dụng Time trên cả hai máy.

00:16:06.000 --> 00:16:16.000
Và bây giờ, thời gian trên cả màn hình từ xa và máy cục bộ gần như hoàn toàn đồng bộ.

00:16:16.000 --> 00:16:21.000
Công nghệ này không chỉ để chia sẻ màn hình.

00:16:21.000 --> 00:16:31.000
L4S cải thiện tất cả các ứng dụng ngày nay và mở ra cánh cửa cho các ứng dụng trong tương lai thậm chí không thể thực hiện được ngày hôm nay.

00:16:31.000 --> 00:16:46.000
Biểu đồ này vẽ biểu đồ thời gian khứ hồi trung bình quan sát được của các gói từ ứng dụng Chia sẻ màn hình đang chạy đồng thời với lưu lượng truy cập từ các thiết bị khác chia sẻ cùng một mạng.

00:16:46.000 --> 00:16:56.000
So sánh xếp hàng cổ điển so với L4S cho thấy có sự giảm đáng kể thời gian khứ hồi với L4S.

00:16:56.000 --> 00:17:05.000
Đây là lý do chính cho sự cải thiện đáng kể trong trải nghiệm chia sẻ màn hình của tôi.

00:17:05.000 --> 00:17:11.000
Kiểm tra ứng dụng của bạn sử dụng HTTP/3 hoặc QUIC với L4S.

00:17:11.000 --> 00:17:22.000
Bạn có thể bật L4S trong iOS 16 bên trong cài đặt Nhà phát triển hoặc trên macOS Ventura thông qua ghi mặc định.

00:17:22.000 --> 00:17:34.000
Để kiểm tra bằng máy chủ Linux, việc triển khai QUIC của bạn cần hỗ trợ ECN chính xác và thuật toán kiểm soát tắc nghẽn có thể mở rộng.

00:17:34.000 --> 00:17:50.000
Để đảm bảo rằng bạn đã sẵn sàng khi các mạng có khả năng L4S được triển khai, hãy kiểm tra ứng dụng của bạn về khả năng tương thích với L4S và cung cấp phản hồi về bất kỳ vấn đề nào bạn có thể gặp phải.

00:17:50.000 --> 00:17:58.000
Bây giờ bạn đã biết rằng giảm độ trễ là rất quan trọng để cải thiện khả năng phản hồi của ứng dụng.

00:17:58.000 --> 00:18:09.000
Vì vậy, hãy áp dụng HTTP/3 và QUIC, để giảm số lượng chuyến đi khứ hồi và phân phối nội dung nhanh hơn đến ứng dụng của bạn.

00:18:09.000 --> 00:18:17.000
Loại bỏ việc xếp hàng không cần thiết trên máy chủ của bạn để cung cấp tương tác phản hồi nhanh hơn.

00:18:17.000 --> 00:18:25.000
Kiểm tra khả năng tương thích của ứng dụng của bạn với L4S bằng cách bật nó trong cài đặt Nhà phát triển và cung cấp phản hồi.

00:18:25.000 --> 00:18:32.000
Và cuối cùng, hãy nói chuyện với nhà cung cấp máy chủ của bạn về việc bật hỗ trợ L4S.

00:18:32.000 --> 00:18:34.000
Cảm ơn vì đã xem!

00:18:34.000 --> 23:59:59.000
♪

