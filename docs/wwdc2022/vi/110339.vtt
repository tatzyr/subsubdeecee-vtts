WEBVTT

00:00:00.000 --> 00:00:09.000
♪ ♪

00:00:09.000 --> 00:00:12.000
Xin chào mọi người. Tôi là Elliot Garner.

00:00:12.000 --> 00:00:23.000
Tôi là một kỹ sư trong nhóm Công nghệ Internet và hôm nay tôi sẽ thảo luận về cách xây dựng trải nghiệm giữa thiết bị với thiết bị bằng cách sử dụng khung Mạng và khung đồng hành mới của nó, DeviceDiscoveryUI.

00:00:23.000 --> 00:00:30.000
Chúng ta sẽ bắt đầu bằng cách tìm hiểu về kết nối đa thiết bị và cách nó có thể cải thiện ứng dụng của bạn.

00:00:30.000 --> 00:00:39.000
Chúng ta sẽ khám phá cách một khung mới, DeviceDiscoveryUI, kết hợp với khung Mạng để làm cho kết nối đó đơn giản nhất có thể.

00:00:39.000 --> 00:00:55.000
Chúng tôi sẽ xem qua một ví dụ mã về cách cập nhật ứng dụng của bạn để sử dụng DeviceDiscoveryUI, bao gồm cái nhìn sâu sắc về cách khám phá các thiết bị bằng bộ chọn thiết bị hệ thống mới và cách kết nối với các thiết bị đó bằng Network framework.

00:00:55.000 --> 00:00:58.000
Vậy hãy bắt đầu với kết nối đa thiết bị.

00:00:58.000 --> 00:01:07.000
Kết nối và trao đổi dữ liệu giữa các thiết bị gần đó thường rất cần thiết để xây dựng trải nghiệm liền mạch, tích hợp trong các ứng dụng của bạn.

00:01:07.000 --> 00:01:13.000
Các ứng dụng thể dục và thiền định thường hoạt động tốt nhất trên màn hình lớn, nơi huấn luyện viên có thể thực hiện các động tác.

00:01:13.000 --> 00:01:20.000
Mọi người được hưởng lợi từ việc xem nhịp tim, lượng calo đốt cháy và dữ liệu chuyển động được thu thập từ Apple Watch của họ.

00:01:20.000 --> 00:01:33.000
Tương tự như vậy, trải nghiệm chơi game có thể được thực hiện sống động hơn với đầu vào và hành động từ iPhone được kết nối hoặc tăng cường bằng cách mở rộng trải nghiệm màn hình thứ hai sang iPad gần đó.

00:01:33.000 --> 00:01:43.000
Tất cả những trải nghiệm này - trò chơi, thể dục và ứng dụng chăm sóc sức khỏe - tất cả đều chia sẻ nhu cầu kết nối giữa các thiết bị đáng tin cậy và dễ sử dụng.

00:01:43.000 --> 00:01:46.000
Và tất cả bắt đầu với việc phát hiện ra một thiết bị.

00:01:46.000 --> 00:01:57.000
Để giúp khởi động khám phá đó, chúng tôi đang giới thiệu DeviceDiscoveryUI - một khuôn khổ mới cung cấp khám phá an toàn, bảo vệ quyền riêng tư cho các thiết bị gần đó.

00:01:57.000 --> 00:02:12.000
Mới trong iOS 16, DeviceDiscoveryUI kết hợp với khung Mạng để cho phép kết nối thiết bị với thiết bị giữa các ứng dụng Apple TV của bạn và iPhone, iPad và Đồng hồ Apple gần đó.

00:02:12.000 --> 00:02:19.000
DeviceDiscoveryUI cung cấp giao diện người dùng hệ thống để dễ dàng khám phá các thiết bị gần đó.

00:02:19.000 --> 00:02:24.000
Khi một thiết bị đã được phát hiện, ứng dụng của bạn có thể dễ dàng mở kết nối với thiết bị đó.

00:02:24.000 --> 00:02:32.000
Bởi vì kết nối này được thiết lập bằng giao diện người dùng hệ thống, bạn không cần phải lo lắng về việc quản lý quyền truy cập mạng cục bộ.

00:02:32.000 --> 00:02:42.000
Và bởi vì hệ thống xử lý việc thiết lập kết nối này một cách an toàn, bạn không còn cần phải triển khai trao đổi khóa của riêng mình nữa, bởi vì nền tảng mã hóa dữ liệu được truyền cho bạn.

00:02:42.000 --> 00:02:45.000
Ở đây chúng ta có thể thấy giao diện người dùng hệ thống đang hoạt động.

00:02:45.000 --> 00:02:55.000
Ở bên trái, biểu tượng ứng dụng của bạn được hiển thị, cùng với chuỗi mô tả sử dụng bắt buộc giải thích ứng dụng của bạn làm gì với kết nối giữa các thiết bị.

00:02:55.000 --> 00:02:59.000
Bên phải là danh sách các thiết bị được phát hiện.

00:02:59.000 --> 00:03:08.000
Bởi vì một số ứng dụng có thể chỉ khả dụng trên các nền tảng cụ thể, bạn có thể lọc các thiết bị được phát hiện theo nền tảng.

00:03:08.000 --> 00:03:15.000
Khi chọn "Adam's iPhone", hệ thống sẽ nhắc cho phép tạo kết nối giữa các thiết bị đó.

00:03:15.000 --> 00:03:21.000
Với sự đồng ý rõ ràng của người dùng này, bạn không còn cần yêu cầu quyền truy cập vào toàn bộ mạng cục bộ nữa.

00:03:21.000 --> 00:03:29.000
Và một khi quyền đã được cấp, ứng dụng của bạn sẽ được khởi chạy trên thiết bị đã chọn để xử lý các kết nối đến.

00:03:29.000 --> 00:03:35.000
Điều này có nghĩa là ứng dụng của bạn không còn cần phải chạy trên cả hai thiết bị trước khi kết nối có thể được thiết lập.

00:03:35.000 --> 00:03:44.000
Khi được cấp phép trên "Joe's Apple Watch", hệ thống sẽ ngay lập tức khởi chạy ứng dụng của bạn để hai thiết bị có thể kết nối.

00:03:44.000 --> 00:03:49.000
Và nếu ứng dụng của bạn không được cài đặt trên thiết bị đó, hệ thống sẽ đề nghị đưa mọi người đến App Store.

00:03:49.000 --> 00:03:54.000
Bằng cách đó họ có thể ngay lập tức tải xuống ứng dụng của bạn và bắt đầu sử dụng các tính năng mới của bạn.

00:03:54.000 --> 00:03:57.000
Đây là cách nó trông như thế nào trên watchOS.

00:03:57.000 --> 00:04:04.000
Nhấn vào nút sẽ ngay lập tức khởi chạy trang ứng dụng của bạn trong App Store, để tải xuống nhanh chóng và dễ dàng.

00:04:04.000 --> 00:04:13.000
Vì vậy, bây giờ chúng ta đã thảo luận về những gì DeviceDiscoveryUI có thể làm cho các ứng dụng của bạn, hãy xem cách áp dụng khuôn khổ mới này.

00:04:13.000 --> 00:04:18.000
Trong các phiên trước, chúng tôi đã xây dựng ứng dụng Tic-Tac-Toe bằng cách sử dụng khung Mạng.

00:04:18.000 --> 00:04:26.000
Hôm nay chúng tôi sẽ cập nhật nó để sử dụng DeviceDiscoveryUI để khám phá và kết nối với các thiết bị gần đó.

00:04:26.000 --> 00:04:31.000
Trong các lần lặp lại trước đó, ứng dụng của chúng tôi chỉ hỗ trợ chơi trò chơi giữa các thiết bị iOS.

00:04:31.000 --> 00:04:41.000
Vì vậy, để bắt đầu, chúng tôi đã cập nhật dự án của mình cho Universal Purchase và thêm mục tiêu tvOS và watchOS mà tất cả đều chia sẻ cùng một ID gói.

00:04:41.000 --> 00:04:49.000
Và chúng tôi đã thay đổi ứng dụng để thay vì cạnh tranh với người chơi khác, bạn đang sử dụng thiết bị của mình để chơi với AI trên TV.

00:04:49.000 --> 00:05:00.000
Tiếp theo, chúng tôi cần bổ sung vào Info.plist trên cả ứng dụng tvOS cũng như các nền tảng khác để khai báo dịch vụ ứng dụng Tic-Tac-Toe mới của chúng tôi.

00:05:00.000 --> 00:05:05.000
Cuối cùng, chúng tôi sẽ trình bày bộ chọn thiết bị mới và sử dụng các điểm cuối kết quả để tạo kết nối của chúng tôi.

00:05:05.000 --> 00:05:14.000
Bây giờ tôi sẽ chuyển sang Xcode và cho bạn thấy những khóa Info.plist mới đó là gì và chúng cần được thêm vào ứng dụng như thế nào.

00:05:14.000 --> 00:05:22.000
Trên tvOS, ứng dụng của chúng tôi cần cho hệ thống biết những dịch vụ ứng dụng nào cần khám phá và những nền tảng mà các dịch vụ đó hỗ trợ.

00:05:22.000 --> 00:05:28.000
Để làm điều đó, chúng ta cần thêm "Dịch vụ ứng dụng" Info.plist mới của mình.

00:05:28.000 --> 00:05:32.000
Từ điển này sẽ ánh xạ đến một trong hai mảng khác nhau.

00:05:32.000 --> 00:05:40.000
Trên tvOS, chúng ta cần khai báo mảng "Browses", chứa tất cả các dịch vụ ứng dụng mà ứng dụng của chúng tôi phát hiện ra.

00:05:40.000 --> 00:05:44.000
Mỗi mục nhập đại diện cho một dịch vụ ứng dụng khác nhau.

00:05:44.000 --> 00:05:48.000
Mặt hàng đầu tiên của chúng tôi đại diện cho dịch vụ ứng dụng Tic-Tac-Toe của chúng tôi.

00:05:48.000 --> 00:05:55.000
Đây là một từ điển chứa mã định danh dịch vụ, mô tả sử dụng và nền tảng mà dịch vụ này hỗ trợ của chúng tôi.

00:05:55.000 --> 00:06:00.000
Mã định danh dịch vụ là tên dịch vụ của chúng tôi, "TicTacToe".

00:06:00.000 --> 00:06:08.000
Mô tả sử dụng là một chuỗi sẽ được hiển thị trong bộ chọn thiết bị để giải thích lý do tại sao ứng dụng của chúng tôi cần quyền truy cập vào các thiết bị cục bộ khác.

00:06:08.000 --> 00:06:11.000
Cuối cùng, chúng tôi có hỗ trợ nền tảng của mình.

00:06:11.000 --> 00:06:18.000
Mảng này chứa các nền tảng được hỗ trợ bởi dịch vụ và hệ thống sẽ lọc các thiết bị được phát hiện cho phù hợp.

00:06:18.000 --> 00:06:24.000
Bạn có thể thấy ở đây rằng dịch vụ của chúng tôi hỗ trợ các thiết bị iOS, iPadOS và watchOS.

00:06:24.000 --> 00:06:31.000
Chúng tôi đã cập nhật Info.plist được sử dụng cho iOS và iPadOS với từ điển "Dịch vụ ứng dụng" tương ứng.

00:06:31.000 --> 00:06:35.000
Bây giờ chúng ta sẽ cập nhật danh sách cho watchOS.

00:06:35.000 --> 00:06:38.000
Lần này, chúng tôi khai báo mảng "Quảng cáo".

00:06:38.000 --> 00:06:47.000
Bởi vì DeviceDiscoveryUI sẽ khởi chạy ứng dụng của chúng tôi khi nó không chạy, hệ thống sử dụng mảng này để biết dịch vụ nào sẽ quảng cáo.

00:06:47.000 --> 00:06:52.000
Mục nhập của chúng tôi trong mảng "Quảng cáo" chỉ cần mã định danh dịch vụ "TicTacToe".

00:06:52.000 --> 00:06:59.000
Đảm bảo rằng mã định danh dịch vụ giống nhau cho mọi nền tảng đã được khai báo trong tvOS Info.plist.

00:06:59.000 --> 00:07:08.000
Bây giờ Tic-Tac-Toe đã được cấu hình để duyệt và quảng cáo dịch vụ ứng dụng của chúng tôi, hãy để nó thực sự hiển thị giao diện người dùng chọn thiết bị.

00:07:08.000 --> 00:07:10.000
Mô tả cách sử dụng của chúng tôi xuất hiện ở bên trái.

00:07:10.000 --> 00:07:18.000
Chúng tôi đảm bảo chuỗi này đang hoạt động và nó thông báo cho mọi người về lý do tại sao họ muốn kết nối thiết bị và dữ liệu họ đang chia sẻ.

00:07:18.000 --> 00:07:23.000
Đối với Tic-Tac-Toe, chúng tôi đang sử dụng thiết bị được kết nối làm bộ điều khiển để chơi trò chơi.

00:07:23.000 --> 00:07:40.000
Quay lại Xcode, vì DeviceDiscoveryUI thay thế nhu cầu duyệt thủ công các thiết bị gần đó và bảo mật kết nối cho chúng tôi, chúng tôi có thể xóa tệp PeerBrowser và phần mở rộng mật mã của chúng tôi cho NWParameters vì chúng không còn cần thiết nữa.

00:07:40.000 --> 00:07:48.000
Bây giờ, chúng tôi cần các thông số để mô tả cách chúng tôi muốn kết nối với các thiết bị gần đó.

00:07:48.000 --> 00:08:00.000
Đầu tiên, chúng tôi sử dụng trình khởi tạo tiện lợi mới, applicationService, trên NWParameters, cung cấp cho chúng tôi mọi thứ chúng tôi cần cho loại kết nối cục bộ này.

00:08:00.000 --> 00:08:10.000
Tiếp theo, chúng ta có thể sử dụng trình đóng khung hiện có của mình để giao tiếp các hành động chơi trò chơi mà không có bất kỳ thay đổi nào và chỉ cần thêm nó vào ngăn xếp giao thức trong các tham số đó.

00:08:10.000 --> 00:08:13.000
Bây giờ, chúng tôi đã sẵn sàng để tạo và hiển thị bộ chọn thiết bị.

00:08:13.000 --> 00:08:21.000
Bộ chọn thiết bị là cách ứng dụng của chúng tôi phát hiện iPhone, iPad và Đồng hồ Apple gần đó.

00:08:21.000 --> 00:08:26.000
Đầu tiên, chúng ta cần kiểm tra xem bộ chọn thiết bị có được hỗ trợ trên thiết bị hiện tại hay không.

00:08:26.000 --> 00:08:34.000
Để làm điều đó, chúng tôi gọi hàm isSupported với bộ mô tả duyệt và các tham số mà chúng tôi sẽ sử dụng với bộ chọn.

00:08:34.000 --> 00:08:40.000
Giả sử nó trả về đúng, chúng ta có thể tiếp tục và tạo bộ chọn thiết bị.

00:08:40.000 --> 00:08:55.000
Chúng tôi khởi tạo bộ chọn thiết bị với các tham số mà chúng tôi đã tạo trước đó và trình duyệt mô tả loại .applicationService, chỉ định tên của dịch vụ ứng dụng mà chúng tôi đã xác định trong Info.plist.

00:08:55.000 --> 00:09:00.000
Bây giờ bộ chọn thiết bị đã được tạo, chúng ta cần trình bày bộ điều khiển chế độ xem.

00:09:00.000 --> 00:09:07.000
Bộ chọn thiết bị cần phải luôn được trình bày dưới dạng chế độ xem phương thức toàn màn hình.

00:09:07.000 --> 00:09:12.000
Tiếp theo, chúng ta cần truy cập thuộc tính điểm cuối không đồng bộ của bộ chọn.

00:09:12.000 --> 00:09:21.000
Khi kết nối đã được xác nhận và ứng dụng của chúng tôi đã được khởi chạy trên thiết bị từ xa, chúng tôi sẽ nhận được NWEndpoint và việc thực thi sẽ tiếp tục.

00:09:21.000 --> 00:09:31.000
Bây giờ ứng dụng của chúng tôi đã nhận được NWEndpoint, chúng tôi có thể sử dụng nó để kết nối với thiết bị đã chọn, giống như chúng tôi đã làm trong các phiên bản Tic-Tac-Toe trước đó.

00:09:31.000 --> 00:09:37.000
Chúng tôi sẽ sử dụng các thông số tương tự khi mở kết nối như được cung cấp cho bộ chọn thiết bị.

00:09:37.000 --> 00:09:44.000
Ngoài các thông số, việc mở kết nối với thiết bị này trông giống hệt như trước đây.

00:09:44.000 --> 00:09:54.000
Chuyển sang thiết bị đã chọn, khi ứng dụng của chúng tôi đã được khởi chạy, chúng tôi cần ngay lập tức thực hiện lời hứa mà ứng dụng của chúng tôi đã thực hiện với hệ thống bằng cách tạo một NWListener.

00:09:54.000 --> 00:10:03.000
NWListener cần được tạo ngay sau khi ứng dụng được khởi chạy để chấp nhận bất kỳ kết nối đến nào cho dịch vụ ứng dụng đó.

00:10:03.000 --> 00:10:14.000
NWListener cần được tạo với các tham số giống hệt như trước đây và chúng ta cần đặt dịch vụ ứng dụng trên trình nghe bằng cách sử dụng mã định danh từ Info.plist.

00:10:14.000 --> 00:10:23.000
Khi TV mở kết nối với thiết bị này, trình nghe mà chúng tôi đã thiết lập sẽ nhận được kết nối đó ở đây, trong trình xử lý kết nối mới, giống như trước đây.

00:10:23.000 --> 00:10:29.000
Vì vậy, bây giờ kết nối đã được thiết lập đúng cách, chúng ta cần xử lý quá trình chuyển đổi trạng thái ứng dụng.

00:10:29.000 --> 00:10:37.000
Khi ứng dụng của chúng tôi được nền, kết nối sẽ chuyển sang trạng thái không thành công với lỗi liên quan ECONNABORTED.

00:10:37.000 --> 00:10:45.000
Nếu chúng tôi muốn tiếp tục giao tiếp giữa các thiết bị, chúng tôi sẽ thiết lập một kết nối mới từ TV đến cùng một điểm cuối.

00:10:45.000 --> 00:10:54.000
Sau khi bắt đầu, kết nối mới này vẫn ở trạng thái chuẩn bị và chuyển sang trạng thái sẵn sàng sau khi ứng dụng được tiếp tục trên thiết bị đã chọn.

00:10:54.000 --> 00:11:01.000
Trên thiết bị đó, kết nối mới sẽ được gửi đến cùng một NWListener và có thể được sử dụng để tiếp tục hoạt động của chúng tôi.

00:11:01.000 --> 00:11:02.000
Và thế là xong.

00:11:02.000 --> 00:11:07.000
Mọi thứ chúng ta cần làm để chuyển sang DeviceDiscoveryUI hiện đã hoàn tất.

00:11:07.000 --> 00:11:09.000
Hãy xem trò chơi của chúng ta đang hoạt động.

00:11:09.000 --> 00:11:19.000
Ứng dụng khởi chạy trên TV và chúng tôi nhấn Tìm đối thủ để trình bày bộ chọn thiết bị.

00:11:19.000 --> 00:11:22.000
Khi chúng tôi chọn một thiết bị, nó sẽ nhắc sự cho phép.

00:11:22.000 --> 00:11:32.000
Khi được cấp, ứng dụng được khởi chạy ngay lập tức vào phiên trò chơi của chúng tôi.

00:11:32.000 --> 00:11:43.000
Bây giờ, chúng ta có thể chơi với TV bằng cách đặt biểu tượng cảm xúc trên bảng.

00:11:43.000 --> 00:11:45.000
Tuyệt vời.

00:11:45.000 --> 00:11:49.000
Và đó là cách dễ dàng để kết nối các thiết bị với Apple TV.

00:11:49.000 --> 00:11:57.000
Tic-Tac-Toe có sẵn trên trang web của nhà phát triển, vì vậy bạn có thể tải xuống và khám phá tất cả mã mà chúng ta đã thảo luận hôm nay.

00:11:57.000 --> 00:12:01.000
Nếu bạn có bất kỳ câu hỏi nào, hãy đăng chúng lên Diễn đàn Nhà phát triển.

00:12:01.000 --> 00:12:07.000
Cân nhắc áp dụng DeviceDiscoveryUI trong các ứng dụng của bạn để cung cấp trải nghiệm liền mạch giữa thiết bị với thiết bị.

00:12:07.000 --> 00:12:10.000
Và vui lòng cung cấp phản hồi cho chúng tôi.

00:12:10.000 --> 00:12:14.000
Chúng tôi biết rằng giao tiếp giữa thiết bị với thiết bị là một trải nghiệm thiết yếu.

00:12:14.000 --> 00:12:17.000
DeviceDiscoveryUI được tạo ra để đáp ứng phản hồi của nhà phát triển.

00:12:17.000 --> 00:12:25.000
Chúng tôi muốn xây dựng các tính năng này với bạn, vì vậy vui lòng gửi báo cáo trong Trợ lý phản hồi cho bất kỳ điều gì bạn muốn thấy trong DeviceDiscoveryUI.

00:12:25.000 --> 00:12:31.000
Chúng tôi rất vui mừng được cùng nhau cải tiến công nghệ này để giúp làm cho ứng dụng của bạn trở nên tốt hơn.

00:12:31.000 --> 23:59:59.000
Cảm ơn bạn rất nhiều vì đã tham gia cùng tôi, và chúc bạn có một WWDC 2022 tuyệt vời.

