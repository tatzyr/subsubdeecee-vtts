WEBVTT

00:00:00.000 -> 00:00:09.000
♪インストゥルメンタルヒップホップ音楽♪

00:00:09.000 -> 00:00:13.000
こんにちは、私の名前はアダムで、開発者体験チームのマネージャーです。

00:00:13.000 -> 00:00:17.000
そして、私はXcodeクラウドチームのエンジニアであるSasanです。

00:00:17.000 -> 00:00:28.000
このセッションでは、既存のワークフローを確認し、新しいXcode Cloud Usageダッシュボードを強調することで、Xcode Cloudを最大限に活用する方法を紹介します。

00:00:28.000 -> 00:00:44.000
次に、既存のプロジェクトの使用状況の表示から学んだことを活用して、さらに最適化し、プロジェクトの新しいWatch OS Appバージョンの開発を開始する方法を見ていきます。その前に、Xcode Cloudの概要を簡単に見てみましょう。

00:00:44.000 -> 00:00:55.000
WWDC 2021では、Xcodeに組み込まれ、Apple開発者向けに特別に設計された継続的な統合および配信サービスであるXcode Cloudを発表しました。

00:00:55.000 -> 00:01:06.000
Xcode Cloudを使用すると、コードの開発と保守を支援し、テスターやユーザーにアプリを配信するのに役立つ標準的なソフトウェア開発プラクティスである継続的な統合と配信を採用できます。

00:01:06.000 -> 00:01:23.000
Xcode Cloudは、ユーザーのプライバシーを保護しながら、アプリの構築、自動テストの実行、テスターへのアプリの配信、ユーザーのフィードバックの表示、管理に役立つクラウドベースのツールをまとめることで、高品質のアプリの開発と配信を加速します。

00:01:23.000 -> 00:01:36.000
初めてXcode Cloudを設定する方法についてもっと知りたい場合は、WWDC 2021の「Meet Xcode Cloud」をチェックしてください。ホリーとジェフが最初のワークフローの設定について詳しく説明します。

00:01:36.000 -> 00:01:43.000
では、既存のワークフローを見て、Xcode Cloudのフードトラックアプリを構築しましょう。

00:01:43.000 -> 00:01:49.000
これはApp Store ConnectのXcode Cloudダッシュボードで、フードトラックプロジェクトの最近のビルドの概要を説明します。

00:01:49.000 -> 00:01:59.000
私たちは最近、コンパニオンwatchOSアプリを追加することを決定したので、フードトラックのオペレーターは、新しい注文が入ってくるたびに携帯電話に手を伸ばすことなく、時計からの着信注文をすばやく受け入れることができます。

00:01:59.000 -> 00:02:11.000
Xcode Cloudで新しいwatchOSアプリの構築を開始する前に、現在のワークフローとプロジェクトが完全に最適化されていることを確認し、必要なビルドとテストの結果をできるだけ早く入手したいと考えています。

00:02:11.000 -> 00:02:17.000
ここでは時間とリソースを節約できる方法があるかもしれないと思います。

00:02:17.000 -> 00:02:25.000
これらの最適化のいくつかを開始できる場所をよりよく理解するために、ビルドの詳細の概要を詳しく見てみましょう。

00:02:25.000 -> 00:02:29.000
まず、午前9時15分にビルドを開始したことに気づきました。

00:02:29.000 -> 00:02:33.000
そして、完了して結果を提示するのに14分かかりました。

00:02:33.000 -> 00:02:38.000
また、使用に関連する時間があり、この場合は32分です。

00:02:38.000 -> 00:02:43.000
これは、14分間のビルドのすべてのアクションが完了するまでにかかった合計時間です。

00:02:43.000 -> 00:02:49.000
使用状況の横には、このビルドのアクションの分布を表示するオプションが表示されます。

00:02:49.000 -> 00:02:57.000
各アクションは、それぞれの使用法とともに分割され、32分の合計が下部に示されています。

00:02:57.000 -> 00:03:02.000
この使用分布は、私たちがいくつかの最適化を行う可能性のあるいくつかの場所のアイデアを提供します。

00:03:02.000 -> 00:03:13.000
しかし、その前に、Xcode Cloudがこれらのアクションを実行する方法と、ビルド期間と使用状況の違いについて詳しく見てみましょう。

00:03:13.000 -> 00:03:18.000
各ビルドは、ワークフローの設定に応じて一連のアクションに分割されます。

00:03:18.000 -> 00:03:26.000
Xcode Cloudが各アクションを分析、アーカイブ、ビルド、テストなどの複数の並列アクションにどのように分割するかがわかります。

00:03:26.000 -> 00:03:38.000
これらのアクションは並行して実行されるため、ビルドの期間は最も長く実行されているアクションに等しくなります。この場合、ワークフローで設定したテストは、完了するのに14分かかりました。

00:03:38.000 -> 00:03:49.000
さて、使用量を計算するとき、これらのアクションのそれぞれが順番に観察されると、ビルドの合計計算使用量が得られます。この場合は32分です。

00:03:49.000 -> 00:03:55.000
そして、それがXcode Cloudが特定のビルドのビルド期間と使用状況を計算する方法です。

00:03:55.000 -> 00:04:00.000
では、App Store ConnectのXcode Cloud Usageダッシュボードを見てみましょう!

00:04:00.000 -> 00:04:09.000
一番上にあるのは、トラック・トゥ・テーブル・チームの月次サイクルの開始以来、使用された合計パーセンテージを含む使用状況の概要です。

00:04:09.000 -> 00:04:17.000
さらに、チームの現在のサイクルで利用可能な残りのコンピューティングとともに、合計使用量が分数で表されます。

00:04:17.000 -> 00:04:29.000
この下には、過去30日間のパーセンテージの増加または減少とともに、作成されたビルドと全体的な使用状況によって分割された、チームの使用傾向に特化したエリアがあります。

00:04:29.000 -> 00:04:38.000
別の期間の使用状況を確認したい場合は、トレンドセクションの右上隅にある期間を変更することで確認できます。

00:04:38.000 -> 00:04:48.000
ページの少し下には、上記で選択した期間中に、現在Xcode Cloudを使用している各製品の合計使用量が表示されます。

00:04:48.000 -> 00:04:55.000
さて、フードトラックを選択して、総使用量の内訳を確認しましょう。

00:04:55.000 -> 00:05:02.000
ここでは、チームビューから同じ傾向を見ることから始めますが、現在はフードトラックプロジェクトに固有のものです。

00:05:02.000 -> 00:05:06.000
ページの少し下には、各ワークフローの使用統計が表示されます。

00:05:06.000 -> 00:05:14.000
一見すると、リリースワークフローから、これはいくつかの最適化を開始するのに最適な場所になることがわかります。

00:05:14.000 -> 00:05:21.000
さて、私はそれをSasanに引き渡すつもりです。Sasanは、ビルドの詳細と計算の使用状況を観察した後、プロジェクトを最適化するいくつかの方法を紹介します。

00:05:21.000 -> 00:05:23.000
それがどのように行われるかを彼らに見せてください、ササン。

00:05:23.000 -> 00:05:24.000
ササン:ありがとう、アダム。

00:05:24.000 -> 00:05:29.000
フードトラックプロジェクトを使用して、Xcode Cloudを使用する際のベストプラクティスのいくつかをカバーしましょう。

00:05:29.000 -> 00:05:34.000
これにより、新しいwatchOSアプリですばやく反復を開始できるはずです。

00:05:34.000 -> 00:05:38.000
ワークフローは、開始条件を使用してビルドを開始するタイミングを定義します。

00:05:38.000 -> 00:05:44.000
ワークフローを意図した変更に対してのみビルドが開始されるように、開始条件を設定することが重要です。

00:05:44.000 -> 00:05:50.000
このプラクティスをフードトラックプロジェクトのリリースワークフローに適用する方法を見てみましょう。

00:05:50.000 -> 00:05:59.000
しかし、まず、より詳細な情報については、「Explore Xcode Cloud Workflows」をチェックすることをお勧めします。

00:05:59.000 -> 00:06:03.000
私はAdamがXcodeで以前に私たちに見せたのと同じビルドを持っています。

00:06:03.000 -> 00:06:09.000
まず、エディタウィンドウでリリースワークフローを開きましょう。

00:06:09.000 -> 00:06:19.000
ナビゲーションパネルでワークフローを右クリックし、[ワークフローの編集]を選択します。

00:06:19.000 -> 00:06:26.000
エディタウィンドウでは、開始条件のセクションを含む、ワークフローを構成するすべての設定可能なセクションを見ることができます。

00:06:26.000 -> 00:06:30.000
スケジュールされたビルドに新しい変更が含まれていないことがあることがわかりました。

00:06:30.000 -> 00:06:36.000
それに対処するために、既存のスケジュールされた開始条件を置き換えるために、ブランチ変更の新しい開始条件を追加しましょう。

00:06:36.000 -> 00:06:40.000
これにより、重複したコミットを作成しないことが保証されます。

00:06:40.000 -> 00:06:48.000
[プラス] ボタンで、[ブランチの変更] を選択します。

00:06:48.000 -> 00:06:55.000
スケジュールされた開始条件を削除するには、それを選択してゴミ箱アイコンをクリックします。

00:06:55.000 -> 00:06:59.000
ブランチの変更開始条件は、新しいコミットがリモートブランチにプッシュされるたびに実行されます。

00:06:59.000 -> 00:07:02.000
デフォルトでは、ソースブランチは任意のブランチに設定されています。

00:07:02.000 -> 00:07:08.000
これは、リポジトリのブランチに変更を加えると、このワークフローがビルドを開始することを意味します。

00:07:08.000 -> 00:07:17.000
リリースワークフローは徹底的に設定されているため、リリースブランチのビルドのみを開始するようにこれを制限したいと思います。

00:07:17.000 -> 00:07:26.000
カスタムブランチをクリックすると、カスタムブランチを指定する必要があることがすぐにわかります。

00:07:26.000 -> 00:07:33.000
プラスボタンをクリックして、ブランチ名を入力します。

00:07:33.000 -> 00:07:37.000
エディタでは、正確なブランチ名またはプレフィックスのいずれかを選択できます。

00:07:37.000 -> 00:07:46.000
この場合、複数のリリースブランチがあることを知っているので、「リリース」で始まるブランチを選択します。

00:07:46.000 -> 00:07:52.000
次に、リリースブランチからビルドを開始できるファイルとフォルダを指定します。

00:07:52.000 -> 00:07:56.000
私の目標は、docsフォルダが変更されたときにビルドを開始しないことです。

00:07:56.000 -> 00:08:01.000
このフォルダには開発ドキュメントのみが含まれているので、スキップしても安全です。

00:08:01.000 -> 00:08:05.000
[ファイルとフォルダー] オプションで、[カスタム条件] を選択します。

00:08:05.000 -> 00:08:12.000
[ビルドの開始]ドロップダウンを選択し、[ビルドを開始しない]を選択します。

00:08:12.000 -> 00:08:18.000
プラスボタンをクリックして、新しい条件を追加します。

00:08:18.000 -> 00:08:27.000
[任意のフォルダ] を選択して [選択] を選択して、除外するフォルダを指定します。

00:08:27.000 -> 00:08:29.000
最後に、これでファイルピッカーが開きます。

00:08:29.000 -> 00:08:35.000
これで、ドキュメントフォルダを選択して[開く]をクリックできます。

00:08:35.000 -> 00:08:43.000
最後に、[保存]をクリックして変更を永続化します。

00:08:43.000 -> 00:08:53.000
これで、開始条件は、リリースプレフィックスを持つブランチのみに制限し、ドキュメントフォルダの変更を無視することで、より選択的になるように設定しました。

00:08:53.000 -> 00:08:57.000
ワークフローは、事前に定義されたアクションを使用してビルドを実行する方法も定義します。

00:08:57.000 -> 00:09:03.000
アクションを使用すると、変更を分析、アーカイブ、構築、テストできます。

00:09:03.000 -> 00:09:08.000
テストアクションの重要な要素の1つは、テスト先の選択です。

00:09:08.000 -> 00:09:15.000
結果が迅速に配信されるように、テスト製品が構築されると、各宛先は並行して実行されます。

00:09:15.000 -> 00:09:20.000
テストのためにシミュレータの目的地の簡潔なセットを選択していることを確認したい。

00:09:20.000 -> 00:09:28.000
ビルドを高速化することに加えて、これは同様のデバイスで失敗する可能性のあるテストからのノイズを減らすのにも役立ちます。

00:09:28.000 -> 00:09:31.000
Xcode Cloudは、推奨される目的地のエイリアスを提供します。

00:09:31.000 -> 00:09:38.000
これらは、画面サイズの断面を表すシミュレータのキュレーションされたリストです。

00:09:38.000 -> 00:09:46.000
リリースワークフローをもう一度見て、iOSテストアクションの合理的なシミュレータの宛先を選択する方法を見てみましょう。

00:09:46.000 -> 00:09:52.000
テストiOSアクションを選択すると、幅広いテスト先があることがわかります。

00:09:52.000 -> 00:09:56.000
テスト先を削除するには、それぞれを選択し、マイナスボタンをクリックします。

00:09:56.000 -> 00:10:12.000
次に、最後の項目のドロップダウンメニューをクリックし、推奨iPhoneを選択します。

00:10:12.000 -> 00:10:22.000
繰り返しになりますが、[保存]をクリックして変更を永続化します。

00:10:22.000 -> 00:10:30.000
私は今、回帰を導入した場合に明確なシグナルを提供するのに役立つ一連のテスト先を持っています。

00:10:30.000 -> 00:10:36.000
先に説明したように、リポジトリに新しい変更をプッシュすると、Xcode Cloudがワークフローを実行します。

00:10:36.000 -> 00:10:42.000
コミットされる変更の種類に応じて、CIでの構築をスキップしたい場合があります。

00:10:42.000 -> 00:10:44.000
私たちはまさにそれを行う能力を追加しました。

00:10:44.000 -> 00:10:48.000
Xcodeで見てみましょう。 では見てみましょう。

00:10:48.000 -> 00:10:55.000
Xcode Cloudでコミットをスキップするには、コミットメッセージの最後に「ci skip」を追加するだけです。

00:10:55.000 -> 00:11:01.000
さて、リモートにプッシュすると、Xcode Cloudはこのイベントを無視することを知っています。

00:11:01.000 -> 00:11:07.000
ここに示されているciスキップタグの正確な形式を使用していることを確認してください。

00:11:07.000 -> 00:11:11.000
アクションごとに、カスタムスクリプトは複数のポイントで実行されます。

00:11:11.000 -> 00:11:21.000
未使用の依存関係を片付け、信頼性が低いことが知られているAPIリクエストを弾力的に再試行することで、ビルドが迅速かつ一貫して完了することを保証します。

00:11:21.000 -> 00:11:30.000
カスタムスクリプトやその他の高度なカスタマイズの詳細については、「高度なXcode Cloudワークフローのカスタマイズ」をご覧ください。

00:11:30.000 -> 00:11:35.000
テストでは、フレーク状で信頼性の低いテストが迅速に修正されていることを確認する必要があります。

00:11:35.000 -> 00:11:40.000
フレークテストが失敗した場合、本能はすぐにビルドを再試行することです。

00:11:40.000 -> 00:11:45.000
テストスイートの信頼性に応じて、これは多くの再試行されたビルドにつながる可能性があります。

00:11:45.000 -> 00:11:50.000
信頼できるテストを書くのにもっと時間を費やすようにしてください。

00:11:50.000 -> 00:11:58.000
それを効果的に行う方法の詳細については、他のセッション「Xcode Cloudの高速で信頼性の高いテスト」をご覧ください。

00:11:58.000 -> 00:12:03.000
これまでのところ、私たちはいくつかのベストプラクティスについて議論し、それらをフードトラックプロジェクトに適用しました。

00:12:03.000 -> 00:12:10.000
以前のビルドと更新されたワークフローのビルドを比較して、これらの変更がどのような影響を与えたかを見てみましょう。

00:12:10.000 -> 00:12:14.000
これは、ベストプラクティスを適用した後に開始されたビルドです。

00:12:14.000 -> 00:12:22.000
アダムが見せてくれた以前のビルドと比較して、持続時間は1分減少しましたが、使用量は4分減少しました。

00:12:22.000 -> 00:12:26.000
全体的に良い改善がなされたようです。

00:12:26.000 -> 00:12:31.000
影響をよりよく理解するために、使用状況ダッシュボードに戻りましょう。

00:12:31.000 -> 00:12:42.000
単一のビルドからの影響をすぐに見るのは難しいかもしれないので、別のワークフローである統合ワークフローにベストプラクティスを適用しました。

00:12:42.000 -> 00:12:45.000
私たちはしばらくの間、ベストプラクティスを適用してビルドを実行してきました。

00:12:45.000 -> 00:12:51.000
使用率が減少傾向にあるため、変更が効果的であったことがわかります。

00:12:51.000 -> 00:13:00.000
これは、watchOSアプリの開発を開始するために、より多くのワークフローを追加し、より多くのビルドを開始できるようになったことを意味します。

00:13:00.000 -> 00:13:09.000
使用状況ダッシュボードを使用すると、既存のプロジェクトやワークフローに同じベストプラクティスを引き続き適用して、Xcode Cloudを最大限に活用できます。

00:13:09.000 -> 00:13:16.000
大規模なチームのためにXcode Cloudを管理する方法の詳細については、チームのためにXcode Cloudにディープダイブをチェックしてください。

00:13:16.000 -> 00:13:18.000
あなたが私たちのセッションを楽しんだことを願っています。

00:13:18.000 -> 00:13:23.000
アダム:見てくれてありがとう。

00:13:23.000 -> 23:59:59.000
♪インストゥルメンタルヒップホップ音楽♪

