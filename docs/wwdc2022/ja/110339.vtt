WEBVTT

00:00:00.000 -> 00:00:09.000
♪ ♪

00:00:09.000 -> 00:00:12.000
みなさん、こんにちは。私はエリオット・ガーナーです。

00:00:12.000 -> 00:00:23.000
私はインターネット技術チームのエンジニアであり、今日はネットワークフレームワークとその新しいコンパニオンフレームワークであるDeviceDiscoveryUIを使用してデバイス間エクスペリエンスを構築する方法について説明します。

00:00:23.000 -> 00:00:30.000
まず、クロスデバイス接続と、それがアプリをどのように改善できるかについて学びます。

00:00:30.000 -> 00:00:39.000
新しいフレームワークであるDeviceDiscoveryUIは、ネットワークフレームワークと組み合わせて、その接続をできるだけシンプルにする方法を探ります。

00:00:39.000 -> 00:00:55.000
新しいシステムデバイスピッカーを使用してデバイスを検出する方法と、ネットワークフレームワークを使用してそれらのデバイスに接続する方法など、DeviceDiscoveryUIを使用するようにアプリを更新する方法のコード例を説明します。

00:00:55.000 -> 00:00:58.000
では、クロスデバイス接続から始めましょう。

00:00:58.000 -> 00:01:07.000
近くのデバイスに接続し、データを交換することは、多くの場合、アプリ内でシームレスで統合されたエクスペリエンスを構築するために不可欠です。

00:01:07.000 -> 00:01:13.000
フィットネスと瞑想のアプリは、多くの場合、コーチが動きを実演できる大画面で最もよく機能します。

00:01:13.000 -> 00:01:20.000
人々は、Apple Watchから収集された心拍数、カロリー消費、運動データを見ることで恩恵を受ける。

00:01:20.000 -> 00:01:33.000
同様に、ゲーム体験は、接続されたiPhoneからの入力とアクションでより没入感のあるものにしたり、セカンドスクリーン体験を近くのiPadに拡張することで拡張したりできます。

00:01:33.000 -> 00:01:43.000
ゲーム、フィットネス、ウェルネスアプリなど、これらの体験はすべて、信頼性が高く使いやすいクロスデバイス接続の必要性を共有しています。

00:01:43.000 -> 00:01:46.000
そして、それはすべてデバイスを発見することから始まります。

00:01:46.000 -> 00:01:57.000
その発見をキックスタートするために、近くのデバイスの安全でプライバシーを維持する発見を提供する新しいフレームワークであるDeviceDiscoveryUIを導入しています。

00:01:57.000 -> 00:02:12.000
iOS 16の新機能であるDeviceDiscoveryUIはネットワークフレームワークと組み合わせて、Apple TVアプリと近くのiPhone、iPad、Apple Watch間のデバイス間接続を可能にします。

00:02:12.000 -> 00:02:19.000
DeviceDiscoveryUIは、近くのデバイスを簡単に発見するためのシステムUIを提供します。

00:02:19.000 -> 00:02:24.000
デバイスが発見されると、アプリはそのデバイスへの接続を簡単に開くことができます。

00:02:24.000 -> 00:02:32.000
この接続はシステムUIを使用して確立されたため、ローカルネットワークアクセスのアクセス許可の管理について心配する必要はありません。

00:02:32.000 -> 00:02:42.000
また、システムはこの接続を安全に確立するため、プラットフォームが送信データを暗号化するため、独自の鍵交換を実装する必要がなくなります。

00:02:42.000 -> 00:02:45.000
ここでは、システムUIの動作を見ることができます。

00:02:45.000 -> 00:02:55.000
左側には、アプリのアイコンと、アプリがクロスデバイス接続で何をするかを説明する必要な使用説明文字列が表示されます。

00:02:55.000 -> 00:02:59.000
右側は、発見されたデバイスのリストです。

00:02:59.000 -> 00:03:08.000
一部のアプリは特定のプラットフォームでのみ利用できる可能性があるため、検出されたデバイスをプラットフォームごとにフィルタリングできます。

00:03:08.000 -> 00:03:15.000
「Adam's iPhone」を選択すると、システムはこれらのデバイス間の接続を作成する許可を求めます。

00:03:15.000 -> 00:03:21.000
この明示的なユーザーの同意により、ローカルネットワーク全体へのアクセスを要求する必要がなくなります。

00:03:21.000 -> 00:03:29.000
そして、許可が付与されると、アプリは選択したデバイスで起動され、着信接続を処理します。

00:03:29.000 -> 00:03:35.000
これは、接続を確立する前に、アプリを両方のデバイスで実行する必要がなくなったことを意味します。

00:03:35.000 -> 00:03:44.000
「Joe's Apple Watch」に許可が付与されると、システムはすぐにアプリを起動し、2つのデバイスが接続できるようにします。

00:03:44.000 -> 00:03:49.000
そして、あなたのアプリがそのデバイスにインストールされていない場合、システムは人々をApp Storeに連れて行くことを申し出ます。

00:03:49.000 -> 00:03:54.000
そうすれば、彼らはすぐにあなたのアプリをダウンロードし、あなたの新機能を使い始めることができます。

00:03:54.000 -> 00:03:57.000
watchOSでどのように見えるかは次のとおりです。

00:03:57.000 -> 00:04:04.000
ボタンをタップすると、App Storeでアプリのページがすぐに起動し、すばやく簡単にダウンロードできます。

00:04:04.000 -> 00:04:13.000
それでは、DeviceDiscoveryUIがあなたのアプリで何ができるかについて話し合ったので、この新しいフレームワークを採用する方法を見てみましょう。

00:04:13.000 -> 00:04:18.000
以前のセッションでは、ネットワークフレームワークを使用してTic-Tac-Toeアプリを構築しました。

00:04:18.000 -> 00:04:26.000
今日は、近くのデバイスの検出と接続にDeviceDiscoveryUIを使用するように更新します。

00:04:26.000 -> 00:04:31.000
以前の反復では、私たちのアプリはiOSデバイス間でゲームをプレイすることのみをサポートしていました。

00:04:31.000 -> 00:04:41.000
まず、ユニバーサル購入のプロジェクトを更新し、同じバンドルIDを共有するtvOSとwatchOSのターゲットを追加しました。

00:04:41.000 -> 00:04:49.000
そして、他のプレイヤーと競合する代わりに、デバイスを使用してテレビでAIと対戦するようにアプリを変更しました。

00:04:49.000 -> 00:05:00.000
次に、tvOSアプリケーションと他のプラットフォームの両方でInfo.plistを追加して、新しいTic-Tac-Toeアプリケーションサービスを宣言する必要があります。

00:05:00.000 -> 00:05:05.000
最後に、新しいデバイスピッカーを提示し、結果のエンドポイントを使用して接続を行います。

00:05:05.000 -> 00:05:14.000
次に、Xcodeに移行して、それらの新しいInfo.plistキーが何であるか、そしてそれらをどのようにアプリに追加する必要があるかをお見せします。

00:05:14.000 -> 00:05:22.000
tvOSでは、私たちのアプリは、どのアプリケーションサービスを発見し、それらのサービスがサポートしているプラットフォームをシステムに伝える必要があります。

00:05:22.000 -> 00:05:28.000
これを行うには、新しい「アプリケーションサービス」Info.plistを追加する必要があります。

00:05:28.000 -> 00:05:32.000
この辞書は、2つの異なる配列の1つにマップされます。

00:05:32.000 -> 00:05:40.000
tvOSでは、アプリが検出するすべてのアプリケーションサービスを含む「ブラウザ」配列を宣言する必要があります。

00:05:40.000 -> 00:05:44.000
各エントリは、異なるアプリケーションサービスを表しています。

00:05:44.000 -> 00:05:48.000
私たちの最初のアイテムは、私たちのTic-Tac-Toeアプリケーションサービスを表しています。

00:05:48.000 -> 00:05:55.000
これは、当社のサービス識別子、使用状況の説明、およびこのサービスがサポートするプラットフォームを含む辞書です。

00:05:55.000 -> 00:06:00.000
サービス識別子は、当社のサービスの名前「TicTacToe」です。

00:06:00.000 -> 00:06:08.000
使用状況の説明は、アプリが他のローカルデバイスにアクセスする必要がある理由を説明するためにデバイスピッカーに表示される文字列です。

00:06:08.000 -> 00:06:11.000
最後に、プラットフォームのサポートがあります。

00:06:11.000 -> 00:06:18.000
この配列には、サービスでサポートされているプラットフォームが含まれており、システムはそれに応じて検出されたデバイスをフィルタリングします。

00:06:18.000 -> 00:06:24.000
ここでは、当社のサービスがiOS、iPadOS、およびwatchOSデバイスをサポートしていることがわかります。

00:06:24.000 -> 00:06:31.000
iOSとiPadOSで使用されるInfo.plistを、対応する「アプリケーションサービス」辞書ですでに更新しました。

00:06:31.000 -> 00:06:35.000
次に、watchOSのplistを更新します。

00:06:35.000 -> 00:06:38.000
今回は、「広告」配列を宣言します。

00:06:38.000 -> 00:06:47.000
DeviceDiscoveryUIは実行されていないときにアプリを起動するため、システムはこの配列を使用して、どのサービスを宣伝するかを知る。

00:06:47.000 -> 00:06:52.000
「広告」配列のエントリには、「TicTacToe」サービス識別子のみが必要です。

00:06:52.000 -> 00:06:59.000
サービス識別子がtvOS Info.plistで宣言されたすべてのプラットフォームで同じであることを確認してください。

00:06:59.000 -> 00:07:08.000
Tic-Tac-Toeは、アプリケーションサービスを閲覧して宣伝するように構成されているので、実際にデバイスピッカーUIを表示させましょう。

00:07:08.000 -> 00:07:10.000
使用状況の説明が左側に表示されます。

00:07:10.000 -> 00:07:18.000
この文字列がアクティブであり、デバイスを接続したい理由と、共有しているデータを人々に知らせることを確認しました。

00:07:18.000 -> 00:07:23.000
Tic-Tac-Toeでは、接続されたデバイスをコントローラーとして使用してゲームをプレイしています。

00:07:23.000 -> 00:07:40.000
Xcodeに戻ると、DeviceDiscoveryUIは近くのデバイスを手動でブラウズする必要性を置き換え、接続を保護するため、不要になったため、PeerBrowserファイルとNWParametersのパスコード拡張子を削除できます。

00:07:40.000 -> 00:07:48.000
さて、近くのデバイスに接続する方法を説明するパラメータが必要です。

00:07:48.000 -> 00:08:00.000
まず、NWParametersで新しい便利な初期化子であるapplicationServiceを使用して、この種のローカル接続に必要なものがすべて提供されます。

00:08:00.000 -> 00:08:10.000
次に、既存のフレーマーを使用して、変更なしでゲームプレイアクションを通信し、それらのパラメータのプロトコルスタックに追加するだけです。

00:08:10.000 -> 00:08:13.000
これで、デバイスピッカーを作成して表示する準備が整いました。

00:08:13.000 -> 00:08:21.000
デバイスピッカーは、私たちのアプリケーションが近くのiPhone、iPad、Apple Watchを発見する方法です。

00:08:21.000 -> 00:08:26.000
まず、デバイスピッカーが現在のデバイスでサポートされているかどうかを確認する必要があります。

00:08:26.000 -> 00:08:34.000
これを行うには、ピッカーで使用するブラウズ記述子とパラメータでisSupported関数を呼び出します。

00:08:34.000 -> 00:08:40.000
Trueを返すと仮定すると、先に進んでデバイスピッカーを作成できます。

00:08:40.000 -> 00:08:55.000
先ほど作成したパラメータと、.applicationService型のブラウズ記述子を使用してデバイスピッカーをインスタンス化し、Info.plistで定義したアプリケーションサービスの名前を指定します。

00:08:55.000 -> 00:09:00.000
デバイスピッカーが作成されたので、ビューコントローラーを提示する必要があります。

00:09:00.000 -> 00:09:07.000
デバイスピッカーは常にフルスクリーンのモーダルビューとして表示する必要があります。

00:09:07.000 -> 00:09:12.000
次に、ピッカーの非同期エンドポイントプロパティにアクセスする必要があります。

00:09:12.000 -> 00:09:21.000
接続が確認され、アプリケーションがリモートデバイスで起動されると、NWEndpointを受け取り、実行が継続されます。

00:09:21.000 -> 00:09:31.000
アプリケーションがNWEndpointを受け取ったので、以前のTic-Tac-Toeバージョンで行ったように、それを使用して選択したデバイスに接続できます。

00:09:31.000 -> 00:09:37.000
接続を開くときは、デバイスピッカーに提供されたのと同じパラメータを使用します。

00:09:37.000 -> 00:09:44.000
パラメータは別として、このデバイスへの接続を開くと、以前とまったく同じように見えます。

00:09:44.000 -> 00:09:54.000
選択したデバイスに移動し、アプリケーションが起動されたら、NWListenerを作成することで、アプリケーションがシステムに行った約束をすぐに果たす必要があります。

00:09:54.000 -> 00:10:03.000
NWListenerは、そのアプリケーションサービスの着信接続を受け入れるために、アプリが起動されるとすぐに作成する必要があります。

00:10:03.000 -> 00:10:14.000
NWListenerは以前とまったく同じパラメータで作成する必要があり、Info.plistの識別子を使用してリスナーにアプリケーションサービスを設定する必要があります。

00:10:14.000 -> 00:10:23.000
テレビがこのデバイスへの接続を開くと、私たちが確立したリスナーは、以前と同じように、新しい接続ハンドラでその接続を受け取ります。

00:10:23.000 -> 00:10:29.000
そのため、接続が適切に確立されたので、アプリケーションの状態遷移を処理する必要があります。

00:10:29.000 -> 00:10:37.000
アプリケーションがバックグラウンド化されると、接続は関連するエラーECONNABORTEDで失敗した状態に移行します。

00:10:37.000 -> 00:10:45.000
デバイス間の通信を継続したい場合は、テレビから同じエンドポイントへの新しい接続を確立します。

00:10:45.000 -> 00:10:54.000
開始すると、この新しい接続は準備状態にとどまり、選択したデバイスでアプリが再開されると準備完了状態に移行します。

00:10:54.000 -> 00:11:01.000
そのデバイスでは、新しい接続が同じNWListenerに配信され、アクティビティを再開するために使用できます。

00:11:01.000 -> 00:11:02.000
そして、それだけです。

00:11:02.000 -> 00:11:07.000
DeviceDiscoveryUIに移行するために必要なことがすべて完了しました。

00:11:07.000 -> 00:11:09.000
私たちのゲームが実際に動いているのを見てみましょう。

00:11:09.000 -> 00:11:19.000
アプリはテレビで起動し、Find Opponentを押してデバイスピッカーを提示します。

00:11:19.000 -> 00:11:22.000
デバイスを選択すると、許可を求められます。

00:11:22.000 -> 00:11:32.000
許可されると、アプリはすぐにゲームセッションに起動します。

00:11:32.000 -> 00:11:43.000
今、私たちはボードに絵文字を置くことでテレビと対戦することができます。

00:11:43.000 -> 00:11:45.000
すごい。

00:11:45.000 -> 00:11:49.000
そして、それがApple TVにデバイスを接続するのがどれほど簡単かです。

00:11:49.000 -> 00:11:57.000
Tic-Tac-Toeは開発者のウェブサイトで利用できるので、ダウンロードして、今日説明したすべてのコードを探索できます。

00:11:57.000 -> 00:12:01.000
ご不明な点がございましたら、開発者フォーラムに投稿してください。

00:12:01.000 -> 00:12:07.000
デバイス間シームレスなエクスペリエンスを提供するために、アプリにDeviceDiscoveryUIを採用することを検討してください。

00:12:07.000 -> 00:12:10.000
そして、私たちにフィードバックを提供してください。

00:12:10.000 -> 00:12:14.000
私たちは、デバイス間通信が不可欠な経験であることを知っています。

00:12:14.000 -> 00:12:17.000
DeviceDiscoveryUIは、開発者のフィードバックに応じて作成されました。

00:12:17.000 -> 00:12:25.000
私たちはあなたと一緒にこれらの機能を構築したいので、DeviceDiscoveryUIで見たいものについては、フィードバックアシスタントにレポートを提出してください。

00:12:25.000 -> 00:12:31.000
私たちはあなたのアプリをさらに良くするために、この技術を一緒に改善することに興奮しています。

00:12:31.000 -> 23:59:59.000
参加してくれてありがとう、そして素晴らしいWWDC 2022をお過ごしください。

