WEBVTT

00:00:00.000 --> 00:00:10.000
♪ ♪

00:00:10.000 --> 00:00:16.000
Ricky: Xin chào, tôi là Ricky, và chào mừng đến với "Có gì mới trong StoreKit 2 và StoreKit Testing trong Xcode."

00:00:16.000 --> 00:00:24.000
Trong phiên này, tôi sẽ nói về các tính năng mới mà chúng tôi sẽ mang đến StoreKit trong năm nay, cũng như những cải tiến cho trải nghiệm thử nghiệm trong Xcode.

00:00:24.000 --> 00:00:32.000
StoreKit 2 lần đầu tiên được giới thiệu tại WWDC vào năm 2021, với các API mới và linh hoạt hơn sử dụng Swift.

00:00:32.000 --> 00:00:37.000
Năm nay, tôi rất vui được giới thiệu cho bạn các tính năng mới giúp StoreKit 2 trở nên tốt hơn.

00:00:37.000 --> 00:00:50.000
Đầu tiên, tôi sẽ xem xét các tính năng khung StoreKit mới, sau đó, tôi sẽ chia sẻ một số cập nhật để xây dựng các ứng dụng SwiftUI bằng StoreKit và cuối cùng, tôi sẽ đề cập đến những gì mới trong Kiểm tra StoreKit trong Xcode.

00:00:50.000 --> 00:00:58.000
Tôi rất vui mừng được giới thiệu một Swift API mới để quản lý các giao dịch mua trong ứng dụng được quảng cáo, có sẵn bắt đầu từ iOS 16.4.

00:00:58.000 --> 00:01:06.000
Mua hàng trong ứng dụng được quảng cáo là một tính năng cho phép bạn bán sản phẩm của mình trên trang sản phẩm App Store, mỗi sản phẩm đều có một hình ảnh quảng cáo chuyên dụng.

00:01:06.000 --> 00:01:14.000
Quảng bá các giao dịch mua trong ứng dụng của bạn là một cách tuyệt vời để tăng khả năng hiển thị sản phẩm của bạn và bạn có thể dễ dàng thiết lập các giao dịch mua được quảng cáo trong App Store Connect.

00:01:14.000 --> 00:01:20.000
Để tìm hiểu thêm về cách định cấu hình mua hàng trong ứng dụng được quảng cáo, hãy xem "Có gì mới trong App Store Connect."

00:01:20.000 --> 00:01:29.000
Vì các giao dịch mua trong ứng dụng được quảng cáo được liệt kê trên App Store, khi khách hàng mua một sản phẩm được quảng cáo, sự tương tác của họ bắt đầu ở đây bằng cách nhấn vào nút mua hàng.

00:01:29.000 --> 00:01:37.000
Sau đó, App Store sẽ gửi dữ liệu mua hàng đến ứng dụng của bạn, nơi bạn có thể lắng nghe thông tin này và nhắc họ hoàn tất giao dịch mua.

00:01:37.000 --> 00:01:47.000
Để lắng nghe các giao dịch mua được quảng cáo, hãy sử dụng trình tự không đồng bộ Swift nhận được ý định mua hàng mới mỗi khi khách hàng bắt đầu mua sản phẩm được quảng cáo trong App Store.

00:01:47.000 --> 00:01:54.000
Đầu tiên, tạo một trình nghe để nhận ý định mua hàng bằng cách sử dụng PurchaseIntent.intents.

00:01:54.000 --> 00:02:01.000
Mỗi khi chuỗi nhận được một đối tượng mới, nó chứa Sản phẩm StoreKit được liên kết với giao dịch mua.

00:02:01.000 --> 00:02:10.000
Bạn có thể nhắc khách hàng của mình mua các sản phẩm này như bình thường bằng cách gọi purchase(), hiển thị bảng thanh toán quen thuộc và cho phép họ hoàn thành tương tác ở đó.

00:02:10.000 --> 00:02:16.000
Nếu ứng dụng của bạn chưa sẵn sàng để hoàn tất giao dịch mua, bạn cũng có thể lưu ý định cục bộ và trì hoãn nó.

00:02:16.000 --> 00:02:20.000
Bạn luôn có thể xử lý nó sau.

00:02:20.000 --> 00:02:27.000
Một tính năng khác của việc quảng bá mua hàng trong ứng dụng là có thể tùy chỉnh cách sản phẩm của bạn được hiển thị cục bộ trên thiết bị hiện tại.

00:02:27.000 --> 00:02:35.000
Ví dụ: nếu khách hàng mua một trong những sản phẩm này, bạn có thể ẩn nó, vì vậy App Store không hiển thị lại khi họ duyệt hoặc tìm kiếm.

00:02:35.000 --> 00:02:45.000
Bạn cũng có thể thay đổi thứ tự sản phẩm hoặc tập hợp con các sản phẩm nổi bật, dựa trên trạng thái hiện tại trong ứng dụng của bạn, ví dụ: tiến bộ cấp độ trong trò chơi.

00:02:45.000 --> 00:02:54.000
Để bao gồm tất cả các trường hợp này, tôi rất vui được giới thiệu cho bạn một số API Swift mới mà bạn có thể sử dụng để tùy chỉnh đơn đặt hàng và khả năng hiển thị các giao dịch mua trong ứng dụng được quảng cáo của mình.

00:02:54.000 --> 00:02:56.000
Hãy xem một cuộc trình diễn nhanh.

00:02:56.000 --> 00:03:04.000
Sau khi nhập StoreKit, bạn có thể kiểm tra đơn hàng khuyến mãi hiện tại với Product.PromotionInfo.currentOrder.

00:03:04.000 --> 00:03:09.000
Điều này trả về một chuỗi các đối tượng PromotionInfo, theo thứ tự hiện đang được đặt.

00:03:09.000 --> 00:03:18.000
Nếu danh sách này trống, điều đó có nghĩa là không có ghi đè cục bộ nào được đặt cho thiết bị này và các sản phẩm mà mọi người nhìn thấy trong App Store theo cùng thứ tự mà bạn đã định cấu hình trong App Store Connect.

00:03:18.000 --> 00:03:24.000
Mỗi đối tượng trong chuỗi này chứa thông tin liên quan đến một sản phẩm được quảng cáo trong ứng dụng của bạn.

00:03:24.000 --> 00:03:36.000
Để đặt thứ tự khuyến mãi tùy chỉnh, bạn có thể sử dụng API Product.PromotionInfo.updateProductOrder và chuyển danh sách số nhận dạng sản phẩm theo thứ tự bạn muốn chúng xuất hiện trong App Store cho thiết bị này.

00:03:36.000 --> 00:03:40.000
Bạn cũng có thể ẩn và hiển thị sản phẩm mà không cần phải đặt hàng hoàn toàn mới.

00:03:40.000 --> 00:03:45.000
Điều này có thể được thực hiện bằng cách thay đổi thuộc tính hiển thị liên quan đến các giao dịch mua trong ứng dụng được quảng cáo.

00:03:45.000 --> 00:03:58.000
Trạng thái hiển thị có thể hiển thị, ẩn hoặc mặc định, tuân theo các cài đặt bạn định cấu hình trong App Store Connect và áp dụng cho tất cả các thiết bị không có ghi đè cục bộ do ứng dụng của bạn đặt.

00:03:58.000 --> 00:04:01.000
Hãy xem làm thế nào chúng ta có thể thay đổi điều này trong mã.

00:04:01.000 --> 00:04:05.000
Giá trị khả năng hiển thị có thể được thay đổi theo một vài cách khác nhau.

00:04:05.000 --> 00:04:17.000
Ứng dụng của bạn có thể gọi Product.PromotionInfo. updateProductVisibility API và thay đổi giá trị cho một sản phẩm duy nhất bằng cách chuyển cả trạng thái hiển thị mới và số nhận dạng của giao dịch mua trong ứng dụng đó.

00:04:17.000 --> 00:04:24.000
Ngoài ra, bạn cũng có thể thay đổi giá trị hiển thị bằng cách đặt thuộc tính thành viên trên mỗi đối tượng PromotionInfo.

00:04:24.000 --> 00:04:29.000
Sau đó, để lưu các thay đổi, hãy gọi update() trên cùng một đối tượng mà bạn vừa sửa đổi.

00:04:29.000 --> 00:04:35.000
Và đó là mọi thứ bạn cần để bắt đầu sử dụng các giao dịch mua trong ứng dụng được quảng cáo với StoreKit 2.

00:04:35.000 --> 00:04:42.000
Bây giờ, tôi muốn cho bạn thấy một số cải tiến mà chúng tôi đã thực hiện đối với mô hình dữ liệu cốt lõi trong StoreKit 2.

00:04:42.000 --> 00:04:51.000
Những mô hình này rất hữu ích cho việc quản lý các giao dịch mua trong ứng dụng của bạn và thông tin liên quan, ví dụ: ngày mua và trạng thái đăng ký.

00:04:51.000 --> 00:05:00.000
Hãy đi sâu vào các lĩnh vực mới mà chúng tôi đang thêm vào mô hình dữ liệu Giao dịch và Thông tin Gia hạn, mang lại những cải tiến tuyệt vời mà nhiều bạn yêu cầu.

00:05:00.000 --> 00:05:07.000
Trường mới đầu tiên là storefront, và nó xuất hiện trong mô hình Giao dịch cùng với storefrontCountryCode.

00:05:07.000 --> 00:05:09.000
Lĩnh vực mới tiếp theo được gọi là lý do.

00:05:09.000 --> 00:05:16.000
Nó cho bạn biết liệu một khách hàng đã bắt đầu mua hàng hay giao dịch là gia hạn đăng ký tự động.

00:05:16.000 --> 00:05:22.000
Trong mô hình RenewalInfo bên dưới Product.SubscriptionInfo, có một thành viên mới được gọi là nextRenewalDate.

00:05:22.000 --> 00:05:26.000
Điều này cho bạn biết khi nào việc gia hạn đăng ký này sẽ được xử lý.

00:05:26.000 --> 00:05:39.000
Tất cả các trường mới này đều có sẵn cho các ứng dụng bạn xây dựng bằng Xcode 15 và mặc dù ban đầu được phát hành với iOS 17, hầu hết chúng cũng hoạt động hồi tố với các phiên bản iOS trước cũng như khi bạn đang sử dụng StoreKit 2.

00:05:39.000 --> 00:05:44.000
Tiếp theo, tôi muốn nói về Tin nhắn StoreKit và tính năng mới tuyệt vời mà chúng tôi vừa thêm vào.

00:05:44.000 --> 00:05:52.000
Chúng tôi đã giới thiệu API Tin nhắn vào năm ngoái tại WWDC 2022 như một cách để App Store thông báo cho khách hàng của bạn về thông tin quan trọng.

00:05:52.000 --> 00:05:56.000
Tin nhắn có giá trị Lý do cho bạn biết mục đích của tin nhắn.

00:05:56.000 --> 00:06:00.000
Ứng dụng của bạn có thể chọn trì hoãn hay chặn tin nhắn.

00:06:00.000 --> 00:06:06.000
Ví dụ, bạn có thể muốn trì hoãn một tin nhắn nếu việc hiển thị nó sẽ làm gián đoạn khách hàng của bạn trong quá trình tương tác.

00:06:06.000 --> 00:06:12.000
Nếu không, StoreKit sẽ tự động hiển thị bất kỳ tin nhắn đang hoạt động nào khi ứng dụng của bạn khởi chạy.

00:06:12.000 --> 00:06:15.000
Năm nay, chúng tôi đã thêm một lý do tin nhắn mới được gọi là billingIssue.

00:06:15.000 --> 00:06:19.000
Thông báo này có sẵn bắt đầu từ iOS 16.4.

00:06:19.000 --> 00:06:24.000
App Store gửi thông báo này khi đăng ký không gia hạn do sự cố thanh toán.

00:06:24.000 --> 00:06:30.000
StoreKit hiển thị bảng Vấn đề Thanh toán và khách hàng có thể giải quyết vấn đề mà không cần rời khỏi ứng dụng của bạn.

00:06:30.000 --> 00:06:33.000
Thuộc tính mới này đã được bật trong hộp cát để cho bạn thời gian kiểm tra nó.

00:06:33.000 --> 00:06:40.000
Vui lòng kiểm tra lại trên trang web Nhà phát triển Apple vào cuối năm nay để cập nhật về thời điểm điều này sẽ được bật cho tất cả khách hàng.

00:06:40.000 --> 00:06:46.000
Khi App Store không gia hạn đăng ký, đăng ký sẽ chuyển sang trạng thái Thử lại thanh toán.

00:06:46.000 --> 00:06:53.000
Để tìm hiểu về cách kiểm tra tính năng này trong hộp cát, vui lòng tham khảo phiên WWDC về kiểm tra mua hàng trong ứng dụng.

00:06:53.000 --> 00:06:56.000
Bây giờ, hãy xem lại một số cập nhật liên quan đến bảo mật.

00:06:56.000 --> 00:07:07.000
Để cập nhật StoreKit với các phương pháp bảo mật hiện đại, chúng tôi đang di chuyển chứng chỉ ký biên lai của mình từ sử dụng SHA-1 sang SHA-256 cho biên lai " StoreKit gốc".

00:07:07.000 --> 00:07:20.000
Các phiên bản hiện đại của thư viện mật mã, như OpenSSL, đã hỗ trợ SHA-256, nhưng nếu ứng dụng của bạn thực hiện xác thực hóa đơn trên thiết bị, điều quan trọng là bạn phải xác minh rằng nó xử lý chứng chỉ mới đúng cách.

00:07:20.000 --> 00:07:33.000
Chứng chỉ ký SHA-256 mới sẽ được sử dụng để ký biên lai trong hộp cát bắt đầu từ ngày 20 tháng 6 và bạn sẽ có thể kiểm tra trên các thiết bị chạy iOS 16.6 và macOS 13.5 trở lên.

00:07:33.000 --> 00:07:40.000
Sau ngày 14 tháng 8, chứng chỉ mới sẽ được sử dụng để ký biên lai cho tất cả các ứng dụng mới và cập nhật ứng dụng được gửi đến App Store.

00:07:40.000 --> 00:07:45.000
Để biết thêm chi tiết về dòng thời gian này, bạn có thể kiểm tra trang web Nhà phát triển Apple.

00:07:45.000 --> 00:07:48.000
Nếu ứng dụng của bạn sử dụng StoreKit 2, bạn không cần phải làm gì cả.

00:07:48.000 --> 00:07:54.000
Giao dịch đã ký, Thông tin gia hạn và Giao dịch ứng dụng của StoreKit 2 đã sử dụng SHA-256 ngày hôm nay.

00:07:54.000 --> 00:08:03.000
Và nếu bạn sử dụng API máy chủ App Store để xác thực hóa đơn, bạn cũng không cần thực hiện bất kỳ thay đổi nào, vì chúng tôi tự động xử lý định dạng mới.

00:08:03.000 --> 00:08:12.000
Tiếp theo, tôi rất vui được giới thiệu cho bạn một bộ tính năng hoàn toàn mới cho StoreKit giúp việc mua hàng trong ứng dụng trong ứng dụng của bạn trở nên rất dễ dàng và nhanh chóng, sử dụng SwiftUI.

00:08:12.000 --> 00:08:20.000
Có các API mới để tạo chế độ xem SwiftUI cho các giao dịch mua trong ứng dụng đơn lẻ, toàn bộ cửa hàng sản phẩm và thậm chí một số tùy chỉnh dành riêng cho đăng ký.

00:08:20.000 --> 00:08:28.000
Những chức năng này giống như chế độ xem SwiftUI bình thường và yêu cầu mã tối thiểu để triển khai, cho phép bạn bắt đầu và chạy với ứng dụng của mình nhanh nhất có thể.

00:08:28.000 --> 00:08:31.000
Hãy cùng xem những quan điểm mới này.

00:08:31.000 --> 00:08:40.000
Với chế độ xem sản phẩm này, bạn có thể đại diện cho một giao dịch mua trong ứng dụng duy nhất, hoàn chỉnh với tiêu đề, mô tả được bản địa hóa và thậm chí cả hình ảnh quảng cáo tùy chọn.

00:08:40.000 --> 00:08:44.000
Bạn có thể tạo nó bằng cách chuyển mã định danh sản phẩm cho ProductView.

00:08:44.000 --> 00:08:46.000
Và cũng không cần tải sản phẩm StoreKit.

00:08:46.000 --> 00:08:48.000
Bạn chỉ có thể sử dụng chuỗi productID.

00:08:48.000 --> 00:08:51.000
StoreKit và SwiftUI sẽ lo phần còn lại.

00:08:51.000 --> 00:08:56.000
Ngoài ra còn có một chế độ xem mới để hiển thị toàn bộ bộ sưu tập sản phẩm, như một cửa hàng ngay trong ứng dụng của bạn.

00:08:56.000 --> 00:09:09.000
Thay vì chuyển một mã định danh sản phẩm duy nhất, bạn có thể sử dụng bộ sưu tập ID sản phẩm kết hợp với StoreView để tạo danh sách các sản phẩm thành hàng hóa, sau đó bạn có thể tùy chỉnh thêm bằng cách sử dụng các thành phần SwiftUI.

00:09:09.000 --> 00:09:18.000
StoreView là một cách tuyệt vời để bắt đầu ứng dụng hoặc trò chơi của bạn và hỗ trợ mua hàng trong ứng dụng, vì nó chỉ yêu cầu một vài dòng mã để thiết lập, như được hiển thị ở đây.

00:09:18.000 --> 00:09:25.000
Cuối cùng nhưng không kém phần quan trọng, cũng có một cái nhìn mới về đăng ký hàng hóa với tất cả các cấp độ dịch vụ có sẵn của chúng.

00:09:25.000 --> 00:09:31.000
Sử dụng SubscriptionStoreView để nhanh chóng tạo một trang tùy chỉnh cho một nhóm đăng ký, như thế này.

00:09:31.000 --> 00:09:40.000
Tất cả những gì bạn cần là subscriptionGroupID, mà bạn thường có thể tìm thấy trong App Store Connect, nhưng bây giờ nó cũng có sẵn trong cấu hình StoreKit, ngay trong Xcode.

00:09:40.000 --> 00:09:45.000
Có rất nhiều tùy chỉnh có thể dễ dàng thêm vào bất kỳ loại chế độ xem mới nào trong số này.

00:09:45.000 --> 00:09:53.000
Ví dụ, hãy xem cách thay đổi một vài dòng mã để tạo nền tùy chỉnh có thể thay đổi đáng kể giao diện của SubscriptionStoreView này.

00:09:53.000 --> 00:10:04.000
Để đi cùng với những thay đổi đăng ký mới này, chúng tôi cũng đang thêm một bảng quản lý đăng ký bổ sung để cung cấp trải nghiệm mới về cách mọi người có thể tương tác và chọn đăng ký của họ trong ứng dụng StoreKit.

00:10:04.000 --> 00:10:06.000
Hãy cùng xem nó.

00:10:06.000 --> 00:10:19.000
Tại đây, bạn có thể thấy quy trình quen thuộc để quản lý đăng ký, hiển thị cho khách hàng một trang tính với các tầng đang hoạt động hiện tại của họ và cung cấp tùy chọn để truy cập vào từng trang để xem danh sách các trang khác có sẵn trong nhóm đăng ký đó.

00:10:19.000 --> 00:10:28.000
Để làm cho quá trình này nhanh hơn và cung cấp nhiều tùy chỉnh hơn, bây giờ có một chế độ xem khác cho phép bạn bỏ qua một bước và nhảy ngay vào nhóm đăng ký mà bạn muốn hiển thị.

00:10:28.000 --> 00:10:38.000
Bạn có thể chọn nhóm đăng ký có liên quan trong ngữ cảnh ứng dụng của mình, ví dụ: nếu bạn có nhiều hơn một nhóm và hiển thị những cấp độ dịch vụ khác có sẵn cho khách hàng của bạn lựa chọn.

00:10:38.000 --> 00:10:43.000
Trang tính này có thể được sử dụng với cùng một API như trang thông thường: .manageSubscriptionsSheet.

00:10:43.000 --> 00:10:48.000
Lần này, bổ sung chuyển tham số subscriptionGroupID.

00:10:48.000 --> 00:10:58.000
Có rất nhiều thứ để cho bạn thấy về chủ đề tạo ứng dụng SwiftUI với StoreKit, với rất nhiều chế độ xem và tùy chỉnh khác mà bạn có thể áp dụng để làm cho nó phù hợp với thẩm mỹ của ứng dụng của mình.

00:10:58.000 --> 00:11:03.000
Nếu bạn muốn tìm hiểu thêm, Greg sẽ cho bạn biết về nó trong "Gặp gỡ StoreKit cho SwiftUI."

00:11:03.000 --> 00:11:12.000
Sau khi xem xét các tính năng mới để mua hàng trong ứng dụng trong StoreKit, hãy xem cách chúng ta có thể kiểm tra chúng bằng cách sử dụng các công cụ mới trong Kiểm tra StoreKit trong Xcode, bắt đầu với Xcode 15.

00:11:12.000 --> 00:11:22.000
Với Thử nghiệm StoreKit trong Xcode, bạn có thể đảm bảo ứng dụng của mình sử dụng StoreKit cung cấp trải nghiệm tuyệt vời ngay từ khi bạn bắt đầu xây dựng nó, ngay cả trước khi bạn thiết lập bất kỳ thứ gì trong App Store Connect.

00:11:22.000 --> 00:11:33.000
Điều này cho phép bạn kiểm tra, quản lý, chỉnh sửa và thậm chí tạo các hành động liên quan đến StoreKit trong khi kiểm tra trên máy Mac của bạn và nó được hỗ trợ trên cả trình giả lập và thiết bị.

00:11:33.000 --> 00:11:39.000
Bắt đầu với trình quản lý giao dịch, có chức năng mới để gỡ lỗi và kiểm tra các ứng dụng của bạn.

00:11:39.000 --> 00:11:42.000
Bây giờ nó tổ chức tất cả các ứng dụng thử nghiệm của bạn.

00:11:42.000 --> 00:11:51.000
Trong trình điều hướng, bạn có thể thấy tất cả các thiết bị và trình mô phỏng được kết nối hiện tại đã cài đặt các ứng dụng StoreKit hiện tại của bạn bằng cách sử dụng cấu hình StoreKit để thử nghiệm.

00:11:51.000 --> 00:12:00.000
Điều này cho phép bạn kiểm tra trên nhiều thiết bị cùng một lúc dễ dàng và nhanh chóng hơn nhiều, và bạn không bắt buộc phải chạy ứng dụng của mình để xem lịch sử mua hàng.

00:12:00.000 --> 00:12:02.000
Hãy nhảy vào và xem nó trông như thế nào.

00:12:02.000 --> 00:12:06.000
Tôi có cả iPhone được kết nối với máy Mac của mình và một trình giả lập đang chạy.

00:12:06.000 --> 00:12:10.000
Và tôi đang sử dụng trò chơi đang phát triển mới, Backyard Birds.

00:12:10.000 --> 00:12:25.000
Khi bạn mở Xcode, bất kể bạn có mở dự án hay không, bạn có thể vào Debug, StoreKit, Manage Transactions và được trình bày với chế độ xem trình quản lý giao dịch mà bạn đã quen thuộc.

00:12:25.000 --> 00:12:29.000
Trong trình duyệt, bạn có thể thấy tất cả các thiết bị hiện tại được kết nối với máy Mac của mình.

00:12:29.000 --> 00:12:33.000
Trong trường hợp của tôi, đây là iPhone vật lý và trình giả lập.

00:12:33.000 --> 00:12:38.000
Chú ý cách cả hai đều có một vài ứng dụng hiển thị trong danh sách này, bao gồm cả Backyard Birds.

00:12:38.000 --> 00:12:43.000
Đây là tất cả các ứng dụng sử dụng Kiểm tra StoreKit trong Xcode mà bạn có thể kiểm tra bên ngoài phiên gỡ lỗi.

00:12:43.000 --> 00:12:55.000
Nhấp vào một ứng dụng trên một trong hai thiết bị này, bạn có thể xem danh sách các giao dịch StoreKit cho ứng dụng đó và với thanh bên chi tiết mà chúng tôi đã chỉ cho bạn vào năm ngoái, bạn có thể kiểm tra từng ứng dụng riêng lẻ.

00:12:55.000 --> 00:13:01.000
Ví dụ, điều này cũng hoạt động nếu tôi mở dự án Xcode cho Backyard Birds và chạy nó trên trình giả lập.

00:13:01.000 --> 00:13:08.000
Trong trường hợp này, tôi cũng có thể thấy ứng dụng nào đang được gỡ lỗi tích cực vì nó sẽ có chỉ báo nhỏ này bên cạnh tên ứng dụng.

00:13:08.000 --> 00:13:12.000
Đây không phải là tất cả những gì mới mẻ với người quản lý giao dịch.

00:13:12.000 --> 00:13:19.000
Tôi rất vui được cho bạn thấy rằng bây giờ bạn có khả năng mua hàng trong ứng dụng cho ứng dụng của mình ngay từ máy Mac của bạn bằng Xcode.

00:13:19.000 --> 00:13:30.000
Thêm vào đó, khi tạo một giao dịch mua mới, bạn cũng có thể tùy chỉnh các thông số mua hàng khác nhau, chẳng hạn như số lượng cho một sản phẩm tiêu hao hoặc bạn có thể chọn mã ưu đãi cho đăng ký của mình.

00:13:30.000 --> 00:13:33.000
Hãy xem điều này hoạt động như thế nào trong thực tế khi sử dụng Backyard Birds.

00:13:33.000 --> 00:13:36.000
Trước tiên bạn cần chọn ứng dụng bạn muốn kiểm tra.

00:13:36.000 --> 00:13:41.000
Sau đó, nhấp vào nút dấu cộng ở bên trái thanh lọc để tạo giao dịch mua mới.

00:13:41.000 --> 00:13:46.000
Cửa sổ bật lên mà tôi được trình bày liệt kê tất cả các giao dịch mua trong ứng dụng có sẵn cho ứng dụng này.

00:13:46.000 --> 00:13:50.000
Đây là những sản phẩm tương tự mà chúng tôi đã định cấu hình trong cấu hình StoreKit.

00:13:50.000 --> 00:13:58.000
Tôi sẽ mua một vật tư tiêu hao trước, vì vậy tôi có thể chọn Viên Dinh dưỡng và nhấp vào Tiếp theo.

00:13:58.000 --> 00:14:05.000
Bây giờ, tôi có cơ hội định cấu hình giao dịch mua mới này, nhưng các tùy chọn mặc định cũng hợp lệ nếu tôi muốn bỏ qua.

00:14:05.000 --> 00:14:13.000
Tôi hài lòng với các cài đặt này, vì vậy hãy nhấp vào Xong để hoàn tất giao dịch mua bằng cách sử dụng các thông số này.

00:14:13.000 --> 00:14:18.000
Mặc dù ứng dụng không chạy trong trình giả lập, StoreKit đã nhận và xử lý giao dịch mua mới.

00:14:18.000 --> 00:14:22.000
Nếu tôi nhìn vào danh sách giao dịch, bây giờ có một mục mới ở trên cùng.

00:14:22.000 --> 00:14:27.000
Nhấp vào nó, tôi có thể kiểm tra chi tiết cho giao dịch mới này.

00:14:27.000 --> 00:14:31.000
Tuy nhiên, đăng ký khác nhau, vì vậy hãy thực hiện một giao dịch mua khác.

00:14:31.000 --> 00:14:45.000
Tôi sẽ nhấp lại vào nút dấu cộng để tạo giao dịch mua mới và lần này, tôi sẽ tìm kiếm tên của đăng ký trong ứng dụng này, sau đó, chọn đăng ký tôi đang tìm kiếm và nhấp vào tiếp theo.

00:14:45.000 --> 00:14:50.000
Các tùy chọn để định cấu hình giao dịch mua hiện đã thay đổi, bởi vì đây là một loại giao dịch mua trong ứng dụng khác.

00:14:50.000 --> 00:14:57.000
Một số giống nhau, giống như ngày mua, nhưng cũng có một số cái mới, vì vậy hãy xem lại những gì họ làm.

00:14:57.000 --> 00:15:01.000
Nhân tiện, các thuộc tính mặc định cũng hợp lệ ở đây.

00:15:01.000 --> 00:15:07.000
Tôi có tùy chọn để chọn mã ưu đãi cho đăng ký này, nếu nó có bất kỳ thiết lập nào trong cấu hình StoreKit.

00:15:07.000 --> 00:15:15.000
Khách hàng phải nhập mã ưu đãi và khuyến mãi, nhưng để thử nghiệm dễ dàng hơn, chúng tôi cung cấp danh sách các ưu đãi có sẵn cho ID sản phẩm này.

00:15:15.000 --> 00:15:25.000
Tôi muốn thay đổi ngày mua trong trường hợp này và đặt nó thành chính xác một năm trước, như thể lần đầu tiên tôi đăng ký dịch vụ này trong WWDC năm ngoái.

00:15:25.000 --> 00:15:35.000
Tiếp theo, tôi có thể chọn xem đăng ký này nên tự động gia hạn hay chỉ duy trì đăng ký trong chính xác một khoảng thời gian đăng ký, trong trường hợp của sản phẩm này, sẽ là một tháng.

00:15:35.000 --> 00:15:43.000
Tôi muốn bật gia hạn tự động để tôi có thể kiểm tra cách ứng dụng của mình xử lý các đăng ký đang hoạt động trước khi tôi bắt đầu sử dụng nó.

00:15:43.000 --> 00:15:53.000
Hãy nhấp vào Xong để hoàn tất giao dịch mua và xem kết quả bằng cách lọc danh sách giao dịch.

00:15:53.000 --> 00:15:57.000
Đúng như dự đoán, tôi có một lần gia hạn cho mỗi tháng kể từ năm ngoái.

00:15:57.000 --> 00:16:13.000
Tất cả những thứ này hiện được đánh dấu là chưa hoàn thành, bởi vì ứng dụng không chạy và không có cơ hội nhận chúng, vì vậy tôi sẽ chạy nó trong trình giả lập và thấy rằng bây giờ tôi có quyền truy cập vào Backyard Birds Pass.

00:16:13.000 --> 00:16:23.000
Các tính năng mới trong trình quản lý giao dịch hoạt động với tất cả các thiết bị và nền tảng đã hỗ trợ Kiểm tra StoreKit trong Xcode, bắt đầu với iOS 17 và macOS 14.

00:16:23.000 --> 00:16:30.000
Và chúng cũng được hỗ trợ trên các nền tảng khác, bao gồm iPadOS, watchOS và tvOS.

00:16:30.000 --> 00:16:41.000
Nếu bạn đang chạy phiên bản cũ hơn của hệ điều hành, không có gì thay đổi đối với bạn: trình quản lý giao dịch vẫn tương thích với tất cả các tính năng giống như trước đây khi sử dụng phiên gỡ lỗi đang hoạt động.

00:16:41.000 --> 00:16:51.000
Tiếp theo, tôi muốn giới thiệu một tính năng mới trong cấu hình StoreKit cho phép kiểm tra chuyên sâu hơn về cách ứng dụng StoreKit của bạn hoạt động trong các tình huống khác nhau.

00:16:51.000 --> 00:16:59.000
Để chứng minh điều này, tôi sẽ mở dự án Xcode cho Backyard Birds và chuyển đến cấu hình StoreKit.

00:16:59.000 --> 00:17:05.000
Hiện tại có một mục mới phía trên các giao dịch mua trong ứng dụng được định cấu hình được gọi là Cài đặt cấu hình.

00:17:05.000 --> 00:17:16.000
Đây là một menu mới mà chúng tôi đã thêm vào để cung cấp các tùy chọn có thể định cấu hình cho môi trường thử nghiệm ứng dụng của bạn, một số mà bạn có thể đã quen thuộc và một số tùy chọn mới bắt đầu bằng Xcode 15.

00:17:16.000 --> 00:17:31.000
Phần đầu tiên và phần thứ hai này bao gồm tất cả các tùy chọn hiện có, như mặt tiền cửa hàng mặc định và ngôn ngữ mà ứng dụng của bạn nên sử dụng để định giá và tính khả dụng, và các phần khác như tốc độ gia hạn đăng ký hoặc khả năng buộc yêu cầu mua chẳng hạn.

00:17:31.000 --> 00:17:41.000
Trong các phiên bản trước của Xcode, bạn có thể tìm thấy những thứ này trong menu Trình chỉnh sửa khi cấu hình StoreKit của bạn được mở và chúng vẫn ở đó và có thể được sử dụng thay thế cho nhau.

00:17:41.000 --> 00:17:48.000
Trong khi chúng ta đang nói về các tùy chọn Thử nghiệm StoreKit, có tỷ lệ gia hạn đăng ký mới mà chúng tôi đã thêm vào trong năm nay trong iOS 16.4.

00:17:48.000 --> 00:17:58.000
Chúng được thiết kế để thay đổi thời hạn đăng ký trên cơ sở mỗi lần gia hạn, giúp bạn tạo ra các gia hạn nhất quán nhanh hơn thời lượng thực tế của đăng ký.

00:17:58.000 --> 00:18:04.000
Điều này thực sự hữu ích cho việc kiểm tra nhanh chóng và đáng tin cậy về trạng thái đăng ký dài hạn của bạn.

00:18:04.000 --> 00:18:12.000
Bạn có thể tìm thấy các tỷ lệ cấu hình mới này trong cả menu Trình chỉnh sửa và trong cài đặt cấu hình StoreKit trong Xcode 15.

00:18:12.000 --> 00:18:22.000
Phần thứ ba trong cài đặt cấu hình StoreKit bao gồm các tùy chọn bạn có thể sử dụng để mô phỏng lỗi StoreKit trong ứng dụng của mình, đây là một tính năng được nhiều bạn yêu cầu cao.

00:18:22.000 --> 00:18:31.000
Nó mở rộng trên menu con Giao dịch thất bại từng có trong menu Trình chỉnh sửa và nó mang lại sự hỗ trợ cho nhiều API StoreKit hơn và các loại lỗi.

00:18:31.000 --> 00:18:40.000
Mỗi tùy chọn đại diện cho một API StoreKit 2 mà ứng dụng của bạn có thể đang sử dụng và cho phép bạn chọn một lỗi mà API sẽ ném mỗi khi nó được ứng dụng của bạn gọi.

00:18:40.000 --> 00:18:43.000
Nhiều API được hỗ trợ bởi tính năng này.

00:18:43.000 --> 00:18:51.000
Bạn có thể kiểm tra các vấn đề tải sản phẩm, lỗi mua hàng, các vấn đề xác minh hóa đơn và giao dịch, yêu cầu hoàn tiền và nhiều hơn nữa.

00:18:51.000 --> 00:18:54.000
Hãy xem điều này trông như thế nào trong thực tế.

00:18:54.000 --> 00:19:00.000
Tôi đã mở dự án Xcode cho Backyard Birds ở bên trái và ứng dụng đang chạy trong trình giả lập ở bên phải.

00:19:00.000 --> 00:19:12.000
Trong cấu hình StoreKit, tôi có thể bật lỗi mua hàng bằng cách sử dụng hộp kiểm bên cạnh tên API mua hàng và chọn lỗi mà nó sẽ gây ra.

00:19:12.000 --> 00:19:21.000
Tôi muốn kiểm tra cách ứng dụng xử lý các giao dịch mua khi khách hàng thay đổi mặt tiền cửa hàng, vì vậy tôi sẽ chọn Sản phẩm không khả dụng.

00:19:21.000 --> 00:19:30.000
Tệp này tự động lưu khi chỉnh sửa và nó cũng đồng bộ hóa với thiết bị của bạn khi ứng dụng đang chạy, vì vậy bạn có thể kiểm tra thay đổi ngay lập tức mà không cần phải chạy lại ứng dụng của mình.

00:19:30.000 --> 00:19:37.000
Hãy thử mua một sản phẩm và xem điều gì sẽ xảy ra.

00:19:37.000 --> 00:19:42.000
Đúng như dự đoán, nó thất bại.

00:19:42.000 --> 00:19:48.000
Nó nói với tôi rằng tôi không thể mua sản phẩm này và tôi nên liên hệ với nhà phát triển để biết thêm thông tin.

00:19:48.000 --> 00:19:59.000
Bây giờ chúng ta hãy vô hiệu hóa lỗi mua hàng và thử lại lần này để đảm bảo lần này nó hoàn thành thành công.

00:19:59.000 --> 00:20:11.000
Với các bước này, bây giờ tôi đã kiểm tra hiệu quả rằng mã của ứng dụng này có thể xử lý các loại lỗi này khi mua hàng, nếu chúng xảy ra.

00:20:11.000 --> 00:20:20.000
Phương pháp này có thể được áp dụng cho bất kỳ API và tùy chọn lỗi nào trong cài đặt cấu hình StoreKit để bao gồm nhiều tình huống và đảm bảo ứng dụng của bạn mạnh mẽ.

00:20:20.000 --> 00:20:23.000
Những lỗi này đều là một phần của StoreKit và bạn có thể đã gặp phải chúng rồi.

00:20:23.000 --> 00:20:28.000
Mỗi người trong số họ đại diện cho một trường hợp rõ ràng về sự thất bại trong ứng dụng của bạn.

00:20:28.000 --> 00:20:32.000
Và đó là tất cả các tính năng mới cho Thử nghiệm StoreKit trong Xcode.

00:20:32.000 --> 00:20:51.000
Hôm nay, tôi đã chỉ ra cách kiểm tra và quản lý các giao dịch trên nhiều thiết bị bên ngoài phiên gỡ lỗi, cách mua sản phẩm từ trình quản lý giao dịch để kiểm tra cách ứng dụng của bạn xử lý các giao dịch mua hiện có và cách mô phỏng lỗi StoreKit để bao gồm nhiều tình huống lỗi có thể xảy ra.

00:20:51.000 --> 00:21:02.000
Tất cả các tính năng mới này trong Xcode cũng có sẵn trong mã sử dụng khung Kiểm tra StoreKit để viết các bài kiểm tra đơn vị cho ứng dụng của bạn, vì vậy bạn có thể viết tự động hóa thực hiện tất cả các tác vụ giống nhau.

00:21:02.000 --> 00:21:09.000
Chúng ta hãy xem xét các API mới để tạo các giao dịch mua ngoài thiết bị và đặt lỗi mô phỏng trong phiên XCTest.

00:21:09.000 --> 00:21:19.000
Để tạo các giao dịch mua trong ứng dụng mới, có một API Swift mới trong StoreKitTest hoạt động giống như API mua StoreKit(_:), với các tùy chọn mua hàng giống nhau.

00:21:19.000 --> 00:21:26.000
Để hỗ trợ các tính năng mua hàng mới, như thay đổi ngày mua, chúng tôi cũng đã thêm các tùy chọn mua mới chỉ để thử nghiệm.

00:21:26.000 --> 00:21:28.000
Hãy xem xét một ví dụ.

00:21:28.000 --> 00:21:38.000
Sau khi thiết lập SKTestSession, tôi đang mua hàng ngoài thiết bị để đăng ký và ghi đè ngày mua đến một năm trước kể từ hôm nay.

00:21:38.000 --> 00:21:47.000
Đây là giao dịch mua tương tự mà tôi đã thực hiện trong trình quản lý giao dịch và nó hoạt động giống hệt nhau, cho phép bạn tạo kết quả có thể lặp lại và tự động hóa thử nghiệm cho ứng dụng của mình.

00:21:47.000 --> 00:21:58.000
Ngoài ra còn có một số API mới trong StoreKitTest để mô phỏng lỗi StoreKit trong SKTestSession và chúng hoạt động giống như các lỗi mô phỏng trong cài đặt cấu hình StoreKit.

00:21:58.000 --> 00:22:07.000
Sau khi tạo phiên kiểm tra của mình, bạn có thể gọi setSimulatedError với loại lỗi bạn muốn kiểm tra và StoreKit API mà nó nên được mô phỏng.

00:22:07.000 --> 00:22:12.000
Trong ví dụ này, tôi đang chọn mô phỏng lỗi mạng cho loadProducts API.

00:22:12.000 --> 00:22:17.000
Bất cứ khi nào tôi gọi loadProducts API trong bài kiểm tra này, nó sẽ luôn ném cùng một lỗi.

00:22:17.000 --> 00:22:23.000
Để vô hiệu hóa lỗi mô phỏng, hãy sử dụng cùng một API setter và chuyển nil thay cho loại lỗi.

00:22:23.000 --> 00:22:27.000
Cuối cùng, cũng có các API cho tỷ lệ gia hạn đăng ký mới.

00:22:27.000 --> 00:22:33.000
Những thứ này có thể được truy cập theo cách tương tự như những thứ hiện có, thông qua một thành viên trong SKTestSession được gọi là timeRate.

00:22:33.000 --> 00:22:43.000
Trong bài kiểm tra ví dụ này để mua đăng ký, tôi đã thêm một dòng mã bổ sung để đặt tỷ lệ gia hạn nhanh hơn và tạo nhiều lần gia hạn một cách nhanh chóng.

00:22:43.000 --> 00:22:47.000
Rất nhiều Thử nghiệm StoreKit và StoreKit mới trong các tính năng Xcode đã được đề cập ngày hôm nay.

00:22:47.000 --> 00:23:01.000
Trong StoreKit, có các API mới để hỗ trợ quảng bá mua hàng trong ứng dụng, mô hình dữ liệu cho Giao dịch và RenewalInfo có một số cải tiến để cung cấp cho bạn nhiều thông tin có giá trị hơn và có một loại tin nhắn mới mà bạn có thể lắng nghe để xử lý các vấn đề về thanh toán.

00:23:01.000 --> 00:23:11.000
Các chế độ xem StoreKit mới trong SwiftUI là một công cụ tuyệt vời để nhanh chóng xây dựng các ứng dụng hỗ trợ bán sản phẩm và chúng không yêu cầu bất kỳ mã bổ sung nào để hoạt động trên tất cả các thiết bị.

00:23:11.000 --> 00:23:18.000
Và cuối cùng, bạn có thể xác thực tất cả các tính năng StoreKit trong ứng dụng của mình bằng cách sử dụng các công cụ tuyệt vời được cung cấp với Kiểm tra StoreKit trong Xcode.

00:23:18.000 --> 00:23:23.000
StoreKit 2 được đóng gói với nhiều tính năng tuyệt vời cho phép bạn xây dựng các ứng dụng tuyệt vời và phát triển doanh nghiệp của mình.

00:23:23.000 --> 00:23:34.000
Chúng tôi đã thêm nhiều công cụ tận dụng tối đa Swift và với các API mới đơn giản nhưng mạnh mẽ, bạn có cơ hội tập trung nhiều hơn vào trải nghiệm mà bạn đang xây dựng cho khách hàng của mình.

00:23:34.000 --> 00:23:40.000
Bất kỳ ứng dụng nào muốn bán sản phẩm và đăng ký hiện có thể được xây dựng bằng StoreKit 2.

00:23:40.000 --> 00:23:47.000
Nếu bạn chưa sử dụng StoreKit 2, hãy dùng thử và nếu có, hãy cho chúng tôi biết suy nghĩ của bạn về các tính năng mới mà tôi đã chỉ cho bạn hôm nay.

00:23:47.000 --> 00:23:56.000
Sử dụng chế độ xem bán hàng mua hàng trong ứng dụng mới trong ứng dụng hiện tại của bạn để tùy chỉnh thêm trải nghiệm hoặc tạo một trải nghiệm mới chỉ bằng cách sử dụng các API mới này.

00:23:56.000 --> 00:24:07.000
Và với Kiểm tra StoreKit trong Xcode, bạn có thể đưa mã của mình vào thử nghiệm và đảm bảo mọi thứ hoạt động tốt và như mong đợi để cung cấp cho khách hàng của bạn trải nghiệm tốt nhất trong mọi điều kiện.

00:24:07.000 --> 00:24:12.000
Để biết thêm thông tin về các tính năng StoreKit khác, hãy xem các phiên này được liên kết bên dưới.

00:24:12.000 --> 00:24:16.000
Chúng tôi mong muốn được xem những gì bạn tạo ra bằng StoreKit 2.

00:24:16.000 --> 23:59:59.000
Cảm ơn bạn đã xem.

