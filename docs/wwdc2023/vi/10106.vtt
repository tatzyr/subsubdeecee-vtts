WEBVTT

00:00:00.000 --> 00:00:10.000
♪ ♪

00:00:10.000 --> 00:00:14.000
Nikolas: Xin chào và chào mừng đến với "Hỗ trợ camera ngoài trong ứng dụng iPadOS của bạn."

00:00:14.000 --> 00:00:21.000
Tôi là Nikolas Gelo từ nhóm Phần mềm Máy ảnh, và phiên này về cách ứng dụng iPad của bạn có thể bắt đầu sử dụng máy ảnh bên ngoài.

00:00:21.000 --> 00:00:28.000
Bộ tính năng mạnh mẽ của Stage Manager bao gồm khả năng mở rộng màn hình iPad của bạn trên nhiều màn hình.

00:00:28.000 --> 00:00:35.000
Và với iPadOS 17, ứng dụng của bạn có thể bắt đầu sử dụng các camera bên ngoài như camera trong Apple Studio Display.

00:00:35.000 --> 00:00:41.000
Trên iPad Pro này, FaceTime đang mở và nó đang sử dụng camera trong màn hình mà nó được kết nối.

00:00:41.000 --> 00:00:49.000
Điều này thật tuyệt vì bây giờ những người ở phía bên kia của cuộc gọi có góc nhìn tốt hơn về tôi khi tôi chạy ứng dụng trên Màn hình Apple Studio lớn này.

00:00:49.000 --> 00:00:58.000
Tôi cũng có thể sử dụng Center Stage với nó, điều này giúp giữ tôi trong khung hình khi tôi di chuyển xung quanh.

00:00:58.000 --> 00:01:05.000
FaceTime, Code Scanner và WebKit sử dụng camera bên ngoài và chúng là những ví dụ tuyệt vời về những gì ứng dụng của bạn có thể làm.

00:01:05.000 --> 00:01:12.000
Khi sử dụng màn hình không có camera tích hợp, như Apple Pro Display XDR, mọi người thường đặt camera USB lên trên nó.

00:01:12.000 --> 00:01:21.000
Nếu máy ảnh USB được kết nối với màn hình, thì khi màn hình được cắm vào iPad, máy ảnh cũng sẽ có sẵn cho ứng dụng của bạn.

00:01:21.000 --> 00:01:26.000
Ứng dụng iPad của bạn có thể sử dụng máy ảnh và webcam bên ngoài để chụp ảnh và quay phim.

00:01:26.000 --> 00:01:34.000
Chúng cũng hỗ trợ các tính năng máy ảnh hệ thống khác, như hiệu ứng video Portrait Blur và Studio Light có sẵn từ Trung tâm điều khiển.

00:01:34.000 --> 00:01:38.000
iPad với đầu nối USB-C hỗ trợ camera ngoài.

00:01:38.000 --> 00:01:44.000
Ứng dụng của bạn có thể sử dụng các thiết bị phù hợp với thông số kỹ thuật của Lớp Video USB hoặc UVC.

00:01:44.000 --> 00:01:49.000
Nó xác định một tiêu chuẩn cho các thiết bị USB để hỗ trợ phát trực tuyến video.

00:01:49.000 --> 00:01:52.000
Và có rất nhiều máy ảnh phổ biến mà ứng dụng của bạn có thể sử dụng.

00:01:52.000 --> 00:01:57.000
Một số camera ngoài có micrô tích hợp, cũng có sẵn cho ứng dụng của bạn.

00:01:57.000 --> 00:02:07.000
Một số nhà sản xuất chế tạo các thiết bị không phải máy ảnh phù hợp với thông số kỹ thuật UVC, như bộ chuyển đổi HDMI thay đổi giữa nhiều đầu vào để xuất ra một luồng video duy nhất.

00:02:07.000 --> 00:02:11.000
iPadOS cho phép ứng dụng của bạn sử dụng các thiết bị như thế này.

00:02:11.000 --> 00:02:16.000
Hỗ trợ camera ngoài là một cải tiến tuyệt vời cho hệ sinh thái đa phương tiện của iPad.

00:02:16.000 --> 00:02:21.000
Tôi sẽ chỉ ra cách ứng dụng của bạn có thể sử dụng chúng bằng cách bắt đầu với việc khám phá và sử dụng.

00:02:21.000 --> 00:02:25.000
Tiếp theo, tôi sẽ khoanh tròn lại và làm sáng tỏ vòng quay video.

00:02:25.000 --> 00:02:30.000
Sau đó, tôi sẽ đề cập đến cách ứng dụng của bạn có thể sử dụng micrô đi kèm với máy ảnh bên ngoài.

00:02:30.000 --> 00:02:34.000
Và cuối cùng, tôi sẽ thảo luận về các phương pháp hay nhất cho ứng dụng của bạn.

00:02:34.000 --> 00:02:39.000
Đầu tiên, tôi sẽ thảo luận về cách ứng dụng iPad của bạn có thể bắt đầu sử dụng camera ngoài.

00:02:39.000 --> 00:02:47.000
Các ứng dụng iPad sử dụng máy ảnh cho nhiều tính năng, như chụp ảnh, quay phim hoặc gửi khung máy ảnh qua mạng để gọi video.

00:02:47.000 --> 00:02:56.000
Khung AVFoundation cho phép ứng dụng của bạn sử dụng các camera tích hợp và bên ngoài, đặc biệt, với các lớp tiền tố AVCapture của nó.

00:02:56.000 --> 00:02:59.000
Hãy xem lại cách một ứng dụng có thể sử dụng máy ảnh.

00:02:59.000 --> 00:03:04.000
Đầu tiên, một ứng dụng sử dụng AVCaptureDevices, đại diện cho máy ảnh và micrô.

00:03:04.000 --> 00:03:11.000
Sau đó, chúng được bọc trong AVCaptureDeviceInputs, cho phép chúng được cắm vào AVCaptureSession.

00:03:11.000 --> 00:03:16.000
AVCaptureSession là đối tượng điều khiển trung tâm của biểu đồ AVCapture.

00:03:16.000 --> 00:03:20.000
AVCaptureOutputs hiển thị dữ liệu từ đầu vào theo nhiều cách khác nhau.

00:03:20.000 --> 00:03:23.000
MovieFileOutput ghi lại các bộ phim QuickTime.

00:03:23.000 --> 00:03:27.000
PhotoOutput chụp ảnh tĩnh chất lượng cao và Ảnh trực tiếp.

00:03:27.000 --> 00:03:37.000
Đầu ra dữ liệu, chẳng hạn như VideoDataOutput hoặc AudioDataOutput, cung cấp bộ đệm video hoặc âm thanh từ máy ảnh hoặc micrô đến ứng dụng của bạn.

00:03:37.000 --> 00:03:42.000
Và có những loại đầu ra dữ liệu khác, chẳng hạn như Siêu dữ liệu và Độ sâu.

00:03:42.000 --> 00:03:50.000
Để xem trước camera trực tiếp, có một loại đầu ra đặc biệt, AVCaptureVideoPreviewLayer, là một lớp con của CALayer.

00:03:50.000 --> 00:03:56.000
Dữ liệu chảy từ đầu vào chụp đến đầu ra tương thích thông qua AVCaptureConnections.

00:03:56.000 --> 00:04:02.000
Các lớp học này có sẵn trên iOS, macOS và tvOS.

00:04:02.000 --> 00:04:10.000
Nếu bạn chưa quen với AVCapture, tôi mời bạn tìm hiểu thêm tại trang bắt đầu Thiết lập Capture trên developer.apple.com.

00:04:10.000 --> 00:04:16.000
Mới trong iPadOS 17, ứng dụng của bạn có thể truy cập các camera bên ngoài với AVCapture.

00:04:16.000 --> 00:04:21.000
Nếu ứng dụng của bạn đã sử dụng máy ảnh tích hợp, bạn có thể thực hiện các bản cập nhật đơn giản để bắt đầu sử dụng các bản cập nhật bên ngoài.

00:04:21.000 --> 00:04:23.000
Khám phá chúng thật dễ dàng.

00:04:23.000 --> 00:04:28.000
Mỗi camera bên ngoài được đại diện bởi một phiên bản AVCaptureDevice.

00:04:28.000 --> 00:04:35.000
Và bạn có thể tìm thấy chúng với API hiện có từ AVCaptureDevice và AVCaptureDeviceDiscoverySession.

00:04:35.000 --> 00:04:42.000
Có ba thuộc tính chính của AVCaptureDevice: Loại phương tiện, loại thiết bị và vị trí của nó.

00:04:42.000 --> 00:04:46.000
Các camera bên ngoài cung cấp dữ liệu phương tiện video giống như các camera tích hợp.

00:04:46.000 --> 00:04:49.000
Và loại thiết bị của họ là bên ngoài.

00:04:49.000 --> 00:04:57.000
Đối với các nhà phát triển ứng dụng macOS, những người quen thuộc với việc sử dụng máy ảnh bên ngoài, điều này phản đối loại thiết bị không xác định bên ngoài.

00:04:57.000 --> 00:05:04.000
Bởi vì các camera bên ngoài có thể di chuyển độc lập với iPad, vị trí thiết bị của chúng không được chỉ định.

00:05:04.000 --> 00:05:10.000
Ba thuộc tính này có thể được sử dụng để tìm các camera bên ngoài với AVCapture API.

00:05:10.000 --> 00:05:13.000
Thật dễ dàng để bắt đầu sử dụng camera ngoài trong ứng dụng của bạn.

00:05:13.000 --> 00:05:21.000
Trong phiên này, tôi sẽ sửa đổi ứng dụng máy ảnh mẫu phổ biến, AVCam, để phát trực tuyến từ máy ảnh bên ngoài trong Màn hình Apple Studio.

00:05:21.000 --> 00:05:29.000
Bạn có thể tải xuống phiên bản AVCam đã hoàn thành với tất cả các thay đổi tôi thực hiện trong phiên này từ developer.apple.com.

00:05:29.000 --> 00:05:36.000
Hiện tại, ứng dụng sử dụng camera tích hợp và nó cho phép người dùng chuyển đổi giữa camera trước và camera sau khi nhấn nút.

00:05:36.000 --> 00:05:40.000
Khi AVCam ra mắt, nó bắt đầu với một camera phía sau.

00:05:40.000 --> 00:05:48.000
Tôi sẽ thay đổi mã để ứng dụng thích tìm kiếm camera ngoài hơn là camera tích hợp.

00:05:48.000 --> 00:05:58.000
Với iPad được kết nối với Apple Studio Display, tôi sẽ chạy ứng dụng và khi nó khởi chạy, nó sẽ sử dụng camera ngoài.

00:05:58.000 --> 00:05:59.000
Điều này thật tuyệt.

00:05:59.000 --> 00:06:04.000
AVCam hiện đang sử dụng camera ngoài và tất cả những gì nó cần là một vài dòng mã.

00:06:04.000 --> 00:06:11.000
AVCaptureVideoPreviewLayer phản chiếu các camera bên ngoài theo mặc định, phù hợp để sử dụng camera trong Apple Studio Display.

00:06:11.000 --> 00:06:14.000
Bạn có thể vô hiệu hóa hành vi này nếu bạn thích.

00:06:14.000 --> 00:06:19.000
Tôi sẽ mô tả cách thực hiện điều này trong phần thực hành tốt nhất vào cuối phiên này.

00:06:19.000 --> 00:06:24.000
Bây giờ tôi sẽ chuyển ứng dụng sang màn hình của iPad.

00:06:24.000 --> 00:06:29.000
Và chỉ để cho vui, tôi sẽ rút phích cắm của camera ngoài.

00:06:29.000 --> 00:06:35.000
Uh-oh, bản xem trước máy ảnh của ứng dụng đã bị đóng băng và hiện tại nó không sử dụng bất kỳ máy ảnh nào.

00:06:35.000 --> 00:06:40.000
AVCam sẽ cần nhiều thay đổi hơn để xử lý các sự kiện kết nối và ngắt kết nối của các camera bên ngoài.

00:06:40.000 --> 00:06:48.000
Camera ngoài yêu cầu sự chăm sóc đặc biệt bởi vì, không giống như camera tích hợp, người dùng có thể kết nối và ngắt kết nối chúng khỏi iPad bất cứ lúc nào.

00:06:48.000 --> 00:06:54.000
Ứng dụng của bạn có thể theo dõi các sự kiện này để biết khi nào máy ảnh có sẵn hoặc không thể sử dụng được nữa.

00:06:54.000 --> 00:07:01.000
Nếu cùng một thiết bị vật lý được kết nối lại, nó sẽ được biểu diễn bằng cách sử dụng một phiên bản mới của AVCaptureDevice.

00:07:01.000 --> 00:07:08.000
Có API hiện có mà ứng dụng của bạn có thể sử dụng để lắng nghe các sự kiện kết nối và ngắt kết nối.

00:07:08.000 --> 00:07:21.000
Bạn có thể quan sát giá trị khóa thuộc tính isConnected trên AVCaptureDevice hoặc thuộc tính thiết bị trên AVCaptureDeviceDiscoverySession cập nhật khi máy ảnh đến và đi.

00:07:21.000 --> 00:07:30.000
AVCaptureDevices cũng đăng thông báo khi trạng thái kết nối của chúng thay đổi và ứng dụng của bạn có thể quan sát chúng để theo dõi tính khả dụng của máy ảnh.

00:07:30.000 --> 00:07:35.000
Hệ thống gọi mã quan sát giá trị chính và đăng thông báo trên hàng đợi nền.

00:07:35.000 --> 00:07:42.000
Vì vậy, hãy đảm bảo đồng bộ hóa việc xử lý của bạn với hàng đợi AVCaptureSession và chuỗi chính.

00:07:42.000 --> 00:07:48.000
Quay trở lại AVCam, tôi sẽ thêm một số mã để nghe các sự kiện kết nối và ngắt kết nối của camera ngoài.

00:07:48.000 --> 00:07:54.000
Sau khi ứng dụng tìm kiếm thiết bị mặc định, nó sẽ quan sát khi máy ảnh bị ngắt kết nối.

00:07:54.000 --> 00:07:58.000
Và khi điều đó xảy ra, AVCam sẽ chuyển sang máy ảnh tích hợp.

00:07:58.000 --> 00:08:02.000
Bây giờ khi ứng dụng khởi chạy, nó vẫn sử dụng camera bên ngoài.

00:08:02.000 --> 00:08:10.000
Và khi nó ngắt kết nối, ứng dụng sẽ chuyển sang máy ảnh tích hợp.

00:08:10.000 --> 00:08:18.000
Nhưng khi camera ngoài được kết nối lại, AVCam sẽ không chuyển sang nó.

00:08:18.000 --> 00:08:21.000
AVCam nên xử lý các camera bên ngoài được kết nối như thế nào trong khi nó đang chạy?

00:08:21.000 --> 00:08:25.000
Nó có nên chuyển sang nó sau khi tôi cắm nó vào không?

00:08:25.000 --> 00:08:31.000
Một khía cạnh khó khăn của việc áp dụng camera ngoài trong ứng dụng iPad của bạn là xử lý các sự kiện kết nối và ngắt kết nối.

00:08:31.000 --> 00:08:38.000
Để làm điều này dễ dàng hơn, iPadOS đang giới thiệu API để lựa chọn máy ảnh tự động.

00:08:38.000 --> 00:08:43.000
API cho phép ứng dụng của bạn tích hợp với hệ điều hành để sử dụng máy ảnh tốt nhất hiện có.

00:08:43.000 --> 00:08:47.000
Đó là một cách khác để ứng dụng của bạn thay đổi máy ảnh.

00:08:47.000 --> 00:08:53.000
macOS Ventura đã giới thiệu API để lựa chọn máy ảnh tự động để hỗ trợ Máy ảnh liên tục.

00:08:53.000 --> 00:08:58.000
Các hành vi tôi mô tả trong phiên này dành riêng cho iOS.

00:08:58.000 --> 00:09:11.000
Để biết thêm thông tin về cách sử dụng API này cho Mac, hãy xem phiên trước của chúng tôi "Mang máy ảnh liên tục đến ứng dụng macOS của bạn" từ năm 2022 và phần "Xây dựng trải nghiệm kỳ diệu".

00:09:11.000 --> 00:09:23.000
Lựa chọn máy ảnh tự động hoạt động bằng cách sử dụng hai thuộc tính lớp mới được giới thiệu cho AVCaptureDevice trên iOS: userPreferredCamera và systemPreferredCamera.

00:09:23.000 --> 00:09:27.000
Cả hai thuộc tính này đều có thể quan sát được giá trị khóa.

00:09:27.000 --> 00:09:33.000
userPreferredCamera là một thuộc tính đọc/ghi cho biết sự lựa chọn của người dùng về những gì máy ảnh nên được sử dụng.

00:09:33.000 --> 00:09:37.000
Nó nên được đặt bất cứ khi nào người dùng chọn máy ảnh trong ứng dụng của bạn.

00:09:37.000 --> 00:09:43.000
Làm như vậy cho phép hệ thống tìm hiểu sở thích của người dùng.

00:09:43.000 --> 00:09:50.000
systemPreferredCamera là một thuộc tính chỉ đọc chỉ định máy ảnh tốt nhất để sử dụng theo xác định của hệ thống.

00:09:50.000 --> 00:10:00.000
Theo mặc định, hệ thống khuyến nghị sử dụng camera trước, nhưng nếu bạn muốn sử dụng camera sau thay thế, ứng dụng của bạn có thể thông báo cho hệ thống về hành vi mong muốn của nó.

00:10:00.000 --> 00:10:04.000
Khi người dùng chọn các máy ảnh khác nhau, đề xuất sẽ thay đổi.

00:10:04.000 --> 00:10:08.000
Nhưng bạn có thể tự hỏi làm thế nào hệ thống biết máy ảnh nào là tốt nhất.

00:10:08.000 --> 00:10:09.000
Tôi sẽ đi sâu vào điều đó một chút.

00:10:09.000 --> 00:10:14.000
Đầu tiên tôi sẽ mô tả thuộc tính userPreferredCamera của AVCaptureDevice.

00:10:14.000 --> 00:10:22.000
Đối với thuộc tính này, hệ thống lưu trữ một lịch sử ngắn về các máy ảnh đã chọn cho mỗi ứng dụng trong quá trình khởi chạy và khởi động lại hệ thống.

00:10:22.000 --> 00:10:29.000
Nó cho phép ứng dụng của bạn kết hợp lịch sử của người dùng với kiến thức của hệ thống về những camera hiện đang được kết nối.

00:10:29.000 --> 00:10:37.000
Vì vậy, nếu một máy ảnh bị ngắt kết nối, hệ thống sẽ trả lại máy ảnh có sẵn tiếp theo dựa trên lịch sử của người dùng.

00:10:37.000 --> 00:10:49.000
Nếu không có lịch sử lựa chọn người dùng hoặc không có máy ảnh ưa thích nào được kết nối, hệ thống sẽ luôn cố gắng trả lại một máy ảnh đã sẵn sàng để sử dụng và ưu tiên các máy ảnh đã được phát trực tuyến trước đó.

00:10:49.000 --> 00:10:55.000
Ứng dụng của bạn có thể sử dụng thuộc tính này để cho phép hệ thống lưu trữ tùy chọn máy ảnh của người dùng.

00:10:55.000 --> 00:11:00.000
Thuộc tính systemPreferredCamera của AVCaptureDevice trả về máy ảnh tốt nhất để sử dụng một cách thông minh.

00:11:00.000 --> 00:11:03.000
Đầu tiên nó kiểm tra sở thích của người dùng.

00:11:03.000 --> 00:11:09.000
Và khi người dùng kết nối camera ngoài với iPad, hệ thống sẽ trả lại thiết bị mới.

00:11:09.000 --> 00:11:15.000
Điều này là do, khi người dùng kết nối một máy ảnh mới, họ ngầm chỉ ra ý định sử dụng nó.

00:11:15.000 --> 00:11:20.000
Hai đầu vào này xác định máy ảnh ưa thích của hệ thống.

00:11:20.000 --> 00:11:26.000
API lựa chọn máy ảnh tự động linh hoạt cho một ứng dụng để chọn cách nó tích hợp với hệ thống.

00:11:26.000 --> 00:11:33.000
Mặc dù chỉ có iPad hỗ trợ camera ngoài, các ứng dụng iPhone cũng có thể sử dụng API để lưu trữ camera ưa thích của người dùng.

00:11:33.000 --> 00:11:39.000
Một số ứng dụng cho phép người dùng thay đổi máy ảnh, trong khi những ứng dụng khác gắn bó với một máy ảnh mà không cần cách chuyển đổi.

00:11:39.000 --> 00:11:45.000
API cho phép các ứng dụng lựa chọn giữa lựa chọn máy ảnh tự động và thủ công.

00:11:45.000 --> 00:11:52.000
FaceTime, Code Scanner và WebKit là những ví dụ tuyệt vời có các hành vi lựa chọn máy ảnh khác nhau để phù hợp với nhu cầu của họ.

00:11:52.000 --> 00:11:57.000
Khi FaceTime khởi chạy, nó luôn sử dụng camera trước hoặc camera ngoài.

00:11:57.000 --> 00:12:01.000
Và trong các cuộc gọi, nó cho phép người dùng chuyển đổi giữa các camera tích hợp.

00:12:01.000 --> 00:12:06.000
Nhưng khi một máy ảnh bên ngoài được sử dụng, nó sẽ ẩn nút chuyển đổi máy ảnh.

00:12:06.000 --> 00:12:17.000
FaceTime cho phép hành vi này bằng cách cài đặt userPreferredCamera khi nó chuyển đổi thiết bị và quan sát thuộc tính systemPreferredCamera khi một thiết bị bên ngoài được cắm vào.

00:12:17.000 --> 00:12:23.000
Nó cũng đưa ra quyết định của riêng mình khi nào thích hợp để sử dụng API lựa chọn máy ảnh tự động.

00:12:23.000 --> 00:12:32.000
Ví dụ, trong khi bạn có thể sử dụng camera sau trong cuộc gọi Video FaceTime, nó luôn sử dụng camera trước hoặc camera ngoài trên màn hình chính hiển thị danh sách cuộc gọi.

00:12:32.000 --> 00:12:36.000
Máy quét mã, có sẵn từ Trung tâm điều khiển, có hành vi khác nhau.

00:12:36.000 --> 00:12:48.000
Nó sử dụng camera mặt sau khi khởi chạy và nó không cho phép người dùng thay đổi camera, nhưng nó lắng nghe thuộc tính systemPreferredCamera và chuyển đổi khi được thông báo.

00:12:48.000 --> 00:12:53.000
Khung WebKit cho phép các trang web truy cập vào máy ảnh của iPad.

00:12:53.000 --> 00:12:59.000
Mặc dù nó cho phép chuyển sang bất kỳ máy ảnh nào, nhưng nó trả lại máy ảnh ưa thích của hệ thống là máy ảnh đầu tiên trong danh sách của nó.

00:12:59.000 --> 00:13:04.000
Bây giờ tôi đã chỉ cho bạn cách lựa chọn máy ảnh tự động hoạt động, tôi sẽ thêm hỗ trợ cho nó trong AVCam.

00:13:04.000 --> 00:13:10.000
AVCam là một ứng dụng chụp ảnh truyền thống, vì bạn có thể chụp ảnh và quay phim với nó.

00:13:10.000 --> 00:13:19.000
Nó khác với FaceTime và Code Scanner, lần lượt là các ứng dụng giao tiếp và tiện ích, và WebKit, là một khung hệ thống.

00:13:19.000 --> 00:13:29.000
Bây giờ thay vì cần một loạt các câu lệnh "nếu, nếu" để tìm camera bên ngoài có dự phòng, AVCam chỉ cần một dòng để có được máy ảnh ưa thích của hệ thống.

00:13:29.000 --> 00:13:35.000
Vì đây là lần đầu tiên ứng dụng sử dụng API lựa chọn máy ảnh tự động, hệ thống sẽ trả về camera trước tích hợp sẵn.

00:13:35.000 --> 00:13:39.000
Nhưng AVCam thích tiếp tục bắt đầu với camera sau.

00:13:39.000 --> 00:13:48.000
Trước khi nhận được máy ảnh ưa thích của hệ thống, ứng dụng sẽ kiểm tra xem đây có phải là lần đầu tiên nó truy vấn hay không bằng cách tìm kiếm một giá trị được lưu trữ trong mặc định của người dùng ứng dụng.

00:13:48.000 --> 00:13:54.000
Nếu không có giá trị nào được lưu, thì ứng dụng chưa đặt trạng thái ban đầu để lựa chọn máy ảnh tự động.

00:13:54.000 --> 00:14:00.000
Vì vậy, nếu đây là lần đầu tiên khởi chạy, ứng dụng sẽ đặt máy ảnh ưa thích của người dùng làm thiết bị phía sau.

00:14:00.000 --> 00:14:08.000
Ứng dụng tìm camera sau bằng cách sử dụng AVCaptureDeviceDiscoverySession, sắp xếp danh sách các thiết bị sử dụng các loại thiết bị được cung cấp.

00:14:08.000 --> 00:14:16.000
Sau đó, nó đặt máy ảnh ưa thích của người dùng và lưu một giá trị trong tùy chọn người dùng của ứng dụng, vì vậy nó chỉ thực hiện thiết lập này một lần.

00:14:16.000 --> 00:14:24.000
Để xử lý các kết nối và ngắt kết nối của các camera bên ngoài, nó không phải quan sát trạng thái kết nối của một camera cụ thể nữa.

00:14:24.000 --> 00:14:29.000
Thay vào đó, giá trị khóa AVCam quan sát thuộc tính máy ảnh ưa thích của hệ thống.

00:14:29.000 --> 00:14:33.000
Điều này cho phép nó tự động chuyển sang máy ảnh tốt nhất hiện có.

00:14:33.000 --> 00:14:39.000
Trong quá trình xử lý KVO, ứng dụng có hệ thống máy ảnh ưa thích mới và chuyển sang nó.

00:14:39.000 --> 00:14:41.000
Nhưng nếu AVCam đang ghi âm thì sao?

00:14:41.000 --> 00:14:45.000
Ứng dụng không nên làm gián đoạn ghi âm bằng cách chuyển đổi máy ảnh.

00:14:45.000 --> 00:14:49.000
Vì vậy, ứng dụng chỉ chuyển đổi nếu nó không ở giữa bản ghi âm.

00:14:49.000 --> 00:14:57.000
Sau đó, khi quá trình quay phim kết thúc, ứng dụng sẽ truy vấn máy ảnh ưa thích của hệ thống để xem liệu nó có khác với những gì nó hiện đang sử dụng hay không.

00:14:57.000 --> 00:15:01.000
Nếu máy ảnh ưa thích của hệ thống đã thay đổi, ứng dụng sẽ chuyển sang nó.

00:15:01.000 --> 00:15:04.000
Bằng cách này nó không làm gián đoạn quá trình ghi âm.

00:15:04.000 --> 00:15:10.000
Những quyết định như thế này là những bước bạn sẽ phải thực hiện khi áp dụng máy ảnh bên ngoài và API lựa chọn máy ảnh tự động.

00:15:10.000 --> 00:15:13.000
Làm những gì có ý nghĩa nhất cho ứng dụng của bạn.

00:15:13.000 --> 00:15:19.000
AVCam có một nút để chuyển đổi máy ảnh và hoạt động bằng cách thay đổi giữa các thiết bị trước và sau.

00:15:19.000 --> 00:15:24.000
Trên iPad Pro này, có nhiều camera có thể được sử dụng ở cả hai vị trí.

00:15:24.000 --> 00:15:29.000
Vì vậy, AVCam có một số logic để chọn máy ảnh nào để sử dụng ở một vị trí nhất định.

00:15:29.000 --> 00:15:33.000
Nút bây giờ nên hoạt động như thế nào khi ứng dụng hỗ trợ camera bên ngoài?

00:15:33.000 --> 00:15:37.000
Tôi sẽ chọn đối xử với một máy ảnh bên ngoài như thể nó ở mặt trước.

00:15:37.000 --> 00:15:43.000
Máy ảnh trong Màn hình Apple Studio này đối diện với tôi giống như camera trước tích hợp của iPad.

00:15:43.000 --> 00:15:50.000
Nếu chức năng changeCamera không có thiết bị cụ thể để chuyển sang, ứng dụng sẽ kiểm tra vị trí của thiết bị hiện tại.

00:15:50.000 --> 00:15:59.000
Trong câu lệnh chuyển đổi kiểm tra vị trí của thiết bị hiện tại, ứng dụng sẽ tìm kiếm camera phía sau nếu nó hiện đang sử dụng camera có vị trí không xác định hoặc phía trước.

00:15:59.000 --> 00:16:03.000
Các camera bên ngoài báo cáo rằng vị trí của chúng không được xác định.

00:16:03.000 --> 00:16:10.000
Và nếu ứng dụng đang sử dụng camera phía sau, nó sẽ chuyển sang thiết bị bên ngoài nếu có sẵn.

00:16:10.000 --> 00:16:14.000
Nếu không, nó sẽ chuyển sang camera mặt trước tích hợp sẵn.

00:16:14.000 --> 00:16:27.000
Để tìm camera ngoài, ứng dụng tạo AVCaptureDeviceDiscoverySession bằng cách sử dụng loại thiết bị bên ngoài, loại phương tiện video và vị trí thiết bị không xác định.

00:16:27.000 --> 00:16:34.000
Sau đó, trong câu lệnh chuyển đổi khi vị trí của thiết bị hiện tại trở lại, trước tiên nó tìm kiếm một camera bên ngoài.

00:16:34.000 --> 00:16:39.000
Và nếu không tìm thấy, nó sẽ chuyển sang camera mặt trước tích hợp.

00:16:39.000 --> 00:16:50.000
Sau đó, khi ứng dụng tìm thấy máy ảnh mà nó muốn sử dụng, nó sẽ thông báo cho hệ thống lựa chọn bằng cách đặt thuộc tính lớp userPreferredCamera trên AVCaptureDevice.

00:16:50.000 --> 00:16:55.000
Cài đặt thuộc tính này cho phép hệ thống tìm hiểu các tùy chọn của người dùng.

00:16:55.000 --> 00:17:00.000
Bạn có thể chọn cách ứng dụng của bạn sẽ hỗ trợ các camera bên ngoài và cách cho phép người dùng chuyển đổi giữa chúng.

00:17:00.000 --> 00:17:09.000
Đối với AVCam, tôi đã chọn cho phép người dùng chuyển đổi giữa camera trước, sau và camera ngoài bằng cách xử lý camera ngoài như thể chúng ở mặt trước.

00:17:09.000 --> 00:17:13.000
Bằng cách này, nút chuyển đổi máy ảnh chỉ thay đổi giữa hai thiết bị.

00:17:13.000 --> 00:17:16.000
AVCam gần như đã sẵn sàng để hỗ trợ các camera bên ngoài.

00:17:16.000 --> 00:17:19.000
Chỉ còn một khía cạnh nữa để xử lý.

00:17:19.000 --> 00:17:24.000
Trong suốt thời gian này tôi đã sử dụng AVCam, iPad đã được gắn ngang với cổng USB-C ở bên phải.

00:17:24.000 --> 00:17:32.000
Nếu tôi xoay iPad, bản xem trước của camera bên ngoài bây giờ bị lộn ngược.

00:17:32.000 --> 00:17:35.000
Nhưng camera ngoài trong màn hình vẫn chưa di chuyển.

00:17:35.000 --> 00:17:40.000
Chỉ có iPad có.

00:17:40.000 --> 00:17:43.000
Tuy nhiên, AVCam không gặp vấn đề xoay vòng này với máy ảnh tích hợp.

00:17:43.000 --> 00:17:50.000
Điều này là do ứng dụng không biết cách định hướng các camera bên ngoài có vị trí độc lập với iPad.

00:17:50.000 --> 00:17:55.000
AVCam sẽ cần sửa đổi thêm để hiển thị đúng bản xem trước video của máy ảnh bên ngoài.

00:17:55.000 --> 00:18:03.000
Tiếp theo, tôi sẽ thảo luận về lý do tại sao xoay video lại quan trọng để xem trước trực tiếp và chụp ảnh và phim xuất hiện chính xác.

00:18:03.000 --> 00:18:06.000
Xoay video không phải là một khái niệm mới cho các ứng dụng máy ảnh.

00:18:06.000 --> 00:18:12.000
Nhưng khi sử dụng máy ảnh bên ngoài, điều quan trọng là phải biết rằng chúng di chuyển độc lập với iPad.

00:18:12.000 --> 00:18:14.000
Các ứng dụng được sử dụng để tích hợp máy ảnh.

00:18:14.000 --> 00:18:22.000
Và vì điều này, họ dựa vào hướng của iPad để xoay video của máy ảnh và sử dụng liệt kê AVCaptureVideoOrientation.

00:18:22.000 --> 00:18:25.000
Đây là những gì AVCam đã làm trong bản demo trước đó.

00:18:25.000 --> 00:18:30.000
Nó đã thử xoay camera ngoài để phù hợp với hướng của iPad.

00:18:30.000 --> 00:18:37.000
Trong iPadOS 17, AVCaptureVideoOrientation bị phản đối, cũng như API sử dụng enum này.

00:18:37.000 --> 00:18:42.000
Nó mô tả cách iPad được định hướng và giả định máy ảnh quay theo thiết bị.

00:18:42.000 --> 00:18:47.000
Nó không đủ biểu cảm để định hướng các máy ảnh bên ngoài, chúng di chuyển độc lập.

00:18:47.000 --> 00:18:56.000
Để sử dụng enum này, một ứng dụng thường chuyển đổi từ UIDeviceOrientation, cũng mô tả iPad và là một tín hiệu gián tiếp để định hướng máy ảnh.

00:18:56.000 --> 00:19:00.000
Vì vậy, chúng tôi đang giới thiệu API mới để xử lý việc xoay video.

00:19:00.000 --> 00:19:08.000
Mới đối với tất cả các nền tảng, bao gồm iPadOS, lớp AVCaptureDeviceRotationCoordinator có thể giúp định hướng đúng bất kỳ máy ảnh nào.

00:19:08.000 --> 00:19:16.000
Trình khởi tạo của lớp học có AVCaptureDevice và tùy chọn CALayer hiển thị bản xem trước video của máy ảnh.

00:19:16.000 --> 00:19:22.000
Các ứng dụng thường sử dụng AVCaptureVideoPreviewLayer hoặc AVSampleBufferDisplayLayer để hiển thị bản xem trước máy ảnh.

00:19:22.000 --> 00:19:27.000
Cả hai đều là các lớp con của CALayer và có thể được chuyển đến trình khởi tạo.

00:19:27.000 --> 00:19:34.000
Các ứng dụng sử dụng Metal hoặc các phương pháp kết xuất khác có thể chỉ cần chuyển lớp UIView hiển thị bản xem trước của máy ảnh.

00:19:34.000 --> 00:19:43.000
Điều phối viên có hai thuộc tính: Góc xoay video để xem trước cấp độ đường chân trời và góc riêng biệt để chụp cấp độ đường chân trời.

00:19:43.000 --> 00:19:49.000
Cả hai thuộc tính chỉ đọc này đều trả về một góc tính bằng độ và có thể quan sát được giá trị khóa.

00:19:49.000 --> 00:20:02.000
Xem trước và chụp nội dung ở cấp độ chân trời có nghĩa là các khung hình video từ máy ảnh luôn thẳng đứng so với trọng lực, bất kể thiết bị ở chế độ dọc, ngang hay lộn ngược.

00:20:02.000 --> 00:20:10.000
Sử dụng videoRotationAngleForHorizonLevelPreview để hiển thị các khung hình video trong CALayer được chuyển cho trình khởi tạo của điều phối viên.

00:20:10.000 --> 00:20:14.000
Nó mô tả số vòng quay để áp dụng cho bản xem trước.

00:20:14.000 --> 00:20:19.000
Góc có liên quan đến hệ tọa độ UIKit và SwiftUI.

00:20:19.000 --> 00:20:28.000
VideoRotationAngleForHorizonLevelCapture cho phép ứng dụng của bạn chụp ảnh và quay phim, vì vậy chúng luôn thẳng đứng khi ai đó xem chúng sau này.

00:20:28.000 --> 00:20:32.000
Thuộc tính này mô tả hướng vật lý của máy ảnh.

00:20:32.000 --> 00:20:35.000
Và giá trị của nó có thể khác với góc độ mà ứng dụng cần để xem trước.

00:20:35.000 --> 00:20:38.000
Hai thuộc tính này có mục đích khác nhau.

00:20:38.000 --> 00:20:43.000
Để giải thích về xoay video, tôi sẽ bắt đầu với các tình huống mà bạn quen thuộc khi sử dụng máy ảnh tích hợp.

00:20:43.000 --> 00:20:49.000
Sau đó, khi tôi sửa đổi AVCam, tôi sẽ giải thích cách những khái niệm này áp dụng cho các máy ảnh bên ngoài.

00:20:49.000 --> 00:20:56.000
Ứng dụng máy ảnh trên iPhone là một ví dụ điển hình về sự khác biệt giữa các góc quay video để xem trước và chụp ở cấp độ chân trời.

00:20:56.000 --> 00:21:02.000
Trong ví dụ này về ứng dụng hiển thị bản xem trước của camera sau, iPhone ở chế độ dọc.

00:21:02.000 --> 00:21:11.000
Nguồn gốc của hệ tọa độ UIKit nằm ở trên cùng bên trái của khu vực vẽ, nơi trục x dương của nó kéo dài sang phải và trục y dương kéo dài xuống.

00:21:11.000 --> 00:21:15.000
Hệ tọa độ của cảm biến camera sau có nguồn gốc khác.

00:21:15.000 --> 00:21:20.000
Cảm biến máy ảnh đầu tiên quét dọc theo chiều cao của điện thoại, sau đó dọc theo chiều rộng.

00:21:20.000 --> 00:21:28.000
Để tính đến hướng vật lý của máy ảnh, ứng dụng xoay các khung hình video của máy ảnh 90 độ để xem trước trong giao diện người dùng.

00:21:28.000 --> 00:21:33.000
Nó cũng xoay ảnh và phim mà nó chụp, vì vậy chúng thẳng đứng khi xem sau.

00:21:33.000 --> 00:21:37.000
Nó có hành vi khác nhau khi iPhone ở trong cảnh quan.

00:21:37.000 --> 00:21:42.000
Ứng dụng chỉ hiển thị giao diện người dùng theo chiều dọc, bất kể hướng của thiết bị.

00:21:42.000 --> 00:21:45.000
Bạn có thể biết dựa trên chỉ số khả năng chi trả nhà ở đâu.

00:21:45.000 --> 00:21:50.000
Đối với ứng dụng Camera trên iPhone, nó luôn ở bên cạnh cổng.

00:21:50.000 --> 00:22:02.000
Nguồn gốc của hệ tọa độ UIKit vẫn ở trên cùng bên trái của khu vực vẽ và trong trường hợp này, nó vẫn cố định ở một vị trí duy nhất trên thiết bị, vì giao diện người dùng của ứng dụng chỉ hỗ trợ một hướng.

00:22:02.000 --> 00:22:06.000
Và hệ tọa độ của cảm biến camera sau vẫn khác với giao diện người dùng.

00:22:06.000 --> 00:22:15.000
Vì ứng dụng chỉ hiển thị giao diện người dùng ở chế độ dọc, nên nó áp dụng xoay liên tục 90 độ để xem trước, bất kể hướng của iPhone.

00:22:15.000 --> 00:22:22.000
Nhưng không giống như để xem trước, ứng dụng áp dụng một số vòng quay khác khi chụp ảnh và quay phim khi iPhone ở ngang.

00:22:22.000 --> 00:22:31.000
Khi iPhone ở hướng gốc của cảm biến máy ảnh, ứng dụng không cần xoay ảnh hoặc phim để chúng xuất hiện thẳng đứng.

00:22:31.000 --> 00:22:34.000
Tất cả những cuộc nói chuyện xoay vòng này thực sự khiến đầu bạn quay cuồng.

00:22:34.000 --> 00:22:43.000
Nhưng AVCaptureDeviceRotationCoordinator chăm sóc sự phức tạp này và cung cấp các góc chính xác để xem trước và chụp từ tất cả các máy ảnh.

00:22:43.000 --> 00:22:48.000
Dựa vào nó để cung cấp các góc thay vì cố gắng tự tính toán chúng.

00:22:48.000 --> 00:22:53.000
Khi ứng dụng của bạn chuyển đổi máy ảnh, hãy đảm bảo tạo một điều phối viên xoay vòng mới.

00:22:53.000 --> 00:23:00.000
Để áp dụng xoay video, hãy sử dụng các góc mà điều phối viên cung cấp với API mới trên AVCaptureConnection.

00:23:00.000 --> 00:23:05.000
Chỉ các kết nối cung cấp dữ liệu phương tiện video hoặc chiều sâu mới hỗ trợ xoay vòng.

00:23:05.000 --> 00:23:11.000
Để kiểm tra xem một kết nối có hỗ trợ một góc hay không, bạn có thể gọi phương thức isVideoRotationAngleSupported của nó.

00:23:11.000 --> 00:23:17.000
Để kết nối thực hiện xoay vòng, hãy đặt thuộc tính videoRotationAngle của nó thành một giá trị được hỗ trợ.

00:23:17.000 --> 00:23:22.000
Sử dụng videoRotationAngleForHorizonLevelPreview để hiển thị bản xem trước của máy ảnh.

00:23:22.000 --> 00:23:31.000
Các ứng dụng sử dụng AVCaptureVideoPreviewLayer có thể áp dụng giá trị của thuộc tính cho thuộc tính videoRotationAngle của phiên bản AVCaptureConnection.

00:23:31.000 --> 00:23:36.000
Các ứng dụng cũng có thể sử dụng nó khi hiển thị bộ đệm từ đầu ra dữ liệu video trong CALayer.

00:23:36.000 --> 00:23:44.000
Để đồng bộ hóa với hoạt ảnh hệ thống, hãy thay đổi vòng quay xem trước ngay lập tức trong mã quan sát giá trị chính của ứng dụng của bạn.

00:23:44.000 --> 00:23:49.000
Ứng dụng của bạn có thể mong đợi nhận được các bản cập nhật cho thuộc tính này trên hàng đợi chính để cập nhật giao diện người dùng của nó.

00:23:49.000 --> 00:23:54.000
Không phải tất cả các ứng dụng đều sử dụng AVCaptureVideoPreviewLayer để hiển thị bản xem trước máy ảnh.

00:23:54.000 --> 00:24:00.000
Một số ứng dụng hiển thị bộ đệm từ đầu ra dữ liệu video khi áp dụng các hiệu ứng hoặc bộ lọc tùy chỉnh.

00:24:00.000 --> 00:24:06.000
Một lựa chọn để hiển thị bản xem trước tùy chỉnh là sử dụng AVSampleBufferDisplayLayer.

00:24:06.000 --> 00:24:12.000
Tránh yêu cầu xoay bằng cách đặt góc trên AVCaptureConnection của đầu ra dữ liệu video.

00:24:12.000 --> 00:24:21.000
Thay đổi góc của kết nối gây ra sự gián đoạn phân phối khung khi đường ống kết xuất chụp tự cấu hình lại để áp dụng lượng vòng quay mới.

00:24:21.000 --> 00:24:26.000
Thay vào đó, xoay CALayer hiển thị bản xem trước máy ảnh.

00:24:26.000 --> 00:24:31.000
Làm như vậy cho phép xem trước máy ảnh của ứng dụng của bạn xoay trơn tru.

00:24:31.000 --> 00:24:38.000
Sử dụng videoRotationAngleForHorizonLevelCapture khi chụp ảnh và phim, vì vậy chúng ở mức độ so với trọng lực.

00:24:38.000 --> 00:24:45.000
Ứng dụng của bạn có thể áp dụng giá trị của tài sản trên các kết nối chụp cho đầu ra ảnh hoặc đầu ra tệp phim.

00:24:45.000 --> 00:24:54.000
Ngoài ra, nếu ứng dụng của bạn sử dụng đầu ra dữ liệu video với AVAssetWriter để quay phim tùy chỉnh, hãy tránh xoay video bằng AVCaptureConnection.

00:24:54.000 --> 00:25:03.000
Thay vào đó, hãy đặt vòng quay với thuộc tính biến đổi của phiên bản AVAssetWriterInput, làm thay đổi siêu dữ liệu của tệp đầu ra.

00:25:03.000 --> 00:25:12.000
Với cách tiếp cận này, các ứng dụng video áp dụng xoay trong quá trình phát lại, sử dụng ít năng lượng hơn so với xoay mỗi khung hình với kết nối chụp.

00:25:12.000 --> 00:25:21.000
Ứng dụng của bạn cần chuyển đổi góc quay từ độ vì đầu vào ghi tài sản sử dụng CGAffineTransform áp dụng các phép quay theo radian.

00:25:21.000 --> 00:25:25.000
Một số đầu ra áp dụng hiệu quả vòng quay mà không cần thêm chi phí.

00:25:25.000 --> 00:25:31.000
Ví dụ, đầu ra tệp phim áp dụng xoay bằng ma trận theo dõi QuickTime.

00:25:31.000 --> 00:25:35.000
Đầu ra ảnh xử lý hướng với các thẻ Exif.

00:25:35.000 --> 00:25:39.000
Và lớp xem trước biến đổi nội dung của nó để thực hiện các vòng quay.

00:25:39.000 --> 00:25:49.000
Tuy nhiên, ứng dụng của bạn có thể tăng mức tiêu thụ điện năng của thiết bị nếu đầu ra dữ liệu video hoặc độ sâu thực hiện xoay vì chúng sử dụng nhiều bộ nhớ và năng lượng hơn để xoay bộ đệm.

00:25:49.000 --> 00:25:58.000
Thay vào đó, ứng dụng của bạn có thể thực hiện cách tiếp cận hiệu quả hơn bằng cách xoay CALayer để xem trước bộ đệm từ đầu ra video hoặc độ sâu.

00:25:58.000 --> 00:26:06.000
Sử dụng AVCaptureDeviceRotationCoordinator trên tất cả các nền tảng có sẵn, bao gồm iOS, tvOS và macOS.

00:26:06.000 --> 00:26:10.000
Các ứng dụng Mac Catalyst và iOS trên Mac cũng có thể sử dụng nó.

00:26:10.000 --> 00:26:17.000
Ứng dụng của bạn có thể sử dụng điều phối viên xoay vòng để định hướng chính xác ảnh hoặc phim và hiển thị bản xem trước video cho bất kỳ máy ảnh nào.

00:26:17.000 --> 00:26:24.000
Và nó giúp ứng dụng của bạn xử lý các bố cục phức tạp với Trình quản lý sân khấu hoặc khi nó ở trên màn hình ngoài.

00:26:24.000 --> 00:26:28.000
Bây giờ là lúc cho những thay đổi cuối cùng để hỗ trợ các camera bên ngoài trong AVCam.

00:26:28.000 --> 00:26:33.000
Khi định cấu hình phiên chụp, ứng dụng sẽ thiết lập bản xem trước máy ảnh của nó.

00:26:33.000 --> 00:26:40.000
Vì vậy, nó tạo ra một điều phối viên xoay thiết bị, cung cấp cho ứng dụng các góc quay cần thiết để xem trước và chụp.

00:26:40.000 --> 00:26:47.000
Khi tạo điều phối viên, ứng dụng cập nhật lớp xem trước với góc quay hiện tại để xem trước.

00:26:47.000 --> 00:26:52.000
Nó cũng quan sát những thay đổi về góc và cập nhật bản xem trước.

00:26:52.000 --> 00:27:00.000
Khi AVCam chuyển đổi thiết bị, nó cũng tạo ra một điều phối viên xoay vòng mới, vì vậy bản xem trước trông phù hợp với máy ảnh mới.

00:27:00.000 --> 00:27:07.000
Khi chụp ảnh, ứng dụng sử dụng góc xoay để chụp để đảm bảo chúng thẳng đứng khi ai đó xem chúng sau này.

00:27:07.000 --> 00:27:11.000
Và nó cũng làm như vậy khi quay phim.

00:27:11.000 --> 00:27:15.000
Với những thay đổi này, AVCam sẵn sàng hỗ trợ các camera bên ngoài.

00:27:15.000 --> 00:27:26.000
Bây giờ khi tôi xoay iPad, camera ngoài xuất hiện chính xác.

00:27:26.000 --> 00:27:31.000
Chúng tôi đã đề cập rất nhiều cho đến nay trong phiên này, và tôi cảm ơn bạn đã theo dõi tôi.

00:27:31.000 --> 00:27:38.000
Bây giờ tôi đã chỉ ra cách ứng dụng iPad của bạn có thể sử dụng camera ngoài, tôi sẽ thảo luận về cách bạn cũng có thể sử dụng micrô đi kèm với các thiết bị này.

00:27:38.000 --> 00:27:41.000
Một số webcam và màn hình bao gồm micrô.

00:27:41.000 --> 00:27:45.000
Khi chúng được cắm vào iPad, ứng dụng của bạn có thể sử dụng chúng.

00:27:45.000 --> 00:27:50.000
iPadOS 17 đã cải thiện hỗ trợ micrô ngoài trên iPad với USB-C.

00:27:50.000 --> 00:27:59.000
Các ứng dụng điện thoại sử dụng thiết bị âm thanh AUVoiceIO của Core Audio hiện có thể sử dụng micrô bên ngoài như những micrô đi kèm với webcam hoặc màn hình.

00:27:59.000 --> 00:28:04.000
Trước đây, các thiết bị có dây bên ngoài duy nhất mà các ứng dụng này có thể sử dụng là micrô tai nghe.

00:28:04.000 --> 00:28:12.000
AUVoiceIO là một giao diện phổ biến, vì nó thực hiện hủy tiếng vang và các điều chỉnh mới đã được giới thiệu cho micrô bên ngoài.

00:28:12.000 --> 00:28:23.000
Chế độ cách ly bằng giọng nói có sẵn từ Trung tâm điều khiển loại bỏ tiếng ồn xung quanh không mong muốn, chẳng hạn như gõ trên bàn phím, nhấp chuột hoặc máy thổi lá chạy ở đâu đó trong khu phố.

00:28:23.000 --> 00:28:27.000
Ứng dụng của bạn có thể sử dụng tính năng hệ thống này với micrô bên ngoài.

00:28:27.000 --> 00:28:32.000
Hệ thống định tuyến âm thanh iOS chỉ cho phép sử dụng một micrô tại một thời điểm.

00:28:32.000 --> 00:28:35.000
Nó cũng tự động thay đổi sang micrô được kết nối cuối cùng.

00:28:35.000 --> 00:28:43.000
Điều này là do, giống như khi kết nối máy ảnh, người dùng cho biết nên sử dụng micrô mới được kết nối.

00:28:43.000 --> 00:28:47.000
Trên iOS, hệ thống chỉ trả về một AVCaptureDevice cho micrô.

00:28:47.000 --> 00:28:59.000
Bạn có thể tìm thấy nó bằng cách tìm kiếm thiết bị có loại phương tiện âm thanh hoặc với loại thiết bị micrô mới, loại này không dùng builtInMicrophone vì không phải tất cả micrô đều được tích hợp vào iPad.

00:28:59.000 --> 00:29:05.000
Hệ thống định tuyến âm thanh quyết định sử dụng micrô nào có sẵn, có thể là micrô tích hợp sẵn hay bên ngoài.

00:29:05.000 --> 00:29:13.000
Khi hệ thống thay đổi lộ trình đầu vào, thuộc tính localizedName của micrô AVCaptureDevice sẽ thay đổi để phản ánh thiết bị đang sử dụng.

00:29:13.000 --> 00:29:17.000
Ứng dụng của bạn có thể sử dụng AVAudioSession để kiểm soát micrô nhiều hơn.

00:29:17.000 --> 00:29:22.000
Bạn có thể sử dụng nó để định cấu hình hành vi âm thanh của ứng dụng bằng cách đặt danh mục hoặc chế độ.

00:29:22.000 --> 00:29:29.000
Và bạn có thể chọn sử dụng một micrô cụ thể, chẳng hạn như micrô đi kèm với camera ngoài, bằng cách đặt đầu vào ưa thích.

00:29:29.000 --> 00:29:37.000
Đối với chủ đề cuối cùng của phiên này, tôi sẽ thảo luận về một số phương pháp hay nhất cho ứng dụng của bạn khi sử dụng máy ảnh bên ngoài.

00:29:37.000 --> 00:29:40.000
Khi bạn bắt đầu áp dụng, hãy xem xét điều gì có ý nghĩa nhất đối với ứng dụng của bạn.

00:29:40.000 --> 00:29:46.000
Trước đó, tôi đã chỉ ra cách FaceTime, Code Scanner và WebKit đã chọn hỗ trợ các camera bên ngoài khác nhau.

00:29:46.000 --> 00:29:50.000
Sử dụng chúng làm ví dụ về những cách khác nhau mà ứng dụng của bạn có thể áp dụng.

00:29:50.000 --> 00:29:57.000
Định cấu hình iPad của bạn để gỡ lỗi không dây với Xcode trong khi cổng USB-C đang được sử dụng bởi camera ngoài.

00:29:57.000 --> 00:30:02.000
Một số khả năng mà ứng dụng của bạn có thể mong đợi từ máy ảnh tích hợp có thể không được hỗ trợ bởi các thiết bị bên ngoài.

00:30:02.000 --> 00:30:10.000
Ví dụ: nếu ứng dụng của bạn dựa vào việc thu thập dữ liệu độ sâu cho một số tính năng, bạn có thể phải tắt nó khi sử dụng máy ảnh bên ngoài.

00:30:10.000 --> 00:30:18.000
Các ứng dụng sử dụng nhiều camera cùng một lúc với AVCaptureMultiCamSession có thể thêm camera bên ngoài để thiết lập chụp sáng tạo.

00:30:18.000 --> 00:30:23.000
iPadOS cung cấp cho máy ảnh bên ngoài một số cách xử lý mà nó cũng áp dụng cho máy ảnh mặt trước.

00:30:23.000 --> 00:30:27.000
AVCaptureVideoPreviewLayer phản chiếu các camera bên ngoài theo mặc định.

00:30:27.000 --> 00:30:31.000
Điều này hoạt động tốt khi máy ảnh đối diện với người dùng iPad.

00:30:31.000 --> 00:30:33.000
Nhưng điều này không phù hợp với tất cả các trường hợp sử dụng.

00:30:33.000 --> 00:30:42.000
Nếu người dùng ứng dụng của bạn phát trực tuyến từ bộ chuyển đổi HDMI hoặc hướng camera bên ngoài ra xa họ, hãy cân nhắc cho phép người dùng tắt tính năng phản chiếu xem trước.

00:30:42.000 --> 00:30:45.000
Trong phần trước, tôi đã mô tả vòng quay của máy ảnh.

00:30:45.000 --> 00:30:55.000
Mặc dù ứng dụng của bạn có thể sẽ không cần áp dụng xoay video cho máy ảnh bên ngoài, nhưng hãy lưu ý rằng nếu bạn làm vậy, hệ thống sẽ xoay máy ảnh bên ngoài theo chiều kim đồng hồ về phía cảnh mà nó đang đối mặt.

00:30:55.000 --> 00:31:00.000
Đây cũng giống như cách nó áp dụng xoay cho máy ảnh tích hợp.

00:31:00.000 --> 00:31:04.000
Chuẩn bị ứng dụng của bạn để xử lý máy ảnh với các khả năng khác nhau.

00:31:04.000 --> 00:31:14.000
Ví dụ, một số máy ảnh bên ngoài chỉ có thể báo cáo hai định dạng, như định dạng VGA 640x480 và định dạng HD 1280x720.

00:31:14.000 --> 00:31:18.000
Và một số máy ảnh bên ngoài hỗ trợ các định dạng pixel thường không được sử dụng trên iOS.

00:31:18.000 --> 00:31:24.000
Chúng tôi đã chọn chuyển đổi những thứ này sang các định dạng phổ biến hơn mà các ứng dụng máy ảnh iOS được sử dụng để xử lý.

00:31:24.000 --> 00:31:30.000
Các định dạng không nén như yuvs và 2vuy được chuyển đổi thành 420v.

00:31:30.000 --> 00:31:36.000
Và các định dạng nén như phát trực tuyến JPEG và H264 được chuyển đổi thành 420f.

00:31:36.000 --> 00:31:43.000
Bởi vì một máy ảnh bên ngoài có thể có các định dạng ở bất kỳ kích thước nào, nó có thể không hỗ trợ tất cả các cài đặt trước AVCaptureSession.

00:31:43.000 --> 00:31:49.000
Ví dụ, cài đặt trước HD 4K yêu cầu thiết bị phải có định dạng tương thích.

00:31:49.000 --> 00:31:56.000
Ứng dụng của bạn có thể kiểm tra xem nó có thể sử dụng cài đặt trước hay không bằng cách gọi phương thức supportsSessionPreset trên AVCaptureDevice.

00:31:56.000 --> 00:32:02.000
Ứng dụng của bạn có thể định cấu hình máy ảnh bên ngoài, bao gồm thay đổi độ phân giải, tốc độ khung hình và hệ số thu phóng.

00:32:02.000 --> 00:32:08.000
iPadOS hỗ trợ một bộ điều khiển máy ảnh giới hạn có sẵn trong thông số kỹ thuật của USB Video Class.

00:32:08.000 --> 00:32:12.000
Vì vậy, truy vấn AVCaptureDevice để biết khả năng của nó.

00:32:12.000 --> 00:32:15.000
Hãy kết thúc mọi thứ tôi vừa nói.

00:32:15.000 --> 00:32:28.000
Tôi đã chỉ ra cách bạn có thể khám phá và sử dụng máy ảnh bên ngoài, cách xoay khung hình video của máy ảnh đúng cách, sử dụng micrô bên ngoài và cuối cùng là các phương pháp hay nhất cho ứng dụng của bạn.

00:32:28.000 --> 00:32:32.000
Chúng tôi rất vui khi thấy cách bạn bắt đầu sử dụng camera ngoài trong ứng dụng iPad của mình.

00:32:32.000 --> 00:32:34.000
Cảm ơn bạn, và tôi hy vọng ứng dụng của bạn sẽ thành công.

00:32:34.000 --> 23:59:59.000
♪ ♪

