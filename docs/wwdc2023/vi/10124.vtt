WEBVTT

00:00:00.000 --> 00:00:10.000
♪ ♪

00:00:10.000 --> 00:00:11.000
Xin chào, và chào mừng.

00:00:11.000 --> 00:00:18.000
Tôi là Varun Subramanian, một Kỹ sư trong nhóm GPU, Đồ họa và Phần mềm Hiển thị tại Apple.

00:00:18.000 --> 00:00:24.000
Phiên này là phần thứ hai của loạt bài gồm 3 phần về việc đưa các trò chơi cao cấp của bạn lên Mac.

00:00:24.000 --> 00:00:29.000
Phiên đầu tiên, bao gồm cách bạn có thể đánh giá trò chơi của mình và "lên kế hoạch trò chơi".

00:00:29.000 --> 00:00:48.000
Phiên này tập trung vào bộ đổ bóng của bạn và cách cải thiện tính linh hoạt và tốc độ của chúng với một số công cụ trình biên dịch Metal mới, bao gồm các cách mới để chuyển đổi bộ đổ bóng của bạn thành biểu diễn trung gian Metal và cách tránh biên dịch trên thiết bị bằng cách hoàn thiện các tệp nhị phân GPU trong thời gian xây dựng trò chơi của bạn.

00:00:48.000 --> 00:00:56.000
Chuỗi công cụ trình biên dịch Metal giúp bạn biên dịch các trình đổ bóng cung cấp năng lượng cho trò chơi của bạn và Metal giờ đây làm cho điều đó dễ dàng hơn bao giờ hết.

00:00:56.000 --> 00:01:04.000
Tạo Metal IR trên thiết bị là không tối ưu vì nó thêm chi phí biên dịch trước khi GPU có thể thực hiện công việc bạn cần.

00:01:04.000 --> 00:01:11.000
Metal cung cấp cho bạn các công cụ cần thiết để tạo Metal IR từ Metal Shading Language của bạn trước thời hạn.

00:01:11.000 --> 00:01:15.000
Metal IR đó được lưu trữ như một phần của thư viện Metal.

00:01:15.000 --> 00:01:22.000
Bạn nên luôn đặt mục tiêu tạo các thư viện Metal của mình bằng cách sử dụng chuỗi công cụ biên dịch Metal trước thời hạn.

00:01:22.000 --> 00:01:27.000
Tuy nhiên, khi đến từ một API và ngôn ngữ đổ bóng khác, bạn cần một cách để đưa chúng đến Metal.

00:01:27.000 --> 00:01:32.000
Nếu bạn là người mới đến với Mac, bây giờ bạn có Metal Shader Converter.

00:01:32.000 --> 00:01:43.000
Điều này đơn giản hóa các đường ống đổ bóng của bạn và cho phép bạn đóng gói các thư viện Metal được tạo trực tiếp trong gói của mình, tránh tạo Metal IR trên thiết bị.

00:01:43.000 --> 00:01:52.000
Các thư viện Metal được tạo giống như các thư viện được tạo từ trình biên dịch Metal cho phép các trình đổ bóng được chuyển đổi của bạn tích hợp nguyên bản với Metal API.

00:01:52.000 --> 00:01:58.000
Sử dụng công cụ mới để chuyển đổi các bộ đổ bóng hiện có của bạn thành các thư viện Kim loại mà sau đó bạn gửi cùng với trò chơi của mình.

00:01:58.000 --> 00:02:05.000
Metal Shader Converter cung cấp một bộ tính năng mạnh mẽ để cải thiện trải nghiệm chuyển đổi shader của bạn sang Metal.

00:02:05.000 --> 00:02:09.000
Nó tiêu thụ DXIL để sản xuất Metal IR.

00:02:09.000 --> 00:02:14.000
Bạn sử dụng nó cùng với công cụ biên dịch DXC mã nguồn mở để xây dựng một đường ống đổ bóng đầu cuối.

00:02:14.000 --> 00:02:22.000
Chuyển đổi từ DXIL sang Metal IR rất nhanh vì bộ chuyển đổi đổ bóng kim loại thực hiện chuyển đổi ở cấp độ nhị phân.

00:02:22.000 --> 00:02:26.000
Kết quả là bạn sẽ giảm thời gian xây dựng tài sản đổ bóng.

00:02:26.000 --> 00:02:31.000
Nó cũng cho phép bạn tận dụng các tính năng nâng cao của GPU Apple.

00:02:31.000 --> 00:02:41.000
Bạn có thể làm điều này vì bộ tính năng phong phú của bộ chuyển đổi đổ bóng kim loại, hỗ trợ tất cả các giai đoạn đổ bóng truyền thống và hiện đại của bộ đổ bóng DXIL hiện có của bạn.

00:02:41.000 --> 00:02:51.000
Sử dụng bộ chuyển đổi đổ bóng kim loại, bạn có thể chuyển đổi bộ đổ bóng của mình cho đường ống đồ họa truyền thống bao gồm bộ đổ bóng hình học và tessellation thành các thư viện Metal.

00:02:51.000 --> 00:03:00.000
Nó cũng hỗ trợ tính toán đổ bóng, cũng như các giai đoạn dò tia được giới thiệu gần đây hơn và đổ bóng và khuếch đại và đổ bóng lưới.

00:03:00.000 --> 00:03:06.000
Bây giờ, tôi sẽ hướng dẫn bạn cách sử dụng bộ chuyển đổi đổ bóng kim loại.

00:03:06.000 --> 00:03:10.000
Có hai tình huống mà bạn có thể muốn chuyển đổi bộ đổ bóng của mình thông qua dòng lệnh.

00:03:10.000 --> 00:03:16.000
Sử dụng công cụ dòng lệnh thông qua thiết bị đầu cuối là một cơ chế tốt để chuyển đổi từng bộ đổ bóng một.

00:03:16.000 --> 00:03:25.000
Nếu bạn có nhiều bộ đổ bóng, bạn có thể tạo một tập lệnh shell gọi bộ chuyển đổi bộ đổ bóng Metal để tự động chuyển đổi nhiều bộ đổ bóng cho bạn.

00:03:25.000 --> 00:03:29.000
Chuyển đổi bộ đổ bóng của bạn bằng cách sử dụng công cụ dòng lệnh rất dễ dàng.

00:03:29.000 --> 00:03:36.000
Sau khi bạn thiết lập DXC và bộ chuyển đổi đổ bóng, hãy bắt đầu bằng cách biên dịch bộ đổ bóng HLSL của bạn sang DXIL.

00:03:36.000 --> 00:03:42.000
DXC yêu cầu bạn chỉ định điểm vào để biên dịch, loại đổ bóng và tệp đầu ra.

00:03:42.000 --> 00:03:49.000
Tiếp theo, gọi trình chuyển đổi đổ bóng trên tệp DXIL vừa tạo và chỉ định thư viện Metal đầu ra để tạo.

00:03:49.000 --> 00:03:58.000
Theo mặc định, trình chuyển đổi đổ bóng tạo thư viện Metal cho phiên bản macOS mới nhất, cũng như tệp JSON với dữ liệu phản xạ hữu ích.

00:03:58.000 --> 00:04:05.000
Trong thời gian chạy, bạn chuyển thư viện Metal này đến thiết bị Metal để tải nó và xây dựng các đối tượng trạng thái đường ống.

00:04:05.000 --> 00:04:11.000
Có hai tình huống khác mà giao diện dòng lệnh có thể không phải là lựa chọn tốt nhất cho quy trình làm việc của bạn.

00:04:11.000 --> 00:04:18.000
Một số công cụ trò chơi có các chương trình xây dựng nội dung tùy chỉnh biên dịch và đóng gói các trình đổ bóng thành các định dạng dành riêng cho trò chơi.

00:04:18.000 --> 00:04:30.000
Ngoài ra, trong một số tình huống, khi bạn khởi động trò chơi của mình cho Metal, bạn cũng có thể muốn xem bộ đổ bóng của mình hoạt động tốt như thế nào trên nền tảng trước khi bạn biến chúng thành thư viện Metal trước thời hạn.

00:04:30.000 --> 00:04:36.000
Đối với hai trường hợp cuối cùng này, bạn cần một cách để tích hợp tốt hơn bộ chuyển đổi đổ bóng kim loại vào quy trình làm việc của mình.

00:04:36.000 --> 00:04:41.000
Để thực hiện điều này, hãy sử dụng thư viện động của bộ chuyển đổi đổ bóng kim loại.

00:04:41.000 --> 00:04:47.000
Nó hiển thị tất cả các chức năng giống như công cụ CLI để giúp bạn tạo các thư viện Metal.

00:04:47.000 --> 00:04:57.000
Thư viện cung cấp giao diện C thuần túy và giống như CLI, nó có sẵn trên cả macOS và Windows, vì vậy thật dễ dàng để tích hợp vào quy trình làm việc hiện tại của bạn.

00:04:57.000 --> 00:05:06.000
Sau khi bạn đã chuyển đổi bộ đổ bóng của mình sang Metal IR, để tích hợp chúng vào trò chơi của mình, bạn tạo các trạng thái đường ống và liên kết các tài nguyên với chúng.

00:05:06.000 --> 00:05:13.000
Trong bộ đổ bóng của mình, bạn thường xác định tài nguyên là các biến toàn cục và gán các khai báo "đăng ký" cho chúng.

00:05:13.000 --> 00:05:22.000
Từ phía API, trò chơi của bạn hoặc liên kết tài nguyên trực tiếp với các vị trí này hoặc xác định bố cục bộ nhớ rõ ràng thông qua "chữ ký gốc".

00:05:22.000 --> 00:05:28.000
Bộ chuyển đổi Shader có thể giúp bạn đưa mô hình này đến, bởi vì Metal có một mô hình ràng buộc rất linh hoạt.

00:05:28.000 --> 00:05:32.000
Công cụ đưa ra các tài nguyên này vào bộ đệm Đối số.

00:05:32.000 --> 00:05:39.000
Trong mô hình này, bạn liên kết một bộ đệm đối số trực tiếp với đường ống của bạn và tham chiếu tài nguyên của bạn thông qua nó.

00:05:39.000 --> 00:05:46.000
Có hai chế độ bố cục cho bộ đệm Đối số "cấp cao nhất" này mà bạn có thể chọn, để phù hợp nhất với trò chơi của mình.

00:05:46.000 --> 00:05:53.000
Bố cục đơn giản nhất bạn có thể tạo là bố cục tự động, trong đó bộ chuyển đổi đổ bóng lần lượt đặt tài nguyên của bạn.

00:05:53.000 --> 00:06:02.000
Khi bạn tạo một trạng thái đường ống chứa bộ đổ bóng của mình, bạn liên kết một bộ đệm đối số duy nhất và thông qua nó, bạn tham chiếu tất cả các tài nguyên của mình.

00:06:02.000 --> 00:06:08.000
Ngoài ra, trình chuyển đổi đổ bóng hỗ trợ xác định rõ ràng bố cục phù hợp với chữ ký gốc của bạn.

00:06:08.000 --> 00:06:18.000
Sử dụng chế độ này khi trò chơi của bạn cần chỉ định các kết cấu và bộ lấy mẫu riêng biệt vào bảng tài nguyên của riêng chúng hoặc nếu trò chơi của bạn sử dụng tài nguyên không ràng buộc.

00:06:18.000 --> 00:06:27.000
Bạn cũng có thể nhúng bộ đệm thô và hằng số 32 bit trực tiếp vào bộ đệm đối số cấp cao nhất, được hiển thị dưới dạng 0 và 1 trong sơ đồ này.

00:06:27.000 --> 00:06:40.000
Bây giờ, Argument Buffer cấp cao nhất là một tài nguyên được chia sẻ giữa CPU và GPU, vì vậy khi bạn ghi vào nó, bạn cần phối hợp quyền truy cập vào bộ nhớ của nó để tránh điều kiện cuộc đua có thể gây ra hỏng hình ảnh.

00:06:40.000 --> 00:06:44.000
Bạn không cần phải tuần tự hóa công việc CPU và GPU để tránh điều kiện cuộc đua này.

00:06:44.000 --> 00:06:48.000
Một cách để tránh điều này là sử dụng bộ phân bổ vết sưng.

00:06:48.000 --> 00:06:53.000
Đây có thể là một bộ đệm Kim loại lớn mà từ đó bạn phân bổ phụ các tài nguyên khác nhau cho mỗi khung.

00:06:53.000 --> 00:06:58.000
Sau đó, bạn che bộ đệm nền cho mỗi khung hình trong chuyến bay mà trò chơi của bạn xử lý.

00:06:58.000 --> 00:07:03.000
Để biết thêm chi tiết về việc triển khai bump allocator, hãy xem mã mẫu của chúng tôi.

00:07:03.000 --> 00:07:09.000
Để có các phương pháp quản lý bộ đệm Argument tốt nhất, hãy xem phiên không ràng buộc từ năm ngoái và tài liệu Metal.

00:07:09.000 --> 00:07:16.000
Mô hình ràng buộc không phải là nơi duy nhất mà bộ chuyển đổi đổ bóng kim loại có thể giúp bạn đưa bộ đổ bóng của mình lên máy Mac.

00:07:16.000 --> 00:07:21.000
Lập bản đồ các giai đoạn đổ bóng nhất định có thể là một thách thức do sự khác biệt trong API đồ họa.

00:07:21.000 --> 00:07:27.000
Ví dụ, bạn có thể có các đường ống tận dụng các giai đoạn hình học và tessellation truyền thống.

00:07:27.000 --> 00:07:39.000
Metal là một API hiện đại và nó cung cấp các tính năng như ID khung nhìn và khuếch đại khiến các giai đoạn cũ hơn, kém hiệu quả hơn từ các API đồ họa khác trở nên không cần thiết.

00:07:39.000 --> 00:07:49.000
Tuy nhiên, khi trò chơi của bạn dựa vào các đường ống này cho các hiệu ứng truyền thống giúp tăng cường một số bề mặt, như cỏ được hiển thị trong hình ảnh này, việc chuyển đổi chúng bằng tay rất tốn kém.

00:07:49.000 --> 00:07:58.000
Bộ chuyển đổi đổ bóng kim loại giúp bạn đưa các đường ống này sang Metal, bằng cách ánh xạ chúng đến Mesh Shaders, một cấu trúc API đồ họa hiện đại và hiệu quả hơn.

00:07:58.000 --> 00:08:07.000
Công cụ này thực hiện việc nâng vật nặng để đưa các đường ống phức tạp này đến Metal một cách dễ dàng, bằng cách ánh xạ từng giai đoạn thành biểu diễn Metal IR.

00:08:07.000 --> 00:08:12.000
Điều này bao gồm tessellator, theo truyền thống là một hoạt động chức năng cố định.

00:08:12.000 --> 00:08:21.000
Để hỗ trợ quy trình làm việc này, năm nay Metal bổ sung khả năng liên kết các chức năng có thể nhìn thấy với các giai đoạn "đối tượng và lưới" của Bộ đổ bóng lưới.

00:08:21.000 --> 00:08:31.000
Sau khi bạn đã biên dịch các bộ đổ bóng của mình, bạn sử dụng chúng để xây dựng "Mô tả đường ống kết xuất lưới kim loại" và biên dịch nó thành "Trạng thái Đường ống kết xuất kim loại".

00:08:31.000 --> 00:08:44.000
Khi Metal nhận được yêu cầu xây dựng trạng thái đường ống này, nó sẽ biên dịch và liên kết tất cả Metal IR, nướng tất cả các chức năng vào một đường ống duy nhất, hoàn toàn tránh chi phí gọi hàm và tối đa hóa hiệu suất trong thời gian chạy.

00:08:44.000 --> 00:08:54.000
Lưu ý sức mạnh và tính linh hoạt của các chức năng hiển thị kim loại cho phép bạn xây dựng đường ống kết xuất phức tạp này chứa các giai đoạn đổ bóng này với các chức năng bổ sung của chúng.

00:08:54.000 --> 00:09:01.000
Mặc dù việc xây dựng các đường ống lưới này rất đơn giản, nhưng mỗi đường ống phải tuân theo một loạt các bước theo thứ tự chính xác.

00:09:01.000 --> 00:09:05.000
Thời gian chạy bộ chuyển đổi đổ bóng giúp bạn xây dựng các đường ống phức tạp này.

00:09:05.000 --> 00:09:09.000
Nó thậm chí còn mô phỏng các cuộc gọi vẽ bằng cách gửi công việc đổ bóng lưới.

00:09:09.000 --> 00:09:14.000
Để biết thêm thông tin, vui lòng tham khảo tài liệu Metal Shader Converter.

00:09:14.000 --> 00:09:23.000
Bây giờ bộ đổ bóng của bạn đang ở trên Metal và bạn đang chạy trạng thái đường ống của mình, đây là một số mẹo để giúp bạn có được hiệu suất tuyệt vời và độ chính xác trực quan.

00:09:23.000 --> 00:09:27.000
Shader được biên soạn với bộ chuyển đổi shader tham chiếu gián tiếp các tài nguyên Kim loại.

00:09:27.000 --> 00:09:32.000
Để gắn cờ cư trú tài nguyên cho Metal, bạn sẽ gọi "useResource".

00:09:32.000 --> 00:09:37.000
Tuy nhiên, useResource là một cuộc gọi tốn kém khi được sử dụng quá mức.

00:09:37.000 --> 00:09:48.000
Sử dụng useResources số nhiều để cung cấp nhiều tài nguyên cùng một lúc hoặc cân nhắc sử dụng Metal heaps thông qua useHeap để gắn cờ cư trú của một số tài nguyên trong một cuộc gọi.

00:09:48.000 --> 00:09:57.000
Các đối tượng đường ống được lưu vào bộ nhớ cache khi Metal biên dịch chúng lần đầu tiên, tự động giảm quá giang dựa trên biên dịch trong các lần chạy tiếp theo của trò chơi của bạn.

00:09:57.000 --> 00:10:00.000
Kho lưu trữ nhị phân cũng có thể giúp bạn ở đây.

00:10:00.000 --> 00:10:07.000
Để tận dụng tối đa GPU và tùy chỉnh Metal IR để có hiệu suất cao hơn, bộ chuyển đổi đổ bóng cung cấp cho bạn các tùy chọn.

00:10:07.000 --> 00:10:17.000
Có các tùy chỉnh về khả năng tương thích, họ GPU, hành vi tìm nạp đỉnh, đặt tên điểm vào, phản ánh và hơn thế nữa.

00:10:17.000 --> 00:10:21.000
Đây là một cơ hội tối ưu hóa bổ sung.

00:10:21.000 --> 00:10:29.000
Tôi đã đề cập trước đó rằng trình chuyển đổi đổ bóng tham gia trình biên dịch Metal như một cơ chế khác để tạo ra "Thư viện Metal" từ IR đổ bóng hiện có của bạn.

00:10:29.000 --> 00:10:34.000
Metal sử dụng những thứ này để cung cấp các giai đoạn đường ống đồ họa khác nhau.

00:10:34.000 --> 00:10:44.000
Vì mọi thứ đều là Metal IR, bạn có thể kết hợp "Thư viện Metal" đến từ bộ chuyển đổi đổ bóng Metal và từ Trình biên dịch Metal trong một ứng dụng duy nhất và thậm chí trong một đường ống duy nhất.

00:10:44.000 --> 00:10:50.000
Ngôn ngữ đổ bóng kim loại cũng cho phép bạn truy cập các tính năng độc đáo như pha trộn có thể lập trình.

00:10:50.000 --> 00:10:54.000
Sử dụng cách tiếp cận này để tận dụng tối đa GPU của Apple.

00:10:54.000 --> 00:10:59.000
Bạn thậm chí có thể tận dụng chức năng tô bóng độc đáo như tô bóng gạch.

00:10:59.000 --> 00:11:03.000
Điều này mang lại cho bạn sự linh hoạt to lớn trong cách bạn đưa trò chơi của mình lên Metal.

00:11:03.000 --> 00:11:08.000
Hiệu suất rất quan trọng nhưng tính chính xác trực quan của trò chơi của bạn là tối quan trọng.

00:11:08.000 --> 00:11:13.000
HLSL cho phép xử lý liền mạch các kết cấu như các mảng của một phần tử.

00:11:13.000 --> 00:11:22.000
Để mang lại các bộ đổ bóng dựa trên hành vi này, hãy tạo kết cấu của bạn dưới dạng mảng kết cấu hoặc tạo "chế độ xem mảng kết cấu" trên kết cấu của bạn.

00:11:22.000 --> 00:11:28.000
Nếu bạn đang sử dụng "MetalKit Texture Loader", nó cũng có thể giúp bạn tải các tệp dưới dạng mảng kết cấu.

00:11:28.000 --> 00:11:42.000
Để thiết lập các đối tượng lấy mẫu của bạn và đọc từ các kết cấu này, hãy đảm bảo cho Metal biết trước rằng bạn có ý định tham chiếu các bộ lấy mẫu trong bộ đệm đối số bằng cách sử dụng thuộc tính supportsArgumentBuffers trong MTL Sampler Descriptor.

00:11:42.000 --> 00:11:48.000
Bây giờ bạn đã quen với việc tích hợp bộ chuyển đổi đổ bóng trong quy trình làm việc của mình, đây là cách để có được nó.

00:11:48.000 --> 00:11:52.000
Bạn có thể tải xuống Metal shader converter từ developer.apple.com.

00:11:52.000 --> 00:11:57.000
Nếu bạn đang làm việc trên máy Mac của mình, hãy tải bộ chuyển đổi đổ bóng kim loại cho gói Mac.

00:11:57.000 --> 00:12:02.000
Nếu bạn đang làm việc trên Windows, nó là một phần của gói Công cụ Nhà phát triển Kim loại cho Windows.

00:12:02.000 --> 00:12:04.000
Phiên bản beta của công cụ hiện đã có sẵn.

00:12:04.000 --> 00:12:12.000
Cả hai gói đều chứa bộ chuyển đổi đổ bóng kim loại, ở dạng độc lập và thư viện, cũng như tiêu đề đồng hành trong thời gian chạy.

00:12:12.000 --> 00:12:17.000
Tài liệu đầy đủ cũng như mẫu mã Metal C++ hiện đã có sẵn.

00:12:17.000 --> 00:12:25.000
Sử dụng mã mẫu để khám phá mô phỏng hình học và tessellation, bản vẽ ví dụ và tính toán đổ bóng.

00:12:25.000 --> 00:12:32.000
Chuyển đổi bộ đổ bóng của bạn thành các thư viện Kim loại mà bạn gửi cùng với trò chơi của mình giúp bạn tránh tạo các thư viện đó trong thời gian chạy trò chơi.

00:12:32.000 --> 00:12:40.000
Có một tối ưu hóa bổ sung mà bạn có thể thực hiện, đó là biên dịch các tệp nhị phân GPU của bạn trước thời hạn.

00:12:40.000 --> 00:12:47.000
Khi bạn xây dựng trò chơi của mình, bạn biên dịch các trình đổ bóng của mình vào các thư viện Metal vẫn cần được hoàn thiện thành các tệp nhị phân GPU.

00:12:47.000 --> 00:12:53.000
Thông thường trò chơi của bạn thực hiện điều này khi khởi chạy, dẫn đến màn hình tải lâu hơn.

00:12:53.000 --> 00:13:01.000
Nếu bạn trì hoãn việc hoàn thiện các tệp nhị phân GPU trong thời gian chạy, nó có thể dẫn đến việc giảm khung hình khi trò chơi biên dịch các đường ống mới theo yêu cầu.

00:13:01.000 --> 00:13:10.000
Trình biên dịch Metal GPU Binary có thể giúp bạn giải quyết vấn đề này bằng cách cho phép bạn tạo các tệp nhị phân đổ bóng của mình tại thời điểm xây dựng trò chơi.

00:13:10.000 --> 00:13:20.000
Bằng cách loại bỏ nhu cầu tạo các tệp nhị phân đổ bóng trong quá trình chơi trò chơi, người chơi của bạn được hưởng lợi từ việc giảm thời gian tải ứng dụng mà không phải chịu thêm các trở ngại về GPU.

00:13:20.000 --> 00:13:29.000
Để tận dụng điều này, bạn có thể thêm một bước khác vào quy trình làm việc của mình để hoàn thiện các thư viện Metal của mình vào kho lưu trữ nhị phân Metal tại thời điểm xây dựng.

00:13:29.000 --> 00:13:35.000
Trên thiết bị GPU Binary compilation xảy ra khi bạn tạo trạng thái đường ống từ một bộ mô tả.

00:13:35.000 --> 00:13:47.000
Bộ mô tả này không chỉ tham chiếu các chức năng từ thư viện Metal mà còn cung cấp các thông tin quan trọng khác cho Metal như định dạng màu của tệp đính kèm kết xuất và bộ mô tả bố cục đỉnh.

00:13:47.000 --> 00:13:54.000
Các tệp nhị phân GPU được tạo đúng lúc như một phần của việc tạo PSO.

00:13:54.000 --> 00:13:58.000
Kho lưu trữ nhị phân cho phép bạn kiểm soát thời điểm quá trình biên dịch đó xảy ra.

00:13:58.000 --> 00:14:08.000
Để tạo ra các tệp nhị phân GPU trước thời hạn, bạn cung cấp cả Thư viện Kim loại hiện có của mình cũng như tập lệnh cấu hình đường ống tham chiếu đến các thư viện đó.

00:14:08.000 --> 00:14:15.000
Sau đó, bạn cung cấp cả hai cho metal-tt, tạo ra một kho lưu trữ nhị phân với các tệp nhị phân GPU.

00:14:15.000 --> 00:14:22.000
Để phát triển tập lệnh đường ống, bạn tạo một tập lệnh JSON với các cấu hình đường ống tương tự như Metal API.

00:14:22.000 --> 00:14:29.000
Mã Metal này tạo ra một bộ mô tả đường ống kết xuất và bên cạnh là biểu diễn tương đương JSON của nó.

00:14:29.000 --> 00:14:36.000
Đối với tập lệnh đường ống của bạn, hãy thêm đường dẫn thư viện Metal cũng như tên hàm phân đoạn và đỉnh của nó.

00:14:36.000 --> 00:14:39.000
Bạn cũng chỉ định bất kỳ cấu hình trạng thái đường ống nào khác.

00:14:39.000 --> 00:14:43.000
Thế là xong, bây giờ bạn có một kịch bản Metal mà bạn có thể sử dụng.

00:14:43.000 --> 00:14:48.000
Bạn có thể tìm thêm thông tin về lược đồ JSON trong tài liệu dành cho nhà phát triển của Metal.

00:14:48.000 --> 00:14:53.000
Quy trình biên dịch đổ bóng trước thời hạn của bạn có thể không được hướng đến việc tạo các tệp tập lệnh đường ống.

00:14:53.000 --> 00:14:58.000
Đối với những trường hợp này, có một cách khác để sản xuất chúng.

00:14:58.000 --> 00:15:02.000
Bạn có thể ghi lại kho lưu trữ nhị phân Metal trong khi chạy trò chơi của mình trên thiết bị.

00:15:02.000 --> 00:15:06.000
Những kho lưu trữ này bao gồm các tập lệnh đường ống tương ứng.

00:15:06.000 --> 00:15:13.000
Nếu bạn thu thập các kho lưu trữ này từ thiết bị, bạn có thể sử dụng "nguồn kim loại" để trích xuất các tập lệnh đường ống nhúng của chúng.

00:15:13.000 --> 00:15:17.000
Sau đó, bạn cập nhật đường dẫn đến thư viện Metal của mình trong các tập lệnh được trích xuất.

00:15:17.000 --> 00:15:26.000
Để biết thêm thông tin, vui lòng tham khảo các cuộc nói chuyện của chúng tôi về cách bạn có thể "Xây dựng các tệp nhị phân GPU" cũng như "Khám phá quy trình biên dịch".

00:15:26.000 --> 00:15:36.000
Bởi vì các tệp nhị phân GPU được điều chỉnh cho từng GPU, "metal-tt" tạo ra các phiên bản khác nhau của các tệp nhị phân để bạn phân phối cho người chơi của mình, dựa trên thiết bị của họ.

00:15:36.000 --> 00:15:44.000
Metal-tt giúp bạn quản lý sự phức tạp này bằng cách đóng gói tất cả các tệp nhị phân GPU khác nhau một cách gọn gàng vào kho lưu trữ nhị phân Metal.

00:15:44.000 --> 00:15:52.000
Bằng cách này, khi ứng dụng của bạn tải kho lưu trữ nhị phân đó, Metal sẽ tự động chọn tệp nhị phân thích hợp cho người chơi của bạn.

00:15:52.000 --> 00:15:58.000
Bạn cũng có thể gói gọn nhiều bộ nhị phân vào một kho lưu trữ nhị phân duy nhất.

00:15:58.000 --> 00:16:04.000
Bây giờ bạn có thể tạo kho lưu trữ nhị phân trước thời hạn, đây là một số phương pháp hay nhất.

00:16:04.000 --> 00:16:12.000
Khi người chơi của bạn chạy một ứng dụng Metal với GPU Binaries được biên dịch trước, Metal sẽ tìm kiếm kho lưu trữ nhị phân đóng gói cho tệp nhị phân GPU cần thiết.

00:16:12.000 --> 00:16:18.000
Nếu Metal không tìm thấy kết quả phù hợp trong kho lưu trữ, nó sẽ tự động quay trở lại biên dịch trên thiết bị.

00:16:18.000 --> 00:16:22.000
Ứng dụng của bạn vẫn sẽ trông chính xác, nhưng điều này có thể trì hoãn việc gửi GPU của bạn.

00:16:22.000 --> 00:16:30.000
Bạn có thể kiểm tra xem kho lưu trữ nhị phân của mình có chứa các đường ống mà bạn mong đợi hay không, sử dụng tùy chọn "FailOnBinaryArchiveMiss".

00:16:30.000 --> 00:16:36.000
Bạn có thể dễ dàng chỉ định tùy chọn FailOnBinaryArchiveMiss khi tạo đối tượng trạng thái đường ống kim loại.

00:16:36.000 --> 00:16:45.000
Trong trường hợp bỏ lỡ kho lưu trữ nhị phân, khi bạn đã đặt tùy chọn này, Metal sẽ bỏ qua quá trình biên dịch trên thiết bị và trả về trạng thái đường ống nil.

00:16:45.000 --> 00:16:51.000
Khi kho lưu trữ nhị phân của bạn đã sẵn sàng với sự hỗ trợ cho tất cả các thiết bị mục tiêu, bạn đã sẵn sàng để triển khai.

00:16:51.000 --> 00:16:54.000
Không phải tất cả người chơi của bạn đều có thể sử dụng hệ điều hành mới nhất.

00:16:54.000 --> 00:17:03.000
Để đảm bảo tất cả người dùng được hưởng lợi từ kho lưu trữ nhị phân, hãy tạo một kho lưu trữ cho mỗi phiên bản hệ điều hành chính và lưu trữ nó vào ứng dụng của bạn.

00:17:03.000 --> 00:17:13.000
Để thực hiện điều này, hãy kiểm tra phiên bản hệ điều hành của thiết bị người chơi của bạn và chọn kho lưu trữ nhị phân thích hợp để liên kết với Bộ mô tả đường ống của bạn.

00:17:13.000 --> 00:17:22.000
Khi người chơi của bạn cập nhật hệ điều hành của họ, kho lưu trữ nhị phân của họ có thể yêu cầu biên dịch lại để tương thích chuyển tiếp, nhưng Metal đã bảo vệ bạn.

00:17:22.000 --> 00:17:33.000
Metal xác định các kho lưu trữ nhị phân chưa được đóng gói trong gói ứng dụng trên thiết bị của người chơi của bạn và tự động nâng cấp chúng trong nền sau khi cập nhật hệ điều hành hoặc cài đặt trò chơi.

00:17:33.000 --> 00:17:42.000
Tóm lại, trình biên dịch "kim loại" và "bộ chuyển đổi kim loại" là những công cụ bạn nên sử dụng, để tạo ra các thư viện Metal trước thời hạn mà sau đó bạn có thể vận chuyển cùng với trò chơi của mình.

00:17:42.000 --> 00:17:50.000
Sử dụng "trình biên dịch kim loại" khi biên dịch nguồn MSL và "bộ chuyển đổi máy tạo bóng kim loại" khi bộ đổ bóng của bạn ở HLSL.

00:17:50.000 --> 00:17:58.000
Metal-tt cho phép bạn hoàn thiện các thư viện Metal thành các tệp nhị phân GPU, phù hợp với các GPU khác nhau trong hệ sinh thái Metal.

00:17:58.000 --> 00:18:05.000
Cuối cùng, metal-source giúp bạn thu thập các tập lệnh đường ống từ các trò chơi MacOS hiện có của mình.

00:18:05.000 --> 00:18:18.000
Phần lớn các công cụ này, cũng như phần còn lại của chuỗi công cụ trình biên dịch nhị phân GPU, hiện hỗ trợ Windows, ngoài macOS, giúp việc tích hợp chúng vào quy trình làm việc hiện tại của bạn dễ dàng hơn bao giờ hết.

00:18:18.000 --> 00:18:26.000
Để kết thúc: Metal Shader Converter là một công cụ mới giúp bạn đưa các shader của mình được phát triển bằng một ngôn ngữ đổ bóng khác sang Metal.

00:18:26.000 --> 00:18:35.000
Trình biên dịch nhị phân GPU và chuỗi công cụ của nó, hiện đã có trên Windows, có thể hoàn thiện các thư viện Metal của bạn thành các tệp nhị phân GPU.

00:18:35.000 --> 00:18:40.000
Với những công cụ này, giờ đây bạn đã có mọi thứ bạn cần để đưa bộ đổ bóng của mình đến Metal.

00:18:40.000 --> 00:18:42.000
Vẫn còn nhiều điều để chia sẻ với bạn.

00:18:42.000 --> 00:18:47.000
Phần 3 của loạt bài tập trung vào việc tối ưu hóa ứng dụng Metal cao cấp.

00:18:47.000 --> 00:18:48.000
Hãy chắc chắn kiểm tra nó.

00:18:48.000 --> 00:18:50.000
Cảm ơn vì đã xem.

00:18:50.000 --> 23:59:59.000
♪ ♪

