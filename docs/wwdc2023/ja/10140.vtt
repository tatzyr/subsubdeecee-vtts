WEBVTT

00:00:00.000 --> 00:00:10.000
♪ ♪

00:00:10.000 --> 00:00:16.000
リッキー：こんにちは、私はリッキーです。「StoreKit 2の新機能、XcodeでのStoreKitテスト」へようこそ。

00:00:16.000 --> 00:00:24.000
このセッションでは、今年StoreKitに導入する新機能と、Xcodeでのテスト体験の強化について説明します。

00:00:24.000 --> 00:00:32.000
StoreKit 2は、Swiftを使用した新しい、より柔軟なAPIを使用して、2021年にWWDCで初めて導入されました。

00:00:32.000 --> 00:00:37.000
今年は、StoreKit 2をさらに良くする新機能をご紹介できることを嬉しく思います。

00:00:37.000 --> 00:00:50.000
まず、新しいStoreKitフレームワーク機能を確認し、次にStoreKitを使用してSwiftUIアプリを構築するためのいくつかのアップデートを共有し、最後に、XcodeでのStoreKitテストの新機能について説明します。

00:00:50.000 --> 00:00:58.000
iOS 16.4から利用可能な、プロモーションされたアプリ内購入を管理するための新しいSwift APIを導入することに興奮しています。

00:00:58.000 --> 00:01:06.000
プロモートされたアプリ内課金は、App Storeの製品ページで製品を商品化できる機能で、それぞれに専用のプロモーション画像が付いています。

00:01:06.000 --> 00:01:14.000
アプリ内購入を宣伝することは、製品の可視性を高めるための素晴らしい方法であり、App Store Connectでプロモーションされた購入を簡単に設定できます。

00:01:14.000 --> 00:01:20.000
プロモーションされたアプリ内課金の設定の詳細については、「App Store Connectの新機能」をご覧ください。

00:01:20.000 --> 00:01:29.000
プロモーションされたアプリ内購入はApp Storeに掲載されているため、顧客がプロモーションされた製品を購入すると、購入ボタンをタップすることでインタラクションがここで始まります。

00:01:29.000 --> 00:01:37.000
その後、App Storeは購入データをアプリに送信し、そこでこの情報をリッスンし、購入を完了するように促すことができます。

00:01:37.000 --> 00:01:47.000
プロモーションされた購入を聞くには、顧客がApp Storeでプロモーションされた製品の購入を開始するたびに新しい購入意図を受け取るSwift非同期シーケンスを使用します。

00:01:47.000 --> 00:01:54.000
まず、PurchaseIntent.intentsを使用して購入インテントを受信するリスナーを作成します。

00:01:54.000 --> 00:02:01.000
シーケンスが新しいオブジェクトを受信するたびに、購入に関連付けられたStoreKit製品が含まれています。

00:02:01.000 --> 00:02:10.000
使い慣れた支払いシートを表示し、そこでインタラクションを完了できるように、purchase()を呼び出すことで、通常どおりこれらの製品を購入するように顧客に促すことができます。

00:02:10.000 --> 00:02:16.000
アプリが購入を完了する準備ができていない場合は、インテントをローカルに保存して延期することもできます。

00:02:16.000 --> 00:02:20.000
後でいつでも処理できます。

00:02:20.000 --> 00:02:27.000
アプリ内購入を促進するもう1つの機能は、製品が現在のデバイスにローカルに表示される方法をカスタマイズできることです。

00:02:27.000 --> 00:02:35.000
たとえば、顧客がこれらの製品の1つを購入した場合、それを非表示にすることができるので、App Storeは閲覧や検索時に再び表示されません。

00:02:35.000 --> 00:02:45.000
また、ゲームのレベルアップなど、アプリの現在の状態に基づいて、製品の注文、または注目されている製品のサブセットを変更することもできます。

00:02:45.000 --> 00:02:54.000
これらすべてのケースをカバーするために、プロモーションされたアプリ内購入の順序と可視性をカスタマイズするために使用できる新しいSwift APIをいくつか紹介できることを嬉しく思います。

00:02:54.000 --> 00:02:56.000
簡単なデモンストレーションを見てみましょう。

00:02:56.000 --> 00:03:04.000
StoreKitをインポートした後、Product.PromotionInfo.currentOrderで現在のプロモーション注文を確認できます。

00:03:04.000 --> 00:03:09.000
これは、現在設定されている順序で、PromotionInfoオブジェクトのシーケンスを返します。

00:03:09.000 --> 00:03:18.000
このリストが空の場合、このデバイスにはローカルオーバーライドが設定されていないことを意味し、App Storeに表示される製品は、App Store Connectで設定したのと同じ順序です。

00:03:18.000 --> 00:03:24.000
このシーケンスの各オブジェクトには、アプリで宣伝された製品に関する情報が含まれています。

00:03:24.000 --> 00:03:36.000
プロモーションのカスタムオーダーを設定するには、Product.PromotionInfo.updateProductOrder APIを使用して、このデバイスのApp Storeに表示する順序で製品識別子のリストを渡すことができます。

00:03:36.000 --> 00:03:40.000
まったく新しい注文を設定することなく、製品を非表示にして表示することもできます。

00:03:40.000 --> 00:03:45.000
これは、プロモーションされたアプリ内購入に関連する可視性プロパティを変更することで実行できます。

00:03:45.000 --> 00:03:58.000
可視性状態は、表示、非表示、またはデフォルトであり、App Store Connectで設定した設定に従い、アプリによってローカルオーバーライドが設定されていない場合のすべてのデバイスに適用されます。

00:03:58.000 --> 00:04:01.000
コードでこれを変更する方法を見てみましょう。

00:04:01.000 --> 00:04:05.000
可視性値は、いくつかの異なる方法で変更できます。

00:04:05.000 --> 00:04:17.000
アプリはProduct.PromotionInfo. updateProductVisibility APIを呼び出すことができ、新しい可視性状態とそのアプリ内購入の識別子の両方を渡すことで、単一の製品の値を変更できます。

00:04:17.000 --> 00:04:24.000
または、各PromotionInfoオブジェクトにメンバープロパティを設定することで、可視性値を変更することもできます。

00:04:24.000 --> 00:04:29.000
次に、変更を保存するには、変更したのと同じオブジェクトに対してupdate()を呼び出します。

00:04:29.000 --> 00:04:35.000
そして、それはあなたがStoreKit 2でプロモーションされたアプリ内購入を使い始めるために必要なすべてです。

00:04:35.000 --> 00:04:42.000
さて、StoreKit 2のコアデータモデルに対するいくつかの機能強化を紹介したいと思います。

00:04:42.000 --> 00:04:51.000
これらのモデルは、購入日やサブスクリプションステータスなど、アプリ内購入や関連情報を管理するのに役立ちます。

00:04:51.000 --> 00:05:00.000
多くの人が要求した大きな改善をもたらすTransactionとRenewalInfoデータモデルに追加する新しい分野に飛び込みましょう。

00:05:00.000 --> 00:05:07.000
最初の新しいフィールドはストアフロントで、storefrontCountryCodeとともにトランザクションモデルに表示されます。

00:05:07.000 --> 00:05:09.000
次の新しいフィールドは理由と呼ばれます。

00:05:09.000 --> 00:05:16.000
顧客が購入を開始したかどうか、または取引が自動サブスクリプション更新であるかどうかを示します。

00:05:16.000 --> 00:05:22.000
Product.SubscriptionInfoの下のRenewalInfoモデルには、nextRenewalDateという新しいメンバーがあります。

00:05:22.000 --> 00:05:26.000
これは、このサブスクリプションの更新がいつ処理されるかを示します。

00:05:26.000 --> 00:05:39.000
これらの新しいフィールドはすべて、Xcode 15で構築したアプリで利用でき、iOS 17で最初にリリースされましたが、それらのほとんどは、StoreKit 2を使用しているときにも以前のバージョンのiOSでさかのぼって動作します。

00:05:39.000 --> 00:05:44.000
次に、StoreKitメッセージと、先ほど追加した素晴らしい新機能について話したいと思います。

00:05:44.000 --> 00:05:52.000
昨年、App Storeが顧客に重要な情報を通知する方法として、WWDC 2022でメッセージAPIを導入しました。

00:05:52.000 --> 00:05:56.000
メッセージには、メッセージの目的を伝える理由の値があります。

00:05:56.000 --> 00:06:00.000
アプリは、メッセージを延期するか抑制するかを選択できます。

00:06:00.000 --> 00:06:06.000
たとえば、メッセージを表示すると、インタラクションフロー中に顧客を中断する場合は、メッセージを延期することができます。

00:06:06.000 --> 00:06:12.000
それ以外の場合、StoreKitはアプリの起動時にアクティブなメッセージを自動的に表示します。

00:06:12.000 --> 00:06:15.000
今年は、請求発行と呼ばれる新しいメッセージの理由を追加しました。

00:06:15.000 --> 00:06:19.000
このメッセージはiOS 16.4から利用可能です。

00:06:19.000 --> 00:06:24.000
請求の問題でサブスクリプションの更新に失敗した場合、App Storeはこのメッセージを送信します。

00:06:24.000 --> 00:06:30.000
StoreKitは請求問題シートを表示し、顧客はアプリを離れることなく問題を解決できます。

00:06:30.000 --> 00:06:33.000
この新しいプロパティは、テストする時間を与えるためにサンドボックスですでに有効になっています。

00:06:33.000 --> 00:06:40.000
これがすべての顧客にいつ有効になるかの最新情報については、今年後半にApple Developerのウェブサイトで確認してください。

00:06:40.000 --> 00:06:46.000
App Storeがサブスクリプションの更新に失敗した場合、サブスクリプションは請求再試行状態になります。

00:06:46.000 --> 00:06:53.000
サンドボックスでこの機能をテストする方法については、アプリ内購入のテストに関するWWDCセッションを参照してください。

00:06:53.000 --> 00:06:56.000
それでは、セキュリティ関連のアップデートを確認しましょう。

00:06:56.000 --> 00:07:07.000
StoreKitを最新のセキュリティ慣行で最新の状態に保つために、領収書署名証明書をSHA-1の使用から「元のStoreKit」領収書のSHA-256に移行しています。

00:07:07.000 --> 00:07:20.000
OpenSSLのような最新のバージョンの暗号化ライブラリは、すでにSHA-256をサポートしていますが、アプリがデバイス上のレシート検証を実行する場合は、新しい証明書を適切に処理することを確認することが重要です。

00:07:20.000 --> 00:07:33.000
新しいSHA-256署名証明書は、6月20日からサンドボックスで領収書に署名するために使用され、iOS 16.6およびmacOS 13.5以降を実行しているデバイスでテストできるようになります。

00:07:33.000 --> 00:07:40.000
8月14日以降、新しい証明書は、App Storeに提出されたすべての新しいアプリとアプリのアップデートの領収書に署名するために使用されます。

00:07:40.000 --> 00:07:45.000
このタイムラインの詳細については、Apple DeveloperのWebサイトを確認できます。

00:07:45.000 --> 00:07:48.000
アプリがStoreKit 2を使用している場合は、何もする必要はありません。

00:07:48.000 --> 00:07:54.000
StoreKit 2の署名済みトランザクション、更新情報、およびアプリトランザクションは、今日すでにSHA-256を使用しています。

00:07:54.000 --> 00:08:03.000
また、App StoreサーバーAPIを使用してレシートの検証を行う場合、新しいフォーマットを自動的に処理するため、変更を加える必要はありません。

00:08:03.000 --> 00:08:12.000
次に、SwiftUIを使用して、アプリでアプリ内購入を非常に簡単かつ迅速に商品化できるStoreKitのまったく新しい機能セットをお見せできることを嬉しく思います。

00:08:12.000 --> 00:08:20.000
単一のアプリ内購入、製品ストア全体、さらにはサブスクリプションに固有のカスタムビュー用のSwiftUIビューを作成するための新しいAPIがあります。

00:08:20.000 --> 00:08:28.000
これらの機能は、通常のSwiftUIビューと同様に、実装に最小限のコードを必要とするため、アプリをできるだけ早く起動して実行できます。

00:08:28.000 --> 00:08:31.000
これらの新しい見解を見てみましょう。 

00:08:31.000 --> 00:08:40.000
この製品ビューでは、ローカライズされたタイトル、説明、さらにはオプションのプロモーション画像を含む、単一のアプリ内購入を表示できます。

00:08:40.000 --> 00:08:44.000
製品識別子をProductViewに渡すことで作成できます。

00:08:44.000 --> 00:08:46.000
また、StoreKit製品をロードする必要もありません。

00:08:46.000 --> 00:08:48.000
productID文字列を使用するだけです。

00:08:48.000 --> 00:08:51.000
残りはStoreKitとSwiftUIが処理します。

00:08:51.000 --> 00:08:56.000
また、アプリ内のストアなど、製品のコレクション全体を表示する新しいビューもあります。

00:08:56.000 --> 00:09:09.000
単一の製品識別子を渡す代わりに、StoreViewと組み合わせてproductIDのコレクションを使用して、商品化する製品のリストを作成し、SwiftUIコンポーネントを使用してさらにカスタマイズできます。

00:09:09.000 --> 00:09:18.000
StoreViewは、ここに示されているように、設定に数行のコードしか必要としないため、アプリやゲームを開始し、アプリ内購入をサポートするのに最適な方法です。

00:09:18.000 --> 00:09:25.000
最後になりましたが、利用可能なすべてのレベルのサービスでサブスクリプションを商品化する新しい見解もあります。

00:09:25.000 --> 00:09:31.000
SubscriptionStoreViewを使用して、このようなサブスクリプショングループのカスタムページをすばやく作成します。

00:09:31.000 --> 00:09:40.000
必要なのは、通常App Store Connectで見つけることができるsubscriptionGroupIDだけですが、XcodeのStoreKit構成でも利用できるようになりました。

00:09:40.000 --> 00:09:45.000
これらの新しいビュータイプのいずれかに簡単に追加できる多くの可能なカスタマイズがあります。

00:09:45.000 --> 00:09:53.000
たとえば、数行のコードを変更してカスタム背景を作成すると、このSubscriptionStoreViewの外観が大幅に変更される方法を確認してください。

00:09:53.000 --> 00:10:04.000
これらの新しいサブスクリプションの変更に合わせて、人々がStoreKitアプリでサブスクリプションを操作して選択する方法に新しいエクスペリエンスを提供するために、追加の管理サブスクリプションシートを追加します。

00:10:04.000 --> 00:10:06.000
それを見てみましょう。 てみましょう。

00:10:06.000 --> 00:10:19.000
ここでは、サブスクリプションを管理するための使い慣れたフローを見ることができます。これは、顧客に現在のアクティブな層を持つシートを表示し、そのサブスクリプショングループで利用可能な他の層のリストを見るためにそれぞれをタップするオプションを提供します。

00:10:19.000 --> 00:10:28.000
このプロセスを高速化し、より多くのカスタマイズを提供するために、ステップをスキップして表示したいサブスクリプショングループにジャンプできる別のビューがあります。

00:10:28.000 --> 00:10:38.000
たとえば、複数のサブスクリプショングループがある場合は、アプリのコンテキストで関連するサブスクリプショングループを選択し、顧客が選択できる他のサービスレベルを表示できます。

00:10:38.000 --> 00:10:43.000
このシートは、通常のAPIと同じAPIで使用できます。.manageSubscriptionsSheet。

00:10:43.000 --> 00:10:48.000
今回は、さらにsubscriptionGroupIDパラメータを渡します。

00:10:48.000 --> 00:10:58.000
StoreKitでSwiftUIアプリを作成するというトピックについては、他にも多くのビューとカスタマイズがあり、アプリの美学に合うように適用できます。

00:10:58.000 --> 00:11:03.000
もっと知りたい場合は、グレッグが「Meet StoreKit for SwiftUI」で教えてくれます。

00:11:03.000 --> 00:11:12.000
StoreKitのアプリ内課金の新機能を見た後、Xcode 15から始めて、XcodeのStoreKit Testingの新しいツールを使用してそれらをテストする方法を見てみましょう。

00:11:12.000 --> 00:11:22.000
XcodeでのStoreKitテストを使用すると、App Store Connectで何かを設定する前であっても、StoreKitを使用したアプリが構築を開始した時から素晴らしい体験を提供できます。

00:11:22.000 --> 00:11:33.000
これにより、Macでのテスト中にStoreKitに関連するアクションをテスト、管理、編集、さらには作成することができ、シミュレータとデバイスの両方でサポートされています。

00:11:33.000 --> 00:11:39.000
トランザクションマネージャーから始めて、アプリのデバッグとテストのための新機能があります。

00:11:39.000 --> 00:11:42.000
これで、すべてのテストアプリが整理されます。

00:11:42.000 --> 00:11:51.000
ナビゲーターでは、テスト用のStoreKit構成を使用して、現在のStoreKitアプリがインストールされている、現在接続されているすべてのデバイスとシミュレータを見ることができます。

00:11:51.000 --> 00:12:00.000
これにより、複数のデバイスで同時により簡単かつ迅速にテストすることができ、購入履歴を見るためにアプリを実行する必要はありません。

00:12:00.000 --> 00:12:02.000
飛び込んで、それがどのように見えるか見てみましょう。

00:12:02.000 --> 00:12:06.000
私はiPhoneをMacに接続し、シミュレーターを実行しています。

00:12:06.000 --> 00:12:10.000
そして、私は新しい開発中のゲーム、Backyard Birdsを使っています。

00:12:10.000 --> 00:12:25.000
Xcodeを開くと、プロジェクトが開いているかどうかにかかわらず、Debug、StoreKit、Manage Transactionsに移動し、すでに慣れ親しんでいるトランザクションマネージャービューが表示されます。

00:12:25.000 --> 00:12:29.000
ナビゲーターでは、Macに接続されている現在のすべてのデバイスを見ることができます。

00:12:29.000 --> 00:12:33.000
私の場合、これは物理的なiPhoneとシミュレーターです。

00:12:33.000 --> 00:12:38.000
両方とも、Backyard Birdsを含むいくつかのアプリがこのリストに表示されていることに注目してください。

00:12:38.000 --> 00:12:43.000
これらはすべて、デバッグセッションの外で検査できるXcodeでStoreKitテストを使用するアプリです。

00:12:43.000 --> 00:12:55.000
これらのデバイスのいずれかでアプリをクリックすると、そのアプリのStoreKitトランザクションのリストが表示され、昨年お見せした詳細サイドバーで、それぞれを個別に検査できます。

00:12:55.000 --> 00:13:01.000
これは、たとえば、Backyard BirdsのXcodeプロジェクトを開き、シミュレータで実行した場合にも機能します。

00:13:01.000 --> 00:13:08.000
この場合、アプリ名の横にこの小さなインジケーターがあるため、どのアプリが積極的にデバッグされているかを確認することもできます。

00:13:08.000 --> 00:13:12.000
これは、トランザクションマネージャーの新機能ではありません。

00:13:12.000 --> 00:13:19.000
Xcodeを使用してMacから直接アプリのアプリ内購入を行うことができるようになったことをお見せできることを嬉しく思います。

00:13:19.000 --> 00:13:30.000
さらに、新しい購入を作成するときに、消耗品の数量など、さまざまな購入パラメータをカスタマイズしたり、サブスクリプションのオファーコードを選択したりすることもできます。

00:13:30.000 --> 00:13:33.000
Backyard Birdsを使用して、これが実際にどのように機能するかを見てみましょう。

00:13:33.000 --> 00:13:36.000
まず、テストしたいアプリを選択する必要があります。

00:13:36.000 --> 00:13:41.000
次に、フィルターバーの左側にあるプラスボタンをクリックして、新しい購入を作成します。

00:13:41.000 --> 00:13:46.000
表示されるポップアップには、このアプリで利用可能なすべてのアプリ内購入が一覧表示されます。

00:13:46.000 --> 00:13:50.000
これらは、StoreKit構成で設定したのと同じ製品です。

00:13:50.000 --> 00:13:58.000
最初に消耗品を購入するので、栄養ペレットを選択して[次へ]をクリックします。

00:13:58.000 --> 00:14:05.000
今、私はこの新しい購入を設定する機会がありますが、先にスキップしたい場合は、デフォルトのオプションも有効です。

00:14:05.000 --> 00:14:13.000
私はこれらの設定に満足しているので、[完了]をクリックして、これらのパラメータを使用して購入を完了しましょう。

00:14:13.000 --> 00:14:18.000
アプリはシミュレータで実行されていませんが、StoreKitは新しい購入を受け取り、処理しました。

00:14:18.000 --> 00:14:22.000
取引リストを見ると、上部に新しいアイテムがあります。

00:14:22.000 --> 00:14:27.000
それをクリックすると、この新しいトランザクションの詳細を調べることができます。

00:14:27.000 --> 00:14:31.000
ただし、サブスクリプションは異なるので、別の購入をしましょう。

00:14:31.000 --> 00:14:45.000
もう一度プラスボタンをクリックして新しい購入を作成し、今回はこのアプリでサブスクリプションの名前を検索し、探しているものを選択し、次へをクリックします。

00:14:45.000 --> 00:14:50.000
これは別のタイプのアプリ内購入であるため、購入を設定するオプションが変更されました。

00:14:50.000 --> 00:14:57.000
購入日のように同じものもありますが、新しいものもあるので、彼らが何をしているのかを調べてみましょう。

00:14:57.000 --> 00:15:01.000
ちなみに、デフォルトのプロパティはここでも有効です。

00:15:01.000 --> 00:15:07.000
StoreKitの設定で設定されている場合は、このサブスクリプションのオファーコードを選択するオプションがあります。

00:15:07.000 --> 00:15:15.000
お客様はオファーコードとプロモーションを入力する必要がありますが、テストを容易にするために、この製品IDで利用可能なオファーのリストを提供します。

00:15:15.000 --> 00:15:25.000
この場合、購入日を変更し、昨年のWWDCで最初にこのサービスに加入したかのように、ちょうど1年前に設定したいと思います。

00:15:25.000 --> 00:15:35.000
次に、このサブスクリプションを自動的に更新するか、この製品の場合は1か月のサブスクリプション期間のみ購読するかを選択できます。

00:15:35.000 --> 00:15:43.000
使用を開始する前に、アプリがアクティブなサブスクリプションをどのように処理するかをテストできるように、自動更新を有効にしておきたいです。

00:15:43.000 --> 00:15:53.000
[完了]をクリックして購入を完了し、トランザクションリストをフィルタリングして結果を見てみましょう。

00:15:53.000 --> 00:15:57.000
予想通り、昨年から毎月1回の更新があります。

00:15:57.000 --> 00:16:13.000
これらはすべて現在未完成としてマークされています。アプリが実行されておらず、それらを受け取る機会がなかったので、シミュレーターで実行して、Backyard Birds Passにアクセスできるかどうかを確認します。

00:16:13.000 --> 00:16:23.000
トランザクションマネージャーの新機能は、iOS 17とmacOS 14から始めて、XcodeでStoreKitテストをすでにサポートしているすべてのデバイスとプラットフォームで動作します。

00:16:23.000 --> 00:16:30.000
また、iPadOS、watchOS、tvOSなどの他のプラットフォームでもサポートされています。

00:16:30.000 --> 00:16:41.000
古いバージョンのオペレーティングシステムを実行している場合、何も変わりません。トランザクションマネージャーは、アクティブなデバッグセッションを使用する場合、以前と同じ機能すべてと互換性があります。

00:16:41.000 --> 00:16:51.000
次に、StoreKit設定の新機能を紹介し、StoreKitアプリがさまざまなシナリオでどのように動作するかをより詳細にテストできるようにしたいと思います。

00:16:51.000 --> 00:16:59.000
これを実証するために、Backyard BirdsのXcodeプロジェクトを開き、StoreKit設定に移動します。

00:16:59.000 --> 00:17:05.000
構成設定と呼ばれる、設定されたアプリ内購入の上に新しい項目があります。

00:17:05.000 --> 00:17:16.000
これは、アプリのテスト環境に構成可能なオプションを提供するために追加した新しいメニューで、すでに慣れ親しんでいるかもしれないものや、Xcode 15から始まる新しいオプションもあります。

00:17:16.000 --> 00:17:31.000
この1番目と2番目のセクションでは、デフォルトのストアフロントや、アプリが価格設定と可用性に使用するロケール、サブスクリプションの更新の速度や購入を強制する機能など、既存のすべてのオプションをカバーしています。

00:17:31.000 --> 00:17:41.000
以前のバージョンのXcodeでは、StoreKit設定を開いたときにエディタメニューでこれらを見つけることができ、それらはまだそこにあり、交換可能に使用できます。

00:17:41.000 --> 00:17:48.000
StoreKitのテストオプションについて話していますが、iOS 16.4で今年追加した新しいサブスクリプション更新率があります。

00:17:48.000 --> 00:17:58.000
これらは、更新ごとにサブスクリプションの有効期限を変更するように設計されており、サブスクリプションの実際の期間よりも早く一貫した更新を生成するのに役立ちます。

00:17:58.000 --> 00:18:04.000
これは、サブスクリプションの長期的な状態を迅速かつ確実にテストするのに本当に役立ちます。

00:18:04.000 --> 00:18:12.000
これらの新しい設定可能なレートは、エディタメニューとXcode 15のStoreKit構成設定の両方で見つけることができます。

00:18:12.000 --> 00:18:22.000
StoreKit構成設定の3番目のセクションでは、アプリのStoreKitエラーをシミュレートするために使用できるオプションについて説明します。これは、多くの人にとって非常に要求された機能でした。

00:18:22.000 --> 00:18:31.000
以前はエディターメニューに使われていたFail Transactionsサブメニューを拡張し、より多くのStoreKit APIとエラータイプのサポートを提供します。

00:18:31.000 --> 00:18:40.000
各オプションは、アプリが使用している可能性のあるStoreKit 2 APIを表し、APIがアプリによって呼び出されるたびにスローするエラーを選択できます。

00:18:40.000 --> 00:18:43.000
この機能では、多数のAPIがサポートされています。

00:18:43.000 --> 00:18:51.000
製品の読み込みの問題、購入の失敗、領収書と取引の確認の問題、払い戻しのリクエストなどをテストできます。

00:18:51.000 --> 00:18:54.000
これが実際にどのように見えるか見てみましょう。

00:18:54.000 --> 00:19:00.000
左側にBackyard BirdsのXcodeプロジェクトが開き、右側のシミュレータで実行されているアプリがあります。

00:19:00.000 --> 00:19:12.000
StoreKitの設定では、Purchase API名の横にあるチェックボックスを使用して購入エラーを有効にし、スローするエラーを選択できます。

00:19:12.000 --> 00:19:21.000
顧客が店舗を変更したときにアプリが購入をどのように処理するかをテストしたいので、利用できない製品を選択します。

00:19:21.000 --> 00:19:30.000
このファイルは編集時に自動的に保存され、アプリが実行されているときにデバイスにも同期されるため、アプリを再実行することなく、すぐに変更をテストできます。

00:19:30.000 --> 00:19:37.000
製品を購入して、何が起こるか見てみましょう。

00:19:37.000 --> 00:19:42.000
予想通り、それは失敗します。

00:19:42.000 --> 00:19:48.000
この製品を購入できないため、開発者に連絡して詳細を確認する必要があります。

00:19:48.000 --> 00:19:59.000
購入エラーを無効にして、今回は正常に完了するようにもう一度試してみましょう。

00:19:59.000 --> 00:20:11.000
これらの手順で、このアプリのコードが購入時にこの種のエラーを処理できるかどうかを効果的にテストしました。

00:20:11.000 --> 00:20:20.000
この方法は、StoreKit構成設定のAPIとエラーオプションのいずれかに適用して、複数のシナリオをカバーし、アプリが堅牢であることを確認することができます。

00:20:20.000 --> 00:20:23.000
これらのエラーはすべてStoreKitの一部であり、すでに遭遇している可能性があります。

00:20:23.000 --> 00:20:28.000
それらのそれぞれは、あなたのアプリの失敗の明確なケースを表しています。

00:20:28.000 --> 00:20:32.000
そして、それがXcodeでのStoreKitテストのすべての新機能です。

00:20:32.000 --> 00:20:51.000
今日は、デバッグセッション以外の複数のデバイスでトランザクションを検査および管理する方法、トランザクションマネージャーから製品を購入して、アプリが既存の購入をどのように処理するかをテストする方法、および多くの障害シナリオをカバーするためにStoreKitエラーをシミュレートする方法を示しました。

00:20:51.000 --> 00:21:02.000
Xcodeのこれらの新機能はすべて、StoreKit Testフレームワークを使用してアプリの単体テストを書くためにコードでも利用できるため、すべての同じタスクを実行する自動化を書くことができます。

00:21:02.000 --> 00:21:09.000
XCTestセッションでオフデバイス購入を作成し、シミュレートされたエラーを設定するための新しいAPIを見てみましょう。

00:21:09.000 --> 00:21:19.000
新しいアプリ内課金を作成するには、StoreKitTestに新しいSwift APIがあり、StoreKit purchase(_:) APIと同じように機能し、同じ購入オプションもあります。

00:21:19.000 --> 00:21:26.000
購入日の変更など、新しい購入機能をサポートするために、テスト専用の新しい購入オプションも追加しました。

00:21:26.000 --> 00:21:28.000
例を見てみましょう。 例を見てみましょう。

00:21:28.000 --> 00:21:38.000
SKTestSessionを設定した後、サブスクリプションのオフデバイス購入を行い、今日から1年前の購入日を上書きします。

00:21:38.000 --> 00:21:47.000
これは私がトランザクションマネージャーで行ったのと同じ購入であり、まったく同じように動作し、反復可能な結果を作成し、アプリのテストを自動化することができます。

00:21:47.000 --> 00:21:58.000
StoreKitTestには、SKTestSessionでStoreKitエラーをシミュレートするための新しいAPIもいくつかあり、StoreKit構成設定でシミュレートされたエラーと同じように機能します。

00:21:58.000 --> 00:22:07.000
テストセッションを作成した後、テストしたいエラータイプとシミュレートする必要があるStoreKit APIでsetSimulatedErrorを呼び出すことができます。

00:22:07.000 --> 00:22:12.000
この例では、loadProducts APIのネットワークエラーをシミュレートすることを選択します。

00:22:12.000 --> 00:22:17.000
このテストでloadProducts APIを呼び出すたびに、常に同じエラーがスローされます。

00:22:17.000 --> 00:22:23.000
シミュレートされた失敗を無効にするには、同じセッターAPIを使用し、エラータイプの代わりにnilを渡します。

00:22:23.000 --> 00:22:27.000
最後に、新しいサブスクリプション更新率のAPIもあります。

00:22:27.000 --> 00:22:33.000
これらは、timeRateと呼ばれるSKTestSessionのメンバーを介して、既存のものと同じ方法でアクセスできます。

00:22:33.000 --> 00:22:43.000
サブスクリプション購入を行うためのこのサンプルテストでは、より高速な更新率を設定し、複数の更新をすばやく生成するためのコードを追加しました。

00:22:43.000 --> 00:22:47.000
今日、Xcode機能での新しいStoreKitとStoreKitテストの多くが取り上げられました。

00:22:47.000 --> 00:23:01.000
StoreKitには、アプリ内購入の促進をサポートする新しいAPIがあり、TransactionとRenewalInfoのデータモデルには、より貴重な情報を提供するためにいくつかの機能強化があり、請求の問題を処理するために聞くことができる新しいメッセージタイプがあります。

00:23:01.000 --> 00:23:11.000
SwiftUIの新しいStoreKitビューは、製品のマーチャンダイジングをサポートするアプリをすばやく構築するための素晴らしいツールであり、すべてのデバイスで動作するように余分なコードを必要としません。

00:23:11.000 --> 00:23:18.000
そして最後に、XcodeでのStoreKitテストで提供される優れたツールを使用して、アプリ内のすべてのStoreKit機能を検証できます。

00:23:18.000 --> 00:23:23.000
StoreKit 2には、素晴らしいアプリを構築し、ビジネスを成長させることができる多くの素晴らしい機能が満載されています。

00:23:23.000 --> 00:23:34.000
Swiftを最大限に活用する多くのツールを追加し、シンプルで強力な新しいAPIを使用すると、顧客のために構築しているエクスペリエンスにもっと集中する機会があります。

00:23:34.000 --> 00:23:40.000
製品やサブスクリプションを商品化したいアプリは、StoreKit 2を使用して構築できるようになりました。

00:23:40.000 --> 00:23:47.000
まだStoreKit 2を使用していない場合は、試してみてください。使用している場合は、今日お見せした新機能についてご意見をお聞かせください。

00:23:47.000 --> 00:23:56.000
既存のアプリで新しいアプリ内購入マーチャンダイジングビューを使用して、エクスペリエンスをさらにカスタマイズするか、これらの新しいAPIのみを使用して新しいエクスペリエンスを作成します。

00:23:56.000 --> 00:24:07.000
また、XcodeでのStoreKitテストを使用すると、コードをテストし、すべてがうまく機能し、期待どおりに、あらゆる条件下で最高の体験を顧客に提供できます。

00:24:07.000 --> 00:24:12.000
他のStoreKit機能の詳細については、以下にリンクされているこれらのセッションをチェックしてください。

00:24:12.000 --> 00:24:16.000
StoreKit 2を使って作成したものを見るのを楽しみにしています。

00:24:16.000 --> 23:59:59.000
ご覧いただきありがとうございます。

