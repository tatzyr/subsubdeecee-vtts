WEBVTT

00:00:00.000 -> 00:00:10.000
♪ ♪

00:00:10.000 -> 00:00:14.000
ケリー：こんにちは、私の名前はケリーで、AirPlayチームのエンジニアです。

00:00:14.000 -> 00:00:15.000
セッションへようこそ。

00:00:15.000 -> 00:00:26.000
今日は、AirPlayの最新バージョンの機能のいくつかをカバーし、アプリで素晴らしいAirPlay体験を確実に提供するためのヒントを提供します。

00:00:26.000 -> 00:00:28.000
これが今日の議題です。これは私たちのアジェンダです。

00:00:28.000 -> 00:00:32.000
AirPlayの概要から始めます。

00:00:32.000 -> 00:00:37.000
次に、AirPlayの強化されたオーディオバッファリングが提供する機能のいくつかを探ります。

00:00:37.000 -> 00:00:43.000
そして最後に、強化されたオーディオバッファリングをアプリに統合する方法について説明します。

00:00:43.000 -> 00:00:52.000
AirPlayは、Appleデバイスから近くのスピーカーや画面にビデオ、写真、音楽などを共有する最も簡単な方法です。

00:00:52.000 -> 00:00:59.000
今日、家庭にAirPlay対応デバイスがたくさんあるため、AirPlayはこれまで以上に人気があります。

00:00:59.000 -> 00:01:11.000
次のいずれかの方法でAirPlayを使用できます。AirPlay Audioを使用すると、1つ以上のHomePodとAirPlay対応スピーカーに完璧に同期してストリーミングすることで、お気に入りの音楽やポッドキャストを共有できます。

00:01:11.000 -> 00:01:24.000
AirPlay Videoを使用すると、お気に入りの映画や番組をAppleデバイスからApple TVまたはAirPlay対応のスマートテレビに高品質でストリーミングでき、最大4K HDRをサポートできます。

00:01:24.000 -> 00:01:35.000
また、ミラーリングを使用すると、写真、個人的なビデオ、ゲーム、ウェブページ、スプレッドシートなど、Appleデバイス上にあるものをApple TVまたはAirPlay対応のスマートテレビと共有できます。

00:01:35.000 -> 00:01:40.000
あなたの友人や家族も、Appleデバイス上にあるものを簡単に共有できます。

00:01:40.000 -> 00:01:44.000
今日のビデオでは、AirPlayのオーディオストリーミングの側面に焦点を当てます。

00:01:44.000 -> 00:01:49.000
AirPlayは、1つまたは複数のデバイスにシームレスなオーディオストリーミング体験を提供します。

00:01:49.000 -> 00:02:03.000
HomePod、Mac、Apple TVなどのAppleデバイスから、数億のスマートテレビを含む世界のトップブランドのオーディオおよびビデオ製品まで、今日AirPlayオーディオをサポートするデバイスの完全なエコシステムがあります。

00:02:03.000 -> 00:02:08.000
AirPlayはとても便利で、個人的には日常的に使うのが大好きです。

00:02:08.000 -> 00:02:13.000
AirPlayが成長し続けるにつれて、開発者や顧客からの期待も成長しています。

00:02:13.000 -> 00:02:23.000
AirPlayを次のレベルに引き上げるために、さらに優れたホームシアターとマルチチャンネル体験を提供するために、新しく改良されたプロトコル、AirPlay強化オーディオバッファリングがあります。

00:02:23.000 -> 00:02:29.000
強化されたオーディオバッファリングは、ホームオーディオ全体を念頭に置いてゼロから構築されています。

00:02:29.000 -> 00:02:31.000
それは堅牢です。

00:02:31.000 -> 00:02:37.000
オーディオは、再生の中断を最小限に抑えるために、リアルタイムの再生速度よりも高速にストリーミングされます。

00:02:37.000 -> 00:02:45.000
反応が良いので、アプリはHomePodのタップやiPhoneをリモコンとして使用するとすぐに反応します。

00:02:45.000 -> 00:02:54.000
Apple TVのドルビーアトモスや今年の新機能、iOS用のロスレス再生のインテリジェントな使用など、マルチチャンネルオーディオフォーマットをサポートしています。

00:02:54.000 -> 00:03:00.000
強化されたオーディオバッファリングは、HLSインタースティシャルが広告をサポートするための最良のサポートを提供します。

00:03:00.000 -> 00:03:07.000
HLSインタースティシャルの詳細については、同僚のAmitのビデオ「Explore AirPlay with Interstitials」をご覧ください。

00:03:07.000 -> 00:03:13.000
ご覧のとおり、私たちは将来のために強化されたオーディオバッファリングで素晴らしい基盤を構築しました。

00:03:13.000 -> 00:03:17.000
これを統合すると、アプリで素晴らしいAirPlay体験が生まれます。

00:03:17.000 -> 00:03:21.000
強化されたオーディオバッファリングからどのように利益を得ることができるか見てみましょう。

00:03:21.000 -> 00:03:27.000
携帯電話からHomePodにオーディオをストリーミングしています。

00:03:27.000 -> 00:03:30.000
私がゴミを出していると想像してみてください、そして私は今私のWi-Fiの範囲外です。

00:03:30.000 -> 00:03:32.000
♪ ♪

00:03:32.000 -> 00:03:35.000
HomePodが再生され続けていることに注目してください。

00:03:35.000 -> 00:03:41.000
ネットワークに再接続しようとすると、私の音楽はビートをスキップせず、私の電話はHomePodにシームレスに再接続します。

00:03:41.000 -> 00:03:43.000
♪ ♪

00:03:43.000 -> 00:03:46.000
携帯電話から再生を再び制御できます。

00:03:46.000 -> 00:03:53.000
これは、AirPlayを使用してHomePodのようなAirPlay対応スピーカーで音楽を再生するときに人々が期待するタイプのパフォーマンスです。

00:03:53.000 -> 00:03:59.000
今、強化されたオーディオバッファリングが提供するすべての素晴らしいもので、それをあなたのアプリに組み込みましょう。

00:03:59.000 -> 00:04:04.000
アプリにAirPlayサポートを追加する方法を確認しましょう。

00:04:04.000 -> 00:04:11.000
アプリの正しいミキシングと中断の動作のために、オーディオセッションを適切に設定しておくことが重要です。

00:04:11.000 -> 00:04:16.000
メディアの再生がアプリの中心である場合は、オーディオセッションのカテゴリを再生に設定します。

00:04:16.000 -> 00:04:22.000
これにより、アプリがバックグラウンドにあるときに、アプリのメディアが再生され続けることが保証されます。

00:04:22.000 -> 00:04:32.000
一般に、モードをデフォルトに設定できますが、ポッドキャストやオーディオブックなどの音声では、モードをs spokenAudioに設定することをお勧めします。

00:04:32.000 -> 00:04:36.000
最後に、オーディオセッションのルーティングポリシーをlongFormAudioに設定します。

00:04:36.000 -> 00:04:43.000
ロングフォームオーディオは、音楽やポッドキャストなどのシステムサウンド以外のものです。

00:04:43.000 -> 00:04:47.000
今年新しく、私たちはAirPlayをこれまで以上にシームレスにしています。

00:04:47.000 -> 00:04:52.000
iPhoneとiPadは、デバイス上のインテリジェンスを使用してAirPlayの設定を学習するようになりました。

00:04:52.000 -> 00:05:04.000
そのため、通常、夕食を作るときに音楽を聴くため、キッチンの近くのHomePodが自動的に表示され、アプリのコンテンツを好きな場所で簡単に再生できます。

00:05:04.000 -> 00:05:08.000
ロングフォームのオーディオコンテンツを提供する場合は、これをサポートする必要があります。

00:05:08.000 -> 00:05:13.000
また、アプリにインテリジェントなAirPlay提案のサポートを追加するのは簡単です。

00:05:13.000 -> 00:05:26.000
すでに説明したAVAudioSessionの設定に加えて、唯一の新しいステップは、アプリのInfo Plist、AVInitialRouteSharingPolicyキーに移動し、LongFormAudioに設定することです。

00:05:26.000 -> 00:05:32.000
Xcodeでは、このキーはドロップダウンメニューの「AirPlay最適化ポリシー」と呼ばれます。

00:05:32.000 -> 00:05:34.000
そして、それだけです。

00:05:34.000 -> 00:05:42.000
iOSは残りを処理し、デバイス上の学習を使用して、アプリを開くときに使用する近くのスピーカーをスマートに提供します。

00:05:42.000 -> 00:05:49.000
次に、AVRoutePickerViewをビュー階層に追加して、アプリにAirPlayピッカーを含めます。

00:05:49.000 -> 00:05:55.000
ピッカーは、あなたのアプリで使用できる潜在的なAirPlayデバイスのリストを人々に提供します。

00:05:55.000 -> 00:06:08.000
最後に、MPNowPlayingInfoCenterを使用して現在の再生アイテムについてシステムに通知し、MPRemoteCommandCenterを使用して再生、一時停止、スキップなどのリモートコマンドを受信します。

00:06:08.000 -> 00:06:11.000
これは、AirPlay用のアプリの設定をカバーしています。

00:06:11.000 -> 00:06:25.000
これで、強化されたオーディオバッファリングをサポートするには、これら2つのAPIセット、AVPlayerとAVQueuePlayerまたはAVSampleBufferAudioRendererとAVSampleBufferRenderSynchronizerのいずれかを採用する必要があります。

00:06:25.000 -> 00:06:31.000
どちらのAPIも、ローカルまたはBluetoothを含む非AirPlay再生で動作します。

00:06:31.000 -> 00:06:38.000
しかし、一部の開発者は、AirPlayと非AirPlayの再生に異なるAPIを望むかもしれません。

00:06:38.000 -> 00:06:48.000
その場合、アプリはrouteChangeNotificationに登録し、現在のルートに応じてそれに応じて行動することができます。

00:06:48.000 -> 00:06:55.000
AVPlayerとAVQueuePlayerは、アプリの強化されたオーディオバッファリングをサポートする最も簡単な方法を提供します。

00:06:55.000 -> 00:07:01.000
大多数のアプリ開発者には、AVQueuePlayerを採用することをお勧めします。

00:07:01.000 -> 00:07:10.000
AVQueuePlayerは、アイテムの管理、再生の制御、メディアによるシークなど、再生に必要なもののほとんどを処理します。

00:07:10.000 -> 00:07:14.000
Apple独自のメディアアプリのほとんどは、AVQueuePlayerも使用しています。

00:07:14.000 -> 00:07:18.000
開始するには、キュープレーヤーを作成します。

00:07:18.000 -> 00:07:24.000
再生したいローカルまたはクラウドのコンテンツを指すURLを特定します。

00:07:24.000 -> 00:07:33.000
次に、URLでAVAssetインスタンスを作成し、そのアセットでAVPlayerItemインスタンスを作成します。

00:07:33.000 -> 00:07:38.000
最後に、AVPlayerItemをプレーヤーに渡し、再生を開始します。

00:07:38.000 -> 00:07:41.000
それはとても簡単です。

00:07:41.000 -> 00:07:45.000
「プレイアイテムをプレイヤーにキューに入れているだけです」と思うかもしれません。

00:07:45.000 -> 00:07:47.000
AirPlayの部分はどこにありますか?

00:07:47.000 -> 00:07:48.000
そして、その通りです。

00:07:48.000 -> 00:07:55.000
AVPlayerとAVQueuePlayerを使用すると、AirPlayにルーティングされると自動的にオーディオバッファリングが強化されます。

00:07:55.000 -> 00:08:00.000
AVPlayerの機能については、説明のリンクを参照してください。

00:08:00.000 -> 00:08:15.000
メディアデータの前処理を実行する必要があるユニークなアプリがある場合、またはAVPlayerがサポートしていないDRMモデルがある場合は、AVSampleBufferAudioRendererとAVSampleBufferRenderSynchronizerを使用できます。

00:08:15.000 -> 00:08:21.000
APIを使用して、複数のキューに入れられたサンプルバッファを1つのタイムラインに同期します。

00:08:21.000 -> 00:08:26.000
ここでは、オーディオデータをキューに入れる方法の基本について説明します。

00:08:26.000 -> 00:08:31.000
まず、すべての再生操作を実行するためのシリアルキューを作成する必要があります。

00:08:31.000 -> 00:08:35.000
オーディオレンダラーとレンダリングシンクロナイザーを作成します。

00:08:35.000 -> 00:08:40.000
シンクロナイザーは、メディアのタイムラインを確立するために使用されます。

00:08:40.000 -> 00:08:44.000
次に、オーディオレンダラーをレンダリングシンクロナイザーに追加します。

00:08:44.000 -> 00:08:49.000
これは、オーディオレンダラーにメディアのタイムラインに従うように指示します。

00:08:49.000 -> 00:08:55.000
オーディオデータをキューに入れるには、より多くのデータが必要であることを知らせるコールバックをインストールします。

00:08:55.000 -> 00:09:00.000
そのコールバックでオーディオデータのキューイングを開始します。

00:09:00.000 -> 00:09:05.000
そして、オーディオデータがなくなったら、レンダラーにデータの要求を停止するように指示します。

00:09:05.000 -> 00:09:07.000
これはインターフェイスの基本にすぎません。

00:09:07.000 -> 00:09:18.000
詳細については、このAPIの使用方法と、カスタムプレーヤーを構築するためのサンプルプロジェクトについて詳しく説明している説明のリンクされたドキュメントを参照してください。

00:09:18.000 -> 00:09:24.000
これは、AirPlay互換デバイスへの強化されたオーディオバッファリングを利用するために使用できる2つのAPIをカバーしています。

00:09:24.000 -> 00:09:26.000
そして、それだけではありません。

00:09:26.000 -> 00:09:32.000
自動車メーカーは、CarPlayの実装で強化されたバッファリングをサポートできるようになりました。

00:09:32.000 -> 00:09:34.000
なぜこれが重要なのですか?

00:09:34.000 -> 00:09:37.000
ワイヤレスCarPlayをサポートする車両が増えています。

00:09:37.000 -> 00:09:43.000
ロード中で最高のオーディオ体験を得るには、堅牢な再生とレスポンシブコントロールが不可欠です。

00:09:43.000 -> 00:09:53.000
良いニュースは、以前に話した2つのAPIの1つを使用して、アプリに強化されたオーディオバッファリングを追加することで、CarPlayでも機能することです。

00:09:53.000 -> 00:09:59.000
あなたのアプリを使用している人々は、彼らの旅がどこに行っても最高のオーディオストリーミング体験を持つでしょう。

00:09:59.000 -> 00:10:17.000
要約するには、AirPlayサポート用のオーディオセッションを設定し、アプリにAirPlayピッカーを追加し、Media Playerをアプリに統合し、AVQueuePlayerまたはカスタムレンダリングと同期APIを採用して、オーディオバッファリングを強化する必要があります。

00:10:17.000 -> 00:10:18.000
これはほんの始まりにすぎません。

00:10:18.000 -> 00:10:23.000
私たちは継続的に改善し、この技術により多くの機能をもたらすために取り組んでいます。

00:10:23.000 -> 00:10:25.000
あなたがセッションを楽しんだことを願っています。ありがとうございます。

00:10:25.000 -> 23:59:59.000
♪ ♪

