WEBVTT

00:00:00.000 --> 00:00:10.000
♪ ♪

00:00:10.000 --> 00:00:12.000
ショーン:こんにちは、私はショーンです。

00:00:12.000 --> 00:00:15.000
私はインターネット技術チームのエンジニアです。

00:00:15.000 --> 00:00:23.000
今日は、L4Sでアプリのネットワーク遅延を減らすことについて話します。

00:00:23.000 --> 00:00:30.000
L4Sは、低遅延、低損失、スケーラブルなスループットの略です。

00:00:30.000 --> 00:00:41.000
これは、ネットワーク遅延がユーザーエクスペリエンスに影響を与える可能性のあるアプリのパフォーマンスを劇的に向上させる素晴らしい技術です。

00:00:41.000 --> 00:00:54.000
いくつかの利点を挙げると、アプリのコンテンツの読み込み時間を短縮し、ビデオ品質を向上させ、ユーザー間のより応答性の高いコラボレーションをもたらすのに役立ちます。

00:00:54.000 --> 00:01:01.000
今日はまず、L4Sがどのように機能し、どのようにネットワークの遅延を削減するかを探ります。

00:01:01.000 --> 00:01:10.000
次に、L4S用にアプリを準備する方法と、サーバーでL4Sを有効にする方法について説明します。

00:01:10.000 --> 00:01:17.000
最後に、L4Sネットワークを設定し、アプリをテストするための手順について説明します。

00:01:17.000 --> 00:01:24.000
まず、L4Sの利点とそれがどのように機能するかを探りましょう。

00:01:24.000 --> 00:01:32.000
ビジーネットワークは、リアルタイムのオーディオやビデオなどの機能に依存するアプリにとって特に難しい場合があります。

00:01:32.000 --> 00:01:43.000
ネットワークが一度に多くのデバイスで使用される場合、多くの場合、これらのタイプのアプリで高いレイテンシーとパケット損失を引き起こす可能性があります。

00:01:43.000 --> 00:01:54.000
たとえば、同じネットワークを使用している他の誰かが映画を見たり、ビデオゲームをダウンロードしたりしているときに、ビデオ通話中に遅延やビデオ停止を経験した可能性があります。

00:01:54.000 --> 00:02:05.000
このような困難な状況でL4Sがどれだけ役立つかを示すために、2つのデバイス間でビデオ通話を行うサンプルアプリを作成しました。

00:02:05.000 --> 00:02:16.000
異なる時間に作られた私のサンプルアプリで2つのビデオ通話をお見せします。1つはL4Sなし、もう1つはL4Sがオンになっています。

00:02:16.000 --> 00:02:22.000
これらの両方の呼び出しで、私は低帯域幅で同じ制約付きネットワークを使用しました。

00:02:22.000 --> 00:02:30.000
さらに、同時に同じネットワークを積極的に使用している他の複数のデバイスもあります。

00:02:30.000 --> 00:02:33.000
これを実際に見てみましょう。

00:02:33.000 --> 00:02:39.000
2つの通話間のビデオ品質の顕著な違いに気づくでしょう。

00:02:39.000 --> 00:02:45.000
従来のものは、特に動きの間に、時折ビデオの失速と遅延を示しています。

00:02:45.000 --> 00:02:53.000
しかし、L4Sでは、ビデオはスムーズで応答性が高く、大きな遅延はありません。

00:02:53.000 --> 00:03:00.000
それでは、何が起こったのかを理解するために、目撃したばかりのビデオ通話を分析しましょう。

00:03:00.000 --> 00:03:10.000
このデモでは、L4Sは、私たちのアプリがすべての主要なネットワーク指標で大幅な改善を達成することを可能にしました。

00:03:10.000 --> 00:03:18.000
まず、これらのビデオ通話中のパケットの往復時間の分布を見てみましょう。

00:03:18.000 --> 00:03:24.000
より短い往復時間は、ネットワーク上のより低く、より優れたレイテンシーを示します。

00:03:24.000 --> 00:03:35.000
このようなインタラクティブなアプリでは、ユーザーが経験する最悪のケースを示すため、テールレイテンシは非常に重要です。

00:03:35.000 --> 00:03:40.000
当社のテストネットワークの最小往復時間は20ミリ秒です。

00:03:40.000 --> 00:03:49.000
しかし、L4Sがなければ、パケットは最大45ミリ秒の往復時間を経験しました。

00:03:49.000 --> 00:04:01.000
しかし、L4Sをオンにすると、最悪の場合のレイテンシも50%削減され、25ミリ秒未満に減少しました。

00:04:01.000 --> 00:04:05.000
次に、パケット損失を見てみましょう。

00:04:05.000 --> 00:04:11.000
より低いパケット損失は、デバイス間のより信頼性の高い接続を表します。

00:04:11.000 --> 00:04:16.000
レガシーでは、パケット損失率は40%以上に達しました。

00:04:16.000 --> 00:04:22.000
しかし、L4Sでは、ビデオ通話のパケット損失はほぼ排除されました。

00:04:22.000 --> 00:04:28.000
これは、データの損失によるフレームの低下や失速がはるかに少ないことを意味します。

00:04:28.000 --> 00:04:36.000
改善されたレイテンシとパケット損失率は、ビデオ通話のより良いレンダリングメトリックに直接変換されます。

00:04:36.000 --> 00:04:40.000
まず、ビデオの失速率を見てみましょう。

00:04:40.000 --> 00:04:45.000
失速率が低いということは、ビデオ通話中のフリーズが少ないことを意味します。

00:04:45.000 --> 00:04:52.000
L4Sがなければ、私たちは時々アプリでビデオストールを経験しました。

00:04:52.000 --> 00:04:59.000
しかし、L4Sでは、ビデオストールはほぼ完全に排除されました。

00:04:59.000 --> 00:05:04.000
次に、受信したビデオフレームレートを見てみましょう。

00:05:04.000 --> 00:05:11.000
より高く、より一貫性のある受信ビデオフレームレートは、より豊かでスムーズなビデオ通話を意味します。

00:05:11.000 --> 00:05:20.000
L4Sでは、受信したビデオフレームレートはほとんどの場合、毎秒25フレームを超えていました。

00:05:20.000 --> 00:05:30.000
しかし、レガシーのものは時々毎秒0フレームまで低下し、これは完全なビデオストールを意味します。

00:05:30.000 --> 00:05:37.000
全体として、これらの改善は、制約されたネットワークでもはるかに優れたユーザーエクスペリエンスを提供します。

00:05:37.000 --> 00:05:44.000
L4Sを採用することで、これらの同じ改善をアプリにもたらすことができます。

00:05:44.000 --> 00:05:49.000
では、L4Sの仕組みを見てみましょう。

00:05:49.000 --> 00:05:57.000
L4Sはキューイングとパケット損失を減らすため、このような顕著な改善が見られます。

00:05:57.000 --> 00:06:02.000
まず、ネットワーク内でキューがどのように構築されるかを見てみましょう。

00:06:02.000 --> 00:06:10.000
パケットがアプリから送信されると、サーバーに到達する前に異なるネットワークホップを介してルーティングされます。

00:06:10.000 --> 00:06:17.000
パケットがトラバースするこのホップのセットは、ネットワークパスと呼ばれます。

00:06:17.000 --> 00:06:28.000
ネットワークを通るパスでは、ボトルネックと呼ばれる最も遅いホップでサポートされている速度でデータをエンドツーエンドでしか配信できません。

00:06:28.000 --> 00:06:39.000
多くの人にとって、これはインターネットサービスプロバイダの接続であり、パケットを処理できる最高レートは、パスでサポートされている最大スループットを決定します。

00:06:39.000 --> 00:06:48.000
送信者が最大スループットを超えると、ボトルネックでキューが形成され、後続のパケットの遅延が発生します。

00:06:48.000 --> 00:06:55.000
L4Sがなければ、キューがこれ以上のパケットに対応できなくなるまで、キューは増え続けます。

00:06:55.000 --> 00:07:02.000
それが起こると、パケットはドロップされ、レイテンシとスループットの両方に損害を与えます。

00:07:02.000 --> 00:07:10.000
L4Sは、クライアント、サーバー、およびボトルネック間のコラボレーションを通じてこの問題を解決します。

00:07:10.000 --> 00:07:20.000
L4Sでは、パケットを送信するクライアントまたはサーバーは、ネットワークの混雑を管理するために協力することを通知する必要があります。

00:07:20.000 --> 00:07:32.000
これを行うには、L4S対応の送信者は、ECNとも呼ばれる明示的な輻輳通知と呼ばれる技術を使用します。

00:07:32.000 --> 00:07:40.000
パケットを送信するとき、送信者はパケットのIPヘッダーのECNビットを使用してL4Sのサポートを示します。

00:07:40.000 --> 00:07:49.000
L4Sホップがこれらのパケットを受信すると、L4Sキュー管理が適用されます。

00:07:49.000 --> 00:08:01.000
ボトルネックでキューが構築され始めると、L4Sキュー管理は、パケットに別のECNラベルを設定することで、混雑があることを示します。

00:08:01.000 --> 00:08:09.000
このラベルは、次のホップに転送する前にネットワークが輻輳を経験したことを示します。

00:08:09.000 --> 00:08:20.000
これらのパケットを受信すると、受信者は混雑ラベルでマークされたパケットの数をカウントし、その番号を送信者に報告します。

00:08:20.000 --> 00:08:26.000
送信者がこの番号を受信すると、このフィードバックを使用してネットワーク上の混雑を理解します。

00:08:26.000 --> 00:08:36.000
その後、送信者は、最大スループットを超えないように、ボトルネックの輻輳のレベルに応じて送信速度を調整します。

00:08:36.000 --> 00:08:43.000
送信レートを調整することで、送信者はボトルネックでパケットの大きなキューを構築することを避けることができます。

00:08:43.000 --> 00:08:52.000
これにより、L4Sはスループットを最大化し、同時にエンドツーエンドのレイテンシを短縮できます。

00:08:52.000 --> 00:09:00.000
では、このコラボレーションがこれらの利点をユーザーに提供できるようにするために何をする必要があるかを探りましょう。

00:09:00.000 --> 00:09:06.000
まず、L4S用にアプリを準備する方法について話し合いましょう。

00:09:06.000 --> 00:09:16.000
URLSessionとネットワークフレームワークでネットワークAPIを使用することは、アプリにL4Sを採用するための最良の方法です。

00:09:16.000 --> 00:09:24.000
アプリがこれらのフレームワーク内でHTTP/3またはQUICを使用している場合、L4Sのサポートは自動的に組み込まれます。

00:09:24.000 --> 00:09:29.000
アプリにコード変更を加える必要はありません。

00:09:29.000 --> 00:09:42.000
あるいは、アプリがHTTP/2またはTCPを使用している場合、iOS 17とmacOS Sonomaには、これらのプロトコルでのダウンロードに対するL4Sサポートが組み込まれています。

00:09:42.000 --> 00:09:52.000
これらは、コードの変更を必要としないため、アプリにL4Sサポートを追加する最良の方法です。

00:09:52.000 --> 00:10:03.000
ただし、アプリがカスタムプロトコルを使用している場合は、アプリでL4Sをサポートするために実装する必要があることがいくつかあります。

00:10:03.000 --> 00:10:09.000
RFC 9330は、L4Sの要件について学ぶための良い出発点です。

00:10:09.000 --> 00:10:12.000
いくつかの新しい動作を実装する必要があります。

00:10:12.000 --> 00:10:21.000
たとえば、プロトコルはネットワークからのL4S輻輳フィードバックを理解し、それに応じて送信レートを調整する必要があります。

00:10:21.000 --> 00:10:26.000
これを行うには、スケーラブルな輻輳制御アルゴリズムを実装する必要があります。

00:10:26.000 --> 00:10:34.000
次に、ネットワークがECNビットを通過させる場合にのみ、アプリがL4Sトラフィックを送信することを確認する必要があります。

00:10:34.000 --> 00:10:46.000
これを行うには、ECN漂白など、ECNに干渉している可能性のあるネットワークの問題をチェックするECN検証メカニズムを実装します。

00:10:46.000 --> 00:10:56.000
受信者として機能する場合、プロトコルには、ネットワークのECNフィードバックを送信者にエコーするリレーメカニズムも必要です。

00:10:56.000 --> 00:11:08.000
実装がネットワークフレームワークに基づいている場合は、パケットメタデータのECNプロパティを使用して、カスタムプロトコルのECNフラグを送受信できます。

00:11:08.000 --> 00:11:19.000
ソケットを使用している場合は、セットソケットオプションを使用するか、メッセージシステムコールを送受信してECNフラグを送受信できます。

00:11:19.000 --> 00:11:28.000
それでは、L4S用にアプリを準備する方法について説明しました。サーバーの設定方法を探りましょう。

00:11:28.000 --> 00:11:36.000
アプリがQUICを使用している場合、サーバーのQUICの実装もL4SとECNマーキングをサポートする必要があります。

00:11:36.000 --> 00:11:41.000
サーバー側で利用可能な多数のQUIC実装があります。

00:11:41.000 --> 00:11:46.000
ECNとL4Sを有効にする方法については、サーバープロバイダーに尋ねてください。

00:11:46.000 --> 00:11:54.000
L4Sトラフィックの送信をまだサポートしていない場合でも、ECNがサーバーでL4Sトラフィックを受信できるようにすることができます。

00:11:54.000 --> 00:12:01.000
今、彼らがL4Sを完全にサポートすることを奨励する絶好の機会です。

00:12:01.000 --> 00:12:08.000
アプリがTCPを使用している場合は、サーバーのTCP実装にL4Sサポートを追加する必要があります。

00:12:08.000 --> 00:12:14.000
Linuxベースのサーバーの場合は、このGitHubページの指示に従って、サーバーにサポートを追加してください。

00:12:14.000 --> 00:12:21.000
また、このビデオの関連項目の記事から詳細を見つけることができます。

00:12:21.000 --> 00:12:31.000
他のすべてのサーバープラットフォームについては、L4Sをサポートするために追加の構成や変更が必要になる可能性があるため、サーバープロバイダーに相談してください。

00:12:31.000 --> 00:12:43.000
アプリとサーバーをL4Sに設定する方法について説明したので、アプリをテストするためにL4Sネットワークを設定する方法を探りましょう。

00:12:43.000 --> 00:12:48.000
まず、ネットワークL4Sが可能な理由を確認しましょう。

00:12:48.000 --> 00:12:52.000
ネットワークはECNマーキングをブロックしてはいけません。

00:12:52.000 --> 00:13:01.000
ECNマーキングは、送信者、ボトルネック、および受信者の間でネットワークに関する情報を通信するために使用されます。

00:13:01.000 --> 00:13:07.000
ネットワークがECNマーキングに干渉した場合、L4Sは機能しません。

00:13:07.000 --> 00:13:17.000
ドキュメントには、ネットワークがECNと互換性があるかどうかを確認するために使用できる追加のツールとともに、従うことができる手順があります。

00:13:17.000 --> 00:13:23.000
次に、ネットワークのボトルネックはL4Sキュー管理をサポートする必要があります。

00:13:23.000 --> 00:13:28.000
これは、L4Sの利点を見るために不可欠です。

00:13:28.000 --> 00:13:36.000
ネットワークがECN互換であることを確認したら、ボトルネックにL4Sキュー管理を追加するだけです。

00:13:36.000 --> 00:13:45.000
L4Sキュー管理をサポートするテストネットワークを設定するには、インターネット共有を使用するのが最善の方法です。

00:13:45.000 --> 00:13:51.000
macOS Sonomaでは、インターネット共有はL4Sキュー管理をサポートしています。

00:13:51.000 --> 00:14:02.000
デバイスがインターネット共有でMacによって作成されたネットワークに参加すると、Mac自体はデバイスとサーバーの間の追加のネットワークホップになります。

00:14:02.000 --> 00:14:15.000
Macをネットワークのボトルネックに設定すると、それを通過するトラフィックにL4Sキュー管理が適用され、完全なL4Sネットワークを構築できます。

00:14:15.000 --> 00:14:22.000
macOSでインターネット共有を有効にするには、システム設定のインターネット共有ペインに移動します。

00:14:22.000 --> 00:14:32.000
開示ボタンをクリックして、共有するインターフェイスと、テストデバイスが接続するインターフェイスを選択します。

00:14:32.000 --> 00:14:38.000
Macをこのネットワークのボトルネックとして機能させるには、帯域幅を抑制する必要があります。

00:14:38.000 --> 00:14:49.000
ターミナルでこのifconfigコマンドを、共有しているインターフェイスと、デバイスが接続するインターフェイスで使用します。

00:14:49.000 --> 00:14:58.000
このコマンドのインターフェイス名を、使用しているインターフェイスの名前（例：en1）に置き換えます。

00:14:58.000 --> 00:15:06.000
次に、テストデバイスでネットワークに参加し、アプリをテストしてL4Sの利点を確認します。

00:15:06.000 --> 00:15:20.000
Macの帯域幅スロットリングを逆にするには、再起動するか、同じifconfigコマンドを実行しますが、帯域幅を毎秒10メガビットではなく0に変更できます。

00:15:20.000 --> 00:15:28.000
iOS 17とmacOS Sonomaでは、L4Sはランダムなユーザーに徐々に展開されます。

00:15:28.000 --> 00:15:36.000
テストデバイスでL4Sがオンになっていることを確認するには、開発者設定に移動してL4Sをオンにします。

00:15:36.000 --> 00:15:43.000
macOSでは、テスト前にこのデフォルトの書き込みコマンドを実行することで、L4Sを有効にすることができます。

00:15:43.000 --> 00:15:51.000
ネットワークまたはサーバーがL4Sをサポートしていない場合、TCPとQUICはレガシーモードで引き続き動作します。

00:15:51.000 --> 00:15:58.000
ただし、L4Sをオンにしてアプリケーションをテストして問題を特定する必要があります。

00:15:58.000 --> 00:16:04.000
問題が発生した場合は、フィードバックアシスタントを使用してフィードバックを提供してください。

00:16:04.000 --> 00:16:11.000
このドキュメントでは、アプリでのL4Sのデバッグとテストに関する有用な情報も提供しています。

00:16:11.000 --> 00:16:21.000
アプリとネットワークがL4Sでレイテンシの削減とパケット損失の削減をサポートできるようになったことにとても興奮しています。

00:16:21.000 --> 00:16:32.000
L4Sをサポートするネットワークとサポートしないネットワークで、iOS 17とmacOS Sonomaでアプリを今すぐテストしてください。

00:16:32.000 --> 00:16:42.000
サーバーまたはCDNプロバイダーと協力して、アプリのサーバーでL4Sのサポートを有効にしてください。

00:16:42.000 --> 00:16:49.000
フィードバックアシスタントを使用して、アプリでL4Sがオンになっている問題が発生した場合に報告します。

00:16:49.000 --> 00:16:51.000
見てくれてありがとう。

00:16:51.000 --> 00:16:56.000
L4Sを使ってあなたと一緒にさらに良いアプリを構築することを楽しみにしています。

00:16:56.000 --> 23:59:59.000
♪ ♪

