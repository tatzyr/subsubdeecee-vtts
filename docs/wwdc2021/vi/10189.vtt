WEBVTT

00:00:00.000 --> 00:00:05.000
♪ Nhạc bass đang phát ♪

00:00:05.000 --> 00:00:09.000
♪

00:00:09.000 --> 00:00:11.000
Jer Noble: Xin chào, tôi là Jer!

00:00:11.000 --> 00:00:15.000
Và tôi làm việc để phát lại phương tiện trong WebKit và Safari ở đây tại Apple.

00:00:15.000 --> 00:00:24.000
Mọi người thích xem các chương trình và bộ phim yêu thích của họ và nghe nhạc cùng nhau, cho dù đó là với những người trong cùng một phòng, bên cạnh hay ở phía bên kia thế giới.

00:00:24.000 --> 00:00:32.000
Và bây giờ với GroupActivities, việc cung cấp trải nghiệm SharePlay cho người dùng của bạn trở nên dễ dàng hơn bao giờ hết, dù họ ở đâu.

00:00:32.000 --> 00:00:35.000
Trong phiên này, chúng tôi sẽ đề cập đến bốn chủ đề.

00:00:35.000 --> 00:00:55.000
Giới thiệu về phát lại phối hợp trong Safari; cách chuẩn bị ứng dụng iOS của bạn hoạt động với SharePlay trong Safari; cách áp dụng API Phiên Phương tiện trong trang web của ứng dụng của bạn; và API web mới để phối hợp phát lại trên nhiều thiết bị.

00:00:55.000 --> 00:01:00.000
Vậy hãy bắt đầu bằng cách nói một chút về SharePlay và Safari.

00:01:00.000 --> 00:01:09.000
Trong phiên trước, bạn đã học cách tạo trải nghiệm SharePlay tuyệt vời trong các ứng dụng iPhone và iPad của mình với GroupActivities.

00:01:09.000 --> 00:01:18.000
Và trên macOS Monterey, bạn có thể mang lại trải nghiệm tương tự - cùng với các ứng dụng iPhone và iPad tuyệt vời của mình - cho Mac bằng Catalyst.

00:01:18.000 --> 00:01:29.000
Và nếu ứng dụng của bạn có một trang web đồng hành, bạn có thể mang lại trải nghiệm SharePlay tuyệt vời tương tự cho người dùng Mac Safari 15 của mình mà không yêu cầu những người dùng đó tải xuống ứng dụng của bạn từ App Store.

00:01:29.000 --> 00:01:33.000
Và đó là những gì tôi sẽ chỉ cho bạn cách làm trong phiên này.

00:01:33.000 --> 00:01:36.000
Tôi đang làm việc trên một ứng dụng iPhone cho phép bạn xem đoạn giới thiệu phim.

00:01:36.000 --> 00:01:43.000
Tôi đã thêm hỗ trợ cho GroupActivities vào ứng dụng của mình và điều đó cho phép bạn bè xem đoạn giới thiệu phim cùng nhau qua FaceTime.

00:01:43.000 --> 00:01:46.000
Nhưng ứng dụng trailer phim của tôi cũng có một trang web.

00:01:46.000 --> 00:01:53.000
Và đây là cách nó sẽ trông như thế nào khi tôi thêm hỗ trợ cho GroupActivities trong trang web đó.

00:01:53.000 --> 00:01:55.000
Tôi đang thực hiện một cuộc gọi FaceTime với bạn tôi Sam.

00:01:55.000 --> 00:02:00.000
Sam thích xem đoạn giới thiệu phim, vì vậy tôi đã nhờ họ giúp tôi thử nghiệm ứng dụng Đoạn giới thiệu phim mới này.

00:02:00.000 --> 00:02:09.000
Khi họ bắt đầu phát đoạn giới thiệu mới trong ứng dụng đó trong cuộc gọi của chúng tôi, tôi sẽ được mời xem đoạn giới thiệu đó thông qua một thông báo.

00:02:09.000 --> 00:02:12.000
Nó sẽ cho tôi tùy chọn tham gia phiên trong Safari.

00:02:12.000 --> 00:02:23.000
Khi tôi nhấp vào thông báo đó, Safari sẽ được khởi chạy với URL cho nội dung được chia sẻ và khi Sam bắt đầu phát đoạn giới thiệu, nó sẽ phát ở đây trong Safari cùng một lúc.

00:02:23.000 --> 00:02:33.000
Tôi có thể tạm dừng, phát và thậm chí tìm kiếm video ở đây trong Safari và mọi người khác trong phiên sẽ thấy những lệnh tương tự được phản ánh trong video cục bộ của họ cùng một lúc.

00:02:33.000 --> 00:02:35.000
Nó sẽ thực sự tuyệt vời!

00:02:35.000 --> 00:02:40.000
Vậy, cần những gì để thêm hỗ trợ GroupActivities vào trang web đoạn giới thiệu phim?

00:02:40.000 --> 00:02:50.000
Trước khi chúng ta xem xét dưới mui xe của Safari - tại các API Web mới có sẵn trong Safari 15 - hãy nói về cách chuẩn bị ứng dụng của bạn để hoạt động với Safari thông qua GroupActivities.

00:02:50.000 --> 00:03:02.000
Để tham gia phiên GroupActivities với Safari, người dùng với ứng dụng iPhone hoặc iPad của bạn sẽ cần tạo GroupSessionActivity với URL dự phòng trỏ đến trang web của bạn.

00:03:02.000 --> 00:03:08.000
URL dự phòng phải xác định không chỉ trang web của bạn, mà cả nội dung cụ thể sẽ được phát.

00:03:08.000 --> 00:03:20.000
Khi lời mời Watch Together được người dùng iPhone phát hành cho người dùng trên máy Mac, Safari sẽ được khởi chạy và yêu cầu tải URL mà bạn cung cấp trong GroupSessionActivity.

00:03:20.000 --> 00:03:27.000
Khi fallbackURL được tải trong Safari, trang web của bạn sẽ cần triển khai một vài API Web đơn giản nhưng quan trọng.

00:03:27.000 --> 00:03:29.000
Đầu tiên là Phiên Truyền thông.

00:03:29.000 --> 00:03:39.000
Media Session là một API Web tiêu chuẩn cho phép trang web của bạn cho trình duyệt biết - Safari - nhiều hơn về trạng thái phát lại phương tiện hiện tại trong trang của bạn.

00:03:39.000 --> 00:03:43.000
Trang web của bạn có thể cho trình duyệt biết trạng thái phát hiện tại, thời lượng nội dung của bạn.

00:03:43.000 --> 00:03:46.000
Nó có thể cung cấp tác phẩm nghệ thuật cho mục phát lại hiện tại.

00:03:46.000 --> 00:03:52.000
Nó thậm chí có thể cho trình duyệt biết rằng nội dung hiện tại là một quảng cáo có thể bỏ qua.

00:03:52.000 --> 00:04:02.000
Khi Trình duyệt có sẵn tất cả siêu dữ liệu này, nó có thể cung cấp siêu dữ liệu đó cho phần còn lại của hệ điều hành và trình bày nó cho người dùng của bạn bên ngoài chính cửa sổ trình duyệt.

00:04:02.000 --> 00:04:07.000
Một nơi mà hệ điều hành hiển thị dữ liệu nằm trong một thứ gọi là "Đang phát".

00:04:07.000 --> 00:04:13.000
Now Playing là một cách tuyệt vời để người dùng nhanh chóng xem và kiểm soát phương tiện mà họ đang thưởng thức ngay bây giờ.

00:04:13.000 --> 00:04:19.000
Trong iOS, người dùng có thể truy cập Đang phát từ Trung tâm điều khiển cũng như từ màn hình Khóa.

00:04:19.000 --> 00:04:25.000
Và bây giờ trong macOS Monterey, người dùng có thể truy cập Đang phát trực tiếp từ thanh menu.

00:04:25.000 --> 00:04:35.000
Và Safari sẽ sử dụng thông tin được cung cấp thông qua Media Session để điền Đang phát với tiêu đề, thời lượng, trạng thái phát, tác phẩm nghệ thuật của nội dung của bạn và hơn thế nữa.

00:04:35.000 --> 00:04:43.000
Now Playing cũng cho phép người dùng kiểm soát phát lại những gì họ đang nghe, bằng cách hiển thị cho người dùng một bộ điều khiển phát lại đơn giản.

00:04:43.000 --> 00:04:58.000
Trang web của bạn có thể đăng ký với Phiên phương tiện cho các hành động cụ thể để thực hiện khi người dùng tương tác với Đang phát, ví dụ: khi người dùng nhấn vào nút Phát trong Đang phát, Safari có thể chạy trình xử lý hành động của riêng bạn để bắt đầu phát lại.

00:04:58.000 --> 00:05:08.000
Media Session cung cấp cho trang web của bạn toàn quyền kiểm soát siêu dữ liệu nào sẽ hiển thị cho trình duyệt, cũng như kiểm soát cách triển khai các lệnh phát lại.

00:05:08.000 --> 00:05:11.000
Cần thực hiện một số thiết lập hoặc kiểm tra trước khi bắt đầu phát lại?

00:05:11.000 --> 00:05:12.000
Không vấn đề gì.

00:05:12.000 --> 00:05:16.000
Với trình xử lý hành động chơi của mediaSession, bây giờ bạn có thể.

00:05:16.000 --> 00:05:21.000
Nếu trang web của bạn trước đây đã áp dụng Media Session, bạn đã hoàn thành được một nửa rồi.

00:05:21.000 --> 00:05:27.000
Nhưng trang web giới thiệu phim vẫn chưa áp dụng Media Session, vì vậy hãy thêm hỗ trợ cho điều đó ngay bây giờ.

00:05:27.000 --> 00:05:32.000
Trang web này sẽ muốn thêm các hành động để chơi, tạm dừng và tìm kiếm.

00:05:32.000 --> 00:05:38.000
Để làm như vậy, chúng tôi sẽ sử dụng thuộc tính mediaSession của trình điều hướng.

00:05:38.000 --> 00:05:41.000
Trước tiên hãy thêm một trình xử lý hành động để chơi.

00:05:41.000 --> 00:05:50.000
Chúng tôi sẽ gọi mediaSession. setActionHandler(), chuyển trong chuỗi phát và một hàm nội tuyến chỉ gọi play() trên phần tử video của chúng tôi.

00:05:50.000 --> 00:05:56.000
Sau đó, chúng tôi sẽ làm điều tương tự để tạm dừng và tìm kiếm.

00:05:56.000 --> 00:06:07.000
Và để đảm bảo rằng chúng tôi đang thể hiện chính xác trạng thái phát lại cho trình duyệt, chúng tôi sẽ thêm trình nghe sự kiện vào phần tử video của mình và cập nhật mediaSession khi trạng thái đó thay đổi.

00:06:07.000 --> 00:06:11.000
Đầu tiên, hãy thêm một hàm gọi là updateMediaSessionState().

00:06:11.000 --> 00:06:16.000
Nó sẽ truy vấn phần tử video để tìm hiểu xem nó đang phát hay tạm dừng.

00:06:16.000 --> 00:06:26.000
Sau đó, nó sẽ đặt thuộc tính playbackState của mediaSession thành chuỗi đang phát hoặc tạm dừng, tùy thuộc vào trạng thái phát lại của phần tử video.

00:06:26.000 --> 00:06:31.000
Tiếp theo, nó sẽ truy vấn thời lượng, tốc độ phát lại và thời gian hiện tại của phần tử video.

00:06:31.000 --> 00:06:41.000
Sau đó, sử dụng các giá trị đó, nó sẽ gọi hàm setPositionState() của mediaSession, truyền các giá trị đó vào tham số từ điển.

00:06:41.000 --> 00:06:50.000
Sau đó, hãy thêm một trình nghe sự kiện để phát hiện khi nào các giá trị đó thay đổi và gọi updateMediaSessionState() để cập nhật mediaSession với các giá trị mới đó.

00:06:50.000 --> 00:06:58.000
Chúng ta sẽ cần một trình nghe sự kiện để phát, tạm dừng, thay đổi thời lượng, thay đổi tốc độ và thay đổi thời gian.

00:06:58.000 --> 00:07:13.000
Và cuối cùng, vì trang web đoạn giới thiệu phim có cả chuỗi tiêu đề và URL cho tác phẩm nghệ thuật tiêu đề, chúng tôi có thể đặt thuộc tính siêu dữ liệu của Media Session thành đối tượng MediaMetadata mới chứa các giá trị đó.

00:07:13.000 --> 00:07:16.000
Vậy hãy thử nó!

00:07:16.000 --> 00:07:23.000
Tôi sẽ tải lại trang của mình trong Safari, bắt đầu chơi, sau đó nhấp vào biểu tượng Đang phát trong menu hệ thống.

00:07:23.000 --> 00:07:25.000
Và tôi thấy tiêu đề và tác phẩm nghệ thuật trong bảng Đang phát.

00:07:25.000 --> 00:07:32.000
Và khi tôi nhấn vào nút Tạm dừng, trình xử lý hành động tạm dừng của chúng tôi được gọi và tạm dừng phát lại.

00:07:32.000 --> 00:07:43.000
Media Session cung cấp các khối xây dựng cho trải nghiệm Watch Together trong một trang web, bằng cách cung cấp một cơ chế để trình duyệt thông báo cho trang rằng nó nên bắt đầu hoặc dừng phát lại.

00:07:43.000 --> 00:07:51.000
Bây giờ chúng tôi đã sẵn sàng chuyển sang phần thứ hai của việc tạo trải nghiệm đồng xem trong trang web của chúng tôi: phối hợp phát lại trên mọi thiết bị trong phiên.

00:07:51.000 --> 00:07:58.000
Để làm như vậy, chúng tôi đã mở rộng Phiên Truyền thông bằng cách thêm một thuộc tính mới vào đó có tên là "Điều phối viên".

00:07:58.000 --> 00:08:13.000
Trang của bạn sẽ sử dụng Điều phối viên của Phiên Truyền thông để thông báo cho mọi người dùng khác trong phiên về ý định bắt đầu hoặc tạm dừng phát lại của trang, tìm đến một điểm cụ thể trong dòng thời gian của phương tiện hoặc chuyển sang mục tiếp theo trong danh sách phát.

00:08:13.000 --> 00:08:27.000
Điều phối viên sẽ truyền đạt những ý định đó với tất cả các thiết bị khác trong phiên và lắng nghe các thay đổi đối với trạng thái phát của mọi thiết bị khác, giải quyết xung đột và chờ mọi người sẵn sàng bắt đầu phát lại.

00:08:27.000 --> 00:08:36.000
Và khi mọi người đã sẵn sàng, Điều phối viên sẽ sử dụng trình xử lý hành động Phiên phương tiện mà chúng tôi đã thêm trước đó để bắt đầu phát lại cùng với tất cả những người dùng khác trong phiên.

00:08:36.000 --> 00:08:44.000
Và nếu một người dùng khác tạm dừng phát lại vì bất kỳ lý do gì, Điều phối viên sẽ gọi trình xử lý hành động tạm dừng Phiên Truyền thông của bạn.

00:08:44.000 --> 00:08:47.000
Điều đó nói rằng, tôi muốn chỉ ra một vài lưu ý.

00:08:47.000 --> 00:08:59.000
Giao diện Điều phối viên là một API web thử nghiệm; nó vẫn chưa trải qua tiêu chuẩn hóa và trong khi quá trình đó có thể sẽ cải thiện API này, một số khía cạnh của API có thể thay đổi.

00:08:59.000 --> 00:09:05.000
Để tìm hiểu thêm, vui lòng xem trang GitHub Phiên Truyền thông của W3C.

00:09:05.000 --> 00:09:18.000
API này hiện chỉ được triển khai trong Safari, mặc dù khung GroupActivities, mà Safari sử dụng để triển khai Điều phối viên, có thể - và chúng tôi hy vọng sẽ - được các trình duyệt Mac khác áp dụng.

00:09:18.000 --> 00:09:30.000
Và cảnh báo cuối cùng là trong khi người dùng của bạn có thể tham gia một phiên hiện có trong Safari, GroupSession hiện tại phải được khởi tạo từ ứng dụng iPhone, iPad hoặc macOS.

00:09:30.000 --> 00:09:35.000
Vì vậy, hãy thêm hỗ trợ cho Điều phối viên ngay bây giờ.

00:09:35.000 --> 00:09:39.000
Điều đầu tiên tôi muốn làm là tham gia phiên khi nó có sẵn.

00:09:39.000 --> 00:09:44.000
Vì vậy, tôi sẽ thêm một người nghe sự kiện thay đổi điều phối viên vào mediaSession.

00:09:44.000 --> 00:09:51.000
Trong trình xử lý, nếu có thuộc tính điều phối viên không phải null trên mediaSession, tôi sẽ gọi hàm join() của nó.

00:09:51.000 --> 00:09:56.000
Tôi cũng muốn thêm một biểu tượng vào các điều khiển của mình để hiển thị rằng chúng tôi đang phát lại trong một phiên.

00:09:56.000 --> 00:10:04.000
Vì vậy, trong trình xử lý, tôi sẽ hiển thị hoặc ẩn biểu tượng, dựa trên việc có thuộc tính điều phối viên trên mediaSession hay không.

00:10:04.000 --> 00:10:13.000
Tôi cũng sẽ kết nối trình nghe sự kiện nhấp chuột với biểu tượng để gọi leave() trên điều phối viên.

00:10:13.000 --> 00:10:23.000
Tiếp theo, tôi sẽ sửa đổi trình xử lý sự kiện cho các điều khiển tùy chỉnh của mình để kiểm tra sự hiện diện của điều phối viên và nếu chúng tôi có, hãy gọi chức năng điều phối viên thích hợp thay thế.

00:10:23.000 --> 00:10:31.000
Tôi sẽ thêm một cái cho nút Phát của mình, và sau đó cho nút Tạm dừng của tôi, và cả cho thanh trượt dòng thời gian.

00:10:31.000 --> 00:10:34.000
Và hãy xem nó hoạt động!

00:10:34.000 --> 00:10:39.000
Tôi nhận được lời mời ở đây từ bạn tôi Sam, và tôi sẽ chấp nhận nó.

00:10:39.000 --> 00:10:43.000
Trang của tôi tải cùng một nội dung mà Sam đang xem trên iPhone của họ.

00:10:43.000 --> 00:10:50.000
Và khi tôi nhấp vào nút Phát, cả iPhone của Sam và trang web của tôi bắt đầu phát đồng thời.

00:10:50.000 --> 00:10:53.000
Allie Fox: Cách chúng ta đến đó là một cuộc phiêu lưu.

00:10:53.000 --> 00:10:57.000
Dina: Tôi sợ.

00:10:57.000 --> 00:10:59.000
Allie: Nếu nó không cảm thấy như vậy, nó sẽ không phải là một cuộc phiêu lưu.

00:10:59.000 --> 00:11:03.000
♪ &lt; Điều đó thật tuyệt.

00:11:03.000 --> 00:11:12.000
Bây giờ đoạn giới thiệu đã kết thúc, Sam sử dụng iPhone để quay trở lại từ đầu.

00:11:12.000 --> 00:11:25.000
Chúng tôi nghĩ rằng người dùng sẽ thích xem hoặc nghe nội dung yêu thích của họ cùng nhau trong các ứng dụng của bạn, cho dù đó là trên iPhone, iPad, Apple TV hay trong Safari đang chạy trên máy Mac của họ.

00:11:25.000 --> 00:11:31.000
Và chúng tôi hy vọng bây giờ bạn có thể mang lại trải nghiệm đó cho tất cả người dùng của mình, dù họ ở đâu.

00:11:31.000 --> 00:11:42.000
Để biết thêm thông tin về GroupActivities APIs, hãy bắt đầu với các phiên "Phối hợp phát lại phương tiện với Hoạt động Nhóm" và "Thiết kế cho Hoạt động Nhóm".

00:11:42.000 --> 00:11:51.000
Nếu bạn quan tâm đến các API web mới khác sẽ có sẵn trong Safari 15, hãy đảm bảo kiểm tra phiên, "Phát triển nội dung web nâng cao".

00:11:51.000 --> 00:11:55.000
Cảm ơn vì đã đến và tận hưởng phần còn lại của WWDC21 của bạn.

00:11:55.000 --> 23:59:59.000
♪

