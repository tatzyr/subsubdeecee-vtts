WEBVTT

00:00:02.000 --> 00:00:13.000
こんにちは、WWDCへようこそ。

00:00:13.000 --> 00:00:17.000
XCTestチームのエンジニア、ジェレミー・ゴールドマンです。

00:00:17.000 --> 00:00:25.000
このセッションでは、Xcode 13のUIテストからデバイスと対話するいくつかのエキサイティングな新しい方法を探ります。

00:00:25.000 --> 00:00:39.000
特に、iPadOS Pointer、watchOS Digital Crown、macOSトラックパッドの3つの異なるプラットフォームにまたがる3つの新しいインタラクションに焦点を当てます。

00:00:39.000 --> 00:00:42.000
iPadOSポインターから始めましょう。

00:00:42.000 --> 00:00:54.000
iPadOS 13.4では、Appleはマウスとトラックパッドのサポートを導入し、Magic Keyboardなどのアクセサリを使用して、iPadと対話するまったく新しい方法をユーザーに提供しました。

00:00:54.000 --> 00:01:03.000
多くの開発者は、カスタムホバーアニメーションなど、iPadアプリにポインタ固有の動作とインタラクションを追加することで、これを最大限に活用しています。

00:01:03.000 --> 00:01:11.000
Xcode 13では、UIテストでiPadOSポインターを制御するための強力な新しいAPIを提供しています。

00:01:11.000 --> 00:01:25.000
このAPIを使用すると、iPadアプリで複数のタイプのポインタインタラクションの堅牢な自動テストを作成でき、iPadOS 15以降を実行しているデバイスで使用できます。

00:01:25.000 --> 00:01:28.000
この新しいAPIをもっと詳しく調べてみましょう。

00:01:28.000 --> 00:01:37.000
まず、XCUIDeviceに新しいプロパティを追加して、デバイスがポインタインタラクションをサポートしているかどうかを示します。

00:01:37.000 --> 00:01:49.000
次に、ホバリング、複数のタイプのクリック、2本指のスクロールなど、さまざまなポインタインタラクションを実行するための新しいメソッドをXCUIElementに追加します。

00:01:49.000 --> 00:02:00.000
また、より高度なクリックアンドドラッグのユースケースのメソッドと、1つ以上の修飾キーを押しながらコードブロックを実行するためのクラスメソッドも追加しています。

00:02:00.000 --> 00:02:06.000
これらの方法は、追加の精度が必要な場合は、XCUICoordinateでも利用できます。

00:02:06.000 --> 00:02:14.000
iOSアプリでポインタインタラクションのための新しいUIテストを作成して、これらの新しいAPIが実際にどのように機能するかを探りましょう。

00:02:14.000 --> 00:02:20.000
このデモでは、起動時に最初に非表示になっているサイドバーを持つFrutaアプリを使用します。

00:02:20.000 --> 00:02:28.000
私は最近、水平方向の2本指のトラックパッドスワイプでサイドバーが開くiPadにポインタ固有の機能を追加しました。

00:02:28.000 --> 00:02:31.000
そのためにUIテストを追加しましょう。

00:02:31.000 --> 00:02:38.000
ここには空のUIテストクラスがあり、そこで新しいUIテストを追加します。

00:02:38.000 --> 00:02:42.000
このテストが何をしているのか、簡単に説明しましょう。

00:02:42.000 --> 00:02:49.000
アプリを起動し、起動時にサイドバーが最初に存在しないと主張することから始まります。

00:02:49.000 --> 00:02:56.000
次に、水平2本指のトラックパッドスワイプを実行し、サイドバーが存在することをアサートします。

00:02:56.000 --> 00:03:02.000
もう1つ指摘したいのは、テスト方法に追加したこの可用性属性です。

00:03:02.000 --> 00:03:08.000
これは、特定のiOSバージョンからのみ利用可能な方法を使用する場合はいつでも必要です。

00:03:08.000 --> 00:03:14.000
この場合、ポインタインタラクションAPIはiOS 15.0で導入されました。

00:03:14.000 --> 00:03:17.000
iPadシミュレーターでテストを実行してみましょう。

00:03:17.000 --> 00:03:24.000
画面の左下隅にある暗い円であるカーソルインジケーターに従うことができます。

00:03:24.000 --> 00:03:47.000
すごい！私たちのテストはiPadで機能するようです。

00:03:47.000 --> 00:03:53.000
ただし、このアプリはiPhoneでも利用でき、ポインタのインタラクションをサポートしていません。

00:03:53.000 --> 00:03:56.000
このテストをiPhoneシミュレーターで実行してみましょう。

00:03:56.000 --> 00:04:18.000
そのため、テストは「このデバイスではポインターイベントはサポートされていません」というエラーメッセージで失敗したようです。

00:04:18.000 --> 00:04:25.000
これを解決するには、ポインタインタラクションをサポートするデバイスでのみ実行されるようにテストを変更する必要があります。

00:04:25.000 --> 00:04:36.000
XCUIDeviceの新しいsupportsSupportPointerInteractionプロパティを使用して、失敗するのではなく、サポートされていないデバイスでのテストをスキップすることで、これを行うことができます。

00:04:36.000 --> 00:04:44.000
では、もう一度iPhoneシミュレーターでテストを実行してみましょう。

00:04:44.000 --> 00:04:56.000
完璧。だから今、このテストはポインタインタラクションをサポートしていないデバイスでスキップされます。

00:04:56.000 --> 00:05:05.000
他のプラットフォーム上のデバイス、より具体的にはwatchOSとDigital Crownと対話する新しい方法について話しましょう。

00:05:05.000 --> 00:05:12.000
ご存知かもしれませんが、Xcode 12.5はwatchOSアプリのUIテストサポートを導入しました。

00:05:12.000 --> 00:05:22.000
このサポートには、タッチイベントや、クラウンのクリックなどのハードウェアボタンイベントを合成するために、watchOSで新しく利用可能な方法が含まれています。

00:05:22.000 --> 00:05:29.000
Xcode 13では、デジタルクラウンの回転を合成する新しい方法でこのサポートを拡大しています。

00:05:29.000 --> 00:05:40.000
この方法には、回転数という1つのパラメータのみが必要で、クラウンを回転させる速度を指定するオプションの速度パラメータがあります。

00:05:40.000 --> 00:05:55.000
この速度パラメータにはXCUIGestureVelocityタイプがあります。つまり、低速、高速、デフォルトなどのプリセット値の1つを使用するか、1秒あたりの回転数でカスタム小数点値を指定できます。

00:05:55.000 --> 00:05:59.000
この新しい方法が実際にどのように機能するか見てみましょう。

00:05:59.000 --> 00:06:04.000
外の現在の気温を表示するwatchOS用のシンプルな天気アプリを持っているとします。

00:06:04.000 --> 00:06:16.000
このアプリには、ユーザーがデジタルクラウンを前方にスクロールして将来の予測気温を確認するか、後方にスクロールして過去に記録された気温を確認できる機能があります。

00:06:16.000 --> 00:06:22.000
このクラウン回転機能が期待どおりに動作することを確認する基本的なUIテストを見てみましょう。

00:06:22.000 --> 00:06:30.000
テストは、アプリを起動し、予測時間ラベルが最初に現在の温度と表示されていると主張することから始まります。

00:06:30.000 --> 00:06:38.000
次に、デジタルクラウンを1回前に回転させ、ラベルが「今から1時間後」と更新されたと主張します。

00:06:38.000 --> 00:06:48.000
その後、クラウンを2回回転して後方に回転させ、テストはラベルが「1時間前」と更新されたと主張することで終了します。

00:06:48.000 --> 00:06:52.000
最後に、macOSのトラックパッドについて話しましょう。

00:06:52.000 --> 00:06:55.000
より具体的には、スクロールに焦点を当てましょう。

00:06:55.000 --> 00:07:01.000
スクロールは、離散と連続の2つの異なるカテゴリに分類できます。

00:07:01.000 --> 00:07:05.000
離散スクロールには正確な増分移動があります。

00:07:05.000 --> 00:07:09.000
物理的なマウスでスクロールホイールを回転させることを考えてください。

00:07:09.000 --> 00:07:21.000
画面上のコンテンツは、スクロールホイールのティックごとに均一な単位で移動し、動きは非慣性であり、スクロールホイールの回転を停止するとすぐに動きを停止します。

00:07:21.000 --> 00:07:27.000
一方、連続的または段階的なスクロールは、流動的でダイナミックな動きを持っています。

00:07:27.000 --> 00:07:30.000
トラックパッドで2本指でスワイプする画像。

00:07:30.000 --> 00:07:42.000
画面上のコンテンツはスワイプ中にスムーズにスクロールし、動きは慣性であり、徐々に停止するまで指を持ち上げた後も動き続けます。

00:07:42.000 --> 00:07:51.000
XCTestは現在、macOSでスクロール方式を提供しており、UIテストで個別のピクセル精度のスクロールを実行できます。

00:07:51.000 --> 00:08:01.000
この方法では、スクロールする正確な水平距離と垂直距離をピクセル単位で指定するために2つのパラメータが必要です。

00:08:01.000 --> 00:08:09.000
Xcode 13では、macOSで連続スクロールまたはトラックパッドのようなスクロールを合成するための新しい方法を導入しています。

00:08:09.000 --> 00:08:16.000
これらのメソッドは、スクロールする速度を指定するオプションの速度パラメータを受け入れます。

00:08:16.000 --> 00:08:31.000
この速度パラメータにはXCUIGestureVelocityタイプがあります。つまり、先ほど探索したrotateDigitalCrownメソッドと同様に、プリセットを使用するか、ピクセル/秒でカスタム小数点値を指定できます。

00:08:31.000 --> 00:08:43.000
Xcode 13は、新しい入力方法の自動化を可能にし、より専門的なユースケースをサポートするために、複数のプラットフォームにAPIを導入しています。

00:08:43.000 --> 00:09:00.000
この新しい機能を使用して、iPadアプリでポインタ固有のインタラクションのUIテストを作成し、watchOS UIテストでデジタルクラウン回転を自動化し、新しいスワイプ方法でmacOSで連続的なトラックパッドのようなスクロールを実行します。

00:09:00.000 --> 00:09:05.000
もっと学ぶことに興味がある場合は、これらの関連セッションを必ずチェックしてください。

00:09:05.000 --> 00:09:09.000
WWDCの残りの部分を見て楽しんでくれてありがとう。

00:09:09.000 --> 23:59:59.000
[音楽]。

