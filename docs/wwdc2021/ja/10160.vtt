WEBVTT

00:00:00.000 --> 00:00:05.000
♪ベース音楽の演奏♪

00:00:05.000 --> 00:00:09.000
♪

00:00:09.000 --> 00:00:14.000
デビッド・ヘイワード：こんにちは、私の名前はデビッド・ヘイワードで、コアイメージチームのエンジニアです。

00:00:14.000 --> 00:00:28.000
今日、私の同僚のTuomas Viitanen、Matt Dickoffと私は、ProRAW画像フォーマットについて知る必要があるすべてと、アプリケーションにサポートを追加する方法を示す詳細なプレゼンテーションを行います。

00:00:28.000 --> 00:00:30.000
今日話し合うことは次のとおりです。

00:00:30.000 --> 00:00:34.000
まず、ProRAWファイルを構成するものについて説明します。

00:00:34.000 --> 00:00:45.000
次に、これらのファイルをキャプチャする方法、フォトライブラリに保存する方法、編集して表示する方法について説明します。

00:00:45.000 --> 00:00:48.000
まず、ProRAWとは何ですか? では、

00:00:48.000 --> 00:00:58.000
しばらくの間、Appleデバイスは、当社の画像信号プロセッサを完全に活用して、表示の準備ができている美しいHEICまたはJPEG画像をキャプチャすることができました。

00:00:58.000 --> 00:01:07.000
その後、iOS 10から、バイエルパターンのRAWセンサーデータをキャプチャし、それをDNGファイルに保存することをサポートしました。

00:01:07.000 --> 00:01:16.000
これら2つのアプローチの違いと利点は、「iOS写真の進歩」と題されたWWDC 2016セッションでよく説明されました。

00:01:16.000 --> 00:01:21.000
そのプレゼンテーションでは、2つのフォーマットを説明するために素晴らしいアナロジーを使用しました。

00:01:21.000 --> 00:01:27.000
処理されたHEICまたはJPEGは、パン屋に行って多層ケーキを注文するようなものです。

00:01:27.000 --> 00:01:33.000
一方、バイエルパターンのRAWファイルは、食料品店に行って、ケーキを作るために原材料を手に入れるようなものです。

00:01:33.000 --> 00:01:39.000
処理されたHEICまたはJPEGの利点は、Appleによって焼かれた最終的な画像を得ることです。

00:01:39.000 --> 00:01:49.000
スマートHDR、ディープフュージョン、またはナイトモードを使用して複数のキャプチャフレームを融合して作られているため、表示が速く、素晴らしい品質を持っています。

00:01:49.000 --> 00:01:54.000
また、高度な非可逆圧縮を使用しているため、ファイルサイズが小さいです。

00:01:54.000 --> 00:02:00.000
バイエルRAWの利点は、編集にはるかに大きな柔軟性を持つ画像を得ることです。

00:02:00.000 --> 00:02:05.000
損失圧縮を使用して保存されておらず、より多くの精度を持っています。

00:02:05.000 --> 00:02:12.000
ProRAWの目標は、両方の最高の機能を備えた画像フォーマットを確立することでした。

00:02:12.000 --> 00:02:18.000
ProRAWの利点は、HEICに似た外観ですが、ロスレス圧縮を使用することです。

00:02:18.000 --> 00:02:25.000
また、シーンによっては、複数の露出から融合されるため、編集に最適なダイナミックレンジがあります。

00:02:25.000 --> 00:02:31.000
それらは低ノイズで、すでにデモサイク化されているため、表示が合理的に高速です。

00:02:31.000 --> 00:02:40.000
ProRAWフォーマットは、互換性、品質、外観の3つの特性を最大化するように設計されています。

00:02:40.000 --> 00:02:43.000
これらのそれぞれについてもう少し詳しく話し合いましょう。

00:02:43.000 --> 00:02:50.000
互換性を確保するために、ProRAWファイルは標準のAdobe DNGファイルに含まれています。

00:02:50.000 --> 00:02:59.000
線形化されたDNGファイル形式は、写真などのAppleアプリ、LightroomなどのAdobeアプリ、その他多くのアプリでサポートされています。

00:02:59.000 --> 00:03:05.000
多くのアプリは、システムフレームワーク、ImageIO、およびCore Imageを介して自動的にサポートされます。

00:03:05.000 --> 00:03:10.000
以前のバージョンのiOSとmacOSも、このフォーマットの基本的なサポートを持っています。

00:03:10.000 --> 00:03:17.000
また、ファイルにはフル解像度のJPEG品質のプリレンダリングプレビューを含めることができることも言及する価値があります。

00:03:17.000 --> 00:03:27.000
カメラアプリでキャプチャされたすべてのProRAWには、ProRAWモードが有効になっていない場合に画像と同じように見えるこれらのプレビューが含まれます。

00:03:27.000 --> 00:03:30.000
ProRAWファイルの品質は非常に印象的です。

00:03:30.000 --> 00:03:53.000
DNGのピクセルはシーン参照され、線形化可能であり、画像融合、無損失圧縮12ビットRGBと組み合わせた複数のデモサイク露出から生成される可能性があります。しかし、これらのビットは、最大14ストップのダイナミックレンジを達成できるように、適応コンパディングカーブを介してこれらのビットを作成します。

00:03:53.000 --> 00:04:02.000
結果のファイルサイズは10メガバイトから40メガバイトの範囲ですが、そのサイズは各写真のユニークなシーンに基づいて拡大します。

00:04:02.000 --> 00:04:05.000
Appleは、画像の品質を調整するために多大な努力をしています。

00:04:05.000 --> 00:04:11.000
ProRAW画像は、HEICとJPEGの外観と一致するデフォルトの外観を持っています。

00:04:11.000 --> 00:04:15.000
これは、DNGファイルに特別なタグを埋め込むことによって達成されます。

00:04:15.000 --> 00:04:23.000
これらのタグはDNG仕様に文書化されており、各画像のデフォルトの外観をレンダリングする方法のレシピを提供します。

00:04:23.000 --> 00:04:31.000
最初に適用されるタグは、12ビットの格納されたデータを線形シーン値にデコンバンドするLinearizationTableです。

00:04:31.000 --> 00:04:38.000
ProRAW画像がシーンのダイナミックレンジに適応するため、BaselineExposureタグを使用します。

00:04:38.000 --> 00:04:45.000
BaselineSharpnessタグを使用すると、デフォルトで適用するエッジシャープニングの量を指定できます。

00:04:45.000 --> 00:04:55.000
DNG 1.6仕様の新しいProfileGainTableMapタグを使用すると、明るい領域と影の領域を調整する方法を説明できます。

00:04:55.000 --> 00:05:00.000
最後に、出力グローバルトーンカーブを指定するProfileToneCurveです。

00:05:00.000 --> 00:05:03.000
これらのタグはすべて、各画像に固有のものです。

00:05:03.000 --> 00:05:08.000
彼らはケーキではなくレシピを提供するので、画像は非常に編集可能なままです。

00:05:08.000 --> 00:05:12.000
たとえば、デフォルトのシャープネスやトーンカーブはいつでも変更できます。

00:05:12.000 --> 00:05:21.000
最後に、シーンに存在するとき、私たちは人々、肌、空などの地域のProRAWにセマンティックマスクを保存します。

00:05:21.000 --> 00:05:27.000
ProRAWを構成するものがわかったので、それらをキャプチャする方法を説明するTuomasを紹介したいと思います。

00:05:27.000 --> 00:05:29.000
トゥオマス・ヴィイタネン:ありがとう、デビッド。

00:05:29.000 --> 00:05:31.000
私の名前はトゥオマス・ヴィイタネンです。

00:05:31.000 --> 00:05:38.000
私はカメラソフトウェアチームのエンジニアで、アプリケーションでApple ProRAWをキャプチャする方法をご案内します。

00:05:38.000 --> 00:05:43.000
AVFoundation Capture APIは、iOSとMacOSのカメラへのアクセスを提供します。

00:05:43.000 --> 00:05:49.000
ライブプレビューやビデオをストリーミングしたり、写真をキャプチャしたり、映画を録画したりできます。

00:05:49.000 --> 00:05:55.000
そして、最近の追加として、新しいApple ProRAW DNG形式で写真をキャプチャするサポートを追加しました。

00:05:55.000 --> 00:06:12.000
AVFoundation Capture APIの基本的な使用に関する優れた情報源は、WWDC 2016のiOS写真トークの進歩であり、AVCapture写真出力の使用方法と、シンプルなカメラキャプチャアプリケーションの例であるAVCamサンプルコードについて説明します。

00:06:12.000 --> 00:06:16.000
次に、Apple ProRAWのキャプチャを詳しく見ていきます。

00:06:16.000 --> 00:06:21.000
しかし、まず、Apple ProRAWがサポートされている場所を簡単に見てみましょう。

00:06:21.000 --> 00:06:26.000
その良い出発点は、既存のバイエルRAWサポートと比較することです。

00:06:26.000 --> 00:06:31.000
Bayer RAWはiOS 10で導入され、幅広いデバイスでサポートされています。

00:06:31.000 --> 00:06:40.000
Apple ProRAWはiOS 14.3で導入され、iPhone 12 ProとiPhone 12 Pro Maxでサポートされています。

00:06:40.000 --> 00:06:47.000
Apple独自のカメラアプリケーションは、ディープフュージョンやナイトモードなどのすべてのフュージョンキャプチャとフラッシュキャプチャでApple ProRAWキャプチャをサポートしています。

00:06:47.000 --> 00:06:58.000
Apple ProRAWでは、写真品質の優先順位を.balancedと.qualityに設定できるため、RAWキャプチャにApple画像フュージョンの恩恵を受けることができます。

00:06:58.000 --> 00:07:04.000
バイエルRAWは、ワイドやテレなどのシングルカメラAVCaptureDevicesでのみサポートされています。

00:07:04.000 --> 00:07:13.000
Apple ProRAWは、ズーム時にカメラ間をシームレスに切り替えるデュアルワイド、デュアル、トリプルカメラデバイスを含むすべてのデバイスでサポートされています。

00:07:13.000 --> 00:07:21.000
Bayer RAWと同様に、Apple ProRAWは深度データ配信やコンテンツ認識の歪み補正をサポートしていません。

00:07:21.000 --> 00:07:31.000
ライブフォトキャプチャはバイエルRAWでのみサポートされていますが、ポートレートエフェクトマットとセマンティックセグメンテーションスキンとスカイマットはProRAWでのみサポートされています。

00:07:31.000 --> 00:07:35.000
では、Apple ProRAWをキャプチャする方法を見てみましょう。

00:07:35.000 --> 00:07:49.000
私たちが取り上げる項目は、キャプチャデバイスとキャプチャセッションの設定方法、写真出力の設定方法、ProRAWキャプチャ用の写真設定の準備方法、およびProRAW写真をキャプチャした後のオプションです。

00:07:49.000 --> 00:07:53.000
セッションの設定から始めましょう。

00:07:53.000 --> 00:07:58.000
Apple ProRAWは、最高品質の写真をサポートするフォーマットでのみサポートされています。

00:07:58.000 --> 00:08:02.000
キャプチャsessionPresetを.photoに設定することで、それを取得します。

00:08:02.000 --> 00:08:09.000
または、デバイスのフォーマットを手動で選択したい場合は、最高品質の静止画をサポートするフォーマットを見つけることができます。

00:08:09.000 --> 00:08:15.000
これは、より幅広いフォーマットでサポートされている高品質の静止画とは異なることに注意してください。

00:08:15.000 --> 00:08:21.000
そして、目的のフォーマットをデバイスのactiveFormatに設定するだけです。

00:08:21.000 --> 00:08:32.000
この例以降では、サポートされている項目のリストから最初のインデックスを使用していますが、これをアプリケーションに最適な基準に基づく選択に置き換える必要があります。

00:08:32.000 --> 00:08:37.000
では、ProRAWキャプチャの写真出力を設定する方法を見てみましょう。

00:08:37.000 --> 00:08:41.000
まず、photoOutputでProRAWを有効にする必要があります。

00:08:41.000 --> 00:08:48.000
セッションを開始する前に必ず実行してください。そうしないと、パイプラインの再構成が長くなるからです。

00:08:48.000 --> 00:08:58.000
このプロパティをtrueに設定すると、ProRAWキャプチャ用のキャプチャパイプラインが準備され、サポートされているRAWフォトピクセルフォーマットタイプのリストにProRAWピクセルフォーマットが追加されます。

00:08:58.000 --> 00:09:07.000
必要に応じて、キャプチャのスピードや品質を好むかどうか、または2つのバランスを好むかどうかをキャプチャパイプラインに示すこともできます。

00:09:07.000 --> 00:09:17.000
キャプチャされた写真に対する写真品質の優先順位付けの効果に関する詳細情報は、ビデオフォーマットトークを使用して高品質の写真をキャプチャすることから見つけることができます。

00:09:17.000 --> 00:09:20.000
そして次に、キャプチャの準備方法を見ていきます。

00:09:20.000 --> 00:09:26.000
ProRAWキャプチャの写真設定を作成できるようにするには、正しいRAWピクセルフォーマットを選択する必要があります。

00:09:26.000 --> 00:09:35.000
サポートされているバイエルRAWフォーマットを提供する同じ利用可能なRawPhoto PixelFormatTypesから、サポートされているRAWピクセルフォーマットを取得します。

00:09:35.000 --> 00:09:44.000
photoOutputの新しいisAppleProRAWPixelFormatクラスメソッドを使用して、ProRAWフォーマットとBayerRAWフォーマットを区別できます。

00:09:44.000 --> 00:09:52.000
ProRAWピクセルフォーマットの例は、16ビットフルレンジRGBAピクセルフォーマットであるl64rです。

00:09:52.000 --> 00:09:59.000
参考までに、isBayerRAWPixelFormatクラスメソッドを使用して、フォーマットがバイエルRAWフォーマットであるかどうかを照会することもできます。

00:09:59.000 --> 00:10:08.000
次に、Apple ProRAWをキャプチャするためのオプションのいくつかと、オプションとして、それと一緒に完全にレンダリングされたプロセス写真について説明します。

00:10:08.000 --> 00:10:13.000
ProRAWをキャプチャする最初で最も簡単なオプションは、ProRAW写真のみをリクエストすることです。

00:10:13.000 --> 00:10:19.000
これを行うには、photoSettingsの作成時にrawPixelFormatTypeを指定するだけです。

00:10:19.000 --> 00:10:25.000
これにより、マットが後で表示するように、作業が簡単でフォトライブラリに保存できる単一のアセットが提供されます。

00:10:25.000 --> 00:10:36.000
また、写真設定の処理されたフォーマットも提供することで、バイエルRAWでできることと同様に、処理された写真とProRAWのペアをキャプチャすることもできます。

00:10:36.000 --> 00:10:42.000
しかし、これには複数のアセットで作業する必要があり、フォトライブラリでそれらを追跡することも難しくなります。

00:10:42.000 --> 00:10:52.000
幸いなことに、Apple ProRAWは最大フル解像度のJPEG画像をサムネイルとしてサポートしており、多くの場合、これは前の2つのオプションの中で最高のものを提供します。

00:10:52.000 --> 00:11:01.000
サムネイルをリクエストするには、availableRawEmbedded ThumbnailPhotoCodecTypesから目的の形式を選択し、目的のサムネイルの寸法を指定できます。

00:11:01.000 --> 00:11:05.000
これで、ProRAWの写真を撮影する準備が整いました。

00:11:05.000 --> 00:11:11.000
しかし、その前に、必要に応じて、このキャプチャの写真品質の優先順位を指定できます。

00:11:11.000 --> 00:11:20.000
ここで指定する値は、photoOutputで以前に指定したmaxPhotoQualityPrioritization以下でなければならないことに注意してください。

00:11:20.000 --> 00:11:29.000
キャプチャ後すぐにクライアントに表示するものをご希望の場合は、ディスプレイサイズのプレビュー画像までリクエストすることもできます。

00:11:29.000 --> 00:11:36.000
そして、他のすべての静止画にも使用されているのと同じcapturePhotoメソッドを使用して、ProRAW写真をキャプチャできます。

00:11:36.000 --> 00:11:44.000
静止画の撮影が近づいているので、要求された写真の準備ができたら何ができるかを見てみましょう。

00:11:44.000 --> 00:11:53.000
写真が完全に処理されると、didFinishProcessingPhotoデリゲートは、ProRAW写真を表すAVCapturePhotoで呼び出されます。

00:11:53.000 --> 00:12:03.000
キャプチャ用のプレビュー画像をリクエストした場合、非圧縮プレビュー画像付きのピクセルバッファ、またはそのCGImageRepresentationをディスプレイに表示できるようになりました。

00:12:03.000 --> 00:12:11.000
また、ProRAWと一緒に処理された写真をリクエストした場合、didFinishProcessingPhotoデリゲートが2回呼び出されます。

00:12:11.000 --> 00:12:18.000
受信したAVCapturePhotoのisRawPhotoプロパティを使用して、ProRAWと処理された写真と区別できます。

00:12:18.000 --> 00:12:26.000
そして、ProRAWのfileDataRepresentationをリクエストするだけで、DNGをフォトライブラリに保存できます。

00:12:26.000 --> 00:12:32.000
または、オプションで作業したい場合は、RAWピクセルデータを含むピクセルバッファを取得します。

00:12:32.000 --> 00:12:38.000
Davidが先に述べたように、ProRAW DNGにはセマンティックセグメンテーションマットが含まれる場合があります。

00:12:38.000 --> 00:12:42.000
これらのマットを含めることは自動で、シーンに依存します。

00:12:42.000 --> 00:12:51.000
マットは現在、AVFoundation Capture APIでは利用できませんが、Davidが後で表示するように、Core ImageとImageIO APIで取得できます。

00:12:51.000 --> 00:12:56.000
そして最後に、ProRAW DNGで持っているいくつかのカスタマイズオプションを見ていきます。

00:12:56.000 --> 00:13:03.000
AVCapturePhotoFileData RepresentationCustomizerデリゲートメソッドを実装することで、ProRAWをカスタマイズできます。

00:13:03.000 --> 00:13:13.000
replacementAppleProRAW CompressionSettingsを実装することで、ProRAW写真の圧縮ビットの深さと品質を変更できます。

00:13:13.000 --> 00:13:18.000
Apple ProRAWは、コンバンディングカーブ付きの12ビットを使用して、デフォルトでロスレスにエンコードされています。

00:13:18.000 --> 00:13:28.000
品質レベルを1に保ち、カスタマイザーで目的のビット深度を提供することで、無損失圧縮ProRAWのビット深度を変更できます。

00:13:28.000 --> 00:13:32.000
これにより、ストレージスペースが節約されますが、ProRAW写真の高品質を維持します。

00:13:32.000 --> 00:13:42.000
非可逆圧縮を好む場合は、品質レベルを1以下に設定できます。その場合、ProRAWは8ビット非可逆圧縮を使用して自動的に圧縮されます。

00:13:42.000 --> 00:13:47.000
これにより、ファイルサイズが小さくなりますが、ProRAW写真の品質に明確な影響を与えます。

00:13:47.000 --> 00:13:56.000
カスタマイザーを実装したので、didFinishProcessingPhotoデリゲートでキャプチャされたProRAW DNGのカスタマイズをリクエストできます。

00:13:56.000 --> 00:14:05.000
カスタマイザーを作成し、それをfileDataRepresentationに提供することで、先ほど提供した圧縮設定でカスタマイズされたProRAWを取り戻すことができます。

00:14:05.000 --> 00:14:10.000
これは、AVFoundation Capture APIを使用したApple ProRAWキャプチャの紹介でした。

00:14:10.000 --> 00:14:15.000
Apple ProRAWとフォトライブラリについてもっと教えてくれるマットに渡します。

00:14:15.000 --> 00:14:16.000
マット？

00:14:16.000 --> 00:14:18.000
マット・ディコフ:ありがとう、トゥオマス!こんにちは！

00:14:18.000 --> 00:14:21.000
私の名前はマット・ディコフで、写真チームのエンジニアです。

00:14:21.000 --> 00:14:26.000
キャプチャしたばかりのProRAWファイルをフォトライブラリの完全なアセットとして最初に保存する方法を説明します。

00:14:26.000 --> 00:14:31.000
次に、フォトライブラリにすでに存在するRAWを取得する方法を順を追って説明します。

00:14:31.000 --> 00:14:36.000
PhotoKitは、Appleプラットフォーム上のフォトライブラリと対話するために使用されるフレームワークのペアです。

00:14:36.000 --> 00:14:41.000
これらのリリースで最初に導入され、それ以来、改善と追加が行われています。

00:14:41.000 --> 00:14:45.000
特に、Apple ProRAWのようなRAW画像フォーマットをサポートしています。

00:14:45.000 --> 00:14:50.000
今日は、フォトライブラリのRAWを扱う特定のAPIのみを取り上げます。

00:14:50.000 --> 00:14:57.000
このプレゼンテーションの後もPhotoKitについてまだ質問がある場合は、オンライン開発者ドキュメントを見ることをお勧めします。

00:14:57.000 --> 00:15:02.000
新しいアセットを保存するには、共有されたPHPhotoLibraryで変更を実行する必要があります。

00:15:02.000 --> 00:15:13.000
アセットの保存と同様に、変更はPHAssetCreationRequestであり、Apple ProRAWファイルをプライマリ.photo PHAssetResourceとしてこのアセットに追加します。

00:15:13.000 --> 00:15:16.000
では、そのコードがどのように見えるか見てみましょう。

00:15:16.000 --> 00:15:21.000
まず、共有フォトライブラリに変更を加えることから始めます。

00:15:21.000 --> 00:15:28.000
PHAssetCreationRequestを作成し、Apple ProRAWファイルを主要な写真リソースとして追加するだけです。

00:15:28.000 --> 00:15:30.000
そして、それだけです!

00:15:30.000 --> 00:15:33.000
アプリケーションが適切だと思うように、成功とエラーを処理するだけです。

00:15:33.000 --> 00:15:42.000
フォトライブラリにアセットを追加する方法がわかったので、ユーザーがすでにライブラリに持っている可能性のあるRAWアセットを含め、それらを取り戻す方法を見てみましょう。

00:15:42.000 --> 00:15:50.000
iOS 15では、新しいPHAssetCollectionSubtype、.smartAlbumRAWを提供したことを嬉しく思います。

00:15:50.000 --> 00:15:56.000
このスマートアルバムを使用すると、RAWリソースを持つフォトライブラリ内のすべてのアセットを含むコレクションを簡単に取得できます。

00:15:56.000 --> 00:16:00.000
このアルバムは、Apple Photosアプリで見られるのと同じRAWアルバムです。

00:16:00.000 --> 00:16:08.000
RAWリソースを持つPHAssetsがいくつかあるので、実際にそれらのリソースを得るために何が必要かを見てみましょう。

00:16:08.000 --> 00:16:12.000
まず、PHAssetのすべてのPHAssetResourcesを取得したいと思います。

00:16:12.000 --> 00:16:19.000
次に、以前に話した.photoと、さらに.alternatePhotoの2種類のリソースを探します。

00:16:19.000 --> 00:16:23.000
少し時間を取って、.alternatePhotoとは何かを説明したいと思います。

00:16:23.000 --> 00:16:30.000
一部のフォトライブラリには、一部のデジタル一眼レフカメラが使用する古いRAWとJPEGストレージモデルに従ったアセットが含まれています。

00:16:30.000 --> 00:16:39.000
これには、RAWとJPEGを2つの異なるリソースとして保存する必要があります。JPEGを写真として、RAWを代替写真として保存します。

00:16:39.000 --> 00:16:46.000
これにより、フォトライブラリのファイルフットプリントが増加し、移植性が低下し、しばしば混乱するユーザーエクスペリエンスにつながります。

00:16:46.000 --> 00:16:48.000
このモデルはApple ProRAWにはお勧めできません。

00:16:48.000 --> 00:16:57.000
ProRAWファイルをフォトライブラリに保存する場合は、キャプチャ設定を使用して、フルサイズのJPEGプレビューをファイルに埋め込む必要があります。

00:16:57.000 --> 00:16:59.000
さて、私たちのリソースに戻ります。

00:16:59.000 --> 00:17:06.000
リソースのuniformTypeIdentifierをチェックして、関心のあるRAWタイプに準拠しているかどうかを確認します。

00:17:06.000 --> 00:17:13.000
そして最後に、RAWリソースを取得したら、PHAssetResourceManagerを使用して実際のデータを取得します。

00:17:13.000 --> 00:17:16.000
では、それをコードで見てみましょう。

00:17:16.000 --> 00:17:34.000
まず、アセット上のすべてのPHAssetResourcesを反復し、.photoまたは.alternatePhotoタイプを探し、それらがRAW画像UTTypeに準拠していることを確認し、最後にPHAssetResourceManagerを使用してそのリソースのデータを要求します。

00:17:34.000 --> 00:17:35.000
そして、それだけです!

00:17:35.000 --> 00:17:41.000
これで、PhotoKitを使用して、フォトライブラリからRAWリソースを使用してアセットを保存および取得する方法がわかります。

00:17:41.000 --> 00:17:47.000
今、私はそれをDavidに返します。Davidは、Apple ProRAW画像を編集して表示する最善の方法について話します。

00:17:47.000 --> 00:17:48.000
デビッド:ありがとう、マット。

00:17:48.000 --> 00:17:56.000
今日の講演の最後のセクションでは、Core Imageフレームワークを使用してProRAW画像を編集および表示する方法について説明します。

00:17:56.000 --> 00:18:23.000
ProRAWファイルからCIImagesを作成する方法、最も一般的なユーザー調整を適用する方法、線形のシーン参照値を取得するためにデフォルトの外観をオフにする方法、HEICなどの出力参照形式に編集をレンダリングする方法、最後に、拡張ダイナミックレンジディスプレイでMacにProRAWを表示する方法について説明します。

00:18:23.000 --> 00:18:34.000
CGImageSourceCreateWithURLとCGImageSourceCreate ThumbnailAtIndex APIを使用して、ProRAWからプレビュー画像を取得できます。

00:18:34.000 --> 00:18:41.000
iOS 15とmacOS 12の新機能、Core Imageはプレビューにアクセスするための新しい便利なAPIを追加しました。

00:18:41.000 --> 00:18:52.000
人、肌、空などのセマンティックセグメンテーションマットの取得は、CIImageを初期化するときに目的のオプションキーを渡すことでサポートされます。

00:18:52.000 --> 00:18:59.000
これも、オプションのマット画像にアクセスするための新しくて便利なAPIを備えています。

00:18:59.000 --> 00:19:05.000
最も重要なことは、アプリケーションがプライマリProRAWイメージを取得したいと思うことです。

00:19:05.000 --> 00:19:14.000
アプリケーションがデフォルトのレンダリングの外観を表示したいだけなら、URLまたはデータから不変のCIImageを作成するだけです。

00:19:14.000 --> 00:19:22.000
ただし、アプリケーションがProRAWの完全な編集可能性のロックを解除したい場合は、URLからCIFilterを作成します。

00:19:22.000 --> 00:19:29.000
そのフィルタにoutputImageを尋ねるだけで、デフォルトの外観のCIImageが表示されます。

00:19:29.000 --> 00:19:34.000
このAPIの主な利点は、フィルターを簡単に変更できることです。

00:19:34.000 --> 00:19:41.000
RAW CIFilterには、アプリケーションが新しいoutputImageを生成するために変更できるいくつかの入力があります。

00:19:41.000 --> 00:19:47.000
基本的なコードパターンは、文書化されたキー文字列の1つに値オブジェクトを設定することです。

00:19:47.000 --> 00:19:52.000
しかし、このsetValue forKey APIは更新される予定でした。

00:19:52.000 --> 00:19:59.000
iOS 15とmacOS 12では、より見つけやすく、Swiftに優しいAPIを作成しました。

00:19:59.000 --> 00:20:07.000
新しいAPIを使用するには、CIRAWFilterインスタンスを作成し、目的のプロパティを新しい値に設定するだけです。

00:20:07.000 --> 00:20:12.000
次に、変更したいプロパティについて話し合いましょう。

00:20:12.000 --> 00:20:17.000
ProRAW画像のダイナミックレンジを考えると、提供すべき最も重要なコントロールの1つは露出です。

00:20:17.000 --> 00:20:20.000
この値を任意の浮動小数点数に設定できます。

00:20:20.000 --> 00:20:28.000
たとえば、正の1に設定して画像を2倍明るくするか、負の1に設定して半分明るくします。

00:20:28.000 --> 00:20:35.000
ProRAWは直線的なシーン参照空間で編集されるため、画像のホワイトバランスを調整する方が効果的です。

00:20:35.000 --> 00:20:43.000
シーンニュートラルは、ケルビン度の温度として、またはx/y色度座標として指定できます。

00:20:43.000 --> 00:20:50.000
ProRAWルックのデフォルトのシャープネスは、0から1までの任意の値に調整できます。

00:20:50.000 --> 00:20:56.000
また、ProRAWローカルトーンマップの強さは、0から1までの任意の値に調整できます。

00:20:56.000 --> 00:21:02.000
ローカルトーンマップを使用すると、画像の各領域に独自の最適化されたトーンカーブを持つことができます。

00:21:02.000 --> 00:21:08.000
これは、ローカルトーンマップの強度が完全にオフになっているProRAW画像の例です...

00:21:08.000 --> 00:21:10.000
そして半分の強さで...

00:21:10.000 --> 00:21:12.000
そして完全にオン。

00:21:12.000 --> 00:21:23.000
この画像では、ローカルトーンカーブが暗い領域を上げ、明るい領域を下げて、標準ダイナミックレンジディスプレイで可能な限り最高の結果を表示します。

00:21:23.000 --> 00:21:30.000
次に、アプリケーションが14ストップの線形シーン参照データに直接アクセスする方法について話し合いましょう。

00:21:30.000 --> 00:21:39.000
ほとんどのユーザーは、先に説明した一般的な調整を好むでしょうが、線形データへのアクセスは、特定のアプリケーションのケースに非常に役立ちます。

00:21:39.000 --> 00:21:46.000
リニア画像を取得するには、画像にデフォルトの外観を適用するフィルター入力をオフにするだけです。

00:21:46.000 --> 00:21:57.000
baselineExposure、exposoBias、boost、およびlocalToneMapAmountを0に設定し、outputImageを取得する前に色域マッピングを無効にします。

00:21:57.000 --> 00:22:05.000
linearRAWImageを取得したら、それを他のコアイメージフィルターへの入力として使用して、シーン参照計算を実行できます。

00:22:05.000 --> 00:22:12.000
たとえば、組み込みのコアイメージヒストグラムフィルタを使用して統計を計算できます。

00:22:12.000 --> 00:22:16.000
または、線形画像をレンダリングしてピクセルデータを取得することもできます。

00:22:16.000 --> 00:22:35.000
これを行うには、RGBAハーフフロート可変データのCIRenderDestinationを作成し、選択した線形colorSpaceを使用するようにレンダリング先に指示し、CIContextにrawFilterの出力画像をレンダリングするタスクを開始します。

00:22:35.000 --> 00:22:42.000
以下は、キャプチャされた線形シーン参照画像と比較して、デフォルトの外観を持つProRAWの例です。

00:22:42.000 --> 00:22:51.000
線形画像は平らで露出不足に見えますが、シーンからの完全でクリップされていない14ストップのデータが含まれています。

00:22:51.000 --> 00:23:00.000
この画像のペアは、出力参照画像とシーン参照画像の違いの良い例示も提供します。

00:23:00.000 --> 00:23:07.000
出力参照のデフォルトの外観では、最大ルミナンスを持つ画像の領域は左側の日没にあります。

00:23:07.000 --> 00:23:13.000
しかし、右側のこの空の領域には、夕日の80%の明るいルミナンスがあります。

00:23:13.000 --> 00:23:20.000
デフォルトの画像は素晴らしく見えますが、ルミナンス値はシーンの現実を表すものではありません。

00:23:20.000 --> 00:23:31.000
線形シーン参照画像の場合、画像の右側の空は、日没の輝きのわずか12%の最大輝度を持ち、より物理的に論理的です。

00:23:31.000 --> 00:23:36.000
これが、線形シーン参照画像が画像処理と分析にとって非常に重要である理由です。

00:23:36.000 --> 00:23:48.000
アプリケーションがProRAW CIFilterプロパティを変更した後、画像をHEICやJPEGなどの出力参照形式に保存することができます。

00:23:48.000 --> 00:23:54.000
以下は、rawFilter出力画像を8ビットのディープHEICファイルに保存する方法の例です。

00:23:54.000 --> 00:24:01.000
このAPIでは、使用する出力colorSpaceを指定できますが、displayP3をお勧めします。

00:24:01.000 --> 00:24:07.000
オプション辞書を使用して、セマンティックマスクをHEICに保存することもできます。

00:24:07.000 --> 00:24:17.000
また、ProRAWには余分な精度があるため、この新しいCore Image APIを使用して10ビットの深いHEICファイルに保存することを検討するかもしれません。

00:24:17.000 --> 00:24:25.000
これまでのところ、私が説明したすべての調整は、トーンマップされ、標準ダイナミックレンジに色域マップされた出力画像を生成します。

00:24:25.000 --> 00:24:28.000
これは一般的に「SDR」と略されます。

00:24:28.000 --> 00:24:38.000
私が議論したい次のトピックは、拡張ダイナミックレンジディスプレイでProRAW画像のダイナミックレンジを完全な栄光で提示する方法です。

00:24:38.000 --> 00:24:48.000
MacBook ProからiMac、Pro Display XDRまで、多くのMacディスプレイは、MetalKit Viewを使用してEDRコンテンツを表示できます。

00:24:48.000 --> 00:24:55.000
ProRAW CIImageを表示するには、最高のパフォーマンスを得るためにMetalKit Viewサブクラスを使用することをお勧めします。

00:24:55.000 --> 00:25:02.000
MetalKit Viewサブクラスは、ビューのCIContextとMTLCommandQueueを作成する必要があります。

00:25:02.000 --> 00:25:11.000
MetalKit ViewでCore Imageで最高のパフォーマンスを得る方法に関する重要な詳細については、このテーマに関する昨年のプレゼンテーションを確認してください。

00:25:11.000 --> 00:25:23.000
MacディスプレイがEDRをサポートしている場合は、ビューのcolorPixelFormatをrgba16Floatに設定し、 wantsExtendedDynamic RangeContentをtrueに設定できます。

00:25:23.000 --> 00:25:35.000
次に、ビューサブクラスを描画するときは、rawFilter.extended DynamicRangeAmountを1に設定し、Core ImageコンテキストにoutputImageをレンダリングするタスクを開始するように指示します。

00:25:35.000 --> 00:25:42.000
EDRディスプレイでProRAW画像を見ることは、完全に理解するために実際に見る必要があるものです。

00:25:42.000 --> 00:25:45.000
しかし、それがどのように見えるかを概算してみます。

00:25:45.000 --> 00:25:55.000
ここでは、SDR画像が表示されますが、これは同じProRAWファイルがEDRでどのように感じるかを示しています。

00:25:55.000 --> 00:26:03.000
明るい領域と鏡面ハイライトは、トーンマッピングによって制限されなくなったため、完全な栄光で表示されます。

00:26:03.000 --> 00:26:07.000
これでApple ProRAWに関するプレゼンテーションは終了です。

00:26:07.000 --> 00:26:16.000
今日は、ファイル形式のデザインと内容、およびこれらの画像をキャプチャ、保存、編集する方法について詳しく説明しました。

00:26:16.000 --> 00:26:21.000
あなたのアプリケーションがこれらの画像の可能性を最大限に引き出す方法を楽しみにしています。

00:26:21.000 --> 23:59:59.000
♪

