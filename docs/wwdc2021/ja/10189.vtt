WEBVTT

00:00:00.000 --> 00:00:05.000
♪ベース音楽の演奏♪

00:00:05.000 --> 00:00:09.000
♪

00:00:09.000 --> 00:00:11.000
ジャー・ノーブル:こんにちは、私はジャーです!

00:00:11.000 --> 00:00:15.000
そして、私はここAppleでWebKitとSafariでメディア再生に取り組んでいます。

00:00:15.000 --> 00:00:24.000
人々は、同じ部屋にいる人でも、隣にいる人でも、世界の反対側にいる人でも、お気に入りの番組や映画を見たり、一緒に音楽を聴くのが大好きです。

00:00:24.000 --> 00:00:32.000
そして今、GroupActivitiesを使用すると、どこにいてもユーザーにSharePlay体験を提供することがこれまで以上に簡単になりました。

00:00:32.000 --> 00:00:35.000
このセッションでは、4つのトピックを取り上げます。

00:00:35.000 --> 00:00:55.000
Safariでの調整された再生の紹介、SafariでSharePlayで動作するようにiOSアプリを準備する方法、アプリのWebページでメディアセッションAPIを採用する方法、および複数のデバイス間で再生を調整するための新しいWeb API。

00:00:55.000 --> 00:01:00.000
では、SharePlayとSafariについて少し話すことから始めましょう。

00:01:00.000 --> 00:01:09.000
前のセッションでは、GroupActivitiesを使用してiPhoneとiPadアプリケーションで素晴らしいSharePlayエクスペリエンスを作成する方法を学びました。

00:01:09.000 --> 00:01:18.000
そして、macOS Montereyでは、Catalystを使用して、素晴らしいiPhoneやiPadアプリと一緒に、同じ体験をMacにもたらすことができます。

00:01:18.000 --> 00:01:29.000
また、アプリケーションにコンパニオンWebサイトがある場合は、ユーザーがApp Storeからアプリをダウンロードすることなく、Mac Safari 15ユーザーに同じ素晴らしいSharePlay体験をもたらすことができます。

00:01:29.000 --> 00:01:33.000
そして、それは私がこのセッションで行う方法をあなたに示すものです。

00:01:33.000 --> 00:01:36.000
私は映画の予告編を見ることができるiPhoneアプリケーションに取り組んできました。

00:01:36.000 --> 00:01:43.000
私はすでに私のアプリにGroupActivitiesのサポートを追加しました。これにより、友人はFaceTimeで一緒に映画の予告編を見ることができます。

00:01:43.000 --> 00:01:46.000
しかし、私の映画の予告編アプリにもウェブサイトがあります。

00:01:46.000 --> 00:01:53.000
そして、そのウェブページでGroupActivitiesのサポートを追加すると、どのように見えるかがここにあります。

00:01:53.000 --> 00:01:55.000
友達のサムとFaceTime通話中です。

00:01:55.000 --> 00:02:00.000
サムは映画の予告編を見るのが大好きなので、私は彼らにこの新しい映画予告編アプリをテストするのを手伝ってくれるように頼みました。

00:02:00.000 --> 00:02:09.000
彼らが私たちの通話中にそのアプリで新しい予告編を再生し始めると、私は通知を通してその予告編を見るために招待されます。

00:02:09.000 --> 00:02:12.000
Safariでセッションに参加するオプションが表示されます。

00:02:12.000 --> 00:02:23.000
その通知をクリックすると、Safariは共有コンテンツのURLで起動し、Samが予告編の再生を開始すると、同時にSafariで再生されます。

00:02:23.000 --> 00:02:33.000
Safariでビデオを一時停止、再生、検索することさえでき、セッションの他の全員が同じコマンドがローカルビデオに反映されているのを同時に見ることができます。

00:02:33.000 --> 00:02:35.000
それは本当に素晴らしいものになるでしょう!

00:02:35.000 --> 00:02:40.000
では、映画予告編のウェブサイトにGroupActivitiesのサポートを追加するには何が必要ですか?

00:02:40.000 --> 00:02:50.000
Safariのボンネットの下を見る前に、Safari 15で利用可能な新しいWeb APIで、GroupActivitiesを通じてSafariで動作するようにアプリを準備する方法について話しましょう。

00:02:50.000 --> 00:03:02.000
SafariでGroupActivitiesセッションに参加するには、iPhoneまたはiPadアプリを持つユーザーは、Webサイトを指すfallbackURLでGroupSessionActivityを作成する必要があります。

00:03:02.000 --> 00:03:08.000
fallbackURLは、あなたのウェブサイトだけでなく、再生する特定のコンテンツを識別する必要があります。

00:03:08.000 --> 00:03:20.000
iPhoneユーザーからMacのユーザーにWatch Togetherの招待状が発行されると、Safariが起動され、GroupSessionActivityで提供したURLを読み込むように求められます。

00:03:20.000 --> 00:03:27.000
フォールバックURLがSafariに読み込まれると、サイトはいくつかのシンプルだが重要なWeb APIを実装する必要があります。

00:03:27.000 --> 00:03:29.000
1つ目はメディアセッションです。

00:03:29.000 --> 00:03:39.000
メディアセッションは、サイトがブラウザ（Safari）にページ内のメディア再生の現在の状態について詳しく伝えることを可能にする標準的なWeb APIです。

00:03:39.000 --> 00:03:43.000
サイトは、現在の再生状態、コンテンツの継続時間をブラウザに伝えることができます。

00:03:43.000 --> 00:03:46.000
現在の再生アイテムのアートワークを提供できます。

00:03:46.000 --> 00:03:52.000
現在のコンテンツがスキップできる広告であることをブラウザに伝えることさえできます。

00:03:52.000 --> 00:04:02.000
ブラウザがこのメタデータをすべて利用できるようにすると、そのメタデータをオペレーティングシステムの残りの部分に提供し、ブラウザウィンドウ自体の外でユーザーに提示することができます。

00:04:02.000 --> 00:04:07.000
オペレーティングシステムが、データが「再生中」と呼ばれるものの中にあると表示する1つの場所。

00:04:07.000 --> 00:04:13.000
Now Playingは、ユーザーが今楽しんでいるメディアをすばやく見てコントロールするための素晴らしい方法です。

00:04:13.000 --> 00:04:19.000
iOSでは、ユーザーはコントロールセンターとロック画面から「再生中」にアクセスできます。

00:04:19.000 --> 00:04:25.000
そして、macOS Montereyでは、ユーザーはメニューバーから直接「再生中」にアクセスできます。

00:04:25.000 --> 00:04:35.000
また、Safariはメディアセッションを通じて提供された情報を使用して、コンテンツのタイトル、期間、再生状態、アートワークなどを「再生中」に入力します。

00:04:35.000 --> 00:04:43.000
Now Playingでは、ユーザーに簡単な再生コントロールセットを表示することで、ユーザーが聴いているものの再生を制御することもできます。

00:04:43.000 --> 00:04:58.000
サイトは、ユーザーが「再生中」と対話したときに実行する特定のアクションをメディアセッションに登録できます。たとえば、ユーザーが「再生中」の「再生」ボタンをタップすると、Safariはサイト独自のアクションハンドラを実行して再生を開始できます。

00:04:58.000 --> 00:05:08.000
メディアセッションでは、サイトがブラウザに公開するメタデータを完全に制御し、再生コマンドの実装方法も制御できます。

00:05:08.000 --> 00:05:11.000
再生を開始する前に、いくつかのセットアップやプリフライトを行う必要がありますか?

00:05:11.000 --> 00:05:12.000
問題ありません。

00:05:12.000 --> 00:05:16.000
mediaSessionのプレイアクションハンドラーで、今、あなたはできます。

00:05:16.000 --> 00:05:21.000
サイトが以前にメディアセッションを採用している場合は、すでに半分完了しています。

00:05:21.000 --> 00:05:27.000
しかし、映画の予告編サイトはまだメディアセッションを採用していないので、今そのサポートを追加しましょう。

00:05:27.000 --> 00:05:32.000
このサイトでは、プレイ、一時停止、シークトのアクションを追加したいと考えています。

00:05:32.000 --> 00:05:38.000
そのためには、ナビゲーターのmediaSessionプロパティを使用します。

00:05:38.000 --> 00:05:41.000
まず、プレイ用のアクションハンドラーを追加しましょう。

00:05:41.000 --> 00:05:50.000
mediaSession. setActionHandler() を呼び出し、文字列再生と、ビデオ要素で play() を呼び出すインライン関数を渡します。

00:05:50.000 --> 00:05:56.000
次に、一時停止とシークにも同じことをします。

00:05:56.000 --> 00:06:07.000
また、ブラウザに再生状態を正確に表現していることを確認するために、ビデオ要素にイベントリスナーを追加し、その状態が変更されたときにmediaSessionを更新します。

00:06:07.000 --> 00:06:11.000
まず、updateMediaSessionState()という関数を追加しましょう。

00:06:11.000 --> 00:06:16.000
ビデオ要素を照会して、再生中か一時停止中かを調べます。

00:06:16.000 --> 00:06:26.000
次に、ビデオ要素の再生状態に応じて、mediaSessionのplaybackStateプロパティを文字列の再生または一時停止のいずれかに設定します。

00:06:26.000 --> 00:06:31.000
次に、ビデオ要素の持続時間、再生速度、および現在の時刻を照会します。

00:06:31.000 --> 00:06:41.000
次に、これらの値を使用して、mediaSessionのsetPositionState()関数を呼び出し、それらの値を辞書パラメータに渡します。

00:06:41.000 --> 00:06:50.000
次に、イベントリスナーを追加して、それらの値が変更されたときに検出し、updateMediaSessionState()を呼び出して、それらの新しい値でmediaSessionを更新します。

00:06:50.000 --> 00:06:58.000
再生、一時停止、期間の変更、レートの変更、時間の変更にはイベントリスナーが必要です。

00:06:58.000 --> 00:07:13.000
そして最後に、映画予告編のウェブサイトにはタイトル文字列とタイトルアートワークのURLの両方があるため、メディアセッションのメタデータプロパティをそれらの値を含む新しいMediaMetadataオブジェクトに設定できます。

00:07:13.000 --> 00:07:16.000
だから、それを試してみましょう!

00:07:16.000 --> 00:07:23.000
Safariでページをリロードし、再生を開始し、システムメニューの[再生中]アイコンをクリックします。

00:07:23.000 --> 00:07:25.000
そして、再生中パネルにタイトルとアートワークが見えます。

00:07:25.000 --> 00:07:32.000
そして、一時停止ボタンをタップすると、一時停止アクションハンドラが呼び出され、再生が一時停止します。

00:07:32.000 --> 00:07:43.000
メディアセッションは、ブラウザが再生を開始または停止する必要があることをページに指示するメカニズムを提供することにより、WebページでのWatch Togetherエクスペリエンスの構成要素を提供します。

00:07:43.000 --> 00:07:51.000
これで、Webページで共同視聴体験を作成する第2部に進む準備が整いました。セッション内のすべてのデバイスで再生を調整します。

00:07:51.000 --> 00:07:58.000
これを行うには、「コーディネーター」と呼ばれる新しいプロパティを追加して、メディアセッションを拡張しました。

00:07:58.000 --> 00:08:13.000
ページは、メディアセッションのコーディネーターを使用して、セッション内の他のすべてのユーザーに、再生を開始または一時停止する、メディアのタイムラインの特定のポイントを探す、またはプレイリストの次の項目に移動するためのページの意図を通知します。

00:08:13.000 --> 00:08:27.000
コーディネーターは、これらの意図をセッション内の他のすべてのデバイスと通信し、他のすべてのデバイスの再生状態の変更を聞き、競合を解決し、全員が再生を開始する準備ができているのを待ちます。

00:08:27.000 --> 00:08:36.000
そして、全員が準備ができたら、コーディネーターは先ほど追加したメディアセッションアクションハンドラを使用して、セッション内の他のすべてのユーザーと一緒に再生を開始します。

00:08:36.000 --> 00:08:44.000
また、別のユーザーが何らかの理由で再生を一時停止した場合、コーディネーターはメディアセッションの一時停止アクションハンドラを呼び出します。

00:08:44.000 --> 00:08:47.000
そうは言っても、私はいくつかの注意点を指摘したいと思います。

00:08:47.000 --> 00:08:59.000
コーディネーターインターフェースは実験的なWeb APIであり、まだ標準化を経ておらず、そのプロセスはこのAPIを改善する可能性がありますが、APIのいくつかの側面は変更される可能性があります。

00:08:59.000 --> 00:09:05.000
詳細については、W3CのメディアセッションのGitHubページをご覧ください。

00:09:05.000 --> 00:09:18.000
このAPIは現在Safariでのみ実装されていますが、Safariがコーディネーターを実装するために使用するGroupActivitiesフレームワークは、他のMacブラウザで採用されることを望んでいます。

00:09:18.000 --> 00:09:30.000
そして、最後の注意点は、ユーザーはSafariで既存のセッションに参加できますが、現在、GroupSessionはiPhone、iPad、またはmacOSアプリケーションから開始する必要があるということです。

00:09:30.000 --> 00:09:35.000
では、コーディネーターのサポートを追加しましょう。

00:09:35.000 --> 00:09:39.000
私が最初にしたいことは、セッションが利用可能になったら参加することです。

00:09:39.000 --> 00:09:44.000
そこで、mediaSessionにコーディネーターチェンジイベントリスナーを追加します。

00:09:44.000 --> 00:09:51.000
ハンドラで、mediaSession に null 以外のコーディネーター プロパティがある場合は、その join() 関数を呼び出します。

00:09:51.000 --> 00:09:56.000
また、セッションで再生していることを示すために、コントロールにアイコンを追加したいと思います。

00:09:56.000 --> 00:10:04.000
したがって、ハンドラでは、mediaSessionにコーディネータープロパティがあるかどうかに基づいて、アイコンを表示または非表示にします。

00:10:04.000 --> 00:10:13.000
また、クリックイベントリスナーをアイコンに接続して、コーディネーターのleave（）を呼び出します。

00:10:13.000 --> 00:10:23.000
次に、カスタムコントロールのイベントハンドラを変更して、コーディネーターの存在を確認し、コーディネーターがある場合は、代わりに適切なコーディネーター関数を呼び出します。

00:10:23.000 --> 00:10:31.000
再生ボタン、一時停止ボタン、タイムラインスライダーに1つ追加します。

00:10:31.000 --> 00:10:34.000
そして、それを実際に見てみましょう!

00:10:34.000 --> 00:10:39.000
友達のサムから招待状をもらったので、それを受け入れるつもりです。

00:10:39.000 --> 00:10:43.000
私のページは、サムがiPhoneで見ているのと同じコンテンツに読み込まれます。

00:10:43.000 --> 00:10:50.000
そして、再生ボタンをクリックすると、サムのiPhoneと私のウェブページの両方が同時に再生し始めます。

00:10:50.000 --> 00:10:53.000
アリー・フォックス:私たちがそこに着く方法は冒険です。

00:10:53.000 --> 00:10:57.000
ディナ:私は怖いです。

00:10:57.000 --> 00:10:59.000
アリー：そのように感じなければ、それは冒険ではないでしょう。

00:10:59.000 --> 00:11:03.000
♪ &lt; それは素晴らしかったです。

00:11:03.000 --> 00:11:12.000
予告編が終わったので、サムはiPhoneを使って冒頭に戻します。

00:11:12.000 --> 00:11:25.000
ユーザーは、iPhone、iPad、Apple TV、またはMacで実行されているSafariのいずれであっても、アプリケーションでお気に入りのコンテンツを一緒に見たり聞いたりすることを気に入ると思います。

00:11:25.000 --> 00:11:31.000
そして、どこにいても、すべてのユーザーにその体験を提供できることを願っています。

00:11:31.000 --> 00:11:42.000
GroupActivities APIの詳細については、「グループアクティビティでメディア再生を調整する」と「グループアクティビティの設計」のセッションから始めてください。

00:11:42.000 --> 00:11:51.000
Safari 15で利用可能になる他の新しいウェブAPIに興味がある場合は、「高度なウェブコンテンツを開発する」というセッションを必ずチェックしてください。

00:11:51.000 --> 00:11:55.000
来てくれてありがとう、WWDC21の残りの部分を楽しんでください。

00:11:55.000 --> 23:59:59.000
♪

