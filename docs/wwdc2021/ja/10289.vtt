WEBVTT

00:00:00.000 --> 00:00:05.000
♪ベース音楽の演奏♪

00:00:05.000 --> 00:00:09.000
♪

00:00:09.000 --> 00:00:16.000
ジェフ・ロバートソン：SwiftUIで素晴らしいMacアプリを構築するための講演の第2部へようこそ。

00:00:16.000 --> 00:00:21.000
SwiftUIチームのエンジニア、ジェフです。

00:00:21.000 --> 00:00:26.000
同僚のマチューによるこの講演の最初の部分を楽しんでいただければ幸いです。

00:00:26.000 --> 00:00:36.000
まだパート1を見ていない場合は、ここで立ち止まって今すぐ行ってください。その講演で議論されている変更に基づいて構築します。

00:00:36.000 --> 00:00:41.000
私たちのガーデニングアプリは、マチューの話が始まってから長い道のりを歩みてきました。

00:00:41.000 --> 00:00:48.000
SwiftUIは、非常に短い時間でかなりの機能を備えたアプリを構築することを可能にしました。

00:00:48.000 --> 00:00:58.000
しかし、ユーザーはさまざまな方法で私たちのアプリを使用する傾向があり、特に優れたmacOSアプリがこれを説明するでしょう。

00:00:58.000 --> 00:01:07.000
それを念頭に置いて、マチューがパート1で概説した原則を維持しながら、すべての人のためにアプリを構築する方法のいくつかを見てみましょう。

00:01:07.000 --> 00:01:19.000
まず、システム全体と独自のアプリ内の変更を処理することで、完全にカスタマイズ可能なmacOSアプリであることの意味を見ていきます。

00:01:19.000 --> 00:01:30.000
ユーザーがドラッグアンドドロップでデータを操作するための追加のワークフローを追加することは、柔軟なユーザーエクスペリエンスを提供するもう1つの方法です。

00:01:30.000 --> 00:01:37.000
次に、アプリのデータをエクスポートできるようにすることで、ファイルシステムを操作する方法を探ります。

00:01:37.000 --> 00:01:45.000
そして最後に、Continuity Cameraのサポートを追加して、アプリに画像をインポートするためのシームレスなワークフローを作成します。

00:01:45.000 --> 00:01:56.000
私が最初にお話ししたいのは、特定のAPIではなく、SwiftUIで構築されたアプリがmacOSのカスタマイズ性にどのように適合するかについてです。

00:01:56.000 --> 00:02:00.000
ここでは、ガーデニングアプリとシステム環境設定を開いています。

00:02:00.000 --> 00:02:08.000
ダークモードに切り替えると、アプリがインターフェイスを自動的に更新するのを見ることができます。

00:02:08.000 --> 00:02:14.000
システム環境設定を開いている間に、サイドバーのアイコンサイズを大きく更新します。

00:02:14.000 --> 00:02:20.000
ダークモードと同様に、私たちのアプリは私がシステム環境設定で設定したものに自分自身を調整しました。

00:02:20.000 --> 00:02:31.000
私は開発者として、自動的に取得するので、そしてユーザーとして、私が使用しているアプリが私自身の個人的な好みを考慮に入れることを意味するので、これらの小さなタッチが大好きです。

00:02:31.000 --> 00:02:39.000
システム環境設定を離れてアプリに集中する前に、アクセントカラーがマルチカラーに設定されていることを指摘したいと思います。

00:02:39.000 --> 00:02:50.000
この機能により、開発者はアプリ固有のアクセントカラーを設定できます。オペレーティングシステムは、アプリのボタン、選択ハイライト、サイドバーのグリフをカスタマイズします。

00:02:50.000 --> 00:03:02.000
アプリでアクセントカラーをサポートしたいので、プロジェクトでアセットカタログを開き、AccentColorを選択します。

00:03:02.000 --> 00:03:08.000
そして、アプリのテーマに合わせて、コンテンツをシステムグリーンに変更します。

00:03:08.000 --> 00:03:14.000
ご覧のとおり、サイドバーのアイコンと選択はすべて変更を拾いました。

00:03:14.000 --> 00:03:23.000
アプリがオペレーティングシステム全体に影響を与える変更に自動的に反応する方法を見てきましたが、アプリ固有の設定はどうですか?

00:03:23.000 --> 00:03:28.000
ユーザーがガーデニングアプリをカスタマイズできるように、インターフェースを追加することを説明しましょう。

00:03:28.000 --> 00:03:31.000
ここでは、GardenAppファイルを開きました。

00:03:31.000 --> 00:03:36.000
そして、WindowGroupのシーンの横に、設定シーンを追加します。

00:03:36.000 --> 00:03:41.000
そして、このシーンは、選択すると、私たちのビューでウィンドウを開くメニュー項目を提供します。

00:03:41.000 --> 00:03:47.000
設定したSettingsViewを使用し、私のモデルも渡します。 も渡します。

00:03:47.000 --> 00:04:02.000
さらに、設定シーンでは、アプリのメインメニューに適切なメニュー項目を追加し、コマンドコンマの標準キーボードショートカットで設定します。

00:04:02.000 --> 00:04:04.000
これは私たちに素晴らしいスタートを与えてくれます。

00:04:04.000 --> 00:04:08.000
では、インターフェイスを定義するSettingsViewを見てみましょう。 インターフェイスを定義します。

00:04:08.000 --> 00:04:22.000
macOSでは、特にアプリが異なるカテゴリに分けることができる多くの設定を提供する場合、異なるペインを切り替えることができるように、アプリがツールバーアイコン付きの設定インターフェイスを提供するのが一般的です。

00:04:22.000 --> 00:04:25.000
だから、ここでの私のメインビューのために、私はTabViewを使うつもりです。

00:04:25.000 --> 00:04:38.000
そして、私はそれに2人の子供を与えるつもりです。1つはGeneralSettings用、もう1つはViewingSettings用です。

00:04:38.000 --> 00:04:45.000
また、ウィンドウツールバー領域のタブの内容については、tabItemを使用します。

00:04:45.000 --> 00:04:47.000
そして、この内容は単なるラベルにすることができます。

00:04:47.000 --> 00:04:56.000
表示するテキスト（この場合は「General」）とsystemImageを与えます。GeneralSettingsには「gear」を使用します。

00:04:56.000 --> 00:04:59.000
そして、ViewingSettingsでも同じことをしましょう。

00:04:59.000 --> 00:05:09.000
tabItemとラベルを追加します - 私たちはそれを「表示」と呼びます - そして、「眼鏡」のsystemImageだと思います。

00:05:09.000 --> 00:05:13.000
わかった。だから今、私たちは2つのタブの内容を持っています。

00:05:13.000 --> 00:05:16.000
今すぐ一般設定に記入しましょう。

00:05:16.000 --> 00:05:26.000
ユーザーにとって良いことは、現在庭が選択されていないときにデフォルトとして使用する庭を定義する機能です。

00:05:26.000 --> 00:05:29.000
このために、私はピッカーを追加するつもりです...

00:05:29.000 --> 00:05:46.000
そして、最初の項目はテキスト(「なし」)だと思います。

00:05:46.000 --> 00:05:52.000
そして、他の人のために、私は私たちのデータのすべての庭の上にForEachを追加するつもりです。

00:05:52.000 --> 00:06:14.000
そして、各庭について、テキストを追加して、庭の名前と表示年を与えるだけです。

00:06:14.000 --> 00:06:21.000
また、ここに庭のIDが付いたタグを提供する必要があります。

00:06:21.000 --> 00:06:27.000
したがって、「なし」の値については、なしのタグを付けることができます。

00:06:27.000 --> 00:06:34.000
そして、私たちの他の庭のために、私たちはそれに庭のIDに対応するタグを与えます。

00:06:34.000 --> 00:06:46.000
最後に、ピッカーの選択にいくつかの状態を提供する必要があります。

00:06:46.000 --> 00:06:56.000
このような設定インターフェイスを提供する場合、アプリが起動とOSの更新でユーザーの選択を記憶できるように、状態を持続することが重要です。

00:06:56.000 --> 00:07:01.000
SwiftUIでは、これはAppStorageプロパティラッパーを使用することで実現できます。

00:07:01.000 --> 00:07:09.000
このプロパティラッパーは、UserDefaultsシステムを使用して値を保持します。これはまさに私たちがここで望むものです。

00:07:09.000 --> 00:07:15.000
したがって、選択バインディングのために、AppStorageプロパティラッパーを追加します。

00:07:15.000 --> 00:07:17.000
これには鍵が必要です。

00:07:17.000 --> 00:07:24.000
「defaultGarden」と呼び、「選択」と呼びます。

00:07:24.000 --> 00:07:28.000
また、オプションのGarden.IDです。

00:07:28.000 --> 00:07:35.000
そして、これが行うことは、ユーザーのデフォルトシステムを使用して選択値を保持することです。

00:07:35.000 --> 00:07:41.000
また、ピッカーに固定サイズを追加し、フォームにいくつかのパディングを追加します。

00:07:41.000 --> 00:07:56.000
ここでContentViewに切り替えて、AppStorageを追加して、使用したのと同じキーを渡します。

00:07:56.000 --> 00:08:09.000
私たちはそれを「defaultGardenID」と呼び、オプションのGarden.IDでもあります。

00:08:09.000 --> 00:08:22.000
そして、ここで私が選択のためにこのバインディングを持っているところで、私はこれをバインディングに置き換えるつもりです、そして「get」は最初にselectedGardenIDを使用することになります。

00:08:22.000 --> 00:08:27.000
そして、それが設定されていない場合は、defaultGardenIDにフォールバックします。

00:08:27.000 --> 00:08:32.000
そして、セッターについては、選択したGardenIDのみを更新します。

00:08:32.000 --> 00:08:35.000
私たちは実際にdefaultGardenを更新したくありません。

00:08:35.000 --> 00:08:40.000
だから私は「selectedGardenID = $0」と言うつもりです。

00:08:40.000 --> 00:08:44.000
わかった。

00:08:44.000 --> 00:08:46.000
私は私たちのアプリを実行するつもりです。

00:08:46.000 --> 00:08:56.000
ここで環境設定メニュー項目を開き、デフォルトの庭として屋内植物を選択します。

00:08:56.000 --> 00:09:01.000
そして、新しいウィンドウを開くと、屋内植物が選択されていることがわかります。

00:09:01.000 --> 00:09:08.000
設定を介してカスタマイズサポートを提供することは、ユーザーにとって柔軟なエクスペリエンスを構築する素晴らしい方法の1つです。

00:09:08.000 --> 00:09:13.000
もう1つの方法は、同じアクションの代替ワークフローを提供することです。

00:09:13.000 --> 00:09:19.000
私たちの講演の最初の部分では、マチューは選択した庭に植物を追加するためのメインメニュー項目を追加する方法を示しました。

00:09:19.000 --> 00:09:30.000
これは私たちのアプリにとって素晴らしい機能ですが、一般的なmacOSユーザーインタラクションを介して同様の機能を提供できる別の方法を見てみましょう:ドラッグアンドドロップ。

00:09:30.000 --> 00:09:36.000
ここではテーブルを使用しているので、ドラッグソースとドロップ先であることをサポートするためにいくつかの調整を行います。

00:09:36.000 --> 00:09:42.000
私が最初に行うことは、イニシャライザからこの「植物」を削除することです。

00:09:42.000 --> 00:09:49.000
次に、最後に降りて、行ビルダーを追加します。 

00:09:49.000 --> 00:09:55.000
この行ビルダーの内容については、ForEachを追加し、以前から持っていた植物を使用します。

00:09:55.000 --> 00:10:05.000
そして、各植物のために、私はそれでTableRowを作成するつもりです。

00:10:05.000 --> 00:10:12.000
では、itemProvider修飾子を追加して、各TableRowsをカスタマイズします。

00:10:12.000 --> 00:10:20.000
そして、私はここでplant.itemProviderだけを返すつもりです。これは私のモデルに設定した計算されたプロパティです。

00:10:20.000 --> 00:10:24.000
したがって、これらの行のそれぞれがドラッグソースであることをサポートしています。

00:10:24.000 --> 00:10:31.000
私は今、植物を引きずり出すのに十分な変更を加えましたが、何も受け入れなければ、これはあまり役に立ちません。

00:10:31.000 --> 00:10:35.000
テーブルにドロップサポートを追加して、それを修正しましょう。

00:10:35.000 --> 00:10:39.000
onInsert修飾子は、ドラッグアンドドロップ方程式の残りの半分です。

00:10:39.000 --> 00:10:50.000
コンテンツタイプのリストを取り、ここにPlant.draggableTypeを渡します。これは私のモデルで設定したカスタムタイプです。

00:10:50.000 --> 00:10:53.000
また、2つのパラメータが渡されるクロージャも必要です。

00:10:53.000 --> 00:10:59.000
1つはドロップが発生したインデックスで、もう1つはアイテムプロバイダーのリストです。

00:10:59.000 --> 00:11:09.000
次に、Plant.fromItemProvidersに電話してモデルを作成し、これらのアイテムプロバイダーをここに渡します。

00:11:09.000 --> 00:11:14.000
これにより、モデルを更新するために使用できる植物のリストが返されます。

00:11:14.000 --> 00:11:29.000
発生したインデックスでgarden.plants.insert（contentsOf：plants）と呼びます。

00:11:29.000 --> 00:11:42.000
これで、屋内植物で新しいウィンドウを開き、裏庭の花壇からいくつかの花を選択し、ドラッグしてコピーすることができます。

00:11:42.000 --> 00:11:50.000
ドラッグアンドドロップは、アプリ内でデータを移動するのに最適な方法ですが、アプリとオペレーティングシステムの間でデータを移動するのはどうですか?

00:11:50.000 --> 00:11:58.000
私たちのユーザーは、おそらくバックアップの目的で、または別のアプリにインポートするために、このすべてのデータをエクスポートできることを嬉しく思います。

00:11:58.000 --> 00:12:08.000
このワークフローを容易にするために、他のアプリケーションと共有できる共通のファイル形式でデータベースをエクスポートするためのメインメニュー項目を追加しましょう。

00:12:08.000 --> 00:12:14.000
コマンドプロトコルに準拠したメニュー項目を含むタイプをすでに作成しました。

00:12:14.000 --> 00:12:23.000
ここのコマンドでは、ImportExportCommandsを追加し、それを私たちのストアに渡します。

00:12:23.000 --> 00:12:26.000
今すぐそのファイルに切り替えましょう。

00:12:26.000 --> 00:12:37.000
そして、本文については、CommandGroupを追加し、システムが提供するimportExportの配置を置き換えます。

00:12:37.000 --> 00:12:44.000
そして、これは、ファイルメニューの予想される場所にメニュー項目を追加することです。

00:12:44.000 --> 00:12:50.000
したがって、コマンドグループの内容については、セクションとボタンを追加します。

00:12:50.000 --> 00:12:55.000
「エクスポート」のラベルを付け、その後に楕円を付けます。

00:12:55.000 --> 00:13:02.000
楕円は、その項目を選択するとウィンドウまたは保存ダイアログが開くことをユーザーに示します。

00:13:02.000 --> 00:13:13.000
そして、ボタンはいくつかの状態を変更することができます - 「isShowingExport = true」と言う - そして、その状態をここにも追加しましょう。

00:13:13.000 --> 00:13:24.000
だから今、私たちはいくつかの状態を変更しているボタンを持っています。

00:13:24.000 --> 00:13:29.000
また、ここにfileExporter修飾子を追加します。

00:13:29.000 --> 00:13:37.000
そして、私はそれをそのisPresentedパラメータで私たちの状態にバインディングを与えるつもりです。

00:13:37.000 --> 00:13:40.000
isShowingExportです。

00:13:40.000 --> 00:13:42.000
文書も必要です。

00:13:42.000 --> 00:13:49.000
これは、ファイルドキュメントプロトコルまたは参照ファイルドキュメントプロトコルのいずれかに準拠する必要があるタイプです。

00:13:49.000 --> 00:13:53.000
私はすでに私の店にコンフォーマンスを追加したので、ここでそれを渡します。

00:13:53.000 --> 00:13:56.000
さらに、コンテンツタイプが必要です。

00:13:56.000 --> 00:14:07.000
CSVタイプのみのStore.readableContentTypes.firstに渡します。

00:14:07.000 --> 00:14:15.000
そして最後に、操作の結果が渡され、成功または失敗を示すクロージャが必要です。

00:14:15.000 --> 00:14:31.000
これで、エクスポートメニュー項目を選択し、保存するファイルを与え、「plants.csv」と言い、エクスポートを押すと、ファイルがディスクに保存されます。

00:14:31.000 --> 00:14:39.000
アプリとオペレーティングシステムの間でデータを移動するという話題になっている間、最後に1つ議論したいことがあります。

00:14:39.000 --> 00:14:45.000
私たちのアプリには、植物に関するテキストデータがたくさんありますが、画像を追加するのも素晴らしいことです。

00:14:45.000 --> 00:14:49.000
ユーザーは、時間の経過とともに植物の写真を撮って進捗状況を追跡することができます。

00:14:49.000 --> 00:14:53.000
このインポートフローを有効にする1つの方法は、Continuity Cameraです。

00:14:53.000 --> 00:15:00.000
この機能により、ユーザーはiOSデバイスで植物の写真を撮り、アプリに直接インポートすることができます。

00:15:00.000 --> 00:15:08.000
ユーザーがギャラリービューで植物を選択したときに、このフローを有効にするメニュー項目を追加する方法を見てみましょう。

00:15:08.000 --> 00:15:18.000
importExportCommandsの後、ImportFromDevicesCommandsを追加すると、メインメニュー項目が表示されます。

00:15:18.000 --> 00:15:35.000
さらに、GardenDetailファイルに切り替えて、ここで私たちの体の最後に、importsItemProviders修飾子を追加し、これはインポートをサポートしたいタイプのリストを取ります。

00:15:35.000 --> 00:15:42.000
私は何かが選択されているかどうかに基づいてこれをするつもりですので、私はここで私たちの選択を使用するつもりです。

00:15:42.000 --> 00:15:50.000
そして、それが空であれば、空の配列を返します。

00:15:50.000 --> 00:16:00.000
そして、空でない場合は、システム上のすべての画像タイプのリストであるPlant.importImageTypesを返します。

00:16:00.000 --> 00:16:07.000
そして、この修飾子はクロージャを受け取り、アイテムプロバイダーのリストを渡します。

00:16:07.000 --> 00:16:22.000
これらのプロバイダーを取り、Plant.importImageFromProvidersに電話し、プロバイダーに渡すと、イメージをディスクに保存したURLが返されます。

00:16:22.000 --> 00:16:27.000
次に、選択したすべてのIDをループしてモデルを更新します。

00:16:27.000 --> 00:16:41.000
...そして、プラントへの参照を取得し、そのimageURLを更新します。

00:16:41.000 --> 00:16:46.000
屋内植物園を選択し、ギャラリーモードに切り替えます。

00:16:46.000 --> 00:16:49.000
そして、私は物事をもう少し大きくするつもりです。

00:16:49.000 --> 00:16:51.000
ここで私の植物を選択してください。

00:16:51.000 --> 00:17:00.000
メインメニュー項目で、「iPhoneから読み込む」&gt;「写真を撮る」を選択します。

00:17:00.000 --> 00:17:06.000
そして、あなたは私たちのギャラリーが更新されているのを見ることができます。

00:17:06.000 --> 00:17:11.000
これが素晴らしいMacアプリを定義するさまざまな方法のいくつかの素晴らしいツアーだったことを願っています。

00:17:11.000 --> 00:17:16.000
あなたのアプリがmacOSプラットフォームをより良くするすべての方法を楽しみにしています。

00:17:16.000 --> 00:17:20.000
素晴らしいWWDC 2021をお過ごしください。

00:17:20.000 --> 23:59:59.000
♪

