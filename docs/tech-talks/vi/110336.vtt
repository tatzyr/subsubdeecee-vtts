WEBVTT

00:00:03.000 --> 00:00:08.000
Xin chào. Tên tôi là Katie, và chào mừng đến với phiên này về việc triển khai Apple Pay và theo dõi đơn hàng.

00:00:08.000 --> 00:00:10.000
Hãy xem chương trình nghị sự cho ngày hôm nay.

00:00:10.000 --> 00:00:14.000
Đầu tiên, tôi sẽ hướng dẫn bạn những điều cơ bản cần thiết để bắt đầu với Apple Pay.

00:00:14.000 --> 00:00:19.000
Sau đó, tôi sẽ chỉ cho bạn cách tạo yêu cầu thanh toán và phản hồi các thay đổi trong bảng thanh toán.

00:00:19.000 --> 00:00:23.000
Bạn cũng có thể thêm chi tiết đơn hàng vào cuối quy trình thanh toán để người dùng có thể theo dõi đơn hàng của họ.

00:00:23.000 --> 00:00:28.000
Chi tiết đơn đặt hàng sẽ cho phép Wallet truy xuất một gói hàng đã đặt hàng, tôi sẽ chỉ cho bạn cách xây dựng.

00:00:28.000 --> 00:00:31.000
Cuối cùng, tôi sẽ chỉ cho bạn cách cập nhật đơn đặt hàng của bạn.

00:00:31.000 --> 00:00:33.000
Vậy hãy bắt đầu nào.

00:00:33.000 --> 00:00:36.000
Apple Pay là cách thanh toán dễ dàng, an toàn và riêng tư.

00:00:36.000 --> 00:00:42.000
Nếu bạn là nhà phát triển trang web hoặc ứng dụng, bạn có thể sử dụng Apple Pay để cải thiện trải nghiệm chuyển đổi và người dùng của mình.

00:00:42.000 --> 00:00:44.000
Có hai mục cần thiết để tạo ra để bắt đầu.

00:00:44.000 --> 00:00:50.000
Đầu tiên là một mã định danh xác định duy nhất bạn là người bán có thể chấp nhận thanh toán.

00:00:50.000 --> 00:00:54.000
Để tạo một cái, bạn nên đi đến phần nhận dạng của cổng thông tin Nhà phát triển Apple.

00:00:54.000 --> 00:00:58.000
Định dạng thông thường nằm trong DNS ngược, bắt đầu bằng từ "thương gia".

00:00:58.000 --> 00:01:02.000
Sử dụng mã định danh người bán mới spiffy của bạn để tạo chứng chỉ xử lý thanh toán.

00:01:02.000 --> 00:01:09.000
Nói một cách ngắn gọn, Apple Pay mã hóa từng tải trọng bằng mã định danh người bán đã đăng ký và chứng chỉ công khai của bạn.

00:01:09.000 --> 00:01:13.000
Tải trọng này sau đó có thể được giải mã và xử lý từ phía bạn.

00:01:13.000 --> 00:01:16.000
Sau đó bạn có thể trả lại cho dù khoản thanh toán thành công hay thất bại.

00:01:16.000 --> 00:01:19.000
Nói chuyện với nhà cung cấp dịch vụ thanh toán của bạn để biết chi tiết cụ thể về việc xử lý thanh toán.

00:01:19.000 --> 00:01:24.000
Có nhiều bước khác nhau để thiết lập Apple Pay giữa các ứng dụng và trang web.

00:01:24.000 --> 00:01:32.000
Để thiết lập Apple Pay để sử dụng trong ứng dụng của bạn, chỉ cần điều hướng đến tab Signing &amp; Capabilities trong Xcode và thêm mã định danh người bán của bạn dưới khả năng Apple Pay.

00:01:32.000 --> 00:01:37.000
Nếu bạn đang xây dựng một trang web và muốn thiết lập Apple Pay ở đó, có một số bước bổ sung được yêu cầu.

00:01:37.000 --> 00:01:44.000
Bạn phải đăng ký các miền sẽ xử lý giao dịch Apple Pay, điều này có thể được thực hiện trong phần nhận dạng của cổng thông tin Nhà phát triển Apple.

00:01:44.000 --> 00:01:51.000
Trong khi bạn ở đó, bạn có thể tạo Chứng chỉ Nhận dạng Người bán Apple Pay được liên kết với số nhận dạng người bán mà bạn đã tạo trước đó.

00:01:51.000 --> 00:01:55.000
Chứng chỉ này được sử dụng để xác thực các phiên của bạn với các máy chủ Apple Pay.

00:01:55.000 --> 00:02:04.000
Cho dù bạn đang tích hợp một ứng dụng hay trên web, nếu bạn đang làm việc với nền tảng thương mại điện tử hoặc nhà cung cấp dịch vụ thanh toán, hãy xem hướng dẫn cụ thể của họ vì họ có thể đơn giản hóa một số bước này.

00:02:04.000 --> 00:02:07.000
Bây giờ hãy xem cách thực sự triển khai Apple Pay.

00:02:07.000 --> 00:02:14.000
Trước khi hiển thị nội dung liên quan đến Apple Pay, bạn nên kiểm tra xem người dùng có thể thanh toán với cấu hình hiện tại hay không.

00:02:14.000 --> 00:02:21.000
Các khả năng biểu thị loại thanh toán mà bảng tính hiện có thể chấp nhận, chẳng hạn như 3D Secure hoặc thẻ tín dụng hoặc thẻ ghi nợ.

00:02:21.000 --> 00:02:26.000
Sau đó, bạn sẽ chỉ định các khả năng mà bạn chấp nhận khi bạn định cấu hình yêu cầu thanh toán.

00:02:26.000 --> 00:02:33.000
Bạn có thể kiểm tra các mạng mà người dùng đã có sẵn, hãy nhớ rằng người dùng có thể thêm nhiều thẻ hơn nếu hiện không có thẻ nào khả dụng.

00:02:33.000 --> 00:02:38.000
Bây giờ bạn đã biết người dùng của mình có thể thực hiện thanh toán, đã đến lúc hiển thị nút Apple Pay.

00:02:38.000 --> 00:02:43.000
Đảm bảo chọn lời kêu gọi hành động tốt nhất và loại nút phù hợp với hành động mà người dùng cần thực hiện.

00:02:43.000 --> 00:02:49.000
Hiển thị nút Apple Pay nổi bật, phía trên màn hình đầu tiên và là tùy chọn thanh toán đầu tiên.

00:02:49.000 --> 00:02:53.000
Nút Apple Pay được bản địa hóa hoàn toàn và cũng có thể được điều chỉnh cho phù hợp với cài đặt của người dùng.

00:02:53.000 --> 00:03:02.000
Để hiển thị nút Apple Pay trong ứng dụng của bạn bằng UIKit, trước tiên, hãy tạo PKPaymentButton, chỉ định loại và kiểu của nút.

00:03:02.000 --> 00:03:08.000
Loại mô tả loại thanh toán; ví dụ, Đóng góp bằng Apple Pay hoặc Tiếp tục với Apple Pay.

00:03:08.000 --> 00:03:12.000
Phong cách kiểm soát sự xuất hiện của nút, như nó sáng hay tối.

00:03:12.000 --> 00:03:16.000
Sử dụng kiểu tự động cho nút để tự động thay đổi dựa trên cài đặt của người dùng.

00:03:16.000 --> 00:03:20.000
Trên web, sử dụng nút JavaScript Apple Pay.

00:03:20.000 --> 00:03:25.000
Để thêm một cái, trước tiên, hãy tải tập lệnh nút vào trang web của bạn trên mạng phân phối nội dung của bạn.

00:03:25.000 --> 00:03:31.000
Nút JavaScript Apple Pay cũng cho phép bạn chỉ định loại, kiểu dáng và bản địa hóa.

00:03:31.000 --> 00:03:35.000
Bạn cũng có thể sử dụng CSS để tùy chỉnh thêm kích thước của nút.

00:03:35.000 --> 00:03:39.000
Chúng tôi cần tạo một yêu cầu thanh toán để bảng thanh toán biết điều gì sẽ xảy ra.

00:03:39.000 --> 00:03:43.000
Trong các ứng dụng, chúng ta có thể làm điều đó bằng cách tạo PKPaymentRequest.

00:03:43.000 --> 00:03:55.000
Có nhiều trường có thể được đặt theo yêu cầu tùy thuộc vào nhu cầu của bạn, nhưng các yếu tố cần thiết bao gồm số nhận dạng người bán bạn đã tạo trước đó, các loại thanh toán bạn có thể chấp nhận, quốc gia và mã tiền tệ của khoản thanh toán.

00:03:55.000 --> 00:03:58.000
Chỉ định các mạng mà bạn chấp nhận thanh toán.

00:03:58.000 --> 00:04:03.000
Điều này nên được thực hiện theo thứ tự ưu tiên để Apple Pay và chọn mạng ưu tiên cho các thẻ được kết hợp.

00:04:03.000 --> 00:04:07.000
Cuối cùng, các mục tóm tắt được bao gồm như một phần của giao dịch này.

00:04:07.000 --> 00:04:10.000
Chúng ta hãy xem xét kỹ hơn các mục tóm tắt.

00:04:10.000 --> 00:04:17.000
Để làm điều đó, chúng tôi có thể tưởng tượng rằng bạn điều hành một cửa hàng đồ thú cưng trực tuyến và muốn cung cấp cho khách hàng khả năng kiểm tra đơn đặt hàng của họ với Apple Pay.

00:04:17.000 --> 00:04:23.000
Các mục tóm tắt này bao gồm tổng chi phí của các mặt hàng mà khách hàng của bạn đã chọn trừ đi bất kỳ chiết khấu nào.

00:04:23.000 --> 00:04:26.000
Họ nên giúp chia nhỏ chi phí cho khách hàng.

00:04:26.000 --> 00:04:32.000
Mục tóm tắt cuối cùng luôn là tổng số và nhãn cho tổng số này phải là công ty nhận thanh toán.

00:04:32.000 --> 00:04:36.000
Yêu cầu phải có ít nhất một mục được đặt trong mảng ở đây.

00:04:36.000 --> 00:04:39.000
Bây giờ, chúng tôi đã sẵn sàng để hiển thị bảng thanh toán.

00:04:39.000 --> 00:04:46.000
Đầu tiên, chúng tôi tạo một PKPayment AuthorizationViewController, gửi yêu cầu mà chúng tôi đã thiết lập vài phút trước.

00:04:46.000 --> 00:04:50.000
Bạn chịu trách nhiệm trình bày viewController được trả lại cho bạn.

00:04:50.000 --> 00:04:53.000
Bây giờ, chúng ta hãy xem đại biểu này mà chúng ta đang thiết lập.

00:04:53.000 --> 00:05:03.000
PKPaymentAuthorization ViewControllerDelegate là cách trang tính truyền đạt các thay đổi cho bạn, chẳng hạn như khi người dùng chọn địa chỉ email mới hoặc khi họ ủy quyền giao dịch.

00:05:03.000 --> 00:05:14.000
Bạn nên phản hồi những thay đổi phù hợp với mình; tuy nhiên, bạn luôn có trách nhiệm loại bỏ bảng thanh toán và nên triển khai paymentAuthorizationViewControll erDidFinish để xử lý việc này.

00:05:14.000 --> 00:05:21.000
Bạn nên luôn cố gắng trả lại lỗi cho người dùng càng sớm càng tốt với một mô tả hữu ích để giúp họ giải quyết vấn đề.

00:05:21.000 --> 00:05:29.000
Ví dụ: nếu có vấn đề với địa chỉ giao hàng mới của người dùng, bạn nên trả lại lỗi như một phần của PKPaymentRequest ShippingContactUpdate.

00:05:29.000 --> 00:05:37.000
didAuthorizePayment được gọi khi người dùng hài lòng với các chi tiết và sử dụng Face ID, Touch ID hoặc mật mã của họ để tiến hành giao dịch.

00:05:37.000 --> 00:05:43.000
Bạn cần xử lý PKPayment được gửi cho chính bạn hoặc bằng cách chuyển nó vào bộ xử lý thanh toán.

00:05:43.000 --> 00:05:47.000
Bạn phải gọi cho người xử lý với một kết quả thích hợp.

00:05:47.000 --> 00:05:52.000
Trong iOS 16, chúng tôi đã giới thiệu khả năng dễ dàng tạo nút Apple Pay trong SwiftUI.

00:05:52.000 --> 00:06:01.000
Tất cả những gì bạn cần làm là chuyển yêu cầu thanh toán khi tạo nút Thanh toán bằng Apple Pay và bảng thanh toán sẽ tự động hiển thị khi người dùng tương tác với nút.

00:06:01.000 --> 00:06:05.000
Loại nút, và tùy chọn, kiểu dáng cũng có thể được thiết lập.

00:06:05.000 --> 00:06:10.000
Thay đổi ủy quyền thanh toán tương tự như đại diện mà chúng tôi đã xem xét trên trang chiếu trước.

00:06:10.000 --> 00:06:13.000
Hãy xem cách phản hồi các bản cập nhật của người dùng.

00:06:13.000 --> 00:06:25.000
Người dùng vừa ủy quyền thanh toán và thay đổi giai đoạn ủy quyền thanh toán thông báo cho ứng dụng của bạn về ứng dụng này của bạn sau đó gửi thông tin thanh toán đến máy chủ của bạn và yêu cầu nó xử lý thanh toán.

00:06:25.000 --> 00:06:33.000
Kiểm tra xem kết quả máy chủ có cho thấy sự thành công hay không và xử lý bất kỳ lỗi nào do máy chủ của bạn trả về, đảm bảo bạn vẫn gọi trình xử lý kết quả với một lỗi thích hợp.

00:06:33.000 --> 00:06:39.000
Nếu kết quả máy chủ cho thấy sự thành công, hãy hoàn thành thanh toán với kết quả ủy quyền thích hợp.

00:06:39.000 --> 00:06:46.000
Kết quả bạn trả lại phải chứa những gì đã xảy ra khi cố gắng xử lý thanh toán; ví dụ, nếu địa chỉ bưu chính không hợp lệ.

00:06:46.000 --> 00:06:50.000
Trong hầu hết các trường hợp, thanh toán sẽ thành công hoặc thất bại.

00:06:50.000 --> 00:06:55.000
Nếu thanh toán không thành công, bạn cũng có thể trả lại một hoặc nhiều lỗi được sắp xếp theo mức quan trọng.

00:06:55.000 --> 00:06:58.000
Điều đó sẽ được hiển thị cho người dùng để họ có thể thử giao dịch lại.

00:06:58.000 --> 00:07:03.000
Kết quả ủy quyền này có thể tùy ý chứa chi tiết đơn hàng, mà chúng tôi sẽ xem xét trong thời gian ngắn.

00:07:03.000 --> 00:07:06.000
Bây giờ chúng ta hãy xem cách làm điều này trên web.

00:07:06.000 --> 00:07:11.000
API yêu cầu thanh toán W3C là một tiêu chuẩn mở cho phép bạn xử lý các khoản thanh toán trên web.

00:07:11.000 --> 00:07:29.000
Bạn có thể tạo đối tượng PaymentRequest và điền vào đó các phương thức mà bạn có thể chỉ định rằng Apple Pay có sẵn; chi tiết chứa thông tin về giao dịch, như tổng số và phương thức giao hàng; và các tùy chọn chỉ định thông tin nào bạn muốn người dùng cung cấp.

00:07:29.000 --> 00:07:35.000
Bạn sẽ phải hoàn thành xác thực người bán trên máy chủ của mình, vì vậy hãy tạo một phiên người bán mới và chuyển nó vào chức năng hoàn chỉnh.

00:07:35.000 --> 00:07:43.000
Cũng giống như bản địa, bạn có thể phản hồi các tương tác mà người dùng thực hiện trong bảng thanh toán và bạn cũng sẽ cần xử lý phản hồi thanh toán khi người dùng xác thực.

00:07:43.000 --> 00:07:47.000
Bây giờ tất cả các bạn đã được tích hợp với Apple Pay, chúng ta có thể bắt đầu thực sự xây dựng một đơn đặt hàng.

00:07:47.000 --> 00:07:50.000
Trong iOS 16, chúng tôi đã giới thiệu theo dõi đơn hàng.

00:07:50.000 --> 00:07:55.000
Khách hàng của bạn hiện có thể xem chi tiết đơn hàng và thông tin theo dõi, tất cả từ bên trong ứng dụng Wallet.

00:07:55.000 --> 00:08:04.000
Họ sẽ có thể biết ngay lập tức khi nào họ có thể nhận đơn đặt hàng của mình, nếu đơn đặt hàng đã được giao, nếu có bất kỳ vấn đề nào hoặc nhận được thông báo.

00:08:04.000 --> 00:08:10.000
Vì vậy, bây giờ bạn đã tích hợp thành công hoạt động kinh doanh cửa hàng thú cưng của mình với Apple Pay, bạn cũng có thể muốn thêm theo dõi đơn hàng.

00:08:10.000 --> 00:08:12.000
Hãy xem làm thế nào.

00:08:12.000 --> 00:08:16.000
Bạn sẽ nhận thấy rằng việc bắt đầu với các đơn đặt hàng tương tự như thiết lập Apple Pay.

00:08:16.000 --> 00:08:23.000
Quay trở lại phần Mã định danh của cổng thông tin Nhà phát triển và tạo mã định danh loại đơn hàng.

00:08:23.000 --> 00:08:28.000
Điều này xác định tổ chức của bạn là một thực thể cung cấp thông tin đặt hàng.

00:08:28.000 --> 00:08:36.000
Giống như với mã định danh người bán, chúng tôi khuyên bạn nên sử dụng sơ đồ đặt tên kiểu DNS ngược tương tự, lần này là đặt trước từ "đặt hàng".

00:08:36.000 --> 00:08:42.000
Tiếp theo, tạo chứng chỉ ID Loại Đơn hàng từ phần chứng chỉ của cổng thông tin nhà phát triển.

00:08:42.000 --> 00:08:48.000
Bạn sẽ sử dụng Chứng chỉ để xây dựng các gói đơn đặt hàng, cập nhật đơn đặt hàng và gửi thông báo.

00:08:48.000 --> 00:08:54.000
Bây giờ chúng tôi đã thiết lập xong, chúng tôi có thể thêm đơn đặt hàng vào Wallet ngay trong quy trình mua hàng Apple Pay.

00:08:54.000 --> 00:09:00.000
Để làm điều đó, chúng ta hãy nhìn lại quy trình xử lý thanh toán đơn giản của chúng tôi mà bạn nên nhận ra trước đó.

00:09:00.000 --> 00:09:03.000
Chúng tôi đã biết máy chủ của bạn đã được gửi thông tin thanh toán để xử lý.

00:09:03.000 --> 00:09:08.000
Nếu thanh toán được xử lý thành công, máy chủ của bạn sẽ tạo một đơn đặt hàng.

00:09:08.000 --> 00:09:14.000
Để hỗ trợ theo dõi đơn hàng trong kết quả bạn trả lại, bạn cũng nên bao gồm một số chi tiết về đơn hàng bạn đã tạo.

00:09:14.000 --> 00:09:19.000
Những chi tiết đơn hàng này cho phép thiết bị yêu cầu đơn hàng không đồng bộ từ máy chủ của bạn.

00:09:19.000 --> 00:09:23.000
Máy chủ của bạn sau đó chuyển gói đặt hàng sang thiết bị, sau đó sẽ được hiển thị trong Wallet.

00:09:23.000 --> 00:09:30.000
Hiện tại, chúng ta hãy xem xét kỹ hơn các chi tiết đơn hàng mà bạn sẽ cần trả lại như một phần của kết quả ủy quyền PKPayment.

00:09:30.000 --> 00:09:33.000
Chi tiết đơn hàng bao gồm bốn trường.

00:09:33.000 --> 00:09:37.000
Mã định danh loại đơn đặt hàng chỉ đơn giản là mã bạn đã tạo trước đó.

00:09:37.000 --> 00:09:43.000
Bạn nên tạo một cách để xác định đơn đặt hàng của mình, nhưng nó phải là duy nhất trong phạm vi nhận dạng loại đơn đặt hàng của bạn.

00:09:43.000 --> 00:09:47.000
Bao gồm URL cho dịch vụ web của bạn.

00:09:47.000 --> 00:09:51.000
Cuối cùng, máy chủ của bạn cần tạo mã thông báo xác thực an toàn.

00:09:51.000 --> 00:09:54.000
Đây là một bí mật được chia sẻ giữa các thiết bị của người dùng và máy chủ của bạn.

00:09:54.000 --> 00:10:00.000
Thiết bị sẽ sử dụng mã thông báo này để tự xác thực khi yêu cầu gói đặt hàng.

00:10:00.000 --> 00:10:05.000
Ví dụ này ban đầu trông rất giống với quy trình ủy quyền thanh toán thông thường mà chúng ta đã thấy trước đó.

00:10:05.000 --> 00:10:07.000
Hãy thêm chi tiết đơn hàng vào.

00:10:07.000 --> 00:10:19.000
Đầu tiên, lấy chúng từ serverResult, sau đó tạo đối tượng PKPaymentOrderDetails, đặt ID Loại Đơn hàng, ID đơn hàng, URL dịch vụ web và mã thông báo xác thực.

00:10:19.000 --> 00:10:23.000
Gán cái này cho kết quả ủy quyền PKPayment của bạn.

00:10:23.000 --> 00:10:29.000
Trên web, việc thêm chi tiết đơn hàng của bạn bằng API Yêu cầu Thanh toán W3C cũng rất đơn giản.

00:10:29.000 --> 00:10:33.000
Giống như trước đây, trích xuất chi tiết đơn hàng từ kết quả máy chủ.

00:10:33.000 --> 00:10:38.000
Trả lại các chi tiết đơn hàng này và dữ liệu bạn hoàn tất thanh toán.

00:10:38.000 --> 00:10:44.000
Sau khi chi tiết đơn hàng được trả lại thiết bị, những chi tiết đó sẽ được đồng bộ hóa trên mỗi thiết bị của người dùng.

00:10:44.000 --> 00:10:49.000
Mỗi thiết bị sẽ yêu cầu gói đơn hàng từ máy chủ của bạn, cung cấp chi tiết đơn hàng.

00:10:49.000 --> 00:10:54.000
Xác minh mã thông báo xác thực bằng cách khớp nó với mã thông báo bạn đã gửi cùng với chi tiết đơn hàng.

00:10:54.000 --> 00:10:59.000
Với điều kiện mã thông báo xác thực khớp, hãy trả lại gói đơn đặt hàng cho thiết bị.

00:10:59.000 --> 00:11:03.000
Bây giờ đơn đặt hàng đã sẵn sàng để hiển thị trong Wallet cho thiết bị đó.

00:11:03.000 --> 00:11:09.000
Bạn nên cố gắng sửa chữa đơn đặt hàng của mình càng sớm càng tốt để nó có sẵn ngay khi thiết bị yêu cầu.

00:11:09.000 --> 00:11:16.000
Nếu máy chủ của bạn không trả lại được đơn đặt hàng, thiết bị sẽ thử lại nhiều lần với mức lùi theo cấp số nhân.

00:11:16.000 --> 00:11:22.000
Chúng tôi đã thấy gói đặt hàng này được tham chiếu nhiều lần, nhưng chính xác thì nó bao gồm những gì?

00:11:22.000 --> 00:11:25.000
Các đơn đặt hàng được phân phối dưới dạng các gói đặt hàng.

00:11:25.000 --> 00:11:29.000
Chúng chứa mọi thứ cần thiết để hiển thị đơn đặt hàng của bạn cho người dùng và chứng minh đó là từ bạn.

00:11:29.000 --> 00:11:38.000
Gói đơn đặt hàng chứa từ điển JSON mô tả đơn đặt hàng của bạn, hình ảnh như logo của bạn và hình ảnh nội tuyến cho từng mặt hàng trong đơn đặt hàng của bạn.

00:11:38.000 --> 00:11:43.000
Tham khảo Hướng dẫn Giao diện Con người và các nguồn giới thiệu để được hướng dẫn tạo hình ảnh.

00:11:43.000 --> 00:11:47.000
Cũng bao gồm các tài nguyên được bản địa hóa như các tệp chuỗi.

00:11:47.000 --> 00:11:51.000
Theo dõi tổng kích thước đơn hàng và chỉ bao gồm những gì có liên quan.

00:11:51.000 --> 00:11:56.000
Tất cả nội dung này được mô tả trong một từ điển JSON khác được gọi là "biểu hiện".

00:11:56.000 --> 00:11:58.000
Bạn có thể nghĩ về nó như một mục lục.

00:11:58.000 --> 00:12:02.000
Nó chứa một tham chiếu đến tất cả các tệp trong gói đặt hàng.

00:12:02.000 --> 00:12:11.000
Chìa khóa cho một mục nhập là đường dẫn tệp tương đối và giá trị là tổng kiểm tra SHA256 của tệp, đây là tổng kiểm tra khác với những gì được sử dụng trong các phân tích cú pháp.

00:12:11.000 --> 00:12:15.000
Bây giờ những gì chúng ta cần làm là ký vào gói hàng để chứng minh tính xác thực của nó.

00:12:15.000 --> 00:12:20.000
Chữ ký xác minh rằng gói đặt hàng có nguồn gốc từ một nguồn đáng tin cậy - bạn.

00:12:20.000 --> 00:12:26.000
Nó là một chữ ký tin nhắn mật mã tách rời của bản kê khai, giống như các phân tích cú pháp.

00:12:26.000 --> 00:12:36.000
Ký vào bản kê khai bằng khóa riêng được liên kết với chứng chỉ ID Loại Đơn hàng của bạn và với Chứng chỉ Trung gian Quan hệ Nhà phát triển Toàn cầu của Apple, đảm bảo bạn sử dụng phiên bản mới của chứng chỉ.

00:12:36.000 --> 00:12:42.000
Để hoàn tất việc xây dựng đơn đặt hàng, chỉ cần nén gói và thay đổi phần mở rộng tệp thành đơn đặt hàng.

00:12:42.000 --> 00:12:45.000
Bây giờ là lúc để cập nhật đơn đặt hàng của bạn.

00:12:45.000 --> 00:12:53.000
Thông tin đặt hàng thường thay đổi theo thời gian; ví dụ, đơn đặt hàng quà tặng thú cưng mà khách hàng của bạn đã thực hiện trước đó hiện đang trên đường đến.

00:12:53.000 --> 00:12:59.000
Hỗ trợ cập nhật tự động cho phép bạn cung cấp bản cập nhật này cho khách hàng của mình một cách nhanh chóng và an toàn.

00:12:59.000 --> 00:13:07.000
Khách hàng của bạn hiện đã đặt hàng vật tư cho thú cưng của họ trong Wallet và đơn đặt hàng cho biết hỗ trợ cập nhật, vì vậy thiết bị sẽ đăng ký với dịch vụ web của bạn.

00:13:07.000 --> 00:13:15.000
Sau đó, đơn đặt hàng của khách hàng hiện đã được giao, vì vậy máy chủ của bạn sẽ thông báo cho tất cả các thiết bị đã đăng ký bằng cách sử dụng thông tin đăng ký.

00:13:15.000 --> 00:13:21.000
Khi thiết bị của khách hàng nhận được thông báo đẩy, bây giờ nó sẽ yêu cầu đơn đặt hàng từ máy chủ của bạn.

00:13:21.000 --> 00:13:25.000
Máy chủ của bạn sau đó trả lại gói đơn đặt hàng đã cập nhật cho thiết bị.

00:13:25.000 --> 00:13:32.000
Bây giờ chúng ta đã biết quy trình đặt hàng cơ bản hoạt động như thế nào, hãy chia nhỏ các bước chính xác mà bạn sẽ cần thực hiện để hỗ trợ cập nhật đơn hàng.

00:13:32.000 --> 00:13:36.000
Đầu tiên, chỉ ra rằng bạn hỗ trợ cập nhật cho một đơn đặt hàng.

00:13:36.000 --> 00:13:43.000
Thật dễ dàng để nói với Wallet rằng đơn đặt hàng của bạn hỗ trợ cập nhật; bạn chỉ cần bao gồm hai phần thông tin trong gói đơn đặt hàng.

00:13:43.000 --> 00:13:47.000
Trong order.json, thêm webServiceURL mà bạn muốn.

00:13:47.000 --> 00:13:51.000
Đây sẽ là cái mà bạn đã cung cấp trong chi tiết đơn hàng.

00:13:51.000 --> 00:13:57.000
Đồng thời thêm trường Mã thông báo xác thực, mà Ví sẽ sử dụng để chứng minh tính xác thực của nó khi yêu cầu cập nhật đơn hàng.

00:13:57.000 --> 00:14:02.000
Bạn sẽ phải quản lý khi các thiết bị yêu cầu thêm hoặc xóa bản thân khỏi đăng ký.

00:14:02.000 --> 00:14:07.000
Máy chủ của bạn phải có khả năng xử lý việc thêm hoặc xóa thông tin đăng ký.

00:14:07.000 --> 00:14:11.000
Nó phải có khả năng tìm thấy các thiết bị đã đăng ký cập nhật cho một đơn đặt hàng.

00:14:11.000 --> 00:14:15.000
Điều này cho phép máy chủ của bạn thông báo cho các thiết bị này khi bạn cập nhật đơn hàng.

00:14:15.000 --> 00:14:23.000
Máy chủ của bạn cũng phải có khả năng tìm thấy các đơn đặt hàng mà một thiết bị đã đăng ký để máy chủ của bạn biết đơn đặt hàng cập nhật nào có liên quan đến thiết bị đó.

00:14:23.000 --> 00:14:26.000
Có nhiều cách khác nhau để bạn có thể cấu trúc thông tin này.

00:14:26.000 --> 00:14:35.000
Một cách sẽ là sử dụng cơ sở dữ liệu quan hệ với hai thực thể - một cho thiết bị và một cho các đơn đặt hàng - và mối quan hệ nhiều-nhiều để đăng ký.

00:14:35.000 --> 00:14:40.000
Khi đơn hàng được cập nhật, máy chủ của bạn cần thông báo cho các thiết bị đã đăng ký.

00:14:40.000 --> 00:14:50.000
Vì vậy, máy chủ của bạn cần lấy các thiết bị có liên quan dựa trên thông tin đăng ký được lưu trữ, sau đó gửi thông báo đẩy đến từng thiết bị bằng mã thông báo đẩy của nó.

00:14:50.000 --> 00:14:54.000
ID Loại Đơn hàng tăng gấp đôi như chủ đề đẩy và tải trọng phải trống.

00:14:54.000 --> 00:14:59.000
Bạn có thể sử dụng chứng chỉ ID Loại Đơn hàng để giao tiếp với APNs.

00:14:59.000 --> 00:15:08.000
Một điều nữa cần lưu ý về thông báo là thông báo thay đổi thuộc tính enum có thể được đặt trên gói đơn đặt hàng để tùy chỉnh cách bạn muốn thông báo đặt hàng được gửi.

00:15:08.000 --> 00:15:16.000
Các tùy chọn có sẵn được bật, sẽ luôn gửi thông báo cập nhật đơn hàng và là giá trị mặc định.

00:15:16.000 --> 00:15:26.000
Nếu bạn không muốn Wallet sao chép thông báo của mình, hãy đặt disableIfAppInstalled sẽ không gửi thông báo nếu người dùng đã cài đặt ứng dụng mà bạn đã liệt kê trong gói đặt hàng.

00:15:26.000 --> 00:15:32.000
Mỗi thiết bị đã đăng ký sẽ yêu cầu gói đặt hàng mới mà máy chủ của bạn sẽ cung cấp.

00:15:32.000 --> 00:15:38.000
Khi một thiết bị nhận được thông báo đẩy, nó vẫn chưa biết đơn hàng nào đã thay đổi, vì thông báo đẩy trống.

00:15:38.000 --> 00:15:44.000
Cùng với máy chủ của bạn, thiết bị sẽ tìm ra đơn đặt hàng nào đã thay đổi kể từ lần cuối cùng nó yêu cầu chúng.

00:15:44.000 --> 00:15:50.000
Sử dụng thông tin đăng ký mà máy chủ của bạn lưu trữ để tìm các đơn đặt hàng có liên quan, sau đó trả lại ID của họ.

00:15:50.000 --> 00:15:58.000
Theo dõi thời gian cập nhật và bao gồm thẻ sửa đổi trong phản hồi của bạn để giới hạn số lượng ID Đơn hàng được trả lại bởi các yêu cầu trong tương lai.

00:15:58.000 --> 00:16:01.000
Ví dụ, bạn có thể sử dụng dấu thời gian.

00:16:01.000 --> 00:16:03.000
Giá trị không rõ ràng đối với thiết bị.

00:16:03.000 --> 00:16:08.000
Thiết bị sẽ cung cấp thẻ sửa đổi vào lần tới khi nó yêu cầu thay đổi.

00:16:08.000 --> 00:16:13.000
Cuối cùng, thiết bị sẽ yêu cầu gói mới nhất cho mỗi đơn hàng mà máy chủ của bạn chỉ định được cập nhật.

00:16:13.000 --> 00:16:16.000
Hôm nay chúng tôi đã đề cập rất nhiều.

00:16:16.000 --> 00:16:19.000
Thực hiện theo các phương pháp này để cung cấp trải nghiệm khách hàng tốt nhất có thể.

00:16:19.000 --> 00:16:26.000
Khi triển khai Apple Pay, hãy cung cấp thanh toán nhanh bằng cách hiển thị nút Apple Pay trên trang sản phẩm hoặc giỏ hàng.

00:16:26.000 --> 00:16:31.000
Người dùng có thể chọn các tùy chọn và địa chỉ giao hàng trực tiếp trong bảng thanh toán và thanh toán mà không cần nhập bất cứ thứ gì.

00:16:31.000 --> 00:16:38.000
Khi triển khai theo dõi đơn hàng, hãy sử dụng kiến thức bạn có về sở thích của khách hàng để chỉ cung cấp các bản địa hóa có liên quan.

00:16:38.000 --> 00:16:43.000
Ngoài ra, hãy lưu ý đến số lượng tài sản bạn bao gồm để giữ cho kích thước gói đặt hàng nhỏ.

00:16:43.000 --> 00:16:48.000
Khi bạn cập nhật đơn hàng, hãy thông báo kịp thời cho các thiết bị đã đăng ký cập nhật đơn hàng đó.

00:16:48.000 --> 00:16:51.000
Các đơn đặt hàng trong Wallet phải khớp với trạng thái thực tế của đơn đặt hàng.

00:16:51.000 --> 00:16:58.000
Đảm bảo cũng kiểm tra Nguyên tắc Giao diện Con người để theo dõi đơn hàng và cũng như hiển thị nút Apple Pay.

00:16:58.000 --> 00:17:02.000
Hôm nay, tôi đã đề cập đến việc bắt đầu triển khai Apple Pay thông qua việc xây dựng và cập nhật đơn đặt hàng.

00:17:02.000 --> 00:17:12.000
Bài nói chuyện này nhằm giới thiệu cho bạn cách triển khai Apple Pay và theo dõi đơn hàng, nhưng bạn chắc chắn nên xem tài liệu được liên kết trong ghi chú phiên để tìm hiểu thêm chi tiết.

00:17:12.000 --> 00:17:16.000
Ngoài ra, bạn có thể xem video WWDC gần đây nhất của chúng tôi.

00:17:16.000 --> 00:17:19.000
Cảm ơn bạn rất nhiều vì đã dành thời gian cho ngày hôm nay.

00:17:19.000 --> 23:59:59.000
Và tôi hy vọng bạn tận hưởng phần còn lại của ngày.

