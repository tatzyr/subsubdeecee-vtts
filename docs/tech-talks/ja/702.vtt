WEBVTT

00:00:01.000 --> 00:00:04.000
こんにちは、私はNFCチームのローレンスです。

00:00:04.000 --> 00:00:07.000
このCore NFCアップデートへようこそ。

00:00:07.000 --> 00:00:20.000
今年はCore NFCの新機能があり、NFCエクスペリエンスを強化するだけでなく、アプリケーション内でNFCタグを処理するプロセスを大幅に簡素化します。

00:00:20.000 --> 00:00:28.000
Core NFCを初めての場合は、昨年リリースされた「Introduction to Core NFC」ビデオを見ることをお勧めします。

00:00:28.000 --> 00:00:36.000
新しいバックグラウンドタグ読み取り機能により、iPhoneは自動的にNFCタグを読み取り、適切なアプリに配信することができます。

00:00:36.000 --> 00:00:43.000
このメカニズムは、必要なアプリの起動を実行したり、アプリケーションをフォアグラウンド状態にしたりすることができます。

00:00:43.000 --> 00:00:52.000
私たちは、これがユーザーエクスペリエンスをさらに良くし、アプリがNFCタグを簡単に処理できるようにする方法を見て興奮しています。

00:00:52.000 --> 00:01:04.000
このビデオでは、NFCタグのデータ要件、予想されるユーザーエクスペリエンス、バックグラウンドタグの読み取りがサポートされている場合、および開始するためのコードスニペットの例について説明します。

00:01:04.000 --> 00:01:11.000
バックグラウンドタグの読み取りは、NFDEFメッセージにURLレコードが含まれているNDEF形式のタグで動作します。

00:01:11.000 --> 00:01:17.000
NDEFメッセージで最初に検出されたURLレコードのみが処理されます。

00:01:17.000 --> 00:01:25.000
メッセージをアプリケーションにルーティングするには、URLレコードに有効なAppleユニバーサルリンクURLが含まれている必要があります。

00:01:25.000 --> 00:01:31.000
iOSは、Apple Universal Linkに登録されているアプリケーションにメッセージをルーティングします。

00:01:31.000 --> 00:01:36.000
画面がオンになっている間、背景タグの読み取りは近くのNFCタグをスキャンします。

00:01:36.000 --> 00:01:43.000
互換性のあるタグが正常に読み込まれると、通知センターからのポップアップがiPhoneの画面に表示されます。

00:01:43.000 --> 00:01:53.000
通知をタップすると、Apple Universal Linkメカニズムを使用して、関連するアプリケーションへのNSUserActivityオブジェクトの配信がトリガーされます。

00:01:53.000 --> 00:02:01.000
デフォルトでは、Safariは未登録のアプリケーションリンクをすべて処理し、URLペイロードのみを処理します。

00:02:01.000 --> 00:02:09.000
デフォルトのiOSの動作を引き起こす他のURLスキームもありますが、これについては後で説明します。

00:02:09.000 --> 00:02:15.000
未処理の通知は、今後の参照のために通知センターに保存されます。

00:02:15.000 --> 00:02:19.000
ユーザーがNFCタグをタップすると次のようになります。

00:02:19.000 --> 00:02:24.000
通知が表示され、通知をタップすると、登録されたアプリケーションが起動します。

00:02:24.000 --> 00:02:30.000
アプリケーションが実行されると、NFCタグを再度タップすると、新しい通知がトリガーされます。

00:02:30.000 --> 00:02:50.000
タグがロックされた状態で読み込まれると、タグデータを処理する前に、最初に電話のロックを解除するように求められます。

00:02:50.000 --> 00:03:07.000
背景タグの読み取りは、iPhone XS、iPhone XS Max、iPhone XRでサポートされています。

00:03:07.000 --> 00:03:13.000
バックグラウンドタグの読み取りが動作するためには、起動後、まず少なくとも1回はロックを解除する必要があります。

00:03:13.000 --> 00:03:34.000
最初のロック解除後、デバイスは、次の条件を除いて、ロック状態に関係なく、ディスプレイがオンになっているたびにバックグラウンドでNFCタグをスキャンします。コアNFCリーダーセッションが進行中、ウォレットまたはApple Payが使用中、カメラが使用中、またはデバイスが機内モードです。

00:03:34.000 --> 00:03:41.000
それでは、NFCタグの内容を受け取るために、アプリケーションに必要な実装手順を順を追って説明します。

00:03:41.000 --> 00:03:44.000
これは3つの主要なステップに分かれています。

00:03:44.000 --> 00:03:51.000
ユニバーサルリンクの要件に従って、アプリケーションに関連付けられたドメインを登録する必要があります。

00:03:51.000 --> 00:04:00.000
次に、UIApplicationDelegateプロトコル、application(_:continue: restorationHandler:)機能を採用する必要があります。

00:04:00.000 --> 00:04:10.000
最後に、NSUserActivityオブジェクトのndefMessagePayloadプロパティからNDEFメッセージを抽出する必要があります。

00:04:10.000 --> 00:04:19.000
アプリにドメインを登録するには、Xcodeでプロジェクトを開き、関連するドメインセクションにサーバーホストドメインを入力します。

00:04:19.000 --> 00:04:27.000
これは、UIKitアプリケーションでNSUserActivityオブジェクトを受け取る方法を示すコードスニペットです。

00:04:27.000 --> 00:04:30.000
まず、コアNFCフレームワークをインポートします。

00:04:30.000 --> 00:04:38.000
UIApplicationDelegateプロトコルメソッド、アプリケーション(_:continue: restorationHandler:)を実装します。

00:04:38.000 --> 00:04:47.000
ハンドラでアクティビティタイプがNSUserActivityTypeBrowsingWebであることを検証します。

00:04:47.000 --> 00:04:53.000
ndefMessagePayloadプロパティからNFCNDEFMessageを読み取ります。

00:04:53.000 --> 00:04:58.000
これには、NFCタグから読み取られたNDEFメッセージ全体が含まれています。

00:04:58.000 --> 00:05:03.000
メッセージには、NFC NDEFペイロードレコードの配列が含まれています。

00:05:03.000 --> 00:05:11.000
各NDEFレコードには、typeNameFormat、Type、Identifier、およびデータペイロードが含まれています。

00:05:11.000 --> 00:05:20.000
NFC NDEFペイロードの1つには、アプリケーションの起動をトリガーしたユニバーサルリンクのURLレコードが含まれます。

00:05:20.000 --> 00:05:26.000
さまざまなレコードタイプの定義については、NFCフォーラムの仕様を参照してください。

00:05:26.000 --> 00:05:46.000
受信したNSUserActivityオブジェクトがバックグラウンドタグの読み取りから発信されていない場合、結果のNFCNDEFMessageには、typeNameFormatプロパティがNFCTypeNameFormatEmptyに設定された正確に1つのNFC NDEFペイロードオブジェクトが含まれます。

00:05:46.000 --> 00:05:59.000
URLレコードにユニバーサルリンクが含まれていない場合でも、iOSはHomeKit、SMS、GPSなどのQRコードスキャナと同じURIスキームの多くを処理できます。

00:05:59.000 --> 00:06:04.000
以下は、サポートされているさまざまなスキームの例です。

00:06:04.000 --> 23:59:59.000
Core NFCの詳細については、developer.apple.comをご覧ください。

