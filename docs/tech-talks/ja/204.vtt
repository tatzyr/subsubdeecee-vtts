WEBVTT

00:00:01.000 --> 00:00:09.000
アプリ開発者として、アプリがディスクに何を保存しているのか、すべてがどこに保存されているのか、なぜそれが必要なのかを正確に知ることが重要です。

00:00:09.000 --> 00:00:17.000
これらの詳細を把握する最善の方法は、アプリが実際に保存しているものを棚卸しすることです。

00:00:17.000 --> 00:00:25.000
開始するには、デバイスでアプリを構築して実行し、ディスクに物事を保存するすべての機能を行使します。

00:00:25.000 --> 00:00:30.000
これを行うと、実際に何が保存され、どこで保存されているかを見る時が来ました。

00:00:30.000 --> 00:00:38.000
Xcodeのデバイスとシミュレーターウィンドウを使用して、アプリのコンテナを抽出し、その中に何が入っているかを確認できます。

00:00:38.000 --> 00:00:45.000
左側の列でデバイスを選択し、インストール済みアプリリストでアプリを選択します。

00:00:45.000 --> 00:00:53.000
そして、歯車アイコンを使用して、ダウンロードコンテナを選択し、Macに保存します。

00:00:53.000 --> 00:00:59.000
Finderで、ダウンロードしたxcappdataファイルをControlキーを押しながらクリックします。

00:00:59.000 --> 00:01:06.000
「パッケージ内容を表示」を選択し、「App Data」フォルダに移動し、インベントリを開始します。

00:01:06.000 --> 00:01:12.000
ディレクトリを見て、それぞれに何が保存されているかを確認してください。

00:01:12.000 --> 00:01:17.000
各ファイルについて、それが何であるか、なぜそれが保存されているのかを特定できることを確認してください。

00:01:17.000 --> 00:01:22.000
なぜ何かがあるのかわからない場合は、それを取り除くことができるかもしれません。

00:01:22.000 --> 00:01:31.000
適切なディレクトリに正しいファイルを入れていることを確認し、そのファイルをiTunesとiCloudのバックアップに含めるかどうかも検討する必要があります。

00:01:31.000 --> 00:01:37.000
アプリの機能に関係しているため、最初の2つの質問に答えることができるのはあなただけです。

00:01:37.000 --> 00:01:42.000
最後の2つの質問に焦点を当て、ファイルを保存する場所から始めます。

00:01:42.000 --> 00:01:49.000
iCloud Driveは、ユーザーのすべてのデバイスで使用可能になるため、ドキュメントを置くのに最適な場所です。

00:01:49.000 --> 00:02:00.000
iCloud Drive上のアプリのフォルダの内容が表示されるため、人々が認識して直接アクセスするドキュメントのみを入れることが重要です。

00:02:00.000 --> 00:02:09.000
アプリはコンテンツをローカルで読み書きし、ネットワークが利用可能になると、オペレーティングシステムは自動的にそれらのファイルをアップロードします。

00:02:09.000 --> 00:02:18.000
複数のデバイスが同時にiCloud Driveのファイルにアクセスしている可能性があるため、競合を避けるためにファイル調整を使用する必要があります。

00:02:18.000 --> 00:02:22.000
詳細については、必ずドキュメントをお読みください。

00:02:22.000 --> 00:02:28.000
ローカルに保存されたファイルの場合、ドキュメントディレクトリはアプリのコンテナで使用できます。

00:02:28.000 --> 00:02:33.000
iCloud Driveと同様に、ここにはユーザーに表示されるドキュメントのみを保存する必要があります。

00:02:33.000 --> 00:02:44.000
ドキュメントディレクトリに公開する必要があるファイルのみが含まれていることを確認したら、ファイルアプリはOn My iPhoneまたはOn My iPadの場所に表示できます。

00:02:44.000 --> 00:02:54.000
これを行うには、アプリはOpen in Placeをサポートし、ファイル共有が有効になっていることを示す必要があります。どちらもInfo.plistファイルで設定されています。

00:02:54.000 --> 00:03:04.000
ファイルアプリで自分のファイルを見ることに加えて、人々はSpotlightやiPadで自分のファイルを他のアプリにドラッグアンドドロップすることができます。

00:03:04.000 --> 00:03:14.000
ドキュメントディレクトリを公開するもう1つの大きな利点は、ストレージ設定UIでファイルを表示し、アイテムを個別に削除できることです。

00:03:14.000 --> 00:03:22.000
これにより、ディスク容量の管理がはるかに簡単になり、容量が少ないときにアプリ全体が削除される可能性が低くなります。

00:03:22.000 --> 00:03:29.000
しかし、ドキュメントディレクトリに入るべき唯一のものは、あなたのアプリを使用している人々にとって意味のあるファイルであることを覚えておいてください。

00:03:29.000 --> 00:03:35.000
あなたが尋ねるべき重要な質問は、「私のユーザーはこのファイルを見ることができるべきですか？」です。

00:03:35.000 --> 00:03:38.000
答えがイエスなら、それでいい。

00:03:38.000 --> 00:03:45.000
しかし、答えが「いいえ」の場合は、ドキュメントディレクトリから次のいずれかの場所に移動します。

00:03:45.000 --> 00:03:54.000
アプリケーションサポートディレクトリは、ドキュメントディレクトリにあるかもしれないが、ユーザーが見るべきではないファイルを保存するのに適した場所です。

00:03:54.000 --> 00:04:00.000
たとえば、アプリが必要とするが、ユーザーが手動で開くことのないデータベース。

00:04:00.000 --> 00:04:06.000
ファイルをトップレベルに保存することも、物事を整理するのに役立つ場合はディレクトリを作成することもできます。

00:04:06.000 --> 00:04:10.000
ディレクトリは完全にあなたの管理下にあり、永続的です。

00:04:10.000 --> 00:04:18.000
コンテンツはデフォルトでバックアップに含まれていますが、バックアップする必要がない場合は、ファイルをオプトアウトできます。

00:04:18.000 --> 00:04:28.000
そして最後に、アプリケーションサポートディレクトリで使用されるディスク容量は、アプリのドキュメントとデータの合計の下のストレージ設定UIで報告されます。

00:04:28.000 --> 00:04:32.000
アプリで利用可能な次の場所は、Cachesディレクトリです。

00:04:32.000 --> 00:04:36.000
スペースが少ない場合に破棄できるファイルをここに保存できます。

00:04:36.000 --> 00:04:41.000
これは、必要なときに再ダウンロードできるコンテンツに適した場所です。

00:04:41.000 --> 00:04:45.000
キャッシュディレクトリの内容はバックアップに含まれていません。

00:04:45.000 --> 00:04:51.000
デバイスのディスク容量が少ない場合、iOSはキャッシュをクリアすることで役立ちます。

00:04:51.000 --> 00:05:01.000
アプリが実行されている場合、ファイルはキャッシュディレクトリから削除されることはなく、オペレーティングシステムはしばらく使用されていないアプリのキャッシュをクリアすることから始めます。

00:05:01.000 --> 00:05:08.000
ボーナスとして、キャッシュディレクトリ内のファイルは、アプリのドキュメントとデータの合計の一部として報告されません。

00:05:08.000 --> 00:05:13.000
それらはアプリが占める全体的なスペースに含まれていますが。

00:05:13.000 --> 00:05:20.000
そして最後に、長期間必要ないファイルを一時ディレクトリに配置できます。

00:05:20.000 --> 00:05:29.000
アプリが実行されていないとき、オペレーティングシステムはこれらのファイルを定期的に削除しますが、使い終わったら削除するのが最善です。

00:05:29.000 --> 00:05:37.000
キャッシュディレクトリと同様に、一時ディレクトリはバックアップされず、アプリのドキュメントとデータの合計には報告されません。

00:05:37.000 --> 00:05:41.000
これらはすべて、アプリがファイルを保存できる一般的な場所です。

00:05:41.000 --> 00:05:53.000
ファイルアプリでアクセスできるファイルにはiCloud Driveとドキュメントディレクトリを使用しますが、アプリケーションサポート、キャッシュ、および一時ディレクトリはすべてアプリが個人的に使用できます。

00:05:53.000 --> 00:05:57.000
物を保存する場所を必ず確認し、適切なディレクトリを使用してください。

00:05:57.000 --> 00:06:01.000
最後に、いくつかのベストプラクティスのヒント。

00:06:01.000 --> 00:06:12.000
iTunesやiCloudのバックアップに含める必要のないファイルがある場合は、NSFileManager APIを使用して「IsExcludedFromBackupKey」を設定してください。

00:06:12.000 --> 00:06:18.000
また、古いバージョンのアプリから復元される可能性のあるファイルに対しても回復力があります。

00:06:18.000 --> 00:06:32.000
たとえば、アプリの32ビットバージョンがあり、そのファイルがバックアップされている場合、アプリの64ビットバージョンでは、それらの古いファイルが復元される可能性があり、その状況を処理できる必要があります。

00:06:32.000 --> 00:06:40.000
アプリの複数のバージョン間で堅牢な互換性を提供できるように、ファイルにバージョン管理スキームを使用するのが最善です。

00:06:40.000 --> 00:06:44.000
そして、ファイルを1か所にしか保存していないことを確認してください。

00:06:44.000 --> 00:06:51.000
たとえば、ファイルをローカルのドキュメントディレクトリに入れる場合は、iCloud Driveでファイルを複製しないでください。

00:06:51.000 --> 00:06:53.000
1つの場所を選択し、それに固執します。

00:06:53.000 --> 00:07:05.000
ユーザードキュメントについては、デバイスにローカルのみファイルを保存する特定の理由がない限り、クラウドストレージの場所を好むことをお勧めします。

00:07:05.000 --> 00:07:16.000
そして最後に、iOS 11では、アプリがより多くのディスク容量を占有するのに良い時期かどうかを知るのに役立つ新しいボリューム容量の詳細がいくつか用意されています。

00:07:16.000 --> 00:07:28.000
最初のキー「重要な使用のために利用可能な容量」は、ユーザーがアプリのUIで明示的に要求したものに利用できるスペースの量を示します。

00:07:28.000 --> 00:07:34.000
例えば、彼らがビデオやゲームの新しいレベルをダウンロードすることを選択した場合。

00:07:34.000 --> 00:07:41.000
必要なスペースが利用可能なスペースよりも大きい場合は、彼らの要求を満たすことができないことを彼らに知らせるべきです。

00:07:41.000 --> 00:07:53.000
2番目のキー「Oportunistic Usageの利用可能な容量」は、ユーザーが望む可能性が高いが、明示的に要求していないものに利用可能なスペースの量を示します。

00:07:53.000 --> 00:08:02.000
これは、彼らが見ている一連のビデオの次のエピソード、または彼らが開く可能性のあるサーバー上の最近更新されたドキュメントのようなものかもしれません。

00:08:02.000 --> 00:08:15.000
これらのタイプのファイルについては、実際に使用されるまで最初にCachesディレクトリに保存し、その時点でアプリケーションサポートまたはドキュメントディレクトリに移動できます。

00:08:15.000 --> 00:08:24.000
インベントリを取り、アプリが保存したものを特定した後、適切な場所にないものを見つけた場合は、コードを更新して適切なディレクトリに入れます。

00:08:24.000 --> 00:08:30.000
また、ある場所から別の場所にファイルを移動するために必要な移行コードを追加することを忘れないでください。

00:08:30.000 --> 00:08:35.000
これをしないと、誤って放棄されたファイルを置き去りにする可能性があります。

00:08:35.000 --> 00:08:43.000
ディスク上のストレージをクリーンアップすることで、ドキュメントディレクトリをファイルアプリの人々に開くことができ、アプリで生産性をさらに高めることができます。

00:08:43.000 --> 00:08:48.000
詳細については、developer.apple.comまたは開発者フォーラムをご覧ください。

00:08:48.000 --> 23:59:59.000
見てくれてありがとう!

