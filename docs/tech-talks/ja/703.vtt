WEBVTT

00:00:01.000 --> 00:00:05.000
こんにちは、私の名前はマイケル・フォードで、CloudKitチームのエンジニアです。

00:00:05.000 --> 00:00:09.000
今日はGDPRとCloudKitについて話します。

00:00:09.000 --> 00:00:13.000
GDPRは一般データ保護規則の略です。

00:00:13.000 --> 00:00:19.000
これは、2018年5月25日に施行された欧州連合の規制です。

00:00:19.000 --> 00:00:27.000
この規制は、ユーザーが個人データと企業の使用方法を可視化し、制御することに重点を置いています。

00:00:27.000 --> 00:00:37.000
Appleでは、ユーザーのプライバシーを大切にしており、開発者がユーザーのプライバシーを保護しながら優れたアプリケーションを構築するために必要なツールを持っていることを確認したいと考えています。

00:00:37.000 --> 00:00:48.000
この講演では、GDPRやその他の規制に関連するユーザーの要求を満たすために使用できる新規および既存のCloudKit APIについて説明します。

00:00:48.000 --> 00:00:57.000
より広範なプライバシーに関する議論に興味がある場合は、WWDC 2018の「より良いプライバシーを通じたより良いアプリ」セッションをご覧ください。

00:00:57.000 --> 00:01:02.000
さて、「なぜ私たちはCloudKit APIについてだけ話しているのですか？」と尋ねるかもしれません。

00:01:02.000 --> 00:01:09.000
開発者が利用できるiCloud同期サービスのいくつかについて話しましょう。すぐにその理由がわかります。

00:01:09.000 --> 00:01:18.000
開発者として、iCloud Backup、Key Value Store、iCloud Drive、CloudKitを使用して、ユーザーデータをiCloudに保存できます。

00:01:18.000 --> 00:01:24.000
データの分離、データインタラクション、APIの可用性について話しましょう。

00:01:24.000 --> 00:01:31.000
バックアップ、キーバリュー、およびiCloud Driveの場合、データは常に1人のユーザーのために保存されます。

00:01:31.000 --> 00:01:40.000
CloudKitは、ユーザー間でデータを共有したり、すべてのユーザーがデータを利用できるようにしたりできる、より柔軟なAPIを開発者に提供します。

00:01:40.000 --> 00:01:47.000
ユーザーがiCloudバックアップの復元を開始すると、保存されたアプリケーションデータが自動的に復元されます。

00:01:47.000 --> 00:01:58.000
キーバリューストアとiCloud Driveに保存されたアプリケーションデータは、ユーザーがiCloudアカウントにサインインしているすべてのデバイス間で自動的に同期されます。

00:01:58.000 --> 00:02:04.000
対照的に、アプリケーションがCloudKitに保存するデータは、自動的に別のデバイスにミラーリングされません。

00:02:04.000 --> 00:02:12.000
Fetch Changes APIまたはQuery APIを使用して、CloudKitに保存されているデータの全部または一部にアクセスできます。

00:02:12.000 --> 00:02:17.000
バックアップ、キーバリュー、およびドライブAPIは、デバイスでのみ利用可能です。

00:02:17.000 --> 00:02:28.000
デバイスでObjective-CまたはSwiftバージョンのCloudKit APIを使用するか、CloudKit Webサービスを使用してブラウザからCloudKitデータにアクセスできます。

00:02:28.000 --> 00:02:31.000
ご覧のとおり、CloudKitはユニークです。

00:02:31.000 --> 00:02:34.000
それはより柔軟で、それと対話する方法がもっとあります。

00:02:34.000 --> 00:02:45.000
iCloudバックアップ、キーバリューストア、またはiCloud Driveに保存されたデータに対するGDPR要求を満たす場合、アプリケーションがローカルに保存した他のデータと同様にデータを処理できます。

00:02:45.000 --> 00:02:52.000
ただし、CloudKitでは、GDPR要求を完了するためにサーバーと対話する必要があるかもしれません。

00:02:52.000 --> 00:02:58.000
さて、GDPRについてもっと話すとき、私は弁護士ではなくエンジニアであることを覚えておいてください。

00:02:58.000 --> 00:03:03.000
GDPRコンプライアンスについて質問がある場合は、弁護士に相談してください。

00:03:03.000 --> 00:03:08.000
そうは言っても、GDPRによって保証されているユーザー権利の一部に入りましょう。

00:03:08.000 --> 00:03:14.000
GDPRは、どのようなデータが保存され、どのように使用されているかを知る権利をユーザーに保証します。

00:03:14.000 --> 00:03:18.000
ユーザーは、それらについて保存されたデータにアクセスする権利を有します。

00:03:18.000 --> 00:03:20.000
彼らにはデータをエクスポートする権利がある。

00:03:20.000 --> 00:03:25.000
ユーザーは、データの処理を一時停止するように要求できます。

00:03:25.000 --> 00:03:27.000
彼らは自分のデータの削除を要求することができます。

00:03:27.000 --> 00:03:31.000
これは一般的に忘れられる権利として知られています。

00:03:31.000 --> 00:03:36.000
ユーザーに関するデータが間違っている場合、ユーザーはそれを更新できるはずです。

00:03:36.000 --> 00:03:39.000
ユーザーは、データの使用方法に異議を唱えることもできます。

00:03:39.000 --> 00:03:46.000
例としては、ダイレクトマーケティングに異議を唱えることや、科学研究のためにユーザーのデータを処理することに異議を唱えることなどがあります。

00:03:46.000 --> 00:03:55.000
最後に、自動化された意思決定がユーザーに法的または重大な影響を与える可能性がある場合、ユーザーは人間の介入にアクセスする必要があります。

00:03:55.000 --> 00:03:57.000
さて、それはかなりのリストです。

00:03:57.000 --> 00:04:03.000
今日は、CloudKitを使用している開発者に広く適用される権利に焦点を当てます。

00:04:03.000 --> 00:04:07.000
これは、GDPRコンプライアンスに関する包括的な話ではありません。

00:04:07.000 --> 00:04:17.000
代わりに、新規および既存のCloudKit APIを使用して、GDPRやその他の規制に関連するユーザー要求を満たす方法に焦点を当てます。

00:04:17.000 --> 00:04:21.000
まず、CloudKit内の概念のいくつかを見てみましょう。

00:04:21.000 --> 00:04:23.000
最高レベルはCloudKitコンテナです。

00:04:23.000 --> 00:04:28.000
複数のアプリケーションが同じCloudKitコンテナと対話することができます。

00:04:28.000 --> 00:04:33.000
CloudKitコンテナの内部には、3種類のデータベースがあります。

00:04:33.000 --> 00:04:38.000
プライベートデータベース、共有データベース、およびパブリックデータベース。

00:04:38.000 --> 00:04:40.000
コンテナごとに1つのパブリックデータベースがあります。

00:04:40.000 --> 00:04:46.000
デフォルトでは、すべてのユーザーはパブリックデータベースでデータを読み書きできます。

00:04:46.000 --> 00:04:50.000
すべてのユーザーは、コンテナ内に独自のプライベートデータベースと共有データベースを持っています。

00:04:50.000 --> 00:04:54.000
プライベートデータベース内のデータは、そのユーザーのものです。

00:04:54.000 --> 00:05:03.000
アプリケーションが共有をサポートしている場合、ユーザーが共有招待を受け入れると、データは共有データベースに表示されます。

00:05:03.000 --> 00:05:09.000
これは、実際のデータが存在する所有者のプライベートデータベースへの参照です。

00:05:09.000 --> 00:05:12.000
特定のデータベース内では、複数のゾーンを持つことができます。

00:05:12.000 --> 00:05:18.000
プライベートデータベースとパブリックデータベースには、常にデフォルトゾーンがあります。

00:05:18.000 --> 00:05:22.000
また、プライベートデータベースでは、複数のカスタムゾーンを作成できます。

00:05:22.000 --> 00:05:27.000
共有データベースでは、共有招待を受け入れるとゾーンが表示されます。

00:05:27.000 --> 00:05:30.000
ゾーンの内側にはレコードがあります。

00:05:30.000 --> 00:05:33.000
これは、実際のデータを保存する場所です。

00:05:33.000 --> 00:05:38.000
CloudKitの概念階層を要約するには、まずコンテナがあります。

00:05:38.000 --> 00:05:41.000
次に、3つの異なるタイプのデータベースがあります。

00:05:41.000 --> 00:05:46.000
データベースでは、データベースの種類に応じて、1つ以上のゾーンを持つことができます。

00:05:46.000 --> 00:05:50.000
最後に、レコードはデータが保存される場所です。

00:05:50.000 --> 00:05:57.000
これらのコアCloudKitの概念を見直したので、個々のGDPRの権利に焦点を当てる準備が整いました。

00:05:57.000 --> 00:06:00.000
アクセスと移植性を一緒に見ていきます。

00:06:00.000 --> 00:06:04.000
これらの権利を果たすには、CloudKitからデータを取得する必要があります。

00:06:04.000 --> 00:06:08.000
削除するには、CloudKitからデータを削除する必要があります。

00:06:08.000 --> 00:06:15.000
また、制限については、CloudKit contianerのアカウントに制限を適用します。

00:06:15.000 --> 00:06:23.000
アクセスとポータビリティの要求については、ユーザーのためにCloudKit内に保存されているデータの可視性を提供する必要があります。

00:06:23.000 --> 00:06:27.000
また、ユーザーのデータを標準形式でエクスポートする方法も提供する必要があります。

00:06:27.000 --> 00:06:32.000
画像をエクスポートする場合は、JPEGファイル形式を使用するのが理にかなっています。

00:06:32.000 --> 00:06:39.000
一般的な構造化データの場合は、データの種類と量に応じて、JSONまたはCSVのいずれかを使用します。

00:06:39.000 --> 00:06:40.000
データをエクスポートしたばかりです。

00:06:40.000 --> 00:06:47.000
データをインポートする必要はありませんが、インポートすると一部のユーザーを獲得する可能性があります。

00:06:47.000 --> 00:06:56.000
すでにすべてのデータをローカルで同期している場合は、ローカルに保存したデータからGDPRアクセスまたはポータビリティ要求を満たすことができます。

00:06:56.000 --> 00:07:01.000
していない場合は、CloudKitサーバーからデータを取得する必要があります。

00:07:01.000 --> 00:07:05.000
では、CloudKitからすべてのデータを取得するにはどうすればよいですか?

00:07:05.000 --> 00:07:14.000
CloudKit階層内では、すべてのコンテナ、すべてのデータベースに対して、すべてのゾーンを取得し、すべてのレコードを照会する必要があります。

00:07:14.000 --> 00:07:18.000
あなたがそれをどのように行うかについて、いくつかのコードを確認しましょう。

00:07:18.000 --> 00:07:22.000
まず、コンテナ変数とデータベース変数を設定しましょう。

00:07:22.000 --> 00:07:27.000
この場合、プライベートデータベースに焦点を当てます。

00:07:27.000 --> 00:07:31.000
次に、データベース内のすべてのゾーンを取得します。 データベース内のゾーンを取得します。

00:07:31.000 --> 00:07:36.000
これらすべてのゾーンを反復し、クエリを設定します。

00:07:36.000 --> 00:07:42.000
このクエリは単一のレコードタイプのみであるため、複数のクエリを実行する必要がある場合があります。

00:07:42.000 --> 00:07:48.000
あなたが持っているすべてのレコードタイプをループしたり、個別に列挙したりできます。

00:07:48.000 --> 00:07:55.000
指定されたレコードタイプのすべてのレコードを取得できるように、常に真であるクエリにNSPredicateを渡します。

00:07:55.000 --> 00:07:59.000
次に、実際にデータベースでクエリを実行します。

00:07:59.000 --> 00:08:06.000
最後に、クエリが返されたら、レコードを表示するか、エクスポート用に保存する必要があります。

00:08:06.000 --> 00:08:10.000
プライベートデータベース内のすべてのレコードを照会するコードをお見せしました。

00:08:10.000 --> 00:08:15.000
共有データベースとパブリックデータベースはより複雑です。

00:08:15.000 --> 00:08:21.000
参加者にとって、共有データベースは、所有者のプライベートデータベースへの部分的なビューです。

00:08:21.000 --> 00:08:29.000
データは所有者に属しているため、参加者に関連する場合にのみデータを返す必要があります。

00:08:29.000 --> 00:08:32.000
パブリックデータベースにも同じことが言えます。

00:08:32.000 --> 00:08:36.000
デフォルトでは、どのユーザーでもパブリックデータベースにデータを読み書きできます。

00:08:36.000 --> 00:08:43.000
繰り返しになりますが、GDPR要求を行うユーザーに関連するデータのみを返す必要があります。

00:08:43.000 --> 00:08:45.000
削除は永遠です。

00:08:45.000 --> 00:08:49.000
ユーザーが本当にデータを大量に削除したいことを確認する必要があります。

00:08:49.000 --> 00:08:53.000
代替案として制限を提供したいと思うかもしれません。

00:08:53.000 --> 00:09:00.000
ユーザーがデータを削除したいことを確認した場合は、CloudKitからユーザーのデータをすべて削除する必要があります。

00:09:00.000 --> 00:09:03.000
今、そのためのコードを見てみましょう。

00:09:03.000 --> 00:09:07.000
もう一度、コンテナとデータベースの変数を設定します。

00:09:07.000 --> 00:09:10.000
プライベートデータベースに焦点を当てます。

00:09:10.000 --> 00:09:14.000
繰り返しますが、データベース内のすべてのゾーンを取得します。

00:09:14.000 --> 00:09:22.000
次に、個々のゾーンからzoneIDを引き出し、それらを使用して削除操作を作成します。

00:09:22.000 --> 00:09:28.000
この削除操作は、削除したいレコードゾーンIDを渡します。

00:09:28.000 --> 00:09:33.000
最後に、データベースに対して削除操作を実行します。

00:09:33.000 --> 00:09:37.000
プライベートデータベース内のすべてのゾーンを削除するコードを見ました。

00:09:37.000 --> 00:09:45.000
もう一度、アプリケーションが共有をサポートしている場合は、選択しますが、今回は削除するものを選択します。

00:09:45.000 --> 00:09:51.000
共有データベースのレコードを削除すると、所有者と共有の他のすべての参加者のためにそれらが削除されます。

00:09:51.000 --> 00:09:58.000
この方法で削除する必要があるデータがある場合は、ゾーンを削除する前にレコードの削除を実行してください。

00:09:58.000 --> 00:10:03.000
それが完了したら、ユーザーの共有データベース内のすべてのゾーンを削除します。

00:10:03.000 --> 00:10:11.000
個々のレコードを削除するのとは対照的に、これは所有者または共有の他の参加者のデータを削除しません。

00:10:11.000 --> 00:10:21.000
実際、共有データベースのゾーンの削除は、ユーザーが共有の参加者から招待された状態に変更します。

00:10:21.000 --> 00:10:25.000
これは、共有データベースのゾーンが表示されなくなったことを意味します。

00:10:25.000 --> 00:10:36.000
最後に、パブリックデータベースでは、特定のユーザーに関連して保存しているデータを確認し、どのデータを削除するのが適切かを判断する必要があります。

00:10:36.000 --> 00:10:38.000
最後に、制限について話しましょう。

00:10:38.000 --> 00:10:43.000
事実上、これはユーザーのデータの処理を一時停止または一時停止解除する方法です。

00:10:43.000 --> 00:10:49.000
GDPRでは、ユーザーが別の権利を行使したときに処理を一時停止する必要があるかもしれません。

00:10:49.000 --> 00:10:56.000
または、場合によっては、ユーザーがデータを削除するのではなく、データを制限するように要求する場合があります。

00:10:56.000 --> 00:11:01.000
アカウントを制限または制限解除するために使用できる2つの新しいWebサービスAPIを公開しました。

00:11:01.000 --> 00:11:08.000
適切な資格情報があれば、どのバージョンのiOSからでもこれらのウェブサービスAPIを呼び出すことができます。

00:11:08.000 --> 00:11:13.000
今、ユーザーを制限するコードについて話し合いましょう。

00:11:13.000 --> 00:11:17.000
まず、CloudKitダッシュボードでAPIトークンを生成する必要があります。

00:11:17.000 --> 00:11:23.000
APIトークンを取得したら、fetchAuthorization操作を作成できます。

00:11:23.000 --> 00:11:28.000
fetchAuthorization APIは、iOS 9.2で初めてリリースされました。

00:11:28.000 --> 00:11:35.000
apiTokenとwebTokenの両方を使用すると、Webサービスの制限コールを行うために必要なものがすべて揃っています。

00:11:35.000 --> 00:11:41.000
私たちはそれを制限ヘルパー機能で包んだので、今それを見てみましょう。

00:11:41.000 --> 00:11:45.000
まず、webTokenをURLエンコードする必要があります。

00:11:45.000 --> 00:11:52.000
baseURL、apiPath、およびクエリパラメータを組み合わせて、完全なWebサービスURLを作成します。

00:11:52.000 --> 00:11:59.000
完了したら、実際にHTTP投稿としてリクエストをCloudKitサーバーに送信する必要があります。

00:11:59.000 --> 00:12:04.000
今のところそのコードは確認しませんが、リンクされたドキュメントで見つけることができます。

00:12:04.000 --> 00:12:11.000
ユーザーを制限すると、そのコンテナに対する操作は、managedAccountRestrictedエラーになります。

00:12:11.000 --> 00:12:16.000
ユーザーがAppleを通じてiCloudアカウントを制限した場合も、このエラーが表示されます。

00:12:16.000 --> 00:12:26.000
Appleはユーザーのデータの処理を停止し、CloudKitリクエストに対してこのエラーを返すので、このエラーをコードで必ず処理してください。

00:12:26.000 --> 00:12:33.000
確認するには、アクセスと移植性のために、ユーザーのプライベートデータベース内のすべてのデータを返します。

00:12:33.000 --> 00:12:40.000
共有データベースとパブリックデータベースについては、どのデータをユーザーに戻すかを決定する際に識別してください。

00:12:40.000 --> 00:12:47.000
ユーザーの削除要求に応答するには、ユーザーのプライベートデータベース内のすべてのデータを削除できます。

00:12:47.000 --> 00:12:52.000
共有ゾーンを削除して、ユーザーを参加者として削除することもできます。

00:12:52.000 --> 00:12:57.000
パブリックデータベースの場合、どのデータを削除するかを決定するときは、識別してください。

00:12:57.000 --> 00:13:03.000
最後に、アカウントを制限または制限解除するための新しいウェブサービスAPIを導入しました。

00:13:03.000 --> 00:13:14.000
ユーザーを制限する場合、またはユーザーがAppleがiCloudアカウント全体の処理を制限するように要求した場合、managedAccountRestrictedエラーが表示されます。

00:13:14.000 --> 00:13:19.000
これらのツールを使用すると、アプリに優れたプライバシーを構築できることを知っています。

00:13:19.000 --> 23:59:59.000
詳細については、developer.apple.comにアクセスし、ご質問やご意見がございましたら、お気軽にcloudkit@apple.comまでメールでお問い合わせください。

