110380

♪ ♪

プラシャント:やあ、みんな。私はプラシャントです。

私はAVFoundationエンジニアで、WWDC2022へようこそ。

SharePlayの導入により、SharePlayグループと完全に同期しながら、リアルタイムでコンテンツをナビゲートして対話できる、接続された視聴体験を人々に提供できます。

ただし、コンテンツタイムラインにターゲット広告やその他のインタースティシャルがスケジュールされている人もいるため、異なる期間の広告を受信する参加者間の再生を調整したり、広告を受信する参加者が混在する参加者の間で再生を調整するのが困難です。

したがって、SharePlayで調整された再生のために広告やその他のインタースティシャルをスケジュールすることに興味がある場合は、適切なセッションにチューニングしました。

この講演では、調整された再生がどのように機能するかから始めます。

次に、調整された再生で広告やその他のインタースティシャルに関連する課題について確認します。

その後、広告を見るときに可能なさまざまな視聴体験について話し合います。

次に、ステッチイン広告でこれらをどのように達成できるかを見ていきます。

また、HLSインタースティシャルが調整された再生でどのように機能するかも見ます。

そして最後に、人々に本当に魅力的なSharePlay体験を提供するために使用できるいくつかのベストプラクティスについて説明します。

SharePlayで調整された再生がどのように機能するか見てみましょう。

したがって、参加者がFaceTime通話をしている間、1人の参加者のデバイスから発信された再生コントロールコマンドはグループ間で共有され、全員が同期して再生されます。

すべての参加者が同じコンテンツを見ている場合、これはうまく機能しますが、そのうちの何人かが広告を持っている場合はどうなりますか?

それでは、アリスとボブが番組のコンテンツを見ようとしているケースを見てみましょう。

さて、ここで見られるのは、それぞれの端でのプレゼンテーションのタイムラインです。

彼らが見ているのがプログラムコンテンツだけであれば、調整された再生を実現するのはかなり簡単なはずです。

グループセッションを再生コーディネーターに関連付けるだけで、行っても大丈夫です。

さて、それぞれにプログラム要約セグメントが縫い付けられており、スタジオまたはネットワークのバナーが先行しています。

これはかなり典型的であり、要約セグメントとバナーはアリスとボブと一致するので、調整された再生はまだ達成可能です。

しかし、今、アリスの地理では、サービスがプログラムの開始前にいくつかの法定警告を表示する必要があり、プログラム内のさまざまな時点で広告がスケジュールされている可能性もあります。

これらの広告は期間が異なる場合があります。

同期してプレイさせようとすると、これがどのように課題になるかがわかります。

ボブの場合、ネットワークバナーは冒頭に表示される場合がありますが、アリスの場合、警告が表示された後にのみ表示されます。

そして、プレゼンテーションのタイムラインで任意の時間を見ると、彼らはコンテンツの完全に異なる部分を見ているでしょう。

それでは、このようなシナリオで可能なユーザーエクスペリエンスについて少し考えてみましょう。

このために、それぞれが1つの広告だけを縫い合わせた、よりシンプルなタイムラインを考えてみましょう。

理想的なケースでは、経験は彼らが一人で番組を見ていた場所とあまり変わらないはずです。

それが可能になるように、広告の期間が一致することを期待しています。

これも私たちの好ましい経験になるでしょう。

さて、広告を見た後、両方とも同期して再生を再開します。

しかし、時には彼らは異なる期間の広告を取得するか、そのうちの1つがまったく広告を持っていないかもしれません。

だから今、彼らが同期してプレイするなら、2つの経験のうちの1つが可能です。

アリスが広告を終えたら、ボブの広告が終わるのを待ってから、同期して再開することができます。

または、彼女はメインプログラムを続けることができ、ボブはアリスに追いつくためにジャンプして、彼らが同期し続けるようにします。

このシナリオでは、ボブはアリスに追いつくときにいくつかのプログラムコンテンツを見逃してしまうでしょう。

さて、あなたはどのようにこれらの経験を可能にしますか?

suspensionReasonsThatTriggerWaiting配列の入力方法によって、AVPlaybackCoordinatorでこれらの待機ポリシーを指定できます。

デフォルトの動作は、一部の参加者が広告を見ている間、グループが待たないことです。

これらの参加者が広告を終えると、彼らはグループの残りの部分に追いつくためにいくつかのコンテンツを見逃すでしょう。

または、参加者が広告を見ている間、グループを待ちたい場合は、suspensionReasonsThatTriggerWaiting配列の一部として「playingInterstitial」サスペンション理由を含めることができます。

このポリシーでは、参加者が他の参加者が広告を完了するのを待っているとき、プレイヤーのtimeControlStatusはWaitToPlayAtSpecifiedRateになり、waitingReasonはForCoordinatedPlaybackを待っています。

では、先に説明したコンテンツに戻って、調整された再生タイムラインから除外されるこれらの時間範囲をどのように定義しますか?

例えば、法定警告はアリスだけが持っているもので、ボブは持っていないものです。

また、広告の休憩期間が異なる可能性もあります。

HLSは広告をスケジュールする2つの方法を提供していることをご存知かもしれません。

そのうちの1つは、広告セグメントをプライマリコンテンツのプレイリストに直接ステッチすることです。

したがって、不連続タグを使用して広告がステッチされたビデオオンデマンドコンテンツの場合、AVFoundation APIを使用してAVPlayerPlaybackCoordinatorで広告時間範囲を設定できます。

そのため、次のデリゲートメソッドを追加しました。これを使用して、コンテンツ内の広告とインタースティシャルを表すサンプルの正確な時間範囲の配列を指定できます。

AVPlayerPlaybackCoordinatorは、この情報を使用してグループ全体の再生を調整します。

参加者がこの時間範囲に入ると、指定された待機ポリシーに従って再生が調整されます。

また、インタースティシャルの種類によっては、誰かがこれらの時間範囲にナビゲートすることを許可するかもしれません。

したがって、SharePlay中にこれらの時間範囲を模索すると、グループ全体がその時間範囲の始まりにスナップします。

これは、プレイリストのEXTINFタグで報告された時間を合計して、広告時間範囲が入力されるプレイリストの例を示しています。

これは、EXTINFタグの一部として報告された期間が、それらのセグメントのメディア期間を正確に反映することを前提としています。

では、調整された再生が機能するために、資産がどのように見えるべきですか?

したがって、この例を見ると、アリスとボブはステッチされた期間の広告が異なるため、資産期間が異なります。

これらがSharePlay互換と見なされるためには、アセットの実際のコンテンツ期間が一致すると予想されます。

これはビデオオンデマンドコンテンツにのみ適用され、ステッチイン広告付きのライブコンテンツの場合、広告休憩の期間がすべての参加者と一致することが予想されます。

サンプルの正確な時間範囲を取得するのが難しいと思われる場合や、ライブコンテンツでターゲット広告を動的にスケジュールしたい場合は、HLSインタースティシャルを使用して広告をスケジュールできます。

2021年には、広告をスケジュールするための異なる、より柔軟なアプローチを提供するHLSインタースティシャルを導入しました。

詳細については、WWDC2021のHLSトークのExplore dynamic pre-rolls and mid-rollsをチェックしてください。

要するに、広告とインタースティシャルは、コンテンツタイムラインの外で別々のオブジェクトとして扱われます。

これらのオブジェクトは、マルチバリアントプレイリストを介して直接参照することができ、プライマリコンテンツのメディアプレイリストの日付範囲タグの一部としてマルチバリアントプレイリストURIを含めるだけでサーバーサイド広告挿入を実行したり、AVFoundation APIを使用してクライアント側で広告をスケジュールしたりすることもできます。

HLSインタースティシャルを使用して広告をスケジュールする場合、AVFoundationは調整された再生中に自動的にそれらを処理します。

あなたがする必要があるのは、待機ポリシーを指定することだけです。

HLSインタースティシャルを使用して広告をスケジュールする場合、もう一度、アセットがSharePlay互換と見なされるために、主要なコンテンツ期間がすべての参加者間で一致することを期待します。

それでは、人々に本当に良いSharePlay体験を提供するために使用できるベストプラクティスをいくつか紹介しましょう。

SharePlayは、人々が自分で見ているかのようにコンテンツと対話するシームレスな接続視聴体験を提供することを目的としています。

したがって、この経験を念頭に置いて、できるだけ待ち時間やコンテンツのスキップを最小限に抑えるよう努めるべきです。

そのため、待機時間やスキップ時間を最小限に抑えるように、広告の休憩期間を調整することをお勧めします。

一部の人が広告を持っていて、そうでない人がいて、全員がライブコンテンツを見ている参加者グループが混在している場合は、HLSインタースティシャルを使用して、デフォルトの待機ポリシーを使用しながら広告をスケジュールできます。

さて、広告のスケジューリング中に再開オフセットを指定しない場合、コンテンツは広告期間に等しいオフセットで再開されます。

このようなシナリオでは、広告のない参加者は主要なコンテンツを見続け、広告を見終わったら、他の参加者はその参加者に参加します。

ここでは、アリス、ボブ、チャーリーがライブコンテンツを見ています。

そのサービスのプレミアム加入者であるアリスには広告がありませんが、ボブとチャーリーはHLSインタースティシャルを使用してスケジュールされた異なる期間の広告を持っています。

ボブとチャーリーが広告休憩から出てきたときにアリスと同期している間、アリスがどのように番組を見続けているかを見ることができます。

さて、これがライブスポーツゲームだったら、ボブとチャーリーが広告を見ている間、アリスがどのようにライブスタジアムフィードを見ているかを想像することができます。

そして、彼らが広告休憩から出てくるとき、それはプレイの開始にちょうど間に合うでしょう。

参加者がプログラムのコンテンツを見逃す余裕がないビデオオンデマンドストリームでは、待機待機ポリシーを使用できます。

これで、GroupSessionMessengerを使用して、参加者間で広告スケジュールを共有できます。

そして、誰かが他の人が広告を見終わるのを待っているとき、あなたはすでにスケジュールを共有しているので、彼らがどのくらい待たなければならないかを正確に知ることができます。

だから今、彼らが待っている間、あなたはおそらくそれらを従事させるためにあなたのサービスの今後のアトラクションのようないくつかの興味深いコンテンツを表示するために別のプレーヤーを使用することができます。

まとめるには、調整された再生中に広告やその他のインタースティシャルをスケジュールするには、待機ポリシーを指定するだけで、ステッチイン広告がある場合は、AVFoundation APIを使用して再生コーディネーターの時間範囲を設定するか、HLSインタースティシャルを使用してAVFoundationが広告の再生を管理できるようにすることができます。

理想的なシナリオでは、すべての参加者が同じコンテンツを見ていることになります。

これが可能であるようにしたいので、必ずしもそうとは限りません。

広告を受信しないプレミアムサブスクライバー層を持つことができ、参加者が異なる期間の広告を受け取ることもできます。

このようなシナリオでは、プレミアム加入者は待機画面を見つめる必要はありません。

先ほど見たように、彼らにいくつかの興味深いコンテンツを見せたり、彼らを楽しませ続けるために他の体験を構築することもできます。

SharePlayでカスタムエクスペリエンスを構築する方法に関するより多くのアイデアについては、素晴らしいSharePlayエクスペリエンストークをチェックしてください。

このセッションが有益であることを願っています。

WWDCの残りの部分を楽しんでください。

ありがとうございます。