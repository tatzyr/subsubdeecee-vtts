10110

アンドレアス:こんにちは、WWDCへようこそ。

私はAppleのローカリゼーションチームのAndreasです。今日は、高品質でローカライズされたアプリを構築する方法に関するいくつかの例を共有したいと思います。

国際化とは、世界中のデバイスで実行するためにアプリを準備することを意味します。

ローカリゼーションがうまくいくと、話す言語に関係なく、誰もが同じ素晴らしい経験と実用性を楽しむことができます。

Appleが提供するAPIを使用して、アプリのほとんどの部分は箱から出してすぐに国際化に優しいです。

この講演では、いくつかの課題やそれらをどのように解決したかなど、Appleのアプリを多様な視聴者にアピールする私たちの経験から学びます。

ローカライズされたテキストの宣言と読み込みから始めます。

フォーマットされた日付、時刻などを文字列に含めるのは簡単です。

いくつかのオプションを強調し、洗練された例を見ていきます。

Swiftパッケージにはローカライズされたテキストも含まれる可能性があり、ローカリゼーションワークフローの改善について学びます。

最後に、SwiftUIのレイアウトと素晴らしい新しい追加について話します。

Appleでは、アプリが国際的な視聴者に素晴らしい体験を提供していることを確認しています。

そして、天気アプリはその一例です。

何百万人ものユーザーが毎日それを開いて予測を確認し、これは彼らが世界のどこにいても彼らにとってアプリがどのように見えるかです。

UIのすべてが好みに合わせて調整されていることに注目してください。

現在の気象条件の説明をローカライズし、数字をフォーマットします。

UIは、言語が左から右か右から左かに応じて適切に調整されます。

翻訳から始めてカスタマイズするものの1つを詳しく見てみましょう。

この景色には、英語で「風が涼しく感じさせている」と書かれています。

そして、これは他の言語でどのように見えるかです。

それらを適切にサポートするには、String(localized)を使用して文字列を宣言するだけです。

Xcodeはローカリゼーションのためにエクスポートするときにそれを検出し、翻訳者に結果を送信できます。

そうするためにMacのメールアプリを使います。

そして、私たちがそこにいる間、私はあなたに何かを見せたいです。

メールのコンテキストメニューを開くと、「アーカイブ」という特別なフォルダに移動できます。それは私のサイドバーにあります。

両方の単語が英語で「アーカイブ」であることに注目してください。

ただし、スペイン語のような他の言語では、アクションとフォルダ名の単語が異なります。

英語の単語は同じですが、異なる文脈で表示される場合、他の言語は異なる単語を使用する可能性があります。

この場合、コードに2つの文字列を使用する必要があります。

これを行うには、今年、文字列初期化子に新しいAPIを追加しました。

これで、英語の文字列に使用できるデフォルト値が使用されます。

次に、ローカライズされた文字列のキーを変更して、翻訳者に区別を明確にします。

このようにして、英語でアプリを実行するときに同じ単語が表示され、スペイン語の翻訳者は異なる単語を提供することができます。

昨年の講演「ローカライズされた文字列を合理化する」は、文字列管理の基本を理解するのに役立ち、ローカリゼーションプロセスをさらに進めます。

この例から、同じ英語の単語、または文全体がUIの異なるコンテキストで表示されることがあります。

このような場合は、コードで2つの異なる文字列を使用するようにしてください。

天気はアプリだけではありません。

また、システムにうまく統合されています。

ここでは、ユーザーのアクティビティが表示され、アプリを開いて現在の場所の天気を確認することを提案します。

それがどのように実装されるかを見てみましょう。 

文字列は、任意の場所名を挿入するために文字列補間を使用して、このように宣言して読み込むことができます。

そして、この名前は都市または現在の場所の用語である可能性があります。

結果は英語でうまく機能します:それぞれ「クパチーノの天気を表示」と「私の場所で天気を表示」。

しかし、他の言語では、文法的な問題に遭遇するかもしれません。

たとえば、ドイツ語では、前置詞は都市名に対して機能しますが、現在の場所の用語を挿入するときは間違っています。

代わりに別の翻訳が必要です。

ここでの解決策は簡単です。2つの異なる文字列を使用するだけです。

都市名を挿入することは最初の都市で問題ありませんが、現在の場所には別の文字列を使用します。

これにより、翻訳者は自分の言語に正しい文法を使用できるようになります。

そして、それは英語とドイツ語でうまく機能します。

変数を挿入することが文全体に影響を与えることを示すために、この例を作りました。

文字列の結合は、他の言語で驚くべき結果をもたらす可能性があります。文法を反転させる必要があるか、大文字化に問題があるかもしれませんが、コードを書くときに事前にそれを知ることは困難です。

言語を話す人にアプリをテストしてもらうことは、ワークフローのかなりの部分です。

文字列をプログラムで構築したくなるときは、それを覚えておいてください。

コードで文字列がどのように宣言されているかについてよく理解したので、彼らのコメントについて話しましょう。

これは、前回の例の文字列で、適切なコメントがあります。

コメントは翻訳者にとって本当に、本当に重要です。

文字列を宣言するときと同じ意図を保ちながら、翻訳に必要なコンテキストを必ず与える必要があります。

素晴らしいコメントは、ラベルやボタンなど、文字列がどのインターフェイス要素に表示されているかを説明しています。

また、UI要素のコンテキストと、それが画面に表示される場所についても説明しています。

これは、セクションヘッダー、コンテキストメニュー、またはユーザーアクティビティである可能性があります。

文字列に変数が含まれている場合は、実行時にその値を必ず説明してください。

これは、例で見たように、文の文法を一致させるために非常に重要です。

翻訳者は、コンテンツを翻訳するときに実行時にアプリが表示されない可能性があることを覚えておいてください。

しかし、これらのヒントを使用すると、文字列の宣言と翻訳、およびそれがアプリで果たす役割の間に共通の理解を作成できるはずです。

さて、あなたには思いつかなかったかもしれませんが、天気アプリは実際には天気をコントロールしていません。

代わりに、データはサーバーからダウンロードされます。

それは世界のどこにでも配置することができ、コンテンツを送信する言語さえ知らないかもしれません。

コンテンツがユーザーのデバイスにダウンロードされるときは、常にユーザーが好む言語で表示する必要があります。

アプリの一部だけをローカライズすると、非常に混乱する可能性があります。

ここでは、天気アプリには、サーバーから読み込まれた厳しい気象警報が表示されます。

これは本当に深刻に見え、私の言語に翻訳されなければ、後でトラブルに巻き込まれるかもしれません。

ユーザーが常にリモートコンテンツを読むことができるようにするために何ができるかを見てみましょう。 ユーザーがリモートコンテンツを読むことができるようにするために何ができるかを見てみましょう。

サーバーは、サポートされている言語のリストをアプリに送信できます。

これは言語IDの配列でなければならず、デバイスはユーザーが好む言語に関するすべての知識を持っているので、自分で比較をチェックする必要はありません。

「Bundle.preferredLocalizations」を呼び出すことで、Appleのフレームワークを活用できます。

そして、これはあなたのためにマッチを行います。

ユーザーの言語選択とどの程度一致するかでソートされた候補言語の配列を返します。

そして、最初のものは通常最も適しているので、あなたはこれを使用します。

その言語は、サーバーへの後続の要求に使用する必要があります。

それを使用して、ユーザーが理解できる言語のコンテンツで応答を生成します。

このテクニックを使用すると、サーバーからの文字列がUIを更新し、ユーザーにアラートを表示する準備ができていることを確信できます。

したがって、リモートコンテンツを表示する際の欲求不満の嵐からユーザーを救うために、利用可能な言語をダウンロードし、それをユーザーの好みと照合し、ユーザー向けコンテンツをロードするリクエストに結果を使用します。

でも、今はもっといい天気に戻りましょう。

雨でも晴れでも、天気アプリはデータが非常に豊富で、その多くの側面に数字とカウントが含まれています。

そのうちの1つに集中しましょう。

「降水量」の下には「過去6時間で0mm」と書かれています。似たようなものを作りたいが、ここでは「1時間」と綴りたいと仮定しましょう。

これは、コードで文字列を宣言する方法です。

英語では、時間数が1時間より大きい場合は、複数形を使用する必要があります：1時間、ただし2時間。

別のバリアントを使用するときのルールは、ウクライナ語ではさらに複雑です。

そのロジックをコードに実装したくないので、これがAppleのフレームワークを活用する理由です。

あなたがしなければならないのは、コードで文字列を宣言し、複数のルールをエンコードするstringsdictファイルを提供することだけです。

もう1つの選択肢は、自動文法契約を利用することです。

昨年の講演「ローカライズされた文字列を合理化する」では、これら2つのテクニックについて詳しく知ることができます。簡単ですが、すべての文字列に常に複数のルールを適用するべきではありません。

たとえば、文に何もカウントされず、数字が含まれていない場合は、複数形のルールを使用しないでください。

ここでは、「この都市をお気に入りから削除する」は番号がないため、1つを必要とせず、同じことが複数の都市にも当てはまります。

しかし、文字列に数字が含まれている場合は、複数形のバリエーションを検討する必要があります。

前の例の文字列は、次の数時間でどれだけの雨が降るかを数え、1より大きい数字に適応させるのがいかに簡単かを学びました。

ただし、文に期間、時間、パーセンテージなどの単位がある場合は、フォーマッタの使用を検討する必要があります。

では、フォーマッタについて話しましょう。

天気は、このビューで現在の湿度をパーセントで表示します。

SwiftUIでこれを行うには、たった1行のコードの問題です。

値を Text() でラップし、番号のフォーマット方法を指定するだけです。

そして、同等のSwiftコードも簡単です。

あなたはあなたの価値で.formattedを呼び出すだけです。

それは本当にあなたがする必要があるすべてであり、フォーマッタは他のすべての世話をします。

数字の前または後にパーセント記号を配置し、スペースを追加するだけでなく、ユーザーの好みのナンバリングシステムにも対応し、アラビア語とヒンディー語のユーザーが期待するものです。

しかし、それは本当にあなたがフォーマットできるデータの種類の始まりにすぎません。

ほとんどすべてのフォーマッタがあり、「フォーマッタ：データを人間に優しいものにする」というセッションを要約することをお勧めします。これまで見てきたように、天気はいつも晴れているわけではないし、雨が降る日もあるだろう。

もちろん、このハイライトは天気アプリで見逃せません。

「Rainfall」の下には、「今後24時間で50mmが予想される」と書かれていて、私が今いる場所がそれほど多くないことを本当にうれしく思います。

英語では、ケースは単純です。

私たちは「次の24時間で50ミリメートルが予想される」と言います。しかし、スペイン語では、この問題はより複雑です。

降水量が単数形または複数形の場合、翻訳を変える必要があります。

フォーマッタと複数ルールの両方を組み合わせることで、これを解決できます。

文字列「2 mm」はフォーマッタによって生成され、スペイン語で複数形に変化させる必要がある文に埋め込まれています。

さて、コードでこれを行う方法を見てみましょう。 

降水量がミリメートル単位になるというパラメータを取る関数を宣言することから始めます。

おそらくそれはサーバーからダウンロードされました。

まず、ユーザーの構成をエンコードするUnitLengthをシステムに要求し、降雨量を示す場合に適したものを選択します。

ユーザーがメトリクスを使用するようにシステムを設定していない場合は、測定タイプを優先ユニットに簡単に変換できます。

次に、書式設定APIを使用すると、1行のコードで値のフォーマットされた文字列を生成できます。

preferredUnitには、降雨量を表示したい情報がすでにあります。

したがって、フォーマットするときは、使用法をasProvidedに設定します。

1ミリメートルまたはインチ以上の雨が降る場合は、複数形のケースを使用します。

それを確認できるように、値を整数に変換します。

次に、指定されたキーでローカライズされた文字列をロードし、デフォルト値も提供します。

そこでは、文字列補間を使用して、integerValue、formattedValue、および数値24を含めます。

数字は常に24時間であるため、ここのコードで定義されています。

文字列補間を使用すると、自動的に正しいナンベリングシステムが使用されていることを確認します。

キーはstringsdictファイルで宣言されています。

それを見てみましょう。それを見てみましょう。

Stringsdictは、コードで使用したばかりのキーから始まります。

英語では、複数形の文字列を変更する必要がないため、「その他」のカテゴリを使用します。

最初のパラメータは、実行時にどのカテゴリが選択されるかを定義します。

覚えておいてください、それは整数値でした。

パラメータ番号2と3は、フォーマットされた文字列に存在します。

これは、実行時に文がどのように見えるかを定義します。

スペイン語のstringsdictは、単数形と複数形の両方で翻訳を提供することを除いて、同じ構造を持っています。

これで、データをコードでフォーマットし、文に配置しました。

Stringsdictファイルには複数ルールが含まれているため、スペイン語の翻訳は正しい文法を使用しています。

時には、すべての言語でうまく機能する完全にローカライズされたUIを提供することが困難です。

繰り返しになりますが、文字列の結合は英語で機能しますが、他の言語では驚くべき結果をもたらす可能性があることを学びました。

これにはいくつかの包括的なコードが必要になるかもしれませんが、今、あなたはすべてのユーザーのためにそれを正しくする方法を知っています。

時々、あなたの文字列は依存関係、またはあなたのアプリが使用するモジュールにあります。

または、Swiftパッケージを使用して、他の開発者にも独自のコードを配布することもできます。

ローカリゼーションの新機能を見てみましょう。 

Swiftパッケージを定義するには、Swift自体を使用して構造とビルド設定を宣言します。

ユーザー向けコンテンツがある場合は、パラメータdefaultLocalizationを使用して、コンテンツが主要言語として英語を使用していることを宣言できます。

これは、アプリプロジェクトの開発言語を指定するのと似ています。

Xcodeは、そのパラメータを読み取り、ローカライズされたエクスペリエンスを提供することに興味があることを認識します。

そのため、製品メニューにローカリゼーションをエクスポートするオプションが追加されます。

あなたはおそらくメインアプリでこの機能を使用することに慣れていて、今ではSwiftパッケージでも機能します。

「エクスポート」をクリックすると、Xcodeはコードを読み取り、すべての文字列を抽出します。

それらは.xclocファイルに配置され、翻訳者に送信されます。

また、ローカライズされたコンテンツをパッケージにインポートするには、Import Localizationsを使用すると、Xcodeはパッケージ内の正しいファイルパスにファイルを配置します。

Swiftパッケージをローカライズするワークフローは、アプリをローカライズするのと同じです。

しかし、Swiftパッケージに文字列を読み込むには、「バンドル」引数を指定する必要があることを覚えておいてください。

講演「Swiftパッケージ：リソースとローカリゼーション」で詳しく知ることができます。Swiftパッケージとして配布されているライブラリの作者であれば、プロジェクトを最新の状態に保ち、ローカリゼーションをワークフローの定期的な一部にする簡単な方法があります。

あなたはプロジェクトに多大な労力と注意を払い、それをローカライズすることは、すべてのクライアントにとって大きな時間の節約になります。

それは本当にそれを際立たせることができます。

あなたのソフトウェアで最高の体験を提供するために余分な努力をしていることを人々に認識させるので、先に進んで彼らに伝えてください!

箱から出してすぐにサポートする言語についてオープンにしてください。

アプリ開発者として、コード品質の観点からだけでなく、依存関係に特別な配慮を払います。

使用するコンポーネントは、アプリの残りの部分と同じ言語と高品質の翻訳をサポートする必要があります。

サードパーティのコードが必要な言語にローカライズされていない場合でも、パッケージのローカルコピーを作成し、そこでローカリゼーションを更新することができます。

アプリのすべての部分を、サポートされている言語でテストしてください。

このようにして、ユーザーの言語に適応していないUI要素がないことを確認できます。

ほとんどの場合、翻訳された文字列は英語の同等のものよりも長くまたは短く、それは常にアプリのレイアウトに影響します。

これが天気アプリにとって何を意味するのか見てみましょう。

これは英語で実行されているアプリで、右側にはアラビア語で実行されているのが見えます。

翻訳が言語に適応しているだけでなく、レイアウトも適切な方向性に従っていることは明らかです。

すべての言語で動作するレイアウトを作成する方法、どのタイプのシンボルがローカライズされた代替手段を提供するか、右から左の言語について他に考慮すべきことについてもっと知りたい場合は、「正しく...左に」というトークを必ず見てください。ここでは、アプリは右側のヒンディー語で実行されています。

ズームインしましょう。

その言語のスクリプトは一般的に背が高い傾向があります。

そして、よく見ると、ラベルの高さがそれに合わせて調整されていることがわかります。

システムはこれを自動的に行います。

あなたがしなければならないのは、UI要素に固定された高さを与えないようにすることだけです。

英語の弦に合うのに十分な高さだからといって、すべてが44ポイント以内に収まると仮定しないでください。

状況に応じて、常にテキストが高くなることを期待してください。

メインビューに戻って上にスクロールすると、天気には10日間の予報ビューがあり、来週のチェックアウトに最適です。

この画面で際立っているのは、最も長いラベルに従って要素の位置を動的に調整する方法です。

英語では、「今日」はすべての短縮された平日の名前よりも長いです。

しかし、スペイン語では、それらはすべて3文字の幅で、ギリシャ語では「今日」の翻訳はほぼ2倍の大きさです。

しかし、すべての言語で、天気のアイコンは互いに垂直に並んでいます。

つまり、彼らは隣人の要素に固定された間隔を持っていませんが、最も長い平日のラベルに従って流れます。

国際化でうまく機能するレイアウトを作成することに関しては、ラベルが柔軟である必要があることを常に心に留めておく必要があります。

垂直方向に柔軟にすることがいかに重要であるかを見たばかりですが、より長い翻訳でラベルが水平に成長することを期待しています。

この例のように、特定のレイアウトでそれに対応するのは難しいかもしれませんが、今年、SwiftUIは、この種のレイアウトをより簡単に構築するのに役立つ新しいビューであるグリッドのサポートを追加します。

グリッドの使い方を詳しく見てみましょう。

先頭のアライメントでグリッドを宣言することから始めます。

つまり、UI要素は画面の左側で左から右に、画面の右側で右から左の言語で始まります。

次に、水平グループごとにGridRowを追加します。

そして最後に、行の内容を宣言します。

このかなり高度なレイアウトを作成するために必要なのはそれだけです。

ラベルがより多くのスペースを必要とする場合、カプセルは最も柔軟な要素であるため、サイズを縮小することができます。

SwiftUIは、ビューの測定、サイジング、位置決めなど、すべての重い作業を行います。

もう1つの課題は、Apple Watchのように、限られたスペースでより長い翻訳作業でビューを作ることです。

ここでは、「チップ機能」のドイツ語翻訳が長すぎて一列に収まりません。

これを修正するために、より多くのスペースを作るためにテキストの横にあるアイコンを削除しません。

解決策は、必要に応じて2行以上のテキストを使用することです。これはデフォルトの動作です。

十分なスペースがない場合は、それを変更してインターフェイス要素を隠すことはお勧めしません。

通常、言語のニーズに対応できるように、レイアウトを調整する方法があります。

メールアプリは創造的な方法でこれを行います。

シートプレゼンテーションには、このメールに対してアクションを実行するための4つのボタンがあります。

ボタンのタイトルの1つの翻訳が長すぎる場合、テキストをクリップしたり、新しい行にラップしたりしません。

これにより、ビューが不均衡に見えるようになります。

代わりに、レイアウト全体が水平スタックから2行の垂直スタックに移行します。

今年、SwiftUIは、この動的レイアウトを簡単に作成する別の素晴らしいツールを追加します。ViewThatFits。

本質的には、スペースが制約され、ビューが収まらない場合に、代替レイアウトを提供できます。

互いに独立して意見を宣言し、ViewThatFitsに配置するだけです。

SwiftUIは、クリッピングなしでビューが収まらないかどうかを自動的に検出し、提供された次のビューに移行します。

レイアウトのみを切り替える必要があることを覚えておいてください。

翻訳が長すぎるという理由だけでビューを隠すのは悪い習慣です。

これにより、ユーザーがUIで自分自身を方向づけるのが難しくなります。

柔軟なレイアウトを持つことで、まずすべてのインターフェイス要素のためのスペースを作るようにしてください。

これはローカリゼーションに役立つだけではありません。

このレイアウトは、ユーザーがテキストを小さくまたは大きくすることを好み、異なるデバイスを使用する場合にも最適です。

今年のSwiftUIの素晴らしい新しいレイアウト機能の詳細については、「SwiftUIでカスタムレイアウトを作成する」というトークを見ることをお勧めします。異なるアクセシビリティ設定とローカライズされたテキストを持つことは、レイアウトにとって課題になる可能性があります。

インターフェース要素は、より高く、より広くすることができます。

それに対応するためにレイアウトを適応させるのは難しいかもしれませんが、SwiftUIを使用すると、今年ははるかに簡単になります。

この話から、コードで文字列を構築することは、他の言語をサポートするときに難しいことを取り除いてほしい。

国際的なユーザーやテスターからのフィードバックを聞いて、誰にとってもうまくいくことを確認してください。

Swiftでの値の書式設定は簡単で、多くの場合、1行のコードが必要です。

そうすることで、フォーマットされた値はユーザーの好みを自動的に尊重します。

Swiftパッケージを提供するときは、新しいXcodeローカリゼーションワークフローを使用して、クライアントに完全にローカライズされたエクスペリエンスを提供します。

これで、SwiftUIの有無にかかわらず、レイアウトは翻訳されたテキストとアクセシビリティの設定に対応できるはずです。

レイアウトツールを使用して、インターフェイス要素を隠すことなく、レイアウトを柔軟にします。

最終的には、あなたのアプリは彼らの生活に適合することを期待し、それは彼らの言語を尊重することを含むので、あなたのユーザーはそれに感謝するでしょう。

今、私はとても晴れた週を楽しみにしています。

WWDCの残りの部分を楽しんで、見てくれてありがとう。