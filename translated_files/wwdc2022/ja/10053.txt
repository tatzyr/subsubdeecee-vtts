10053

♪インストゥルメンタルヒップホップ音楽♪

♪

こんにちは。私の名前はアシュワスで、教育チームのエンジニアです。

今日は、職場と学校でのAppleとのサインインについてお話しできることを嬉しく思います。

このプレゼンテーションでは、この秋に導入する主な機能を取り上げます。

まず、職場と学校でのAppleとのサインインとは何か、そしてそれがどのように機能するかを説明します。

次に、Roster APIと、それを利用する方法の詳細について説明します。

最後に、アクセス管理について話し、IT管理者が組織に代わってApple at Work & SchoolとRoster APIでサインインへのアクセスを管理する方法について説明します。

まず、あなたがよく知っているかもしれませんが、このセッションでレビューする重要な2つの概念を取り上げましょう。

1つ目はAppleでサインインです。

Appleでサインインは、ユーザーが自分のApple IDでアプリにサインインするための迅速かつ簡単な方法です。

ユーザーは、タップするだけでアプリ内でアカウントを作成できます。

2番目の概念は、管理対象Apple IDです。

Apple IDと同様に、管理対象Apple IDはデバイスをパーソナライズするために使用されます。

また、Appleのアプリやサービスにアクセスするためにも使用されます。

Apple IDとは異なり、管理対象Apple IDは組織が所有し、Apple School ManagerまたはApple Business Managerを通じて管理されます。

これらの定義を念頭に置いて、Appleとのサインインが管理対象Apple IDをサポートするように拡張されたことを共有できることを嬉しく思います。

これで、Appleでサインインの迅速かつ簡単なサインイン体験のメリットを得ることができますが、管理対象Apple IDの管理機能を備えています。

職場と学校での「Appleでサインイン」のユーザーエクスペリエンスを紹介するために、例を見てみましょう。

これがSlackのログイン画面です。

Appleでサインインを使用するには、ユーザーは[Appleで続行]をタップするだけです。

Apple IDを使用すると、Appleでサインインするためのこのウェルカム画面が表示されます。

一方、管理対象Apple IDを使用している場合は、職場と学校でAppleでサインインの歓迎画面が表示されます。

ウェルカム画面の違いに気づくでしょう。

アプリがアクセス制御を簡単に提供できるようにするとはどういう意味ですか?

例を見てみましょう。 例を見てみましょう。

Appleでサインインで個人のApple IDを使用すると、ユーザーはアカウント作成画面が表示され、名前を編集し、メールを共有するか非表示にするかを選択できます。

しかし、組織的な文脈では、アプリが誰がログインし、どのレベルのアクセスを提供するかを理解することが重要です。

この画面に示されている例では、ユーザーは職場でSlackにサインインしています。

この従業員がどのSlackチャンネルに参加を許可すべきかを知るために、Slackはどのユーザーがサインインしているかを知る必要があります。

これは、SlackがWork&SchoolでAppleでサインインを使用するときに、アプリで共有された名前と電子メールを使用してアクセス制御を提供する例です。

だから、これはユーザーが見ているものですが、これはあなたにとって何を意味しますか?

これは、ユーザーが職場と学校でAppleでサインインを使用すると、名前と電子メールのフィールドに常にアクセスできることを意味します。

クライアント側のアプリに取り組んでいる開発者なら、承認コントローラーを示すコードの例を見てみましょう。

承認が成功すると、強調表示されたステートメントは、アプリが受信したフルネームと電子メールを示します。

これは、承認要求にフルネームと電子メールの範囲が含まれていることを前提としています。

ウェブ上でAppleとのサインインをサポートしている開発者の場合、サインイン方法を使用して承認プロセスを開始するコードの例を次に示します。

承認が成功すると、サーバーはデータオブジェクトへの応答を返します。

そのデータオブジェクトはこんな感じです。

強調表示されたフィールドには、サインインしているユーザーの電子メールとフルネームが含まれています。

ここでいくつかの点に注意することが重要です。

このリリースでは、職場と学校でAppleでサインインするには、デバイスにサインインしている主要な管理対象Apple IDを使用します。

私たちが示した画面の例は、デバイスのログインフロー用でしたが、ウェブフローもサポートされています。

一部のアカウントでは、メールアドレスが提供されていない場合があります。

たとえば、学校は若い生徒にメールアドレスを割り当てることはできません。

メールアドレスが存在しないこのシナリオでは、アカウント作成画面がどのように見えるか見てみましょう。

このユーザー、ファティマ・シルバはメールアドレスを持っていないので、アカウント作成画面にはフルネームのみが表示されます。

すでにAppleでサインインを実装している場合は、管理対象Apple IDのサポートを追加するための作業は必要ありません。

まだサポートを実装していない場合は、WWDC2020の「Appleでサインインを最大限に活用する」セッションと今年の「Appleでサインインする体験を強化する」セッションを見ることを強くお勧めします。

それは職場と学校でのAppleでサインインであり、管理対象Apple IDへのサインインの迅速かつ簡単なサインイン体験をもたらします。

では、Roster APIに飛び込みましょう。

しかし、詳細に飛び込む前に、次のシナリオを考えてみましょう。

あなたは教育分野の開発者です。

あなたのアプリは学区で使用されています。

アプリでAppleでサインインのサポートを実装しました。

それは素晴らしい！

学生、教師、スタッフは、管理対象Apple IDを使用してアプリにログインできます。

このシナリオでは、あなたのアプリでは教師が課題や発表を生徒と共有することができます。

これをサポートするために、IT管理者は学年の開始前に学生、教師、クラスをアプリに入力する必要があります。

何百人または数千人の生徒がいる学校にとって、これらの記録を手作業で作成することは、すぐに時間がかかり、退屈なプロセスになります。

この問題に対処するためにRoster APIを作成しました。

Roster APIは、Apple School Managerのユーザーやクラスなどのリソースへのプログラムによるアクセスを提供します。

これにより、IT管理者はこの情報をアプリにインポートするプロセスを自動化できます。

これらのリソースは、RESTエンドポイントの形で定義されています。

このデータは、IT管理者が成功したOAuth 2.0認証を通じて許可を与えた後、アプリがアクセスできます。

Apple School Managerの管理者とサイトマネージャーのアカウントは、どのアプリがデータにアクセスできるかを管理できます。

このリリースの一環として、アプリが組織データへのアクセスを要求するための標準化された方法を作成しました。

私たちはこれを組織データ共有と呼んでいます。

開発者の採用が簡単になるように、UIデザインパターンとテクノロジーの選択に関しては、業界標準に従いたかったのです。

そのため、OAuth 2.0を使用して承認フローを作成しました。これには、スコープを使用し、IT管理者に組織データの共有に同意するよう求めることが含まれます。

これがそのように見えます。

同意画面には、組織のデータへのアクセスを要求しているアプリと、アプリがアクセスを要求しているデータに関する情報が表示されます。

より詳しく見ると、同意画面には、要求者に関する情報が含まれています。これは、Apple School Managerによって利用可能になったデータへのアクセスを要求するアプリを表します。この場合、要求するアプリはQuizzlerであり、スコープは、アプリがアクセスできるデータを表します。

この場合、IT管理者が同意すると、Quizzlerはこの組織のすべてのユーザー情報とクラス情報にアクセスできるようになります。

あなたの実装の旅はどのようなものですか?

最初のステップは、スコープを要求することを含む開発者ポータルに登録することです。

次のステップは、OAuth 2.0認証フローを通じてアプリとデータを共有するために、IT管理者の同意を求めることです。

最後に、アプリはRoster APIエンドポイントにクエリしてデータを取得します。

これらの各ステップを見てみましょう。 

スコープをリクエストするには、開発者ポータルにアクセスしてください。

[証明書、識別子、プロファイル] ページで、[アカウントと組織データ共有] の下にある [設定] をクリックします。

次のステップで、「設定を設定する」をクリックします。

ドロップダウンからプライマリアプリIDを選択し、[続行]を押します。

追加設定の詳細ページで、[組織データ共有スコープ] で、目的のスコープを選択します。

現在、ユーザーアクセスとクラスアクセスの2つを提供しています。

アプリにリターンURLが設定されていることを確認してください。

このステップは、OAuth 2.0認証フローでリターンURLが使用されるため重要です。

続行を押します。

最後に、設定を確認してください。

今、私たちは次のステップの準備が整いました。

実装ジャーニーの2番目のステップは、OAuth 2.0認証フローを通じてアクセストークンを取得することです。

これを詳しく見てみましょう。

IT管理者はまずアプリにログインします。

その後、IT管理者はアプリと対話して承認フローを開始します。たとえば、「Apple School Managerに接続」というボタンをクリックします。

これにより、OAuth 2.0標準に従って一連のイベントが開始されます。

最初のステップは、承認エンドポイントへのGET API呼び出しを実行することです。

このリクエストの詳細を見てみましょう。詳細を見てみましょう。

リクエストは、client_id、redirect_uri、state、response_type、およびスコープのいくつかのクエリパラメータを取ります。

応答は、IT管理者からのアクセスを要求するために、Apple OAuth同意画面にリダイレクトされます。

この図では、IT管理者が管理対象Apple IDで認証したことを前提としています。

そうでない場合は、最初に認証するように求められます。

IT管理者には、組織データをアプリと共有したいことを確認するための同意画面が表示されます。

これは、先ほど見たのと同じ同意画面です。

念のため、こんな感じです。

[許可]をクリックすると、開発者ポータルに登録したリターンURLに承認コードがアプリに提供されます。

最後のステップには、アプリのアクセストークンを取得するためのトークンエンドポイントへのPOSTリクエストが含まれます。

このリクエストがどのように見えるか見てみましょう。

リクエスト本文は、リターンURLで受信した承認コードを含む標準のOAuthパラメータで構成されています。

応答には、アクセストークン、その有効期限、および有効期限が切れたときに新しいアクセストークンを作成するために使用されるリフレッシュトークンがあります。

リフレッシュトークンを使用して新しいアクセストークンを生成するためのリクエストの詳細を見てみましょう。

リクエストボディは、リフレッシュトークンを含む標準のOAuthパラメータで構成されており、応答にはアクセストークンとその有効期限があります。

OAuth 2.0認証フローが正常に完了した後、アプリにはアクセストークンがあり、Roster APIからユーザー情報とクラス情報を取得するために使用できます。

現在のリリースの一環として、アプリがクエリできる5つのエンドポイントを導入しています。

これらには、クラスのリスト、ユーザーのリスト、特定のクラス、特定のユーザー、クラス内のユーザーの取得が含まれます。

簡単な例のフローを見て、ユーザーとクラスを取得する方法を実演しましょう。

アプリサーバーは、まず、ユーザーのエンドポイントを照会することで、学生、教師、スタッフのリストを取得できます。

リクエストと回答を詳しく見てみましょう。

ユーザーエンドポイントは3つのクエリパラメータを取ります。

pageTokenとlimitはページネーションパラメータであり、オプションのロールパラメータを使用すると、学生、インストラクター、またはスタッフを照会できます。

リクエストには、承認フローから生成されたアクセストークンを含む承認ヘッダーが必要です。

応答は、ユーザーのリストを持つ「ユーザー」キーを含むJSONペイロードです。次のレコードセットを取得するために使用される「nextPageToken」キー、およびクエリするレコードがあるかどうかを示す「moreToFollow」ブールキー。

リクエストの例を見てみましょう。 

ここでのAPIコールは、応答に最大10人の学生がいる学生のリストを取得しています。

これは最初のAPIリクエストなので、pageTokenクエリパラメータは指定されていません。

応答には、givedName、familyNameなどの標準的なユーザー情報がありますが、ユーザーの安定した一意の識別子に注意を喚起したいと思います。

これは、ユーザーがAppleでサインインで認証したときにアプリが受け取るのと同じ識別子です。

ユーザーのメールアドレスと組織内での役割も含まれています。

nextPageTokenは、moreToFollowキーがtrueに設定されているため、次の学生セットを取得するためのクエリパラメータとして、後続のAPIリクエストで使用する必要があります。

ユーザーエンドポイントを照会した後、アプリサーバーはクラスエンドポイントを照会できるようになりました。これにより、その特定の学区のクラスのリストと、クラスとそのクラスに関連付けられている生徒と教師の関係が表示されます。

リクエストと回答を詳しく見てみましょう。

Get classesリクエストの一部として、リクエストは以前に見たpageTokenとlimitパラメータの2つのクエリパラメータを取ります。

ヘッダーは、ユーザーに照会するときと同じです。

応答は、「クラス」キーがクラスのリストを保持するJSONペイロードです。

リクエストの例を見てみましょう。 

このリクエストは、応答に含まれる最大200のクラスのリストを取得します。

APIリクエストにはpageTokenパラメータもあります。これは、すべてのクラスを取得している最中であることを意味します。

応答には、名前、クラス識別子などの標準的なクラス情報が含まれていますが、クラスに属するインストラクターIDと学生IDのリストに注意を喚起したいと思います。

それがロスターAPIでした。

これらのエンドポイントを使用すると、アプリはApple School Managerからユーザーとクラスをプログラムでクエリできるようになりました。

最後に、アクセス管理についてお話ししたいと思います。

組織データ共有とApple at Work & Schoolでのサインインを使用して、組織に管理機能を提供することが不可欠です。

これが何を意味するのか、より詳細に説明させてください。

Appleでサインインを使用する場合、ユーザーは自分のアカウントを管理し、どのアプリにサインインするかを決めるのは彼ら次第です。

しかし、職場と学校でAppleでサインインを使用する場合、組織のIT管理者は、その組織のすべてのユーザーに代わってアクセスを一元的に管理します。

これは、IT管理者が組織のデータの安全性とセキュリティを確保する責任があるためです。

したがって、ユーザーが職場と学校でAppleでサインインを使用できるアプリと、組織データ共有を使用できるアプリを管理する権限を与えられなければなりません。

これらのアクセス管理機能は、Apple School ManagerとApple Business Managerで設定できます。

職場と学校でAppleでサインインするには、2つのモードがあります。

最初のモードは「すべてのアプリを許可する」です。

このモードがどのように見えるか見てみましょう。

ここでは、IT管理者はApple Business Managerにログインしています。

サイドバーからアクセス管理を選択し、「Appleでサインイン」を選択すると、2つのモードが表示されます。

「すべてのアプリを許可」モードでは、組織のすべてのユーザーがAppleでサインインをサポートするすべてのアプリにログインできます。

2番目のモードは「特定のアプリのみを許可する」です。

このモードがどのように見えるか見てみましょう。

「特定のアプリのみを許可する」モードでは、IT管理者がAppleでサインインをサポートするアプリを検索してリストに追加できます。

ユーザーは、リストに追加されたアプリでのみAppleでサインインを使用できます。

ユーザーがリストにないアプリにログインしようとすると、エラーメッセージが表示されます。

この機能は、Apple School Manager、Apple Business Manager、Business Essentialsのお客様でも同じであることに注意することが重要です。

職場や学校でのAppleでサインインと同様に、組織データ共有も同じ2つのモードがあります。

見てみましょう。 

「特定のアプリのみを許可する」モードでは、IT管理者がサポートされているアプリを検索してリストに追加できます。

Roster APIを使用してユーザーとクラスの情報にアクセスできるのは、これらのアプリです。

同意画面に加えて、これはIT管理者が組織データにアクセスできるアプリを管理するための2番目のコントロールレイヤーです。

Sign in with Apple at Work & Schoolのリリースにより、どの環境のユーザーでもApple IDまたは管理対象Apple IDを使用してアプリにログインできるようになりました。

Appleでサインインをまだ実装していない場合は、そうすることをお勧めします。

また、教育分野にいる場合は、Roster APIを採用することを強くお勧めします。

Roster APIのサポートを実装すると、IT管理者、スタッフ、教師、学生にシームレスなオンボーディング体験を提供します。

いつものように、私たちはあなたからの連絡が大好きです。

だから、あなたが持っているかもしれないフィードバックを提出してください。

詳細を知りたい場合は、2020年の「Appleでサインインを最大限に活用する」セッションと、今年の「Appleでサインイン体験を強化する」セッションを強くお勧めします。

ご覧いただきありがとうございます。今年のWWDCをお楽しみください。ありがとうございます。

♪