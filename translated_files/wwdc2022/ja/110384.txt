110384

♪インストゥルメンタルヒップホップ音楽♪

こんにちは、私の名前はフェリペです。

私はtvOSチームのソフトウェアエンジニアです。

今日は、アプリで複数のユーザーを簡単にサポートできるように、tvOS 16で行った改善点を皆さんと共有できることを嬉しく思います。

Apple TVは誰もが使えるように設計されています。

tvOS 13以来、Apple TVの複数のユーザーを改善してきました。

tvOS 16には、すべてのアプリで複数のユーザーを簡単にサポートできる新機能があります。

Apple TVの複数のユーザー機能の概要から始めます。

誰もが使用するデバイスでアプリをパーソナライズするのがいかに簡単かを示しています。

次に、ストリーミングアプリの各ユーザーのプロファイル選択を保存するのがいかに簡単かを実演します。

あなた自身のアプリに最適なアプローチのための推奨事項で締めくくります。

tvOS 16では、家族全員がApple TVで簡単にできるようにしています。

Siri RemoteのTVボタンを長押しすると、コントロールセンターが表示されます。

一番上にあるのは、このApple TVにいるユーザーのリストです。

tvOS 16の新機能であるユーザーリストには、まだ追加されていないiCloudファミリーメンバーが含まれているため、家族全員がApple TVでこれまで以上に簡単になります。

ここでは、アンはまだApple TVを使っていません。

プラスアイコンは、提案されたユーザーを示します。

アンに参加させるには、提案されたユーザーを選択するだけです。

アンがする必要があるのは、iPhoneをApple TVと同じ部屋に持ち込み、iPhoneで接続を確認することだけです。

そして、それがすべてです。

アンは現在、Apple TVで彼らのデータにアクセスできます。

では、ちょっとアンのiPhoneに戻りましょう。

アンのお気に入りのビデオストリーミングアプリを見てみましょう。 

このアプリは家族全員で使用され、一人一人が自分のプロフィールを持っています。

アプリが最初に起動すると、プロフィールピッカーが表示され、アンは彼女のプロフィールを選びます。

個人用デバイスで実行されているアプリは、優先プロファイルをNSUserDefaultsに保存したり、CloudKitに入れてすべてのデバイスに同期させることもできます。

家族の各メンバーのiPhoneは、その人の好みのプロフィールを覚えています。

アプリが開いたときにどのプロファイルを使用するかを尋ね続ける必要はありません。

Apple TVは家族全員が共有するデバイスであり、Apple TVを使用するすべての人が自分のコンテンツやデータにアクセスできることが本当に重要だと考えています。

tvOS 14では、アプリを現在のユーザーとして実行する機能を導入しました。

「現在のユーザーとして実行」の資格を追加する単一のチェックボックスで、コードはまったく変更されないため、アプリはiPhoneと同じように各ユーザー自身のデータにアクセスできます。

これらのAPIを呼び出すiOSコードは、Apple TVでそのまま実行でき、各人が自分の個人的なApple TVを使用しているように振る舞うことができます。

アプリが起動すると、tvOSがすべてを処理します。

プライバシーとセキュリティ、すべてシステムによって処理されます。

「現在のユーザーとして実行」資格は、個々の進歩に関するゲームやアプリに最適です。

ただし、プロファイル付きのメディアアプリは、もう少し必要です。

これまでの私の例では、サインインという重要な部分をスキップしました。

私たちは、サインインはできるだけ簡単でまれにする必要があると信じています。

tvOS 15では、iPhoneやiPadを使ってtvOSアプリにシームレスにサインインできる機能を導入しました。

これは、デバイスが連携してApple TVでサインインする最も便利な方法を提供するファーストクラスのサインイン体験です。

iCloudキーチェーンのパスワードなど、Apple TVでは直接利用できない機能は、タップするだけです。

優れたサインイン体験を構築する方法を学ぶには、WWDC 2021の「tvOSアプリのサインインを簡素化する」をご覧ください。

そして今年は、tvOSでOAuthとパスキーのサポートを導入します。

パスキーは、アプリやウェブサイトのパスワードを置き換えるための素晴らしい新しい認証技術です。

パスキーの詳細については、「パスキーに会う」ビデオをご覧ください。

しかし、使いやすさと利便性がすべてではありません。

サインインを一度だけ行うことは依然として重要です。

この最適なユーザーエクスペリエンスを実現するために、「現在のユーザーとして実行」で、tvOS 16にシンプルな新しいAPIを導入しています。

これは、アプリがユーザーに依存しないキーチェーンにアクセスできるようにするキーチェーンサービスの新しい定数です。

この新しいキーを使用して保存されたアイテムは、Apple TVのすべてのユーザーが常にアクセスできます。

例を見てみましょう。 例を見てみましょう。

これは、ユーザー名とパスワードを使用して、キーチェーンにアイテムを保存する方法です。

アイテムをユーザーに依存しないキーチェーンに保存するには、関数SecItemAddに渡される属性辞書に新しいキーを追加するだけです。

キーkSecUseUserIndependentKeychainの値としてtrueを渡すだけです。

ユーザーに依存しないキーチェーンセットを使用すると、読み書きしたアイテムがすべてのユーザーに表示されます。

新しいキーチェーンAPIと「現在のユーザーとして実行」の両方の資格の組み合わせにより、アプリはiPhoneとApple TVの最高のものを手に入れることができます。Apple TVでのシングルサインイン体験を維持しながら、共有デバイス上のシンプルなユーザーごとのデータ分離。

tvOS 16では、TVUserManagerでシステムユーザーにプロファイルを手動でマッピングする方法を廃止しました。

もはや、プロファイルへのユーザーのマップを維持する必要はありません。

システムはあなたのためにそれを処理します。

iOSで使用しているのと同じAPIは、Apple TVでも使用できます。

それはとても簡単です。

デモですべてのアクションをお見せしましょう。

プロフィール付きのメディアアプリを表すサンプルアプリを紹介します。

これは私のストリーミングビデオアプリです。

現在、私が話した機能のどれも使用していません。

現在のユーザーとして実行されないし、新しいキーチェーンAPIも使用しない。

サインインしてお見せします。

サインイン後、プロフィールのリストが表示されます。

現在のユーザーはメイなので、彼女のプロフィールを選びます。

プロフィールを選ぶと、メイが見たいパーソナライズされたコンテンツが表示されます。

その後、アンはソファに座ってテレビを見ます。

彼らはSiri Remoteのテレビボタンを長押ししてコントロールセンターを開きます。

コントロールセンターの上部にあるのは、ユーザーのリストです。

緑色のチェックマークは、現在のユーザーを示しています。

今からアンに切り替えてアプリを開きます。

予想通り、アプリはプロファイルピッカーを再び表示します。

だから、アンは自分のプロフィールを選ぶことができます。

しかし、メイに切り替えたときに何が起こるかを見てください。

アプリはアンのプロフィールに残ります。

メイが以前に彼女の好みのプロフィールを選んだことを覚えていません。

tvOS 16の新機能により、ユーザーエクスペリエンスははるかに向上する可能性があります。

アプリを使用している人は、誰を見ているかを再度選択する必要がないようにしたい。

Xcodeに行きましょう、そして私はそれがどれほど簡単かをお見せします。

アプリを現在のユーザーとして実行するのは簡単です。

私がしなければならないのは、アプリのターゲットに1つの機能を追加することだけです。

私のアプリのターゲットでは、「署名と機能」タブに移動します。

タブのすぐ下、ここの左上にある「機能の追加」ボタンをクリックします。

機能のリストが開きます。

私が興味を持っているのはユーザー管理と呼ばれています。

「ユーザー」と入力してリストをフィルタリングします。

これで、アプリに追加したい機能をダブルクリックするだけです。

ここでは、「現在のユーザーとして実行」チェックボックスがデフォルトで選択されています。

それはまさに私が必要としているものです。

この資格により、私のアプリのプロセスは常に現在選択されているユーザーとして起動されます。

システムは、各ユーザーのデータが区別されていることを確認します。

キーチェーンを含むそのすべて。

しかし、私のアプリにとって、ユーザーごとに異なるキーチェーンを持つことは、予期せぬ副作用をもたらすでしょう。

各ユーザーは別々にサインインする必要があります。

tvOS 16では、現在のユーザーとして実行している間、すべてのユーザーに単一のアカウントを持つという経験を維持することができます。

新しいキーチェーンAPIを使用して、ユーザーに依存しないキーチェーンにアクセスします。

今からKeychainControllerクラスに行き、それを使ってキーチェーンを読み書きします。

ここには、キーチェーン内のアプリの資格情報にアクセスするために必要なキーを持つプロパティbaseQueryがあります。

新しいユーザーに依存しないキーチェーンを使用するように更新するには、辞書に新しい要素を追加するだけです。

新しいkSecUseUserIndependentKeychainを追加し、trueに設定します。

そして、アプリがすべてのユーザーと資格情報を共有するために変更する必要があるのはそれだけです。

他には何もありません。

ただし、他のすべてのデータはユーザーごとに異なることに注意することが重要です。

UserDefaultsのように、各ユーザーのプロファイル選択を記憶するために使用します。

では、私のProfileDataクラスを開きましょう。

このファイルは、私のiOSプロジェクトとtvOSプロジェクト間で共有されています。

実際、私のアプリのiOSバージョンは、すでにUserDefaultsにプロファイルの選択を保存していますが、iOSで実行している場合にのみ保存されています。

そして、それはiPhoneが個人用デバイスだからです。

しかし、私のアプリが現在のユーザーとして実行されるようになった今、Apple TVは個人的なものになることができます。

iOSチェックを削除して、Apple TVでコードを同じように動作させることができます。

システムは、ユーザーごとに正しいUserDefaultsを使用するようにします。

新しいバージョンのアプリを実行すると、現在のユーザーであるMeiとして起動します。

メイはサインインしてプロフィールを選ぶ。

アプリが現在のユーザーとして実行されていると、Apple TVがその時点で個人用デバイスであるかのように動作します。

メイのデバイス。

Meiのプロフィール選択は、彼女のUserDefaultsに保存されます。

アンが見る時間になると、彼らはコントロールセンターを使用してユーザーに切り替えます。

システムは切り替えユーザーUIを設置し、プロセスが再起動する前に最後のタスクを完了する時間を与えます。

tvOSは現在、アンとしてアプリを再起動します。

今、Apple TVはアンのデバイスです。

資格情報は、すべてのユーザーがアクセスできるユーザーに依存しないキーチェーンに保存されているため、サインインプロンプトはスキップされます。

しかし、アンはまだUserDefaultsにプロファイル選択を保存しておらず、プロファイルピッカーが表示されます。

アンのプロフィールを選択すると、選択内容がUserDefaultsに保存されます。

さて、この時点でメイとアンは両方ともプロフィールを選択しました。

ユーザーを切り替えると、アプリにはインタースティシャルプロンプトが表示されなくなります。

常にコンテンツに直行し、各人の正しいプロファイルを自動的に選択します。

毎回。

tvOS 16では、各ユーザーのプロフィールを覚えやすくなりました。

ユーザーに依存しないキーチェーンにアクセスするためのシンプルな新しいAPIで、システムは各ユーザーのデータを分離します。

全員が別々にサインインしなくても、各ユーザーのプロファイルの選択を覚えておく方法を見たので、Apple TVでアプリがどのように機能するかを確認しましょう。

現在のユーザー権限として実行されていないアプリは、デフォルトユーザーのリソースを使用します。

あなたはそれをApple TV独自のリソースと考えることができます。

ユーザーの切り替えは、アプリのプロセスに影響を与えません。

これは、あなたがパーソナライズしたいときのための私の推奨事項です。

この表は、tvOSアプリで使用している機能に応じて、利用可能な機能を示しています。

アプリがメディアアプリの場合、またはそのような場合は、プロファイルを通じてパーソナライズされたコンテンツを表示します。Apple TVを使用しているすべての人間で単一のアカウントを共有しながら、Runs as Current Userエンタイトルメントを採用し、新しいユーザーに依存しないキーチェーンAPIを使用します。

ゲームのように、あなたのアプリが個々の進歩に関するものである場合、あなたがしなければならないのは現在のユーザーの資格として実行を採用することだけで、tvOSは残りを処理します。

そして、他のすべてのアプリでは、レシピアプリなど、すべてのユーザーに同じコンテンツを提示するアプリは、何もする必要はありません。

Xcodeで新しいtvOSアプリプロジェクトを作成するだけです。

現在のユーザーとしての実行の詳細については、WWDC 2020のセッションをご覧ください。

私たちは、合理化された直接コンテンツ体験がtvOSアプリに最適なものだと信じています。

これらすべての機能が、アプリに素晴らしい大画面体験を実装するのに役立つことを願っています。

見てくれてありがとう、そして会議を楽しんでください。