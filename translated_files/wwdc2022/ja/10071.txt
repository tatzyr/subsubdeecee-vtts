10071

アンディ:こんにちは。

「デスクトップクラスの編集インタラクションを採用する」へようこそ。

私はUIKitフレームワークエンジニアのアンディで、後で同僚のジェームズが参加します。

iPadは、シンプルで使いやすいインタラクションを損なうことなく、絶えず進化しています。

このビデオでは、アプリをよりデスクトップクラスに変えるエキサイティングな新しい編集インタラクションについて学びます。

まず、iOS 16で大幅なフェイスリフトを受けた新しい編集メニューについて確認します。

その後、ジェームズは新しいシステムに飛び込み、経験を見つけて置き換えます。

iOS 16では、編集メニューはまったく新しいデザインが特徴で、馴染みのあるままですが、よりインタラクティブで、アクションを見つけやすくなっています。

編集メニューには、使用された入力方法に基づいて代替プレゼンテーションが追加されました。

タッチインタラクションの場合、編集メニューはまだおなじみのコンパクトな外観を持っていますが、ページング動作が改善され、アクションが以前よりも発見可能になります。

マジックキーボードまたはトラックパッドでは、コンテキストメニューがセカンダリまたは右クリックで表示され、よりデスクトップクラスのエクスペリエンスを実現します。

同様に、iPhoneのタッチインタラクションでは、新しい編集メニューが表示されます。

また、Mac Catalystアプリでは、Macユーザーがよく知っているコンテキストメニューが表示されます。

iOS 16では、テキスト編集メニューは、新しいデータ検出器の統合により、大きなパワーアップを取得します。

これには、インライン単位と通貨変換、および選択したテキストに応じてコンテキストアクションを表示するスマートルックアップが含まれます。

たとえば、Safariでアドレスを選択すると、既存の編集メニューアクションの上に「道順を取得」や「マップで開く」などのマップベースのアクションが表示されます。

最良の部分は、養子縁組が不要なことです!

これらの機能は、テキストインタラクションビュー、WebKit、Safari、PDFKitなど、すべてのテキスト編集メニューで利用できます。

テキストビューのメニューにアクションを挿入するには、新しいTextViewDelegateメソッドを実装して、システムが提供するアクションを使用して、指定された範囲内のテキストの表示メニューをカスタマイズします。

何もカスタマイズする必要がない場合は、nilを返して標準システムメニューを入手してください。

UITextFieldDelegateとUITextInputにも同様の方法があり、メニューをカスタマイズすることもできます。

UIMenuControllerを使用したメニュー項目の挿入は、iOS 16では廃止されました。代わりに、新しいメソッドを使用してテキスト編集メニューにメニュー要素を追加する必要があります。

以下は、いくつかのカスタムアクションを含むテキストビューの例です。

テキスト選択にメニューが表示されると、システムが提案したアクションの後に、カスタムの「ハイライト」と「写真を挿入」アクションが表示されます。

ハイライトアクションを選択すると、期待どおりにテキストのハイライトが実行されます。

次に、強調表示するものがないテキスト選択なしでメニューが表示された場合、メニューはシステムが提案したアクションの後に「写真を挿入」アクションのみを表示します。

新しいAPIを使用してこれらのアクションを追加する方法を紹介します。

プレゼンテーション時に動的にメニューにアクションを挿入するには、UITextViewDelegateメソッドtextView editMenuForTextIn range suggestedActionsを実装します。この例では、選択したテキストがある場合にのみ「ハイライト」アクションを追加したいので、このメソッドを使用して動的にアクションを追加できます。

「写真を挿入」アクションは常に有効なので、配列に追加して、常にメニューにアクションを表示できます。

最後に、カット、コピー、ペーストなどの項目を含むシステムが推奨するアクションにアクションを追加し、メニューを返します。

そして、それだけです!

UIEditMenuInteractionは、新しい編集メニューを強化するUIInteraction APIです。

このインタラクションでは、独自のジェスチャーに基づいてテキストビューの外側に軽量編集メニューをプログラムで表示でき、セカンダリクリックでコンテキストメニューを表示するネイティブサポートがあります。

iOS 16では、UIMenuControllerとその関連するすべてのAPIは、新しい編集メニューのインタラクションに置き換えられます。

編集メニューを最初から表示するには、まずインタラクションを作成してビューに追加します。

次に、メニューを表示するようにジェスチャーリコグナイザを設定します。

メニューが間接的なポインタクリックからではなく、直接タッチでのみ表示されるようにするには、ジェスチャーリコグナイザの許可されたTouchTypesプロパティを直接タッチのみに設定してください。

次に、ジェスチャーリコグナイザをビューに追加します。

最後に、ジェスチャーリコグナイザが起動したら、ジェスチャーの場所にメニューを表示できるコンテンツがあるかどうかを判断します。

次に、ジェスチャーの場所のソースポイントで編集メニュー設定を作成します。

ソースポイントは、メニューに表示するインタラクションのビューで実行可能なアクションを決定するために使用されます。

設定が完了したら、presentEditMenu(with: configuration)を呼び出すとメニューが表示されます。

選択した「Jello there!」内の任意の場所を右クリックするとビュー、コンテキストメニューには、アプリのコンテンツに対して実行可能なシステムアクションが表示されます。

さらに、選択したビューをタップすると、タッチが発生した場所に編集メニューが表示され、コンテキストメニューと同じアクションが表示されます。

これは良いことですが、もっと良くなるかもしれません。

タッチが発生した場所にメニューが表示されるのは良いことですが、実際には選択したビューのコンテンツをブロックしています。

さらに、システムのデフォルトアクションではない新しい「複製」アクションをメニューに挿入したい。

戻ってこれを変えましょう。

選択したビューの周りにメニューを表示するには、デリゲートメソッドeditMenuInteraction targetRectFor構成を実装します。このメソッドは、メニューを表示する場所を決定するために使用されるCGRectを返し、インタラクションのビューの座標空間にあります。

メソッドが実装されていない場合、またはnull CGRectが提供されている場合、メニューは設定のソースポイントから表示されます。

この場合、メニューが選択したビューをオクルードするのを防ぐために、そのフレームを返します。

次に、「複製」アクションを追加するには、edinMenuInteraction menuFor configuration suggestedActionsを実装し、システムが提案したアクションの後にカスタムアクションを追加します。これは、以前にテキストビューのメニューにアクションを挿入する方法と同じです。

これで、選択したビューをもう一度タップすると、メニューに「Jello there!」が表示されなくなりました。代わりに、その周りに提示します。

メニューが表示されると、新しい「複製」アクションも含まれており、すべてわずか数行のコードで表示されます。

素晴らしい！

Mac Catalystアプリの場合、編集メニューは、ユーザーがインタラクションのビューを右クリックしたときにMacで期待する使い慣れたコンテキストメニューにブリッジします。

iPadのイディオムMac Catalystアプリの場合、プログラムで提示された編集メニューもコンテキストメニューにブリッジします。

編集メニューのプログラムによるプレゼンテーションは、Macのイディオムアプリではサポートされていないことに注意してください。

異なるプレゼンテーションスタイル間のシームレスなブリッジングを提供するために、UIEditMenuInteractionはAPIのUIMenuElementファミリの上に構築されています。

これらは、サブメニューや画像のサポートなど、以前よりも柔軟性とカスタマイズ性を提供します。

UIMenusを初めて使用する場合は、「Modernizing Your UI for iOS 13」を見て、メニューとアクションについて詳しく学んでください。

UIMenuElementの上に構築することは、編集メニューがすでにメニューをサポートしているUIMenuSystemのような多種多様なAPIにアクセスできることを意味します。

編集メニューは、既存のUIMenuSystem.contextシステムを使用してメニューを作成します。

メニュービルダーの詳細と、レスポンダーチェーンのトラバーサルとコマンドの検証について詳しく知るには、「iPadアプリを次のレベルに引き上げる」をご覧ください。

メニューといえば、iOS 16のUIMenuにはいくつかの新しい機能強化があります。

UIMenuには、コンテキストメニューで異なるレイアウトから選択できる優先要素サイズプロパティが追加されました。

小さいサイズは、メニューのサイドバイサイドの外観をよりコンパクトに見せ、より多くのアクションを1行に収めます。

ミディアムサイズもアクションを横に並べて表示しますが、もう少し詳細に表示します。

これは、標準の編集メニューを表示するためにテキスト編集メニューで使用されます。

そして最後に、大きな要素サイズは、メニューにデフォルトの全角の外観を与えます。

さらに、UIMenuElementには、アクションが実行された後に表示されたメニューを保持するための新しい.keepsMenuPresented属性があります。

この属性を使用して、メニューを再表示せずにアクションを複数回実行できるようにします。

それは新しい編集メニューの氷山の一角にすぎません。

テキスト編集メニューをカスタマイズして、テキスト編集機能を拡張します。

メニューがさまざまなプレゼンテーションスタイルで完全に見えるように、アクションにタイトルと画像があることを確認してください。

最も重要なことは、プラットフォームと異なる入力方法間でのカスタマイズ性と一貫性の向上のために、新しいUIEditMenuInteractionを採用することです。

新しい編集メニューのサポートを追加することは、素晴らしい第一歩です。

デスクトップクラスの編集体験を完了するために、ジェームズに渡して、新しいシステムの検索と置換の経験について話します。

ジェームズ・マガハーン:ああ、そこにある!

こんにちは、私はUIKitエンジニアのJames Magahernです。検索と交換について話すためにここにいます。

iOS 16の新機能では、アプリでテキストを見つけて置き換えるための新しいUIコンポーネントを導入しました。

これはシステム全体で標準であり、多くの組み込みアプリに含まれており、ユーザーはさらに一般的に使用される編集ショートカットで筋肉の記憶を柔軟にすることができます。

これはiPadで実行されている新しい検索パネルです。

ハードウェアキーボードが取り付けられているときにショートカットバーでフローティングインラインから、ハードウェアキーボードなしで使用するとソフトウェアキーボードの上に置いて、自動的に移行します。

iPhoneでは、よりコンパクトなレイアウトを使用して、より小さな画面サイズに適応します。

自動却下、最小化、およびキーボード回避はすべてシステムによって処理されます。

Macでアプリを実行するときは、検索パネルをコンテンツとインラインに表示し、AppKit検索バーと同じように動作し、ユーザーがMacで期待する使い慣れたレイアウトを使用します。

UITextView、WKWebView、またはPDFViewを使用してアプリにテキストコンテンツを表示する場合、開始するために必要なのは、組み込みの検索インタラクションでisFindInteractionEnabledをtrueに設定することだけです。

そんなに簡単だよ！

さらに、QuickLookを使用してテキストコンテンツを表示している場合、これはすでにあなたからの作業なしで利用可能になります。

ハードウェアキーボードを使用すると、findのcommand+F、find nextのcommand+G、find previousのcommand+shift+Gなどのすべての標準システムショートカットが期待どおりに動作します。

これらのコマンドへのアクセスは、Macで実行しているときにメニューバーから利用できます。

あなたがする必要があるのは、コンテンツを表示するビューがファーストレスポンダーになることを確認することだけです。

ハードウェアキーボードを使用していないユーザーは、含まれているfindインタラクションプロパティで、presentFindNavigatorを介してプログラムでfindインタラクションを呼び出すことができます。

たとえば、ナビゲーションバーの項目でこれを利用できるようにすることをお勧めします。

Macで実行するときは、他にも覚えておくべきことがいくつかあります。

たとえば、iOSでは、検索パネルはソフトウェアキーボードまたはショートカットバーの一部として表示されます。

Macでは、あなたのコンテンツとインラインで表示します。

スクロールビューに検索インタラクションをインストールする場合は、検索パネルに合わせてコンテンツ挿入を自動的に調整し、トレイトコレクションの変更に自動的に適応します。

それ以外の場合は、macOSのUIで検索パネルをホストするのに十分なスペースがあることを確認する必要があります。

さらに、虫眼鏡のアイコンをタップしたときに利用可能な検索オプションの標準セットを含むメニューを表示します。

UIFindInteractionのoptionsMenuProviderプロパティを使用して、このメニューの内容をカスタマイズできます。

これは、カスタム実装でより重要になります。

そして、私が前に述べた組み込みビューの1つを使用している場合は、それだけです。

アプリが完全にカスタムビューやリストビューなど、他の方法でテキストコンテンツを表示している場合でも、検索インタラクションをアプリに追加できます。

やり方をお見せしましょう。

検索インタラクションに関する良いニュースは、任意のビューにインストールできることです。

アプリに既存の検索と置換の実装がある場合は、UIFindInteractionにブリッジし、システムのUIを活用するのは簡単です。

カスタムビューの既存の検索実装がまだない場合は、特にシステムキーボードを操作するためにUITextInputプロトコルをすでに実装している場合は、始めるのが非常に簡単です。

UIFindInteractionがカスタムビューでどのように機能するかは次のとおりです。

カスタムビューにUIFindInteractionをインストールした後、検索インタラクションデリゲートを設定します。

検索インタラクションデリゲートは、検索セッションの開始時または終了時について通知されるだけでなく、UIFindSessionsを処理する責任があります。

UIFindSessionは、現在強調表示されている結果など、特定のセッションのすべての状態をカプセル化する抽象基本クラスです。

また、「次の結果に進む」や「この文字列を検索する」など、UIから要求されたすべてのアクションにもサービスを提供します。

この状態をすべて自分で管理したい場合は、検索インタラクションデリゲートからUIFindSessionのサブクラスを販売することを選択できます。

アプリに既存の検索と置換の実装がすでにあり、それをシステムUIにブリッジしたい場合、これは良い選択肢です。

それ以外の場合は、システムが状態を処理し、代わりに表示されるドキュメントの内容をカプセル化するクラスでUITextSearchingプロトコルを採用する方がはるかに良いでしょう。

これを行うには、UITextSearchingFindSessionを返し、ドキュメントクラスに接続します。

カスタムビューの検索実装がまだない場合は、これが最良の選択肢です。

コードでこれを行う方法は次のとおりです。

この例には、カスタムドキュメントクラスと、このドキュメントを表示するカスタムビューがあります。

UIFindInteractionがこのビューにインストールされ、UITextSearchingFindSessionがこのドキュメントとともに「検索可能なオブジェクト」として提供されます。

キーボードショートカットが期待どおりに機能するように、ビューコントローラーまたはカスタムビューのいずれかがファーストレスポンダーになることを確認してください。

検索インタラクションを作成し、検索セッションを処理するためのセッションデリゲートを提供します。

ここでは、ビューコントローラーはセッションデリゲートです。

次に、インタラクションによって検索セッションを求められたら、検索可能なオブジェクトとしてドキュメントを提供する新しいUITextSearchingFindSessionを返すだけです。

もちろん、ドキュメントクラスがUITextSearchingプロトコルに準拠していることを確認する必要があります。

UITextSearchingプロトコルを実装するクラスは、ドキュメント内のテキストを実際に見つける責任があります。

システムはperformTextSearchを呼び出し、結果を提供できるアグリゲータオブジェクトを渡します。

アグリゲーターはUITextRangeと連携して、ドキュメントの結果を表します。

これは、テキストの保存方法に意味のあるデータをカプセル化するために使用できる別の抽象クラスです。

たとえば、これはWebKitを使用してテキストをレンダリングするクライアントのDOM範囲を表すことができます。

アグリゲーターもスレッドセーフなので、バックグラウンドスレッドで結果を提供できます。

最後に、検索インタラクションでは、カスタムビューを使用して結果を表示する方法がわからないため、 decorate() が呼び出されたときに、特定のスタイルの結果を装飾する必要があります。

UITextSearching検索セッションとプロトコルは、同じインタラクションを使用して複数の可視ドキュメント間の多重化もサポートしています。

言い換えれば、アプリがメールの会話ビューに似た方法でコンテンツを表示する場合、その場合の各「ドキュメント」はメールメッセージであり、ルートレベルのコレクションビューに単一の検索インタラクションをインストールし、同時にすべてのドキュメントで検索を実行できるため、ユーザーは異なるドキュメントの結果を簡単に移動できます。

だから、iOS 16で新しい検索インタラクションを始めるために必要なのはそれだけです。

多くのテキストコンテンツを表示するシステムビューの場合は、必ずisFindInteractionEnabledを有効にしてください。

既存のfind実装をUIFindInteractionに移動します。

アプリにテキスト検索がまだない場合は、UITextSearchingを実装し、UITextSearchingFindSessionを使用してください。

そして最後に、アプリに競合するキーボードショートカットがないことを確認してください。

そして、それがiOS 16用のアプリの編集インタラクションを更新し、それらを真のデスクトップクラスにするために必要なものです。

アプリで新しいテキスト編集メニューを試して、カスタムUIに編集メニューのインタラクションを採用してください。

また、アプリのテキストコンテンツを検索可能にすることで、生産性を向上させます。

あなたのアプリでこれらの素晴らしい新機能を見つけるのを楽しみにしています。

見てくれてありがとう!必ず「いいね！」、コメント、購読してください。

。