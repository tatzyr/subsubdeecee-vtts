10145

- みなさん、こんにちは。私はプラシャントです。WWDCへようこそ。

2021年、私たちはHLSインタースティシャルを導入しました。

HLSストリームで広告やその他のインタースティシャルをスケジュールする本当に簡単な方法を提供します。

今年は、広告インベントリをより適切に最適化し、プレゼンテーションを微調整できる機能を追加しました。

さあ、HLSインタースティシャルの新機能を見つけましょう。

この講演では、HLSインタースティシャルの仕組みの簡単な概要から始めます。

そして、私たちが追加した新しい広告キューイングオプションについて話し合うことで、それに従います。

その後、特にSNAP属性を使用したライブシナリオで、広告体験を微調整する方法を見ていきます。

次に、HLS仕様に追加した新しいクエリパラメータのいくつかについて説明し、最後にこれらの新機能を組み込んだAVFoundation APIの変更について説明します。

しかし、新機能に飛び込む前に、HLSインタースティシャルですぐにリフレッシュしましょう。

HLSインタースティシャルでは、広告はプログラムのタイムラインにスケジュールできる個別のアセットとして扱われます。

それらはもう不連続タグで縫う必要はありません。

代わりに、多変量プレイリストから直接参照できます。

これにより、プライマリコンテンツから多変量のプレイリストを指すだけでよいため、広告のスケジュールが非常に簡単になります。

これは、主要なコンテンツのタイムラインを表示する典型的なメディアプレイリストです。

再生中に2つの広告をスケジュールしたいとします。

最初の広告を再生後約5秒で表示したいと考えています。

そのために、DATERANGEタグを使用して広告の開始時刻を指定するだけです。

そして、2番目の広告を15秒で表示したいと考えています。

そのために、プレイリストに別のDATERANGEタグを追加します。

それはそれと同じくらい簡単です。

また、プライマリコンテンツにすでにいくつかの広告が縫い付けられている可能性もあります。

ステッチイン広告の期間に等しい履歴書オフセットを指定することで、これらの広告を置き換えることもできます。

これとは別に、HLSインタースティシャルでは、広告のナビゲーション制限を指定したり、ライブシナリオで早期復帰をスケジュールすることもできます。

詳細については、WWDC 2021の「HLSにミッドロールとプレロールを動的に挿入する」をご覧ください。

コンテンツのタイムラインに沿って広告をスケジュールできますが、今年は再生の開始時または終了時に広告の配置を強制する属性を追加しました。

そのために、CUE属性を使用して指定できる次の新しいキューイングオプションを追加しました。

この属性は、次の値の1つまたは組み合わせを取ることができます。

PREの値は、プライマリコンテンツのプレゼンテーションが始まる前に広告を表示します。

これは、プログラムにチューニングする前にプレミアム広告スポットをスケジュールしたいライブシナリオで特に便利です。

POSTの値は、プライマリコンテンツのプレゼンテーション後に広告が表示されることを示します。

これは、ライブイベントの終了時にエンドクレジットをスケジュールしたいイベントストリームに役立つかもしれません。

そして、ONCEの値は、広告を一度だけ表示します。

したがって、ユーザーが広告の前に戻って検索した場合、広告が再び再生されるのを見ることはありません。

これの素晴らしいアプリケーションは、通常、再生の開始時に一度だけ表示される評価画面用です。

これは、プリロールとポストロールとして広告がスケジュールされているプレイリストの例を示しています。

プレロールは一度だけ再生される予定であることに注意してください。

また、再生後約10秒で1回再生される広告も予定されています。

現在、ライブシナリオで広告をスケジュールするには、独自の課題があります。

たとえば、パッケージャーは、メディアを生成しているエンコーダが別のクロックによって駆動されている間、プレイリストでプログラムの日付時刻タグを設定するために1つの時計を使用している可能性があります。

さて、これら2つの時計は必ずしも同期している必要はありません。

たとえば、この例では、セグメント0とセグメント100に関連付けられた日付時刻タグの差は約800秒です。

ただし、個々のセグメントの期間が8秒未満であるため、蓄積されたメディアの持続時間はそれよりもわずかに短くなります。

パッケージクロックがエンコーダクロックよりもわずかに速いシナリオでは、広告が開始される実際のメディアタイムはスレートのどこかに落ちる可能性があります。

そして、ここに示すように広告期間に等しいオフセットでメインコンテンツに再参加することが期待されている場合、実際にはスレートに続くプライマリコンテンツの一部が欠落してしまいます。

OUT値でSNAP属性を使用して、意図した広告開始時間に最も近いセグメント境界でプライマリコンテンツからスナップアウトできるようになりました。

同様に、IN値のSNAP属性を使用して、広告の戻り時間に最も近いプライマリコンテンツにスナップバックします。

事前にパッケージ化されたビデオオンデマンドコンテンツを扱う場合、このクロックドリフトの概念は存在しないため、ライブシナリオにのみSNAP属性を使用することを期待していることに注意してください。

ここでは、広告がスナップアウトとスナップインの両方に予定されているライブプレイリストが表示されます。

今年は、広告インベントリとセッション管理を最適化するのに役立つクエリパラメータも追加しました。

さて、広告ポッドの途中でライブストリームにチューニングしているときは、残りの時間で最も価値のある在庫を表示できるように、その広告ポッドがどこまで進んだかを知りたいでしょう。

そのために、HLS_start_offsetクエリパラメータを追加しました。

HLS_start_offsetクエリパラメータは、インタースティシャルのアセットリストURLの要求とともに提供されます。

ライブコンテンツの場合、これはライブストリームに参加するときに再生が開始されるアセットリストへのオフセットを指定し、ビデオオンデマンドコンテンツの場合、インタースティシャルに置き換えられた領域に求めるときにアセットリストへのオフセットになります。

このサンプルでは、プレイリストの上部から5秒から始まる15秒の広告が予定されているライブプレイリストがあります。

ここに示されているハイライトされたセグメントは、インタースティシャルに置き換えられます。

現在、ライブ参加中、クライアントは通常、ライブエッジの背後にある約3つのターゲット期間になります。

その時点で、予定されている15秒の広告ポッドは10秒間再生されていたでしょう。

したがって、これはHLS_start_offsetクエリパラメータの一部として提供されます。

クライアントの広告時間は残り5秒しかないため、サーバーはそのリストの最後の5秒に最も価値のある広告を掲載するようにアセットリストを構築できます。

サーバーでは、誰かに同じ広告を何度も提供しないように、複数の広告リクエストで同じ再生セッションを追跡する方法が必要になるかもしれません。

したがって、広告リクエストをプライマリ再生セッションに関連付けるために、HLS_primary_idクエリパラメータを追加しました。

クライアントが特定の再生セッションのすべてのhttpリクエストの再生セッションID要求ヘッダーを設定すると、X-Asset-URIおよびX-Asset-List要求にHLS_primary_idクエリパラメータの一部としてこのセッションIDを指定できます。

セッションID要求ヘッダーを設定しないクライアントは、すべてのプライマリ再生セッションに一意の値を作成し、それをプライマリアセット要求とインタースティシャルアセット要求の両方のHLS_primary_idクエリパラメータとして使用する必要があります。

AVFoundationは、クライアント側で広告をスケジュールできるAVPlayerInterstitialControllerとAVPlayerInterstitialEventオブジェクトを提供していることを思い出すかもしれません。

これで、AVPlayerInterstitialEventオブジェクトにキューとSNAPオプションのサポートも追加しました。

Cueプロパティを使用して、広告をプレロールまたはポストロールとしてスケジュールするかどうか、キューオプションを指定できます。

DATERANGEタグのCue属性を介して通知されるplay onceオプションは、willPlayOnceプロパティを介してブール値として設定されます。

スナップアウトするオプションは、alignsStartWithPrimarySegmentBoundaryプロパティを介して通知され、スナップインするには、alignsResumptionWithPrimarySegmentBoundaryプロパティを設定します。

AVPlayerInterstitialEventが成長し続けるにつれて、プロパティの設定をオブジェクトの作成から分離した方が良いかもしれないと考えました。

これで、AVPlayerInterstitialEventオブジェクトを可変にしました。

プライマリアイテムとイベントの開始時間だけでオブジェクトを作成できるようになりました。

また、関連するプロパティを設定することで、さまざまな設定オプションを指定できます。

イベントがコントローラーに設定されると、コントローラーがこれらのオブジェクトのコピーを作るため、イベントオブジェクトへのその後の変更はコントローラーに反映されないことに注意してください。

変更を有効にするには、コントローラーでイベントをもう一度設定する必要があります。

まとめると、X-CUE属性を使用して、広告をプレロールまたはポストロールとしてスケジュールできるようになりました。

X-CUEを1回に設定することで、広告を1回だけ強制的に再生することもできます。

ライブシナリオでクロックドリフトを管理するには、X-SNAP属性を使用します。

ライブ参加中にアセットリストを作成するには、HLS_start_offsetクエリパラメータを使用し、HLS_primary_idクエリパラメータを使用して、インタースティシャルリクエストをプライマリ再生セッションに関連付けることができます。

HLSインタースティシャルを使用して広告をスケジュールすると、AVFoundationがShareplay中に自動的に管理することをご存知ですか？

詳細については、「SharePlayで広告やその他のインタースティシャルを表示する」トークをチェックしてください。

皆さん、私にとってはそれだけです。ありがとうございます。