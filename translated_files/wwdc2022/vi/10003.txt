10003

♪ Nhạc hip-hop nhạc cụ êm dịu ♪

♪

Chào mừng đến với "Gặp gỡ WeatherKit" tại WWDC22.

Tên tôi là Novall, và tôi là một kỹ sư trong nhóm Thời tiết.

Chúng tôi dựa vào dữ liệu thời tiết ngày này qua ngày khác, và nơi chúng tôi lấy thông tin này là rất quan trọng.

Từ việc kiểm tra thời tiết trên Apple Watch của bạn để bạn biết mang theo ô trước khi ra khỏi cửa, đến nông nghiệp bền vững, nơi dự đoán mưa và sương giá có thể giúp nông dân lập kế hoạch luân canh cây trồng, để giữ an toàn và chuẩn bị cho chuyến du lịch bão mùa đông - thời tiết ảnh hưởng đến tất cả mọi người.

Dữ liệu thời tiết chính xác thậm chí còn trở nên quan trọng hơn trong thế giới ngày nay bị ảnh hưởng bởi biến đổi khí hậu của chúng ta.

Và có quyền truy cập vào các dự báo chính xác bây giờ quan trọng hơn bao giờ hết, đó là lý do tại sao chúng tôi tạo ra WeatherKit.

WeatherKit được cung cấp bởi Dịch vụ Thời tiết Apple hoàn toàn mới, một dự báo thời tiết toàn cầu đẳng cấp thế giới.

Nó sử dụng các mô hình thời tiết có độ phân giải cao và các thuật toán dự đoán và học máy để cung cấp cho bạn các dự báo thời tiết siêu địa phương trên toàn cầu.

Với Dịch vụ Thời tiết của Apple, chúng tôi có quyền truy cập vào rất nhiều dữ liệu và tất cả những điều này đều có sẵn cho bạn thông qua WeatherKit.

Dữ liệu thời tiết chính xác yêu cầu thông tin vị trí.

Và giữ dữ liệu đó ở chế độ riêng tư là một trách nhiệm chung.

Để phù hợp với cam kết của chúng tôi về quyền riêng tư, WeatherKit được thiết kế để đưa ra các dự báo siêu địa phương mà không ảnh hưởng đến thông tin người dùng.

Vị trí chỉ được sử dụng để cung cấp dự báo thời tiết và không liên quan đến bất kỳ thông tin nhận dạng cá nhân nào và không bao giờ được chia sẻ hoặc bán.

Với WeatherKit, chúng tôi đã giúp bạn dễ dàng bảo vệ quyền riêng tư của người dùng.

Hôm nay tôi sẽ đi sâu vào chi tiết hơn về WeatherKit để bạn có thể tận dụng tối đa API mới của chúng tôi.

Đầu tiên, tôi sẽ đề cập đến các bộ dữ liệu có sẵn mà chúng tôi cung cấp thông qua WeatherKit, được hỗ trợ bởi Dịch vụ Thời tiết Apple của riêng chúng tôi.

Tiếp theo, tôi sẽ chỉ cho bạn cách yêu cầu thông tin thời tiết bằng cách sử dụng khung WeatherKit và REST API được thiết kế để bạn có thể lấy dữ liệu thời tiết trên bất kỳ nền tảng nào.

Và cuối cùng, tôi sẽ đề cập đến một số yêu cầu triển khai bổ sung và các phương pháp hay nhất.

Hãy để tôi bắt đầu với một cái nhìn tổng quan về các bộ dữ liệu thời tiết có sẵn.

Như tôi đã đề cập, bạn có quyền truy cập vào rất nhiều dữ liệu trong WeatherKit.

Vậy hãy nói về từng tập dữ liệu.

Bộ dữ liệu thời tiết hiện tại mô tả các điều kiện "bây giờ" tại địa điểm được yêu cầu.

Nó đại diện cho một thời điểm duy nhất và bao gồm các điều kiện như chỉ số UV, nhiệt độ và gió.

Dự báo phút chứa các điều kiện lượng mưa từng phút cho giờ tiếp theo, nếu có.

Bộ dữ liệu này rất hữu ích cho việc quyết định có mang theo ô khi bạn bước ra khỏi cửa hay không.

Dự báo hàng giờ là một tập hợp các dự báo bắt đầu từ giờ hiện tại và cung cấp dữ liệu lên đến 240 giờ.

Mỗi giờ trong dự báo hàng giờ bao gồm các điều kiện như độ ẩm, tầm nhìn, áp suất và điểm sương.

Dự báo hàng ngày chứa một bộ sưu tập dự báo 10 ngày.

Mỗi ngày trong dự báo hàng ngày cung cấp thông tin về cả ngày, như nhiệt độ cao và thấp, bình minh và hoàng hôn.

Cảnh báo thời tiết chứa các cảnh báo thời tiết khắc nghiệt được đưa ra cho vị trí được yêu cầu.

Bộ dữ liệu này chứa thông tin quan trọng để giữ cho người dùng của bạn an toàn, được thông báo và chuẩn bị.

Và cuối cùng, thời tiết lịch sử cung cấp các dự báo thời tiết đã lưu từ quá khứ, vì vậy bạn có thể thấy các xu hướng trong dữ liệu thời tiết.

Bạn có thể truy cập dữ liệu lịch sử bằng cách chỉ định ngày bắt đầu và ngày kết thúc cho các yêu cầu hàng giờ và hàng ngày.

Điều này cho phép bạn truy cập vào rất nhiều dữ liệu.

Chúng tôi nghĩ rằng có rất nhiều cách quan trọng và có tác động mà bạn có thể sử dụng thời tiết lịch sử.

Bây giờ bạn đã thấy tất cả dữ liệu thời tiết phong phú có sẵn, tôi sẽ hướng dẫn bạn cách yêu cầu dữ liệu thời tiết này với API WeatherKit.

Dữ liệu Thời tiết của Apple có sẵn thông qua cả khung gốc và bộ API REST.

Đầu tiên, hãy để tôi chỉ cho bạn cách dễ dàng truy cập dữ liệu thời tiết với khung Swift của chúng tôi.

Tất cả những gì nó cần là một vài dòng mã.

Và với Swift Concurrency, yêu cầu thời tiết rất đơn giản.

Đầu tiên, bạn sẽ nhập WeatherKit và CoreLocation.

Sau đó, bạn sẽ tạo một đối tượng Dịch vụ thời tiết, làm điểm vào của bạn cho Dịch vụ Thời tiết.

Bạn sẽ tạo một CLLocation với tọa độ cho vị trí bạn quan tâm.

Ở đây, tôi đang sử dụng quê hương Syracuse, New York của mình.

Sau đó, bạn sẽ gọi weather(for:) trên phiên bản weatherService và chuyển đến vị trí được tạo ở trên.

Khi cuộc gọi kết thúc, bạn có thể truy cập dữ liệu liên quan mà bạn cần cho ứng dụng của mình, như nhiệt độ hiện tại và Chỉ số UV trong ví dụ này.

Bây giờ tôi đã cho bạn thấy việc yêu cầu dữ liệu thời tiết với Swift dễ dàng như thế nào, hãy để tôi đưa bạn qua một ví dụ khác mà tôi đang sử dụng một ứng dụng du lịch mà tôi đang xây dựng trong SwiftUI.

Bạn có thể lấy dự án đã hoàn thành từ liên kết được liên kết với phiên này.

Vì tôi thực sự mong muốn được đi du lịch một lần nữa, tôi đã quyết định tạo một ứng dụng lập kế hoạch chuyến bay để lên kế hoạch cho chuyến đi tiếp theo của mình.

Tôi đã tạo logic cho hành trình chuyến bay của mình, nhưng khi tôi nhấn vào từng chuyến bay trong chuyến đi của mình, tôi muốn hiển thị các cột chứa điều kiện, lượng mưa, gió và nhiệt độ tại mỗi điểm đến.

Bước đầu tiên là kích hoạt WeatherKit.

Đăng ký ID ứng dụng trong Cổng thông tin dành cho nhà phát triển, sau đó chọn Khả năng và Dịch vụ ứng dụng t abs để bật WeatherKit.

Sau đó trong Xcode, thêm khả năng WeatherKit vào dự án.

Với sự chuẩn bị đó, hãy để tôi đi qua cách tôi sẽ lấy dữ liệu thời tiết cho từng địa điểm này.

Ở đây tôi có một cấu trúc Sân bay đã được thiết lập có chứa vĩ độ và kinh độ của các sân bay đích của tôi.

Tôi sẽ nhận được dự báo hàng giờ bằng cách gọi thời tiết (cho:) về dịch vụ thời tiết chung của chúng tôi và sau đó vượt qua vị trí sân bay của chúng tôi.

Bởi vì tôi chỉ muốn một tập hợp con dữ liệu, tôi cũng đã chỉ định bao gồm dự báo hàng giờ trong yêu cầu.

Bây giờ, tôi sẽ xây dựng và chạy ứng dụng của mình.

Bây giờ tôi có thể xem chế độ xem tùy chỉnh của mình được cập nhật để hiển thị các điều kiện tại mỗi sân bay.

Điều tiếp theo tôi cần làm trong khi xây dựng ứng dụng này là hiển thị ghi công cho các nguồn dữ liệu trong ứng dụng của tôi.

Đầu tiên, tôi sẽ lấy URL phân bổ từ thuộc tính attribution.legalPageURL.

Đây là liên kết đến trang phân bổ pháp lý chứa thông tin bản quyền về các nguồn dữ liệu thời tiết.

Tôi cũng sẽ cần lấy URL cho dấu hiệu Apple Weather kết hợp.

Nó có sẵn ở cả hai biến thể sáng và tối, vì vậy tôi sẽ kiểm tra giá trị môi trường colorScheme để tìm hiểu xem chế độ xem SwiftUI hiện đang hiển thị ở dạng sáng hay tối.

Cuối cùng, tôi sẽ xây dựng và chạy lại.

Lưu ý rằng dấu thời tiết Apple và liên kết phân bổ mở ra trong Bộ điều khiển SFSafariView.

Đó là tất cả những gì cần thiết để có được thời tiết cho ứng dụng lập kế hoạch chuyến bay của chúng tôi và có rất nhiều cách bạn có thể sử dụng API WeatherKit để thêm dữ liệu thời tiết vào ứng dụng của mình.

Nhưng đó chỉ là khuôn khổ gốc.

REST API cung cấp dữ liệu thời tiết phong phú giống như khung Swift và có thể được sử dụng trên bất kỳ nền tảng nào.

Trong ví dụ này, tôi đang chỉ ra cách bạn có thể yêu cầu cảnh báo thời tiết từ điểm cuối weatherkit.apple.com.

Đầu tiên, bạn yêu cầu một mã thông báo xác thực.

Tôi sẽ thảo luận thêm về điều đó một chút.

Sau đó, để lấy đối tượng thời tiết, trước tiên bạn tạo một URL cho biết bộ dữ liệu thời tiết mong muốn cho một vị trí nhất định.

Đảm bảo thiết lập ngôn ngữ thích hợp cho phản hồi cục bộ.

Sau đó, cung cấp vĩ độ và kinh độ của vị trí quan tâm.

Cho biết tập dữ liệu mong muốn.

Bạn có thể nhận thấy tham số này là số nhiều nên bạn có thể yêu cầu nhiều tham số cùng một lúc bằng cách tách mỗi tham số bằng dấu phẩy.

Và cuối cùng, mã quốc gia cho vị trí được yêu cầu.

Nhưng lưu ý, mã quốc gia chỉ được yêu cầu nếu bạn yêu cầu bộ dữ liệu cảnh báo thời tiết.

Tiếp theo, bạn sẽ tìm nạp dữ liệu thời tiết bằng URL và mã thông báo xác thực của bạn từ phía trên, chuyển đổi kết quả thành JSON.

Với điều đó, bạn có thể truy cập các cảnh báo thời tiết và thông tin chi tiết của chúng.

Vì vậy, một lần nữa, một ví dụ khác về việc bạn dễ dàng truy cập dữ liệu thời tiết như thế nào, chỉ lần này thông qua REST.

Để đi sâu hơn về thiết lập bạn cần, hãy xem lại xác thực.

Đối với WeatherKit REST API, có một vài bước bổ sung để xử lý xác thực.

Trong Cổng thông tin dành cho nhà phát triển, bạn sẽ bật quyền truy cập cho các yêu cầu WeatherKit bằng cách tạo khóa xác thực được bật cho WeatherKit và ID dịch vụ liên quan.

Khóa riêng tư có thể được tạo trong phần Khóa của Cổng thông tin dành cho nhà phát triển.

WeatherKit yêu cầu mã thông báo để xác thực ủy quyền trên mỗi yêu cầu.

Vì vậy, trên máy chủ của bạn, bạn sẽ triển khai dịch vụ mã thông báo để tạo mã thông báo web JSON đã ký bằng khóa riêng tư của mình.

Đối với những người quen thuộc với xác thực mã thông báo web JSON, đây là một quy trình ủy quyền khá chuẩn, nhưng hãy để tôi chia sẻ một số chi tiết trong trường hợp đây là lần đầu tiên bạn làm việc với nó.

Để tạo mã thông báo đã ký, bạn sẽ tạo tiêu đề chứa các trường và giá trị được mô tả trong tài liệu dành cho nhà phát triển.

Sau đó tạo tải trọng chứa thông tin cụ thể cho WeatherKit REST API và ứng dụng của bạn, bao gồm các mục như nhà phát hành, chủ đề và thời gian hết hạn.

Và cuối cùng, bạn sẽ ký mã thông báo để sử dụng với cuộc gọi tiếp theo đến API REST WeatherKit.

Quay trở lại ví dụ cảnh báo thời tiết của tôi, đây là nơi bạn sẽ yêu cầu mã thông báo từ dịch vụ ký của mình và thêm mã thông báo vào tiêu đề Ủy quyền của yêu cầu HTTP của bạn cho dữ liệu thời tiết.

Vậy đó là WeatherKit REST API.

Một trong hai cách tuyệt vời để bạn truy cập dữ liệu thời tiết từ Dịch vụ Thời tiết của Apple.

Cuối cùng, tôi sẽ đề cập đến một vài yêu cầu bổ sung để xuất bản trên App Store hoặc trước khi bạn phát trực tiếp trên bất kỳ nền tảng nào sử dụng REST API.

Mỗi yêu cầu này đều được áp dụng bất kể bạn đang sử dụng Swift hay REST API gốc.

Yêu cầu đầu tiên là ghi công.

Như bạn đã thấy trong bản demo của tôi, bạn sẽ nhận được một liên kết từ API phân bổ của chúng tôi mà bạn sẽ cần hiển thị trong ứng dụng gốc hoặc web của mình.

Yêu cầu thứ hai là biểu tượng ghi công.

WeatherKit API giúp việc này trở nên dễ dàng và thuận tiện bằng cách cung cấp nội dung hình ảnh bạn cần hiển thị trong ứng dụng của mình.

Và cuối cùng, nếu bạn sẽ hiển thị cảnh báo thời tiết, bạn cũng sẽ cần liên kết đến một trang sự kiện được cung cấp trong phản hồi.

Vì vậy, đó là cách dễ dàng để chuẩn bị ứng dụng của bạn để xuất bản trên App Store hoặc web.

Vì vậy, đó là WeatherKit - các dự báo siêu địa phương đã cung cấp cho Dịch vụ Thời tiết Apple có thể truy cập thông qua khung Swift và API REST của chúng tôi.

Cả hai đều mở ra một thế giới khả năng cho bạn sử dụng dữ liệu thời tiết trong các ứng dụng của mình, trên bất kỳ nền tảng hoặc thiết bị nào.

Chúng tôi hy vọng bạn thích buổi học này.

Bên cạnh việc kiểm tra các liên kết liên quan đến phiên này, hãy đọc tài liệu và tải xuống dự án.

Và tất nhiên, chúng tôi rất thích phản hồi của bạn.

Chúng tôi nóng lòng muốn xem tất cả những cách sáng tạo và có tác động mà bạn sử dụng WeatherKit.

Cảm ơn bạn và chúc bạn có một WWDC tuyệt vời!

♪