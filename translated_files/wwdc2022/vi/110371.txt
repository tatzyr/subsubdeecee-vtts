110371

- Xin chào. Tôi là Jake, một nhà thiết kế trong nhóm Xcode.

Phát triển ứng dụng đa nền tảng đang được đưa lên cấp độ tiếp theo trong Xcode 14.

Một mục tiêu ứng dụng duy nhất hiện có thể hỗ trợ nhiều điểm đến hơn trên nhiều nền tảng, tất cả trong khi vẫn duy trì một cơ sở mã chung duy nhất, chia sẻ cài đặt theo mặc định và cho phép các cách mới để điều kiện hóa khi cần thiết.

Đầu tiên, chúng tôi sẽ đề cập đến mục tiêu ứng dụng đa nền tảng là gì và trong trường hợp nào nó hoạt động tốt nhất.

Tiếp theo, chúng tôi sẽ sửa đổi dự án của mình để hỗ trợ nhiều điểm đến và nền tảng, sau đó chúng tôi sẽ cập nhật dự án của mình để xây dựng và chạy trên nền tảng mới.

Chúng tôi sẽ đảm bảo ứng dụng của chúng tôi trông tuyệt vời trên mỗi nền tảng được hỗ trợ...

Và cuối cùng chúng tôi sẽ tích hợp Xcode Cloud với các thay đổi dự án của chúng tôi.

Đầu tiên, hãy hiểu kỹ thuật nào chúng tôi muốn sử dụng để cho phép ứng dụng của chúng tôi hỗ trợ nhiều nền tảng.

Trước Xcode 14, nếu bạn muốn ứng dụng của mình hỗ trợ iOS và macOS, bạn sẽ cần hai mục tiêu riêng biệt.

Điều này thật tuyệt vời nếu dự án của bạn cần các cơ sở mã khác nhau đáng kể, chia sẻ rất ít cài đặt giữa các nền tảng khác nhau hoặc nếu mỗi mục tiêu ứng dụng phụ thuộc nhiều vào các công nghệ cơ bản khác nhau.

Nếu đó vẫn là trường hợp với dự án của bạn ngày hôm nay, đặt cược tốt nhất của bạn là tiếp tục sử dụng các mục tiêu riêng biệt cho từng nền tảng.

Trong Xcode 14, một mục tiêu ứng dụng duy nhất có thể tuyên bố hỗ trợ cho nhiều điểm đến như iPhone, iPad, Mac và Apple TV.

Điều này thật tuyệt vời cho một ứng dụng sử dụng cơ sở mã chung và chia sẻ hầu hết các cài đặt của nó trên tất cả các điểm đến trong khi vẫn cho phép tùy chỉnh khi cần thiết.

Hãy cùng xem các ứng dụng đa nền tảng hoạt động như thế nào trong Xcode 14.

Nếu chúng ta đang bắt đầu lại từ đầu, một cách tuyệt vời để bắt đầu là sử dụng mẫu ứng dụng đa nền tảng mới, được cải tiến khi tạo một dự án mới trong Xcode.

Mẫu ứng dụng đa nền tảng sử dụng SwiftUI cho vòng đời và giao diện của nó, điều này bắt đầu chúng ta với một mục tiêu được định cấu hình theo mặc định để hỗ trợ iPhone, iPad và Mac.

Đây là một cấu hình tuyệt vời cho các dự án mới.

Bởi vì chúng tôi đang sử dụng SwiftUI, chúng tôi có quyền truy cập vào bộ tính năng đầy đủ của SDK của mỗi nền tảng, cho phép tạo ra các ứng dụng mới tuyệt vời tận dụng những gì mỗi nền tảng cung cấp.

Các dự án hiện tại cũng có thể tuyên bố hỗ trợ cho nhiều điểm đến trong mục tiêu ứng dụng của họ và sử dụng SwiftUI để có quyền truy cập vào toàn bộ sức mạnh của SDK của mỗi nền tảng.

Hãy cùng xem cách thêm điểm đến Mac vào ứng dụng iOS hiện có.

Tôi đang xây dựng một ứng dụng Food Truck, và nó hoạt động tốt trên iPhone và iPad.

Tôi khá hài lòng với ứng dụng iOS này, và bây giờ tôi muốn mang nó đến Mac và nắm lấy nền tảng và các tính năng của nó.

Hãy cùng xem dự án của chúng ta trông như thế nào trong Xcode.

Nếu chúng ta xem xét mục tiêu ứng dụng của tôi, chúng ta có thể thấy danh sách tất cả các điểm đến mà ứng dụng của tôi hỗ trợ.

Bạn có thể thấy tôi đã có một điểm đến Mac - Được thiết kế cho iPad.

Điều này cho phép các máy tính Mac với Apple silicon chạy ứng dụng iOS chưa được sửa đổi của tôi.

Đây là một cách tuyệt vời để bắt đầu hỗ trợ Mac, nhưng tôi muốn đưa hỗ trợ Mac của mình lên một tầm cao mới.

Có thể nói, hãy thêm trải nghiệm "Được thiết kế cho Mac".

Chúng tôi có thể dễ dàng chỉnh sửa danh sách các điểm đến được hỗ trợ và thêm điểm đến Mac vào ứng dụng của mình.

Có một vài lựa chọn cho các điểm đến Mac: Mac, Mac Catalyst và Designed cho iPad, cái cuối cùng chuyển sang màu xám, vì ứng dụng của tôi đã hỗ trợ nó.

Lựa chọn giữa Mac và Mac Catalyst chủ yếu phụ thuộc vào công nghệ mà chúng tôi quan tâm nhất khi sử dụng.

Nếu ứng dụng của chúng tôi sử dụng nhiều UIKit hoặc Bảng phân cảnh ở cốt lõi của ứng dụng, Mac Catalyst sẽ là một cách tuyệt vời để chuyển đổi ứng dụng iPad hiện có của chúng tôi thành một ứng dụng Mac tương thích.

Tuy nhiên, ứng dụng của chúng tôi sử dụng SwiftUI, điều này làm cho "tùy chọn Mac" trở thành lựa chọn tốt nhất để tạo ra ứng dụng Mac của chúng tôi.

Chúng tôi sẽ có được giao diện Mac tuyệt vời ngay lập tức, với toàn bộ sức mạnh của macOS SDK mà không có bất kỳ giới hạn nào.

Có nghĩa là, chúng tôi sẽ có quyền tự do sử dụng UIKit trong ứng dụng iOS và AppKit trong ứng dụng macOS của chúng tôi, nếu chúng tôi muốn sự linh hoạt đó.

Với tất cả những điều đó trong tâm trí, hãy chọn Mac, lựa chọn tốt nhất để làm việc với SwiftUI.

Khi tôi đưa ra lựa chọn của mình, Xcode sẽ cảnh báo tôi về một số thay đổi cần thiết để chuẩn bị cho dự án của tôi để hỗ trợ Mac.

Trong trường hợp này, Xcode sẽ cập nhật mục tiêu của tôi để chỉ bao gồm các phụ thuộc và khuôn khổ được hỗ trợ trên Mac.

Điều quan trọng cần lưu ý là Xcode sẽ không thay đổi mã của tôi, vì vậy nếu tôi đang gọi API không khả dụng trên Mac, tôi sẽ cần tự giải quyết những vấn đề đó.

Khi tôi chọn tùy chọn Mac của mình, nó sẽ được thêm vào danh sách các điểm đến được hỗ trợ của tôi.

Hoàn toàn hợp lệ khi có nhiều hơn một điểm đến Mac khi tôi đang phát triển trong Xcode.

Điều này đặc biệt hữu ích nếu tôi đang chuyển từ "Mac Catalyst" hoặc "Được thiết kế cho iPad" sang một ứng dụng Mac đầy đủ.

Điều này có nghĩa là tôi có thể tiếp tục thử nghiệm từng sản phẩm Mac của mình trong Xcode.

Và tôi không nhất thiết bị giới hạn trong một lựa chọn duy nhất khi phát triển ứng dụng của mình.

Tuy nhiên, nếu tôi xuất bản ứng dụng Mac gốc của mình lên App Store, ứng dụng Designed for iPad của tôi sẽ không còn khả dụng cho khách hàng của tôi nữa, vì vậy Xcode cung cấp một cách nhanh chóng để xóa điểm đến này.

Nhưng tôi sẽ cân nhắc việc xóa điểm đến này khi tôi hài lòng với trải nghiệm Mac gốc của mình.

Cho dù tôi đang bắt đầu lại từ đầu hay thêm một điểm đến mới vào một ứng dụng hiện có, việc sử dụng một mục tiêu duy nhất trong Xcode cho phép tôi chia sẻ mã và xây dựng cài đặt theo mặc định.

Có thể có những trường hợp tôi muốn tùy chỉnh một cài đặt riêng lẻ, như tên hiển thị ứng dụng của tôi hoặc phiên bản triển khai tối thiểu.

Chúng ta hãy xem cách thực hiện điều đó trong trình chỉnh sửa mục tiêu được cải thiện trong Xcode 14.

Nhiều cài đặt mục tiêu ứng dụng hiện bao gồm một cách để điều kiện hóa giá trị của nó.

Trên các cài đặt được hỗ trợ, tôi có thể hiển thị một trình chỉnh sửa cho phép tôi đặt giá trị mặc định cho mỗi cấu hình xây dựng trong dự án của mình.

Tôi có một cấu hình Beta tùy chỉnh mà tôi đã thêm vào, cũng như các cấu hình Gỡ lỗi và Phát hành tiêu chuẩn đi kèm với các dự án Xcode mới.

Tôi muốn đặt cho ứng dụng của mình một tên hiển thị khác khi được xây dựng với cấu hình beta, vì vậy tôi có thể chỉnh sửa tên ngay tại đây.

Khi tôi nhập, chúng ta sẽ thấy tên hiển thị của ứng dụng trong Xcode đã được thay thế bằng cách đọc tất cả các giá trị có thể có mà tên hiển thị hiện có thể có.

Nếu cần, tôi cũng có thể thêm một điều kiện, cho phép tôi chỉ định một giá trị dựa trên SDK nào đang được sử dụng.

Điều này cho phép tôi nói đặt một tên cụ thể cho cấu hình beta khi xây dựng cho Mac.

Được rồi, tôi nghĩ chúng ta đã hoàn thành các chỉnh sửa mà chúng ta muốn thực hiện trong tab Chung.

Hãy cùng xem tab Ký và Khả năng để biết bất kỳ thay đổi nào khác mà chúng tôi cần thực hiện.

Tin tốt là, với tính năng Đăng nhập Tự động được bật, không có bước bổ sung nào để thực hiện.

Khi tôi thêm điểm đến Mac của mình, Giấy chứng nhận ký và Hồ sơ cung cấp cần thiết cho Mac đã được tạo thay mặt tôi.

Cả hai sản phẩm ứng dụng iOS và macOS của tôi đều sử dụng cùng một mã định danh gói theo mặc định, điều này thật tuyệt vời, bởi vì điều đó có nghĩa là khi tôi xuất bản chúng lên App Store, chúng sẽ được cung cấp cho Universal Purchase.

Vì vậy, những người mua ứng dụng iOS của tôi cũng sẽ tự động nhận được ứng dụng Mac của tôi.

Ứng dụng của tôi cũng sử dụng các khả năng như thông báo đẩy.

Bất kỳ khả năng nào tôi đang sử dụng cho ứng dụng iOS của mình có thể áp dụng cho ứng dụng macOS của tôi đều được áp dụng mà không cần làm thêm công việc nào từ tôi.

Chúng thậm chí còn được kết hợp thành một tệp quyền lợi duy nhất.

Bây giờ chúng tôi đã thêm hỗ trợ cho nhiều điểm đến vào ứng dụng của mình, mục tiêu tiếp theo của chúng tôi là xây dựng nó.

Việc gặp sự cố khi xây dựng ứng dụng cho một điểm đến mới là điều bình thường, đặc biệt nếu có liên quan đến SDK mới, như hỗ trợ Mac mới của chúng tôi.

Vì vậy, chúng ta hãy xem xét một số vấn đề phổ biến này.

Một số khuôn khổ không có sẵn cho tất cả các nền tảng.

Chúng tôi sẽ cần đảm bảo rằng chúng tôi không nhập hoặc liên kết bất kỳ khuôn khổ không khả dụng nào.

Hãy nhớ rằng Xcode sẽ không thay đổi mã của chúng tôi khi thêm hỗ trợ cho một điểm đến mới, vì vậy chúng tôi sẽ cần điều chỉnh mã của mình dựa trên SDK, tương tự như cách chúng tôi điều kiện hóa cài đặt ứng dụng của mình.

Điều này cũng đúng với API.

Một số tính năng được đánh dấu là không khả dụng dựa trên SDK mà chúng tôi đang xây dựng.

Swift cung cấp một cách để điều kiện hóa các phần mã của chúng tôi để chỉ bao gồm các tính năng có sẵn cho SDK mà chúng tôi đang xây dựng.

Xcode cũng cho phép chúng tôi chỉ định xem một tệp riêng lẻ có nên được biên dịch khi xây dựng cho một số SDK hay không.

Nếu tôi xây dựng dự án của mình ngay bây giờ...

Tôi không thấy bất kỳ vấn đề gì.

Đó là bởi vì tôi vẫn có một điểm đến được chọn trên thanh công cụ của mình sử dụng iOS SDK.

Tôi sẽ cần chọn "Mac Mac của tôi" từ danh sách để xây dựng dựa trên macOS SDK.

Việc xây dựng hiện đang tiết lộ một số vấn đề mới và như chúng tôi mong đợi, chúng chủ yếu liên quan đến tính khả dụng.

Trong một trong những tệp của tôi, tôi đang nhập ARKit, tệp này không khả dụng trên Mac.

Tôi có thể gói câu lệnh nhập này trong #if canImport để điều kiện hóa nó.

Điều này rất hữu ích nếu tôi không muốn quản lý danh sách các nền tảng đã biết mà một khuôn khổ có sẵn và chỉ cần nói nếu nó không có sẵn, đừng bao gồm nó.

Tuy nhiên, tôi vẫn đang sử dụng ARKit trong suốt tệp này, vì vậy đôi khi sẽ có ý nghĩa hơn khi điều kiện hóa toàn bộ tệp cho SDK.

Nếu chúng ta điều hướng trở lại mục tiêu của mình và chuyển đến tab Giai đoạn Xây dựng, tôi có thể tìm kiếm tệp của mình...

Và chỉ định nó chỉ nên được biên dịch cho iOS.

Sau khi xây dựng, một khi tôi đã thực hiện những thay đổi đó, Xcode báo cáo một vấn đề mới - một khuôn khổ có sẵn trên Mac, SwiftUI, có một tính năng được đánh dấu là không khả dụng.

Cụ thể, tôi đang sử dụng EditMode trên iOS để cho phép người dùng chỉnh sửa và chọn nội dung trong Bảng và Danh sách, nhưng trên macOS EditMode không tồn tại!

Người dùng đã có thể tự do chọn và chỉnh sửa các hàng nội dung trên Mac, vì vậy hãy đảm bảo mã này chỉ chạy trên iOS.

Tôi có thể điều chỉnh tài sản môi trường của mình và bất kỳ nơi nào tôi đang sử dụng Chế độ chỉnh sửa bên dưới.

Bây giờ, tôi cần đảm bảo rằng bất kỳ nơi nào tôi đang sử dụng thuộc tính này cũng đều bị điều kiện hóa, như công cụ sửa đổi onChange này.

Tôi có thể bọc toàn bộ công cụ sửa đổi trong điều kiện "if os".

Và cuối cùng, tôi đang sử dụng chế độ xem EditButton trên thanh công cụ, cũng chỉ dành cho iOS.

Được rồi, hãy thử chạy ứng dụng của chúng tôi.

À! Nó sống! Ứng dụng của chúng tôi hiện được xây dựng và chạy trên Mac!

Chỉ vì ứng dụng của chúng tôi hiện đang được xây dựng và chạy trên nền tảng mới của chúng tôi không có nghĩa là công việc của chúng tôi đã hoàn thành.

Sẽ có những trường hợp bạn muốn tinh chỉnh trải nghiệm ứng dụng của mình cho những gì người dùng trên nền tảng mới của bạn mong đợi.

Ngoài ra, việc cắt giảm các tính năng chỉ dành cho iOS của chúng tôi không phải là kết thúc hành trình của chúng tôi.

Bây giờ chúng tôi có tất cả các tính năng của macOS SDK để chơi.

Bây giờ tôi thấy ứng dụng của mình đang chạy trên Mac, tôi nhận thấy một điều kỳ quặc về ứng dụng của mình mà không cảm thấy tự nhiên trong bối cảnh mới của nó.

Những chiếc bánh rán này trong chế độ xem lưới này có vẻ quá lớn!

Đó là bởi vì các mục lưới của chúng tôi được thiết kế để chạm vào.

Những tình huống như thế này phát sinh khi bạn khai báo kích thước điểm cho một phần tử giao diện người dùng hoặc tùy chỉnh điều khiển chỉ với một nền tảng duy nhất trong tâm trí.

Trên Mac, chúng tôi không cần phải làm cho các nút hoặc hình thu nhỏ của mình quá lớn, vì chúng tôi có một thiết bị trỏ chính xác hơn nhiều.

Đây là một trường hợp tuyệt vời để điều kiện hóa một hằng số trong dự án của chúng tôi để thay đổi dựa trên SDK mà chúng tôi đang xây dựng.

Khi chúng tôi đưa ứng dụng của mình lên các nền tảng khác, điều quan trọng là phải xem xét lại nhiều lựa chọn này với kỳ vọng của nền tảng mới của chúng tôi.

Hãy xem xét việc chỉ định một giá trị khác dựa trên SDK mà chúng tôi đang xây dựng.

Một kỹ thuật tôi thường sử dụng là tạo một hằng số thành một thuộc tính được tính toán và sử dụng "#if os" để điều kiện hóa những gì được trả về.

Hãy chuyển đổi cái này thành một thuộc tính được tính toán và trả về những gì trước đây là một hằng số...

Nhưng chỉ trả về giá trị đó trên iOS.

À, 80 cảm thấy có kích thước tự nhiên hơn nhiều.

Bây giờ, đối với việc sử dụng macOS SDK, có một tính năng mới thú vị trong SwiftUI cho phép chúng tôi thêm phần tử giao diện người dùng của riêng mình vào Thanh menu.

Tôi có một chế độ xem tóm tắt cho ứng dụng của mình mà tôi muốn cho phép người dùng của mình truy cập nhanh chóng và dễ dàng.

Hãy đi đến khai báo Ứng dụng của tôi, và ở đây, tôi có thể thêm một Cảnh mới cho Menu Bar Extra của mình.

Tuy nhiên, lưu ý rằng vì đây là tính năng chỉ dành cho macOS, tôi cần điều kiện hóa nó cho macOS SDK.

Hãy xây dựng và chạy và xem qua.

À tuyệt, biểu tượng xe tải của tôi hiện đang hiển thị trên thanh menu.

Tuyệt vời, bây giờ người dùng Mac của tôi có thể xem nhanh thông tin hôm nay ngay từ thanh menu của họ.

Khi chúng tôi sử dụng SwiftUI, chúng tôi có quyền truy cập vào SDK đầy đủ của từng nền tảng và có thể sử dụng các tính năng tuyệt vời của nó.

Điều quan trọng cần lưu ý là khi chúng tôi đưa ứng dụng của mình lên các nền tảng khác, chúng tôi thường sẽ cần xem xét lại nhiều lựa chọn trong quá khứ khi làm việc trong bối cảnh nền tảng mới của chúng tôi.

SwiftUI đưa kỳ vọng nền tảng trực tiếp vào API.

Nhiều yếu tố giao diện sẽ có được giao diện tự động trông tuyệt vời trên mỗi nền tảng.

Ngược lại, điều đó có nghĩa là chúng ta có thể mất kiểu dáng tự động đó khi chúng ta tùy chỉnh nhiều các điều khiển và các phần khác của giao diện người dùng, vì vậy chúng ta nên luôn kiểm tra kỹ giao diện người dùng của mình trông tuyệt vời ở mọi nơi.

Tất cả những gì đã nói, khi chúng tôi xây dựng ứng dụng thú vị của mình, chúng tôi nên đảm bảo rằng chúng tôi đang tuân theo các phương pháp hay nhất được đặt ra bởi các nguyên tắc giao diện con người.

Bây giờ chúng tôi hài lòng với những thay đổi cục bộ đối với ứng dụng của mình, đã đến lúc lưu trữ các sản phẩm ứng dụng của chúng tôi và tải chúng lên App Store Connect, điều mà chúng tôi có thể thực hiện từ Xcode hoặc tự động hóa nó với Xcode Cloud.

Khi chúng tôi đã sẵn sàng, chúng tôi có thể chia sẻ ứng dụng với những người thử nghiệm nội bộ và bên ngoài trên TestFlight và phát hành nó lên App Store.

Chúng tôi sẽ cần lưu trữ các sản phẩm của mình để tải chúng lên App Store Connect.

Chỉ vì chúng tôi có một mục tiêu duy nhất không có nghĩa là chúng tôi chỉ có một sản phẩm duy nhất.

Chúng tôi sẽ cần lưu trữ cho từng nền tảng và tải chúng lên riêng lẻ.

Nếu bạn đang xây dựng và lưu trữ cục bộ, bạn sẽ cần chọn một điểm đến có SDK mà bạn muốn tạo kho lưu trữ.

Nếu tôi muốn tạo ứng dụng macOS của mình, tôi sẽ cần chọn "Mac của tôi" từ danh sách các điểm đến, nếu không tôi sẽ chọn một thiết bị iOS để tạo ứng dụng iOS của mình.

Khi tôi đã chọn một điểm đến, tôi có thể chọn "Lưu trữ sản phẩm" để tạo kho lưu trữ.

Khi kho lưu trữ của tôi hoàn tất, tôi có thể sử dụng cửa sổ Organizer trong Xcode để tải chúng lên App Store Connect.

Nếu tôi đang sử dụng Xcode Cloud, tôi có thể thêm các hành động vào quy trình làm việc của mình để xây dựng, kiểm tra và lưu trữ các sản phẩm của mình.

Trong danh sách các hành động trong quy trình làm việc của mình, tôi có thể tạo các mục mới để xây dựng, kiểm tra, phân tích và lưu trữ từng sản phẩm của mình.

Trong trường hợp này, tôi có một ứng dụng iOS và một ứng dụng macOS.

Tôi có thể tiến thêm một bước nữa và bao gồm chuẩn bị triển khai để tự động tải ứng dụng của mình lên App Store Connect và tôi thậm chí có thể gửi những bản dựng đó đến nhóm TestFlight nội bộ của mình ngay lập tức và bắt đầu nhận phản hồi về những thay đổi nóng hổi.

Tóm lại, Xcode 14 đưa phát triển ứng dụng đa nền tảng lên một tầm cao mới với các mục tiêu ứng dụng được sắp xếp hợp lý hiện có thể hỗ trợ nhiều điểm đến hơn trên nhiều nền tảng.

Với một mục tiêu ứng dụng duy nhất, bạn có thể duy trì một cơ sở mã chung và các cài đặt được chia sẻ theo mặc định.

Như đã được chứng minh, chúng tôi có thể điều chỉnh các cài đặt và mã của mình dựa trên nhu cầu của mình, cho phép chúng tôi tùy chỉnh ứng dụng của mình để phù hợp nhất với mong đợi của nền tảng.

Phần còn lại là tùy thuộc vào bạn.

Để tìm hiểu thêm về các tính năng và cải tiến mới trong Xcode năm nay, hãy xem "Có gì mới trong Xcode."

Tôi nóng lòng muốn xem bạn mang đến những ý tưởng đáng kinh ngạc nào cho cuộc sống với sức mạnh của Xcode và SwiftUI.