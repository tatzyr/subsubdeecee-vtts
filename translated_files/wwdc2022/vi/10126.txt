10126

♪ ♪

Christian: Xin chào, tên tôi là Christian.

Tôi là một kỹ sư trong nhóm ARKit, và tôi muốn chào đón bạn đến với phiên của chúng tôi, Khám phá ARKit 6.

Bạn sẽ học cách tận dụng những tiến bộ mới nhất trong khuôn khổ Thực tế tăng cường của chúng tôi.

Chúng tôi rất vui khi thấy những gì bạn đã tạo ra trong vài năm qua với ARKit.

Chúng ta đang thấy một số ứng dụng tuyệt vời trong thiết kế nội thất, du lịch, triển lãm ảo, trò chơi và rất nhiều ứng dụng khác.

Nhóm của chúng tôi tại Apple đã rất chú ý đến phản hồi của bạn và chúng tôi đã kết hợp rất nhiều phản hồi đó vào ARKit 6.

Hãy cùng xem nào.

Chúng tôi đang giới thiệu chế độ video 4K mới cho phép bạn chạy luồng máy ảnh ở độ phân giải hình ảnh cao nhất từ trước đến nay.

Sau đó, tôi sẽ nói về một số cải tiến máy ảnh bổ sung mà chúng tôi đã thực hiện giúp bạn kiểm soát nhiều hơn phông nền video.

Chúng tôi cũng có các cập nhật về hành vi của neo máy bay, bổ sung vào API Chụp chuyển động và cuối cùng chia sẻ các thành phố mới nơi neo vị trí sẽ được hỗ trợ.

Hãy bắt đầu với video 4K.

Trong suốt vài năm qua, chúng tôi đã thấy rất nhiều nhu cầu về nội dung có độ phân giải cao, đặc biệt là những ứng dụng tận dụng sức mạnh của Thực tế tăng cường để làm phim, luôn khao khát nhiều điểm ảnh hơn.

Hãy để tôi chỉ cho bạn cách chụp và xử lý hình ảnh cho ARKit.

Đây là mô-đun máy ảnh của iPhone 13 Pro.

Nếu chúng ta mở nó ra, chúng ta có thể thấy thiết lập của nó.

Hãy để chúng tôi nói về máy ảnh Wide và Ultrawide.

Cả hai máy ảnh này đều có thể được sử dụng cho các nhiệm vụ thị giác máy tính khác nhau, chẳng hạn như theo dõi thế giới, chụp chuyển động hoặc phân đoạn người.

Máy ảnh rộng có một vị trí đặc biệt trong trái tim của chúng ta, vì nó cung cấp hình ảnh cho phông nền kết xuất.

Điều quan trọng là phải hiểu cách hình ảnh được xử lý để kết xuất, vì vậy hãy để tôi phóng to đến mức cảm biến.

Khi chụp ảnh cho ARKit, chúng tôi sử dụng một phần lớn cảm biến hình ảnh.

Nói chính xác hơn, đó là diện tích 3840x2880 pixel trên mô hình cụ thể này.

Sau khi chụp, chúng tôi sử dụng một quá trình gọi là binning.

Nó hoạt động như sau: Binning lấy một vùng 2x2 pixel, tính trung bình các giá trị pixel và ghi lại một pixel duy nhất.

Điều này có hai lợi thế đáng kể.

Đầu tiên, kích thước hình ảnh được giảm đi gấp hai lần, trong trường hợp này, nó thu nhỏ xuống 1920x1440 pixel.

Do đó, mỗi khung hình tiêu tốn ít bộ nhớ và sức mạnh xử lý hơn.

Điều này cho phép thiết bị chạy máy ảnh với tốc độ lên đến 60 khung hình mỗi giây và giải phóng tài nguyên để kết xuất.

Thứ hai, quá trình này mang lại lợi thế trong môi trường ánh sáng yếu, nơi việc tính trung bình các giá trị điểm ảnh làm giảm tác động của nhiễu cảm biến.

Chúng tôi kết thúc với một luồng máy ảnh cung cấp hình ảnh ở độ phân giải HD khoảng 17 mili giây một lần.

Sau khi sử dụng khung hiện tại cho các tác vụ thị giác máy tính khác nhau, ARKit hiển thị khung hiện tại để kết xuất.

Trong trường hợp bạn đang viết trình kết xuất Kim loại của riêng mình, bạn có quyền truy cập vào nó thông qua CurrentFrame.capturedImage của ARSession.

Nếu bạn đang sử dụng RealityKit, hình ảnh sẽ tự động được xử lý thêm để sử dụng làm phông nền.

Nó được chia tỷ lệ trên thiết bị để phù hợp với chiều rộng màn hình 2532 pixel và được cắt để phù hợp với tỷ lệ khung hình hiển thị.

RealityKit thực hiện nhiệm vụ kết xuất và tổng hợp nội dung ảo, giống như con tàu cướp biển này, trên khung hình và hiển thị kết quả cuối cùng trên màn hình.

Giờ đây, với sức mạnh của phần cứng mới nhất của chúng tôi, chúng tôi bật chế độ video 4K đầy đủ trong ARKit.

Ứng dụng của bạn giờ đây có thể tận dụng hình ảnh có độ phân giải cao hơn bằng cách bỏ qua bước phân loại và truy cập trực tiếp vào nó ở độ phân giải 4K đầy đủ.

Ở chế độ 4K, diện tích hình ảnh 3840x2160 pixel được sử dụng và bạn có thể quay video với tốc độ 30 khung hình mỗi giây.

Ngoài những thay đổi này, ứng dụng của bạn sẽ hoạt động giống như trước đây.

Nếu bạn sử dụng RealityKit, nó sẽ thực hiện chia tỷ lệ, cắt xén và kết xuất cho bạn.

Bạn có thể bật chế độ 4K bằng một vài bước đơn giản.

Hãy xem nó trông như thế nào trong mã.

'ARConfiguration' có chức năng tiện lợi mới 'recommendedVideoFormatFor4KResolution' trả về định dạng video 4K nếu chế độ đó được hỗ trợ trên thiết bị của bạn.

Nếu thiết bị hoặc cấu hình không hỗ trợ 4K, chức năng này sẽ trả về số không.

Sau đó, bạn có thể gán định dạng video này cho cấu hình của mình, sau đó bạn chạy phiên của mình với cấu hình đã điều chỉnh đó.

Chế độ video 4K có sẵn trên iPhone 11 trở lên và trên bất kỳ iPad Pro nào có chip M1.

Độ phân giải là 3840x2160 pixel với tốc độ 30 khung hình mỗi giây.

Tỷ lệ khung hình là 16:9, đối với iPad có nghĩa là hình ảnh phải được cắt ở hai bên để hiển thị toàn màn hình và kết xuất cuối cùng có thể được phóng to.

Khi sử dụng ARKit, đặc biệt là ở độ phân giải 4K mới, điều quan trọng là phải tuân theo một số phương pháp hay nhất để có kết quả tối ưu.

Đừng giữ ARFrame quá lâu.

Điều này có thể ngăn hệ thống giải phóng bộ nhớ, điều này có thể ngăn ARKit hiển thị các khung hình mới hơn cho bạn.

Điều này sẽ hiển thị thông qua các giọt khung trong kết xuất của bạn.

Cuối cùng, trạng thái theo dõi của ARCamera có thể giảm trở lại giới hạn.

Kiểm tra các cảnh báo trên bảng điều khiển để đảm bảo bạn không giữ lại quá nhiều hình ảnh tại bất kỳ thời điểm nào.

Cũng xem xét liệu định dạng video 4K mới có thực sự là lựa chọn phù hợp cho ứng dụng của bạn hay không.

Các ứng dụng được hưởng lợi từ video độ phân giải cao là những ứng cử viên tốt, chẳng hạn như video, làm phim và các ứng dụng sản xuất ảo.

Xử lý hình ảnh có độ phân giải cao hơn chiếm thêm tài nguyên hệ thống, vì vậy đối với các trò chơi và ứng dụng khác dựa vào tốc độ làm mới cao, chúng tôi vẫn khuyên bạn nên sử dụng video full HD với tốc độ 60 khung hình mỗi giây.

Ngoài chế độ 4K mới, còn có một số cải tiến bổ sung cho phép bạn kiểm soát máy ảnh của mình nhiều hơn.

Tôi sẽ bắt đầu bằng cách giới thiệu API ảnh nền độ phân giải cao và chỉ ra cách bật chế độ HDR mới.

Hơn nữa, tôi sẽ trình bày cách truy cập vào AVCaptureDevice cơ bản để kiểm soát chi tiết hơn và chỉ cho bạn cách đọc các thẻ EXIF trong ARKit.

Hãy nhảy vào API ảnh nền độ phân giải cao mới.

Trong khi chạy ARSession, bạn vẫn có quyền truy cập vào luồng video như bình thường.

Ngoài ra, ARKit cho phép bạn yêu cầu chụp những bức ảnh đơn lẻ theo yêu cầu trong nền, trong khi luồng video đang chạy không bị gián đoạn.

Những khung ảnh đơn lẻ đó tận dụng tối đa cảm biến máy ảnh của bạn.

Trên iPhone 13 của tôi, điều đó có nghĩa là toàn bộ 12 megapixel của camera rộng.

Khi chuẩn bị cho WWDC, chúng tôi tại ARKit đã có một ý tưởng thú vị cho một ứng dụng Nhiếp ảnh làm nổi bật những gì API mới này có thể giúp bạn tạo ra.

Trong ví dụ của chúng tôi, chúng tôi đưa bạn quay ngược thời gian về ngày 1 tháng 4 năm 2016, khi lá cờ cướp biển nổi tiếng đang bay qua Khuôn viên Apple Infinite Loop.

Tôi đã hỏi Tommy, nhiếp ảnh gia gốc, chính xác anh ấy đã chụp bức ảnh đó ở đâu sáu năm trước.

Dựa trên tọa độ này, chúng tôi có thể tạo một mỏ neo vị trí hướng dẫn bạn đến cùng một vị trí chính xác nơi Tommy đã đứng vào tháng 4 năm 2016, như được chỉ ra bởi chấm lớn màu xanh lam.

Khi đến được vị trí đó, nó sẽ giúp bạn đóng khung bức tranh hoàn hảo đó bằng cách hiển thị một hình vuông lấy nét.

Cuối cùng, ứng dụng cho phép bạn chụp ảnh bằng cách nhấn vào màn hình.

Bức ảnh đó có thể được chụp ở độ phân giải máy ảnh gốc trong khi phiên ARKit hiện tại đang chạy, mà không cần phải quay một phiên AVCapture khác.

Chúng tôi rất vui khi thấy bạn có ý tưởng nào kết hợp sức mạnh của AR và nhiếp ảnh.

Một trường hợp sử dụng khác sẽ được hưởng lợi rất nhiều bởi API này là việc tạo ra các mô hình 3D bằng cách sử dụng Object Capture.

Chụp đối tượng chụp ảnh một vật thể trong thế giới thực, như chiếc giày chạy bộ này và sử dụng các thuật toán trắc quang mới nhất của chúng tôi, nó biến chúng thành một mô hình 3D sẵn sàng để triển khai trong ứng dụng AR của bạn.

Với ARKit, bạn có thể phủ lên giao diện người dùng 3D lên trên một đối tượng vật lý và cung cấp hướng dẫn chụp tốt hơn.

Và bây giờ với API hình nền có độ phân giải cao mới, bạn có thể chụp ảnh có độ phân giải cao hơn của đối tượng và tạo ra các mô hình 3D chân thực hơn nữa.

Tôi là một fan hâm mộ lớn của photogrammetry, vì vậy tôi thực sự khuyên bạn nên xem phiên "Đưa thế giới của bạn đến với thực tế tăng cường" năm nay.

Hãy để tôi chỉ cho bạn cách bạn có thể bật tính năng chụp ảnh có độ phân giải cao trong mã.

Đầu tiên, chúng tôi kiểm tra định dạng video hỗ trợ hiResCapture.

Chúng ta có thể sử dụng chức năng tiện lợi 'recommendedVideoFormatForHighResolution FrameCapturing' cho điều đó.

Sau khi chúng tôi đảm bảo rằng định dạng được hỗ trợ, chúng tôi có thể đặt định dạng video mới và chạy phiên.

Chúng tôi cũng phải nói với ARKit khi nào nên chụp ảnh độ phân giải cao.

Trong ví dụ trước của chúng tôi, việc chụp ảnh được kích hoạt bằng một cú chạm vào màn hình.

Trong ứng dụng của riêng bạn, bạn có thể muốn phản ứng với các sự kiện khác nhau kích hoạt chụp khung hình có độ phân giải cao.

Nó thực sự phụ thuộc vào trường hợp sử dụng của bạn.

ARSession có một chức năng mới được gọi là captureHighResolutionFrame.

Gọi chức năng này kích hoạt chụp ảnh có độ phân giải cao ngoài băng tần.

Bạn có quyền truy cập vào ARFrame chứa hình ảnh có độ phân giải cao và tất cả các thuộc tính khung khác không đồng bộ trong trình xử lý hoàn thành.

Bạn nên kiểm tra xem việc chụp khung hình có thành công hay không trước khi truy cập nội dung của nó.

Trong ví dụ này, chúng tôi lưu trữ khung vào đĩa.

Ngoài ra, hãy ghi nhớ các phương pháp hay nhất của chúng tôi về lưu giữ hình ảnh mà tôi đã đề cập trước đó, đặc biệt là vì những hình ảnh này sử dụng độ phân giải đầy đủ của cảm biến hình ảnh.

Tiếp theo, hãy nói về HDR.

Dải động cao chụp phạm vi màu sắc rộng hơn và ánh xạ chúng đến màn hình của bạn.

Điều này dễ thấy nhất trong môi trường có độ tương phản cao.

Đây là một ví dụ điển hình từ sân sau của tôi.

Cảnh này có cả những khu vực rất tối - ví dụ, trên hàng rào gỗ - và một số khu vực rất sáng như những đám mây trên bầu trời.

Khi bật chế độ HDR, như ở bên phải, bạn có thể thấy rằng các chi tiết ở những khu vực này, như độ mịn trên mây, được bảo toàn tốt hơn nhiều trong HDR.

Hãy xem HDR được bật trong mã như thế nào.

Bạn có thể truy vấn bất kỳ định dạng video nào nếu nó hỗ trợ HDR thông qua thuộc tính 'isVideoHDRSupported' của nó.

Hiện tại, chỉ có các định dạng video không liên kết hỗ trợ HDR.

Nếu HDR được hỗ trợ, hãy đặt videoHDRAllowed trong cấu hình thành true và chạy phiên của bạn với cấu hình đó.

Bật HDR sẽ có tác động đến hiệu suất, vì vậy hãy đảm bảo chỉ sử dụng nó khi có nhu cầu.

Trong trường hợp sử dụng mà bạn thích kiểm soát thủ công các cài đặt như phơi sáng hoặc cân bằng trắng, giờ đây có cách thuận tiện để truy cập trực tiếp vào AVCaptureDevice và thay đổi bất kỳ cài đặt nào của nó.

Trong ví dụ mã của chúng tôi, hãy gọi 'configurableCaptureDevice ForPrimaryCamera' của cấu hình của bạn để có quyền truy cập vào 'AVCaptureDevice' bên dưới.

Sử dụng khả năng này để tạo giao diện tùy chỉnh cho ứng dụng ARKit của bạn, nhưng hãy nhớ rằng hình ảnh không chỉ được sử dụng làm phông nền kết xuất mà còn được ARKit tích cực sử dụng để phân tích cảnh.

Vì vậy, bất kỳ thay đổi nào như phơi sáng quá mức có thể có tác động tiêu cực đến chất lượng đầu ra của ARKit.

Bạn cũng có thể thực hiện một số thao tác nâng cao, như kích hoạt các sự kiện tập trung.

Để biết thêm thông tin về cách cấu hình AVCaptureSessions, vui lòng tham khảo tài liệu AVCapture trên developer.apple.com.

Cuối cùng, ARKit hiển thị các thẻ EXIF cho ứng dụng của bạn.

Chúng hiện có sẵn với mọi ARFrame.

Các thẻ EXIF chứa thông tin hữu ích về cân bằng trắng, độ phơi sáng và các cài đặt khác có thể có giá trị để xử lý hậu kỳ.

Điều đó kết thúc tất cả các cập nhật trên đường ống chụp ảnh.

Hãy xem chúng ta có những thay đổi nào đối với Plane Anchors.

Neo máy bay đã là một tính năng phổ biến kể từ phiên bản đầu tiên của ARKit.

Nhiều người trong số các bạn đã bày tỏ sự cần thiết phải có sự tách biệt sạch hơn giữa neo mặt phẳng và hình học mặt phẳng bên dưới.

Vì lý do đó, chúng tôi đang công bố các cập nhật về hành vi của neo phẳng và hình dạng của mặt phẳng.

Đây là một ví dụ về một mỏ neo máy bay điển hình trong iOS 15.

Vào đầu phiên AR, nó vừa vặn với mặt phẳng với cuốn sổ ghi chép có kết cấu tốt này trên bàn.

Khi chạy phiên, mặt phẳng được cập nhật dần dần để tính đến các phần mới của bảng xuất hiện.

Mỗi khi hình học mặt phẳng được cập nhật, vòng quay neo cũng được cập nhật để phản ánh hướng mới của mặt phẳng.

Với iOS 16, chúng tôi giới thiệu sự tách biệt rõ ràng hơn giữa neo máy bay và hình học máy bay của chúng.

Các bản cập nhật về neo phẳng và hình học hiện đã được tách rời hoàn toàn.

Trong khi mặt phẳng đang mở rộng và cập nhật hình học của nó khi bảng đầy đủ xuất hiện, bản thân vòng quay neo vẫn không đổi.

Khi tương phản với hành vi cũ ở phía bên tay trái, bạn có thể thấy rằng neo mặt phẳng trong iOS 16 vẫn ở cùng một hướng, được căn chỉnh với sổ ghi chép, trong toàn bộ Phiên AR.

Tất cả thông tin về hình học mặt phẳng hiện được chứa trong một lớp gọi là ARPlaneExtent.

Các bản cập nhật xoay không còn được thể hiện thông qua việc xoay chính neo mặt phẳng.

Thay vào đó, ARPlaneExtent chứa một thuộc tính mới, rotationOnYAxis, đại diện cho góc quay.

Ngoài thuộc tính mới này, các mặt phẳng được xác định đầy đủ bởi chiều rộng và chiều cao, cũng như tọa độ trung tâm của PlaneAnchor.

Hãy để tôi chỉ cho bạn cách tạo hình ảnh trực quan hóa mặt phẳng này trong mã.

Đầu tiên, chúng tôi tạo ra một thực thể dựa trên lưới phẳng theo chiều rộng và chiều cao được chỉ định.

Sau đó, chúng tôi đặt các thực thể biến đổi theo vòng quay trên trục y và cũng bù nó bằng giá trị của thuộc tính trung tâm.

Mỗi khi mặt phẳng được cập nhật, chúng ta phải tính đến thực tế là chiều rộng, chiều cao và tọa độ tâm và vòng quay mới OnYAxis có thể thay đổi.

Để sử dụng hành vi mới này, hãy đặt mục tiêu triển khai của bạn thành iOS 16 trong cài đặt Xcode của bạn.

Bản cập nhật tiếp theo là trên MotionCapture, những người chủ mưu học máy của chúng tôi đã làm việc chăm chỉ để cải thiện hơn nữa.

Có cả một bộ cập nhật, cho cả bộ xương 2D, cũng như cho các khớp 3D.

Đối với bộ xương 2D, chúng tôi đang theo dõi hai khớp mới: tai trái và tai phải.

Chúng tôi cũng đã cải thiện khả năng phát hiện tư thế tổng thể.

Trên iPhone 12 trở lên, cũng như trên các mẫu iPad Pro và iPad Air mới nhất với chip M1, bộ xương 3D, như được hiển thị bằng màu đỏ, đã được cải thiện.

Bạn sẽ trải nghiệm ít bồn chồn hơn và tổng thể nhất quán hơn về thời gian.

Theo dõi cũng ổn định hơn nếu các bộ phận của người bị che khuất hoặc khi đi đến gần máy ảnh.

Để sử dụng MotionCapture được cải tiến, hãy đặt mục tiêu triển khai của bạn thành iOS 16 trong cài đặt Xcode của bạn.

Tiếp theo, tôi cũng muốn thông báo các thành phố và quốc gia mới nơi LocationAnchors sẽ được hỗ trợ.

Như một lời nhắc nhở nhỏ, Apple Maps sử dụng LocationAnchor API để cung cấp năng lượng cho hướng dẫn đi bộ cho người đi bộ.

Trong ví dụ này, bạn có thể thấy rằng nó có thể dẫn bạn qua các đường phố của London, nhờ vào sức mạnh của LocationAnchors.

LocationAnchors đã có sẵn ở ngày càng nhiều thành phố ở Hoa Kỳ và ở London, Vương quốc Anh.

Bắt đầu từ hôm nay, chúng sẽ có mặt tại các thành phố Vancouver, Toronto và Montreal của Canada.

Chúng tôi cũng đang cho phép họ ở Singapore, và ở bảy khu vực đô thị ở Nhật Bản, bao gồm cả Tokyo.

Cũng như ở Melbourne và Sydney, Úc.

Cuối năm nay, chúng tôi sẽ cung cấp chúng ở Auckland, New Zealand, Tel Aviv, Israel và Paris, Pháp Nếu bạn muốn biết liệu LocationAnchors có được hỗ trợ tại một tọa độ cụ thể hay không, chỉ cần sử dụng phương pháp checkAvailability của ARGeoTrackingConfiguration.

Và đó là tất cả các bản cập nhật cho ARKit 6.

Tóm lại, tôi đã trình bày cách chạy ARKit ở định dạng video 4K mới.

Đối với các trường hợp sử dụng nâng cao, tôi đã trình bày cách bật HDR hoặc kiểm soát thủ công AVCaptureDevice.

Đối với nhiều ứng dụng có nhiều điểm ảnh hơn, tôi đã trình bày cách lấy ảnh có độ phân giải cao từ phiên ARKit.

Chúng tôi đã nói về hành vi mới của Plane Anchors, và tôi đã trình bày các khớp tai mới và những cải tiến khác trong MotionCapture.

Bạn cũng phải biết LocationAnchors sẽ có mặt ở quốc gia nào vào cuối năm nay.

Cảm ơn vì đã điều chỉnh.

Chúc WWDC 2022 tuyệt vời!