10049

♪ nhạc cụ hip hop ♪

♪

Xin chào, và chào mừng đến với "Có gì mới trong WKWebView" Tôi là Alex Christensen, một kỹ sư trong nhóm WebKit.

Chúng tôi đã bận rộn và chúng tôi đã thêm rất nhiều công nghệ web mới để bạn sử dụng trong các ứng dụng của mình trong năm nay.

Tuy nhiên, trước khi chúng tôi bắt đầu, hãy đảm bảo rằng bạn đang sử dụng công nghệ phù hợp cho ứng dụng của mình.

Nếu bạn muốn có trải nghiệm giống như trình duyệt bên trong ứng dụng của mình và không cần tùy chỉnh sâu, bạn chắc chắn sẽ muốn sử dụng SFSafariViewController.

Nếu ứng dụng của bạn vẫn sử dụng UIWebView bị phản đối, bây giờ là lúc để chuyển sang WKWebView nhanh hơn và nhạy hơn.

UIWebView sẽ bị xóa trong bản phát hành trong tương lai.

WKWebView là API được sử dụng để viết một ứng dụng tương tác với nội dung web.

Bạn có thể sử dụng nó cho giao diện người dùng dựa trên CSS hoặc viết một số ứng dụng của bạn bằng JavaScript.

Bạn có thể đang tương tác với nội dung web của riêng mình bằng cách sử dụng các miền gắn trên ứng dụng.

Bạn cũng có thể đang phát triển trình duyệt của riêng mình.

Dù ứng dụng của bạn là gì, chúng tôi liên tục bổ sung các khả năng mới để cho phép bạn tạo các ứng dụng web phong phú hơn.

Các tính năng mới có sẵn cho WKWebView năm nay có bốn loại: cách mới để tương tác với nội dung web, khả năng mới cho trình chặn nội dung, phương tiện được mã hóa và sử dụng Trình kiểm tra web từ xa.

Đầu tiên, chúng tôi sẽ đề cập đến các API mới để tương tác với nội dung web.

Có ba cách mới mà ứng dụng của bạn có thể tương tác với nội dung web trong iOS 16: sử dụng API toàn màn hình, sử dụng các đơn vị khung nhìn CSS mới và sử dụng các tương tác tìm kiếm.

Hãy bắt đầu với toàn màn hình.

Trong nhiều năm nay, JavaScript đã có thể tạo các phần tử HTML, như video hoặc trò chơi canvas, toàn màn hình trong trình duyệt và bây giờ chúng cũng có thể làm điều đó trong ứng dụng của bạn.

Đây là một ví dụ đơn giản trông như thế nào trên điện thoại.

JavaScript có thể yêu cầu toàn màn hình, sau đó người dùng hoặc JavaScript có thể thoát toàn màn hình.

Tất cả những gì bạn cần làm trong ứng dụng của mình là đặt WKPreferences .isElementFullscreenEnabled to true và tải nội dung web sử dụng API toàn màn hình như webkitRequestFullscreen.

Nó hoạt động khá tốt ngay lập tức, nhưng nếu bạn muốn tùy chỉnh các chuyển tiếp trong ứng dụng của mình, bạn có thể quan sát giá trị của WKWebView.fullscreenState, điều này sẽ cho ứng dụng của bạn biết khi nội dung web trở nên toàn màn hình hoặc quay trở lại.

Và đó là tất cả những gì cần sử dụng API toàn màn hình của WebKit trong ứng dụng của bạn.

Chúng tôi cũng có các đơn vị CSS mới để cho phép nội dung web được bố trí theo kích thước khung nhìn động.

Các đơn vị CSS mới này bao gồm svh, lvh, dvh và nhiều đơn vị khác.

Chúng cho phép các nhà phát triển web sửa đổi bố cục dựa trên kích thước khung nhìn nhỏ nhất, lớn nhất và động.

Hãy cùng xem Safari làm gì để có ý tưởng về cách sử dụng điều này trong ứng dụng của bạn.

Khi bạn lần đầu tiên mở một trang trong Safari, bạn sẽ thấy máy chủ lưu trữ trang web và một số nút ở dưới cùng.

Khi bạn cuộn, khung nhìn tăng kích thước khi các nút trượt ra khỏi đường đi.

Svh, lvh và dvh cung cấp các đơn vị hữu ích để đo các kích thước khác nhau này của khung nhìn.

Nếu ứng dụng của bạn thay đổi khung nhìn của WKWebView, thì bạn nên thông báo trước cho WebKit phạm vi kích thước khung nhìn là gì.

Trong Swift, một cuộc gọi hàm thông báo cho WebKit về các cài đặt cạnh tối đa và tối thiểu để cho phép nội dung web này được bố trí chính xác trong ứng dụng của bạn.

Chúng tôi cũng đang giới thiệu hỗ trợ cho Tìm tương tác trong WKWebView trong iOS 16.

Nhiều ứng dụng WKWebView tải rất nhiều văn bản và người dùng muốn tìm kiếm văn bản này.

Nếu bạn đặt WKWebView .findInteractionEnabled thành true, thì người dùng của bạn sẽ có thể sử dụng giao diện người dùng quen thuộc và các phím tắt như Command-F để tìm kiếm văn bản trên trang đang mở.

Một dòng mã đó là tất cả những gì bạn cần để bật tính năng này, nhưng bạn cũng có thể truy cập đối tượng UIFindInteraction thông qua WKWebView .findInteraction để thực hiện những việc như trình bày và bỏ qua bảng Tìm hoặc chuyển sang kết quả tiếp theo hoặc trước đó theo chương trình.

Hãy dùng thử và xem nó có thể làm gì trong ứng dụng của bạn.

Để chặn nội dung, chúng tôi đã thêm một khả năng mới vào WKContentRuleList, API được sử dụng để triển khai các trình chặn nội dung trong Safari.

Ở đây, chúng tôi có Wikipedia được nhúng trong một iframe trên một trang web ví dụ.

Trước đây, bạn có thể chạy các biểu thức chính quy trên URL được yêu cầu và URL khung trên cùng, để quyết định chặn tải hay thực hiện các hành động khác.

Tuy nhiên, đôi khi, những gì bạn thực sự muốn là một quy tắc nhất định chỉ áp dụng cho các tải bên trong một số iframe nhất định.

Bây giờ bạn có thể chạy các biểu thức chính quy trên URL của khung hiện tại.

Chúng tôi sẽ viết một quy tắc để chặn hình ảnh nhưng chỉ từ các khung có chứa Wikipedia.

Để làm điều này, chúng tôi thêm if-frame-url vào JSON như thế này.

Sau đó, bạn biên dịch JSON như trước đây và áp dụng nó vào Cấu hình WKWebView.

Biểu thức chính quy sau đó chạy trên URL của khung đang thực hiện yêu cầu.

Quy tắc chặn này bây giờ sẽ chỉ áp dụng cho các yêu cầu từ các khung phù hợp với biểu thức chính quy if-frame-url.

Ở đây chúng ta thấy rằng nó đã chặn tải hình ảnh bên trong iframe Wikipedia.

Nếu bạn nghiêm túc về việc triển khai trình chặn nội dung, bạn nên xem phiên WWDC về Tiện ích mở rộng Safari bao gồm một số khả năng mới trong declarativeNetRequest.

Một khả năng mới khác trong WKWebView trong iPadOS 16 là phương tiện được mã hóa.

Nếu bạn có nội dung sử dụng Tiện ích mở rộng phương tiện được mã hóa và API tiện ích mở rộng nguồn phương tiện, bây giờ bạn có thể sử dụng nó trong các ứng dụng của mình trên iPadOS.

Điều này có nghĩa là nếu bạn có nội dung cao cấp như AppleTV+, nó sẽ hoạt động trên iPadOS như trong macOS.

Nếu ứng dụng của bạn có quyền trình duyệt web, thì Remote Web Inspector sẽ chỉ hoạt động với ứng dụng sản xuất của bạn như trên Safari trên iOS; không cần thêm hoặc thay đổi bất kỳ mã nào.

Để kích hoạt Trình kiểm tra web trong trình duyệt của bên thứ ba, quy trình này giống như với Safari.

Trước tiên, bạn sẽ cần bật Trình kiểm tra web trong cài đặt Safari trên thiết bị iOS, sau đó bật menu Phát triển trong Cài đặt nâng cao trong Safari trên máy Mac của bạn.

Gắn điện thoại của bạn vào Mac và tìm kiếm thiết bị của bạn trong menu Phát triển của Safari trên macOS.

Web Inspector có nhiều công cụ để gỡ lỗi nội dung web.

Bạn có thể khám phá DOM, chạy và gỡ lỗi thực thi JavaScript, xem các mốc thời gian tải trang của bạn và hơn thế nữa.

Nếu bạn có một trang web, bây giờ bạn có thể tự kiểm tra và gỡ lỗi nó trong các trình duyệt của bên thứ ba trên iOS, sử dụng Remote Web Inspector.

Đó là những bổ sung API mới chính cho WKWebView trong năm nay.

Hãy thử chúng và xem chúng có thể làm gì trong ứng dụng của bạn.

Hãy nhớ sử dụng các API tốt nhất cho ứng dụng của bạn và nếu có điều gì đó bạn không thể làm với WKWebView, vui lòng gửi yêu cầu tính năng bằng Trợ lý phản hồi.

Chúng tôi đọc các yêu cầu tính năng mà chúng tôi nhận được và ưu tiên phát triển dựa trên đầu vào của bạn.

Đừng quên kiểm tra "Có gì mới trong Tiện ích mở rộng web Safari", và để biết thêm các bổ sung cho nền tảng web, hãy nhớ kiểm tra "Có gì mới trong Safari và WebKit".

Cảm ơn vì đã xem, và tận hưởng phần còn lại của WWDC.

♪ ♪