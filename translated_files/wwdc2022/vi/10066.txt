10066

♪ ♪

Tarun Belagodu: Xin chào và chào mừng đến với Metal 3.

Tên tôi là Tarun Belagodu và tôi sẽ chia sẻ những thông tin mới nhất về sự phát triển của Metal.

Đầu tiên, hãy bắt đầu với những điều cơ bản.

Metal là API tính toán và đồ họa chi phí thấp của Apple.

Nó được thiết kế để trở thành cách nhanh nhất và hiệu quả nhất để điều khiển các GPU cực kỳ mạnh mẽ đằng sau các sản phẩm của Apple.

Nó cung cấp khả năng kiểm soát trực tiếp và đa luồng đối với các lệnh được gửi đến GPU, một ngôn ngữ đổ bóng phong phú hỗ trợ biên dịch đổ bóng rõ ràng và các công cụ tích hợp sâu để giúp gỡ lỗi và lập hồ sơ các ứng dụng và trò chơi phức tạp.

Kể từ khi được giới thiệu, Metal đã bổ sung nhiều tính năng đồ họa và tính toán tiên tiến, tập trung vào kết xuất dựa trên GPU, học máy và dò tia.

Apple silicon mở đường cho hiệu suất và hiệu quả đồ họa đáng kinh ngạc trên mọi máy Mac mới.

Và Metal mở khóa những khả năng này.

Năm nay, Metal đang thực hiện một bước nhảy vọt lên cấp độ tiếp theo với Metal 3.

Metal 3 là một bộ tính năng mới mạnh mẽ cho phép hiệu suất và chất lượng kết xuất cao hơn để giúp các ứng dụng và trò chơi của bạn chạy nhanh hơn và trông tuyệt vời.

Hãy bắt đầu với việc tải tài nguyên nhanh.

Các trò chơi và ứng dụng hiện đại có yêu cầu tải tài sản khắt khe và phát trực tuyến nhiều yêu cầu nội dung nhỏ một cách nhanh chóng từ các tệp đến tài nguyên Kim loại của bạn thường là chìa khóa cho hình ảnh chất lượng cao.

Nhưng các API lưu trữ hiện tại được thiết kế cho các yêu cầu lớn, hàng loạt.

Tải tài nguyên nhanh của Metal 3 cho phép bạn yêu cầu nhiều tải nhỏ bằng cách sử dụng cùng một mô hình lệnh rõ ràng, đa luồng như đồ họa và tính toán.

Mỗi yêu cầu là một lệnh và nhiều lệnh có thể được xếp hàng để gửi không đồng bộ.

Nó tải trực tiếp vào bộ đệm và kết cấu Kim loại của bạn mà không cần các bước bổ sung, giúp bạn tiết kiệm cả nỗ lực phát triển và thời gian truyền tải.

Tải tài nguyên nhanh cũng giúp dễ dàng phối hợp giữa các hoạt động GPU và các hoạt động tải, sử dụng các nguyên thủy đồng bộ hóa kim loại mà bạn đã biết.

Các hệ thống phát trực tuyến kết cấu thực sự được hưởng lợi từ việc tải tài nguyên nhanh.

Hãy xem xét một ví dụ.

Metal Sparse Textures cho phép các ứng dụng truyền phát kết cấu ở độ chi tiết của gạch.

Hệ thống phát trực tuyến kết cấu được xây dựng trên kết cấu thưa thớt Kim loại bao gồm bốn bước: Đầu tiên, quyết định tải gì dựa trên phản hồi từ khung trước đó.

Thứ hai, tải các ô từ bộ lưu trữ tệp.

Thứ ba, sao chép từ khu vực dàn dựng của bạn sang kết cấu thưa thớt của bạn.

Và cuối cùng, vẽ khung hình của bạn.

Tải và sao chép càng mất nhiều thời gian có nghĩa là ứng dụng của bạn càng có nhiều thời gian với chất lượng thấp hơn.

Tải tài nguyên nhanh chóng giảm thiểu chi phí tải và đảm bảo phần cứng lưu trữ có đủ yêu cầu trong hàng đợi của nó để tối đa hóa thông lượng.

Điều này cung cấp hiệu suất nhanh hơn và nhất quán hơn để dành nhiều thời gian hơn để vẽ với chất lượng cao.

Tải tài nguyên nhanh chóng sẽ đơn giản hóa đáng kể mã bạn cần viết để đạt được phát trực tuyến tài sản chất lượng cao.

Để tìm hiểu thêm về tải tài nguyên nhanh, hãy xem phiên "Tải tài nguyên nhanh hơn với Metal 3".

Tiếp theo, hãy để tôi cho bạn biết quy trình biên dịch ngoại tuyến mới sẽ giúp bạn giảm thời gian tải và nói lắp trong ứng dụng của mình như thế nào.

Các tệp nhị phân Shader là mã máy dành riêng cho GPU được tạo theo truyền thống trong khi ứng dụng đang chạy như một phần của quy trình tạo đường ống Metal.

Tạo các tệp nhị phân này là một hoạt động tốn kém thường được ẩn sau màn hình tải trong quá trình khởi chạy ứng dụng.

Tuy nhiên, đôi khi chúng cần phải xảy ra trong khung hình, từ đó gây ra tốc độ khung hình bị giật.

Các tệp nhị phân này được Metal lưu trữ để bạn không phải trả chi phí thường xuyên, nhưng chi phí của chúng vẫn được quan sát thấy trong lần khởi chạy đầu tiên của ứng dụng hoặc bất cứ khi nào cần nhị phân đầu tiên.

Với biên dịch ngoại tuyến, bạn có thể loại bỏ việc tạo hệ nhị phân đổ bóng trong thời gian chạy.

Bằng cách chuyển thế hệ nhị phân sang thời gian xây dựng dự án, bạn có thể giảm đáng kể thời gian tạo đường ống kim loại tại thời điểm tải và giảm tình trạng nói lắp trong ứng dụng của mình khi các đường ống đó được tạo đúng lúc.

Chúng ta hãy xem xét kỹ hơn ý nghĩa của việc giảm nói lắp.

Đây là một ví dụ về một trò chơi cần tạo ra một đối tượng trạng thái đường ống Metal trong quá trình mã hóa.

Vì đây là một đường ống mà Metal chưa từng thấy trước đây, nó tạo ra hệ nhị phân đổ bóng cần thiết.

Đây là một thao tác dài làm gián đoạn việc mã hóa phần còn lại của khung hình và khiến ứng dụng bỏ lỡ mục tiêu tốc độ khung hình của nó.

Điều này chỉ xảy ra một lần, nhưng nó đủ để người dùng của bạn nhận thấy một khung hình nói lắp.

Ngược lại, biên dịch ngoại tuyến có nghĩa là nhị phân đổ bóng có thể được tạo tại thời điểm xây dựng để mọi việc tạo trạng thái đường ống đều nhanh chóng và việc thực thi diễn ra suôn sẻ.

Biên dịch ngoại tuyến cũng có thể có ảnh hưởng đáng kể đến thời gian tải ứng dụng của bạn.

Hãy xem xét một ví dụ.

Hầu hết các ứng dụng tạo ra phần lớn các đối tượng trạng thái đường ống kim loại trong một giai đoạn tải chuyên dụng.

Và các tệp nhị phân đổ bóng được tạo ra ở lần tải đầu tiên.

Đây có thể là một sự chờ đợi lâu dài cho người dùng của bạn nếu ứng dụng của bạn tạo ra nhiều đường ống như vậy.

Với việc biên dịch ngoại tuyến, việc tạo nhị phân đổ bóng một lần nữa có thể được chuyển sang thời gian xây dựng dự án, dẫn đến thời gian tải nhỏ hơn và đưa người dùng vào ứng dụng của bạn nhanh hơn.

Biên dịch ngoại tuyến là một công cụ thay đổi cuộc chơi cho các ứng dụng có nhiều đường ống phức tạp.

Để tìm hiểu thêm về biên dịch ngoại tuyến và các cải tiến khác, hãy xem phiên "Mục tiêu và tối ưu hóa các tệp nhị phân GPU với Metal 3".

Bây giờ, hãy chuyển sang MetalFX, cung cấp các hiệu ứng đồ họa được tối ưu hóa nền tảng cho các ứng dụng Metal.

MetalFX Upscaling giúp hiển thị đồ họa chất lượng cao trong thời gian ngắn hơn thông qua nâng cấp hiệu suất cao và khử răng cưa.

Bạn có thể chọn kết hợp các thuật toán thời gian hoặc không gian để giúp tăng hiệu suất.

Đây là lý do tại sao nó quan trọng.

Mặc dù độ phân giải Retina cung cấp chi tiết sắc nét mà bạn muốn các ứng dụng và trò chơi của mình tận dụng, nhưng việc tạo ra tất cả các điểm ảnh đó cũng có thể ảnh hưởng đến hiệu suất.

Với MetalFX Upscaling, bạn có thể tạo pixel ở độ phân giải thấp hơn và sau đó để khung tạo ra hình ảnh chất lượng cao, độ phân giải cao với chi phí thấp hơn với tốc độ khung hình cao hơn nhiều.

MetalFX là một khuôn khổ mạnh mẽ biến việc nâng cấp hiệu suất cao, chất lượng cao thành hiện thực.

Để tìm hiểu thêm về MetalFX Upscaling, hãy xem phiên "Tăng cường hiệu suất với MetalFX Upscaling".

Tiếp theo là đường ống hình học linh hoạt mới của Metal: Mesh Shaders.

Đường ống đồ họa có thể lập trình truyền thống cho phép bạn chuyển đổi các đỉnh trong bộ đổ bóng, sau đó được lắp ráp thành các nguyên thủy để rasterization bằng phần cứng chức năng cố định.

Thế là đủ cho hầu hết các ứng dụng, nhưng một số trường hợp sử dụng như loại bỏ yêu cầu quyền truy cập vào toàn bộ nguyên thủy.

Mỗi đỉnh cũng được đọc, chuyển đổi và xuất ra một cách độc lập.

Vì vậy, bạn không thể thêm các đỉnh hoặc nguyên thủy ở giữa bản vẽ của mình.

Xử lý hình học tiên tiến đòi hỏi sự linh hoạt hơn.

Và theo truyền thống, điều đó có nghĩa là xử lý trước hình học của bạn trong một đường chuyền tính toán.

Nhưng điều đó đòi hỏi phải lưu trữ một lượng hình học trung gian thay đổi vào bộ nhớ thiết bị, điều này có thể khiến bạn khó lập ngân sách.

Bộ đổ bóng lưới kim loại giới thiệu một đường ống xử lý hình học thay thế, Nó thay thế giai đoạn đỉnh truyền thống bằng mô hình 2 giai đoạn linh hoạt và cho phép xử lý phân cấp hình học của bạn.

Giai đoạn đầu tiên phân tích toàn bộ đối tượng để quyết định nên mở rộng, co lại hay tinh chỉnh hình học trong giai đoạn thứ hai.

Nó đạt được điều này bằng cách cung cấp khả năng tính toán trong quá trình kết xuất mà không cần lưu trữ bộ nhớ thiết bị trung gian.

Bộ đổ bóng lưới rất phù hợp cho các ứng dụng thực hiện loại bỏ dựa trên GPU, lựa chọn LOD và tạo hình học thủ tục.

Chúng ta hãy xem xét kỹ hơn.

Trong ví dụ này, một đường chuyền tính toán đánh giá bề mặt và sau đó tạo ra hình học của nó.

Hình học đó và các lệnh vẽ của nó sau đó được ghi vào bộ nhớ thiết bị để tiêu thụ bằng cách kết xuất sau này.

Với các yếu tố mở rộng cao và các cuộc gọi rút thăm gián tiếp, có thể khó dự đoán dung lượng bộ nhớ cần thiết.

Bộ đổ bóng lưới cải thiện hiệu quả bằng cách chạy hai giai đoạn giống như tính toán nội tuyến trong đường ống kết xuất.

Giai đoạn Đối tượng đánh giá đầu vào để quyết định cần tạo ra bao nhiêu mắt lưới.

Và giai đoạn Lưới sau đó tạo ra hình học thực tế.

Những mắt lưới này được gửi trực tiếp đến bộ rasterizer, bỏ qua vòng quay đến bộ nhớ thiết bị và nhu cầu xử lý đỉnh.

Bộ đổ bóng lưới sẽ cho phép bạn xây dựng các hệ thống hình học, loại bỏ và LODing thủ tục hiệu quả cho các ứng dụng của mình.

Để tìm hiểu thêm về bộ đổ bóng lưới, hãy xem phiên "Biến đổi hình học của bạn bằng bộ đổ bóng lưới kim loại".

Metal 3 cũng mang lại tốc độ đáng kể cho đường ống dò tia.

Mọi thứ từ xây dựng cấu trúc gia tốc, giao lộ và bóng râm đã được tối ưu hóa.

Metal cũng bổ sung hỗ trợ cho các đường ống dò tia điều khiển bằng GPU để tối ưu hóa hơn nữa ứng dụng của bạn.

Hãy so sánh dấu vết tia của Metal 3 với những gì đã có sẵn trước đây.

Truy tìm kim loại 3 tia tiết kiệm đáng kể thời gian CPU và GPU.

Đầu tiên, các cấu trúc tăng tốc được xây dựng trong thời gian ngắn hơn, giúp bạn có nhiều thời gian GPU hơn để vẽ và theo dõi các tia.

Thứ hai, các hoạt động của CPU như loại bỏ có thể chuyển sang GPU nhờ hỗ trợ Bộ đệm lệnh gián tiếp mới cho Dò tia.

Cuối cùng, Metal 3 ray tracing hỗ trợ truy cập trực tiếp vào dữ liệu nguyên thủy để hợp lý hóa và tối ưu hóa giao điểm và bóng râm.

Truy tìm kim loại 3 tia tiếp tục trở nên tốt hơn và mạnh mẽ hơn trước.

Để tìm hiểu thêm về dò tia, hãy truy cập phiên "Tối đa hóa hiệu suất dò tia kim loại của bạn".

Bây giờ, tôi sẽ chỉ cho bạn cách Metal 3 tăng tốc suy luận và đào tạo học máy.

Metal 3 có những cải tiến lớn để tăng tốc độ học máy, với sự hỗ trợ bổ sung để tăng tốc đào tạo mạng trên Mac và tối ưu hóa đáng kể cho tối ưu hóa suy luận ML trong các ứng dụng xử lý đồ họa và phương tiện.

TensorFlow là một khuôn khổ phổ biến cho việc học máy được tăng tốc GPU trên Mac.

Mac Studio được phát hành gần đây cung cấp tốc độ lên đến 16 lần trên M1 Ultra so với đào tạo trên CPU, trên nhiều mạng khác nhau.

Và Metal 3 cũng tăng tốc nhiều hoạt động TensorFlow mới.

Điều đó có nghĩa là ít đồng bộ hóa hơn với CPU để có hiệu suất có thể mở rộng hơn.

PyTorch là một khung ML rất phổ biến khác để đào tạo mạng gần đây đã tăng tốc GPU bằng Metal.

Và trên Mac Studio với M1 Ultra, bạn có thể đạt được tốc độ đào tạo đáng kể so với CPU.

Ví dụ, bạn có thể đào tạo mô hình BERT nhanh hơn tới 6,5 lần và đào tạo ResNet50 nhanh hơn tới 8,5 lần.

Metal tối ưu hóa suy luận ML trên silicon của Apple để tối đa hóa hiệu suất.

Điều này đặc biệt hữu ích cho các ứng dụng xử lý hình ảnh và video hiệu suất cao dựa trên Metal, như DaVinci Resolve của BlackMagic Design.

DaVinci Resolve là một nền tảng sản xuất video tập trung vào phân loại màu sắc sử dụng rộng rãi Metal và máy học trong quy trình làm việc của họ.

Và kết quả thật đáng kinh ngạc.

Với sự hỗ trợ của Metal cho việc học máy tăng tốc, BlackMagic Design đã đạt được những cải tiến hiệu suất đáng kể cho quy trình chỉnh sửa và phân loại màu sắc và các công cụ dựa trên ML của họ.

Để tìm hiểu thêm về các cập nhật cho học máy, hãy đến phiên "Tăng tốc học máy với Kim loại".

Bây giờ hãy để tôi cho bạn biết phần cứng nào hỗ trợ các tính năng Metal 3 mà tôi vừa mô tả.

Metal 3 được hỗ trợ trên tất cả các thiết bị iOS, iPadOS và macOS hiện đại, bao gồm iPhone và iPad với chip A13 Bionic hoặc M1 trở lên, và tất cả các hệ thống Mac silicon của Apple và hệ thống Mac với GPU AMD và Intel gần đây.

Và để tìm hiểu xem một thiết bị nhất định có hỗ trợ Metal 3 hay không, hãy sử dụng truy vấn supportsFamily trên thiết bị Metal.

Metal 3 không chỉ là các tính năng; nó còn bao gồm một bộ công cụ phát triển tiên tiến toàn diện.

Để tôi cho bạn xem một ít ngay bây giờ.

Trình xem phụ thuộc kim loại trong Xcode 14 giúp bạn dễ dàng hình dung toàn bộ trình kết xuất của mình hoặc phóng to một lần vượt qua.

Và để dễ dàng hơn trong việc áp dụng các đường ống điều khiển bằng GPU hoặc đồng bộ hóa với tải tài nguyên nhanh chẳng hạn, Trình xem phụ thuộc hiện bao gồm các cạnh đồng bộ hóa để giúp bạn phân tích và xác thực các phụ thuộc của mình.

Trình xem cấu trúc gia tốc được cải tiến trong Xcode 14 giúp bạn tận dụng tối đa khả năng dò tia được tối ưu hóa của Metal 3.

Đầu tiên, bây giờ bạn có thể làm nổi bật các nguyên thủy riêng lẻ trong cảnh.

Và chọn một nguyên thủy hiển thị dữ liệu nguyên thủy liên quan của nó trong phác thảo bên trái.

Cuối cùng, nếu cảnh của bạn có thông tin chuyển động, Trình xem Cấu trúc Tăng tốc giờ đây có thể hình dung các điểm khác nhau trong thời gian.

Và đó chỉ là một cái nhìn nhanh về một vài bản cập nhật Công cụ dành cho nhà phát triển trong Xcode 14.

Có một loạt các tính năng mới khác như hỗ trợ Dylib, danh sách tài nguyên mới, điều hướng tệp trong trình chỉnh sửa Shader, bố cục Trình xem bộ đệm tùy chỉnh và nhiều tính năng khác.

Để tìm hiểu thêm về các công cụ và cách tận dụng tối đa những tiến bộ trong Metal 3, hãy nhớ xem các phiên khác này, điều này sẽ giúp bạn xây dựng đồ họa, trò chơi và ứng dụng chuyên nghiệp nâng cao.

Hôm nay, tôi đã giới thiệu cho bạn các tính năng nâng cao của Metal 3 để cải thiện hiệu suất và chất lượng: tải tài nguyên nhanh để phát trực tuyến kết cấu chất lượng cao hơn; Biên dịch ngoại tuyến cho thời gian tải ngắn hơn và ít nói lắp hơn; Nâng cấp MetalFX để hiển thị ở độ phân giải cao trong thời gian ngắn hơn; Bộ đổ bóng lưới để

Cuối cùng, tôi đã chỉ cho bạn một số công cụ nâng cao giúp bạn sử dụng các tính năng nâng cao như đường ống điều khiển bằng GPU và dò tia.

Để tìm hiểu thêm với các mẫu mã và tài liệu mới, hãy truy cập developer.apple.com/Metal.

Cảm ơn bạn đã tham gia.