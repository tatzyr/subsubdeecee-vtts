10145

- Xin chào tất cả mọi người. Tôi là Prashant, và chào mừng đến với WWDC.

Vào năm 2021, chúng tôi đã giới thiệu HLS Interstitials.

Họ cung cấp một cách thực sự đơn giản để lên lịch quảng cáo và các quảng cáo xen kẽ khác trong các luồng HLS của bạn.

Năm nay, chúng tôi đã thêm các tính năng cho phép bạn tối ưu hóa tốt hơn khoảng không quảng cáo của mình và cũng tinh chỉnh bản trình bày của mình.

Vì vậy, hãy đến, hãy tìm hiểu xem có gì mới trong HLS Interstitials.

Trong buổi nói chuyện này, chúng ta sẽ bắt đầu với một cái nhìn tổng quan nhanh về cách hoạt động của HLS Interstitials.

Và chúng tôi sẽ làm theo điều đó bằng cách thảo luận về các tùy chọn gợi ý quảng cáo mới mà chúng tôi đã thêm vào.

Sau đó, chúng tôi sẽ xem cách bạn có thể tinh chỉnh trải nghiệm quảng cáo của mình, đặc biệt là trong các tình huống trực tiếp bằng cách sử dụng các thuộc tính SNAP.

Sau đó, chúng tôi sẽ xem xét một số tham số truy vấn mới mà chúng tôi đã thêm vào đặc tả HLS và cuối cùng chúng tôi sẽ thảo luận về những thay đổi đối với API AVFoundation kết hợp các tính năng mới này.

Nhưng trước khi chúng ta đi sâu vào các tính năng mới, hãy nhanh chóng làm mới bản thân với HLS Interstitials.

Với HLS Interstitials, quảng cáo được coi là tài sản riêng biệt có thể được lên lịch theo dòng thời gian của chương trình.

Chúng không cần phải được khâu lại bằng các thẻ gián đoạn nữa.

Thay vào đó, chúng có thể được tham chiếu trực tiếp thông qua danh sách phát đa biến của chúng.

Điều này làm cho việc lên lịch quảng cáo thực sự đơn giản, vì bạn chỉ cần trỏ đến danh sách phát đa biến của chúng từ nội dung chính của mình.

Đây là danh sách phát phương tiện truyền thông điển hình của bạn hiển thị dòng thời gian nội dung chính.

Giả sử bạn muốn lên lịch hai quảng cáo trong khi phát lại.

Bạn muốn quảng cáo đầu tiên xuất hiện khoảng 5 giây để phát lại.

Đối với điều đó, bạn chỉ cần chỉ định thời gian bắt đầu của quảng cáo bằng cách sử dụng thẻ DATERANGE.

Và bạn muốn quảng cáo thứ hai xuất hiện sau 15 giây.

Đối với điều đó, bạn sẽ thêm một thẻ DATERANGE khác vào danh sách phát.

Nó đơn giản như vậy.

Cũng có thể là nội dung chính của bạn có một số quảng cáo đã được ghép vào.

Bạn thậm chí có thể thay thế những quảng cáo này bằng cách chỉ định độ lệch sơ yếu lý lịch bằng với thời lượng của quảng cáo được ghép vào.

Ngoài ra, quảng cáo xen kẽ HLS cũng cho phép bạn chỉ định các hạn chế điều hướng cho quảng cáo của mình và thậm chí bạn có thể lên lịch trả lại sớm trong các tình huống trực tiếp, trong số những thứ khác.

Để biết thêm thông tin, bạn có thể xem "Dynamically insert midrolls and prerolls in HLS" từ WWDC 2021.

Mặc dù bạn có thể lên lịch quảng cáo theo dòng thời gian của nội dung, nhưng năm nay chúng tôi đã thêm các thuộc tính buộc vị trí của quảng cáo bắt đầu hoặc cuối quá trình phát lại.

Đối với điều đó, chúng tôi đã thêm các tùy chọn gợi ý mới sau đây mà bạn có thể chỉ định bằng cách sử dụng thuộc tính CUE.

Thuộc tính này có thể đảm nhận một hoặc kết hợp các giá trị sau.

Giá trị của PRE sẽ làm cho quảng cáo xuất hiện trước khi việc trình bày nội dung chính bắt đầu.

Điều này đặc biệt hữu ích trong các tình huống trực tiếp mà bạn muốn lên lịch một vị trí quảng cáo cao cấp trước khi điều chỉnh chương trình.

Giá trị của POST sẽ chỉ ra rằng quảng cáo sẽ xuất hiện sau khi trình bày nội dung chính của bạn.

Điều này có thể hữu ích cho các luồng sự kiện mà bạn muốn lên lịch tín dụng cuối cùng, chẳng hạn như khi kết thúc một sự kiện trực tiếp.

Và giá trị của ONCE sẽ làm cho quảng cáo chỉ xuất hiện một lần.

Vì vậy, nếu người dùng tìm kiếm lại trước quảng cáo, họ sẽ không còn thấy quảng cáo phát lại nữa.

Một ứng dụng tuyệt vời của điều này sẽ dành cho các màn hình xếp hạng thường chỉ hiển thị một lần khi bắt đầu phát lại.

Điều này cho thấy một ví dụ danh sách phát nơi bạn có quảng cáo được lên lịch dưới dạng cuộn trước và sau.

Lưu ý rằng preroll được lên lịch chỉ chơi một lần.

Và chúng tôi cũng có một quảng cáo được lên lịch để phát lại một lần vào khoảng 10 giây để phát lại.

Giờ đây, việc lên lịch quảng cáo trong các tình huống trực tiếp đi kèm với những thách thức riêng.

Ví dụ, người đóng gói của bạn có thể đang sử dụng một đồng hồ để đặt thẻ ngày giờ chương trình trong danh sách phát trong khi bộ mã hóa đang sản xuất phương tiện được điều khiển bởi một đồng hồ khác.

Bây giờ, hai chiếc đồng hồ này không nhất thiết phải đồng bộ.

Ví dụ, trong ví dụ này, sự khác biệt trong các thẻ ngày giờ được liên kết với phân đoạn 0 và phân đoạn 100 là khoảng 800 giây.

Tuy nhiên, thời lượng phương tiện tích lũy sẽ ít hơn một chút vì thời lượng phân đoạn riêng lẻ dưới tám giây.

Trong những tình huống như vậy mà đồng hồ đóng gói của bạn nhanh hơn một chút so với đồng hồ mã hóa, thời gian truyền thông thực tế nơi quảng cáo bắt đầu có thể rơi vào đâu đó bên trong bảng xếp hạng.

Và nếu bạn dự kiến sẽ tham gia lại nội dung chính ở mức bù bằng với thời lượng quảng cáo như được hiển thị ở đây, bạn thực sự sẽ bỏ lỡ một số nội dung chính theo sau bảng xếp hạng.

Bây giờ bạn có thể sử dụng thuộc tính SNAP với giá trị OUT để thoát ra khỏi nội dung chính ở ranh giới phân đoạn gần nhất với thời gian bắt đầu quảng cáo dự định.

Và tương tự như vậy, sử dụng thuộc tính SNAP với giá trị IN để chụp lại nội dung chính gần nhất với thời gian trả về quảng cáo.

Lưu ý rằng chúng tôi hy vọng bạn chỉ sử dụng các thuộc tính SNAP cho các tình huống trực tiếp, vì khái niệm trôi đồng hồ này không nên tồn tại khi xử lý nội dung video được đóng gói sẵn theo yêu cầu.

Ở đây chúng ta thấy một danh sách phát trực tiếp nơi quảng cáo được lên lịch cho cả snap-out và snap-in.

Năm nay, chúng tôi cũng đã thêm một số thông số truy vấn sẽ giúp bạn tối ưu hóa khoảng không quảng cáo cũng như quản lý phiên.

Bây giờ, khi bạn đang điều chỉnh luồng trực tiếp ở giữa nhóm quảng cáo, bạn sẽ muốn biết nhóm quảng cáo đó đã tiến triển bao xa để bạn có thể hiển thị khoảng không quảng cáo có giá trị nhất của mình trong thời gian còn lại.

Đối với điều đó, chúng tôi đã thêm tham số truy vấn HLS_start_offset.

Tham số truy vấn HLS_start_offset sẽ được cung cấp cùng với yêu cầu URL danh sách tài sản của quảng cáo xen kẽ.

Đối với nội dung trực tiếp, điều này sẽ chỉ định độ lệch vào danh sách Tài sản nơi việc phát lại sẽ bắt đầu khi tham gia luồng trực tiếp và đối với nội dung video theo yêu cầu, nó sẽ là phần bù vào danh sách Tài sản khi tìm kiếm vào một khu vực được thay thế bằng quảng cáo xen kẽ.

Trong mẫu này, chúng tôi có một danh sách phát trực tiếp với quảng cáo 15 giây được lên lịch để bắt đầu lúc 5 giây từ đầu danh sách phát.

Các phân đoạn được đánh dấu được hiển thị ở đây sẽ được thay thế bằng quảng cáo xen kẽ.

Bây giờ trong quá trình tham gia trực tiếp, khách hàng thường sẽ có khoảng 3 khoảng thời lượng mục tiêu sau cạnh trực tiếp.

Tại thời điểm đó, nhóm quảng cáo 15 giây được lên lịch sẽ diễn ra trong 10 giây.

Vì vậy, điều này được cung cấp như một phần của tham số truy vấn HLS_start_offset.

Bây giờ khách hàng chỉ còn 5 giây thời gian quảng cáo, máy chủ có thể xây dựng danh sách Tài sản sao cho nó đặt quảng cáo có giá trị nhất của mình trong 5 giây cuối cùng của danh sách đó.

Tại máy chủ của bạn, bạn có thể cần một cách để theo dõi cùng một phiên phát lại trên nhiều yêu cầu quảng cáo để bạn có thể tránh phân phát đi lặp lại cùng một quảng cáo cho ai đó.

Vì vậy, để liên kết các yêu cầu quảng cáo với các phiên phát lại chính, chúng tôi đã thêm tham số truy vấn HLS_primary_id.

Nếu khách hàng đặt tiêu đề yêu cầu id phiên phát lại cho tất cả các yêu cầu http của một phiên phát lại cụ thể, họ có thể cung cấp ID phiên này như một phần của tham số truy vấn HLS_primary_id cho các yêu cầu X-Asset-URI và X-Asset-List.

Khách hàng không đặt tiêu đề yêu cầu id phiên nên tạo một giá trị duy nhất cho mỗi phiên phát lại chính và sử dụng nó làm tham số truy vấn HLS_primary_id cho cả yêu cầu nội dung chính và xen kẽ.

Bạn có thể nhớ lại rằng AVFoundation cung cấp các đối tượng AVPlayerInterstitialController và AVPlayerInterstitialEvent cho phép bạn lên lịch quảng cáo ở phía máy khách.

Bây giờ chúng tôi cũng đã thêm hỗ trợ cho các tùy chọn gợi ý và SNAP cho đối tượng AVPlayerInterstitialEvent.

Bạn có thể chỉ định các tùy chọn gợi ý, cho dù bạn muốn quảng cáo được lên lịch dưới dạng cuộn trước hay cuộn bài đăng, thông qua thuộc tính Cue.

Tùy chọn phát một lần được báo hiệu thông qua thuộc tính Cue trong thẻ DATERANGE được đặt dưới dạng Boolean thông qua thuộc tính willPlayOnce.

Tùy chọn để chụp ra được báo hiệu thông qua thuộc tính alignsStartWithPrimarySegmentBoundary và để chụp vào, bạn sẽ đặt thuộc tính alignsResumptionWithPrimarySegmentBoundary.

Khi AVPlayerInterstitialEvent tiếp tục phát triển, chúng tôi nghĩ rằng có thể tốt hơn là tách cài đặt của các thuộc tính khỏi việc tạo đối tượng.

Vì vậy, bây giờ chúng tôi đã làm cho đối tượng AVPlayerInterstitialEvent có thể thay đổi được.

Bây giờ bạn có thể tạo đối tượng chỉ với mục chính và thời gian bắt đầu của sự kiện.

Và sau đó bạn có thể chỉ định các tùy chọn cấu hình khác nhau bằng cách đặt các thuộc tính có liên quan.

Lưu ý rằng một khi sự kiện được đặt trên bộ điều khiển, mọi thay đổi tiếp theo đối với đối tượng sự kiện sẽ không được phản ánh tại bộ điều khiển, vì bộ điều khiển tạo một bản sao của các đối tượng này.

Để các thay đổi có hiệu lực, bạn phải đặt sự kiện một lần nữa trên bộ điều khiển.

Để kết thúc, bây giờ bạn có thể lên lịch quảng cáo của mình dưới dạng cuộn trước hoặc sau bằng cách sử dụng thuộc tính X-CUE.

Bạn cũng có thể buộc quảng cáo của mình chỉ phát một lần bằng cách đặt X-CUE thành một lần.

Để quản lý độ lệch đồng hồ trong các tình huống trực tiếp, bạn sẽ sử dụng thuộc tính X-SNAP.

Để xây dựng danh sách nội dung của bạn trong quá trình tham gia trực tiếp, bạn có thể sử dụng tham số truy vấn HLS_start_offset và bạn sẽ sử dụng tham số truy vấn HLS_primary_id để liên kết các yêu cầu xen kẽ với các phiên phát lại chính.

Bạn có biết rằng nếu bạn sử dụng quảng cáo xen kẽ HLS để lên lịch quảng cáo, AVFoundation sẽ tự động quản lý chúng khi ở Shareplay không?

Để biết thêm thông tin, hãy xem cuộc nói chuyện "Hiển thị quảng cáo và các quảng cáo xen kẽ khác trong SharePlay".

Đó là nó cho tôi, các bạn. Cảm ơn bạn.