10100

♪ ♪

Xin chào, tôi là Devin Rousso, một kỹ sư trong nhóm WebKit, và tôi ở đây hôm nay để chia sẻ với bạn cơ hội mới thú vị để tạo các tiện ích mở rộng cho Trình kiểm tra web của Safari.

Web Inspector là công cụ phát triển chính để gỡ lỗi nội dung web trên tất cả các nền tảng của Apple.

Nó đã có rất nhiều chức năng tích hợp để gỡ lỗi các trang web, nhưng thường có những lĩnh vực phát triển web khó xây dựng thành một công cụ tổng quát dành cho nhà phát triển.

Có thể bạn đang gỡ lỗi một thư viện JavaScript phổ biến hoặc bạn chỉ cần một cái gì đó cụ thể hơn cho những gì bạn đang làm.

Tiện ích mở rộng Web Inspector là một giải pháp tuyệt vời cho các tình huống quy trình làm việc cá nhân này.

Bằng cách sử dụng các tiện ích mở rộng web đa trình duyệt và API DevTools, giờ đây bạn có thể thêm các tab của riêng mình vào Trình kiểm tra web trong Safari 16.

Chúng ta hãy xem nhanh tiện ích mở rộng Web Inspector đang hoạt động và sau đó tôi sẽ chỉ cho bạn cách bạn có thể xây dựng tiện ích mở rộng của riêng mình.

Đầu tiên tôi sẽ mở tùy chọn tiện ích mở rộng của Safari.

Và kích hoạt tiện ích mở rộng Trình kiểm tra Web.

Sau đó, tôi sẽ đóng tùy chọn tiện ích mở rộng của Safari và kiểm tra trang.

Tôi sẽ làm điều đó từ menu Phát triển, Hiển thị Trình kiểm tra Web.

Trong Trình kiểm tra web, tôi không chỉ có thể thấy nhiều tab tích hợp sẵn như Tab Phần tử, mà còn cả tab cho tiện ích mở rộng Trình kiểm tra web mà tôi vừa bật.

Tuy nhiên, vì chúng tôi vừa bật tiện ích mở rộng này, trước tiên chúng tôi phải cho phép nó hoạt động với trang hiện đang được kiểm tra.

Tôi có các tùy chọn thời lượng quyền giống như các tiện ích mở rộng khác bên ngoài Trình kiểm tra web, vì vậy bây giờ hãy cấp quyền truy cập cho nó trong một ngày.

Phần mở rộng Open Graph này là những gì tôi sẽ xây dựng trong phiên này.

Nó hiển thị siêu dữ liệu truyền thông xã hội phổ biến mà hầu hết các trang web đặt trên trang của họ để sử dụng bằng cách xem trước liên kết trong Tin nhắn và các trang truyền thông xã hội khác.

Bây giờ chúng ta đã có cái nhìn nhanh về những gì tiện ích mở rộng Web Inspector có thể làm, hãy nói về cách chúng được xây dựng.

Giống như các Tiện ích mở rộng Web Safari khác, các tiện ích mở rộng Web Inspector được phân phối thông qua một ứng dụng trong App Store.

Để xây dựng tiện ích mở rộng Trình kiểm tra web của riêng bạn, bạn sẽ cần phải có Xcode, công cụ tạo ứng dụng của Apple để xây dựng các ứng dụng Mac và iOS.

Xcode cũng đi kèm với các mẫu dự án để giúp bắt đầu tạo một ứng dụng mở rộng Safari mới.

Nếu bạn đã có một tiện ích mở rộng web hiện có mà bạn đã tạo cho một trình duyệt khác, bạn cũng có thể sử dụng công cụ chuyển đổi đi kèm của Xcode.

Chỉ cần chạy safari-web-extension-converter từ Terminal, chuyển đường dẫn đến thư mục tiện ích mở rộng của bạn có chứa tệp manifest.json.

Một dự án ứng dụng đầy đủ sau đó sẽ được tạo cho tiện ích mở rộng của bạn đã sẵn sàng để xây dựng và chạy.

Để biết thêm thông tin về công cụ này, hãy xem Meet Safari Web Extensions từ WWDC 2020, cũng như tài liệu trực tuyến.

Vì vậy, hôm nay tôi sẽ xem xét cấu trúc cơ bản của tiện ích mở rộng Web Inspector, đề cập đến cách đánh giá tốt nhất mã trong tiện ích mở rộng đó và thảo luận về một số phương pháp hay nhất cho người dùng của bạn.

Hãy bắt đầu nào.

Các tiện ích mở rộng của Trình kiểm tra web được cấu trúc giống như các Tiện ích mở rộng web Safari khác, với biểu tượng thanh công cụ, trang nền, tập lệnh nội dung và hơn thế nữa, nhưng chúng cũng có trang nền devtools chuyên dụng.

Hãy xem nó hoạt động như thế nào trong thực tế.

Cấu trúc của Tiện ích mở rộng web Safari điển hình bắt đầu bằng tệp kê khai khai báo các chi tiết cơ bản về tiện ích mở rộng, như tên, biểu tượng, mô tả và hơn thế nữa.

Nó có thể khai báo một trang nền để xử lý tất cả logic hậu trường của tiện ích mở rộng của bạn và cũng có thể khai báo bất kỳ tập lệnh nội dung nào được sử dụng để đưa chức năng vào các trang web mà người dùng truy cập.

Đối với các tiện ích mở rộng của Trình kiểm tra Web, một vài trang khác tham gia vào hỗn hợp.

Đầu tiên là một trang nền devtools bắt buộc cho logic hậu trường của tiện ích mở rộng Web Inspector của bạn.

Trang này có quyền truy cập vào các API devtools duy nhất và chỉ có một bộ API tập lệnh nội dung giới hạn.

Từ trang nền devtools này, bạn có thể tạo các trang tab devtools sẽ được hiển thị trong Trình kiểm tra web.

Nhưng tất cả những điều đó chỉ dành cho một Thanh tra Web duy nhất.

Nếu có nhiều Trình kiểm tra web, mỗi trình kiểm tra có phiên bản riêng của cùng một trang nền devtools này, tồn tại trong suốt thời gian mà Trình kiểm tra web liên quan đang mở.

Như vậy, bạn cũng có thể có nhiều phiên bản của mỗi trang tab devtools.

Chúng ta hãy xem cấu trúc này trông như thế nào trong thực tế và bắt đầu xây dựng tiện ích mở rộng Open Graph Web Inspector của tôi.

Tôi sẽ bắt đầu bằng cách tạo một dự án mới trong Xcode.

Loại dự án tôi sẽ tạo là một Ứng dụng Mở rộng Safari.

Tôi chỉ thực sự cần macOS, nhưng tôi sẽ để nguyên như vậy, trong đa nền tảng, trong trường hợp tôi muốn thêm chức năng iOS trong tương lai.

Tôi sẽ đặt tên cho "Open Graph" này và giữ phần còn lại của mặc định.

Lưu ý rằng bạn cần chọn một mã định danh nhóm và gói dựa trên tài khoản nhà phát triển Apple mà bạn đang sử dụng.

Và cuối cùng, tôi sẽ lưu cái này trên Máy tính để bàn.

Bây giờ tôi có một dự án Mở rộng Web Safari chung, sẵn sàng để tôi sửa đổi.

Lần đầu tiên tôi được đưa đến tệp manifest.json, đây là tệp cấu hình gốc cho mọi tiện ích mở rộng web.

Tệp kê khai tham chiếu đến các tài nguyên khác tạo nên tiện ích mở rộng của bạn - bản địa hóa, hình ảnh, trang, tập lệnh, kiểu dáng và hơn thế nữa.

Đối với tiện ích mở rộng Trình kiểm tra web của tôi, tôi sẽ không cần một số tệp này, như trang nền, tập lệnh nội dung hoặc cửa sổ bật lên, vì vậy tôi sẽ xóa chúng khỏi bản kê khai và khỏi toàn bộ dự án.

Được rồi, hãy bắt đầu biến nó thành một tiện ích mở rộng Web Inspector.

Để làm điều đó, tôi cần thêm một trang nền devtools vào bản kê khai và tạo một tệp tương ứng cho nó, cũng như một tệp JavaScript mà tôi sẽ sử dụng bên trong nó.

Tôi sẽ đi đến Tệp - Mới - Tệp...

Và cuộn xuống để tìm mẫu tệp trống.

Tôi sẽ gọi tệp này là "devtools_background.html" để khớp với tên tôi đã sử dụng trong bản kê khai.

Vị trí đã được đặt ngay bên cạnh các tài nguyên khác của tôi và là một phần của các mục tiêu chính xác, vì vậy tôi không cần phải thay đổi bất cứ điều gì ở đây.

Tôi sẽ lặp lại các bước tương tự một lần nữa với tệp JavaScript...

...Mà tôi sẽ gọi là "devtools_background.js".

Cuối cùng, tôi cần đưa tệp JavaScript vào trang nền devtools của mình.

Hãy nhớ rằng, trang này được tạo khi Trình kiểm tra web mở và chịu trách nhiệm tạo các tab tùy chỉnh xuất hiện trong Trình kiểm tra web.

Tôi hầu như luôn muốn tạo một tab để, nếu cần, các quyền tôi thấy trước đó sẽ được hiển thị cho người dùng của tôi ngay tại đó, thay vì ở một số nơi khác.

Bảng devtools này tạo API nhận ba đối số đơn giản.

Đầu tiên là tên của tab.

Đối với điều đó, tôi đang sử dụng phương pháp bản địa hóa để tra cứu tên bản địa hóa của tiện ích mở rộng của mình.

Đối số tiếp theo là đường dẫn biểu tượng để sử dụng.

Lưu ý rằng đây phải là một hình ảnh vector để chia tỷ lệ mượt mà đến bất kỳ kích thước nào nếu người dùng chọn phóng to giao diện người dùng của họ.

Nhưng để sử dụng biểu tượng này, tôi cần đảm bảo rằng nó là một phần của dự án của tôi, cùng với tất cả các biểu tượng khác mà tôi cần cho tiện ích mở rộng của mình.

Các biểu tượng trong thư mục "hình ảnh" vẫn là mặc định từ mẫu dự án.

Vậy hãy xóa những thứ này khỏi dự án.

Và thay thế chúng bằng một số biểu tượng tôi đã tạo trước đó...

...Bao gồm "logo.svg" mà tôi đang cố gắng sử dụng khi tạo tab devtools.

Bây giờ cái này ở đây, tôi sẽ quay lại tập lệnh nền devtools.

Đối số thứ ba là HTML được sử dụng bởi tab trong Trình kiểm tra web.

Và giống như với những hình ảnh một lúc trước, tôi cần tạo trang này trước khi tôi có thể sử dụng nó.

Tôi sẽ đặt tên cho cái này là "devtools_tab.html" để khớp với tên tôi đã đặt cho API.

Tuy nhiên, không giống như trang nền devtools, trang tab devtools này sẽ thực sự được hiển thị cho người dùng, vì vậy lần này tôi sẽ tạo cả tệp JavaScript và CSS.

Tôi sẽ đặt tên cho tệp JavaScript là "devtools_tab.js"...

...Và tệp CSS "devtools_tab.css".

Thật tuyệt khi tôi đã thiết lập cấu trúc này, nhưng bây giờ tôi sẽ chỉ thêm "Hello World" thông thường để đảm bảo rằng mọi thứ đang hoạt động chính xác.

Nhưng đừng lo lắng, chúng ta sẽ đi sâu hơn vào vấn đề này một lát sau, bởi vì trước tiên, chúng ta vẫn còn một vài biểu tượng nữa để thay thế để đảm bảo tiện ích mở rộng này có giao diện nhất quán.

Đầu tiên chúng ta cần thay thế biểu tượng lớn mặc định...

...Bằng cách xóa nó...

...Và kéo biểu tượng lớn của tôi vào vị trí của nó.

Tuy nhiên, vì biểu tượng lớn này là một phần của ứng dụng, tôi cần thêm nó vào đúng mục tiêu.

Các biểu tượng còn lại đều là một phần của danh mục Tài sản, cụ thể là bộ AppIcon.

Tôi đã chuẩn bị những biểu tượng này, vì vậy tôi sẽ dán chúng vào.

Và với điều đó, tôi nghĩ chúng tôi đã thay thế tất cả các biểu tượng mặc định, vì vậy bây giờ tôi sẽ chạy tiện ích mở rộng của mình.

Lưu ý rằng việc này có thể mất vài giây trong lần đầu tiên dự án được xây dựng.

Và nó đây rồi!

Hầu hết giao diện người dùng này là từ mẫu Xcode, nhưng tôi thấy chính xác biểu tượng của mình thay vì biểu tượng mặc định.

Khi chúng tôi đã khởi chạy ứng dụng mở rộng Safari ít nhất một lần, chúng tôi có thể đóng nó, vì ứng dụng không cần phải chạy nữa để Safari chọn nó.

Tuy nhiên, trước khi tôi có thể nhìn thấy nó trong Safari, tôi phải cho phép các tiện ích mở rộng chưa ký trong menu Phát triển vì đây là một ứng dụng chưa được xây dựng cục bộ.

Bây giờ, trong tùy chọn Tiện ích mở rộng của Safari, tôi có thể thấy Biểu đồ Mở. Tôi sẽ bật nó lên.

Tôi sẽ mở một tab Safari và duyệt đến apple.com để tôi có thể thử tiện ích mở rộng của mình.

Và chúng ta đã có thể thấy rằng biểu tượng của tôi nằm trên thanh công cụ.

Và tab tiện ích mở rộng của tôi hiện đang ở trong thanh tab.

Chuyển sang nó, chúng ta có thể thấy cùng một lời nhắc cấp phép mà chúng ta đã thấy trước đó.

Lời nhắc cấp phép này được tự động hiển thị nếu tiện ích mở rộng cần quyền.

Giống như trước đó, tôi sẽ cho phép nó trong một ngày.

Và có "Xin chào thế giới" mà tôi đã thêm vào trang tab devtools trước đó.

Đó là những điều cơ bản về cách tạo tiện ích mở rộng Trình kiểm tra web cho Safari 16.

Hãy tóm tắt lại.

Tôi đã khai báo trang nền devtools và thêm nó vào dự án Xcode của mình.

Từ đó, tôi đã có thể tạo một tab mới trong Trình kiểm tra web để hiển thị công cụ tùy chỉnh của mình.

Và cuối cùng, tôi đã bắt đầu xem xét các quyền mà tiện ích mở rộng của tôi cần.

Đối với tiện ích mở rộng Trình kiểm tra web, điều này thường tập trung vào việc đánh giá mã trong trang được kiểm tra, thường là để trích xuất một số dữ liệu để hiển thị bên trong Trình kiểm tra web.

Tiện ích mở rộng web đã có một số cách để đánh giá mã.

Đối với các tiện ích mở rộng của Trình kiểm tra Web, có một API khác là phương pháp đánh giá tập lệnh ưa thích bên trong trang được kiểm tra.

Hãy xem API này và xem cách tôi có thể sử dụng nó cho tiện ích mở rộng OpenGraph của mình.

API mở rộng devtools này để đánh giá JavaScript trong cửa sổ được kiểm tra là cách tốt nhất để có được kết quả nhanh chóng.

Nó sẽ tự động nhắm mục tiêu trang được liên kết với Trình kiểm tra web mà tiện ích mở rộng của bạn đang chạy.

Hãy nhớ rằng, người dùng có thể kiểm tra nhiều trang cùng một lúc.

Ngoài ra còn có một số tùy chọn hữu ích cho API này có thể giúp bạn có được kết quả đúng.

Theo mặc định, biểu thức được cung cấp cho API này được đánh giá trong ngữ cảnh của khung chính của trang được kiểm tra.

Nhưng bạn có thể sử dụng tùy chọn frameURL để chỉ định đánh giá bên trong một khung khác.

Điều này là cần thiết khi tiện ích mở rộng của bạn cần trích xuất dữ liệu từ một trong nhiều khung phụ có thể có trong trang.

Đối với tiện ích mở rộng OpenGraph của tôi, tôi chỉ cần lo lắng về khung chính, nhưng tôi khuyên bạn nên ghi nhớ điều này khi đánh giá các tập lệnh cho tiện ích mở rộng Web Inspector của mình.

Hãy xem cách tôi có thể sử dụng chức năng này trong tiện ích mở rộng của mình để lấy và hiển thị dữ liệu từ trang đã kiểm tra.

Tôi sẽ bắt đầu bằng cách thay thế trình giữ chỗ "Hello World" mà tôi đã thêm trước đó bằng HTML thực sự tải các tệp CSS và JavaScript của tôi.

Sau đó, tôi sẽ thêm một số CSS cơ bản để tạo cho tab devtools của tôi một phong cách đẹp.

Tôi muốn đảm bảo rằng tab devtools của tôi phù hợp với phần còn lại của Web Inspector, vì vậy tôi đã khai báo thuộc tính `color-scheme` gốc sẽ làm cho tab devtools của tôi khớp với giao diện của phần còn lại của Web Inspector.

Tôi đang sử dụng một họ phông chữ hệ thống và kế thừa kích thước phông chữ, và phù hợp với màu sắc của văn bản quan trọng hơn.

Về chức năng, tôi sẽ bắt đầu bằng cách thêm một số văn bản trong trường hợp trang không có bất kỳ siêu dữ liệu opengraph nào.

Lưu ý rằng tôi có thể sử dụng các chuỗi được bản địa hóa tiện ích mở rộng web trong Trình kiểm tra web giống như tôi có thể sử dụng bất kỳ nơi nào khác trong tiện ích mở rộng web.

Nhưng để làm như vậy, tôi cần thêm cùng một mã định danh chuỗi được bản địa hóa đó vào tệp chuỗi được bản địa hóa.

Tiếp theo, tôi sẽ tạo JavaScript mà tôi sẽ cung cấp cho các devtools mạnh mẽ inspectedWindow eval API, cho phép tôi đánh giá nó trong trang được kiểm tra.

Trong trường hợp này, tôi muốn truy vấn DOM của trang đã kiểm tra để biết một số siêu dữ liệu opengraph phổ biến, cụ thể là tiêu đề, mô tả...

...Và hình ảnh, cũng như trạng thái sẵn sàng hiện tại của tài liệu trang được kiểm tra, gói tất cả lại với nhau để gửi lại trang devtools thông qua giá trị trả về.

Sau khi hoàn tất, tôi có thể lấy phần tử HTML tương ứng với từng thuộc tính này và định cấu hình chúng để chúng hiển thị dữ liệu đã được thu thập.

Và nếu tài liệu chưa hoàn toàn sẵn sàng, tôi có thể thử lại sau một thời gian ngắn.

Tôi cũng muốn làm lại tất cả những điều này mỗi khi trang được kiểm tra điều hướng, vì vậy tôi sẽ thêm trình nghe cho mạng devtools onNavigated.

Tất cả điều này trông rất tuyệt, vì vậy tôi sẽ xây dựng lại để kiểm tra nó.

Bây giờ, bất cứ khi nào tôi mở Web Inspector hoặc điều hướng với Web Inspector đã mở, tôi có thể thấy tiêu đề opengraph, mô tả và hình ảnh của mọi trang.

Và đó là một ví dụ đơn giản về cách sử dụng một số API mở rộng Web Inspector mới và mạnh mẽ.

Tiện ích mở rộng OpenGraph của tôi đang hoạt động rất tốt.

Trang tab devtools của tiện ích mở rộng Trình kiểm tra Web của tôi hiện có thể đánh giá trong trang đã kiểm tra.

Tôi có thể lấy dữ liệu kết quả và xử lý nó để hiển thị nó ở định dạng thân thiện với người dùng để truy cập nhanh.

Vậy một số cách tuyệt vời để tạo ra trải nghiệm người dùng tuyệt vời khi tạo tiện ích mở rộng Web Inspector là gì?

Luôn tạo các trang tab devtools từ trang nền devtools.

Bằng cách này, người dùng có thể thấy nơi các tab này sẽ xuất hiện trong Trình kiểm tra web và mọi lời nhắc cấp phép thích hợp sẽ được hiển thị trực tuyến.

Thay vì yêu cầu quyền máy chủ cụ thể, hãy thử sử dụng quyền activeTab để giữ các tiện ích mở rộng Web Inspector được nhắm mục tiêu nhất có thể.

Và đảm bảo sử dụng thuộc tính lược đồ màu CSS hoặc API chủ đề devtools tiện ích mở rộng web để phù hợp với chủ đề tổng thể của Trình kiểm tra web.

Vì vậy, hôm nay tôi đã chỉ cho bạn cách tạo các công cụ gỡ lỗi hoàn toàn mới với các tiện ích mở rộng Web Inspector và đề cập đến một số phương pháp hay nhất tuyệt vời cần ghi nhớ khi làm như vậy.

Bạn có thể tải xuống tiện ích mở rộng OpenGraph Web Inspector trong các tài nguyên liên quan của phiên này nếu bạn muốn tự mình xem xét kỹ hơn.

Chúng tôi rất quan tâm đến việc lắng nghe suy nghĩ của bạn, vì vậy vui lòng gửi lỗi và yêu cầu tính năng bằng Trợ lý phản hồi hoặc đến trò chuyện với chúng tôi trên diễn đàn nhà phát triển Safari.

Và thậm chí cân nhắc tham gia nhóm cộng đồng WebExtensions để giúp định hình tương lai của các tiện ích mở rộng web.

Ngoài ra, hãy đảm bảo kiểm tra Có gì mới trong Tiện ích mở rộng web Safari và tài liệu trực tuyến để tìm hiểu thêm về những gì mới trong năm nay.

Tôi thực sự hy vọng bạn thích tìm hiểu về khả năng mới tuyệt vời để tạo công cụ tùy chỉnh trong Trình kiểm tra web.

Chúng tôi nóng lòng muốn xem bạn sẽ tạo tiện ích mở rộng Web Inspector tuyệt vời nào và mong đợi tất cả những cách bạn sẽ vượt qua giới hạn của những gì có thể.

Cảm ơn bạn rất nhiều vì đã lắng nghe, và tôi hy vọng bạn có một phần còn lại tuyệt vời của WWDC. ♪ ♪