110384

♪ nhạc cụ hip hop ♪

Xin chào, tên tôi là Felipe.

Tôi là một kỹ sư phần mềm trong nhóm tvOS.

Hôm nay tôi rất vui được chia sẻ với bạn những cải tiến mà chúng tôi đã thực hiện trong tvOS 16 để giúp hỗ trợ nhiều người dùng trong ứng dụng của bạn dễ dàng hơn.

Apple TV được thiết kế để mọi người sử dụng.

Chúng tôi đã cải thiện nhiều người dùng trên Apple TV kể từ tvOS 13.

Trong tvOS 16, chúng tôi có các tính năng mới giúp hỗ trợ nhiều người dùng trong tất cả các ứng dụng dễ dàng hơn.

Tôi sẽ bắt đầu với tổng quan về các tính năng của nhiều người dùng trên Apple TV.

Cho thấy việc cá nhân hóa các ứng dụng trên thiết bị được mọi người sử dụng dễ dàng như thế nào.

Sau đó, tôi sẽ chứng minh việc lưu trữ lựa chọn hồ sơ cho mỗi người dùng của một ứng dụng phát trực tuyến đơn giản như thế nào.

Kết thúc với các đề xuất cho cách tiếp cận tốt nhất cho ứng dụng của riêng bạn.

Trong tvOS 16, chúng tôi đang giúp việc có cả gia đình trên Apple TV trở nên dễ dàng hơn.

Khi bạn nhấn và giữ nút TV trên Siri Remote, Trung tâm điều khiển sẽ hiển thị.

Ở trên cùng là danh sách những người dùng trên Apple TV này.

Mới trong tvOS 16, danh sách người dùng bao gồm các thành viên Gia đình iCloud chưa được thêm vào, giúp việc có cả gia đình trên Apple TV trở nên dễ dàng hơn bao giờ hết.

Đây, Anne vẫn chưa có trên Apple TV.

Biểu tượng dấu cộng biểu thị một người dùng được đề xuất.

Để Anne tham gia, chúng ta có thể chỉ cần chọn người dùng được đề xuất.

Tất cả những gì Anne cần làm là mang iPhone của họ đến cùng phòng với Apple TV và trên iPhone xác nhận kết nối.

Và đó là tất cả.

Anne hiện có quyền truy cập vào dữ liệu của họ trên Apple TV.

Bây giờ chúng ta hãy quay lại iPhone của Anne một lát.

Hãy cùng xem ứng dụng phát trực tuyến video yêu thích của Anne.

Ứng dụng được sử dụng bởi cả gia đình và mỗi người có hồ sơ riêng của họ.

Khi ứng dụng lần đầu tiên khởi chạy, nó trình bày một trình chọn hồ sơ, Anne chọn hồ sơ của cô ấy.

Ứng dụng, chạy trên thiết bị cá nhân, có thể chỉ cần lưu trữ hồ sơ ưa thích trong NSUserDefaults hoặc thậm chí đưa vào CloudKit để đồng bộ hóa nó với tất cả các thiết bị.

iPhone của mỗi thành viên trong gia đình ghi nhớ hồ sơ ưa thích của người đó.

Không cần phải tiếp tục hỏi nên sử dụng hồ sơ nào khi ứng dụng mở ra.

Apple TV là một thiết bị được chia sẻ bởi cả gia đình và chúng tôi nghĩ rằng điều thực sự quan trọng là mọi người sử dụng Apple TV đều có thể truy cập nội dung và dữ liệu của riêng họ.

Trong tvOS 14, chúng tôi đã giới thiệu khả năng cho các ứng dụng chạy như người dùng hiện tại.

Với một hộp kiểm duy nhất để thêm quyền "Chạy với tư cách là Người dùng Hiện tại" và không có thay đổi mã nào cả, các ứng dụng có thể truy cập dữ liệu riêng của mỗi người dùng, giống như trên iPhone.

Mã iOS của bạn, gọi các API đó, có thể chạy như trên Apple TV, hoạt động giống như mỗi người đang sử dụng Apple TV cá nhân của riêng họ.

Khi ứng dụng khởi chạy, tvOS sẽ lo mọi thứ.

Quyền riêng tư và bảo mật, tất cả đều được xử lý bởi hệ thống.

Quyền "chạy với tư cách là người dùng hiện tại" hoàn hảo cho các trò chơi và bất kỳ ứng dụng nào liên quan đến tiến trình cá nhân.

Tuy nhiên, các ứng dụng truyền thông có hồ sơ cần nhiều hơn một chút.

Trong ví dụ của tôi cho đến nay, tôi đã bỏ qua một phần quan trọng: đăng nhập.

Chúng tôi tin rằng việc đăng nhập cần phải dễ dàng và không thường xuyên nhất có thể.

Trong tvOS 15, chúng tôi đã giới thiệu một tính năng cho phép mọi người sử dụng iPhone hoặc iPad của họ để đăng nhập liền mạch trên các ứng dụng tvOS của bạn.

Đây là trải nghiệm đăng nhập hạng nhất, nơi các thiết bị hoạt động cùng nhau để cung cấp cách thuận tiện nhất để đăng nhập trên Apple TV.

Các tính năng không có sẵn trực tiếp trên Apple TV, như mật khẩu của bạn trong Chuỗi khóa iCloud, chỉ cách một cú chạm.

Để tìm hiểu cách xây dựng trải nghiệm đăng nhập tuyệt vời, hãy xem "Đơn giản hóa đăng nhập cho các ứng dụng tvOS của bạn" từ WWDC 2021.

Và năm nay chúng tôi sẽ giới thiệu hỗ trợ cho OAuth và mật khẩu trên tvOS.

Mật khẩu là một công nghệ xác thực mới tuyệt vời để thay thế mật khẩu trong các ứng dụng và trang web của bạn.

Để tìm hiểu thêm về chìa khóa mật khẩu, hãy xem video "Gặp gỡ chìa khóa mật khẩu".

Nhưng dễ dàng và tiện lợi không phải là tất cả.

Việc đăng nhập chỉ xảy ra một lần vẫn quan trọng.

Để đạt được trải nghiệm người dùng tối ưu này, với "Chạy với tư cách là Người dùng hiện tại", chúng tôi đang giới thiệu một API mới đơn giản trong tvOS 16.

Đây là một hằng số mới trong Dịch vụ Chuỗi khóa cho phép các ứng dụng truy cập Chuỗi khóa độc lập với người dùng.

Tất cả người dùng luôn có thể truy cập các mục được lưu trữ bằng khóa mới này trên Apple TV.

Hãy xem xét một ví dụ.

Đây là một phương pháp lưu một mục trong Chuỗi khóa, với tên người dùng và mật khẩu.

Để lưu mục vào Chuỗi khóa độc lập với người dùng, tất cả những gì bạn phải làm là thêm một khóa mới vào từ điển thuộc tính được chuyển đến hàm SecItemAdd.

Chúng tôi chỉ đơn giản là chuyển true làm giá trị cho khóa kSecUseUserIndependentKeychain.

Với bộ Móc khóa độc lập với người dùng, các mục bạn đọc và viết sẽ hiển thị cho tất cả người dùng.

Sự kết hợp của cả Keychain API mới và quyền "Chạy với tư cách là người dùng hiện tại" cho phép các ứng dụng của bạn có iPhone tốt nhất và tốt nhất của Apple TV: tách dữ liệu đơn giản cho mỗi người dùng trên thiết bị dùng chung trong khi vẫn duy trì trải nghiệm đăng nhập một lần trên Apple TV.

Trong tvOS 16, chúng tôi đã phản đối các phương pháp ánh xạ hồ sơ theo cách thủ công cho người dùng hệ thống trong TVUserManager.

Bạn không cần phải duy trì bản đồ người dùng đến hồ sơ nữa.

Hệ thống sẽ xử lý nó cho bạn.

Các API tương tự mà bạn sử dụng trên iOS có thể được sử dụng, như trên Apple TV.

Nó dễ dàng hơn rất nhiều.

Hãy để tôi cho bạn thấy tất cả trong hành động với một bản demo.

Tôi sẽ hướng dẫn bạn qua một ứng dụng mẫu đại diện cho các ứng dụng truyền thông với hồ sơ.

Đây là ứng dụng phát trực tuyến video của tôi.

Hiện tại nó không sử dụng bất kỳ tính năng nào mà tôi đã nói đến.

Nó không chạy như người dùng hiện tại và nó không sử dụng Keychain API mới.

Tôi sẽ tiếp tục và đăng nhập để cho bạn xem.

Sau khi đăng nhập, tôi được trình bày với một danh sách các hồ sơ.

Người dùng hiện tại là Mei, vì vậy tôi sẽ chọn hồ sơ của cô ấy.

Chọn một hồ sơ hiển thị nội dung được cá nhân hóa mà Mei muốn xem.

Sau đó, Anne ngồi trên đi văng để xem TV.

Họ mở Trung tâm điều khiển bằng cách nhấn và giữ nút TV trên Siri Remote.

Ở trên cùng trong Trung tâm điều khiển là danh sách người dùng.

Dấu kiểm màu xanh lá cây cho biết người dùng hiện tại.

Tôi sẽ chuyển sang Anne ngay bây giờ và mở ứng dụng.

Đúng như dự đoán, ứng dụng trình bày lại trình chọn hồ sơ.

Vì vậy Anne có thể chọn hồ sơ của họ.

Nhưng hãy xem điều gì sẽ xảy ra khi chuyển trở lại Mei.

Ứng dụng vẫn nằm trong hồ sơ của Anne.

Nó không nhớ rằng Mei đã chọn hồ sơ ưa thích của cô ấy trước đây.

Với các tính năng mới trong tvOS 16, trải nghiệm người dùng có thể tốt hơn nhiều.

Tôi muốn mọi người sử dụng ứng dụng không phải chọn lại ai đang xem.

Hãy đến Xcode, và tôi sẽ cho bạn thấy nó dễ dàng như thế nào.

Làm cho ứng dụng của tôi thực thi như người dùng hiện tại rất đơn giản.

Tất cả những gì tôi phải làm là thêm một khả năng vào mục tiêu ứng dụng của mình.

Ở đây trong mục tiêu ứng dụng của tôi, tôi sẽ chuyển sang tab Ký & Khả năng.

Ngay dưới tab, ở trên cùng bên trái ở đây, tôi sẽ nhấp vào nút Thêm khả năng.

Nó mở ra danh sách các khả năng.

Cái mà tôi quan tâm được gọi là Quản lý người dùng.

Vì vậy tôi sẽ gõ "người dùng" để lọc danh sách.

Bây giờ tôi chỉ cần nhấp đúp vào khả năng mà tôi muốn thêm vào ứng dụng của mình.

Dưới đây, hộp kiểm "Chạy với tư cách là Người dùng Hiện tại" được chọn theo mặc định.

Đó chính xác là những gì tôi cần.

Với quyền này, quy trình ứng dụng của tôi sẽ luôn được khởi chạy với tư cách là người dùng hiện được chọn.

Hệ thống sẽ đảm bảo rằng dữ liệu cho mỗi người dùng là khác nhau.

Tất cả, bao gồm cả Móc khóa.

Nhưng đối với ứng dụng của tôi, việc có một Keychain riêng biệt cho mỗi người dùng, sẽ có tác dụng phụ bất ngờ.

Nó sẽ yêu cầu mỗi người dùng đăng nhập riêng.

Trong tvOS 16, chúng tôi có thể duy trì trải nghiệm có một tài khoản duy nhất cho tất cả người dùng trong khi chạy với tư cách là người dùng hiện tại.

Bằng cách sử dụng Keychain API mới để truy cập Keychain độc lập với người dùng.

Bây giờ tôi sẽ đến lớp KeychainController của mình, tôi sử dụng nó để đọc và viết vào Keychain.

Ở đây tôi có thuộc tính baseQuery có các khóa tôi cần để truy cập thông tin đăng nhập cho ứng dụng của mình trong Chuỗi khóa.

Để cập nhật nó để sử dụng Chuỗi khóa độc lập với người dùng mới, tất cả những gì tôi phải làm là thêm một phần tử mới vào từ điển.

Tôi sẽ thêm kSecUseUserIndependentKeychain mới và đặt nó thành true.

Và đó là tất cả những gì tôi cần thay đổi để làm cho ứng dụng chia sẻ thông tin đăng nhập của nó với tất cả người dùng.

Không có gì khác.

Tuy nhiên, điều quan trọng cần lưu ý là tất cả các dữ liệu khác vẫn khác biệt cho mỗi người dùng.

Giống như UserDefaults, mà tôi sẽ sử dụng để ghi nhớ lựa chọn hồ sơ cho mỗi người dùng.

Bây giờ hãy mở lớp ProfileData của tôi.

Tệp này được chia sẻ giữa các dự án iOS và tvOS của tôi.

Trên thực tế, phiên bản iOS của ứng dụng của tôi đã lưu trữ lựa chọn hồ sơ trong UserDefaults, nhưng chỉ khi chạy trên iOS.

Và đó là bởi vì iPhone là thiết bị cá nhân.

Nhưng bây giờ ứng dụng của tôi chạy với tư cách là người dùng hiện tại, Apple TV có thể mang tính cá nhân.

Tôi có thể xóa kiểm tra iOS và mã hoạt động theo cùng một cách trên Apple TV.

Hệ thống sẽ đảm bảo sử dụng đúng UserDefaults cho mỗi người dùng.

Khi tôi chạy phiên bản mới của ứng dụng, nó được khởi chạy dưới dạng người dùng hiện tại, đó là Mei.

Mei đăng nhập và chọn hồ sơ của cô ấy.

Với ứng dụng chạy với tư cách là người dùng hiện tại, nó hoạt động giống như Apple TV, tại thời điểm đó, là một thiết bị cá nhân.

Thiết bị của Mei.

Lựa chọn hồ sơ của Mei được lưu trữ trong UserDefaults của cô ấy.

Khi đến lúc Anne xem, họ chuyển sang người dùng của mình bằng Trung tâm điều khiển.

Hệ thống sẽ đưa ra một giao diện người dùng chuyển đổi, trong khi nó dành thời gian cho quy trình của bạn để hoàn thành bất kỳ tác vụ cuối cùng nào trước khi nó được khởi chạy lại.

tvOS hiện đang khởi chạy lại ứng dụng với tên Anne.

Bây giờ Apple TV là thiết bị của Anne.

Lời nhắc đăng nhập bị bỏ qua, vì thông tin đăng nhập được lưu trữ trong Chuỗi khóa độc lập với người dùng, tất cả người dùng đều có thể truy cập được.

Nhưng Anne chưa có lựa chọn hồ sơ được lưu trữ trong UserDefaults của họ và bộ chọn hồ sơ được hiển thị.

Chọn hồ sơ của Anne, lưu lựa chọn trong UserDefaults của họ.

Được rồi bây giờ, tại thời điểm này Mei và Anne đều đã chọn hồ sơ của họ.

Khi chuyển đổi người dùng, ứng dụng sẽ không hiển thị bất kỳ lời nhắc xen kẽ nào nữa.

Nó sẽ luôn đi thẳng vào nội dung, tự động chọn hồ sơ chính xác cho mỗi người.

Mỗi lần.

Đó là cách, trong tvOS 16, chúng tôi đã giúp việc ghi nhớ hồ sơ của mỗi người dùng dễ dàng hơn nhiều.

Một API mới đơn giản để truy cập Chuỗi khóa độc lập với người dùng, với việc xử lý hệ thống tách biệt dữ liệu của mỗi người dùng.

Bây giờ bạn đã thấy cách ghi nhớ lựa chọn hồ sơ của từng người dùng mà không yêu cầu mọi người đăng nhập riêng, hãy xem lại cách các ứng dụng hoạt động trên Apple TV.

Các ứng dụng không chạy như quyền của người dùng hiện tại sử dụng tài nguyên của Người dùng Mặc định.

Bạn có thể nghĩ về nó như là tài nguyên riêng của Apple TV.

Chuyển đổi người dùng không có ảnh hưởng đến quy trình của ứng dụng.

Đây là những đề xuất của tôi khi bạn muốn cá nhân hóa.

Bảng này hiển thị các khả năng có sẵn tùy thuộc vào tính năng bạn sử dụng trên các ứng dụng tvOS của mình.

Nếu ứng dụng của bạn là một ứng dụng đa phương tiện, hoặc giống như một ứng dụng, hiển thị nội dung được cá nhân hóa thông qua hồ sơ; trong khi có một tài khoản duy nhất được chia sẻ giữa mọi người sử dụng Apple TV, bạn áp dụng Runs làm quyền của Người dùng Hiện tại và sử dụng API Keychain độc lập với người dùng mới.

Nếu, giống như một trò chơi, ứng dụng của bạn là tất cả về tiến trình cá nhân, tất cả những gì bạn phải làm là áp dụng Runs làm quyền của Người dùng Hiện tại, tvOS sẽ xử lý phần còn lại.

Và đối với tất cả các ứng dụng khác, các ứng dụng trình bày cùng một nội dung cho tất cả người dùng - ví dụ như một ứng dụng công thức - bạn không phải làm bất cứ điều gì.

Chỉ cần tạo một dự án ứng dụng tvOS mới trong Xcode.

Để tìm hiểu thêm về việc chạy với tư cách là người dùng hiện tại, hãy xem phiên của chúng tôi từ WWDC 2020.

Chúng tôi tin rằng trải nghiệm trực tiếp đến nội dung được sắp xếp hợp lý là trải nghiệm tốt nhất cho ứng dụng tvOS.

Tôi hy vọng tất cả các tính năng này sẽ giúp bạn triển khai những trải nghiệm màn hình lớn tuyệt vời trong các ứng dụng của mình.

Cảm ơn vì đã xem, và tận hưởng hội nghị.