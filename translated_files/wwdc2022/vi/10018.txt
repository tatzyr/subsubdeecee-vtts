10018

♪ nhạc cụ hip hop ♪

♪

Xin chào, tên tôi là Karen Xing.

Tôi là một kỹ sư trong nhóm Phần mềm Máy ảnh.

Chào mừng bạn đến với "Mang máy ảnh liên tục hỗ trợ ứng dụng macOS của bạn" Để bắt đầu phiên này, tôi sẽ nói về, Máy ảnh liên tục là gì?

Tiếp theo, tôi sẽ thảo luận về cách ứng dụng của bạn có thể xây dựng trải nghiệm lựa chọn máy ảnh tự động với Máy ảnh liên tục.

Và cuối cùng, tôi sẽ xem qua các API mới trong macOS 13 cho Continuity Camera.

Với Continuity Camera, giờ đây bạn có thể sử dụng iPhone làm webcam của mình.

Thiết lập liền mạch; chỉ cần mang iPhone của bạn đến gần máy Mac của bạn.

Và nó hoạt động không dây nên bạn có thể nhanh chóng tham gia cuộc gọi.

iPhone của bạn sẽ xuất hiện trên máy Mac dưới dạng camera ngoài và micrô trong một số điều kiện.

Đầu tiên, bạn phải chạy macOS 13 và iOS 16.

Cả Mac và iPhone phải được đăng nhập vào cùng một ID Apple bằng cách sử dụng xác thực hai yếu tố.

Để kết nối có dây, điện thoại cần được kết nối với Mac qua USB.

Hoặc để kết nối không dây, hai thiết bị cần ở gần nhau và bật cả Bluetooth và Wi-Fi.

Thay vì nói qua nó, hãy để tôi cho bạn thấy ngay Máy ảnh liên tục kỳ diệu trông như thế nào trên các thiết bị.

Ở đây tôi có một chiếc MacBook Pro và iPhone 13 Pro.

Cả hai thiết bị đều được đăng nhập vào cùng một ID Apple.

Điện thoại được đặt trên giá đỡ gắn vào MacBook của tôi.

Tôi sẽ tham gia một cuộc gọi hội nghị truyền hình với đồng nghiệp Eric của tôi hôm nay và chỉ cho bạn cách chúng ta có thể sử dụng Camera liên tục trong Zoom.

Ứng dụng được khởi chạy bằng máy ảnh tích hợp trước, và sau đó một hộp thoại giới thiệu hiển thị mô tả những gì bạn có thể làm với máy ảnh mới.

Hộp thoại xuất hiện một lần sau khi máy Mac của bạn được nâng cấp lên macOS 13 khi bạn mở ứng dụng máy ảnh lần đầu tiên và có một chiếc iPhone đủ điều kiện cho Máy ảnh Liên tục.

Xin chào, Eric!

Eric: Ôi, Karen! Xin chào!

Karen: Sau khi hộp thoại giới thiệu được hiển thị trên hệ thống, Máy ảnh liên tục và các thiết bị micrô sẽ có sẵn trong tất cả các ứng dụng.

Hãy chuyển sang sử dụng máy ảnh này và xem nó trông như thế nào.

Camera liên tục sử dụng hệ thống camera sau trên iPhone, vì vậy bạn sẽ có được chất lượng video tuyệt vời giống như bạn mong đợi từ iPhone.

Và nó hoạt động với cả bốn hướng của điện thoại.

Hướng dọc giúp bạn phóng to trường nhìn hơn so với hướng ngang.

Continuity Camera cũng cho phép bạn làm những việc chưa từng có trước đây với webcam, bao gồm một số hiệu ứng video mới.

Có lẽ bạn đã quen thuộc với các hiệu ứng video Trung tâm Sân khấu và Chân dung được giới thiệu trong iOS 14.5 và macOS 12.3.

Nếu không, tôi thực sự khuyên bạn nên xem phiên "Có gì mới trong Chụp ảnh" từ WWDC 2021 để tìm hiểu thêm về các hiệu ứng video hệ thống và cách tương tác với chúng trong các ứng dụng.

Hãy vào Trung tâm điều khiển và bật hiệu ứng video hệ thống trên Máy ảnh liên tục.

Sân khấu trung tâm giữ bạn trong khung hình khi bạn di chuyển xung quanh trong cảnh.

Chân dung làm mờ hậu cảnh và tự nhiên tập trung vào bạn.

Portrait chỉ được hỗ trợ trên Apple silicon Macs, nhưng với Continuity Camera, nó hiện có sẵn trên tất cả các Intel và Apple silicon Macs.

Studio Light là một hiệu ứng video hệ thống mới có sẵn trên macOS 13.

Nó được hỗ trợ bởi Continuity Camera khi sử dụng iPhone 12 hoặc mới hơn.

Bật cái này khi bạn muốn trông đẹp nhất trên màn hình.

Nó cung cấp một hiệu ứng ánh sáng tuyệt đẹp làm mờ hậu cảnh và chiếu sáng khuôn mặt của bạn.

Studio Light hoàn hảo cho các tình huống ánh sáng khó khăn, như khi bạn ở trước cửa sổ.

Mặc dù tôi đang cho bạn xem từng hiệu ứng video riêng biệt để so sánh rõ ràng, tất cả chúng đều hoạt động tốt với nhau.

Và bất kỳ sự kết hợp nào của các hiệu ứng đều có thể được áp dụng cùng một lúc.

Đây là một tính năng thú vị khác mà tôi thực sự muốn giới thiệu cho bạn về Máy ảnh Liên tục.

Khi bạn muốn làm việc cùng nhau và chia sẻ những gì trên bàn làm việc của mình, bây giờ bạn có thể sử dụng Chế độ xem bàn.

Ứng dụng Desk View đi kèm với macOS 13 và có thể được khởi chạy ngay tại đây trong Trung tâm điều khiển.

Nó hoạt động giống như một thiết lập camera trên cao, mà không cần tất cả các thiết bị phức tạp.

iPhone sẽ chia nguồn cấp dữ liệu máy ảnh Ultra Wide làm hai, khoe bàn làm việc và khuôn mặt của bạn cùng một lúc, vì vậy bạn có thể cộng tác trong một dự án của trường hoặc dạy cho một người bạn một mũi đan.

Nó tận dụng trường nhìn dọc mở rộng của máy ảnh góc Ultra Wide của chúng tôi, áp dụng hiệu chỉnh biến dạng phối cảnh cho các khung hình đã cắt và sau đó xoay các khung hình để tạo Chế độ xem Bàn này.

Bạn có thể sử dụng chức năng cửa sổ chia sẻ có sẵn trong hầu hết các ứng dụng hội nghị truyền hình để chia sẻ nguồn cấp dữ liệu Desk View này, chạy song song với nguồn cấp dữ liệu camera video chính.

Chế độ xem bàn cũng có thể được sử dụng một mình mà không cần phát trực tuyến từ camera chính cùng một lúc.

Nhưng khi bạn phát trực tuyến từ cả Chế độ xem bàn làm việc và máy ảnh chính, chúng tôi khuyên bạn nên bật Sân khấu trung tâm trên máy ảnh chính để có khung hình tốt hơn để chụp khuôn mặt và cơ thể ở đó.

Tính năng này được hỗ trợ khi điện thoại được đặt theo hướng ngang hoặc dọc.

Hướng dọc cung cấp tính linh hoạt nhất, vì có trường nhìn dọc lớn hơn.

Ngoài ra còn có một API camera Desk View để cung cấp tích hợp tùy chỉnh phù hợp với ứng dụng của bạn.

Tôi sẽ nói về API trong giây lát.

Trong cuộc gọi hội nghị truyền hình trên máy Mac của bạn, chúng tôi muốn bạn tập trung vào phiên nhưng chúng tôi cũng muốn đảm bảo rằng bạn không bỏ lỡ bất cứ điều gì quan trọng.

Khi Continuity Camera được sử dụng, tất cả các thông báo trên điện thoại của bạn sẽ bị tắt tiếng và các thông báo cuộc gọi quan trọng sẽ được chuyển tiếp trên máy Mac của bạn.

Tạm biệt, Eric!

Eric: Tạm biệt, Karen!

Karen: Chúng tôi vừa nói về tất cả những trải nghiệm tuyệt vời có sẵn cho người dùng mà không cần viết một dòng mã mới nào trong ứng dụng của bạn.

Nhưng với một số áp dụng các API mới, bạn có thể làm cho trải nghiệm Máy ảnh Liên tục trở nên kỳ diệu và bóng bẩy hơn trong ứng dụng của mình.

Bây giờ hầu hết người dùng sẽ nhận được ít nhất hai thiết bị máy ảnh trên Mac, chúng tôi đã suy nghĩ nhiều hơn về cách quản lý máy ảnh.

Trước macOS 13, khi một thiết bị được rút phích cắm hoặc máy ảnh tốt hơn có sẵn trên hệ thống, một bước lựa chọn thủ công thường được yêu cầu trong các ứng dụng.

Chúng tôi muốn mang đến cho khách hàng trải nghiệm kỳ diệu bằng cách tự động chuyển đổi máy ảnh trong các ứng dụng.

Chúng tôi đã thêm hai API mới trong khung AVFoundation để giúp bạn xây dựng chức năng này trong ứng dụng của mình: thuộc tính lớp userPreferredCamera và systemPreferredCamera trên AVCaptureDevice.

userPreferredCamera là một thuộc tính đọc/ghi.

Bạn sẽ cần đặt thuộc tính này bất cứ khi nào người dùng chọn máy ảnh trong ứng dụng.

Điều này cho phép lớp AVCaptureDevice tìm hiểu sở thích của người dùng, lưu trữ danh sách máy ảnh cho từng ứng dụng trong quá trình khởi chạy và khởi động lại ứng dụng và sử dụng thông tin đó để đề xuất máy ảnh.

Nó cũng tính đến việc bất kỳ máy ảnh nào được kết nối hay ngắt kết nối.

Thuộc tính này có thể quan sát được giá trị khóa và trả về lựa chọn tốt nhất một cách thông minh dựa trên sở thích của người dùng.

Khi thiết bị ưa thích gần đây nhất bị ngắt kết nối, nó sẽ tự động thay đổi sang máy ảnh có sẵn tiếp theo trong danh sách.

Ngay cả khi không có lịch sử lựa chọn người dùng hoặc không có thiết bị ưa thích nào được kết nối, tài sản sẽ luôn cố gắng trả lại một thiết bị máy ảnh đã sẵn sàng để sử dụng và ưu tiên các máy ảnh đã được phát trực tuyến trước đó.

Nó chỉ trả về số không khi không có máy ảnh trên hệ thống.

systemPreferredCamera là một thuộc tính chỉ đọc.

Nó kết hợp userPreferredCamera cũng như một vài yếu tố khác để đề xuất sự lựa chọn tốt nhất của máy ảnh có trên hệ thống.

Ví dụ, thuộc tính này sẽ trả về một giá trị khác với userPreferredCamera khi Camera liên tục hiển thị báo hiệu rằng nó sẽ được chọn tự động.

Tài sản cũng theo dõi việc đình chỉ thiết bị trong nội bộ để nó ưu tiên các thiết bị không bị treo hơn các thiết bị bị treo.

Điều này rất hữu ích cho việc xây dựng hành vi chuyển đổi tự động để thay đổi sang máy ảnh khác nếu máy ảnh tích hợp bị treo khi đóng nắp MacBook.

Máy ảnh liên tục báo hiệu tự động được chọn khi điện thoại được đặt trên giá đỡ đứng yên theo hướng ngang, màn hình tắt và được kết nối qua USB với máy Mac hoặc trong phạm vi gần của máy Mac.

Trong trường hợp này, ý định của người dùng rõ ràng rằng thiết bị nên được sử dụng làm Máy ảnh Liên tục.

Khi áp dụng systemPreferredCamera API, bạn nên luôn quan sát giá trị khóa thuộc tính này và cập nhật thiết bị đầu vào video của AVCaptureSession cho phù hợp để cung cấp trải nghiệm lựa chọn máy ảnh kỳ diệu.

userPreferredCamera và systemPreferredCamera đã được các ứng dụng của bên thứ nhất chấp nhận.

Với ngày càng nhiều ứng dụng áp dụng các API này, chúng tôi sẽ có thể cung cấp cho khách hàng một phương pháp lựa chọn máy ảnh phổ biến và nhất quán trên các thiết bị Apple.

Hãy để tôi chỉ cho bạn một bản demo để minh họa cách tự động chuyển đổi với Máy ảnh Liên tục trông như thế nào trong FaceTime.

Ở đây trong FaceTime, tôi đang ở chế độ Lựa chọn Máy ảnh Tự động.

Đối với các ứng dụng muốn cung cấp cả hành vi thủ công và tự động, chúng tôi khuyên bạn nên thêm giao diện người dùng mới để bật và tắt chế độ tự động.

FaceTime hiện đang phát trực tuyến từ camera tích hợp.

Khi tôi nhấc điện thoại từ bàn làm việc và đặt nó lên giá đỡ phía sau MacBook...

... FaceTime chuyển sang phát trực tuyến từ Máy ảnh Liên tục một cách liền mạch.

Đó là nơi hệ thống thuộc tính lớp mớiPreferredCamera xuất hiện: giá trị thuộc tính thay đổi thành Continuity Camera khi điện thoại ở vị trí sẵn sàng phát trực tuyến.

Bạn có thể muốn xây dựng ứng dụng của mình theo cách tương tự.

Đây là công thức của tôi về cách triển khai Lựa chọn Máy ảnh Tự động và chế độ lựa chọn thủ công.

Khi Lựa chọn Máy ảnh Tự động được bật, hãy bắt đầu khóa-giá trị quan sát thuộc tính systemPreferredCamera.

Theo dõi systemPreferredCamera bất cứ khi nào nó thay đổi bằng cách cập nhật thiết bị đầu vào phiên của bạn.

Ở chế độ tự động, chúng tôi thực sự khuyên bạn vẫn nên cung cấp các tùy chọn để cho phép người dùng tự chọn máy ảnh.

Khi một máy ảnh khác được chọn, hãy đặt userPreferredCamera thành thiết bị đó, thiết bị này sẽ được phản ánh trong giá trị thuộc tính systemPreferredCamera.

Khi Lựa chọn Máy ảnh Tự động tắt, hãy dừng khóa-giá trị quan sát thuộc tính systemPreferredCamera.

Thay vì làm theo systemPreferredCamera, bạn sẽ cần cập nhật thiết bị đầu vào của phiên với máy ảnh do người dùng chọn ở chế độ thủ công.

Nhưng giống như chế độ tự động, bạn vẫn cần đặt thuộc tính userPreferredCamera mỗi khi người dùng chọn một máy ảnh khác, vì vậy chúng tôi duy trì lịch sử máy ảnh ưa thích của người dùng và đề xuất đúng máy ảnh khi quay lại chế độ Lựa chọn Máy ảnh Tự động.

Để biết các phương pháp hay nhất về cách kết hợp userPreferredCamera và systemPreferredCamera APIs, vui lòng xem ứng dụng mẫu mới, "Mẫu máy ảnh liên tục".

Bên cạnh việc mang lại trải nghiệm webcam kỳ diệu cho Mac, Continuity Camera còn mang đến cho bạn những cơ hội mới để khai thác sức mạnh của các tính năng máy ảnh dành riêng cho iPhone trong ứng dụng Mac của bạn.

Chúng tôi đã thêm một vài API AVCapture trên macOS 13 để giúp các ứng dụng sử dụng tốt hơn các thiết bị Continuity Camera.

Chúng tôi đang mang chất lượng tuyệt vời của ảnh chụp iPhone lên macOS, nhờ Continuity Camera.

Trước hết, chúng tôi hỗ trợ chụp ảnh có độ phân giải cao.

Trước đây, macOS chỉ hỗ trợ chụp ảnh ở độ phân giải video.

Bắt đầu với macOS 13, bạn sẽ có thể chụp ảnh lên đến 12 megapixel với Continuity Camera.

Điều này có thể được kích hoạt bằng cách trước tiên đặt highResolutionCaptureEnabled thành true trên đối tượng AVCapturePhotoOutput trước khi bắt đầu phiên chụp, sau đó đặt thuộc tính highResolutionPhotoEnabled thành true trên đối tượng photoSettings của bạn cho mỗi lần chụp.

Ngoài việc chụp ảnh độ phân giải cao, Continuity Camera hỗ trợ kiểm soát cách ưu tiên chất lượng ảnh so với tốc độ bằng cách trước tiên đặt ưu tiên chất lượng ảnh tối đa trên đối tượng photoOutput, sau đó chọn ưu tiên cho mỗi lần chụp bằng cách đặt thuộc tính photoQualityPrioritization trên đối tượng AVCapturePhotoSettings.

Để tìm hiểu thêm về việc chọn ưu tiên phù hợp cho ứng dụng của bạn, vui lòng xem "Chụp ảnh chất lượng cao bằng định dạng video" trong WWDC2021.

Một tính năng khác liên quan đến ảnh là chụp flash.

Bây giờ bạn có thể đặt flashMode trên đối tượng photoSettings của mình để kiểm soát xem đèn flash nên bật, tắt hay tự động được chọn dựa trên cảnh và điều kiện ánh sáng.

Chúng tôi cũng đang cung cấp AVCaptureMetadataOutput trên macOS để cho phép xử lý siêu dữ liệu theo thời gian được tạo bởi một phiên chụp.

Bây giờ bạn có thể phát trực tuyến các đối tượng siêu dữ liệu khuôn mặt và các đối tượng siêu dữ liệu cơ thể con người từ iPhone.

Hãy xem qua cách thiết lập một phiên để nhận các đối tượng siêu dữ liệu khuôn mặt.

Sau khi thiết lập phiên với đầu vào và đầu ra video thích hợp, bạn sẽ cần tạo AVCaptureMetadataOutput và gọi addOutput để thêm nó vào phiên.

Để nhận siêu dữ liệu khuôn mặt nói riêng, hãy đặt mảng loại đối tượng của bạn trên đầu ra để bao gồm loại đối tượng khuôn mặt.

Đảm bảo rằng các loại siêu dữ liệu được yêu cầu được hỗ trợ bằng cách kiểm tra thuộc tính availableMetadataObjectTypes.

Sau đó thiết lập đại diện để nhận các cuộc gọi lại siêu dữ liệu.

Sau khi phiên bắt đầu chạy, bạn sẽ nhận được các cuộc gọi lại với các đối tượng siêu dữ liệu khuôn mặt được tạo ra trong thời gian thực.

Bên cạnh AVCapturePhotoOutput và AVCaptureMetadataOutput mà chúng ta vừa nói đến, Continuity Camera cũng hỗ trợ đầu ra dữ liệu video, đầu ra tệp phim và AVCaptureVideoPreviewLayer.

Đây là danh sách các định dạng video được Continuity Camera hỗ trợ mà bạn sẽ muốn biết khi tích hợp máy ảnh này vào ứng dụng của mình.

Nó hỗ trợ ba định dạng 16 x 9 - từ 640 x 480 đến 1080p - và một định dạng 4 x 3: 1920 x 1440.

Bạn có thể chọn giữa các định dạng hỗ trợ tối đa 30 khung hình mỗi giây hoặc 60 khung hình mỗi giây, dựa trên nhu cầu.

Một bổ sung lớn khác là thiết bị Desk View API.

Camera Desk View được hiển thị dưới dạng AVCaptureDevice riêng biệt.

Có hai cách bạn có thể tìm thấy thiết bị này.

Đầu tiên là tra cứu AVCaptureDeviceType DeskViewCamera trong phiên khám phá thiết bị.

Ngoài ra, nếu bạn đã biết đối tượng AVCaptureDevice của máy quay video chính, bạn có thể sử dụng thuộc tính companionDeskViewCamera trên thiết bị đó để truy cập thiết bị Desk View.

API này sẽ hữu ích để ghép nối camera chính và thiết bị Desk View khi có nhiều thiết bị Continuity Camera xung quanh.

Khi bạn có đối tượng AVCaptureDevice của máy ảnh Desk View mong muốn, bạn có thể sử dụng nó với đầu ra dữ liệu video AVCapture, đầu ra tệp phim hoặc lớp xem trước video trong phiên chụp giống như bạn có thể với các thiết bị máy ảnh khác.

Thiết bị Desk View hiện hỗ trợ một định dạng phát trực tuyến ở định dạng pixel 420v.

Độ phân giải của định dạng là 1920 x 1440 và tốc độ khung hình tối đa được hỗ trợ là 30 khung hình / giây.

Đây là kết thúc của phiên.

Bạn đã tìm hiểu về Continuity Camera, cách xây dựng một lựa chọn máy ảnh kỳ diệu trên macOS và một số API mới để tích hợp Continuity Camera trong ứng dụng Mac của bạn.

Tôi rất vui khi thấy bạn áp dụng tất cả các API này và có một phần còn lại tuyệt vời của WWDC.

♪