110375

♪ nhạc cụ hip hop ♪

Xin chào, tên tôi là John, và tôi là một kỹ sư trong nhóm Xcode Cloud.

Và tôi là Jo Lynn, một nhà thiết kế trong nhóm Xcode Cloud.

Hôm nay chúng ta sẽ xem xét một số tính năng của Xcode Cloud cực kỳ hữu ích khi bạn sử dụng Xcode Cloud như một phần của nhóm, cho dù đó là nhóm 5 hay 500 người.

Và tôi sẽ chia sẻ một số tính năng khác và các phương pháp hay nhất hoạt động tốt khi bạn sử dụng Xcode Cloud như một phần của nhóm.

Trong phiên của chúng tôi hôm nay, chúng tôi sẽ đi vào chi tiết về một số chủ đề cũng được đề cập trong một số phiên khác.

Nếu bạn muốn tìm hiểu thêm về webhooks và các chủ đề quy trình làm việc nâng cao khác, hãy xem phiên "Tùy chỉnh quy trình làm việc Xcode Cloud nâng cao của bạn".

Trong phiên này, chúng tôi sẽ xem xét cách chúng tôi có thể tích hợp Xcode Cloud vào các công cụ và công nghệ hiện có của bạn mà bạn sử dụng hàng ngày, dễ dàng quản lý các phụ thuộc mã của bạn và giới thiệu các phương pháp hay nhất của Xcode Cloud để giúp bạn thiết lập quy trình làm việc để liên tục xây dựng, kiểm tra và phân phối các

Hãy bắt đầu nào.

Khi nói đến việc tích hợp Xcode Cloud vào các công cụ hiện có của bạn, chúng tôi có một vài lựa chọn.

Webhooks cho phép tích hợp dễ dàng với các công cụ và dịch vụ hỗ trợ chúng.

Bạn có thể kết nối webhook trong App Store Connect bằng cách cho Xcode Cloud biết URL nào để gửi webhook đến và bạn sẽ bắt đầu thấy những webhook đó xuất hiện ngay lập tức.

API của chúng tôi cũng cho phép một lượng lớn khả năng hiển thị vào các bản dựng của bạn, cho phép bạn thực hiện những việc như dễ dàng tạo bảng điều khiển xây dựng, trích xuất các tạo tác xây dựng của bạn hoặc, trong ví dụ của chúng tôi hôm nay, tích hợp thông tin xây dựng vào phần mềm hiện có của bạn.

Chúng tôi đã xây dựng một loạt các tính năng mới cho ứng dụng xe tải thực phẩm của mình, nhưng chúng tôi cũng đã tìm thấy các lỗi mới và bây giờ chúng tôi có một nhóm người làm việc trên ứng dụng cùng nhau, chúng tôi cảm thấy khó hiểu ai đang làm việc trên cái gì.

Để giải quyết vấn đề này, chúng tôi đã quyết định sử dụng trình theo dõi sự cố để theo dõi tất cả công việc đang diễn ra trong ứng dụng của chúng tôi.

Nếu bạn đang sử dụng trình theo dõi sự cố, bạn thường có chế độ xem như thế này.

Một quy trình làm việc phổ biến với trình theo dõi vấn đề là tạo một vé, yêu cầu các nhà thiết kế và nhà phát triển làm việc trên vé đó và cuối cùng, đóng nó sau khi tính năng hoặc lỗi hoàn tất.

Có thông tin xây dựng thực tế được hiển thị trong trình theo dõi vấn đề của chúng tôi sẽ giúp ích rất nhiều trong việc kết nối tất cả các dấu chấm lại với nhau.

Hãy xem chúng ta có thể làm điều đó như thế nào bây giờ.

Kế hoạch của chúng tôi ở đây là tạo ra một dịch vụ dựa trên Swift On Server rất đơn giản sẽ xử lý mọi thứ chúng tôi cần để tích hợp trình theo dõi vấn đề của mình với Xcode Cloud.

Để tăng tốc độ phát triển, chúng tôi sẽ sử dụng khung web Vapor, cho phép chúng tôi tập trung vào việc viết mã xử lý webhook.

Dòng chảy cơ bản sẽ trông giống như thế này.

Một webhook sẽ đến từ Xcode Cloud đến máy chủ của chúng tôi.

Chúng tôi sẽ đọc webhook đó và kiểm tra xem thông báo cam kết được viết bởi người cam kết có một chuỗi nhất định trong đó ánh xạ đến một vấn đề trong trình theo dõi của chúng tôi hay không.

Nếu có, chúng tôi sẽ nhấn Xcode Cloud API để thu thập thêm thông tin về bản dựng.

Sau đó, chúng tôi sẽ xây dựng một nhận xét mà chúng tôi có thể đăng lên trình theo dõi vấn đề của mình có chứa thông tin mà chúng tôi quan tâm.

Sau đó, chúng tôi sẽ gọi một API trên trình theo dõi vấn đề của mình, điều này sẽ lưu thông báo chống lại vấn đề của chúng tôi.

Đầu tiên, chúng ta hãy xem tài liệu Xcode Cloud API.

Tất cả Xcode Cloud API đều nằm trong App Store Connect API.

Nếu chúng tôi đã thiết lập mã thông báo xác thực cho App Store Connect API, chúng tôi đã có mọi thứ chúng tôi cần để truy cập dữ liệu Xcode Cloud của mình.

Mở bộ sưu tập Build Runs, chúng ta có thể thấy một số điểm cuối cho phép chúng ta tương tác với các bản dựng của mình.

Bạn có thể gọi một điểm cuối để tạo một bản dựng, hủy một bản dựng hoặc nhận thêm thông tin về một bản dựng cụ thể.

Ví dụ: nếu bạn muốn xây dựng một bảng điều khiển để hiển thị trạng thái của các bản dựng của mình, điểm cuối Ci_Build_Runs phải là tất cả những gì chúng tôi cần gọi.

Tiếp theo, hãy xem bộ sưu tập Hiện vật trong tài liệu.

Đối với quy trình làm việc của chúng tôi, chúng tôi muốn giữ các tạo tác xây dựng của mình bên ngoài Xcode Cloud và API phải có mọi thứ chúng tôi cần để làm điều đó.

Đầu tiên, chúng ta có thể lấy ID tạo tác từ điểm cuối hành động xây dựng, điểm cuối này sẽ trả về tất cả các tạo tác được tạo ra cho một hành động nhất định.

Sau đó, chúng ta có thể gọi ci_artifact, điều này sẽ cung cấp cho chúng ta URL mà chúng ta cần để tải xuống tạo tác của mình trong thuộc tính downloadUrl.

Hãy bắt đầu bằng cách tải xuống thông số kỹ thuật openAPI từ tài liệu App Store Connect và xem qua những gì chúng tôi cần để tạo ứng dụng khách của mình cho API.

Hãy tạo một thư mục mới nơi chúng ta có thể tạo mã khách hàng của mình.

Tôi sẽ gọi cho xcodecloud-client này.

Bây giờ chúng ta cần tải xuống công cụ dòng lệnh cho trình tạo của chúng ta.

Có rất nhiều cách để làm điều này trên trang web openAPI và đối với phiên của chúng tôi, tôi đã thiết lập nó. Hãy sao chép thông số kỹ thuật openAPI mà chúng tôi vừa nhận được từ app_store_connect_API vào thư mục của chúng tôi.

Tuyệt vời, bây giờ chúng ta có thể gọi trình tạo openAPI và yêu cầu nó tạo một ứng dụng khách nhanh chóng cho API của chúng ta.

Trong khi máy phát điện đang chạy, chúng ta có thể nhanh chóng nói về những gì nó đang làm.

Đặc tả openAPI được tạo thành từ thông tin về tất cả các đường dẫn và mô hình tạo nên API của chúng tôi.

Trình tạo đang đi qua từng đường dẫn API và tạo mã Swift có thể nói chuyện với đường dẫn cụ thể đó, với một đối tượng nhanh được nhập mạnh.

Trong hầu hết các trường hợp, điều này có nghĩa là bạn không phải thực hiện bất kỳ mã hóa hoặc giải mã JSON nào.

Tuyệt vời, trình tạo của chúng tôi đã hoàn thành, vì vậy chúng ta hãy xem nhanh các tệp mà nó đã tạo ra.

Thuận tiện, mã khách hàng là một gói Swift.

Điều này làm cho nó thực sự dễ dàng để đưa vào máy chủ webhook của chúng tôi sẽ cập nhật trình theo dõi vấn đề của chúng tôi.

Bây giờ chúng ta có thể cam kết mã của mình vào một kho lưu trữ git mới và sau đó chúng ta có thể tham chiếu nó dưới dạng một gói Swift.

Bây giờ chúng ta đã có mọi thứ chúng ta cần để nói chuyện với API của mình, hãy thiết lập webhook của chúng ta.

Trong App Store Connect, chúng tôi có thể đăng ký webhook của mình để cho máy chủ của chúng tôi biết mỗi khi bản dựng hoàn tất.

Để làm điều đó, hãy truy cập sản phẩm của bạn trong App Store Connect, chuyển đến cài đặt và điều hướng đến webhooks.

Và tôi sẽ dán URL cho máy chủ của chúng tôi.

Điều này sẽ cho Xcode Cloud biết nơi gửi webhooks.

Với thiết lập móc nối web của chúng tôi, điều duy nhất còn lại cần làm là viết mã để xử lý chúng, vì vậy hãy bắt đầu với điều đó.

Đầu tiên chúng ta phải xác định một cấu trúc phù hợp với các trường mà chúng ta quan tâm từ webhook của mình.

Webhook sẽ chứa thông tin về bản dựng cụ thể đang được thực hiện, cũng như từng hành động đang được thực hiện, vì vậy hãy giữ chúng trong cấu trúc tải trọng webhook của chúng tôi.

Tiếp theo, chúng ta phải tạo mã để Vapor định tuyến chính xác các webhook đến chức năng của chúng ta.

Chúng tôi sẽ xác định một hàm chạy trên yêu cầu đăng bài đến đường dẫn webhook.

Bên trong chức năng này, tất cả những gì chúng ta cần làm để chuyển đổi tải trọng JSON đến thành một đối tượng Swift được nhập mạnh là giải mã nó, vì vậy chúng tôi cũng sẽ thêm mã đó.

Tuyệt vời, bây giờ tất cả những gì chúng ta cần làm là gọi Xcode Cloud API để biết thêm một chút thông tin về bản dựng vừa hoàn thành để chúng ta có thể đưa nó vào trang theo dõi vấn đề của mình.

Tải trọng webhook chứa rất nhiều thông tin về bản dựng vừa chạy và những hành động nào đã thành công hay thất bại.

Chúng ta có thể dừng lại ở đó, nhưng hãy đưa nó lên cấp độ tiếp theo.

Tôi nghĩ sẽ thật tuyệt vời nếu chúng ta cũng bao gồm thông tin về những vấn đề được tìm thấy trong mỗi hành động.

Chúng tôi có thể viết một hàm mở rộng cho CiBuildActionsAPI cung cấp cho chúng tôi khả năng dễ dàng trả lại các vấn đề mà chúng tôi quan tâm cho một hành động cụ thể.

Trong tiện ích mở rộng này, chúng tôi sẽ viết một hàm lấy ID hành động xây dựng làm tham số và trả về tất cả các vấn đề được tìm thấy cho một hành động cụ thể.

Tôi đã có cái này trong dự án của mình, nhưng hãy điền vào phần còn lại của mã của chúng tôi.

Chúng tôi chỉ muốn trình xử lý webhook của chúng tôi chạy nếu việc xây dựng hoàn tất, vì vậy hãy đề phòng điều đó.

Tiếp theo chúng ta có thể bắt đầu làm việc trên chuỗi bình luận của mình.

Tôi nghĩ sẽ thật tuyệt nếu có số bản dựng, hàm băm cam kết, cũng như tác giả trong chuỗi này.

Bây giờ chúng ta hãy xem qua từng hành động và gọi hàm mở rộng của chúng ta để nhận các vấn đề cho mỗi hành động.

Hãy chuyển tất cả những điều này cho trình theo dõi vấn đề của chúng tôi ngay bây giờ.

Với tất cả thông tin này, tôi nghĩ điều này sẽ giúp chúng tôi cập nhật trình theo dõi vấn đề với các bản dựng của mình.

Và chúng ta đã hoàn thành!

Tại thời điểm này, chúng tôi muốn lưu trữ mã máy chủ của mình tại URL mà chúng tôi đã cung cấp cho Xcode Cloud cho các webhooks và chúng tôi sẽ bắt đầu thấy thông tin xây dựng Xcode Cloud trong trình theo dõi vấn đề của mình.

Hãy có một bản tóm tắt nhanh về những gì chúng ta đã học được cho đến nay.

Xcode Cloud có một API tuyệt vời mà bạn có thể sử dụng để tích hợp sâu hơn với quy trình phát triển hiện tại của mình.

Bạn có thể sử dụng API đó cùng với webhooks để kết nối tất cả các dấu chấm với nhau và tích hợp các công cụ và công nghệ hiện có của bạn với Xcode Cloud.

Tiếp theo, đây là Jo để nói về các tính năng khác và các phương pháp hay nhất.

Jo: Cảm ơn, John!

Xcode Cloud được thiết kế để tích hợp với các công cụ và dịch vụ dành cho nhà phát triển Apple mà bạn sử dụng để tạo các ứng dụng và khuôn khổ.

Tuy nhiên, dự án Xcode của bạn có thể yêu cầu các phụ thuộc bổ sung hoặc các công cụ bên ngoài để biên dịch mã của bạn.

Xcode Cloud hoạt động tốt với Swift Package Manager.

Nó hỗ trợ các phụ thuộc gói Swift mà không yêu cầu bất kỳ cấu hình bổ sung nào, nếu kho lưu trữ của gói có thể truy cập công khai.

Bạn cũng có thể làm cho Xcode Cloud hoạt động với các trình quản lý phụ thuộc của bên thứ ba như Cocoapods và Carthage, nhưng bạn sẽ phải làm thêm một chút công việc bằng cách sử dụng các tập lệnh xây dựng tùy chỉnh.

Bạn có thể tham khảo tài liệu Xcode để được hướng dẫn về cách cung cấp các phụ thuộc cho Xcode Cloud.

Khi chúng tôi đã thêm gói Swift của mình và đẩy các thay đổi để bắt đầu quy trình làm việc, chúng tôi có thể chuyển đến tab đám mây của Trình điều hướng báo cáo và xem trạng thái của bản dựng mới nhất của chúng tôi.

Chọn Nhật ký để xem nhật ký xây dựng chi tiết.

Chúng ta sẽ thấy rằng Xcode Cloud đã tự động giải quyết các phụ thuộc một cách kỳ diệu.

Sau khi Xcode Cloud đã hoàn thành thành công bản dựng đầu tiên, bạn nên lên kế hoạch cho các bước tiếp theo để tinh chỉnh thực hành tích hợp và phân phối liên tục của mình để đảm bảo rằng ứng dụng hoặc khuôn khổ của bạn luôn ở trạng thái có thể gửi được.

Trong phần này, tôi sẽ nói về cách bạn có thể sử dụng Xcode Cloud với SwiftLint để phân tích mã tĩnh, cách hạn chế chỉnh sửa quy trình làm việc của bạn và giá trị của việc định cấu hình nhiều điều kiện bắt đầu.

SwiftLint là một công cụ linter mã nguồn mở thực thi các quy tắc và quy ước hướng dẫn phong cách thường được cộng đồng Swift chấp nhận.

Nó thực hiện phân tích mã tĩnh để cải thiện chất lượng mã của bạn và ngăn chặn các hành vi xấu.

Chúng tôi nhận thấy rằng SwiftLint là một cách tuyệt vời để giữ cho cơ sở mã của nhóm bạn nhất quán, đặc biệt là khi làm việc với các nhóm lớn hơn.

Những gì chúng tôi sẽ chỉ ra bây giờ là cách tích hợp SwiftLint với Xcode Cloud bằng cách sử dụng tập lệnh xây dựng tùy chỉnh.

Chúng tôi muốn Xcode Cloud chạy công cụ SwiftLint sau khi nó sao chép mã nguồn của chúng tôi từ kho lưu trữ chính của nhóm.

Trong trình điều hướng Dự án, tôi đã thêm tập lệnh post_clone vào thư mục ci_scripts vào dự án Food Truck của mình.

Môi trường xây dựng Xcode Cloud bao gồm Homebrew và đó là những gì chúng tôi đang sử dụng ở đây để cài đặt SwiftLint.

Trên dòng này, chúng tôi đang thực hiện SwiftLint.

Một điều cần nhớ là tập lệnh thực thi trong thư mục ci_scripts, vì vậy chúng tôi phải yêu cầu SwiftLint chạy trong biến môi trường ci_workspace, biến này trỏ đến kho lưu trữ của chúng tôi.

Hãy kiểm tra kết quả phân tích mã.

Có vẻ như SwiftLint đã tìm thấy một loạt các vi phạm, 15 trong số đó nghiêm trọng.

Vì đây là lần đầu tiên chúng tôi tích hợp các công cụ của mình, tôi sẽ tạm thời hủy kích hoạt quy trình làm việc này để chúng tôi có thể thảo luận với phần còn lại trong nhóm trước, đưa ra thỏa thuận về phong cách và quy ước mã hóa, sau đó quyết định với tư cách là một nhóm những vấn đề mà chúng tôi muốn khắc phục.

Bạn có thể hủy kích hoạt quy trình làm việc trong Xcode từ menu Quản lý quy trình làm việc.

Làm như vậy sẽ ngăn các điều kiện bắt đầu hoạt động và chỉ có thể bắt đầu xây dựng thủ công.

Bây giờ quy trình phân tích mã tĩnh của chúng tôi đã bị vô hiệu hóa, chúng tôi có thể tập trung vào việc khắc phục các sự cố mà chúng tôi muốn khắc phục.

Sau đó chúng ta có thể quay lại và kích hoạt quy trình làm việc này.

Nhóm của chúng tôi đã phát triển nhanh chóng và chúng tôi muốn đưa ra những lựa chọn có ý thức về cấu hình quy trình làm việc.

Bởi vì tôi chịu trách nhiệm duy trì và quản lý tất cả quy trình làm việc của nhóm chúng tôi, tôi không muốn các thành viên trong nhóm thực hiện các thay đổi không chủ ý đối với quy trình làm việc.

Điều đó mất rất nhiều thời gian để hoàn tác.

Để ngăn chặn những thay đổi không chủ ý, bạn có thể hạn chế ai có thể chỉnh sửa quy trình làm việc của mình.

Chọn quy trình làm việc, sau đó chọn Hạn chế Chỉnh sửa từ trình đơn ngữ cảnh.

Bất kỳ ai trong nhóm đều có thể sử dụng hoặc chạy quy trình làm việc này, nhưng chỉ quản trị viên, chủ tài khoản và người quản lý ứng dụng mới có thể thực thi một hạn chế, điều này khiến nó chỉ họ mới có thể chỉnh sửa được.

Một quy trình làm việc trong đó việc chỉnh sửa bị hạn chế sẽ có biểu tượng 'chìa khóa'.

Điều này có nghĩa là nó đã bị khóa và chỉ có thể được chỉnh sửa bởi bạn và những người dùng quản trị khác.

Thay vào đó, nếu bạn thấy biểu tượng 'khóa', điều này có nghĩa là nó đã bị khóa bởi quản trị viên và bạn không thể chỉnh sửa.

Tính năng này giúp bạn dễ dàng quản lý quyền truy cập cho các quy trình làm việc phức tạp, đặc biệt nếu bạn là thành viên của một nhóm lớn.

Chúng tôi vừa học được cách tạm dừng hoặc khóa quy trình làm việc của mình dễ dàng như thế nào.

Bây giờ hãy nói về quản lý và bảo trì quy trình làm việc.

Tôi muốn chạy các bài kiểm tra tương tự và lưu trữ các hành động bất cứ khi nào tôi thực hiện yêu cầu kéo hoặc khi tôi hợp nhất chi nhánh của mình.

Cách tốt nhất để làm như vậy là thông qua nhiều điều kiện bắt đầu.

Điều này cải thiện việc duy trì quy trình làm việc vì nó làm giảm số lượng quy trình làm việc mà bạn sẽ cần tạo và quản lý.

Để minh họa, trong ví dụ này, tôi muốn khởi động một bản dựng với các điều kiện sau: nếu có những thay đổi trong nhánh chính hoặc nhánh phát hành, hoặc nếu có một bản dựng theo lịch trình cho nhánh chính, thì hãy chạy cùng một bộ lưu trữ và hành động kiểm tra cũng như triển khai cho TestFlight để kiểm tra nội bộ.

Thay vì tạo 3 quy trình làm việc, sau đó quản lý chúng và giữ chúng đồng bộ, tôi sẽ tạo một quy trình làm việc duy nhất chỉ định tất cả các điều kiện bắt đầu trong một lần.

Điều này cải thiện khả năng quản lý, đặc biệt là khi nhóm có nhiều quy trình làm việc để duy trì.

Cấu hình các điều kiện bắt đầu trong Xcode thật dễ dàng.

Từ trình chỉnh sửa quy trình làm việc, chọn loại điều kiện bắt đầu từ menu nút +.

Xcode Cloud trong App Store Connect cung cấp trải nghiệm dựa trên web đầy đủ tính năng.

Mọi thứ tôi vừa làm trong Xcode để định cấu hình quy trình làm việc của chúng tôi, từ việc hủy kích hoạt nó và khóa nó, đến thiết lập nhiều điều kiện bắt đầu, cũng có sẵn từ AppStoreConnect.

Xcode Cloud là một dịch vụ tích hợp và phân phối mạnh mẽ, liên tục được tích hợp ngay trong Xcode giúp các nhóm phát triển ở mọi quy mô và có thể dễ dàng tích hợp với các công cụ và quy trình hiện có của bạn để giúp bạn cung cấp các ứng dụng chất lượng cao cho người dùng của mình.

Đối với những người tham gia Xcode Cloud beta, chúng tôi thực sự đánh giá cao phản hồi của bạn và mong muốn được nghe thêm.

Chúng tôi hy vọng những tính năng này có thể giúp bạn tinh chỉnh thực hành tích hợp và phân phối liên tục của nhóm mình.

Cảm ơn bạn đã xem, và chúc bạn có một WWDC tuyệt vời!

♪ nhạc cụ hip hop ♪