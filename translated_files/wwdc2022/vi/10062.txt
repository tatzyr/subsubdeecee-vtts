10062

♪ Nhạc hip-hop nhạc cụ êm dịu ♪

♪

Xin chào và chào mừng đến với phiên "Gặp gỡ có thể chuyển nhượng."

Tên tôi là Julia. Tôi là một kỹ sư SwiftUI và tôi rất vui mừng được giới thiệu Transferable, một cách khai báo để hỗ trợ kéo và thả, sao chép/dán và các chức năng khác trong ứng dụng của bạn.

Ngoài SwiftUI và phát triển các ứng dụng cho Mac, tôi cũng quan tâm đến câu chuyện về phụ nữ trong khoa học máy tính.

Tôi nghĩ điều quan trọng là chúng ta phải biết những anh hùng của mình.

Vì vậy, tôi quyết định tạo một ứng dụng danh mục nơi tôi có thể xem, thêm và chỉnh sửa danh sách hồ sơ của các nhà phát minh, kỹ sư và nhà khoa học nữ.

Tôi muốn ứng dụng này hỗ trợ liên tục kéo và thả chân dung của các nhà khoa học đến và đi từ ứng dụng, có thể sử dụng nội dung khay nhớ tạm để dán các sự kiện thú vị.

Và lần đầu tiên, ứng dụng của tôi có thể hỗ trợ chia sẻ trên watchOS!

Người dùng tiềm năng của tôi nói rằng họ rất muốn có thể chia sẻ hồ sơ cá nhân từ đồng hồ của họ.

Ngoài ra, thông qua SwiftUI, việc chia sẻ hiện có sẵn trên iOS và Mac, cũng có thiết kế hoàn toàn mới này cho ShareSheet trong năm nay.

Dưới mui xe, việc bật tất cả các tính năng này yêu cầu các mô hình mà chúng tôi đã phải hỗ trợ được gửi đến người nhận bên trong ứng dụng của chúng tôi hoặc thậm chí trong các ứng dụng khác.

Cấu trúc hồ sơ chứa tất cả thông tin mà chúng ta có về một tính cách duy nhất.

Tất cả các hồ sơ được đóng gói trong một kho lưu trữ có thể được chia sẻ giữa bạn bè.

Chúng tôi lưu trữ những sự thật thú vị về tính cách theo chuỗi và thậm chí có thể đính kèm video.

Và có một cách dễ dàng mới tuyệt vời để làm cho tất cả các loại mô hình này được chia sẻ.

Gặp gỡ có thể chuyển nhượng!

Đây là cách khai báo Swift-first để mô tả cách các mô hình của bạn có thể được tuần tự hóa và hủy nối tiếp để chia sẻ và truyền dữ liệu.

Hôm nay, chúng ta sẽ nói về Transferable là gì và những gì đang diễn ra đằng sau hậu trường khi chúng ta sử dụng nó; làm thế nào để phù hợp với các loại tùy chỉnh; và cuối cùng, tôi sẽ chia sẻ một số mẹo và thủ thuật nâng cao có thể giúp tùy chỉnh Transferable để thực hiện chính xác những gì bạn cần.

Hãy bắt đầu nào!

Giả sử có hai ứng dụng đang chạy và người dùng muốn chuyển một số thông tin từ ứng dụng này sang ứng dụng khác thông qua sao chép/dán, ShareSheet, chỉ cần kéo hoặc sử dụng một số tính năng ứng dụng khác.

Khi bạn gửi thứ gì đó giữa hai ứng dụng khác nhau, có tất cả dữ liệu nhị phân này đi qua.

Một phần quan trọng của việc gửi dữ liệu này là xác định nó tương ứng với cái gì.

Nó có thể là văn bản, video, hồ sơ nữ kỹ sư yêu thích của tôi hoặc toàn bộ kho lưu trữ.

Và có UTType mô tả dữ liệu dùng để làm gì.

Chúng ta hãy xem xét kỹ hơn cách các ứng dụng tạo ra dữ liệu nhị phân này.

Tất cả các loại có thể được chia sẻ với các ứng dụng khác, hoặc thậm chí trong một ứng dụng duy nhất, phải cung cấp hai phần thông tin: cách chuyển đổi chúng sang và từ dữ liệu nhị phân và loại nội dung tương ứng với cấu trúc của dữ liệu nhị phân và cho người nhận biết những gì họ thực sự nhận được.

Loại nội dung - còn được gọi là số nhận dạng loại thống nhất - là một công nghệ dành riêng cho Apple mô tả các số nhận dạng cho các cấu trúc nhị phân khác nhau cũng như các khái niệm trừu tượng.

Các số nhận dạng tạo thành một cây và chúng tôi cũng có thể xác định các số nhận dạng tùy chỉnh.

Ví dụ, một cho cấu trúc nhị phân được sử dụng bởi hồ sơ của chúng tôi.

Để khai báo một mã định danh tùy chỉnh, trước tiên, hãy thêm khai báo của nó vào tệp Info.plist.

Nó cũng là một ý tưởng tốt để thêm một phần mở rộng tệp.

Nếu dữ liệu được lưu trên đĩa, hệ thống sẽ biết rằng ứng dụng của bạn có thể mở tệp đó.

Thứ hai, khai báo nó bằng mã.

Để tìm hiểu thêm về các loại nội dung, tôi mời bạn xem một video: "Số nhận dạng loại đồng phục - Giới thiệu lại."

Cá nhân tôi thích nó, và nó đưa ra một ý tưởng rõ ràng về số nhận dạng loại thống nhất là gì và cách sử dụng chúng.

Tin tốt là nhiều loại tiêu chuẩn đã phù hợp với Transferable; ví dụ: chuỗi, dữ liệu, URL, chuỗi được gán, hình ảnh.

Bạn chỉ cần một vài dòng mã để dán các sự kiện thú vị vào hồ sơ với giao diện nút dán SwiftUI mới, hỗ trợ kéo hình ảnh từ chế độ xem hoặc nhận hình ảnh bị rơi từ Finder hoặc các ứng dụng khác.

Sử dụng br và ShareLink mới, giờ đây chúng ta có thể triển khai chia sẻ trải nghiệm từ đồng hồ.

Chúng tôi đã đề cập đến những điều cơ bản, và bây giờ bạn có ý tưởng về cách sử dụng Transferable và nó là gì.

Hãy xem cách thêm sự phù hợp có thể chuyển nhượng vào các mô hình trong ứng dụng của chúng tôi.

Như tôi đã đề cập trước đó, có bốn loại mô hình trong ứng dụng của chúng tôi sẽ được chia sẻ.

Một trong số chúng - chuỗi - đã phù hợp với Chuyển nhượng; chúng ta không cần phải làm gì thêm nữa.

Nhưng còn hồ sơ duy nhất, ProfilesArchive và video mà tôi cũng muốn chia sẻ thì sao?

Để phù hợp với một loại có thể chuyển nhượng, chỉ có một thuộc tính để thực hiện: TransferRepresentation.

Nó mô tả cách mô hình sẽ được chuyển giao.

Có ba đại diện quan trọng cần lưu ý: CodableRepresentation, DataRepresentation, và FileRepresentation.

Chúng ta sẽ nói về mỗi người trong số họ.

Nhưng trước tiên, hãy đáp ứng mô hình trung tâm của chúng tôi, Cấu trúc hồ sơ.

Nó có một id, một cái tên, một tiểu sử, có thể một số sự thật thú vị, một bức chân dung và một video.

Nó đã phù hợp với Codable.

Do đó, chúng tôi có thể bao gồm CodableRepresentation trong sự phù hợp có thể chuyển nhượng của chúng tôi.

Biểu diễn có thể mã hóa sử dụng bộ mã hóa để chuyển đổi hồ sơ thành dữ liệu nhị phân và bộ giải mã để chuyển đổi lại.

Theo mặc định, nó sử dụng JSON, nhưng bạn cũng có thể cung cấp cặp mã hóa/giải mã của riêng mình.

Để tìm hiểu thêm về giao thức Codable và cách thức hoạt động của bộ mã hóa và bộ giải mã, tôi mời bạn xem phiên WWDC nơi giao thức này lần đầu tiên được giới thiệu: "Dữ liệu bạn có thể tin tưởng."

Quay lại hồ sơ của chúng tôi.

Điều duy nhất Codable yêu cầu là biết loại nội dung mong muốn.

Vì đây sẽ là một định dạng tùy chỉnh, chúng tôi sẽ sử dụng mã định danh loại thống nhất được khai báo tùy chỉnh.

Sau khi thêm loại nội dung hồ sơ, chúng tôi đã sẵn sàng.

Hồ sơ bây giờ phù hợp với Chuyển nhượng!

Bây giờ, chúng ta hãy xem xét một trường hợp khác: ProfilesArchive.

Nó đã hỗ trợ chuyển đổi sang dữ liệu CSV.

Tôi có thể xuất danh sách hồ sơ phụ nữ trong tệp CSV và sau đó chia sẻ với bạn bè hoặc nhập nó trên một máy tính khác.

Kho lưu trữ có thể được chuyển đổi sang và từ dữ liệu, và điều đó có nghĩa là chúng ta có thể sử dụng DataRepresentation.

Nếu chúng ta nhìn vào bên trong, chúng ta sẽ thấy rằng DataRepresentation sử dụng các hàm chuyển đổi để trực tiếp tạo biểu diễn nhị phân và tái tạo lại giá trị cho người nhận.

Đây là cách dễ dàng để phù hợp với Transferable bằng cách sử dụng DataRepresentation.

Tất cả những gì cần làm là gọi hai chức năng mà chúng ta đã có: trình khởi tạo và trình chuyển đổi sang CSV.

Nếu một hồ sơ cá nhân có một video đính kèm, tôi cũng muốn có thể kéo hoặc chia sẻ nó.

Nhưng video có thể lớn; Tôi không muốn tải nó vào bộ nhớ.

Đây là nơi FileRepresentation xuất hiện.

Và một lần nữa, nếu chúng ta vén bức màn lên, chúng ta sẽ thấy rằng FileRepresentation chuyển URL được cung cấp cho người nhận và sử dụng nó để tái tạo lại mục Có thể chuyển cho họ.

FileRepresentation cho phép chúng tôi chia sẻ các mục được hỗ trợ bởi một biểu diễn nhị phân được ghi vào đĩa: tệp.

Hãy tóm tắt.

Nếu bạn chỉ muốn chọn một biểu diễn duy nhất cho một trường hợp sử dụng đơn giản, trước tiên hãy kiểm tra xem mô hình có phù hợp Codable và không có bất kỳ yêu cầu định dạng nhị phân cụ thể nào hay không.

Sử dụng CodableRepresentation nếu đúng như vậy.

Nếu không, hãy kiểm tra xem nó được lưu trữ trong bộ nhớ hay trên đĩa.

DataRepresentation hoạt động tốt nhất cho cái trước và FileRepresetnation cho cái sau.

Có thể chuyển nhượng có nghĩa là bao gồm không chỉ các trường hợp sử dụng đơn giản, mà còn cả những trường hợp phức tạp.

Và hầu hết thời gian, chỉ với một vài dòng mã.

Hãy tự mình xem nó!

Trước đây, chúng tôi đã thêm sự phù hợp có thể chuyển nhượng vào hồ sơ, nhưng hãy đi xa hơn.

Khi hồ sơ được sao chép vào bảng dán và dán vào bất kỳ trường văn bản nào, tôi muốn dán tên của hồ sơ.

Điều này có nghĩa là chúng ta cần thêm một đại diện khác.

ProxyRepresentation cho phép các loại có thể chuyển nhượng khác đại diện cho mô hình của chúng tôi.

Một dòng và Hồ sơ có thể được dán dưới dạng văn bản.

Lưu ý rằng tôi đã thêm ProxyRepresentation sau Codable; thứ tự rất quan trọng.

Người nhận sẽ sử dụng đại diện đầu tiên với loại nội dung mà họ hỗ trợ.

Nếu người nhận biết về Hồ sơ loại nội dung tùy chỉnh của chúng tôi, họ nên sử dụng nó.

Nếu không, nhưng họ hỗ trợ văn bản, hãy để họ sử dụng ProxyRepresentation thay thế.

Bây giờ, Hồ sơ hỗ trợ cả chuyển đổi bộ mã hóa/giải mã và chuyển đổi thành văn bản.

ProxyRepresentation trong trường hợp này mô tả chỉ xuất sang văn bản, nhưng không xây dựng lại hồ sơ từ nó.

Bất kỳ đại diện nào cũng có thể mô tả cả hai chuyển đổi, hoặc chỉ một.

Bây giờ, khi chúng ta biết về ProxyRepresentations, chúng ta có thực sự cần FileRepresentation cho video không?

Chúng ta có thể có proxy với một URL.

Sự khác biệt là tinh tế.

FileRepresentation nhằm mục đích làm việc với các URL được ghi vào đĩa và đảm bảo quyền truy cập của người nhận vào tệp này hoặc bản sao của nó bằng cách cấp phần mở rộng hộp cát tạm thời.

ProxyRepresentation xử lý các URL giống như bất kỳ mục Chuyển nhượng nào khác, như chuỗi.

Nó không có bất kỳ khả năng bổ sung nào mà chúng tôi cần cho các tệp.

Nó có nghĩa là chúng ta có thể có cả hai.

Cái đầu tiên, FileRepresentation, cho phép người nhận truy cập tệp phim với nội dung của nó.

Cái thứ hai sẽ hoạt động khi tôi dán video đã sao chép vào trường văn bản.

Vì vậy, URL được xử lý rất khác nhau bởi các biểu diễn tệp và proxy.

Trong trường hợp đầu tiên, tải trọng thực tế là tài sản trên đĩa và trong trường hợp thứ hai, tải trọng là chính cấu trúc URL có thể trỏ đến một trang web từ xa.

Một mô hình khác mà tôi muốn nâng cấp là ProfilesArchive.

Có những trường hợp khi nó không hỗ trợ chuyển đổi sang CSV và tôi muốn phản ánh điều đó trong mã.

Hãy xem nào.

Chúng tôi thêm một thuộc tính Boolean cho chúng tôi biết liệu chúng tôi có thể xuất sang CSV và các hàm chuyển đổi đến và đi từ dữ liệu hay không.

Để thể hiện ý tưởng này bằng mã, chúng ta có thể sử dụng .exportingCondition.

Nếu kho lưu trữ đã cho không hỗ trợ CSV, nó sẽ không được xuất ở định dạng này.

Với API này, bạn thậm chí có thể xây dựng TransferRepresentation tùy chỉnh, giống như Lượt xem tùy chỉnh trong SwiftUI.

Yêu cầu duy nhất là cung cấp thuộc tính cơ thể nơi bạn có thể có các biểu diễn khác được định cấu hình theo cách bạn cần.

Nó rất hữu ích nếu bạn muốn sử dụng lại sự kết hợp của các đại diện hoặc bạn có một số đại diện dữ liệu riêng tư mà bạn không muốn phơi bày công khai.

Transferable đã giúp tôi nhanh chóng xây dựng ứng dụng này với tất cả các chức năng mà tôi muốn có.

Tôi hy vọng nó sẽ giúp bạn xây dựng các ứng dụng giàu tính năng trong thời gian ngắn hơn bao giờ hết.

Cảm ơn bạn đã tham gia cùng tôi trong phiên này và tiếp tục xây dựng các ứng dụng tuyệt vời!

♪