10109

♪ Nhạc hip-hop nhạc cụ êm dịu ♪

♪

Xin chào, tên tôi là Johnathan.

Các nhà phát triển macOS gửi phần mềm đến dịch vụ công chứng để giúp bảo vệ khách hàng của họ khỏi phần mềm độc hại.

Năm ngoái, chúng tôi đã giới thiệu một cách nhanh hơn và đơn giản hơn để gửi các ứng dụng để công chứng với công cụ công chứng CLI hoặc giao diện dòng lệnh.

Năm nay, chúng tôi rất vui mừng được tiếp tục bảo vệ hiệu suất và tính linh hoạt với một số cải tiến lớn cho các tương tác của bạn với dịch vụ công chứng.

Trong phiên này, chúng ta sẽ nói về ba chủ đề chính.

Đầu tiên, chúng ta sẽ trải qua các thời hạn quan trọng cho việc di chuyển từ sử dụng altool để công chứng sang sử dụng công cụ công chứng.

Tiếp theo, chúng ta sẽ thảo luận về những cải tiến đối với tích hợp Xcode với Xcode 14 sắp tới, mang lại tốc độ gửi của công cụ công chứng cho Xcode.

Và cuối cùng, chúng ta sẽ nói về một cách mới linh hoạt để tương tác với dịch vụ công chứng, REST API, cho phép bạn mở rộng các địa điểm bạn có thể tải lên, kiểm tra trạng thái và xem xét các bài gửi.

Năm ngoái chúng tôi đã giới thiệu công cụ công chứng, một sự thay thế cho altool cho công chứng.

Sau đó trong cuộc nói chuyện này, tôi sẽ thảo luận về việc Xcode chuyển sang phần phụ trợ cập nhật của chúng tôi với Xcode 14.

Với các đường dẫn di chuyển được áp dụng để công chứng thông qua altool và Xcode 13, chúng tôi thông báo ngày hoàng hôn để công chứng với các phương pháp cũ hơn này vào mùa thu năm 2023.

Để được trợ giúp chuyển từ altool sang notarytool, vui lòng tham khảo bài thuyết trình năm ngoái "Công chứng nhanh hơn và đơn giản hơn cho các ứng dụng Mac."

Để làm nổi bật một số chi tiết cụ thể, công chứng viên CLI sẽ tiếp tục hoạt động sau thời hạn mùa thu năm 2023, bao gồm cả thời hạn đi kèm trong Xcode 13.

Tuy nhiên, như mọi khi, chúng tôi khuyến khích bạn cập nhật để nhận được những cải tiến và bản sửa lỗi mới nhất.

Việc tải lên dịch vụ công chứng bằng giao diện người dùng Xcode 13 sẽ ngừng hoạt động sau thời hạn đó.

Hãy theo dõi để nghe về một số cải tiến hiệu suất trong Xcode 14, nhưng phần lớn bạn có thể mong đợi quy trình làm việc của mình không thay đổi.

Cuối cùng, công chứng với tất cả các hình thức altool sẽ ngừng hoạt động vào mùa thu năm 2023.

Một lần nữa, vui lòng tham khảo bài thuyết trình WWDC năm ngoái để biết chi tiết về việc di chuyển sang công cụ công chứng.

Tiếp theo, chúng ta sẽ đề cập đến những thay đổi đối với công chứng trong Xcode 14.

Chúng tôi đã di chuyển hỗ trợ công chứng được tích hợp vào Xcode để sử dụng phần phụ trợ đáng tin cậy giống như CLI công chứng mà chúng tôi đã giới thiệu vào năm ngoái.

Bởi vì điều này, chúng tôi rất vui khi mang lại mức tăng hiệu suất gấp khoảng 4 lần mà chúng tôi đã công bố vào năm ngoái cho công cụ công chứng cho Xcode 14.

Phần tốt nhất là, bên cạnh việc cập nhật, bạn không cần phải thay đổi cài đặt dự án hoặc quy trình làm việc của mình để nhận được sự tăng hiệu suất này.

Đối với chủ đề cuối cùng của bài thuyết trình này, chúng tôi vui mừng thông báo một dịch vụ mới, API REST cho công chứng viên.

Dịch vụ mới này cho phép bạn tương tác linh hoạt hơn với dịch vụ công chứng ở nhiều nơi hơn.

Để xem xét một số khái niệm quan trọng, API mới này nhằm mục đích cho phép giao diện linh hoạt hơn với dịch vụ công chứng.

Là một dịch vụ web dựa trên JSON, việc tích hợp nên khá đơn giản trong hầu hết các ngôn ngữ.

API này cho phép bạn tải lên các bài gửi từ bất kỳ nơi nào có kết nối internet, bao gồm các máy chủ tích hợp liên tục - những nơi mà bạn có thể không chạy macOS ngày hôm nay.

Ngoài ra, các tương tác khác với dịch vụ công chứng cũng được hỗ trợ trong API này, chẳng hạn như truy xuất lịch sử gửi của bạn hoặc chi tiết gửi trước đây.

Mục tiêu của chúng tôi với việc giới thiệu REST API là hỗ trợ gửi phần mềm để công chứng từ nhiều nền tảng hơn và cho phép tương tác dễ dàng hơn với công chứng viên trong các hệ thống tự động.

Điều này bổ sung cho các phương pháp gửi hiện tại, Xcode và notarytool, nơi chúng không thể chạy ngày nay, chẳng hạn như tích hợp liên tục dựa trên Linux.

Ví dụ, hãy tưởng tượng bạn muốn quy trình triển khai của mình gửi đơn đăng ký của bạn đến công chứng viên trước khi phân phối.

Với API mới này và một số tập lệnh cơ bản, bạn có thể dễ dàng tự động hóa quy trình.

Trước khi tôi đi sâu vào, một chủ đề quan trọng là xác thực.

Bạn có thể xác thực với API bằng cách sử dụng JSON Web Tokens, hoặc JWTs, giống như các API Kết nối App Store khác.

Để biết thêm chi tiết về xác thực hoặc mã tôi sắp hiển thị, vui lòng truy cập tài liệu REST API được liên kết bên dưới.

Trong các đoạn mã này, tôi sẽ giả sử bạn có một JWT hợp lệ được chuyển vào các hàm dưới dạng biến mã thông báo.

Hãy xem qua một ví dụ về việc gửi tệp cho công chứng viên bằng Python.

Luồng cơ bản tương tự này được áp dụng trong các ngôn ngữ lập trình khác.

Có hai bước chính để tải tệp lên công chứng viên.

Bước đầu tiên là thông báo cho công chứng viên rằng bạn muốn tải lên một tệp.

Bao gồm trong đây là một số thông tin cơ bản về tệp như tên và SHA-256.

Phản hồi chứa thông tin cần thiết để tải lên tệp và ID để theo dõi bài gửi của bạn thông qua đường ống của chúng tôi.

Bước thứ hai thực sự tải lên tệp để công chứng thông qua Amazon S3.

Bạn sẽ cần lấy S3 SDK yêu thích của mình.

Đối với ví dụ này, tôi sẽ sử dụng thư viện boto3.

Ở đây chúng tôi sử dụng thông tin đăng nhập tạm thời được trả về trong cuộc gọi trước đó để xác thực và tạo khách hàng.

Sau đó, chúng tôi sử dụng ứng dụng khách để tải tệp lên vùng lưu trữ và đối tượng được chỉ định trong phản hồi của bước đầu tiên.

Sau khi tải lên, việc gửi sẽ tiến hành thông qua quy trình công chứng.

Quá trình này sẽ hoàn thành trong vòng chưa đầy 15 phút đối với hầu hết các bài nộp.

Sau khi tải lên, bạn nên xác nhận dịch vụ công chứng đã xử lý thành công bài nộp của bạn trước khi phân phối.

Nói chung, có hai cách tiếp cận cho việc này.

Đầu tiên, và đơn giản nhất, là kiểm tra kết quả thông qua cùng một API.

Tùy chọn khác là thông qua hỗ trợ webhook được giới thiệu với công cụ công chứng.

Đầu tiên, hãy xem xét cách tiếp cận API.

Kiểm tra trạng thái của việc gửi cho công chứng viên khá đơn giản, Bạn có thể đưa ra yêu cầu với ID gửi nhận được trong quá trình tải lên Một phần của phản hồi là trạng thái hiện tại của việc gửi, sẽ vẫn là "Đang tiến hành" cho đến khi công chứng viên xử lý xong.

Trạng thái sau đó sẽ chuyển sang trạng thái cuối cùng của bài nộp của bạn, chẳng hạn như Được chấp nhận hoặc Không hợp lệ.

Khi quá trình gửi hoàn tất, bạn có thể sử dụng API để truy xuất nhật ký công chứng cho lần tải lên này.

Vui lòng tham khảo tài liệu API REST của Công chứng viên để biết thêm chi tiết về các điểm cuối này.

Tiếp theo, chúng ta sẽ nói về cách tiếp cận thứ hai để có được trạng thái của bạn: một webhook.

Trong quy trình làm việc của webhook, quy trình phần lớn giống nhau, nhưng lần này bạn sẽ cung cấp URL webhook trong yêu cầu tải lên ban đầu.

Chi tiết về định dạng có thể được tìm thấy trong tài liệu cho công chứng viên REST API.

Như trước đây, điều này sẽ kích hoạt dịch vụ công chứng phân tích bài nộp của bạn.

Khi phân tích tự động kết thúc, vé được tạo và trạng thái cuối cùng được lưu lại.

Sau khi hoàn tất, dịch vụ công chứng sẽ gọi đến URL webhook được cung cấp.

Nội dung của cuộc gọi này bao gồm ID gửi, ID nhóm và chữ ký để xác minh nó đến từ chúng tôi.

Khi nhận được thông báo đó, bạn có thể chọn phải làm gì tiếp theo.

Ví dụ, bạn có thể thông báo cho người gửi ban đầu hoặc bắt đầu một đường ống phân phối tự động.

So với chờ đợi với công cụ công chứng, điều này cho phép bạn tách rời hệ thống tải lên tệp từ hệ thống tự động hóa các hành động sau khi công chứng.

Chúng tôi rất vui khi thấy REST API mới này mở ra cánh cửa tích hợp nhiều hơn với các hệ thống tích hợp liên tục và các công cụ khác để xây dựng phần mềm cho macOS.

Để kết thúc, như một lời nhắc nhở nữa, thời hạn để chuyển sang sử dụng Xcode 14, công chứng viên hoặc API REST trực tiếp là vào mùa thu năm 2023.

Cuối cùng, nếu bạn chưa thể sử dụng công cụ công chứng trong quy trình triển khai của mình, đây là cơ hội để bạn bắt đầu tự động hóa bằng cách thử API REST công chứng ngay hôm nay.

Bạn có thể tìm thấy liên kết đến tài liệu bên dưới.

Cảm ơn bạn, và tôi hy vọng bạn tận hưởng phần còn lại của WWDC22 ♪