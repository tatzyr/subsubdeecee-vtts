10013

SwiftUIのMeet StoreKitへようこそ。

私はStoreKitチームのエンジニア、グレッグです。

アプリ内購入のマーチャンダイジングについて話しましょう。

マーチャンダイジングアプリ内購入とは、製品の提供を提示し、顧客が購入を完了する方法を提供することです。

マーチャンダイジングは、販売している製品に関するデータを取得し、顧客のステータスを取得することから始まります。

例えば、顧客はすでに私の非消耗性製品を所有していますか?

彼らは私のサブスクリプションを購読していますか?

このデータを組み合わせて、顧客に製品を販売するためのインターフェースを構築し、製品を購入するためのインタラクションを提供します。

この小さな赤い長方形は、インターフェイスの構築にかかわるすべてのハードワークを過小評価しています。

実際、インターフェイスの構築には多くの側面があり、さまざまな分野のスキルが必要です。

その後、顧客はあなたの製品を購入することを選択します。

アプリは、購入APIを使用して応答し、購入の結果としてインターフェイスを更新する必要があります。

アプリにアプリ内購入を追加したことがある場合は、マーチャンダイジングを正しく取得することが重要であることを知っています。

これらすべてのステップをシンプルでありながら強力なビューに抽象化できればいいのではないでしょうか?

このビューは、すべての一般的な機能を処理し、アプリをアプリにするビットを設定できるパラメータを取ることができます。

さて、マーチャンダイジングUIを構築するためのStoreKitの強力な新しいAPIセットを紹介することに興奮しています。

Xcode 15では、StoreKitは、宣言的なアプリ内購入UIを構築するのに役立つSwiftUIビューのコレクションを提供するようになりました。

マーチャンダイジング体験を望んでいるものを宣言するだけで、システムは舞台裏であなたの宣言を実行に移します。

StoreView、ProductView、SubscriptionStoreViewは、これまで以上に迅速にマーチャンダイジングを稼働させるための新しいビューです。

これらのビューは、App Storeからのデータフローを抽象化し、アプリ内購入を表すためにシステムが提供するUIを表示します。

すでに慣れ親しんでいるSwiftUI APIを使用して、これらのビューがアプリとどのように統合されるかをカスタマイズすることもできます。

SwiftUIと同様に、これらの新しいビューはすべてのプラットフォームでサポートされているため、iPhone、iPad、Mac、Apple Watch、Apple TVでアプリ内購入のマーチャンダイジングがこれまで以上に簡単になります。

羽の生えた友人の群れが私に近づいてきて、Backyard Birdsと呼ばれる新しいゲームにアプリ内購入を追加するのを手伝うことができるかどうか尋ねました。

StoreKitからのこれらの新しいビューで、もちろん私は「全く問題ありません」と言いました。

Backyard Birdsで優れたアプリ内購入体験をお届けしますので、ぜひご参加ください。

私と一緒にこれに取り組むために、サンプルプロジェクトを自由にダウンロードしてください。

Xcodeプレビューを使用して、SwiftUIビューをすばやく反復します。

カバーすることがたくさんあるので、私はすでにStoreKit設定ファイルを設定しました。

これには、StoreKitでXcodeプレビューを使用するために必要なアプリ内購入に関するメタデータが含まれています。

「StoreKitテストの新機能」や「XcodeでのStoreKitテストの紹介」など、独自のアプリを使い始めるのに役立つ素晴らしいセッションがいくつかあります。

Xcodeにすぐに入りましょう。

裏庭の鳥では、この栄養ペレットのようなプレミアムバードフードを販売したいと考えています。

食べ物を購入した後、私たちはより多くの空腹の鳥の訪問者を引き付けるために私たちの裏庭にそれを残すことができます。

コードに飛び込んで、StoreKitを活用してこれらの製品を商品化する方法を見てみましょう。

始めるために、鳥の餌を商品にするためにBirdFoodShopというビューを作成します。

このビューを実装するためのファイルをすでに作成しました。

StoreKitを使用してビューを構築するには、ファイルの上部にStoreKitとSwiftUIの両方をインポートする必要があります。

次に、私たちの店を構築するのに役立つ鳥の餌データモデルを取得するために、ここでクエリを宣言します。

マーチャンダイジングビューを起動して実行する最も簡単な方法であるため、アプリにStoreViewを追加しています。

birdFoodモデルから取得できるStoreKit設定ファイルから製品識別子のコレクションを提供する必要があります。

この宣言の後、今、私たちは機能するマーチャンダイジングビューを持っています。

StoreKitは、App Storeからすべての製品識別子をロードし、UIで表示します。

表示名、説明、価格はすべて、App Store ConnectまたはStoreKit設定ファイルで設定したものを使用するApp Storeから直接来ています。

StoreKitは、有効期限が切れるまで、またはシステムがメモリの圧力下にあるまでデータをキャッシュしたり、スクリーンタイムでアプリ内購入が無効になっているかどうかを確認するなど、より微妙だが重要な考慮事項を処理します。

以前、鳥のデザイナーは、各鳥の食品に装飾的なアイコンを送りました。

末尾のビュービルダーを追加し、アイコンを表すSwiftUIビューを渡すだけで、これらのアイコンをストアビューに追加できます。

ビュービルダーは、製品値をパラメータとして取り、使用するアイコンを決定するために使用できます。

製品IDを受け取り、アセットカタログから正しいアイコンを調べるヘルパービューを作成しました。

これをここに置くと、各製品のアイコンを表示するプレビューの更新を見ることができます。

ストアビューは、製品識別子とアイコンを機能的でよく設計されたストアに変えることで、簡単に起動して実行するのに役立ちます。

ストアビューの強力な機能は、当社の製品がさまざまなプラットフォームに自動的に調整されるため、iPad、Mac、Apple Watchで見栄えの良いショップがすでにあります。

XcodeのターゲットをApple Watchに変更して、ショップをプレビューしましょう。

美味しそう！

Apple Watchでも鳥の餌を売る準備ができていると思います。

あなたの製品に固有の方法で製品を整理したいと思うのが一般的です。

私たちの鳥のデザイナーチームは、鳥の餌を展示するための構図の作成に懸命に取り組んできました。

この構成は、最高の価値を目立つように表示し、他の製品を棚に整理します。

これは、StoreViewで達成できるリストスタイルのレイアウトとは異なりますが、StoreKitではここでも取り上げています。

より詳細なレイアウトについては、新しいProductViewを利用できます。

実際、私たちがちょうど見ていたStoreViewは、同じProductViewを使用して行を作成します。

新しい店舗のコンテナを宣言することから始めましょう。

栄養ペレットのこの箱は、私たちの最高の価値であるため、他の製品の上に目立つように展示したいと思います。

これを行うには、栄養ペレットボックスのIDを入力してProductViewを宣言します。

StoreViewと同様に、末尾のクロージャを追加することで装飾的なアイコンを追加できます。

以前からヘルパービューを再利用します。

次に、他の食品について以下のセクションを追加しましょう。

私は最高の価値の後ろに背景を置くことから始めます...

その後、棚に私たちの鳥の餌をレイアウトするために作った別のヘルパービューと一緒にヘッダー。

このシェルフヘルパービューでは、装飾アイコンとともに、各バードフード製品のProductViewを宣言できます。

この店全体を結びつけるために、最後に1つ必要なものがあります。

私たちは本当にこの栄養ペレットの箱を顧客に目立つように表示したいと思っていますが、鳥のデザイナーは私たちが今持っているものがより良く見えるかもしれないと考えています。

鳥をなだめるために、新しいproductViewStyle APIを使用して、主力製品のスタイルを設定できます。

これを本当に際立たせるために、大きなスタイルを選びます。

わずか数分で、StoreKitの新しいProductViewを使用して、鳥の餌専用の専門店を建設しました。

大規模なProductViewスタイルは、1つのビュー修飾子を追加するだけで、最高の価値を目立つように表示するのに役立ちます。

ニーズに合わせて選択できる3つの標準スタイルがあります。

コンパクトは、より小さなスペースでより多くの製品を表示するのに役立ちます、私たちの鳥の食べ物の棚は自動的にレギュラースタイルを使用し、そしてもちろん、大きなスタイルは目立つプレゼンテーションに最適です。

StoreViewはProductViewインスタンスで構成されているため、同じproductViewStyle修飾子を使用してStoreViewのスタイルを変更できます。

カスタムスタイルを作成し、ProductViewとStoreViewで使用することもできます。

近くにいて、セッションの後半でその方法をお見せします。

ProductViewを使用して、消耗品のバードフードのアプリ内購入を提供する素晴らしい方法を構築しました。

ビジネスバードは、私たちが十分に進んでいないと考えており、彼らは最も熱心なバードウォッチャーのためにバックヤードバードパスと呼ばれるサブスクリプションを提供することを私に課しました。

ProductViewまたはStoreViewを使用してサブスクリプションUIを構築できますが、新しいSubscriptionStoreViewはサブスクリプション専用に構築されています。

Xcodeに戻って、これを一緒に構築しましょう。

始めるために、StoreKitの設定で、3つのレベルのサービスを提供するこの「Backyard Birds Pass」サブスクリプショングループを作成しました。

このグループIDに注意してください。私たちはすぐにこれが必要になります。

以前、パスショップの新しいファイルを作ったので、SubscriptionStoreViewに飛び込みましょう。

SubscriptionStoreViewを起動して実行する最速の方法は、StoreKit設定ファイルまたはApp Store ConnectからグループIDを提供することです。

すでにグループIDを環境に追加したので、アクセスするための環境プロパティを宣言し、グループIDを入力してSubscriptionStoreViewを宣言することができます。

StoreViewやProductViewと同様に、SubscriptionStoreViewはデータフローを管理し、さまざまなプランオプションでビューをレイアウトします。

また、既存の加入者ステータスと、顧客が入門オファーの対象となるかどうかもチェックします。

この自動外観は素晴らしいですが、これをBackyard Birdsのルックアンドフィールに合わせるために使用できる強力な新しいAPIがいくつかあります。

たとえば、ヘッダーのマーケティングコンテンツを任意のSwiftUIビューに置き換えることができます。

先ほどマーケティングコンテンツビューを構築したので、これをここにドロップします。

また、サブスクリプションストアにコンテナの背景を追加して、物事をより視覚的に面白くすることもできます。

新しいSwiftUI containerBackground APIを使用できます。

これをサブスクリプションストアのフルハイトに配置し、以前に作成したビューを空のグラデーションといくつかの雲で宣言する方法に注目してください。

すべてを結びつけるために、サブスクリプションストアのスタイリングに他のAPIを使用できます。

デフォルトでは、サブスクリプションストアは、サブスクリプションコントロールとフルハイトの背景の間にマテリアルレイヤーを追加します。

背景スタイル修飾子を使用して、サブスクリプションコントロールの背後にある背景をクリアにすることができます。

次に、subscriptionStoreButtonLabelを使用して、サブスクライブボタンの複数行レイアウトを選択します。

購読ボタンに価格と「無料で試してみる」の両方が含まれていることに注目してください。

次に、subscriptionStorePickerItemBackgroundを追加して、サブスクリプションオプションの重要な効果を宣言します。

ここでは、サブスクリプションプランのオプションを通して空のグラデーションが輝くのを見ることができます。

最後に、サブスクリプションにはオファーコードがあるため、新しいstoreButton修飾子を使用して、コード引き換えボタンを可視として宣言します。

この1つのビュー修飾子だけで、顧客がオファーコード引き換えシートを開くためのボタンがあります。

今、私たちのサブスクリプションビューは、裏庭の鳥の残りの部分の感触と一致します。

これらの新しいビューは、アプリにアプリ内購入を追加するために必要な労力を大幅に削減しますが、見逃している重要な部分がいくつかあります。

まず、購入後に実際にコンテンツのロックを解除するためのロジックを追加する必要があります。

次に、誰かがすでに購読しているかどうかを確認し、SubscriptionStoreViewを表示するコントロールを非表示にする必要があります。

StoreKitビューは、すでに自動的に購読している顧客を処理しますが、多くの場合、最高のエクスペリエンスは、既存の顧客にマーチャンダイジングUIを提示しないことを選択することです。

StoreKitには、これらの重要な機能をコンテンツを販売するのと同じくらい簡単で楽しいものにするための新しいAPIがいくつかあります。

これらのAPIを使い始める前に、すでにビジネスロジックを実装しているか、少なくともいくつかの足場を配置したいと思うでしょう。

更新されたトランザクションを処理し、サーバーと協力し、消耗品の資格を追跡し、UIコードに適したデータモデルを作成していることを確認してください。

ビジネスロジックの実装の詳細については、「Meet StoreKit 2」と「App StoreサーバーAPIの新機能」をチェックすることをお勧めします。

私はすでに先に進み、バードブレインと呼ばれる俳優に私たちの鳥のビジネスロジックを実装しました。

あなたは私がすぐにこれを参照しているのを見るでしょう。

バードウォッチャーが購入した消耗品の鳥の餌にアクセスできるようにすることから始めましょう。

StoreKitビューのいずれかからの購入の処理は簡単です。

onInAppPurchaseCompletionでビューを変更し、購入が完了するたびに呼び出す機能を提供するだけです。

この方法で任意のビューを変更でき、子孫のStoreKitビューが購入を完了するたびに呼び出されます。

この修飾子をBirdFoodShopに追加しましょう。

修飾子は、成功したかどうかにかかわらず、購入した製品と購入結果を提供します。

これを実装して、成功した結果を処理のためにBirdBrainアクターに送信しましょう。

この修飾子を追加することで、人々が購入する消耗品の鳥の餌のロックを解除しています。

シミュレーターでこれを試してみましょう。

裏庭を選んで、物資を叩きます。

それから、私はいくつかの栄養ペレットを購入します。

シートが却下された後、消耗品の在庫に5つの栄養ペレットがあることに気付くでしょう。

今、私たちは栄養ペレットを置き、私たちのペレットがすべての空腹の鳥を庭に連れて行くように後ろに座ることができます。

onInAppPurchaseCompletionに加えて、StoreKitビューからイベントを処理するために使用できる関連するビュー修飾子がいくつかあります。

onInAppPurchaseStartを使用して、誰かが購入ボタンをトリガーしたときに、購入が始まる前に処理できます。

これは、調光コントロールなど、購入の実行中にいくつかのUIコンポーネントを更新したい場合に便利です。

ここで提供する機能は、パラメータとして購入される製品を受け取ります。

これらの修飾子を使用する場合は、子孫のProductView、StoreView、またはSubscriptionStoreViewインスタンスからのイベントを処理することを知っておくことが重要です。

複数の修飾子を追加すると、イベントごとにすべてのアクションが実行されます。

これらの修飾子の使用は完全にオプションであることを覚えておいてください。

デフォルトでは、StoreKitビューからの成功したトランザクションはTransaction.updatesシーケンスから発行されますが、結果を直接処理するためにonInAppPurchaseCompletionを追加するオプションがあります。

これらの修飾子のいずれかにnilを渡して、デフォルトの動作に戻すことができます。

では、Backyard Birds Passのサブスクリプションの取り扱いについて話しましょう。

新しいビューAPIに加えて、StoreKitにはSwiftUIでデータ依存関係を宣言するための新しいビュー修飾子があります。

まず、パスのロック解除を簡単にするために使用できるsubscriptionStatusTaskをカバーします。

サブスクリプションに依存する任意のビューでは、subscriptionStatusTask修飾子を追加できます。

サブスクリプションオファーシートを開くためのボタンが表示されるので、裏庭グリッドから始めましょう。

subscriptionStatusTask修飾子は、私たちが依存するサブスクリプションのグループIDを取ります。

これは、以前にSubscriptionStoreViewを宣言したときに使用したのと同じグループIDです。

これで、Backyard Gridが表示されるたびに、バックグラウンドタスクがサブスクリプションステータスをロードし、タスクが完了したら提供する関数を呼び出します。

このAPIを使用するためのベストプラクティスは、ステータスをビジネスロジック、私たちの場合はBirdBrainアクターに渡し、アクターにデータを処理させ、UIコードで作業しやすいモデルタイプを返すことです。

このパスステータス列挙型を作ったので、これを割り当てる州のプロパティを作ります。

その後、誰かが現在購読していない場合にのみ、サブスクリプションオファーカードを表示することを選択できます。

これらの迅速な追加により、まだ購読していないバードウォッチャーにのみオファーカードを表示します。

ステータスが変更されたときにStoreKitは私たちの機能を呼び出しますので、私たちのビューは常に最新の情報を反映します。

アプリ全体でこの同じパターンを使用してBackyard Birds Passコンテンツのロックを解除することができ、onInAppPurchaseCompletion修飾子を使用して、サブスクリプションが成功した後にパスショップシートを自動的に却下することができます。

私はすでにこの部分を以前に完了したので、iPhoneシミュレータでアプリを実行して、この全体をテストしてみましょう。

「Check It Out」をタップして、「無料で試す」を押します。

支払いシートが表示され、購読をタップし、アラートを閉じることができます。

オファーシートが自動的に却下され、オファーカードも隠されているのを見てください。

これは、サブスクリプションステータスタスクがステータスが変更されるたびに関数を再度呼び出すため、アプリのUIが常に最新であることを確認できます。

このトピックでは、アプリが非消耗品または非更新サブスクリプションを提供している場合、subscriptionStatusTaskと同じくらい簡単に資格を確認するための新しいAPIがあります。

currentEntitlementTask修飾子を使用して、製品IDの現在のエンタイトルメントに依存するビューを宣言することができ、システムは現在のエンタイトルメントを非同期にロードし、変更されるたびに現在のエンタイトルメントで関数を呼び出します。

subscriptionStatusTaskとcurrentEntitlementTaskの両方に提供する関数は、エンタイトルメントタスクの状態をパラメータとして取ります。

そうすれば、エンタイトルメントがまだロードされているとき、ロードに失敗した場合、エンタイトルメントが正常にロードされたときに、ケースを詳細に処理することを選択できます。

これらの新しいStoreKitビューが、Backyard Birdsでのアプリ内購入の統合を合理化するのにどのように役立つかを取り上げました。

さて、もう少し深く掘り下げて、SwiftUI用のすべての新しいStoreKit APIを使用して、これらのビューをさらに一歩進める方法を紹介したいと思います。

まず、ProductViewとStoreViewのアイコンを設定するためのより多くのオプションを見ていきます。

次に、製品ビューのスタイリングについて詳しく説明します。

その後、StoreViewとSubscriptionStoreViewに共通の機能を備えたボタンを追加する方法について説明します。

最後に、サブスクリプションストアビューをブランドのルックアンドフィールに合わせるために使用できるさまざまな新しいAPIについていきます。

装飾的なアイコンに入りましょう。

アイコンを指定すると、標準の製品ビュースタイルはすべて、左側に表示されるもののように、製品の読み込み中にプレースホルダアイコンを表示します。

自動アイコンは、実際のアイコンが期待するものと正確に一致しない場合があります。

たとえば、iPhoneでは、自動プレースホルダは正方形ですが、バードフード製品には円のアイコンを使用します。

プレースホルダに使用するアイコンを使用して、ProductViewに2番目のトレーリングクロージャを追加することで、この外観を簡単に改善できます。

この場合、プレースホルダに円を提供しただけです。

App Store ConnectでApp Storeプロモーションイメージを設定した場合、ProductViewにSwiftUIビューの代わりに同じイメージを使用させることができます。

prefersPromotionalIconパラメータをtrueに設定するだけです。

SwiftUIビューをフォールバックとして提供することはできますが、製品にプロモーションアイコンがある限り、このビューは無視されます。

プロモーションアイコンの設定方法については、「XcodeでのStoreKit 2とStoreKitテストの新機能」と「App Store Connectの新機能」をご覧ください。

App Storeのプロモーションアイコンを使用したくなくても、SwiftUIで宣言されたアイコンにクールなアプリ内購入アイコン処理を使用できます。

アイコンに指定したビューにこの修飾子を追加するだけで、この境界線がビューに追加されます。

それはすべて製品ビューのアイコンについてです。

ストアビューアイコンで同じことをすべて行うための対応するAPIもあることを覚えておいてください。

では、製品ビューのスタイリングについて話しましょう。

セッションの前半で、カスタム製品ビュースタイルを作成できると述べましたが、ついにその方法をお見せします。

プロダクトビューの外観、レイアウトの動作、および相互作用は、使用するスタイルによって完全に定義されます。

したがって、あなたがしようとしているものに合った標準的なスタイルが見つからない場合は、いつでも独自のカスタム製品ビュースタイルを作成できます。

私たちが検討する最初のケースは、あなたが完全にゼロから始めるわけではないように、標準スタイルで構成されたカスタムスタイルを作成することです。

たとえば、ロード中に標準のプレースホルダの外観ではなく、製品ビューにプログレススピナーを表示したい場合はどうなりますか?

カスタムスタイルを作成するための最初のステップは、ProductViewStyleプロトコルに準拠したタイプを作成することです。

プロトコルを実装するための唯一の要件は、このmakeBodyメソッドです。

makeBodyメソッドに渡される設定値には、優れた製品ビューを宣言するために必要なすべてのプロパティがあります。

たとえば、製品のロードのさまざまな状態をカバーする状態列挙があります。

読み込みの外観をカスタマイズするには、読み込み状態のProgressViewを宣言するだけです。

次に、構成をProductViewインスタンスに渡すだけで、他の状態の標準ProductView動作にフォールバックできます。

productViewStyle修飾子に渡すことで、標準スタイルと同じようにカスタムスタイルを適用します。

もちろん、標準スタイルでカスタムスタイルを構成する必要はありません。 カスタムスタイルを作成する必要はありません。

makeBodyメソッドの他のビューを使用して、いつでもスタイルを定義できます。

タスク状態が成功すると、ビューが表しているプロダクト値にアクセスできます。

これは、アプリがStoreKit 2を使用している場合、すでに作業に慣れているのと同じ製品価値です。

製品のすべてのプロパティを使用して、ビューを作成できます。

この設定では、装飾アイコンにアクセスすることもできます。

購入ボタンを追加するときは、製品値ではなく、設定値で購入方法を使用してください。

設定でメソッドを使用すると、デフォルトの購入オプションが追加され、支払い確認シートが製品ビューの近くに表示され、onInAppPurchaseCompletionなどのリアクティブ修飾子もトリガーされます。

覚えておいてください：カスタムスタイルがゼロから構築されている場合、このスタイルを使用する製品ビューの外観と動作は、スタイルを構築するために作成したビューの外観と動作と一致します。

カスタムスタイルを作成することは、App Storeのデータフローなど、製品ビューのすべてのインフラストラクチャを活用するのに最適な方法ですが、必要な外観や動作を自由に宣言できます。

読み込み中、バードフードショップ用に作成したUIには、各製品のプレースホルダーの形状が表示されます。

しかし、右側にこのローディングスピナーのような外観が必要な場合はどうなりますか?

この問題の解決策は、状態を上げることです。

ここで私が言いたいことを説明させてください。

この図は、以前に構築したBirdFoodShopの階層を表しています。

BirdFoodShopにはいくつかのProductViewの子孫がいます。

製品IDでProductViewを初期化すると、ロード操作が非同期であるため、各ビューは製品の状態を内部的に保持します。

製品の読み込み中に親BirdFoodShopが異なる外観を表示するエフェクトを作成する場合は、状態を親のBirdFoodShopに持ち上げる必要があります。

親のBirdFoodShopが製品の状態を管理したら、データの読み込み中に外観を自由に変更し、IDの代わりにプリロードされた製品値を使用してProductViewインスタンスを作成できます。

これまでのところ、製品IDによる製品ビューの作成のみを取り上げましたが、すでにロードした製品値をProductViewに渡すことができることを知っておくことが重要です。

これにより、製品ビューは読み込みをスキップし、マーチャンダイジングビューを直接レイアウトするだけです。

あなたは考えているかもしれません：それはすべてクールですが、そのためには、今、私は自分の製品要求とキャッシュロジックを書かなければなりません。

さて、StoreKitビューの内部をビュー修飾子として公開していることを知って喜んでいるので、任意のビューを製品IDのメタデータに依存するものとして宣言できます。

StoreKitは、製品のロード、キャッシュ、最新の状態に保ちます。

これを行うには、新しいstoreProductsTask修飾子を使用するだけです。

先ほど説明したsubscriptionStatusTaskと同様に、ビューが依存する製品IDのコレクションを渡します。

次に、非同期タスクの状態を処理するために使用できる状態値を取得します。

カスタムProductViewStyleの実装を見た後、これはすべてかなり身近に感じられるはずです。

ここから、ロードに関するロードビューを表示できます。

製品が利用できない場合は、新しいContentUnavailableViewを使用してください。または、プリロードされた製品値でBirdFoodShopを直接表示してください。

それはとても簡単です。

簡単に言えば、アプリ内購入マーチャンダイジングUIに含めるいくつかの有用な一般的なアクションがあります。

StoreViewとSubscriptionStoreViewを使用すると、これらの一般的なアクションの補助ボタンを簡単に追加できます。

補助ボタンについて話すとき、私はビューの主な目的をサポートするアクションを実行するボタンを意味します。

たとえば、このキャンセルボタンとコードの引き換えボタンは、どちらもパスの購読に補助的です。

このシートを最初に作成したときに、storeButton修飾子を使用してコードを引き換えるボタンを追加することをすでに検討しました。

このビュー修飾子を詳しく見てみましょう。

ここでは、2つのパラメータのそれぞれに渡すことができる値がいくつかあります。

最初のパラメータを使用すると、可視性を選択できます。

自動はすべてのボタンのデフォルトであり、StoreKitはコンテキストに応じてボタンを表示するかどうかを選択します。

ボタンを明示的に表示または非表示にすることもできます。

次のパラメータでは、可視性を設定するボタンの種類を選択できます。

キャンセルボタンには、ビューを閉じるためのプラットフォームに適したボタンが表示されます。

このボタンは、StoreViewとSubscriptionStoreViewの両方で機能します。

キャンセルボタンの自動動作は、ビューが表示されるたびに表示されます。

右側には、サブスクリプションストアビューがシートとして表示され、右上にキャンセルボタンが自動的に表示されます。

左側では、ビューはシートとして表示されていないため、キャンセルボタンはありません。

もちろん、この動作をオーバーライドし、表示されたときにキャンセルボタンを非表示にすることもできます。

キャンセルボタンを独自のキャンセルボタンに置き換える場合にのみ、これを行うことを覚えておいてください。

プレゼンテーションを閉じるための明確なボタンで、常にマーチャンダイジングUIに付随することをお勧めします。

キャンセルボタンと同様に、ストアビューとサブスクリプションストアビューの両方で、購入の復元ボタンを表示できます。

デフォルトでは、[購入の復元]ボタンは常に非表示になっていますが、storeButton修飾子を使用してマーチャンダイジングUIに表示することを選択できます。

次の3つのボタンの種類は、SubscriptionStoreView専用です。

redeemCodeボタンについては、すでに話しました。

次のボタンの種類はサインインボタンです。

サブスクリプションサービスでユーザーがApp Storeの外で購読できる場合は、既存の加入者がサブスクリプションにアクセスする必要がある場合に備えて、サインインボタンを表示することをお勧めします。

サインインボタンで知っておくべき重要なことは、新しいsubscriptionStoreSignInAction修飾子を使用してサインインアクションを宣言する必要があることです。

サインインアクションを設定すると、サインインボタンが自動的に表示されます。

サインインボタンは、subscriptionStoreSignInActionで宣言した関数を呼び出すだけなので、これをシグナルとして使用してサインインフローを実行できます。

確認する最後のボタンの種類はポリシーです。

サブスクリプションオファーと一緒に利用規約とプライバシーポリシーへのリンクを表示したい場合があり、SubscriptionStoreViewはこれが本当に簡単になります。

通常、ポリシーボタンはデフォルトで非表示になっています。

storeButton修飾子で表示させると、iOSとMacのサブスクライブコントロールの上に表示されます。

これらのボタンはコンテナの背景の上に表示されるため、デフォルトのスタイルは背景に対して読みやすくない場合があります。

subscriptionStorePolicyForegroundStyleを使用して、背景に対して読みやすいポリシーボタンに使用するシェイプスタイルを設定します。

storeButton修飾子で補助ボタンを設定すると、いくつかの簡単な宣言でマーチャンダイジングUIに強力な機能を追加できます。

セッションの早い段階で、Backyard Birdsのルックアンドフィールに合わせてサブスクリプションストアビューのスタイルを設定しました。

さて、これらのスタイルのAPIを詳しく見てみたい。

まず、コントロールスタイルの選択を見てみましょう。

自動的に、SubscriptionStoreViewは、マーチャンダイジングするサブスクリプションの種類に基づいてコントロールスタイルを選択します。

新しいsubscriptionStoreControlStyle修飾子を使用して、サブスクリプションプランに使用するコントロールのスタイルを選択できます。

たとえば、自動ピッカーではなく、プランごとにボタンを選択できます。

さまざまなスタイルのコントロールについて話しましょう。

スタイルを指定しない場合、サブスクリプションストアビューは自動的にコントロールを選択します。

iPhoneでは、これは複数のプランオプションを持つサブスクリプションのピッカーコントロールです。

ピッカーコントロールを明示的に選択することもできます。

iOSとMacでは、目立つピッカーコントロールがあり、サブスクリプションプランのオプションを影と選択リングでより目立つように表示します。

最後に、ピッカーコントロールの代わりに、各サブスクリプションプランのボタンを表示することを選択できます。

購読ボタンのトピックでは、ボタンラベルをカスタマイズするために使用できる新しいAPIがあります。

デフォルトでは、SubscriptionStoreViewには、アクションフレーズと価格情報を含む購読ボタンがボタンの上にキャプションとして表示されます。

subscriptionStoreButtonLabel修飾子を追加して、ボタンラベルを複数行に変更できます。これにより、価格テキストは別のキャプションとしてではなく、ボタンラベル内に含まれます。

ボタンラベルのレイアウトをカスタマイズするだけでなく、コンテンツをカスタマイズすることもできます。

たとえば、アクションフレーズの代わりに、選択したサブスクリプションの表示名を表示するように選択できます。

このようにコンポーネントをチェーンすることで、レイアウトとコンテンツの両方でボタンラベルの値を作成することもできます。

ボタンコントロールはピッカーコントロールと同じサブスクライブボタンで構成されているため、同じ修飾子を使用してこれらのボタンをカスタマイズすることもできます。

たとえば、ラベルに価格のみを表示するように選択できます。

これは、プランがすべて同じサービスであるが、価格帯が異なる場合に便利です。

異なるサブスクリプションプランでは、App Store Connectで設定した表示名と説明を使用してコントロールを構築します。

これらのコントロールをより面白くするために、異なるプランごとに装飾的なビューを追加することを選択できます。

装飾ビューを追加するには、subscriptionStoreControlIcon修飾子をサブスクリプションストアに追加するだけです。

修飾子はビュービルダーを取ります。

ビュービルダーに製品値とSubscriptionInfo値の両方を提供します。

これらのパラメータを使用すると、プランごとに異なるビューを提供できます。

これらのアイコンは、サブスクリプションプランにボタンコントロールスタイルを使用する場合にも機能します。

では、サブスクリプションストアビューにバックグラウンドコンテンツを追加することをもう少し詳しく見てみましょう。

以前から要約するには、containerBackgroundモディファイアを使用してマーケティングコンテンツを変更することで、サブスクリプションストアにコンテナの背景を追加できます。

この場合、背景にアクセントカラーのグラデーションを提供し、サブスクリプションストアに配置することを選択します。

新しいcontainerBackground APIの詳細については、「SwiftUIの新機能」セッションをご覧ください。

サブスクリプションストアで使用できるいくつかの異なるバックグラウンドプレースメントがあります。

サブスクリプションストアの配置を使用する場合は、コンテキストに基づいて自動配置を選択します。

iOSとMacでは、サブスクリプションストアのヘッダーに背景を配置することを明示的に指定できます。

このプレースメントは、あなたのマーケティングコンテンツの背後にあるものです。

また、サブスクリプションストアビューのフルハイトの後ろに背景を配置するフルハイトの配置もあります。

セッションの前半では、Get Backyard Birds Passシートの表示を避けるために、サブスクリプションステータスタスクなどのAPIを使用する方法について議論しました。

ただし、既存の加入者にサブスクリプションストアビューを表示したい場合があり、加入者にプレミアムプランへのアップグレードを奨励したい場合があります。

加入者が現在プレミアムよりもサービスレベルの低いプランに加入していることを検出すると、アップグレードをvisibleRelationshipsパラメータとして渡すことで、アップグレードシートを表示できます。

これは、私たちが望むサブスクリプション関係の任意の組み合わせである可能性があり、誰かが現在購読している場合にのみ効果があります。

次に、オファーをより効果的にするために、プレミアムプランの利点を説明するために、マーケティングコンテンツに異なるビューを提供することができます。

subscriptionStatusTaskを使用して、加入者のサービスレベルを追跡し、この情報を使用して顧客に提示するオファーを知ることができます。

それが私が今日カバーしなければならないすべてです。

アプリにアプリ内課金アイテムを追加し始めると、すぐに起動して実行できるようにStoreViewを宣言してください。

よりカスタマイズされたレイアウトが必要な場合は、ProductViewを試してみてください。

サブスクリプションでは、SubscriptionStoreViewを宣言して、説得力のあるオファーを構築できます。

そして、物事を次のレベルに引き上げる準備ができたら、新しいビュー修飾子やその他のAPIを試して、これを本当に自分のものにしてください。

十分なStoreKitとSwiftUIを入手できない場合は、セッションをチェックしてください。「XcodeでのStoreKit 2とStoreKitテストの新機能」と「SwiftUIの新機能」。

SwiftUI用の新しいStoreKit APIについて学ぶために、今日参加してくれてありがとう。

ハッピーコーディング!

。