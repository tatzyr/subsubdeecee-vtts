10104

♪ ♪

アレックス：こんにちは、私はアレックス・エイブラメッツです。

「メディアアプリをHomePodと統合する」へようこそ。

私はホームのためのエキサイティングで新しいSiri機能を紹介するためにここにいます。

iOS 17以降、HomePodの所有者は、iPhoneまたはiPadにインストールされているアプリを使用して、Siriにメディアを再生するように頼むことができます。

この新しいSiri機能により、現在SiriKit Media IntentsをサポートしているアプリがHomePodでコンテンツをシームレスに再生できるようになります。

まず、HomePodで再生するメディアアプリの拡張サポートを紹介します。

次に、サポートされているユースケースと経験を取り上げ、それらを実装するための最良の方法を示します。

最後に、この機能がホームとどのように統合されているかについて話します。

より多くのメディアアプリのHomePodサポートについて、まずは始めましょう。

HomePodがリクエストを処理すると、SiriKitのインテントがiPhoneに送信され、そこでSiriがアプリを起動し、AirPlayのコンテンツをスピーカーに戻します。

このセッションの後半でAirPlayのサポートについて詳しく説明します。

要求を満たすために、HomePodはWi-Fi経由でiPhoneと通信します。つまり、デバイスはリクエスト時に同じネットワーク上にある必要があります。

デバイスは物理的に近接している必要はありません。

リビングルームでスピーカーと話していて、寝室で携帯電話が充電されている場合、HomePodは正常に再生されます。

メディアを再生するためのSiriのリクエストは、AirPlayをサポートするほとんどのスピーカーを含む、複数の目的地で動作します。

今日、SiriKit Media Intentsをサポートするアプリは、追加の変更なしでこの機能を使用できます。

後で、ユーザーエクスペリエンスとパフォーマンスをさらに向上させることができるいくつかのことについて話します。

HomePodでネイティブにサポートされていないアプリの再生、追加、アフィニティ要求は、プライマリiPhoneにルーティングされます。

HomePodでは、メディアの検索や検索をリクエストすると再生されることに注意してください。

Siriは、認識されたホームユーザーのデバイスにリクエストをルーティングするために音声認識に依存します。

さらに、曲の「いいね」または「追加」のリクエストは、Siriを使わずにAirPlayされたコンテンツでも機能します。

現在、多くの既存のメディアアプリがHomePodで利用可能になり、音楽だけではありません。

多くの種類のメディアがサポートされています。

音楽、オーディオブック、ポッドキャスト、ラジオ、瞑想など。

SiriKit Mediaのインテントに新しいサポートを追加するアプリは、HomePodで自動的にサポートされます。

あなたのアプリが今日iOSでできることはすべてHomePodで動作します。

たとえば、アプリユーザーは、アーティスト、アルバム、曲、音楽ジャンル、ヒット曲の再生を依頼できます。

リクエストでアプリ名が使用されると、SiriはアプリがiPhoneにインストールされているかどうかを確認します。

アプリがインストールされている場合、SiriはAirPlay接続を確立し、アプリに再生を開始するように頼みます。

たぶん、あなたのアプリはポッドキャストやオーディオブックを聴くことです。

これで、ニュースに追いついたり、HomePodで現在のオーディオブックを聴き続けることができます。

Siriは、速度の変更、早送り、再生制御のリクエストを理解します。

アプリに固有のリクエストで、メディアインテントでカバーされていないリクエストは、アプリインテントを使用して実装できます。

「App Intentsの機能強化を探る」やその他の関連セッションをチェックしてください。

では、アプリにSiriを追加するにはどうすればよいですか?

SiriKit Media Intentsをサポートするために必要なものについて説明し、すべてが確実に機能し、素晴らしい体験を提供することを確認することについて話しましょう。

メディアインテントを既存のサポートを持つアプリは、単に機能します。

たとえば、SoundCloudがiPhoneにインストールされていて、HomePodにSoundCloudで何かを再生するように頼んだ場合、メディアはスピーカーで再生されます。

Siri経由での再生サポートをアプリに追加するには、いくつかの簡単な手順が含まれています。

インテント拡張機能を追加し、検索と再生でSiriコールバックを配線するためのいくつかの方法を実装する必要があります。

2019年の「SiriKitメディアインテントの紹介」ビデオと2020年の「SiriKitメディアインテントをより多くのプラットフォームに拡張する」に詳細な手順があります。

曲を再生できるサンプルアプリからコードを調べてみましょう。

ここでは、リクエストが「Push it」という名前のエンティティ用であることを確認し、その場合はメディアアイテムを返します。

試してみましょう。 

ねえSiri、コントロールオーディオでデュークスの「Push It」を再生して。

Siri：「Push It」がiPhoneから再生中になりました。

アレックス:この曲は期待どおりに再生されます!

では、何か他のことを尋ねましょう。

ねえSiri、コントロールオーディオでジャズを演奏して。

Siri: あなたのコントロールオーディオライブラリでは見つかりませんでした。

アレックス：今回、Siriは何も見つからなかったと言った。

これは、私のアプリがジャンルの再生をサポートしていないため、関数が「サポートされていない」応答を返したために起こりました。

しかし、私はSiriの反応をより良くすることができます!

「サポートされていないメディアタイプ」や、アプリに有効なログインが必要ななど、再生できないより具体的な理由を提供できます。

そのような場合、Siriは問題の解決に役立つ応答を提供します。

次に、コードを変更し、リクエストが音楽ジャンルを再生する場合、より具体的なエラーコードを返すガードステートメントを追加します。

ねえSiri、コントロールオーディオでジャズを演奏して。

Siri: コントロールオーディオはその再生をサポートしていません。

アレックス：それで、今、Siriはアプリがその再生をサポートしていないと言っていますが、これはより有用な応答です。

Siriのリクエストが行われたとき、あなたのアプリは何を受け取るのか疑問に思うかもしれません。

前の例では、「mediaName」フィールドと「mediaType」フィールドについて議論しました。

あなたのアプリが得るかもしれない最も一般的な意図のいくつかを見直しましょう。

アプリ名だけで簡単な「プレイ」は、検索条件なしでインテントを送信します。

音楽アプリは、パーソナルミックスやステーションを再生できます。

ポッドキャストやオーディオブックアプリは、最後に再生されたアイテムを再開する場合があります。

「アプリで音楽を再生する」リクエストの場合、「音楽」は「mediaType」に変換されます。

エンティティ名の「再生」リクエストは、mediaNameフィールドのみを提供します。

曲、アーティスト、ポッドキャストなど、エンティティの種類を決定するのはアプリ次第です。

「song」とその名前に言及すると、Songに等しいmediaTypeとmediaNameフィールドが生成されます。

これは「人気ヒット」を求めることがどのように振る舞うかです。

メディア名は「音楽」に設定され、ソートオーダーは「人気」になります。

次に何かを再生するように頼むと、アプリにキューに追加するように指示されます。

「Playbackqueuelocation」の値が「next」であることに注意してください。

アプリがニュース、ポッドキャスト、オーディオブックをサポートしている場合、「私のオーディオブックを再生する」、「最新のニュースを再生する」、「ハイテクニュースポッドキャストを再生する」などのリクエストを受け取ることがあります。

アプリに送信される予定のリクエストについて、Siriが生成した意図を探求し、実験する必要があります。

結果を解決した後、Siriはインテント拡張機能の「ハンドル」ステップを実行します。

「handleInApp」と「continueInApp」の2つの応答のうちの1つを返すことができます。

「HandleInApp」は、アプリを起動してバックグラウンドで再生するようにシステムに指示します。

「ContinueInApp」は、フォアグラウンドでアプリを起動するようにシステムに求めます。

オーディオを再生するリクエストの場合、バックグラウンド再生は、電話のロックを解除する必要が不要なため、より良い体験が得られます。

HomePodにリクエストが行われると、あなたの携帯電話がどこにもない可能性があるため、さらに顕著になります。

Siriコールバックに対するアプリの応答は合理的に高速である必要があることを覚えておいてください。

遅いリクエストはしばしば放棄されるか、単にタイムアウトされます。

アプリが最大10秒以内に応答することを確認してください。

できるだけ速くすることが望ましいですが、10秒後、Siriの反応は一般的になり、あまり役に立ちません。

曲やポッドキャストが好きだとSiriに伝えたい場合、またはプレイリストに追加したい場合はどうなりますか?

INAddMediaIntentとINUpdateMediaAffinityIntentをサポートすることで、アプリはこれらのリクエストに対応できます。

実装はINPlayMediaIntentと非常によく似ています。

AirPlayedコンテンツの場合、Siriは話す人のiPhoneにリクエストを送信します。

アプリとSiriの統合をより堅牢にするために、いくつかのことを確認しましょう。

まず、個人的なアプリの語彙です。

個人的なアプリの語彙を使用して、あなたのアプリは、要求が含まれる可能性のあるユーザー固有のエンティティのシステムに通知することができます。

これらには、個人のプレイリスト、購入したオーディオブック、ポッドキャスト、お気に入りのアーティスト、または著者が含まれます。

通常、フォアグラウンドアプリのみが再生を開始できますが、Siriのリクエスト中に、アプリはバックグラウンドでオーディオを開始できます。

これが機能するためには、そのセッションをアクティブにする前に、オーディオセッションを適切に設定しておくことが非常に重要です。

これは、HomePod、iOS、CarPlayなど、サポートされているすべてのプラットフォームに適用されます。

この例では、オーディオカテゴリを再生に設定することで、アプリはオーディオを再生することをシステムに通知します。

オーディオカテゴリ、モード、およびルート共有ポリシーは、システムがオーディオ再生と中断をどのように処理するかに影響します。

モードを「スポークンオーディオ」に設定すると、コンテンツの音量を一時的に減らすのではなく、中断されたときに再生が一時停止します。

これは、リスナーがコンテンツの重要な部分を見逃さないように、ポッドキャストやオーディオブックを再生するアプリに特に便利です。

セッションをアクティブにする前に、オーディオカテゴリが「.playback」に設定されていない場合に何が起こるかを見てみましょう。

ねえ、Siri、コントロールオーディオでデュークスの「Push It」を再生して。

Siri：「Push It」がiPhoneから再生中になりました。

アレックス：アプリがフォアグラウンドにある間、オーディオは再生されますが、アプリがバックグラウンドに入ると、たとえば電話をロックすると、再生が停止します。

それは機能しますが、あなたが期待する方法ではありません。

オーディオセッションを正しく設定するためにコードを変更するとどうなるか調べてみましょう。

ねえ、Siri、コントロールオーディオでデュークスの「Push It」を再生して。

Siri: これがあなたのiPhoneからの「プッシュ」です。

アレックス：電話をロックすると、オーディオが再生され続けます。

♪ ♪

HomePodとiPhoneは多くのことができるので、アプリからのオーディオ再生が着信、ナビゲーションプロンプト、Siriリクエスト、または何か他のものを再生する他のアプリによって中断されることは珍しくありません。

特に部屋の誰かがHomePodと話していて、iPhoneが手元にない場合は、アプリが再生を継続できるように、中断を処理することが重要です。

さて、AirPlayについて話しましょう。

システムがアプリからコンテンツをAirPlayに正常に実行するには、次のことを行うようにしてください。先に述べたように、オーディオカテゴリ、モード、およびルート共有ポリシーを適切に設定し、MPNowPlayingInfoCenterを使用して現在再生中のアイテムについてシステムに通知し、MPRemoteCommandCenterを使用して、再生、一時停止、スキップなどのリモートコマンドを受信します。

これらの手順では、AirPlayスピーカーで再生するアプリからメディアを取得します。

しかし、オーディオデータは別のデバイスに配信されているため、システムはバッファを必要とし、スムーズな再生を確実にするためにいくつかのデータを蓄積します。

これにより、メディアが再開または停止されるたびに遅延が発生する可能性があります。

バッファリングされた再生にAPIの1つを使用すると、この懸念が解消されます。

このトピックの詳細については、「AirPlay体験の調整」という今年のセッションをチェックしてください。

次に、この機能に関する追加の考慮事項について説明します。

iPhoneやiPadを複数持っている場合はどうなりますか?Siriはどれを使うべきかをどうやって知るのですか?

答えは、SiriがSiriKit MediaリクエストをプライマリiPhoneにルーティングすることです。これは、Apple IDと「探す」の設定で位置情報を共有するように設定されているものです。

Siriはこれらの要求を満たすために他のデバイスと通信するため、要求するユーザーはホームに登録し、私の声の認識を有効にする必要があります。

この設定はホームアプリで見つけることができます。

この機能が機能するためには、パーソナルリクエストを有効にする必要はありません。

「Recognize My Voice」が有効になっていない場合、またはホームに登録されていない場合は、あなたや他の人のデバイスからメディアを再生できないことに注意してください。

アプリをインストールしたばかりの場合、またはSiriにそこから再生するように頼んだことがない場合は、アプリを使用して再生する最初のリクエストは、iOSデバイスに誘導し、Siriがアプリデータにアクセスする許可を要求します。

この許可は、アプリから再生するための最初のSiriリクエストにのみ必要です。

私があなたを手放す前に、ここにあなたが覚えておくべきことがあります。

SiriKit Mediaのインテントサポートを追加することは、アプリがHomePodで動作するために必要なことです。

バッファ付き再生を追加し、より複雑なクエリをサポートし、Siriにより多くのコンテキストを提供することで、ユーザーエクスペリエンスをさらに向上させることができます。

ありがとう！

あなたのアプリがHomePodで動作するのを見るのが待ちきれません!

♪ ♪