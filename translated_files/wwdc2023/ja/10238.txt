10238

♪ ♪

ケリー：こんにちは、私の名前はケリーで、AirPlayチームのエンジニアです。

セッションへようこそ。

今日は、AirPlayの最新バージョンの機能のいくつかをカバーし、アプリで素晴らしいAirPlay体験を確実に提供するためのヒントを提供します。

これが今日の議題です。これは私たちのアジェンダです。

AirPlayの概要から始めます。

次に、AirPlayの強化されたオーディオバッファリングが提供する機能のいくつかを探ります。

そして最後に、強化されたオーディオバッファリングをアプリに統合する方法について説明します。

AirPlayは、Appleデバイスから近くのスピーカーや画面にビデオ、写真、音楽などを共有する最も簡単な方法です。

今日、家庭にAirPlay対応デバイスがたくさんあるため、AirPlayはこれまで以上に人気があります。

次のいずれかの方法でAirPlayを使用できます。AirPlay Audioを使用すると、1つ以上のHomePodとAirPlay対応スピーカーに完璧に同期してストリーミングすることで、お気に入りの音楽やポッドキャストを共有できます。

AirPlay Videoを使用すると、お気に入りの映画や番組をAppleデバイスからApple TVまたはAirPlay対応のスマートテレビに高品質でストリーミングでき、最大4K HDRをサポートできます。

また、ミラーリングを使用すると、写真、個人的なビデオ、ゲーム、ウェブページ、スプレッドシートなど、Appleデバイス上にあるものをApple TVまたはAirPlay対応のスマートテレビと共有できます。

あなたの友人や家族も、Appleデバイス上にあるものを簡単に共有できます。

今日のビデオでは、AirPlayのオーディオストリーミングの側面に焦点を当てます。

AirPlayは、1つまたは複数のデバイスにシームレスなオーディオストリーミング体験を提供します。

HomePod、Mac、Apple TVなどのAppleデバイスから、数億のスマートテレビを含む世界のトップブランドのオーディオおよびビデオ製品まで、今日AirPlayオーディオをサポートするデバイスの完全なエコシステムがあります。

AirPlayはとても便利で、個人的には日常的に使うのが大好きです。

AirPlayが成長し続けるにつれて、開発者や顧客からの期待も成長しています。

AirPlayを次のレベルに引き上げるために、さらに優れたホームシアターとマルチチャンネル体験を提供するために、新しく改良されたプロトコル、AirPlay強化オーディオバッファリングがあります。

強化されたオーディオバッファリングは、ホームオーディオ全体を念頭に置いてゼロから構築されています。

それは堅牢です。

オーディオは、再生の中断を最小限に抑えるために、リアルタイムの再生速度よりも高速にストリーミングされます。

反応が良いので、アプリはHomePodのタップやiPhoneをリモコンとして使用するとすぐに反応します。

Apple TVのドルビーアトモスや今年の新機能、iOS用のロスレス再生のインテリジェントな使用など、マルチチャンネルオーディオフォーマットをサポートしています。

強化されたオーディオバッファリングは、HLSインタースティシャルが広告をサポートするための最良のサポートを提供します。

HLSインタースティシャルの詳細については、同僚のAmitのビデオ「Explore AirPlay with Interstitials」をご覧ください。

ご覧のとおり、私たちは将来のために強化されたオーディオバッファリングで素晴らしい基盤を構築しました。

これを統合すると、アプリで素晴らしいAirPlay体験が生まれます。

強化されたオーディオバッファリングからどのように利益を得ることができるか見てみましょう。

携帯電話からHomePodにオーディオをストリーミングしています。

私がゴミを出していると想像してみてください、そして私は今私のWi-Fiの範囲外です。

♪ ♪

HomePodが再生され続けていることに注目してください。

ネットワークに再接続しようとすると、私の音楽はビートをスキップせず、私の電話はHomePodにシームレスに再接続します。

♪ ♪

携帯電話から再生を再び制御できます。

これは、AirPlayを使用してHomePodのようなAirPlay対応スピーカーで音楽を再生するときに人々が期待するタイプのパフォーマンスです。

今、強化されたオーディオバッファリングが提供するすべての素晴らしいもので、それをあなたのアプリに組み込みましょう。

アプリにAirPlayサポートを追加する方法を確認しましょう。

アプリの正しいミキシングと中断の動作のために、オーディオセッションを適切に設定しておくことが重要です。

メディアの再生がアプリの中心である場合は、オーディオセッションのカテゴリを再生に設定します。

これにより、アプリがバックグラウンドにあるときに、アプリのメディアが再生され続けることが保証されます。

一般に、モードをデフォルトに設定できますが、ポッドキャストやオーディオブックなどの音声では、モードをs spokenAudioに設定することをお勧めします。

最後に、オーディオセッションのルーティングポリシーをlongFormAudioに設定します。

ロングフォームオーディオは、音楽やポッドキャストなどのシステムサウンド以外のものです。

今年新しく、私たちはAirPlayをこれまで以上にシームレスにしています。

iPhoneとiPadは、デバイス上のインテリジェンスを使用してAirPlayの設定を学習するようになりました。

そのため、通常、夕食を作るときに音楽を聴くため、キッチンの近くのHomePodが自動的に表示され、アプリのコンテンツを好きな場所で簡単に再生できます。

ロングフォームのオーディオコンテンツを提供する場合は、これをサポートする必要があります。

また、アプリにインテリジェントなAirPlay提案のサポートを追加するのは簡単です。

すでに説明したAVAudioSessionの設定に加えて、唯一の新しいステップは、アプリのInfo Plist、AVInitialRouteSharingPolicyキーに移動し、LongFormAudioに設定することです。

Xcodeでは、このキーはドロップダウンメニューの「AirPlay最適化ポリシー」と呼ばれます。

そして、それだけです。

iOSは残りを処理し、デバイス上の学習を使用して、アプリを開くときに使用する近くのスピーカーをスマートに提供します。

次に、AVRoutePickerViewをビュー階層に追加して、アプリにAirPlayピッカーを含めます。

ピッカーは、あなたのアプリで使用できる潜在的なAirPlayデバイスのリストを人々に提供します。

最後に、MPNowPlayingInfoCenterを使用して現在の再生アイテムについてシステムに通知し、MPRemoteCommandCenterを使用して再生、一時停止、スキップなどのリモートコマンドを受信します。

これは、AirPlay用のアプリの設定をカバーしています。

これで、強化されたオーディオバッファリングをサポートするには、これら2つのAPIセット、AVPlayerとAVQueuePlayerまたはAVSampleBufferAudioRendererとAVSampleBufferRenderSynchronizerのいずれかを採用する必要があります。

どちらのAPIも、ローカルまたはBluetoothを含む非AirPlay再生で動作します。

しかし、一部の開発者は、AirPlayと非AirPlayの再生に異なるAPIを望むかもしれません。

その場合、アプリはrouteChangeNotificationに登録し、現在のルートに応じてそれに応じて行動することができます。

AVPlayerとAVQueuePlayerは、アプリの強化されたオーディオバッファリングをサポートする最も簡単な方法を提供します。

大多数のアプリ開発者には、AVQueuePlayerを採用することをお勧めします。

AVQueuePlayerは、アイテムの管理、再生の制御、メディアによるシークなど、再生に必要なもののほとんどを処理します。

Apple独自のメディアアプリのほとんどは、AVQueuePlayerも使用しています。

開始するには、キュープレーヤーを作成します。

再生したいローカルまたはクラウドのコンテンツを指すURLを特定します。

次に、URLでAVAssetインスタンスを作成し、そのアセットでAVPlayerItemインスタンスを作成します。

最後に、AVPlayerItemをプレーヤーに渡し、再生を開始します。

それはとても簡単です。

「プレイアイテムをプレイヤーにキューに入れているだけです」と思うかもしれません。

AirPlayの部分はどこにありますか?

そして、その通りです。

AVPlayerとAVQueuePlayerを使用すると、AirPlayにルーティングされると自動的にオーディオバッファリングが強化されます。

AVPlayerの機能については、説明のリンクを参照してください。

メディアデータの前処理を実行する必要があるユニークなアプリがある場合、またはAVPlayerがサポートしていないDRMモデルがある場合は、AVSampleBufferAudioRendererとAVSampleBufferRenderSynchronizerを使用できます。

APIを使用して、複数のキューに入れられたサンプルバッファを1つのタイムラインに同期します。

ここでは、オーディオデータをキューに入れる方法の基本について説明します。

まず、すべての再生操作を実行するためのシリアルキューを作成する必要があります。

オーディオレンダラーとレンダリングシンクロナイザーを作成します。

シンクロナイザーは、メディアのタイムラインを確立するために使用されます。

次に、オーディオレンダラーをレンダリングシンクロナイザーに追加します。

これは、オーディオレンダラーにメディアのタイムラインに従うように指示します。

オーディオデータをキューに入れるには、より多くのデータが必要であることを知らせるコールバックをインストールします。

そのコールバックでオーディオデータのキューイングを開始します。

そして、オーディオデータがなくなったら、レンダラーにデータの要求を停止するように指示します。

これはインターフェイスの基本にすぎません。

詳細については、このAPIの使用方法と、カスタムプレーヤーを構築するためのサンプルプロジェクトについて詳しく説明している説明のリンクされたドキュメントを参照してください。

これは、AirPlay互換デバイスへの強化されたオーディオバッファリングを利用するために使用できる2つのAPIをカバーしています。

そして、それだけではありません。

自動車メーカーは、CarPlayの実装で強化されたバッファリングをサポートできるようになりました。

なぜこれが重要なのですか?

ワイヤレスCarPlayをサポートする車両が増えています。

ロード中で最高のオーディオ体験を得るには、堅牢な再生とレスポンシブコントロールが不可欠です。

良いニュースは、以前に話した2つのAPIの1つを使用して、アプリに強化されたオーディオバッファリングを追加することで、CarPlayでも機能することです。

あなたのアプリを使用している人々は、彼らの旅がどこに行っても最高のオーディオストリーミング体験を持つでしょう。

要約するには、AirPlayサポート用のオーディオセッションを設定し、アプリにAirPlayピッカーを追加し、Media Playerをアプリに統合し、AVQueuePlayerまたはカスタムレンダリングと同期APIを採用して、オーディオバッファリングを強化する必要があります。

これはほんの始まりにすぎません。

私たちは継続的に改善し、この技術により多くの機能をもたらすために取り組んでいます。

あなたがセッションを楽しんだことを願っています。ありがとうございます。

♪ ♪