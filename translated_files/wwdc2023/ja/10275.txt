10275

♪ ♪

アミット:皆さん、こんにちは。私の名前はアミットです。

私はAirPlayチームのエンジニアです。

AppleデバイスからAirPlay対応レシーバーにビデオ、写真、音楽などをワイヤレスで共有できるように、AirPlayを作成しました。

広告の再生、今後のリリースの予告編など、アプリケーションのプライマリコンテンツなど、複数のソースからセカンダリコンテンツを再生したい場合があります。

この二次コンテンツはインタースティシャルと呼ばれます。

アプリケーションがインタースティシャルの優れたAirPlayユーザーエクスペリエンスを持っていることを確認することに興味がある場合は、適切なセッションにチューニングしました。

この講演では、AirPlayとHLSインタースティシャルの簡単な概要から始めます。

その後、インタースティシャル再生のナビゲーション制限をAirPlayレシーバーに転送する方法について説明します。

次に、すべてのデバイスでAirPlay再生を最適化するためのベストプラクティスについて説明します。

インタースティシャルローカリゼーションとAirPlayテストについて簡単に説明します。

最後に、HLSインタースティシャルを使用したVODサービスプランの提供例を紹介します。

AirPlayは、次のいずれかの方法で使用できます。AirPlay Audio。

HomePodまたはAirPlay対応スピーカーが複数ある場合は、家中でお気に入りの音楽やポッドキャストを完璧に同期して楽しむことができます。

AirPlay Audioの詳細については、同僚のKellyによるセッション「AirPlay Audioエクスペリエンスを調整」をご覧ください。

AirPlayミラーリングを使用すると、ウェブサイト、プレゼンテーション、スプレッドシートなど、iOSまたはmacOSの画面からAirPlayレシーバーに何でも共有できます。

AirPlay Videoは、AirPlay対応テレビ、つまりApple TVまたはMacレシーバー、またはAirPlay対応スマートテレビで視聴するビデオをワイヤレスで送信するのに役立ちます。

これは、Apple TVまたはAirPlay対応テレビの両方で高品質のビデオ体験であり、サラウンドサウンドで最大4K HDRビデオをサポートできます。

HLSインタースティシャルでは、広告は主要なメディア資産のタイムラインで定義された個別の資産として扱われます。

メディアプレーヤーのタイムラインがマーカーに当たると、インタースティシャルの再生を開始します。

HLSインタースティシャルは、プライマリコンテンツの変更を必要とせず、VODまたはライブプライマリコンテンツのいずれかに対してスケジュールできます。

インタースティシャルは、再生中に動的にスケジュールまたはスケジュール外にすることができます。

HLSインタースティシャルを使用すると、主要なコンテンツが広告マーカーに近づいているときに広告を決定し、さらには再バインドする広告アセットの遅延バインディングが可能です。

たとえば、HLSインタースティシャルを使用して、すでに視聴したビデオの一部に移動すると、同じ広告が再び表示されないようにすることができます。

HLSインタースティシャルは、AirPlayとピクチャー・イン・ピクチャーのサポートを内蔵しています。

スケジュールされたすべての広告とインタースティシャルは、Airplayセッションに引き継がれるものとします。

HLSインタースティシャルは、オーディオおよびビデオストリーミングサービスに使用できます。

HLSインタースティシャルは、サーバー駆動型、クライアント駆動型の2つの方法のいずれかでスケジュールできます。

どちらの方法も、インタースティシャルのプレゼンテーションをスケジュールおよび制御するためのプロパティを設定するという点で類似性があります。

サーバーは、EXT-X-DATERANGEタグをプライマリアセットのメディアプレイリストに配置することで、インタースティシャルをスケジュールできます。

アプリケーションコードは、AVPlayerInterstitialEventMonitorオブジェクトを使用して、インタースティシャルのスケジューリングと進捗状況を監視できます。

アプリケーションコードは、AVFoundation APIを使用してインタースティシャルをプログラムでスケジュールできます。

AVPlayerInterstitialEventのオブジェクトを作成することで、広告イベントを作成できます。

AVPlayerInterstitialEventオブジェクトには、プレイヤーのアイテムタイムラインに広告を掲載するために必要なすべての情報が含まれています。

AVPlayerInterstitialEventControllerでAVPlayerInterstitialEventのすべてのオブジェクトを設定できます。

AVPlayerInterstitialEventControllerは、プライマリプレーヤーがプレイするアイテムのインタースティシャルイベントをスケジュールします。

これは、VODとライブコンテンツの再生フローの例です。

ご覧のとおり、VODとライブユースケースの両方に、連続した広告アセット、つまりad1とad2があります。

VODのユースケースでは、中断した時点で再生が再開されます。

ライブユースケースでは、再生は広告によって消費される時間によって前方にジャンプします。

プライマリコンテンツの再開オフセットは、サーバー主導またはクライアント主導の方法で設定できます。

サーバーメソッドの場合、HLSプレイリストのEXT-DATERANGEタグ内にX-RESUME-OFFSET属性を設定することで、プライマリコンテンツの再開オフセットを実現できます。

クライアントメソッドの場合、AVFoundation APIを使用して、つまり resumptionOffsetプロパティをAVPlayerInterstitialEventに設定することで、再開オフセットを設定できます。

HLSプレイリスト属性とHLSインタースティシャルのAVFoundation APIの詳細については、このセッションのリファレンスリンクを参照してください。

AirPlay Videoは、アプリ、ロック画面、コントロールセンターでiPhoneに表示される内蔵コントロールを提供しているため、テレビの音量を簡単に再生、一時停止、早送り、巻き戻し、調整できます。

AirPlayを使用すると、ユーザーはAirPlayレシーバーのリモコンを使用して同じリモートコントロールアクションを実行することもできます。

インタースティシャルでは、多くの場合、契約上の理由で、購読者が広告を飛び越えたりスキップしたりするのを防ぎたいと思うでしょう。

HLS Interstitialsには、ユーザーナビゲーション制限のサポートが組み込まれています。

2つの制限が定義されています。

スキップ: スキップ制限は、希望とは異なる速度で広告を再生するのを防ぎます。

ジャンプ制限は、現在の広告から飛び出すのを防ぎます。

この例は、視聴者が複数のインタースティシャルを横切ってシークしようとする場合、シークを完了させる前に少なくとも1つのインタースティシャルを再生する必要があります。

ナビゲーション制限は、AirPlayがアクティブな間にデバイスまたはAirPlayレシーバーで再生している間、AVKitまたはカスタムアプリケーションコードであるプレーヤーUIレベルで適用されます。

ナビゲーション制限は、スキップ、ジャンプ、スキップ、ジャンプの組み合わせで適用できます。

他のすべてのプロパティと同様に、インタースティシャルナビゲーション制限は2つの方法を使用して設定できます。

サーバー駆動型: サーバーメソッドを使用してナビゲーション制限を設定するには、HLS プレイリストは EXT-X-DATERANGE タグの下に X-RESTRICT 属性を設定する必要があります。

クライアント駆動型: この方法では、アプリケーションコードはAVPlayerInterstitialオブジェクトのプロパティ制限を設定するものとします。

上記の方法のいずれかを使用すると、Appleデバイスでのローカル再生とAirPlayレシーバーのAirPlayセッションのためのインタースティシャル再生にナビゲーション制限が課せられることを確認できます。

AirPlayレシーバーは別々のハードウェアです。

受信機はAppleデバイスでもApple以外のデバイスでもかまいます。

これは、すべてのApple以外のレシーバーがAVFoundationコードを実行していないことを意味します。

頭に浮かぶかもしれない質問の1つは、インタースティシャルのナビゲーション制限がAirPlayレシーバーによって実施されるようにするために、アプリケーションが特定のプロパティを設定するなど、コードの変更を行う必要がありますか?

ナビゲーション制限は、私たちが説明した方法の1つ、つまりサーバー駆動型、プレイリストのX-RESTRICT属性の設定、クライアント駆動型、アプリケーションコードのAVPlayerInterstitialEventオブジェクトの制限プロパティを設定して設定して、コードの変更は必要ありません。

サーバーメソッド、つまりHLSプレイリストを使用してスキップ制限がどのように適用されるかを実証するために、プレイリストの構築を始めましょう。

主な資産が10秒のプレイリストがあります。

このプレイリストをバックトゥバック広告で更新します。

このアップデートでは、プレイリストに10秒の2つの広告が追加され、プライマリアセットに5秒で再生が開始されます。

開始日は両方の広告で同じであるため、これらの広告はプレイリストに表示された順序で表示されます。

つまり、この場合、ad1が最初に再生されます。

Ad2の再生後、プレーヤーは中断したプライマリアセットの再生を再開します。

X-RESTRICT属性は、最初のインタースティシャルID、ad1でスキップするように設定されていることに注意してください。

したがって、スキップナビゲーション制限は、最初のインタースティシャル、つまりad1の再生に適用されるものとします。

ただし、ナビゲーション制限（X-RESTRICT属性）が2番目のインタースティシャルID、つまりad2に存在しないことに気付いた場合。

この設定は、広告提供に柔軟性を提供します。

では、クライアント主導の方法を見てみましょう。

ここでの例を簡素化するために、広告イベントを1つだけ追加します。それはad1です。

プライマリアイテムとイベントの開始時刻でAVPlayerInterstitialEventを作成します。

次に、異なる設定オプションを設定し、ad1eventのスキップ制限を設定します。

最後に、コントローラーにad1イベントを設定します。

レシーバーでAirPlayの再生を最適化する方法について話しましょう。

AirPlayは幅広いレシーバーでサポートされています。

これらのレシーバーには、Apple TV、セットトップボックス、メディアスティック、サウンドバー、スマートスピーカー、スマートテレビが含まれます。

AirPlayレシーバーは、異なるハードウェア、ソフトウェア、およびメディア処理機能を持つことができます。

メディア処理機能の違いにより、一部のAirPlayレシーバーは、メディアアセットを切り替えるときに遷移が遅れる場合があります。

一部のAirPlayレシーバーの移行遅延の一般的な理由の1つは、デコーダをあるビデオフォーマットから別のビデオフォーマットに切り替えるのに時間がかかることです。

一部のレシーバーのメディア処理機能の違いにより、デコーダ間の切り替えに時間がかかる可能性があり、移行遅延が発生する可能性があります。

インタースティシャルユースケースの場合、この例として、プライマリアセットはAVCでエンコードされ、インタースティシャルアセットはHEVCでエンコードされます。

AirPlayレシーバー上のプライマリメディアアセットとインタースティシャルメディアアセット間の遷移遅延を減らすために、プライマリメディアアセットとインタースティシャルメディアアセットの間でメディア操作パラメータを一致させ続けることをお勧めします。

ビデオアセットの場合、これにはビデオコーデック、フレームレート、アスペクト比が含まれます。

オーディオアセットの場合、これにはオーディオコーデック、サンプリング周波数、解像度、チャンネルレイアウトが含まれます。

プライマリコンテンツまたはインタースティシャルコンテンツ内での同期を確実にするために、メディアコンポーネントのすべてのプレゼンテーションユニット、つまりオーディオ、ビデオ、サブタイトルは、正確にタイムスタンプされ、お互いの仕様内で整列する必要があります。

インタースティシャルまたは広告の言語に基づいて加入者エンゲージメントを高める必要がある顧客のために、インタースティシャルに一致するオーディオトラックと字幕トラックを指定することができます。

インタースティシャルとプライマリアセットに同様のオーディオ/字幕トラックがある場合、インタースティシャルの再生中に自動トラック選択が適用されます。

この自動選択は、ローカル再生とAirplayセッションに適用されます。

これにはコードの変更は必要ありません。

ストリーミングアプリケーションでAirPlayをテストする際に考慮すべき考慮事項について簡単に説明しましょう。

ストリーミングアプリケーションでAirPlayビデオをテストするには、AirPlay送信機とAirPlayレシーバーデバイスでテストスイートを構築する必要があります。

AirPlayビデオ送信デバイスには、iPhone、iPad、Macが含まれます。

AirPlayビデオレシーバーには、Apple TV、Mac、および数百以上のApple TV以外のレシーバーとスマートテレビが含まれます。

これらのレシーバーのそれぞれは、ハードウェア、ソフトウェア、および再生機能に関して異なります。

ストリーミングアプリケーションでAirPlayをテストするときは、選択したレシーバーとしてApple TVから始めることをお勧めしますが、Apple AirPlay以外のレシーバーの各クラスから少なくとも1つのデバイスを選択することを強くお勧めします。

ハイエンドとローエンドのレシーバーであるメディア処理機能に基づいて、レシーバーデバイスをさらに分割できます。

たとえば、ストリーミングサービスがドルビービジョンをサポートしている場合、アプリケーションからのAirPlay再生を検証するときに、テストスイートにドルビービジョン対応のAirPlayレシーバーを含めます。

さらに、SDRとステレオAACオーディオのみをサポートするローエンドのAirPlayレシーバーを必ず含めてください。

ストリーミングアプリケーションがiPhoneなどの1つの範囲の送信者デバイスのみを対象としている場合でも、ハイエンドとローエンドの受信機を含むテストスイートを構築することを強くお勧めします。

テストするAirPlayレシーバーを選択するときは、このプレゼンテーションの参照リンクで、Appleの市販デバイスの増え続けるリストを参照してください。

VODプランの例を見ていきます。

この例のサービスプロバイダーは、3つのサービスプランを提供したいと考えています。

プランA：広告の再生中に許可される唯一のユーザー操作である広告を含むVODサービスプラン。

プランB:広告なしのVODサービスプラン。

プランC：このプランに登録している加入者は、最初の広告が終了すると、広告をスキップできます。

この例では、サービスプロバイダーは、サーバー上のプレイリストでインタースティシャルサポートの最大限の構成をしたいと考えています。

また、サービスプロバイダーは、すべてのプランに同じプレイリストを使用したいと考えています。

軽微な変更でスキップ制限を実証するために使用したものと同様のプレイリストを使用します。

このプレイリストでは、EXT-X-DATERANGEタグは、それぞれ10秒の期間のad1とad2の2つの広告をスケジュールします。

広告は、主要な資産の5秒で再生を開始します。

プレイヤーは両方の広告を再生し、中断した主要な資産の再生を再開します。

スキップ制限は、両方の広告イベントに設定されています。

プランA、つまり広告付きのVODサービスにサインアップした加入者をサポートするために、プレイリストにはすでにインタースティシャルサポートのすべてのルールがあるため、アプリケーションコードを変更する必要はありません。

広告が再生されないプランBをサポートするには、アプリケーションコードで次のAVPlayerItemプロパティを使用できます。automaticallyHandlesInterstitialEventsはfalseに設定されています。

このプロパティをfalseに設定すると、EXT-X-DATERANGEタグでサーバーによって指定されたAVPlayerInterstitialEventsは無視されます。

プランCをサポートするために、つまり、この特定のプランに登録されている加入者は、最初の広告が終了した後、広告をスキップすることができます。最初の広告、つまりad1の制限が保持されていることを確認する必要があります。

スキップ制限が削除されるように、ad2番目のインタースティシャルで設定された制限プロパティを上書きするには、クライアントアプリケーションコードで変更を行う必要があります。

ここでのサンプルコードは、HLSプレイリストのad2に設定されたナビゲーション制限をオーバーライドするためにアプリケーションコードを使用する方法を示しています。

このため、まずad1とad2のAVPlayerInterstitialEventを抽出します。

次に、ad2イベントのコピーを作成し、コピーのナビゲーション制限をクリアします。

最後に、すべてのインタースティシャルイベントのスケジュール、つまり元のad1Eventとad2Eventの修正コピーでコントローラーを更新します。

では、デモビデオを見て、すべてのプランの加入者体験をマッピングしましょう。

各デモは、同じHLSプレイリストを指しており、1つのメインコンテンツ、つまり「シェフデコレーションクッキー」と、メインコンテンツの5秒でスケジュールされた2つの広告があります。

プランAの例のデモから始めます。

AirPlayビデオをトリガーします。

これが主な内容です。

これは10秒間の持続時間を持つad1です。

スキップ制限はHLSプレイリストのサーバーによって設定されるため、購読者はこの広告をスキップまたは早送りすることはできません。

これはad2で、この購読者が広告をスキップまたは早送りできないため、スキップ制限も設定されています。

オフセット広告1からメインコンテンツの再開が予定されていました。

注：これで、購読者は前方にジャンプすることができます。

2番目のデモでは、以前のデモ、つまりテレビへのAirPlayと同様の手順を行い、広告が再生されないプランBの加入者体験を実演します。

以前のデモで使用したのと同じHLSプレイリストを使用していますが、アプリケーションコードのように、5秒にスケジュールされた広告は表示されません。メインアイテムのプロパティを自動的にHandlesInterstitialEventsをfalseに設定します。

プランCの加入者体験を実証するために、最終デモにジャンプします。つまり、最初の広告が終了すると、加入者は広告をスキップすることができます。

メインコンテンツから始めます。

これは通常料金で再生されるad1であり、加入者はこの広告をスキップまたは早送りすることはできません。

2番目の広告に設定された制限をプログラムでクリアしたため、加入者はロサンゼルスのドローンショットであるad2をスキップできるようになります。

この例を要約すると、クライアントアプリケーションコードがサーバー側のインタースティシャルのプロパティと構成を上書きする方法を実証しました。

サブスクリプションプランに応じて、同じアプリのクライアントアプリケーションコードは、AVPlayerがインタースティシャルをスケジュールし、HLSプレイリストでサーバーによって設定されたプロパティを強制し、サーバー上のHLSプレイリストで設定されたすべてのインタースティシャルを無効にして完全なオーバーライドを行い、インタースティシャルの特定のプロパティを更新して部分的なオーバーライドを行うことができます。

まとめるには、サーバーメソッドを使用してHLSインタースティシャルをスケジュールするか、AVFoundation APIを使用してクライアントアプリケーションコードでスケジュールできます。

アプリケーションコードは、サーバー側のインタースティシャルのプロパティと構成をオーバーライドすることもできます。

ローカル再生とAirPlayセッションにナビゲーション制限が確実に適用されるように、HLSプレイリストはEXT-X-DATERANGEタグにX-RESTRICT属性を設定する必要があります。または、AVPlayerInterstitialEventオブジェクトの制限プロパティを設定することで、アプリケーションコードで同じことを実現できます。

AirPlayレシーバー上のプライマリメディアアセットとインタースティシャルメディアアセット間の遷移遅延を減らすために、メディアアセット間のメディア操作パラメータを一致させ続けることをお勧めします。

ストリーミングアプリケーションでAirPlayをテストするには、テストスイートに幅広いレシーバーを含めてください。

このセッションが有益であることを願っています。

ありがとうございます。