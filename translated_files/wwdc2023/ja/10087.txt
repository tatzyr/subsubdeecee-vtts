10087

♪まろやかなインストゥルメンタルヒップホップ♪

♪

Willem Mattelaer：こんにちは、私の名前はWillemで、グループ活動に取り組んでいるエンジニアです。

ミアと一緒に、素晴らしい空間SharePlayアプリを構築する方法について話します。

SharePlayは、近くであろうと遠く離れていても、常に他の人と一緒に存在し、一緒に何かをすることでした。

このプラットフォームでは、FaceTimeで存在感を高めることができます。

このプラットフォームのFaceTimeでは、すべての空間ペルソナは、単一の窓に制限されるのではなく、あなたの部屋の物理的なスペースを占有します。

これにより、他の人と一緒にいるという感覚が高まります。

これに加えて、共有コンテキストを紹介します。

共有コンテキストとは、誰もが同じ相対的な位置にいる他の全員を見ることを意味します。

これを説明するために、2つの異なる視点を考えてみましょう。

左側はコナーの視点を示し、右側はミアの視点を示しています。

コナーがミアのペルソナを指さすと、ミアはコナーのペルソナが彼女を指差すのを見るだろう。

これをSharePlayを含む共有体験に拡張し、システムはウィンドウを誰に対しても同じ相対的な位置に配置します。

これにテンプレートを使用します。

テンプレートは、参加者と共有アプリが互いに相対的にどのように配置されるかを決定するために使用されます。

これは空間的な一貫性につながります。

アプリは変位を自分で処理する必要はなく、そのためにシステムに頼ることができます。

アプリが心配すべきことの1つは、視覚的な一貫性を持つことです。

視覚的な一貫性とは、誰もがアプリ内で同じコンテンツを見ていることを意味します。

他の人と一緒にホワイトボードの前にいることを想像してみてください。

誰もがホワイトボードの同じ見解を持つでしょう。

そして、誰かが何かを指さすたびに、他の人は彼らが指しているものを見ることができます。

私たちはSharePlayで空間体験でこれを再現したい。

以前の例に戻すと、ここではアプリには視覚的な一貫性がありません。

コナーがアプリの正方形を指すと、ミアはコナーのペルソナが円を指しているのを見るでしょう。

これは一緒にいるという錯覚を打ち破る。

しかし、アプリが視覚的な一貫性を持っていれば、ミアはコナーが広場を指していることをはっきりと見るだろう。

すべての参加者のためにコンテンツとその配置を同期させるのはアプリの責任です。

このようにして、誰もが本当に一緒にいるかのようにまったく同じアプリを見ているように感じます。

「Design spatial SharePlayエクスペリエンス」セッションでは、これらの概念について詳しく説明します。

もっと学ぶために、そのセッションを見ることを強くお勧めします。

このプラットフォームでFaceTimeで導入された新しい概念のいくつかを詳しく見てきましたが、SharePlayを採用する際にウィンドウアプリが考慮すべきことと、既存のiOS SharePlayアプリが空間設定で使用するときにエクスペリエンスを向上させるために取るべき追加の手順を掘り下げてみましょう。

その後、ミアは信じられないほどの没入型SharePlay体験を作るための新しいAPIを紹介します。

ウィンドウアプリでSharePlayをサポートするために、グループセッションの新しいシステムコーディネーターを追加しました。

システムコーディネーターは、アクティブなSharePlayセッションのシステム状態の受信と、SharePlay中に追加の設定を提供できるようにするという2つの責任があります。

ウィンドウ付きアプリと没入型アプリの両方に関連する2つについて説明します。isSpatialフラグとテンプレートの設定です。

参加者が空間的であるかどうかを知ることは、必要なレベルの視覚的一貫性を決定する際に重要です。

例えば、ここにはコナーの一人称視点があります。

彼は赤のミアと電話していて、私がSharePlayと共有した文書を見ています。

このシナリオに対するミアの視点は右側にあり、彼女はコナーを青で見ています。

コナーがスクロールするときは、スクロール位置を同期させたいと思う。

そうすれば、ミアはコナーのスクロールを見て、私たちはまだ視覚的な一貫性を持っています。

SharePlay中にフリーフォームドキュメントでパンするときに、実際にこれを行います。

しかし、あなたが空間的でない場合は、他の人が文書とやり取りするコンテキストはありません。

だから、コナーがスクロールするなら、私たちはそれを同期すべきではなく、ミアは同じ場所で文書を見続けるでしょう。

ローカル参加者が空間的であるかどうかを観察し、参加者間で同期しているものを調整するには、まずグループセッションのシステムコーディネーターを取得する必要があります。

ローカル参加者の状態でisSpatialが真であるかどうかを確認することで、ローカル参加者が空間的であるかどうかを知ることができます。

状態を観察するには、ローカル参加者状態の更新を反復する非同期シーケンスを返す localParticipantState プロパティを使用できます。

システムコーディネーターは、テンプレート設定を提供する方法もアプリに提供します。

テンプレートは、空間的な一貫性を確立するために、すべての参加者がアプリに関連してシステムによってどのように配置されるかを決定するために使用されます。

私たちは3つの異なるテンプレートをサポートしています。

並んで、すべての参加者を共有アプリに面した弧に配置します。

これは、アプリが通常のウィンドウシーンを使用しているときに適用されるデフォルトのテンプレートです。

会話テンプレートでは、すべての参加者が半円に配置され、アプリはその半円の前に配置されます。

これは、アプリのコンテンツに焦点を当てていない体験に最適です。 アプリ内のコンテンツに焦点を当てていない体験に最適です。

例えば、SharePlayで音楽を再生するとき。

最後に、サラウンドテンプレートがあります。

これにより、参加者は円に配置され、アプリは円の中央に配置されます。

このテンプレートは、アプリが体積シーンを使用している場合にのみ使用できます。

参加者とアプリの距離は、アプリのサイズに基づいています。

アプリが大きければ、人々から遠くに配置されます。

そして、アプリが小さい場合、それはより近くに配置されます。

SharePlayアプリは、システムコーディネーターを通じてテンプレート設定を提供できます。

グループセッションがアクティブな間、FaceTimeはこのテンプレートを適用しようとします。

SharePlayアプリには3つの設定があります。

.Noneは、システムのデフォルトの動作に従い、垂直アプリではサイドバイサイドになり、体積アプリではサラウンドになります。

これは使用されるデフォルトの設定です。

アプリの種類に関係なく、サイドバイサイドテンプレートを適用しようとする.sideBySideもあります。

そして最後に、対応するテンプレートを適用しようとする.conversationalがあります。

テンプレート設定を設定するには、グループセッションで参加を呼び出す前に、システムコーディネーターの設定に設定するだけです。

テンプレートは、アプリと参加者をエクスペリエンスに最適な位置に配置するために使用されます。

しかし、あなたのアプリに複数のウィンドウシーンがあり、現在複数のウィンドウシーンがフォアグラウンドされている場合はどうなりますか?

この例では、3つのシーンを持つアプリがあります。

左側に見えるのはブラウズビューです。

真ん中の小さなシーンは、コンテンツをナビゲートする簡単な方法を提供します。

そして、最後のシーンは、1つのコンテンツに関する詳細情報を提供します。

これらのシーンはすべて同時に開くことができるので、コンテンツを読みながらコンテンツを簡単にナビゲートできます。

SharePlayでは、詳細シーンを共有シーンにしたい。

しかし、それらがすべて開いている場合、テンプレートで間違ったシーンが使用される可能性があります。

それを解決するために、シーンの関連付けを追加しました。

これは、システムがアプリのどのシーンがSharePlayアクティビティをホストしているかを知るための方法です。

これを知る必要がある理由は2つあります。

まず、ウィンドウの上の共有メニューで、どのシーンが共有されているかをその人に表示できます。

これは、複数のウィンドウが開いている場合に役立つ指標であり、誰かが気づかずに誤って共有ウィンドウとやり取りしていた可能性のある恥ずかしい状況を防ぐのに役立ちます。

しかし、さらに重要なのは、どのウィンドウシーンがテンプレートで使用されるかを決定することです。

あなたのアプリがシングルシーンアプリであれば、これについて心配する必要はありません。

可能なシーンは1つしかないので、そのシーンをグループセッションに自動的に関連付けます。

ただし、マルチシーンアプリはSharePlayを採用する際にこれを考慮する必要があります。

採用されない場合は、ランダムなオープンシーンが選択され、適切なシーンではない可能性があります。

シーンアソシエーションを採用する方法を見てみましょう。

SharePlayアクティビティを開始した人に何が起こるかを見ることから始めます。

グループアクティビティが有効になったら、各シーンを調べて、どのシーンがこれを処理できるかを確認します。

これを行うには、グループアクティビティのアクティビティ識別子に対してシーンのアクティベーション条件を評価します。

シーンのアクティベーション条件は、canとprefersの2つのチェックで構成されています。

Canは、シーンが潜在的にそれを処理できることを示していますが、preferは、より理想的に適したシーンに誘導するのに役立ちます。

まず、左側のシーンをチェックして、アクティビティ識別子を処理できるかどうか、または処理したいかどうかを確認します。

それはできますが、好まいません。

次に、中間のシーンを確認しますが、それはできません。

最後に、できると好む最後のシーンを確認します。

最後のシーンが優先されるので、グループセッションに関連付けます。

識別子を処理できるシーンがない場合は、新しいウィンドウシーンを起動します。

これは、SharePlayエクスペリエンスが独自のシーンを必要とする場合に最適です。

複数のシーンを処理でき、どれも好まない場合、それらのシーンの1つがランダムに選択されます。

グループアクティビティをアクティブ化せず、それを受信している参加者の場合、アプリがすでに実行されている場合、同じロジックが実行されます。

アプリが実行されていない場合は、起動され、最初のシーンが関連付けられます。

SwiftUIアプリのライフサイクルを使用するアプリのシーンアクティベーション条件を指定するには、handlesExternalEventsを使用できます。

優先文字列または許可文字列のセットに、グループアクティビティのアクティビティ識別子を含めるだけです。

アプリがUIKitアプリのライフサイクルを使用している場合は、述語を指定することで、UIシーンのアクティベーション条件を設定できます。

シーンのアクティベーション条件の詳細については、2019年のこのセッションをチェックしてください。

もう1つ例を考えてみましょう。

この場合、各シーンが異なるドキュメントを表すドキュメントベースのアプリです。

次に、SharePlayを使用して最初のドキュメントで共同作業したいと考えています。

再びグループアクティビティ識別子を使用して、各シーンのアクティベーション条件を評価します。

残念ながら、これらのシーンには本質的に異なるものはないので、それらはすべて一致し、間違ったシーンが関連付けられます。

この場合、シーンを照合するために使用される識別子を変更したいと考えています。

これを達成するために、シーンアソシエーションの動作を追加しました。

これにより、アプリは適切なシーンを見つけるために使用される識別子を提供できます。

例に戻ると、すべての参加者が同意する各ドキュメントの一意の識別子を使用できます。

次に、その識別子を使用して適切なシーンを見つけます。

今すぐシーンを評価すると、シーンのアクティベーション条件を簡単に設定できるため、最初のシーンのみが一致し、正しいシーンの関連付けになります。

グループアクティビティのメタデータにシーンアソシエーションの動作を設定することで、使用する識別子を指定できます。

SharePlayセッションに参加する他のすべての参加者には、同じ識別子が使用されることに注意してください。

だから、誰もが同意するものを使いたいのです。

私たちは3種類のシーンアソシエーション行動をサポートしています。

デフォルトは、最初に見た動作で、シーンを関連付けるために使用される識別子がグループアクティビティ識別子になります。

名前が示すように、明示的に指定しない場合、これはデフォルトの動作です。

コンテンツの動作により、カスタム識別子を指定できます。

これは、各シーンが異なるコンテンツを表示するアプリを対象としており、グループアクティビティはそのコンテンツに関連付けられています。

最後に、私たちはなしの行動を提供します。

Noneの動作はシーンの関連付けを無効にします。

これは、シーンが関連付けられないため、アプリのシーンの上に共有バナーが表示されないことを意味します。

それはまた、空間的な一貫性が壊れていることを意味します。

これは、追加のシーンを必要としない没入型アプリや、シーンに表示されるコンテンツがSharePlayセッションの参加者ごとに異なる場合など、特定の場合にのみ使用する必要があります。

時には、グループセッションがどのシーンに関連付けられているかを知る必要があるかもしれません。

これは、複数のシーンをシーンの関連付けに選択できる可能性がある場合に発生する可能性があります。

この情報を取得するために、groupSessionIdentifierと呼ばれるグループセッションの新しいプロパティを公開しました。

このプロパティには、グループセッションに関連付けられたシーンセッションの識別子が含まれます。

シーンの関連付けは、優れたSharePlayエクスペリエンスを構築するために不可欠であるため、複数のシーンをサポートするアプリがある場合は、間違いなく適用してください。

最後に、共有メニューからSharePlayについて話しましょう。

FaceTimeでは、すべてのウィンドウの上に共有バナーがあります。

先ほど見たように、SharePlayでどのシーンが共有されているかを示します。

しかし、SharePlayにいないときにも便利です。

シーンが共有されていない場合、そのシーンを共有できるさまざまな方法が表示されます。

1つの選択肢は、単にウィンドウを共有することです。

他の誰もがウィンドウの非インタラクティブなビデオフィードを見るでしょう。

これはすべてのアプリですぐに使えます。

しかし、SharePlayアプリはこれをさらに進めることができます。

ウィンドウの現在のコンテンツに関連するグループアクティビティを公開すると、そのメニューに表示されます。

これは、SharePlayアクティビティの見つけやすさを向上させる素晴らしい方法であり、アプリのUIに専用のSharePlayボタンを持つ必要性を排除することもできます。

アプリがグループアクティビティを公開する方法は、AirDrop経由でSharePlayを開始するのと同じ方法で行われます。

iOS 17では、SharePlayアプリを開くと、AirDrop経由でSharePlayを開始できます。

グループアクティビティを取得するには、システムは表示されているシーンのUIレスポンダチェーンを通過し、レスポンダの1つのアクティビティ項目構成で指定されたグループアクティビティを見つけようとします。

そうすれば、SharePlayableコンテンツを表示しているビューコントローラーのアクティビティアイテム設定でグループアクティビティを設定するだけで、自動的にピックアップされます。

アクティビティアイテムの設定を設定するには、アクティブ化できるアクティビティを作成することから始めます。

次に、アイテムプロバイダーを作成し、グループアクティビティを登録します。

次に、アイテムプロバイダーでUIActivityItemsConfigurationを初期化します。

最後に、共有メニューに表示されるものであるため、設定が正しいメタデータが公開されていることを確認する必要があります。

これを行うには、UIActivityItemsConfigurationでmetadataProviderを使用し、LinkPresentationMetadataキーにLPLinkMetadataオブジェクトを提供できます。

タイトルと画像プロバイダは、共有メニューで使用されます。

このすべては、UIActivityItemsConfigurationReadingに準拠した独自のクラスを使用する場合でも機能します。

このプラットフォームのウィンドウ付きSharePlayエクスペリエンスを構築する際に考慮する必要がある点を取り上げました。

ミア、没入型アプリの共有体験を構築する方法を説明してもらえますか？

ミア・レン:問題ないよ、ウィレム。

それでは、没入型アプリでSharePlayがどのように機能するかを確認しましょう。

このプラットフォームでは、没入型スペースを使用して没入型体験を簡単に作成できます。

イマーシブスペースは、アプリがさまざまなイマージョンスタイルでコンテンツを境界を越えて移動できるようにする特別なシーンです。

アプリが没入型スペースを開くと、システムは他のすべてのアプリを背景にし、人々はこのアプリの無制限の世界に完全に集中することができます。

このセッションをチェックして、没入型空間と没入型スタイルについて詳しく知ることができます。

FaceTime中は、いつでも没入型スペースを起動できます。

あなたがプライベートな没入型空間にいるとき、あなたはあなた自身のプライベートな世界にいて、あなたは他のみんなと共有する文脈を壊します。

このため、システムはあなたのために他の人を隠します。

そして、彼らはあなたをあなたの連絡先写真として見るでしょう、それはあなたが今彼らと一緒にいないことを示しています。

誰もがまだ音声でコミュニケーションをとることができます。

しかし、さあ、私たちはFaceTimeで一人になりたくありません。

没入型の世界で魔法の瞬間を共有しましょう。

私は友人と共有したい没入型体験の素晴らしいアイデアをたくさん持っています。

例えば、宇宙空間でぶらぶらして、私たちの美しい惑星を一緒に探検する、このようなグループ活動かもしれません。

これを達成するために、私たちの共有アプリは、誰とでも共有できるグループ没入型スペースを設定する必要があります。

システムコーディネーターの設定では、supportsGroupImmersiveSpaceフラグを見つけることができます。

それを有効にすることで、アプリは、このアプリの没入型スペースが共有されることを意図しており、没入型のグループ活動をサポートしたいことをシステムに伝えます。

このフラグが有効になっているグループセッションに参加すると、没入型スペースはグループ没入型スペースになります。

システムは、空間の原点をテンプレートで定義された共有場所に移動し、空間の一貫性のための共有座標系を確立します。

グループの没入型空間の人々は、お互いをペルソナとして見るでしょう。

今、私たちは共有座標系とそこに人々を持つグループ没入型スペースを持っています、私たちは空間の一貫性を得るためにその中に同じ場所にオブジェクトを配置することができます。

地球探査活動の例では、原点の上の中央に地球を配置し、すべての人の原点に対して同じオフセットを適用することができます。

その後、誰もが同じ場所で地球を見るでしょう。

次に、視覚的な一貫性を維持する方法について説明します。

たとえば、地球を回転させたい場合は、その向きが全員の間で同期されていることを確認する必要があります。

GroupSessionとGroupSessionMessengerを使用して状態を同期する方法の詳細については、このSharePlayセッションをチェックしてください。

また、グループの没入型スペース内の各人に関連するいくつかのUI要素を追加することもできます。

たとえば、すべての参加者にこのようなプライベートコントロールメニューを与えることができます。

それは彼らの目の前にあります。

彼らはそれを使って、共有された地球を簡単に操作することができます。

このコントロールを適切に配置するには、ローカルユーザーがグループの没入型スペースのどこにいるかを知る必要があります。

GeometryReader3DでsystemExperienceDisplacementメソッドを活用できます。

このメソッドは、システムがどのようにスペースオリジンをローカルユーザーから遠ざけたかを示します。

変換と回転の両方を持つPose3D構造体を返します。

ローカルユーザーが空間原点の相対的な場所を取得するために、このポーズを反転させることができます。

その後、それを使用してコントロールをオフセットして回転させることができるので、ローカルユーザーに対して相対的に表示されます。

注意すべき点の1つは、ユーザーが移動しても変位が更新されないことです。

最初に配置されたときのスペースの変位のみを提供します。

これは、彼らがどこにいるかを完全に追跡することなく、その人に関連してコンテンツを配置する簡単な方法を提供します。

サラウンドテンプレートは、アプリが中央に共有コンテンツを持つグループ没入型スペースしかない地球探検活動に最適です。

しかし、グループアクティビティに共有ウィンドウとグループ没入型スペースの両方がある場合はどうなりますか?

例えば、私は人々が共有ウィンドウで惑星について読むことから始めることができる、このように太陽系を研究するためのグループ活動を構築したい。

そして、彼らはボタンを押して、グループ没入型空間で惑星モデルを詳しく見ることができます。

私は人々が両方のケースで常に並んでいてほしいです。

テンプレートで何ができるか見てみましょう。

デフォルトでは、アプリにグループ没入型スペースしかない場合、サラウンドテンプレートが適用され、スペースオリジンが中央に配置されます。

アプリにも体積シーンが共有されている場合、同じレイアウトが適用されます。

しかし、アプリに共有垂直ウィンドウがある場合、サイドバイサイドテンプレートはデフォルトで選択され、スペースの原点は共有ウィンドウのすぐ下にあります。

しかし、テンプレートの設定をいつでもグループ活動に最も適したものに変更できることを覚えておいてください。

.conversationalテンプレートまたは.sideBySideテンプレートを選択できます。これは、太陽探査活動に最適なものになると思います。

前に学んだように、テンプレート内の距離は、共有ウィンドウのサイズに基づいて動的に調整されます。

グループの没入型スペースしかないのに、どうやって距離が良いのか疑問に思うかもしれません。

これを解決するために、コンテンツ範囲と呼ばれるテンプレートを微調整するための便利なノブがあります。

これはテンプレート設定の修飾子で、没入型とウィンドウベースのグループアクティビティの両方で機能します。

アプリは、この値をコンテンツの中心からポイントの最も遠い端までの距離として設定できます。

コンテンツの範囲が設定されている場合、アクティブなテンプレートは、アプリに関連してユーザーを配置するためにこの値を考慮します。

さて、テンプレートについて学んだことを適用して、前に示したソーラー探索活動のグループセッションを設定しましょう。

まず、人々が没入しながら一緒にオブジェクトを見ることができるように、supportsGroupImmersiveSpaceを有効にする必要があります。

次に、テンプレートの設定を.sideBySideに設定し、contentExtentの修飾子を追加して、人々が常に並んでいて、共有コンテンツと大きな距離を保つことができるようにしましょう。

かっこいい。このグループ活動が人々とどのように見えるかを見てみましょう。

ここで、私は友人のコナーと一緒にいて、共有ウィンドウで惑星を並べて閲覧しています。

その後、ボタンを押すと、グループの没入型空間に入って土星を探索することができます。

私はこのモデルの美しさに驚いていますが、コナーはもう私と一緒にいないことも気付き、私が見ているのは彼の連絡先写真だけです。

しかし、実際には、コナーは取り残され、まだ窓を見ています。

グループの没入型スペースに入るには、彼は自分でボタンを押す必要があります。

前に学んだように、人々が一緒にグループの没入型空間にいないとき、彼らは共有された文脈を持っていないでしょう。

そのため、システムは空間ペルソナを非表示にし、連絡先の写真を表示します。

私たちがまだお互いのペルソナを見ることができれば、コナーは私が彼が見ていないものに驚いて見ると本当に混乱するかもしれません。

私たちのグループの没入型スペースが異なる没入型スタイルで提示されている場合、同じ状況が起こる可能性があります。

例えば、私は完全に没入型の環境で周りを見回していますが、コナーはパススルーのままです。

しかし、コナーが自動的に同じグループの没入型スペースに私についてくることができれば、とてもうれしいです。

そして、彼が私と一緒にいないとき、彼は私がどこにいるかを知っていて、簡単に私に加わることができます。

没入型グループアクティビティの分割された連絡先を最小限に抑えるために、groupImmersionStyleと呼ばれるシステムコーディネーターで利用できる素晴らしいツールがあります。

これは、オプションのイマージョンスタイルの非同期シーケンスを提供し、他の人が参加するグループ没入型スペースの特定のイマージョンスタイル、またはグループ没入型スペースを離れるときにnilをアプリに伝えます。

たとえば、グループ没入型スペースを開くと、コナーのアプリはその没入型スタイルを受け取り、彼のアプリは一致するスタイルでグループ没入型スペースを開くことができます。

その後、私たちはグループの没入型空間で一緒になり、再びコンテキストを共有します。

同様に、コナーがボタンを押してグループの没入型スペースを離れると、私のアプリはゼロを受け取り、没入型スペースを却下することができます。

今、グループイマージョンスタイルの助けを借りて、誰もがいつでも一緒にいることができます。

時には、緊急の何かのために一時的に没入型体験から抜け出したいと思うかもしれません。

デジタルクラウンを1回押すだけでできます。

この場合、システムは他の人の邪魔をせず、グループイマージョンスタイルを変更します。

外に出ると、SharePlayバナー通知が表示されます。これは、グループの残りの部分がどこにいるかを知らせ、グループの没入型スペースに簡単に参加するためのボタンも提供します。

参加ボタンをタップすると、グループイマージョンスタイルがアプリに送信され、グループ没入型スペースが設定されます。

さて、私たちはこのセッションで多くのことを見ました。

まとめましょう！

共有コンテキストと、システムコーディネーターとシーンアソシエーションを使用して、ウィンドウと没入型共有アプリの両方で空間的および視覚的な一貫性を管理する方法について学びました。

アプリが人を適切に配置するためのテンプレート設定を導入しました。

そして最後に、共有メニューを使用してSharePlayを開始する新しい方法も紹介しました。

チューニングしてくれてありがとう。

SharePlayでどのような素晴らしい体験を構築するかを見るのが待ちきれません。

♪