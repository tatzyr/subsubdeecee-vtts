10025

♪ ♪

アルテム:こんにちは、私の名前はアルテムです。

私はApple Push Notificationsチームのエンジニアです。

プッシュ通知コンソールを紹介できることを嬉しく思います。

これは、プッシュ通知をアプリに統合するのに役立ついくつかの機能を組み合わせたまったく新しいツールです。

まず、コンソールからいくつかの通知を送信します。これは、エンド・トゥ・エンドのテストに役立ちます。

次に、配信ログ機能を使用して、いくつかの一般的な問題を分析します。

そして最後に、認証とデバイストークンを扱うために活用できるいくつかの追加ツールを紹介します。

まず、プッシュ通知の基本をいくつか取り上げます。

プッシュ通知は、アプリケーションやウェブサイトからユーザーのデバイスに送信される短いメッセージです。

それらは、アプリの機能を拡張するための非常に強力なツールです。

毎秒何百万ものプッシュ通知がAppleデバイスに配信され、ユーザーエクスペリエンスを豊かにします。

これらの通知はリアルタイムで配信され、タイムリーで関連性の高い情報をユーザーに提供するように設計されています。

これにより、アプリケーションの更新に関して、よりダイナミックな体験が可能になります。

プッシュ通知は、ユーザーエンゲージメントを高め、アプリを常に最新の状態に保つのに役立ちます。

これがどのように機能するかの簡単な概要です。

プッシュ通知の配信を可能にするバックエンドは、Appleプッシュ通知サービス、略してAPNsと呼ばれます。

通知のストーリーは、アプリからの通知を許可するようユーザーに促すときに始まります。

ユーザーが同意した場合、デバイストークンはAPNsによって生成され、デバイスに送信されます。

そのトークンは、その特定のデバイス上のアプリを一意に識別します。

通常、トークンはアプリケーションサーバーに転送され、将来の使用のために保存されます。

サーバーがプッシュ通知を送信したい場合、保存されたデバイストークンを使用してAPNsを介して通知に対処します。

その後、APNsは、対応するトークンを使用してデバイス上のアプリに通知を配信します。

デバイストークンは変更される可能性があるため、正確で信頼性の高い配信のためにサーバー側で最新の状態に保つことが不可欠です。

プッシュ通知コンソールは、APNsと対話するためのさまざまな機器を提供するまったく新しいツールです。

アプリを開発し、それにプッシュ通知を追加する場合は、エンドツーエンドでテストする簡単な方法が欲しいかもしれません。

そこで送信機能が役に立ちます。 送信機能が便利です。

私はBackyard Birdsアプリを開発しています。

今は春で、越冬地から戻ってくる鳥もいるので、それについてユーザーに知らせたい。

新しい通知を作成します。私は新しい通知を作成します。

名前を付け、電話でアプリのデバイストークンを提供し、いくつかのペイロード属性を埋めます。

タイトルにはアプリの名前を使います。

サブタイトルには「重要なアップデート」と書かれています。そして、体は「ロビンズが帰ってきた」というメッセージになります。

準備ができたので、送信をクリックします。

デバイスがプッシュを受信すると、通知が表示されます。

このページから送信された通知の履歴は、左側のサイドバーに保存されています。

最後の通知を再利用したいのですが、メッセージを少し変更します。

送信されたばかりのメッセージをコピーして、新しい通知を作成します。

ここで、それに名前を付けてください。

そして、このスイッチを切り替えると、生のJSON形式でペイロードを入力できます。

コピーしたペイロードを挿入して、メッセージを別のものに変更します。

同じデバイストークンを供給し、送信します。

そして、デバイスは更新された通知を受け取ります。

コンソールでは、多くの種類の通知やさまざまな属性をテストできます。

環境を指定できます...

異なるプッシュタイプを試してみてください...

正確な有効期限を設定します...

異なる優先順位を試してみてください...

そして、あらゆる種類のペイロードを送信します。

次に、配信ログ機能について説明します。

送信した通知が届かない場合があり、何が起こったのか不明な場合があります。

このツールを使用すると、そのようなケースを分析するのに役立つかもしれません。

通知がAPNsスタックを通過すると、その配信プロセスを反映したイベントが記録されます。

そして今、通知が送信されたときにAPNsが返す新しいヘッダーを使用して、その情報を取得できます。

これがその仕組みです。

デバイスは、低電力モードを有効にすることで、通知が受信されない状況をエミュレートできます。

次に、[送信]タブに移動し、通知の1つを再送信します。

名前を付け、ペイロードを貼り付け、デバイストークンを提供し、将来の有効期限を設定します。

しかし、今回は「送信」をクリックした後、通知はデバイスに表示されません。

何が起こったのかを知るために、APNsがHTTPレスポンスで返す新しいタイプのID「apns-unique-id」をコピーします。

「配信ログ」タブに切り替えた後、コピーしたIDを入力できる検索フィールドが表示されます。

検索を実行すると、APNsスタックを通過した通知の履歴を見ることができます。

ここで最後のイベントは「デバイスの電源に関する考慮事項のために保存」であり、メッセージが配信されなかった理由を説明しています。

この場合、電話は低電力モードだったので、バッテリーを節約するためにいくつかの通知の受信を延期しました。

低電力モードが無効になっていると、通知が受信され、デバイスに表示されます。

配信後、対応する更新は配信ログでも見ることができます。

このツールを使用すると、さまざまな状況を分析できます。

各履歴イベントは、何が起こったのかだけでなく、対応するツールチップでその理由も説明しています。

たとえば、デバイスがオフラインの場合、通知はAPNsストレージに移動したり、アプリがデバイスから削除された場合は破棄することができます。

ツールで作業を開始すると、より多くの例が見つかります。

この機能は、通常のAPNs APIを介して送信される通知でも利用できます。

この情報を照会するには、APNs応答から「apns-unique-id」を記録する必要があります。

また、コンソールから送信された通知については、「配信ログ」タブに切り替える必要はなく、同じ情報が送信ページ自体で入手できます。

アプリをAPNsと統合すると、認証と通知の送信に使用されるさまざまな種類のトークンで作業し、コンソールにはさまざまな便利なツールも提供されます。

まずは認証を取り上げましょう。

APNsの認証には、証明書ベースとトークンベースの2種類があります。

証明書ベースの認証は、サーバーとAPNsの間に信頼できる接続を確立するためにSSL証明書に依存しています。

Apple Developerポータル内で、各アプリと環境の証明書を作成および管理する必要があります。

証明書は期限切れになり、定期的に更新する必要があることを覚えておいてください。

トークンベースの認証は、プロバイダーサーバーとAPNs間の安全で効率的な認証のためにJSON Webトークンを使用します。

Apple Developerアカウントに関連付けられた秘密鍵で署名されたトークンを生成する必要があります。

秘密鍵は証明書のように期限切れになりません。

プッシュ通知コンソールの一部として、認証トークンを生成できるツールがあります。

あなたがする必要があるのは、開発者ポータルから入手した秘密鍵を提供することだけです。

そして、関連するキーID。

これらの作品を供給した後、新しいトークンが生成されます。

その後、それを使用してAPNsに対するリクエストを認証できます。

これらのトークンの有効期間は1時間を超えないため、定期的にローテーションする必要があることに注意してください。

そして、トークンを生成すると、キーはどこにもアップロードされません。

ブラウザでのみ使用されるため、個人情報は保存されます。

すでにトークンを持っているが、機能していないと思われる場合は、別のツールである認証トークンバリデーターを活用できます。

生成したばかりのトークンを取って、検証ツールに貼り付けます。

ここでは、この場合のようにトークンが有効であることを確認するか、そうでない理由を提供する検証結果を取り戻します。

たとえば、少し前に使用したトークンを提供すると、検証結果は「発行された」クレームが古すぎることを教えてくれます。これは事実上、トークンの有効期限が切れていることを意味します。

そして最後に、デバイストークンバリデータがあります。

覚えているように、これらのトークンは、通知を送信するときに受信者を指定するために使用されます。

それらは具体的な環境とプッシュタイプに結びついています。

トークンを入力すると、トークンが有効である環境とプッシュタイプ（ある場合）を指示する応答が表示されます。

たとえば、以前にデモンストレーションで使用されたトークンを提供すると、アラートとバックグラウンドのプッシュタイプと開発環境に有効であることがわかります。

うまくいけば、これらの機能を使用して楽しんで、プッシュ通知をアプリに統合しやすくなり、人々に新しいエキサイティングな機能を提供します。

今日から始めましょう。

テスト統合にプッシュ通知をエンドツーエンドで送信します。

配信ログを調べて、配信プロセスに関するより良い洞察を得る。

コンソールからトークンを検証し、新しいトークンを生成します。

クライアントへのプッシュ通知の実装の詳細については、WWDC20の「プッシュ通知プライマー」ビデオをご覧ください。

見てくれてありがとう。

♪ ♪