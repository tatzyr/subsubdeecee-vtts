10027

♪ ♪

キャサリン：こんにちは！私はキャサリンで、システムエクスペリエンスに取り組んでいるエンジニアです。

今日は、ウィジェットの新しい場所と、どこでも見栄えを良くするためにウィジェットを簡単に最適化する方法について説明します。

まず、ウィジェットの簡単な履歴を調べてみましょう。

iOS 14はホーム画面にウィジェットを導入し、iOS 16は同じ簡単なWidgetKit APIを使用してロック画面にウィジェットを導入しました。

今年、ウィジェットエコシステムは、Macのデスクトップ、iPadのロック画面、iPhoneの新しいスタンバイモード、Apple Watchの新しいスマートスタックの4つの新しい場所に拡大しています。

これは、人々がさらに多くの場所でお気に入りのウィジェットをすべて見ることができることを意味します。

ウィジェットはこれらすべての場所に自動的に表示されるので、どこに表示されても見栄えがよいことを確認することが重要です。

MacのiPhoneウィジェットのおかげで、現在macOSアプリを持っていなくても、人々はMacでウィジェットを使用することができます。

私の友人のデボンとグラハムは、これらの新しい場所の準備をするために、絵文字レンジャーウィジェットを更新するのを手伝うように私に頼みました。

WWDC20の「Widgets code-along」とWWDC22の「Complications and widgets: Reloaded」からこのプロジェクトを覚えているかもしれません。

まず、ウィジェットの新しいコンテンツマージンと、Apple Watchでそれらに移行する方法について説明します。

次に、ウィジェットに自動的に取り外し可能な背景を追加します。

次に、ウィジェットを変更して、環境に合わせてレイアウトを動的に拡張できるようにします。

最後に、ウィジェットの要素が鮮やかなレンダリングの準備ができていることを確認します。

始めましょう。

今年のウィジェットの新機能は次のとおりです。

コンテンツマージンは、ウィジェットの本体に自動的に適用されるパディングであり、コンテンツがウィジェットコンテナの端に近づくのを防ぎます。

これらのマージンは、ウィジェットが表示されている環境に応じて、大きくなるか小さくなる可能性があります。

watchOS 9以降では、ウィジェットはシステム定義のセーフエリアを使用して、コンテンツがエッジに近づきすぎないようにしています。

ウィジェットは、ビューにignosingsSafeAreaなどの修飾子を追加して、セーフエリアの外に拡張できるようにすることができます。

watchOS 10以降では、ウィジェットの安全な領域はコンテンツマージンの使用に置き換えられました。

これは、ignionsSafeAreaのような修飾子がウィジェットに影響を及ぼさないことを意味します。

ほとんどのウィジェットでは、この変更はウィジェットの外観には影響しません。

ただし、ウィジェットにセーフエリアを無視していたコンテンツがある場合でも、ウィジェットの設定にcontentMarginsDisabled修飾子を追加することで、この同じ効果を実現できます。

次に、デフォルトのコンテンツマージン内にとどまるべきコンテンツについては、単にパディングを追加します。

widgetContentMargins環境変数を使用して、現在の環境のデフォルトのマージンを取得できます。

コンテンツマージンは、これらの新しい修飾子と変数とともに、ウィジェットが表示されるすべてのプラットフォームで利用できます。

では、絵文字レンジャーズウィジェットに取り外し可能な背景を追加しましょう。

既存のアクセサリーファミリのウィジェットは、iPhoneと同じようにiPadのロック画面で自動的に動作します。

iPadは、システムの小さなウィジェットをすぐ横に表示することもできます。

これが今のロック画面で私たちの姿です。

他のウィジェットとよりよく一致するように、この環境で背景を削除する必要があります。

幸いなことに、これを行うのはとても簡単です。

ここに私たちのsystemSmallウィジェットのビューのコードがあります。

現在、ZStackを使用してゲーム背景色の上に重ねられたAvatarViewで構成されています。

背景色を取り外し可能にするには、変更する必要があるのは、ViewにcontainerBackground修飾子を追加し、ゲームBackground色を内部に移動することだけです。

それを行うと、システムは表示されている場所に応じてウィジェットの背景を自動的に取り出すことができます。

Apple Watchのスマートスタックは、この新しいコンテナの背景を利用することもできます。

デフォルトでは、アクセサリー長方形ウィジェットは、この環境で暗い素材の背景を受け取ります。

同じcontainerBackground修飾子をビューに追加することで、ウィジェットは他のウィジェットと同じ背景に配置され、アプリのビジュアルアイデンティティとリンクされます。

この新しい環境をより深く掘り下げるには、「Apple Watchのスマートスタックのデザインウィジェット」をチェックしてください。

写真やマップのウィジェットのような一部のウィジェットには、実際には明確なフォアグラウンドコンテンツがないため、削除する意味のある背景はありません。

この場合、containerBackgroundRemovable修飾子をWidgetConfigurationに追加し、falseに設定できます。

それでは、iPadのロック画面とスタンバイモードのときのために、レイアウトを最適化しましょう。

天気ウィジェットは、ウィジェットの背景が削除されたときにレイアウトを変更する方法の素晴らしい例です。

ウィジェットにはまだ同じ情報が含まれていますが、スペースを利用するように最適化されていることに注目してください。

コンテンツは端までプッシュされ、重要な要素が拡大されます。

これらの調整により、ウィジェットは遠くから読みやすくなり、よりシームレスにスタンバイモードに統合されます。

これらのレイアウトの変更は、ウィジェットがiPadのロック画面のアクセサリファミリーウィジェットに溶け込むのにも役立ち、すべての家族間でより一貫した外観を維持します。

Xcodeに移動して、これらの変更を独自のウィジェットに実装しましょう。

ここにAvatarViewのコードがあります。これは、systemSmallウィジェットに使用するものです。

右側には、Xcodeプレビューでウィジェットがどのように見えるかのライブプレビューを見ることができます。

コンテナの背景が削除されたコンテキストで表示されると、ウィジェットコンテンツマージンは自動的に縮小され、コンテンツが端から端まで表示されます。

showsWidgetContainerBackground環境変数を使用して、ウィジェットの背景が削除されたかどうかを検出できます。

その場合は、ヒーロー名ビューからヒーローのレベルとXPの詳細を省略し、代わりにその詳細を以下に表示しましょう。

これはまた、この環境にいるとき、私たちのヒーローの名前を大きくします。

これらのコンテキストを切り替えると、レイアウトは元のビューから新しい拡大ビューに自動的に変更されます。

アクセサリーファミリーウィジェットと同様に、当社のシステムファミリーウィジェットは、iPadのロック画面の鮮やかなレンダリングモードで表示されます。

これは、ウィジェットが不飽和になり、ロック画面の背景に合わせて適切に色付けされることを意味します。

このようにレンダリングすると、コントラストの問題がウィジェットの読みやすさに影響を与える可能性があります。

例えば、私たちのヒーローのアバターは、その円形の背景と区別するのが難しくなります。

Xcodeに戻り、ウィジェットを変更して、鮮やかなレンダリングモードでその背景を削除しましょう。

スタンバイナイトモードでこれをチェックしましょう。

widgetRenderingMode環境変数を使用して、どのレンダリングモードにあるかを検出できます。

アバターのincludesBackgroundパラメータを変更して、鮮やかなレンダリングモードにあるかどうかを確認しましょう。

スタンバイナイトモードも鮮やかなレンダリングを使用しているので、私たちのアバターはこの文脈でもはっきりと見えます。

ウィジェットのレンダリングモードの詳細については、WWDC22の「コンプリケーションとウィジェット：リローデッド」をご覧ください。

また、ウィジェットの新機能の詳細については、「ウィジェットに命を吹き込み」をチェックしてください。

私はウィジェットにやってくるすべての変更に非常に興奮しており、これらの新機能でウィジェットを強化するためにあなたが思いつくアイデアを見るのが待ちきれません。

ありがとう、そして楽しんでください!

♪ ♪