10274

♪まろやかなインストゥルメンタルヒップホップ♪

♪

こんにちは、私の名前はシュアイソンで、ARクイックルックチームのエンジニアです。

今日は、クイックルック空間体験用の3Dモデルを作成する方法を説明します。

それに入る前に、まずクイックルックとは何か、それを使用して新しいプラットフォームで3Dコンテンツを表示する方法を見てみましょう。

別のセッション「空間コンピューティングのクイックルックを発見」では、新しいルームプランAPIを使用して作成した部屋のこの素敵な3Dモデルをお見せしました。

アプリケーションウィンドウからUSDZファイルをドラッグするだけで、このモデルをクイックルックに持ち込みました。これにより、ドロップした場所にクイックルックプレビューが開きます。

ここから、使い慣れたジェスチャーを使用して、クイックルックと私のコンテンツとの対話を開始できます。

このモデルの背後にあるストーリーを深く掘り下げる前に、システムがクイックルックで3Dコンテンツをどのように表示するかについてもう少し話しましょう。

このプラットフォームでは、クイックルックはボリュームウィンドウに3Dモデルを表示します。

ボリュームウィンドウは、他のアプリと一緒に共有できるように境界を定義しています。

人々は空間でボリュームを再配置することができ、さまざまな角度からそれを見ることができます。

3Dモデルは常にボリュームの中央に配置されます。

モデルが最初に表示されると、クイックルックは、コンテンツが直接あなたに向くようにボリュームウィンドウを方向付けます。

ここから、3Dモデルの下にあるボリュームウィンドウバーを使用して、スペース内のコンテンツを自由に再配置できます。

クイックルックは、プレビューセッション中にモデルをスケールする方法に基づいて、ボリュームのサイズを自動的に調整します。

コンテンツがアニメーションを使用している場合は、すべてのアニメーションをクイックルックボリュームの定義された境界内に保持することをお勧めします。

クイックルックが3Dコンテンツをどのように提示するかの基本を取り上げました。

クイックルックがモデルのサイズとスケールをどのように使用しているかに関しては、追加の考慮事項があります。

見てみましょう。 

3Dモデルを読み込むとき、クイックルックはUSDZのメタデータで定義されたmetersPerUnitを尊重し、現実世界に対するスケール単位を決定します。

人々が資産の規模を視覚化するのを助けるために、クイックルックは、特定のサイズ範囲内にあるように作成されている場合、モデルを最初に100%のスケールで提示しようとします。

例を見てみましょう。

クイックルックは、このブリキの車のような小さなスケールで来た場合でも、すべてのコンテンツを楽しむことができるように最小スケールを課します。

クイックルックはまた、非常に大きなオブジェクトを表示している場合に上限を使用して、他のアプリと一緒にスペースを占有しすぎないようにします。

このティーポットなど、その間のサイズを持つオブジェクトの場合、クイックルックは最初に宇宙で打ち上げられたときにモデルの現実世界のサイズを使用します。

ボリュームウィンドウの下にあるボタンをタップすると、いつでも実際のサイズでモデルを表示できることを忘れないでください。

クイックルックがモデルのサイズをどのように処理するかがわかったので、クイックルックがコンテンツを表示するときに追加する2つのことを見てみましょう。グランドプレーンとシャドウです。

クイックルックは、モデルの下に平面と影を自動的に表示し、モデルのサイズと地面に対する位置をよりよく理解できるようにします。

クイックルックはあなたのためにこの仕事をしているので、モデルに独自のグランドプレーンとシャドウを追加しないことをお勧めします。

これまでのところ、クイックルックが3Dコンテンツを表示する方法の基本を取り上げました。

このセッションの残りの部分の議題を順を追って説明しましょう

まず、3Dモデルを作成する方法をいくつか検討します。

次に、コンテンツの視覚品質を検査し、必要に応じて調整する方法について説明します。

最後に、3Dコンテンツを優れたパフォーマンスでレンダリングして実行できることを確認する方法について説明します。

3Dコンテンツの準備を始めましょう。

クイックルックは、3Dモデルを処理するための主要なフォーマットとしてUSDZを受け入れます。

USDZは、Appleプラットフォーム向けの3Dコンテンツの中心であり、軽量で日陰用に最適化されているように設計されています。

USDZファイルを作成する方法を見てみましょう。 

USDZファイルを作成する方法はたくさんあります。

まず、以前にiOS用のUSDZファイルを作成したことがある場合は、この新しいプラットフォームでクイックルックに同じファイルを使用できます。

新しいUSDZファイルをゼロから作成する場合は、プロのデジタルコンテンツ作成ツールを使用して3Dコンテンツを作成し、USDZファイルとしてエクスポートできます。

RealityKit Object Capture APIを使用して、3Dモデルをスキャンし、現実世界のオブジェクトのUSDZファイルを作成することもできます。

オブジェクトキャプチャは、さまざまな詳細レベルで3Dモデルを作成するのに役立つサンプルアプリとともに、エンドツーエンドの写真測量ソリューションを提供します。

オブジェクトキャプチャは、iOSとmacOSの両方のデバイスでサポートされています。

最後に、あなたの家の上に2Dまたは3Dのフロアプランを作成する方法を探しているなら、私たちはRoomPlan APIであなたをカバーしています。

先ほどお見せした3Dルームモデルのバックストーリーがあると言ったのを覚えていますか？

3Dデザイナーのジェリーがこの3Dモデルを作成するために使用したワークフローに飛び込みましょう。

まず、JerryはRoomPlanサンプルアプリケーションを使用して部屋をスキャンし始めます。

短時間で、彼は自分の部屋の3Dレイアウトをプレビューしたり、USDZファイルをエクスポートしてMacに直接ドロップしたりできます。

次に、ジェリーは3Dモデルを3Dコンテンツ作成ツールにインポートし、デザインコンセプトに命を吹き込みます。

これがその仕事の結果です。

このモデルは素晴らしく見えます。

壁、床、その他の部屋の要素にいくつかの素材や質感が追加されたのを見ることができます。

今、ジェリーが作成したルームモデルは、クイックルックでプレビューする準備がほぼ整いました。

幸いなことに、この次のステップを本当に簡単にするReality Composer Proと呼ばれる新しいツールがあります。

クイックルックのために3Dモデルをプレビューすることは、モデルの実際の品質を検査し、必要に応じて調整を行うためのコンテンツ作成ワークフローの本当に重要なステップです。

詳しく見てみましょう。 

これは、メインビューにロードされた3Dモデルを備えたReality Composer Proです。

Reality Composer Proの右上隅にあるこのボタンをクリックするだけで、デバイス上のクイックルックで3Dモデルを簡単にプレビューできます。

そして、これはクイックルックで実行されている同じ3Dモデルです。

私たちが今気づくことができる1つのことは、最初のモデルの向きが正しく見えないということです。

以前に説明したように、魅力的な体験を作成するために、3Dモデルの最も興味深い部分があなたに向かって提示されるようにすることが重要です。

これを修正する方法を見てみましょう。 

クイックルックは右側の座標系を使用しています。

これを知ることで、コンテンツ作成ツール、またはここReality Composer Proで3Dモデルの向きを簡単に修正できます。

私たちの場合は、モデルのリビングルームが見えるように、垂直軸でモデルを回転させる必要があります。

このように、ここにy軸の周りに90度を置くことで、これを修正できます。

Reality Composer Proのデバイスプレビューを使用して、モデルの変更を確認しましょう。

今、向きは固定されており、私たちはこの見栄えの良いモデルについてはるかに良いビューを持っています。

さて、この資産をさらに探求し、別の視点を得て、ここでもう少し詳細を見てみましょう。

これを行うには、ピンチとドラッグジェスチャーを使用して3Dモデルを回転させ、さまざまな側面から表示できます。

これは、私たちの部屋のさまざまな部分について本当に良い眺めを与えてくれます。

また、両手のピンチジェスチャーを使用して、モデルを拡大縮小し、詳細を確認することもできます。

デバイスのクイックルックで3Dモデルを検査する方法を見たので、コンテンツの視覚的品質を向上させるためのいくつかの考慮事項について話しましょう。

複数のオブジェクトが同じ場所にレンダリングされると、それらが重なり、単一のちらつきオブジェクトとして表示される場合があります。

この問題を軽減するために、3D作成ツールを使用して、オーバーラップを削除するか、ちらつきオブジェクト間の距離を増やすことで、メッシュジオメトリを最適化できます。

高周波ノーマルマップの使用は避けてください。特に、動いている状況や3Dモデルに近い状況では、不要な視覚的アーティファクトを作成する可能性のあるエイリアシングの問題が残るため、避けてください。

葉などの小さいまたは薄いオブジェクトをレンダリングする場合、システムは可変ラスタライズレートで時間の経過とともに一貫してサンプリングされない可能性があり、周辺部でちらつきを引き起こす可能性があります。

この問題を最小限に抑えるために、細かいジオメトリの詳細を不透明度テクスチャに保存し、代わりに大きな三角形のグリッドを持つジオメトリを使用してレンダリングすることができます。

可変ラスタライズレートの詳細については、セッション「空間コンピューティングのレンダリングを探る」をご覧ください。

次に、パフォーマンスに注意を向けましょう。

ここでは、クイックルック3Dコンテンツの解剖学と、スムーズでシームレスなクイックルック空間体験を確保するために何ができるかを見ていきます。

始めましょう。

クイックルックでレンダリングされるコンテンツの3Dパフォーマンスを決定する多くの要因があります。

3Dモデルのファイルサイズ、テクスチャの数と解像度、さらにはモデルに使用している素材の複雑さなど。

パフォーマンスのために3Dモデルの最適化を開始する場所を知るには、まず資産に存在する可能性のある潜在的な制限を特定する必要があります。

このタスクを簡素化するために、今年はワークフローを大幅に改善できる便利な新しいツールを導入しました。

見てみましょう。 

ここでは、Statisticsパネルを表示するためにReality Composer Proに戻ってきました。

このパネルは、三角形の数やコンテンツで使用されるテクスチャメモリの量など、3Dモデルの特性に関する多くの有用な情報を提供します。

あなたが自由に使えるもう一つの素晴らしいツールは、RealityKit Traceです。

このツールは、さらに高度なランタイムプロファイリングを可能にします。

RealityKit Traceは、特定のレンダリングパイプラインへの洞察を提供します。

これにより、3Dコンテンツを使用して、個々のレンダリングフレームにより多くの情報を得ることができます。

キャプチャされた複数のフレームを分析することで、RealityKit Traceを使用して、潜在的なパフォーマンスの問題や制限を特定して診断し、推奨事項を与えることができます。

RealityKit TraceはXcodeで構築し続けます。

クイックルックでコンテンツのプロファイリングに使用するには、クイックルックプロセスに添付する必要があります。

Reality Composer ProとRealityKit Traceの詳細については、以下のセッションをご覧ください。

潜在的なパフォーマンス制限のプロファイリングを行うのに役立つツールのいくつかを見てきましたが、パフォーマンスのために3Dコンテンツを最適化するのに役立つベストプラクティスのいくつかを見ていきます。

先ほど、クイックルックの3Dコンテンツのパフォーマンスを決定するさまざまな要因について言及しました。

では、それに応じてコンテンツを最適化するために何ができるかという観点から、それらを1つずつ見てみましょう。

まず、ファイルサイズに合わせてモデルを最適化することです。

ファイルサイズが小さいほど、ユーザーがコンテンツを操作する前に長時間待たせたくないため、通常、ダウンロードが速くなり、読み込み時間が短縮されます。

ここでのコツは、資産の品質とファイルサイズの間で最適化されたバランスを見つけることです。

たとえば、より詳細なテクスチャや低品質のオーディオソースを使用できます。

時々、資産はいくつかの反復サイクルにわたって開発されます。

多くの場合、これには、アセットにリンクされた基礎となるオーディオ、アニメーション、テクスチャの変更が含まれます。

ファイルサイズを最小限に抑えるには、配布される最終パッケージに実際に使用されているもののみを含めるようにしてください。

たとえば、シーンに使用されなくなった古いバージョンのオーディオファイルは、配布前に最終的なアセットから削除する必要があります。

最後に、より良い共有体験を確保するために、ファイルサイズを25メガバイト未満に保つことをお勧めします。

次に、パフォーマンスのために3Dコンテンツジオメトリを最適化する方法を見てみましょう。

繰り返しますが、コツは、素晴らしいレベルの詳細を示すことと、素晴らしいパフォーマンスを達成することの間の適切なバランスを見つけることです。

モデルが別のジオメトリで非表示または完全に覆われている部品を使用している場合、つまり画面に表示されない場合は、パフォーマンス予算を節約するためにそれらを削除しても問題ありません。

また、システムの負荷を減らすために、小さなメッシュを1つの大きなメッシュに統合することを検討してください。

単一のモデルの場合、200メッシュ部品と100k未満の頂点以下に保つことをお勧めします。

メッシュの詳細とシーン内の別の資産とのバランスをとることを常に覚えておいてください。

次に、テクスチャを見てみましょう。 

テクスチャは多くのメモリ使用量に貢献できます。

自動化されたテクスチャはより少ないメモリを消費し、より多くのアセットを同時にロードし、複雑なシーンをスムーズに実行できるようにします。

テクスチャの予算を節約する1つの方法は、非色の入力にグレースケールを使用することです。

場合によっては、グレースケール画像をカラーテクスチャを介して個々のチャンネルにパックして、複数のグレースケールマップを1つのテクスチャに保存することもできます。

可能であれば、テクスチャから読み込むのではなく、材料に一定の値を使用してください。

モデルが単一のPBR素材のみを使用している場合は、最大テクスチャサイズが2K×2Kで、チャンネルごとのテクスチャあたり16ビットではなく8ビットを使用することをお勧めします。

最後に、3Dモデルに最も価値とリアリズムを追加する領域にテクスチャ予算を常に費やすようにしてください。

次は材料です。

材料は3Dモデルの表面特性を定義する。

彼らは、その色や、オブジェクトが光沢のある外観または反射的な外観で表示されるかどうかなど、システムがモデルをどのようにレンダリングするかを指定します。

3Dモデルの材料の最適化に関しては、メッシュ部品を組み合わせて同じ材料と共有することで、積載時間を短縮できます。

これが役立つ理由は、3Dモデルにカスタム素材がある場合、システムが初めてロードするときにそれらをコンパイルしなければならないからです。

素材の複雑さと画面サイズのバランスをとるようにしてください。

たとえば、画面の小さな部分が透明であるか、透明なコートが必要な場合は、その小さな領域のためだけに別の材料を使用する方が効率的です。

重複する透明性に常に留意する必要があります。

透明なオブジェクトをリアルタイムでレンダリングするには、通常、不透明なオブジェクトと比較してより多くの計算が必要になるため、本当に必要なときにのみ透明性が重複します。

また、照明を焼いたり、メッシュの一部が照明を必要としない場合は、MaterialX Unlit surfaceを使用してリアルタイムの照明計算を保存することをお勧めします。

次に、物理学を見てみましょう。

物理学シミュレーションは、特に物理学システムが衝突検出を実行し、重力やスプリングなどの現実的な効果をシミュレートする場合、計算コストがかかる場合があります。

物理を使用してコンテンツのパフォーマンスを最大化するには、使用されているコライダーの総数を減らすことができます。

コンテンツに物理シミュレーションに参加してもらいたい場合がありますが、コンテンツには、移動したり、別のオブジェクトの影響を受けたりしないはずのエンティティが含まれます。たとえば、仮想ボールを跳ね返らせる壁などです。

この場合、物理計算を減らすために静的コライダーを使用することをお勧めします。

次に、アニメーションについて話しましょう。

3Dモデルにアニメーションを追加することは、コンテンツに命を吹き込むのに最適な方法です。

時には、必要なのはアイドルアニメーションだけです。

この場合、アニメーションの頂点あたりの重量数を制限して、効率的でリアルなアニメーションを作成するのに役立ちます。

変形やスキンアニメーションのジオメトリを最適化しようとするときは、以前に提供したのと同じジオメトリガイドラインに従うことを忘れないでください。

次は、コンテンツでパーティクルシステムを使用することです。

これは、煙やロケットからの排気を伴う現実的な火災などの洗練された視覚効果を構築するための最も強力なツールの1つです。

誤って使用すると、粒子はクイックルック3D体験のボトルネックになる可能性があります。

このため、パーティクルエミッタの使用を制限し、画面上のパーティクルの数を最小限に抑えることをお勧めします。

多くの場合、より少ない粒子で同様の視覚効果を作成できます。

同様の効果を達成するために、より単純またはより小さな形状とスタイルを実験し、システム上のオーバードローを減らすのに役立ちます。

それは私たちがちょうど経験したかなり多くのことでした。

これらの推奨事項をまとめてみましょう。

Quicklook 3Dコンテンツのパフォーマンスには多くの要因が考慮されます。

この新しいプラットフォームは、人々が互いに並行して実行されている複数のアプリやコンテンツに関与できるように設計されています。

これは、コンテンツのパフォーマンスが、人々が行っている他のアプリやシーンによって影響を受ける可能性があることを意味します。

このため、さまざまなシナリオで3Dモデルをテストするのは良い習慣です。

このセッションで共有したように、コンテンツの視覚的な品質を確認したり、3Dパフォーマンスに影響を与える可能性のある制限を見つけたりするかどうかにかかわらず、自由に利用できるツールがいくつかあります。

ここでのスイートスポットは、より大きなビジュアルを持つことと、同時にスムーズなクイックルック視聴体験を確保することの適切なバランスを見つけることです。

クイックルックの詳細と、アプリやウェブサイトから3Dコンテンツを表示できるようにする方法については、他の講演「空間コンピューティングのクイックルックを発見」をご覧ください。

見てくれてありがとう!

♪