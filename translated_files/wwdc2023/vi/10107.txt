10107

♪ ♪

Justin: Xin chào! Tên tôi là Justin, và tôi là một phần của nhóm Ảnh.

Hôm nay tôi sẽ đưa bạn qua những cải tiến mới cho hệ thống Bộ chọn Ảnh và tất cả các API mới tuyệt vời mà bạn có thể sử dụng trong ứng dụng của mình.

Chúng tôi đã giới thiệu giao diện người dùng chọn được thiết kế lại trong iOS 14.

Nó có nhiều tính năng tuyệt vời như tìm kiếm và lưới có thể phóng to.

Thậm chí tốt hơn, bạn không cần yêu cầu bất kỳ quyền truy cập thư viện ảnh nào để sử dụng nó.

Chúng tôi thực sự khuyên bạn nên thay thế bộ chọn tùy chỉnh của mình bằng bộ chọn hệ thống bất cứ khi nào có thể.

API cũng thực sự dễ sử dụng.

Chỉ với một vài dòng mã, bạn có thể trình bày bộ chọn và nhận hình ảnh do người dùng chọn.

Phiên "Có gì mới trong bộ chọn Ảnh" năm ngoái đã nói sâu về API mới.

Trong phiên này, tôi sẽ tập trung vào các API mới mà bạn có thể tận dụng để nhúng bộ chọn hệ thống vào ứng dụng của mình, giúp trải nghiệm chọn ảnh liền mạch hơn.

Sau đó, tôi cũng sẽ thảo luận về menu Tùy chọn mới, cũng như các phương pháp hay nhất nếu bạn muốn hỗ trợ ảnh HDR, video HDR và video chế độ Điện ảnh.

Nhưng trước khi chúng ta đi sâu vào, hãy nhanh chóng tóm tắt lại mô hình truy cập của bộ chọn.

Đây là người chọn mà bạn đã thấy một lúc trước.

Mặc dù có vẻ như nó đang chạy trong ứng dụng của bạn, nhưng nó thực sự đang chạy trong một quy trình riêng biệt, được hiển thị trên ứng dụng của bạn.

Ứng dụng của bạn không thể truy cập trực tiếp vào bộ chọn và thậm chí không chụp ảnh màn hình nội dung bộ chọn.

Chỉ những gì người dùng thực sự chọn mới được chuyển trở lại ứng dụng của bạn.

Năm nay, chúng tôi sẽ mang đến nhiều tùy chọn cấu hình hơn cho bộ chọn ngoài quy trình.

Công cụ sửa đổi ".photosPickerDisabledCapabilities" mới cho phép bạn vô hiệu hóa một số khả năng chọn nhất định, vì vậy bạn có thể triển khai phiên bản của riêng mình.

Ví dụ, nút "Hủy" và nút "Thêm" có thể bị ẩn nếu bạn vô hiệu hóa các hành động lựa chọn.

Công cụ sửa đổi ".photosPickerAccessoryVisibility" mới cho phép bạn ẩn giao diện người dùng phụ kiện xung quanh nội dung bộ chọn, như thanh điều hướng và thanh công cụ.

Bạn thậm chí có thể chỉ định kích thước và vị trí của bộ chọn bằng cách sử dụng các công cụ sửa đổi SwiftUI tiêu chuẩn như ".frame" và ".padding".

Bạn có thể tự hỏi: "Nếu nút "Thêm" bị ẩn, làm thế nào ứng dụng của tôi có thể nhận tài sản do người dùng đã chọn ở chế độ nhiều lựa chọn?"

Bây giờ bạn có thể đặt hành vi lựa chọn thành ".liên tục" để nhận các bản cập nhật lựa chọn trực tiếp.

Và cuối cùng, bạn có thể sử dụng công cụ sửa đổi ".photosPickerStyle(.inline)" mới để nhúng bộ chọn vào ứng dụng của mình, thay vì trình bày nó dưới dạng một trang tính riêng biệt.

Mặc dù bộ chọn được nhúng, nó vẫn được hiển thị trong một quy trình riêng biệt.

Một số người dùng có thể lo lắng khi họ thấy ứng dụng của bạn hiển thị tất cả ảnh của họ mà không nhắc truy cập thư viện.

Chúng tôi muốn giúp người dùng cảm thấy an toàn khi sử dụng ứng dụng của bạn, vì vậy lần đầu tiên bộ chọn nhúng được hiển thị, giao diện người dùng giới thiệu sẽ tự động xuất hiện giải thích rằng ứng dụng của bạn chỉ có thể truy cập các ảnh đã chọn.

Huy hiệu quyền riêng tư của Ảnh chỉ ra rằng bộ chọn là riêng tư và không được xử lý.

Nếu ứng dụng của bạn đã trình chọn kích thước đầy đủ, một biểu ngữ có thể loại bỏ sẽ xuất hiện khi người dùng nâng cấp lên iOS 17.

Giao diện người dùng Cài đặt Quyền riêng tư cũng được cập nhật với lời giải thích chi tiết hơn.

Ngoài ra, chúng tôi đã thực hiện một số thay đổi đối với lời nhắc cấp phép truy cập thư viện.

Để tìm hiểu thêm về những thay đổi đó, bạn có thể xem phiên "Có gì mới trong quyền riêng tư".

Được rồi, chúng ta hãy quay lại API thực tế.

Tôi sẽ xem xét các trường hợp sử dụng của họ trước, và sau đó tôi sẽ giải thích chi tiết từng API.

Nếu bạn muốn nhúng bộ chọn ngoài quy trình, hãy sử dụng công cụ sửa đổi ".photosPickerStyle".

Để đặt giao diện người dùng của riêng bạn xung quanh bộ chọn, ".photosPickerAccessoryVisibility" là giao diện người dùng để sử dụng.

Nó cũng có một đối số tùy chọn cho phép bạn điều khiển các phụ kiện xung quanh các cạnh được chỉ định.

Giá trị mặc định là tất cả các cạnh.

Nếu bạn muốn thực hiện thay thế của riêng mình cho một số tính năng chọn, hãy sử dụng công cụ sửa đổi ".photosPicker DisabledCapabilities".

Và cuối cùng, nếu bạn cần điều chỉnh hoặc phản hồi các cập nhật lựa chọn trong thời gian thực, hãy đảm bảo "selectionBehavior" được đặt thành ".continuous".

Vậy chính xác thì cái gì được coi là phụ kiện?

Trên iOS, phụ kiện trên cùng là thanh điều hướng và phụ kiện dưới cùng là thanh công cụ.

Trên iPadOS và macOS, phụ kiện hàng đầu là thanh bên khi nó hiển thị.

Các phụ kiện trên và dưới tương tự như những gì iOS có.

Tiếp theo, tôi sẽ hướng dẫn bạn các khả năng chọn có thể bị vô hiệu hóa và cách chúng sẽ ảnh hưởng đến giao diện người dùng chọn.

Thanh tìm kiếm sẽ bị ẩn nếu khả năng tìm kiếm bị vô hiệu hóa.

Nếu điều hướng bộ sưu tập bị vô hiệu hóa, tab album sẽ bị ẩn.

Trên iPadOS và macOS, thanh bên cũng sẽ bị ẩn.

Nếu khu vực dàn dựng bị vô hiệu hóa, nút thanh công cụ sẽ được thay thế bằng nhãn trạng thái.

Nếu bạn vô hiệu hóa các hành động lựa chọn mà không có lựa chọn liên tục, chỉ có nút "Hủy" sẽ bị ẩn và nút "Thêm" vẫn sẽ hiển thị.

Nếu không, ứng dụng của bạn sẽ không thể nhận được bất kỳ lựa chọn người dùng nào.

Cả hai nút sẽ bị ẩn nếu bạn cũng đặt hành vi lựa chọn thành ".liên tục".

Hãy xem xét các phong cách chọn mới ngay bây giờ.

Ngoài kiểu ".presentation" và kiểu ".inline", bộ chọn cũng hỗ trợ một kiểu ".compact" khác.

Đây là kiểu ".presentation" mặc định.

Đây là phong cách ".inline" với tất cả các phụ kiện được ẩn.

Và đây là phong cách ".compact".

Bộ chọn một hàng cho phép bạn nhúng nó ở nhiều nơi hơn, nơi không gian thẳng đứng có sẵn bị hạn chế nghiêm trọng.

Đã đến lúc một bản demo kết nối mọi thứ lại với nhau.

Tôi đã tạo một ứng dụng đơn giản cho phép tôi chú thích hình ảnh bằng mô tả văn bản.

Hãy để tôi chỉ cho bạn những gì nó có thể làm ngay bây giờ.

Tôi có thể trình bày bộ chọn dưới dạng bảng phương thức, chọn một số hình ảnh và thêm một số mô tả.

Đối với bản demo, tôi muốn thay thế nút "Chọn ảnh" bằng bộ chọn được nhúng.

Hãy để tôi thêm công cụ sửa đổi ".photosPickerStyle(.inline)" và dùng thử.

Nó hoạt động, nhưng nó trông vẫn chưa đẹp.

Tôi vẫn cần nhấn vào nút "Thêm" để cập nhật danh sách và nếu bộ chọn thay đổi kích thước, thanh công cụ sẽ không được mở rộng đến cạnh dưới của thiết bị.

Nhưng đừng lo lắng.

Chỉ với một vài chỉnh sửa, nó có thể trông đẹp hơn rất nhiều.

Đầu tiên, vì bộ chọn có thể xử lý các khu vực an toàn một cách duyên dáng, tôi có thể sử dụng công cụ sửa đổi ".ignoresSafeArea" để bộ chọn có thể mở rộng ra cạnh dưới của màn hình.

Tiếp theo, tôi sẽ đảm bảo danh sách có thể được cập nhật ngay khi tôi chọn một bức ảnh trong bộ chọn.

Thực ra, nó rất dễ thay đổi.

Đặt hành vi lựa chọn thành ".liên tục" là tất cả những gì tôi cần làm.

Vì danh sách hiện đã được cập nhật trực tiếp, tôi không thực sự cần phải giữ các nút thanh điều hướng nữa.

Tôi có thể xóa chúng bằng cách sử dụng công cụ sửa đổi ".photosPicker DisabledCapabilities".

Bộ chọn hiện đã hoạt động đầy đủ.

Nhưng tôi muốn chắc chắn rằng bộ chọn trông cũng đẹp.

Tôi nghĩ tôi nên ẩn thanh điều hướng và thanh công cụ.

Tôi cũng muốn cho người chọn một chiều cao cố định.

Tôi có thể sử dụng công cụ sửa đổi ".photosPicker AccessoryVisibility" để ẩn các thanh và điều chỉnh chiều cao của bộ chọn như bất kỳ chế độ xem SwiftUI nào khác.

Bây giờ nó trông thật tuyệt.

Chỉ trong vài phút, tôi đã cập nhật ứng dụng của mình để hiển thị bộ chọn nhúng mới.

Tôi sẽ xây dựng và chạy để chúng ta có thể kiểm tra nó trên một thiết bị thực.

Tôi có thể sử dụng lưới có thể phóng to để nhanh chóng điều hướng đến bức ảnh tôi muốn chọn.

Những bức ảnh đã chọn sẽ tự động xuất hiện trong ứng dụng của tôi.

Trải nghiệm chọn ảnh của ứng dụng của tôi được cải thiện đáng kể với bộ chọn nhúng mới.

Đó là nó cho bản demo.

Tôi đã sử dụng iPhone trong bản demo, nhưng API tương tự có sẵn trên iOS, iPadOS và macOS.

Ngoài SwiftUI, API tương tự cũng có sẵn cho các ứng dụng UIKit và AppKit.

Hãy cùng xem UIKit và AppKit API.

Bộ chọn nhúng có sẵn thông qua cùng một API Cấu hình PHPicker.

Bây giờ bạn có thể đặt "lựa chọn" thành ".liên tục" để chọn hành vi lựa chọn liên tục.

Bạn cũng có thể đặt "mode" thành ".compact" để định cấu hình bộ chọn thành bố cục hàng đơn.

Bạn có thể sử dụng "edgesWithoutContentMargins" để ẩn các phụ kiện như thanh điều hướng và "disabledCapabilities" để vô hiệu hóa khả năng chọn nhất định.

Không giống như SwiftUI API nơi bạn có thể sử dụng công cụ sửa đổi ".photosPickerStyle(.inline)" để nhúng bộ chọn, bạn sẽ cần thêm nó làm bộ điều khiển chế độ xem con vào bộ điều khiển vùng chứa của mình.

Bạn có thể đặt khung của bộ chọn theo cách thủ công hoặc sử dụng các ràng buộc Bố cục Tự động để kích thước và định vị chế độ xem bộ chọn.

Sau khi thêm chế độ xem phụ, bạn chỉ cần thông báo cho bộ chọn rằng nó đã được thêm vào.

API "PHPickerConfiguration.Update" mới cho phép bạn cập nhật bộ chọn trong khi nó được hiển thị cho người dùng.

Bạn cũng có thể bỏ chọn hoặc sắp xếp lại các tài sản đã chọn bằng cách sử dụng các API "deselectAsset" và "moveAsset" hiện có.

Tiếp theo, tôi sẽ nói về menu Tùy chọn mới và nó sẽ ảnh hưởng đến ứng dụng của bạn như thế nào.

Trình đơn Tùy chọn mới cung cấp cho người dùng nhiều quyền kiểm soát hơn đối với những gì họ có thể chia sẻ với ứng dụng của bạn.

Theo mặc định, tất cả siêu dữ liệu hình ảnh đều được bao gồm, nhưng giờ đây người dùng có thể chọn xóa siêu dữ liệu nhạy cảm, như vị trí, khỏi các ảnh đã chọn.

Nếu bạn đang sử dụng API "PhotosPicker" và "Transferable", bạn không cần phải thực hiện bất kỳ công việc áp dụng nào để hỗ trợ menu Tùy chọn mới.

Tương tự, không cần công việc áp dụng nếu bạn đang sử dụng API "PHPickerViewController".

Trình đơn Tùy chọn sẽ không được hỗ trợ cho các ứng dụng sử dụng API "UIImagePickerController" kế thừa hoặc có quyền truy cập thư viện đầy đủ.

Được rồi, đó là menu Tùy chọn.

Bây giờ tôi sẽ nói về cách bạn có thể hỗ trợ hình ảnh HDR, video HDR và video chế độ Điện ảnh nếu bạn sử dụng bộ chọn hệ thống.

Bộ chọn có thể tự động chuyển mã tài sản sang các định dạng tương thích, như JPEG, theo mặc định.

Tuy nhiên, tài sản được chuyển mã có thể không chứa tất cả thông tin có trong tài sản gốc.

Vì vậy, nếu bạn muốn nhận nội dung HDR, tốt nhất bạn nên tránh chuyển mã tự động.

Bạn có thể lấy ảnh và video ở định dạng gốc bằng cách sử dụng chính sách mã hóa ".current" và yêu cầu một loại nội dung chung, như ".image" hoặc ".movie".

Yêu cầu các loại nội dung cụ thể, như ".jpeg", vẫn có thể chuyển mã tài sản ngay cả khi chính sách mã hóa được đặt thành ".current".

Để biết thêm thông tin về việc thêm hỗ trợ cho HDR, bạn có thể xem phiên "Hỗ trợ hình ảnh HDR trong ứng dụng của bạn" trong năm nay.

Đây là một ví dụ mã nhận hình ảnh ở định dạng gốc của chúng.

Bạn có thể thấy rằng "preferredItemEncoding" được đặt thành ".current" và "importedContentType" là ".image".

Nếu một video chế độ Điện ảnh được chọn, bộ chọn sẽ cung cấp cho bạn phiên bản kết xuất của nó, với tất cả hiệu ứng chiều sâu được nướng vào.

Nếu bạn muốn nhận được tất cả các điểm quyết định, bạn cần yêu cầu quyền truy cập thư viện ảnh và sử dụng PhotoKit để tìm nạp video thay thế.

Để tìm hiểu thêm về video chế độ Điện ảnh, bạn có thể xem phiên "Hỗ trợ video chế độ Điện ảnh trong ứng dụng của bạn".

Để kết thúc, bộ chọn nhúng mới mang lại rất nhiều tính linh hoạt và tôi nóng lòng muốn xem bạn có thể làm gì với nó.

Trình đơn Tùy chọn cung cấp cho người dùng nhiều quyền kiểm soát hơn đối với những gì cần chia sẻ, vì vậy vui lòng tránh yêu cầu quyền truy cập thư viện ảnh trừ khi thực sự cần thiết.

Cảm ơn bạn, và mã hóa vui vẻ!

♪ ♪