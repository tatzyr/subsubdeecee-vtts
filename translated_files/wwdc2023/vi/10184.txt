10184

♪ ♪

Can: Xin chào, tôi là Can Aran, và tôi là một kỹ sư trong nhóm Trải nghiệm Hệ thống iOS.

Tôi rất hân hạnh được nói chuyện với bạn về các Hoạt động Trực tiếp.

Trong buổi nói chuyện này, tôi sẽ cung cấp cho bạn một cái nhìn tổng quan về các Hoạt động Trực tiếp.

Sau đó tôi sẽ trải qua vòng đời của các hoạt động trực tiếp.

Cuối cùng, tôi sẽ chỉ cho bạn cách xây dựng một giao diện người dùng nhập vai và đơn giản cho hoạt động của bạn.

Để bắt đầu, tôi sẽ đào sâu vào những gì Hoạt động Trực tiếp có thể làm.

Hoạt động trực tiếp là một cách nhập vai, dễ nhìn để theo dõi một sự kiện hoặc tiến độ của một nhiệm vụ.

Các hoạt động trực tiếp có khởi đầu và kết thúc riêng biệt và có thể cung cấp các bản cập nhật theo thời gian thực từ thời gian chạy ứng dụng nền hoặc từ xa bằng cách sử dụng Thông báo đẩy.

Đây là những ví dụ tuyệt vời từ United Airlines và MLB.

Các hoạt động trực tiếp thậm chí còn nhập vai hơn trên iPhone 14 Pro và Pro Max.

Dynamic Island hiển thị các Hoạt động Trực tiếp trên toàn hệ thống khi ứng dụng của bạn ở chế độ nền.

Khi một Hoạt động Trực tiếp đang hoạt động, nó sẽ được hiển thị bằng cách sử dụng bản trình bày "nhỏ gọn" có chiều rộng thay đổi của nó.

Dynamic Island hiển thị tối đa hai hoạt động trực tiếp cùng một lúc.

Một trong những Hoạt động Trực tiếp này xuất hiện được gắn vào máy ảnh TrueDepth, trong khi hoạt động còn lại hiển thị ở chế độ xem tách biệt của riêng nó.

Cả hai Hoạt động Trực tiếp này đều sử dụng bài thuyết trình "tối thiểu" của họ.

Bất cứ lúc nào, một người có thể nhấn lâu vào Hoạt động Trực tiếp để hiển thị bản trình bày "mở rộng", cung cấp cho họ thông tin dễ nhìn thoáng hơn.

Trong bản trình bày mở rộng, các chế độ xem có thể liên kết sâu đến các khu vực khác nhau trong ứng dụng của bạn, cung cấp trải nghiệm người dùng phong phú.

Có một số trải nghiệm mới cho Hoạt động Trực tiếp trong iOS 17.

Ngoài màn hình Khóa và Đảo Động, Hoạt Động Trực Tiếp xuất hiện trong StandBy.

Và bây giờ, iPad cũng hỗ trợ Hoạt động Trực tiếp.

Cho phép triển khai của bạn trên iPadOS và đưa các Hoạt động Trực tiếp nhập vai của bạn lên iPad, như thế này từ Crumbl Cookies.

Với iOS 17, bạn có thể thêm tính tương tác vào Hoạt động Trực tiếp của mình bằng cách sử dụng WidgetKit và SwiftUI.

Bạn có thể thêm các nút hoặc nút chuyển đổi để nâng cao trải nghiệm người dùng.

Tìm hiểu thêm về cách mang tính tương tác cho các tiện ích của bạn trong video của Luca, "Mang các tiện ích vào cuộc sống".

Hoạt động trực tiếp dựa trên khung ActivityKit, trao quyền cho ứng dụng của bạn để yêu cầu, cập nhật và quản lý vòng đời của chúng.

Chúng được bố trí khai báo bằng SwiftUI và WidgetKit.

Nếu bạn đã triển khai tiện ích Màn hình chính trước đây, điều này sẽ cảm thấy rất quen thuộc.

Một Hoạt động Trực tiếp có thể được yêu cầu khi ứng dụng của bạn ở phía trước.

Ứng dụng của bạn chỉ nên yêu cầu Hoạt động Trực tiếp sau hành động riêng biệt của người dùng, có thể "theo dõi" một sự kiện hoặc bắt đầu một nhiệm vụ một cách rõ ràng.

Điều này rất quan trọng để đảm bảo trải nghiệm người dùng tích cực.

Các hoạt động trực tiếp do người dùng kiểm duyệt tương tự như Thông báo.

Ai đó có thể dễ dàng loại bỏ hoặc tắt chúng hoàn toàn cho ứng dụng của bạn.

API yêu cầu bạn hỗ trợ tất cả các bài thuyết trình từ Màn hình khóa đến cả ba bài thuyết trình Dynamic Island.

Trong StandBy, hệ thống chia tỷ lệ bản trình bày Màn hình Khóa của bạn để lấp đầy màn hình.

Ngoài việc dựa vào thời gian chạy nền, ứng dụng của bạn có thể cập nhật Hoạt động Trực tiếp từ xa bằng cách sử dụng thông báo đẩy với loại đẩy "hoạt động trực tiếp".

Để biết thêm thông tin về cách cập nhật Hoạt động Trực tiếp của bạn bằng thông báo đẩy, bạn có thể xem video của Jeff.

Hoạt động trực tiếp của ứng dụng của bạn trải qua các giai đoạn khác nhau trong suốt vòng đời của nó.

Tôi đang xây dựng một Hoạt động Trực tiếp nơi một người có thể chọn một anh hùng từ ứng dụng Emoji Rangers và đưa họ vào một cuộc phiêu lưu.

Trong cuộc phiêu lưu, anh hùng sẽ đối mặt với những thử thách và chiến đấu với những con trùm.

Tôi sẽ hiển thị những khoảnh khắc quan trọng của cuộc phiêu lưu này trong Hoạt động Trực tiếp của mình.

Hoạt động trực tiếp này hiển thị thông tin cần thiết nhất về cuộc phiêu lưu của một anh hùng.

Nó bao gồm tên và số liệu thống kê của anh hùng, hình đại diện, mức độ sức khỏe và mô tả về những gì anh hùng này trải qua trong cuộc phiêu lưu của họ.

Vòng đời của một Hoạt động Trực tiếp bao gồm bốn bước chính.

Bắt đầu bằng cách yêu cầu một hoạt động.

Khi nó đã bắt đầu, hãy cập nhật nó với nội dung mới nhất của bạn.

Trong khi chờ đợi, hãy quan sát hoạt động của bạn để phản ứng với những thay đổi trạng thái, chẳng hạn như mọi người kết thúc nó.

Khi nhiệm vụ hoàn thành, hãy đảm bảo kết thúc hoạt động.

Yêu cầu một Hoạt động Trực tiếp rất đơn giản.

Đảm bảo rằng ứng dụng của bạn ở phía trước và định cấu hình ứng dụng của bạn để bạn có nội dung ban đầu và dữ liệu yêu cầu hoạt động cần thiết.

Trước khi tôi có thể yêu cầu Hoạt động Trực tiếp trong ứng dụng Emoji Rangers, tôi phải bắt đầu bằng cách xác định một tập hợp dữ liệu tĩnh và động cho Hoạt động Trực tiếp của mình bằng cách triển khai "ActivityAttributes".

Tôi gọi nó là "AdventureAttributes."

"AdventureAttributes" mô tả một dữ liệu tĩnh, đó là anh hùng.

Nó cũng xác định "ContentState" tùy chỉnh bắt buộc để gói gọn mức độ sức khỏe của anh hùng và mô tả sự kiện.

Khi các thuộc tính này thay đổi, giao diện người dùng Hoạt động Trực tiếp của tôi sẽ được cập nhật và tôi sẽ có thể hiển thị trạng thái hiện tại của cuộc phiêu lưu trên màn hình.

Bây giờ dữ liệu động và tĩnh đã sẵn sàng, tôi sẽ thiết lập các yêu cầu hoạt động phiêu lưu.

Tôi sẽ bắt đầu tạo một ví dụ về AdventureAttributes với anh hùng và thiết lập nội dung ban đầu với mức độ sức khỏe của anh hùng và mô tả sự kiện.

Mỗi nội dung hoạt động có thể được cung cấp với một ngày cũ để thông báo cho hệ thống khi nội dung được coi là lỗi thời.

Hiện tại, tôi sẽ vượt qua bằng không.

Điểm liên quan cho nội dung xác định thứ tự mà mỗi Hoạt động Trực tiếp xuất hiện khi một số hoạt động phiêu lưu được bắt đầu.

Nếu tôi định bắt đầu một hoạt động phiêu lưu khác, tôi sẽ chỉ định điểm liên quan khác nhau cho mỗi hoạt động.

Vượt qua điểm liên quan là tùy chọn.

Giá trị mặc định bằng không.

Bây giờ tôi có thể yêu cầu hoạt động.

Tôi sẽ chuyển các thuộc tính, nội dung ban đầu và loại thông báo đẩy.

Loại thông báo đẩy cho biết nếu Hoạt động Trực tiếp nhận được cập nhật cho nội dung động của nó với thông báo đẩy ActivityKit.

Đối với ví dụ này, tôi sẽ đặt nó thành "không", có nghĩa là hoạt động này chỉ có thể nhận các bản cập nhật cục bộ.

Để bắt đầu Hoạt động Trực tiếp này, cài đặt Hoạt động Trực tiếp cho ứng dụng Emoji Rangers cần được bật.

Bây giờ tôi có thể yêu cầu Hoạt động Trực tiếp của mình, tôi sẽ xem xét cách tôi có thể cập nhật cuộc phiêu lưu khi anh hùng của tôi trải qua các nhiệm vụ ly kỳ.

Các thuộc tính động cho tôi biết khi nào cần cập nhật Hoạt động Trực tiếp của mình.

Bất cứ khi nào mô tả sự kiện hoặc mức độ sức khỏe của anh hùng thay đổi, tôi sẽ cập nhật hoạt động của mình.

Ồ không! Người anh hùng nhận đòn chí mạng từ một ông chủ.

Vì vậy, tôi tạo ra một "Trạng thái nội dung" phản ánh sự thay đổi về mức độ sức khỏe và mô tả các sự kiện.

Vì mức độ máu của anh hùng giảm đáng kể, tôi cần gửi một cảnh báo.

Tôi sẽ tạo một cấu hình cảnh báo cho điều đó.

Điều này sẽ hiển thị cảnh báo trên iPhone, iPad hoặc trên Apple Watch được đồng bộ hóa nếu một số thông tin quan trọng thay đổi với Hoạt động Trực tiếp.

Trong trường hợp này, người anh hùng bị thương nặng và cần một lọ thuốc để chữa lành.

Tiêu đề cấu hình và thân máy chỉ được sử dụng trên Apple Watch và được hiển thị dưới dạng thông báo.

Trên iPhone và iPad, giao diện người dùng hoạt động với nội dung được cập nhật xuất hiện với âm thanh được chỉ định.

Bây giờ tôi có thể gọi API cập nhật trên đối tượng hoạt động với nội dung được cập nhật và cấu hình cảnh báo.

Điều này sẽ đảm bảo rằng giao diện người dùng Hoạt động Trực tiếp được cập nhật và người dùng được cảnh báo với bản cập nhật này.

Thay đổi trạng thái hoạt động có thể xảy ra bất cứ lúc nào trong vòng đời của một hoạt động trực tiếp.

Có 4 trạng thái có thể xảy ra: "bắt đầu", "kết thúc", "bị loại bỏ" và "stale".

Tôi quan sát các trạng thái này bằng cách sử dụng API activityStateUpdates trên đối tượng hoạt động để nhận các bản cập nhật không đồng bộ.

Khi hoạt động bị loại bỏ, tôi đảm bảo rằng tôi không theo dõi dữ liệu phiêu lưu nữa và cập nhật giao diện người dùng trong ứng dụng để tôi không hiển thị hoạt động đang diễn ra.

Tôi cũng có thể kiểm tra trạng thái thông qua activityState API để truy xuất nó đồng bộ khi cần thiết.

Anh hùng của tôi đã trải qua rất nhiều.

Bây giờ là lúc để kết thúc cuộc phiêu lưu Hoạt động Trực tiếp.

Để có thể kết thúc hoạt động, tôi bắt đầu bằng cách tạo ra một nội dung cuối cùng.

Nội dung của tôi sẽ hiển thị trạng thái cuối cùng của cuộc phiêu lưu nơi anh hùng đánh bại trùm.

Sau đó tôi sẽ xác định chính sách sa thải cho giao diện người dùng của mình.

Chính sách mặc định phù hợp với trường hợp này.

Chính sách này đảm bảo rằng thông tin phiêu lưu xuất hiện trên Màn hình khóa một thời gian sau khi nó kết thúc để ai đó có thể liếc nhìn Màn hình khóa để xem điều gì đã xảy ra vào cuối cuộc phiêu lưu.

Bây giờ tôi có thể kết thúc hoạt động phiêu lưu và cho anh hùng nghỉ ngơi.

Tôi đã xây dựng tất cả logic xung quanh vòng đời Hoạt động Trực tiếp của mình.

Đã đến lúc tập trung vào giao diện người dùng hoạt động.

Tiện ích mở rộng tiện ích Emoji Ranger hiện có hai tiện ích trong WidgetBundle của nó.

Tôi cần thêm cấu hình Hoạt động Trực tiếp trong WidgetBundle.

Tôi sẽ gọi nó là "AdventureActivityConfiguration."

"AdventureActivityConfiguration" tận dụng cơ sở hạ tầng tiện ích và nó cần trả lại WidgetConfiguration trong phần thân của nó.

Tôi sẽ tạo một đối tượng Cấu hình Hoạt động, mô tả nội dung Hoạt động Trực tiếp của tôi.

Đối với mỗi lần đóng bản trình bày, đối tượng ActivityConfiguration cung cấp một ActivityViewContext lưu trữ các thuộc tính tĩnh và động của tôi và ID hoạt động.

Bối cảnh này được tạo ra dựa trên loại thuộc tính được chuyển vào cấu hình.

Loại này phải khớp với thuộc tính mà hoạt động của bạn được yêu cầu.

Tôi sẽ vượt qua loại "AdventureAttributes" để cấu hình hoạt động có thể được khởi tạo thành công.

Lần đóng đầu tiên trong "ActivityConfiguration" chỉ định giao diện người dùng màn hình khóa.

Khi bối cảnh chế độ xem của tôi thay đổi với các bản cập nhật hoạt động, giao diện người dùng này sẽ được hiển thị cho mỗi bản cập nhật.

Tương tự như các tiện ích, tôi không cung cấp kích thước của giao diện người dùng Màn hình Khóa cho Hoạt động Trực tiếp của mình, nhưng hãy để hệ thống xác định kích thước phù hợp.

Đối với hoạt động Emoji Ranger, tôi sẽ hiển thị thông tin anh hùng, tên và hình đại diện, mức độ sức khỏe và mô tả sự kiện trên Màn hình khóa với nền màu xanh hải quân.

"AdventureLiveActivityView" sẽ có tất cả thông tin đó thông qua ngữ cảnh chế độ xem được thông qua.

Hoạt động trực tiếp của tôi trên màn hình khóa trông đơn giản, thanh lịch và nó có tất cả thông tin mà tôi cần về những gì anh hùng đang trải qua trong cuộc phiêu lưu.

Bây giờ tôi đã kết thúc giao diện người dùng Màn hình Khóa của mình, tôi cần triển khai các bài thuyết trình Dynamic Island của mình.

Có ba bài thuyết trình: nhỏ gọn, tối thiểu và mở rộng.

Khi Hoạt động Trực tiếp của ứng dụng của tôi là ứng dụng duy nhất chạy trên hệ thống, nó sẽ được hiển thị bằng cách sử dụng bản trình bày nhỏ gọn.

Bài thuyết trình nhỏ gọn có hai lĩnh vực, dẫn đầu và cuối.

Họ xuất hiện cùng nhau để tạo thành một bài thuyết trình gắn kết ở Dynamic Island.

Chọn nội dung cần thiết để hiển thị trong không gian đầu và cuối, vì không gian có giới hạn.

Người dùng sẽ có thể xác định hoạt động cụ thể bằng cách xem nội dung tại đây.

Trong phần đóng "DynamicIsland" của đối tượng ActivityConfiguration, tôi lại có quyền truy cập vào ngữ cảnh chế độ xem để tạo các chế độ xem mở rộng, compactLeading, compactTrailing và tối thiểu của mình.

Tôi cần tạo một trình tạo chế độ xem DynamicIsland để đại diện cho từng bài thuyết trình đó.

Đối với cuộc phiêu lưu của anh hùng của tôi, tôi sẽ thêm hình đại diện anh hùng vào nội dung hàng đầu và mức độ sức khỏe vào chế độ xem cuối.

Tôi cũng sẽ có một màu sắc động dựa trên mức độ sức khỏe của anh hùng của tôi.

Bài thuyết trình nhỏ gọn cho cuộc phiêu lưu đã sẵn sàng ngay bây giờ.

Khi có nhiều ứng dụng bắt đầu Hoạt động Trực tiếp, hệ thống sẽ chọn Hoạt động Trực tiếp nào hiển thị và hiển thị cả hai bằng cách sử dụng bản trình bày tối thiểu cho mỗi ứng dụng: một bản trình bày tối thiểu xuất hiện gắn liền với Đảo Động trong khi bản trình bày kia xuất hiện tách rời.

Chế độ xem tối thiểu của bạn chỉ nên có thông tin quan trọng nhất, vì bạn có không gian làm việc rất hạn chế.

Đối với chế độ xem tối thiểu trong Hoạt động Trực tiếp của tôi, thông tin quan trọng nhất cần hiển thị là anh hùng là ai và sức khỏe của anh hùng, vì vậy tôi sẽ hiển thị hình đại diện và mức độ sức khỏe với màu sắc động.

Bằng cách này, người dùng sẽ biết khi nào nên giúp đỡ anh hùng của họ bằng cách nhìn vào chế độ xem tối thiểu.

Khi người dùng chạm và tổ chức Hoạt động Trực tiếp trong một bài thuyết trình nhỏ gọn hoặc tối thiểu, hệ thống sẽ hiển thị nội dung trong một bài thuyết trình mở rộng.

Tôi cũng cần ủng hộ điều đó.

Đối với bản trình bày mở rộng, hệ thống chia bản trình bày mở rộng thành các khu vực khác nhau.

Việc đóng cửa đầu tiên của trình tạo chế độ xem DynamicIsland đại diện cho nội dung mở rộng.

Trong thời gian đóng cửa đó, mỗi nội dung phần có thể được xác định với khu vực mở rộng đi qua vị trí cụ thể.

Tôi sẽ thêm tên anh hùng và hình đại diện vào không gian hàng đầu, số liệu thống kê anh hùng vào không gian cuối cùng, và cuối cùng, thanh sức khỏe và mô tả sự kiện vào không gian dưới cùng.

Cuối cùng, giao diện người dùng Dynamic Island của tôi trông đơn giản và cung cấp tất cả thông tin cần thiết cho cuộc phiêu lưu.

Bây giờ tôi đã sẵn sàng để tham gia vào cuộc phiêu lưu với những anh hùng yêu thích của mình và theo dõi giao diện người dùng Hoạt động Trực tiếp đơn giản nhưng nhập vai mà tôi vừa tạo.

Trong khi thiết kế giao diện người dùng của riêng bạn, chỉ hiển thị nội dung thiết yếu nhất trong Hoạt động Trực tiếp.

Giữ cho nó đơn giản và hiển thị các chi tiết bổ sung trên ứng dụng của bạn khi người dùng nhấn vào Hoạt động Trực tiếp.

Kiểm tra "Thiết kế các hoạt động trực tiếp năng động" để biết thêm thông tin.

Sử dụng Hoạt động Trực tiếp như một công cụ mạnh mẽ để hiển thị thông tin trực tiếp và thoáng qua của bạn về một hoạt động đang diễn ra.

Với cấu hình đơn giản, hãy tạo ra một cách năng động để tương tác với người dùng của bạn trên iOS và iPadOS.

Để tìm hiểu thêm về việc đẩy các bản cập nhật, hãy xem "Cập nhật các hoạt động trực tiếp với các thông báo đẩy". Tôi nóng lòng muốn xem bạn sẽ xây dựng gì với ActivityKit.

Cảm ơn bạn đã xem!

♪ ♪