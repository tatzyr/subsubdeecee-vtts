10070

♪ Hip-hop nhạc cụ êm dịu ♪

♪

Xin chào, tên tôi là Jeremy, và tôi là một kỹ sư phần mềm trải nghiệm truyền thông.

Bài nói chuyện này sẽ giải thích cách tạo ra trải nghiệm không gian tuyệt vời để phát lại video trong ứng dụng của bạn.

Một trải nghiệm tuyệt vời được tối ưu hóa cho nền tảng, tận dụng khả năng truyền thông mạnh mẽ của nó và tích hợp với toàn bộ hệ thống.

Đầu tiên, chúng ta sẽ khám phá trải nghiệm truyền thông với một ứng dụng tối thiểu.

Tiếp theo, tôi sẽ xem xét một số tính năng giao diện người dùng nâng cao hơn.

Sau đó, tôi sẽ xem xét một số phương pháp hiển thị video khác.

Cuối cùng, tôi sẽ so sánh các lựa chọn.

Nếu bạn đã sử dụng API phương tiện trên iOS hoặc tvOS, thì điều này có thể cảm thấy quen thuộc.

Nền tảng này được xây dựng trên cùng một API và mở rộng chúng cho các khả năng độc đáo của nó.

AVFoundation xử lý tất cả các công việc phát phim: phát trực tuyến, phân tích cú pháp, giải mã, đồng bộ hóa.

Và AVKit được xây dựng trên AVFoundation và UI Frameworks, để tạo ra trải nghiệm phát lại được tùy chỉnh và tích hợp cho từng nền tảng.

Trên nền tảng này, AVFoundation đã được cải tiến để hỗ trợ các định dạng phương tiện mới tận dụng các khả năng độc đáo của nó, chẳng hạn như video 3D.

Tham khảo phiên này để biết thêm chi tiết về các định dạng này.

AVFoundation cũng đã được cải tiến để kết xuất hiệu suất và với chất lượng cao bằng cách sử dụng RealityKit, để video có thể được kết hợp liền mạch vào thế giới xung quanh bạn và để âm thanh cũng phản hồi với thế giới xung quanh bạn.

Và AVPlayerViewController của AVKit đã được mở rộng để tận dụng sức mạnh của RealityKit và các khả năng độc đáo của nền tảng để tạo ra trải nghiệm rất tinh tế.

Điều này bao gồm tất cả các điều khiển phát lại mà bạn mong đợi, nhưng cũng có nhiều khả năng độc đáo.

Điều gì được yêu cầu để tận dụng điều này trong ứng dụng của bạn?

Đầu tiên, mục tiêu Xcode phải được xây dựng với SDK của nền tảng này.

Các ứng dụng iOS tương thích được xây dựng với iOS SDK sẽ có trải nghiệm tương thích với iOS.

Sử dụng AVPlayerViewController giống như bạn làm trên iOS hoặc tvOS.

Và cuối cùng, trình bày bộ điều khiển chế độ xem để nó lấp đầy cửa sổ.

Hãy chứng minh điều này bằng một số mã.

Đầu tiên, chúng ta sẽ nhập AVFoundation và AVKit.

Tiếp theo, tạo một AVPlayerViewController và kết nối một AVPlayer với nó.

Sau đó, tạo một mục trình phát mới với URL nội dung và đặt nó trên trình phát.

Thêm vật phẩm sau khi cài đặt trình phát trên bộ điều khiển chế độ xem có thể cải thiện hiệu suất vì trình phát sẽ hiểu nó sẽ được hiển thị như thế nào trước khi bắt đầu tải phương tiện.

Sau đó, để sử dụng nó trong SwiftUI, hãy bọc mã đó trong UIViewControllerRepresentable.

Chúng tôi sẽ gọi cái này là PlayerView.

Sau đó, chúng tôi sẽ tạo ứng dụng của mình, mà chúng tôi sẽ gọi là MoviePlayingApp.

Thêm bộ điều khiển chế độ xem, mà chúng tôi vừa xác định, để nó lấp đầy cửa sổ.

Cứ như vậy, bạn đã có một ứng dụng phát phim.

Nếu bạn đang nghĩ rằng mã này trông rất giống với những gì bạn sẽ viết trên các nền tảng khác của Apple, đó là bởi vì nó là như vậy.

AVPlayerViewController và AVPlayer đang thực hiện rất nhiều công việc nặng nhọc nên bạn không cần phải làm vậy.

Hãy để tôi cho bạn thấy trải nghiệm truyền thông một ứng dụng đơn giản như thế này.

Trước khi ứng dụng được khởi chạy, chỉ cần hiển thị phòng.

Khi ứng dụng khởi chạy, một màn hình lớn xuất hiện ngay phía trước và căn phòng tối đi, tạo ra một bầu không khí đẹp.

Khi di chuyển, màn hình vẫn giữ nguyên vị trí và âm thanh vẫn được neo vào màn hình.

Để hiển thị các điều khiển phát lại, hãy nhìn vào màn hình và nhấn.

Các điều khiển nổi ngay trước video.

Trong khi chơi, đừng làm gì cả và chúng sẽ tự biến mất.

Hoặc làm cho chúng biến mất bằng cách nhìn vào màn hình và chạm lại.

Lấy thanh cửa sổ bên dưới màn hình để định vị lại nó.

Lấy góc của màn hình để thay đổi kích thước.

Lưu ý rằng khi màn hình thay đổi kích thước, nó hoạt hình mượt mà và phù hợp với tỷ lệ khung hình của video.

Điều chỉnh âm lượng bằng cách xoay Digital Crown.

Hoặc sử dụng Digital Crown để mở một môi trường, như thế này.

Tôi thích xem phim theo cách này.

Bạn phải tự mình trải nghiệm điều này.

Bây giờ, hãy kiểm tra các điều khiển phát lại kỹ hơn để xem các tính năng mà chúng cung cấp.

Đây là giao diện người chơi của chúng tôi.

Ở trên cùng bên phải là điều khiển âm lượng để điều chỉnh nhanh hoặc tắt tiếng.

Như tôi đã đề cập, âm lượng cũng có thể được điều chỉnh với Digital Crown.

Ở phía dưới bên trái là các nút phát/tạm dừng và quay lại/chuyển tiếp quen thuộc.

Ở giữa phía dưới là máy chà sàn để nhảy đến một thời điểm khác trong phim.

Và ở phía dưới bên phải là nút này với nhiều tùy chọn hơn.

Đây là các tùy chọn để điều chỉnh tốc độ phát lại.

Khi phim chứa nhiều bản âm thanh hoặc bản chú thích, hãy sử dụng các tùy chọn này để chọn ngôn ngữ cho bản âm thanh hoặc bật chú thích bằng ngôn ngữ ưa thích.

Tùy chọn cuối cùng này là Hiệu ứng làm mờ.

Tôi thích xem phim trong bóng tối để thực sự tập trung vào chúng, nhưng đôi khi video không phải là trọng tâm duy nhất của tôi.

Ở đây, tôi có thể tắt Hiệu ứng làm mờ để thấy rõ hơn những gì xung quanh tôi.

Chúng tôi đã đề cập đến những điều cơ bản được tích hợp sẵn.

Bây giờ, hãy cùng khám phá một số tính năng nâng cao hơn.

Chà hình thu nhỏ hiển thị một hình ảnh nhỏ của video trong khi chà, cho phép điều hướng nội dung liền mạch.

Các điều khiển sẽ tự động hiển thị hình thu nhỏ khi xóa các luồng HLS có danh sách phát chỉ có khung hình I, còn được gọi là bản nhạc Trick Play.

Các bản nhạc Trick Play nhỏ có chiều rộng 145 pixel được ưa thích hơn.

Tham khảo tài liệu này để biết thêm chi tiết.

Đôi khi phương tiện truyền thông cần được chèn vào dòng thời gian cho logo, bản tóm tắt hoặc quảng cáo.

Hỗ trợ quảng cáo xen kẽ cho phép khả năng này.

Khi quảng cáo xen kẽ có mặt, các điều khiển sẽ tự động phản ánh chúng bằng một chỉ báo trong dòng thời gian.

Các quảng cáo xen kẽ này có thể được cấu hình theo chương trình với Bộ điều khiển sự kiện AVPlayerInterstital hoặc chúng có thể được mô tả trong luồng HLS.

Tham khảo phiên này để biết thêm chi tiết.

Có một số tùy chọn giao diện người dùng bổ sung thường được sử dụng bởi các ứng dụng phát video.

Các hành động theo ngữ cảnh cho phép bạn thêm các nút như Bỏ qua phần giới thiệu hoặc Phát tập tiếp theo.

Họ có thể có một tiêu đề và một hình ảnh tùy chọn.

Bộ điều khiển chế độ xem thông tin tùy chỉnh có thể được sử dụng để hiển thị siêu dữ liệu về nội dung hoặc để đề xuất nội dung liên quan.

Các API này hoạt động giống như trên các nền tảng khác của Apple.

Tham khảo phiên này để biết thêm chi tiết.

Ứng dụng của bạn cũng có thể đưa bạn đến một nơi khác với một tính năng gọi là Immersive Spaces.

Khi ứng dụng của bạn tạo ra một Không gian Nhập vai, bạn có thể quyết định không gian đó trông như thế nào.

Và thậm chí tốt hơn, màn hình video của bạn sẽ tự động di chuyển vào không gian đó và tự neo ở kích thước và vị trí có thể dự đoán được để đảm bảo góc nhìn tuyệt vời mọi lúc.

Và các điều khiển tách ra và di chuyển đến gần hơn để giúp chúng dễ tương tác hơn.

Hãy kiểm tra một số mã.

Đây là MoviePlayingApp của chúng tôi từ trước đó.

Đầu tiên, chúng ta sẽ thêm một Không gian Nhập vai.

Nội dung 3D sẽ được mô tả bởi các thực thể RealityKit.

Sau đó, chúng tôi sẽ sử dụng onAppear trên PlayerView của mình để mở không gian.

Đảm bảo Không gian Nhập vai của bạn được thiết kế để chứa trình phát phim khi nó được cập bến.

Để biết thêm thông tin về cách xây dựng và trình bày không gian, hãy tham khảo phiên này.

AVPlayerViewController đã được tinh chỉnh và thiết kế kỹ lưỡng để có trải nghiệm tuyệt vời trên nền tảng này.

Chúng tôi thực sự muốn AVPlayerViewController hoạt động cho bạn.

Vì vậy, nếu có các tính năng hoặc hành vi bạn muốn đề xuất, vui lòng cung cấp phản hồi để chúng tôi có thể tiếp tục cải thiện nó cho các trường hợp sử dụng của bạn.

Bây giờ, vẫn có thể có những tình huống hiếm hoi khi ai đó cần xây dựng các điều khiển phát lại tùy chỉnh.

Trong trường hợp đó, vui lòng cung cấp phản hồi.

Và chúng tôi khuyên bạn nên sử dụng AVPlayerViewController.

Bạn có thể ẩn các điều khiển và cung cấp lớp phủ cho giao diện người dùng tùy chỉnh của mình.

Điều này được ưu tiên hơn là sử dụng API cấp thấp hơn bởi vì, như chúng tôi đã chứng minh, AVPlayerViewController cung cấp rất nhiều tính năng tích hợp hệ thống ngoài các điều khiển phát lại.

Và bạn sẽ tiếp tục nhận được các tính năng tích hợp hệ thống tuyệt vời.

Chúng tôi đã khám phá trải nghiệm toàn màn hình của AVPlayerViewController.

Bây giờ hãy xem xét một số trường hợp sử dụng khác để phát lại video.

Đôi khi bạn muốn một bộ phim để phát nội tuyến trong cửa sổ.

Nó có thể là một phần của tài liệu hoặc để phát bản xem trước.

AVPlayerViewController nội tuyến cũng rất tốt cho tình huống này.

Làm thế nào để bạn có được chế độ xem nội tuyến?

Nó sẽ tự động sử dụng chế độ này bất cứ khi nào nó được hiển thị mà không cần lấp đầy cửa sổ.

Các điều khiển nội tuyến của nó cũng được thiết kế lại cho hệ điều hành.

Lưu ý, vì video được tổng hợp trong cửa sổ bằng AVPlayerLayer, nó sẽ không thể hiển thị video 3D.

Đôi khi ứng dụng của bạn có thể muốn phát video như một thực thể của cảnh 3D.

Nó có thể là một màn hình giật gân hoặc một quá trình chuyển đổi video.

Trong những trường hợp này, bạn không muốn điều khiển phát lại và bạn cũng không muốn tích hợp hệ thống như kết nối.

Đối với những trường hợp đó, hãy sử dụng VideoPlayerComponent của RealityKit.

VideoPlayerComponent kết nối RealityKit Entity với AVPlayer.

Bạn có thể định vị nó trong cảnh RealityKit của mình giống như bất kỳ thực thể nào khác.

Nó tạo ra một lưới chính xác tỷ lệ khung hình cho video và nó hỗ trợ hiển thị chú thích.

Bất cứ khi nào có thể, hãy thích nó hơn AVPlayerLayer.

Bởi vì nó tận dụng tối ưu hóa của RealityKit cho video, nó có hiệu suất tốt hơn AVPlayerLayer và nó hỗ trợ các định dạng video 3D mới.

Tham khảo phiên này để biết thêm chi tiết.

Đôi khi bạn có thể muốn sử dụng video trong cảnh 3D nơi video được sử dụng như một hiệu ứng.

Trong trường hợp này, bạn có thể muốn tạo hình học của riêng mình và kiểm soát nhiều hơn cách hiển thị video.

VideoMaterial là một API cấp thấp hơn sẽ hiển thị video trên hình học tùy ý.

Điều này có nghĩa là nó không thể đảm bảo tỷ lệ khung hình ban đầu và nó không có khả năng hiển thị chú thích.

Kiểm tra cuộc nói chuyện liên quan này để biết thêm chi tiết.

Chúng tôi đã nói về một số tính năng giao diện người dùng bổ sung và một số trường hợp sử dụng khác.

Ứng dụng mẫu DestinationVideo thể hiện một số tính năng này.

Nó có một trình duyệt video để chọn video và phát chúng trong một Không gian Nhập vai.

Đây rồi.

Chọn một video để hiển thị trang thông tin và một Không gian Nhập vai sẽ mở ra.

Lưu ý việc sử dụng trình phát nội tuyến với các điều khiển giao diện người dùng tùy chỉnh để xem trước.

Sau đó, phát phim.

Giao diện người dùng trình phát xuất hiện và ngay lập tức cập bến vào Không gian nhập vai ở kích thước và vị trí cố định để xem tối ưu.

Một chi tiết thú vị khác là khi màn hình được gắn vào Không gian Nhập vai như thế này, các điều khiển phát lại sẽ tách ra và đến gần hơn một chút để giúp chúng thuận tiện hơn khi tương tác.

Nhấn vào nút danh sách.

Ứng dụng đã cung cấp bộ điều khiển xem thông tin tùy chỉnh để hiển thị thêm thông tin về nội dung và nội dung liên quan trong khi xem video.

Gần cuối video, một nút hành động theo ngữ cảnh có nhãn Phát tiếp theo xuất hiện ở góc dưới cùng bên phải.

Chúng tôi đã đề cập đến trải nghiệm không gian để phát lại video.

Nó có một màn hình lớn lơ lửng trong không gian trước mặt bạn với hình ảnh đẹp và âm thanh không gian tuyệt vời.

Nó bao gồm các điều khiển phát lại cho mọi thứ bạn cần làm và chúng tôi đã nói về một số trường hợp sử dụng phát lại khác.

Có một số cách để hiển thị video trong ứng dụng của bạn.

Hãy so sánh chúng.

Đây là các API để hiển thị video.

Mỗi người có những khả năng khác nhau.

Sử dụng API chính xác cho trải nghiệm truyền thông mà bạn cần.

Đảm bảo phương tiện của bạn được hiển thị chính xác và có thể truy cập được.

Đảm bảo rằng nó được tối ưu hóa cho nền tảng và cho phép các định dạng video 3D bằng cách kết xuất với RealityKit.

Và đảm bảo rằng nó có các điều khiển phát lại mạnh mẽ được điều chỉnh cho nền tảng.

Và đảm bảo rằng nó được tích hợp với toàn bộ hệ thống để có được trải nghiệm tuyệt vời.

AVPlayerViewController sẽ cho phép ứng dụng của bạn tận dụng tối đa các tính năng bạn đã sử dụng trong các nền tảng khác của Apple và các tính năng mới, độc đáo của nền tảng này.

Bạn có thể mang đến trải nghiệm phát lại phim tuyệt vời cho người dùng của mình.

Khả năng truyền thông không gian đại diện cho cơ hội để mọi người trải nghiệm video theo một cách hoàn toàn mới.

Để bắt đầu, hãy xem Dự án Mẫu DestinationVideo.

Nó thể hiện nhiều tính năng được thảo luận ở đây.

Và kiểm tra những cuộc nói chuyện liên quan này.

Tôi nóng lòng chờ đợi mọi người xem bạn làm gì với những công cụ mạnh mẽ này.

Nhưng bây giờ, tôi phải quay lại xem một chương trình.

Tận hưởng!

♪