10104

♪ ♪

Alex: Xin chào, tôi là Alex Abramets.

Chào mừng đến với "Tích hợp ứng dụng đa phương tiện của bạn với HomePod."

Tôi ở đây để giới thiệu một khả năng Siri mới, thú vị cho Gia đình.

Bắt đầu với iOS 17, bất kỳ chủ sở hữu HomePod nào cũng có thể yêu cầu Siri phát phương tiện bằng các ứng dụng được cài đặt trên iPhone hoặc iPad của họ.

Khả năng Siri mới này sẽ cho phép các ứng dụng hiện đang hỗ trợ SiriKit Media Intents phát nội dung liền mạch trên HomePod.

Đầu tiên, tôi sẽ giới thiệu hỗ trợ mở rộng cho các ứng dụng đa phương tiện để phát trên HomePod.

Sau đó, tôi sẽ đề cập đến các trường hợp và kinh nghiệm sử dụng được hỗ trợ và chỉ ra những cách tốt nhất để thực hiện chúng.

Cuối cùng, tôi sẽ nói về cách khả năng này tích hợp với Ngôi nhà.

Hãy bắt đầu bằng cách xem qua hỗ trợ HomePod cho nhiều ứng dụng Media hơn.

Khi HomePod xử lý yêu cầu, ý định SiriKit được gửi đến iPhone, nơi Siri khởi động ứng dụng của bạn và nội dung AirPlays trở lại loa.

Chúng ta sẽ nói nhiều hơn về hỗ trợ AirPlay vào cuối phiên này.

Để thực hiện yêu cầu, HomePod sẽ giao tiếp với iPhone qua Wi-Fi, điều đó có nghĩa là các thiết bị cần phải ở trên cùng một mạng tại thời điểm yêu cầu.

Các thiết bị không cần phải ở gần vật lý.

Nếu tôi đang ở trong phòng khách nói chuyện với loa và điện thoại của tôi đang sạc trong phòng ngủ, HomePod sẽ phát thành công.

Siri yêu cầu phát phương tiện hoạt động với nhiều điểm đến, bao gồm hầu hết các loa hỗ trợ AirPlay.

Bất kỳ ứng dụng nào hỗ trợ SiriKit Media Intents ngày hôm nay sẽ có thể sử dụng khả năng này mà không cần thay đổi thêm.

Sau đó, tôi sẽ nói về một vài điều có thể làm cho trải nghiệm và hiệu suất của người dùng thậm chí còn tốt hơn.

Các yêu cầu Phát, Thêm và Affinity yêu cầu cho các ứng dụng không được hỗ trợ nguyên bản trên HomePod, sẽ được chuyển đến iPhone chính.

Xin lưu ý rằng trên HomePod, yêu cầu tìm hoặc tìm kiếm phương tiện sẽ dẫn đến việc phát lại.

Siri sẽ dựa vào nhận dạng giọng nói để định tuyến các yêu cầu đến thiết bị của người dùng Home được công nhận.

Ngoài ra, các yêu cầu "thích" hoặc "thêm" các bài hát sẽ hoạt động ngay cả đối với nội dung đã được AirPlayed mà không cần sử dụng Siri.

Giờ đây, nhiều ứng dụng đa phương tiện hiện có sẽ có sẵn trên HomePod và nó không chỉ là âm nhạc.

Nhiều loại phương tiện được hỗ trợ.

Âm nhạc, sách nói, podcast, đài phát thanh, thiền định và hơn thế nữa.

Bất kỳ ứng dụng nào thêm hỗ trợ mới cho ý định SiriKit Media sẽ được hỗ trợ tự động trên HomePod.

Mọi thứ ứng dụng của bạn có thể làm trên iOS hôm nay sẽ hoạt động trên HomePod.

Ví dụ, người dùng ứng dụng có thể yêu cầu phát các nghệ sĩ, album, bài hát, thể loại âm nhạc và các bản hit.

Khi tên ứng dụng được sử dụng trong yêu cầu, Siri sẽ kiểm tra xem ứng dụng đã được cài đặt trên iPhone của bạn chưa.

Nếu ứng dụng được cài đặt, Siri sẽ thiết lập kết nối AirPlay và yêu cầu ứng dụng bắt đầu phát lại.

Có thể ứng dụng của bạn là về việc nghe Podcast hoặc Sách nói.

Bây giờ có thể cập nhật tin tức hoặc tiếp tục nghe sách nói hiện tại trên HomePod của bạn.

Siri sẽ hiểu các yêu cầu thay đổi tốc độ, tua nhanh và điều khiển phát lại.

Các yêu cầu cụ thể cho ứng dụng của bạn và không được bao phủ bởi ý định Truyền thông có thể được thực hiện bằng cách sử dụng Ý định Ứng dụng.

Kiểm tra "Khám phá các cải tiến cho Ý định ứng dụng" và các phiên liên quan khác.

Vậy làm cách nào để thêm Siri vào ứng dụng của tôi?

Hãy xem xét những gì cần thiết để hỗ trợ SiriKit Media Intents, sau đó nói về việc đảm bảo mọi thứ hoạt động đáng tin cậy và cung cấp trải nghiệm tuyệt vời.

Các ứng dụng có hỗ trợ hiện có cho Media Intents sẽ hoạt động.

Ví dụ: nếu SoundCloud được cài đặt trên iPhone của bạn và bạn yêu cầu HomePod phát thứ gì đó trên SoundCloud, phương tiện sẽ phát trên loa.

Thêm hỗ trợ phát lại qua Siri vào ứng dụng của bạn bao gồm một số bước đơn giản.

Bạn sẽ cần thêm tiện ích mở rộng ý định và triển khai một vài phương pháp để kết nối các cuộc gọi lại Siri với tìm kiếm và phát lại.

Bạn có thể tìm thấy hướng dẫn chi tiết trong video "Giới thiệu Ý định Truyền thông SiriKit" từ năm 2019 và "Mở rộng Ý định Truyền thông SiriKit của bạn sang nhiều nền tảng hơn" từ năm 2020.

Hãy kiểm tra mã từ một ứng dụng mẫu có thể phát một bài hát.

Ở đây, tôi đang kiểm tra xem yêu cầu có dành cho một thực thể có tên "Đẩy nó" hay không và, nếu vậy, hãy trả lại mục phương tiện.

Hãy thử xem nào.

Này Siri, chơi "Push It" của Dukes trên Control Audio.

Siri: "Push It" hiện đang phát từ iPhone của bạn.

Alex: Bài hát phát như mong đợi!

Bây giờ hãy hỏi một cái gì đó khác.

Này Siri, chơi nhạc jazz trên Control Audio.

Siri: Tôi không thể tìm thấy điều đó trong thư viện Control Audio của bạn.

Alex: Lần này, Siri nói rằng họ không tìm thấy gì cả.

Điều này xảy ra vì chức năng trả về phản hồi "không được hỗ trợ" vì ứng dụng của tôi không hỗ trợ các thể loại chơi.

Nhưng tôi có thể làm cho Siri phản hồi tốt hơn!

Tôi có thể cung cấp một lý do cụ thể hơn để không thể phát, như "loại phương tiện không được hỗ trợ" hoặc ứng dụng yêu cầu đăng nhập hợp lệ.

Đối với những trường hợp như vậy, Siri sẽ đưa ra phản hồi hỗ trợ giải quyết vấn đề.

Bây giờ, tôi sẽ thay đổi mã của mình và thêm một câu lệnh bảo vệ sẽ trả về mã lỗi cụ thể hơn nếu yêu cầu phát bất kỳ thể loại âm nhạc nào.

Này Siri, chơi nhạc jazz trên Control Audio.

Siri: Control Audio không hỗ trợ phát nó.

Alex: Vì vậy, bây giờ, Siri nói rằng ứng dụng không hỗ trợ chơi nó, đó là một phản hồi hữu ích hơn.

Bạn có thể tự hỏi ứng dụng của bạn sẽ nhận được gì khi yêu cầu Siri được thực hiện?

Trong các ví dụ trước, chúng tôi đã thảo luận về các trường "mediaName" và "mediaType".

Hãy xem lại một số ý định phổ biến nhất mà ứng dụng của bạn có thể nhận được.

Một "Chơi" đơn giản chỉ với tên ứng dụng sẽ gửi ý định mà không có bất kỳ tiêu chí tìm kiếm nào.

Các ứng dụng âm nhạc có thể phát một bản phối cá nhân hoặc một đài.

Podcast và ứng dụng sách nói có thể tiếp tục mục phát cuối cùng.

Đối với các yêu cầu "Phát nhạc trong ứng dụng", "âm nhạc" chuyển thành "mediaType".

Yêu cầu "Phát" với tên thực thể sẽ chỉ cung cấp trường mediaName.

Nó sẽ tùy thuộc vào ứng dụng để xác định loại thực thể, cho dù đó là một bài hát, nghệ sĩ, podcast hay thứ gì khác.

Đề cập đến "bài hát" và tên của nó sẽ tạo ra một mediaType bằng Song và một trường mediaName.

Đây là cách yêu cầu "những bản hit phổ biến" sẽ hoạt động.

Tên phương tiện truyền thông sẽ được đặt thành "âm nhạc" và sortOrder sẽ là "phổ biến".

Yêu cầu chơi thứ gì đó tiếp theo sẽ yêu cầu ứng dụng thêm nó vào hàng đợi.

Lưu ý rằng "playbackqueuelocation" có giá trị là "tiếp theo".

Nếu ứng dụng của bạn hỗ trợ tin tức, podcast hoặc sách nói, bạn có thể nhận được các yêu cầu như "phát sách nói của tôi", "phát tin tức mới nhất" hoặc "phát podcast tin tức công nghệ".

Bạn nên khám phá và thử nghiệm với các ý định do Siri tạo ra cho các yêu cầu mà bạn mong đợi sẽ được gửi đến ứng dụng của mình.

Sau khi giải quyết kết quả, Siri sẽ thực hiện bước "xử lý" trong phần mở rộng ý định của bạn.

Bạn có thể trả lại một trong hai câu trả lời "handleInApp" và "continueInApp."

"HandleInApp" sẽ hướng dẫn hệ thống khởi động ứng dụng và chơi ở chế độ nền.

"ContinueInApp" sẽ yêu cầu hệ thống khởi động ứng dụng ở phía trước.

Đối với các yêu cầu phát Âm thanh, phát lại nền sẽ mang lại trải nghiệm tốt hơn vì nó không yêu cầu bạn mở khóa điện thoại.

Khi một yêu cầu được gửi đến HomePod, nó thậm chí còn rõ ràng hơn, vì điện thoại của bạn không thể ở đâu gần.

Xin lưu ý rằng phản hồi của ứng dụng của bạn đối với các cuộc gọi lại Siri phải khá nhanh.

Các yêu cầu chậm thường bị bỏ rơi hoặc đơn giản là hết thời gian chờ.

Đảm bảo rằng ứng dụng của bạn phản hồi trong tối đa mười giây.

Tốt hơn là nên nhanh nhất có thể, nhưng sau mười giây, phản hồi của Siri sẽ chung chung và không hữu ích lắm.

Điều gì sẽ xảy ra nếu bạn muốn nói với Siri rằng bạn thích bài hát hoặc podcast, hoặc muốn thêm nó vào danh sách phát của mình?

Hỗ trợ INAddMediaIntent và INUpdateMediaAffinityIntent sẽ cho phép ứng dụng của bạn hoạt động với các yêu cầu này.

Việc triển khai rất giống với INPlayMediaIntent.

Đối với nội dung AirPlayed, Siri sẽ gửi yêu cầu đến iPhone của người nói.

Hãy cùng xem xét một vài điều có thể làm cho việc tích hợp ứng dụng của bạn với Siri mạnh mẽ hơn.

Đầu tiên là từ vựng ứng dụng cá nhân.

Sử dụng từ vựng ứng dụng cá nhân, ứng dụng của bạn có thể thông báo cho hệ thống các thực thể dành riêng cho người dùng mà các yêu cầu có thể bao gồm.

Chúng có thể bao gồm danh sách phát cá nhân, sách nói đã mua, podcast, nghệ sĩ yêu thích hoặc tác giả.

Thông thường, chỉ các ứng dụng tiền cảnh mới có thể bắt đầu phát lại, nhưng trong quá trình yêu cầu Siri, ứng dụng của bạn có thể khởi động âm thanh trong nền.

Để điều này hoạt động, điều rất quan trọng là phải có phiên âm thanh được cấu hình đúng trước khi kích hoạt phiên đó.

Điều này áp dụng cho tất cả các nền tảng được hỗ trợ, bao gồm HomePod, iOS và CarPlay.

Trong ví dụ này, bằng cách đặt danh mục âm thanh để phát lại, ứng dụng sẽ thông báo cho hệ thống rằng nó sẽ phát âm thanh.

Danh mục âm thanh, chế độ và chính sách chia sẻ tuyến đường sẽ ảnh hưởng đến cách hệ thống xử lý phát lại và gián đoạn âm thanh.

Đặt chế độ thành "âm thanh nói" sẽ tạm dừng phát lại khi bị gián đoạn thay vì tạm thời giảm âm lượng nội dung của bạn.

Điều này đặc biệt hữu ích cho các ứng dụng phát podcast hoặc sách nói, để người nghe không bỏ lỡ bất kỳ phần quan trọng nào của nội dung.

Hãy kiểm tra xem điều gì sẽ xảy ra nếu danh mục âm thanh không được đặt thành ".phát lại" trước khi kích hoạt phiên.

Này, Siri, chơi "Push It" của Dukes trên Control Audio.

Siri: "Push It" hiện đang phát từ iPhone của bạn.

Alex: Trong khi ứng dụng ở phía trước, âm thanh sẽ phát, nhưng một khi ứng dụng đi vào nền, ví dụ như khi tôi khóa điện thoại, quá trình phát lại sẽ dừng lại.

Nó hoạt động, nhưng không phải theo cách bạn mong đợi.

Hãy cùng tìm hiểu điều gì sẽ xảy ra nếu tôi thay đổi mã của mình để định cấu hình chính xác phiên âm thanh.

Này, Siri, chơi "Push It" của Dukes trên Control Audio.

Siri: Đây là "Push It" từ iPhone của bạn.

Alex: Khi tôi khóa điện thoại, âm thanh tiếp tục phát.

♪ ♪

HomePod và iPhone có thể làm nhiều việc, vì vậy không có gì lạ khi phát lại âm thanh từ ứng dụng của bạn bị gián đoạn bởi cuộc gọi đến, lời nhắc điều hướng, yêu cầu Siri hoặc các ứng dụng khác đang phát thứ khác.

Điều quan trọng là phải xử lý các gián đoạn để ứng dụng của bạn có thể tiếp tục phát, đặc biệt là khi ai đó trong phòng đang nói chuyện với HomePod và không có sẵn iPhone của họ.

Được rồi, hãy nói về AirPlay.

Để hệ thống phát thành công nội dung AirPlay từ ứng dụng của bạn, hãy đảm bảo rằng bạn làm như sau: đặt danh mục âm thanh, chế độ và chính sách chia sẻ tuyến đường một cách thích hợp như tôi đã nói trước đó, sử dụng MPNowPlayingInfoCenter để thông báo cho hệ thống về mục hiện đang phát và MPRemoteCommandCenter để

Các bước này sẽ làm cho phương tiện từ ứng dụng của bạn phát trên loa AirPlay.

Nhưng vì dữ liệu âm thanh đang được chuyển đến một thiết bị khác, hệ thống cần một bộ đệm và sẽ tích lũy một số dữ liệu để đảm bảo phát lại mượt mà.

Điều này có thể gây ra sự chậm trễ mỗi khi phương tiện truyền thông được nối lại hoặc dừng lại.

Sử dụng một trong các API để phát lại bộ đệm sẽ loại bỏ mối quan tâm này.

Hãy xem phiên năm nay có tên "Điều chỉnh trải nghiệm AirPlay của bạn" để biết thêm về chủ đề này.

Tiếp theo, tôi sẽ nói về những cân nhắc bổ sung cho khả năng này.

Nếu tôi có nhiều iPhone hoặc iPad thì sao? Làm thế nào để Siri biết nên sử dụng cái nào?

Câu trả lời là Siri sẽ định tuyến các yêu cầu SiriKit Media đến iPhone chính, đây là yêu cầu được thiết lập để chia sẻ vị trí của bạn trong cài đặt Apple ID và Find My.

Vì Siri sẽ giao tiếp với các thiết bị khác để thực hiện các yêu cầu này, người dùng yêu cầu sẽ cần được đăng ký tại Trang chủ và bật Nhận dạng giọng nói của tôi.

Bạn có thể tìm thấy cài đặt này trong ứng dụng Home.

Không cần bật Yêu cầu Cá nhân để tính năng này hoạt động.

Hãy nhớ rằng nếu bạn không bật "Nhận dạng giọng nói của tôi" hoặc bạn chưa đăng ký tại Trang chủ, bạn sẽ không thể phát phương tiện từ thiết bị của mình hoặc của bất kỳ ai khác.

Nếu bạn vừa cài đặt ứng dụng hoặc không bao giờ yêu cầu Siri phát từ nó, yêu cầu đầu tiên để Phát bằng ứng dụng sẽ hướng bạn đến thiết bị iOS của bạn và yêu cầu quyền Siri truy cập dữ liệu ứng dụng.

Sự cho phép này chỉ cần thiết cho yêu cầu Siri đầu tiên để Phát từ ứng dụng của bạn.

Trước khi tôi để bạn đi, đây là những điều bạn nên nhớ.

Thêm hỗ trợ SiriKit Media intents là một điều cần thiết để ứng dụng của bạn hoạt động trên HomePod.

Bạn có thể cải thiện hơn nữa trải nghiệm người dùng bằng cách thêm Buffered Playback, hỗ trợ các truy vấn phức tạp hơn và cung cấp cho Siri nhiều ngữ cảnh hơn.

Cảm ơn bạn!

Tôi nóng lòng muốn thấy các ứng dụng của bạn hoạt động với HomePod!

♪ ♪