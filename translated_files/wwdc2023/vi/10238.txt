10238

♪ ♪

Kelly: Xin chào, tên tôi là Kelly, và tôi là một kỹ sư trong đội AirPlay.

Chào mừng đến với buổi học.

Hôm nay, chúng tôi sẽ đề cập đến một số tính năng của phiên bản AirPlay mới nhất và cung cấp cho bạn một số mẹo để đảm bảo bạn đang mang đến trải nghiệm AirPlay tuyệt vời trên ứng dụng của mình.

Đây là chương trình nghị sự mà chúng tôi dành cho bạn hôm nay.

Tôi sẽ bắt đầu với một cái nhìn tổng quan về AirPlay.

Sau đó khám phá một số tính năng mà bộ đệm âm thanh nâng cao AirPlay cung cấp.

Và cuối cùng, tôi sẽ đề cập đến cách tích hợp bộ đệm âm thanh nâng cao vào ứng dụng của bạn.

AirPlay là cách dễ nhất để chia sẻ video, ảnh, nhạc và hơn thế nữa từ các thiết bị Apple đến loa và màn hình gần đó.

Với rất nhiều thiết bị tương thích AirPlay trong nhà ngày nay, AirPlay phổ biến hơn bao giờ hết.

Bạn có thể sử dụng AirPlay theo một trong những cách sau: Với AirPlay Audio, bạn có thể chia sẻ nhạc hoặc podcast yêu thích của mình bằng cách phát trực tuyến đến một hoặc nhiều loa tương thích HomePods và AirPlay đồng bộ hoàn hảo.

Với AirPlay Video, bạn có thể phát trực tuyến các bộ phim và chương trình yêu thích của mình từ các thiết bị Apple sang Apple TV hoặc TV thông minh tương thích AirPlay với chất lượng cao, hỗ trợ HDR lên đến 4K.

Và với tính năng phản chiếu, bạn có thể chia sẻ những gì có trên thiết bị Apple của mình - ảnh, video cá nhân, trò chơi, trang web hoặc bảng tính - với Apple TV hoặc TV thông minh tương thích AirPlay.

Bạn bè và gia đình của bạn cũng có thể dễ dàng chia sẻ những gì có trên thiết bị Apple của họ.

Đối với video hôm nay, tôi sẽ tập trung vào khía cạnh phát trực tuyến âm thanh của AirPlay.

AirPlay mang đến trải nghiệm phát trực tuyến âm thanh liền mạch cho một hoặc nhiều thiết bị.

Có một hệ sinh thái đầy đủ các thiết bị hỗ trợ âm thanh AirPlay ngày nay, từ các thiết bị Apple như HomePod, Mac và Apple TV, đến các sản phẩm âm thanh và video từ các thương hiệu hàng đầu thế giới, bao gồm hàng trăm triệu TV thông minh.

AirPlay rất tiện lợi, và cá nhân tôi thích sử dụng nó hàng ngày của mình.

Khi AirPlay tiếp tục phát triển, kỳ vọng từ các nhà phát triển và khách hàng cũng vậy.

Để đưa AirPlay lên một tầm cao mới, có một giao thức mới và được cải tiến, bộ đệm âm thanh nâng cao AirPlay, để mang lại trải nghiệm rạp hát tại nhà và đa kênh thậm chí còn tốt hơn.

Bộ đệm âm thanh nâng cao được xây dựng từ đầu với toàn bộ âm thanh gia đình.

Nó rất mạnh mẽ.

Âm thanh truyền nhanh hơn tốc độ phát lại thời gian thực để giảm thiểu sự gián đoạn phát lại.

Nó đáp ứng nhanh, vì vậy ứng dụng của bạn ngay lập tức phản hồi khi chạm vào HomePod hoặc khi sử dụng iPhone của bạn làm điều khiển từ xa.

Nó hỗ trợ các định dạng âm thanh đa kênh, như Dolby ATMOS từ Apple TV và mới trong năm nay, sử dụng thông minh phát lại Lossless cho iOS.

Bộ đệm âm thanh nâng cao cung cấp hỗ trợ tốt nhất cho HLS Interstitials để hỗ trợ quảng cáo.

Bạn có thể tìm hiểu thêm về quảng cáo xen kẽ HLS từ video của đồng nghiệp Amit của tôi, "Khám phá AirPlay với quảng cáo xen kẽ."

Như bạn có thể thấy, chúng tôi đã xây dựng một nền tảng tuyệt vời với bộ đệm âm thanh nâng cao cho tương lai.

Tích hợp điều này sẽ tạo ra trải nghiệm AirPlay tuyệt vời với ứng dụng của bạn.

Hãy xem bạn có thể hưởng lợi như thế nào từ bộ đệm âm thanh nâng cao.

Tôi đang phát trực tuyến âm thanh từ điện thoại của mình đến HomePod.

Hãy tưởng tượng tôi đang đổ rác, và bây giờ tôi đã ra khỏi phạm vi Wi-Fi của mình.

♪ ♪

Lưu ý HomePod tiếp tục phát.

Khi tôi cố gắng kết nối lại với mạng, âm nhạc của tôi không bỏ qua một nhịp nào và điện thoại của tôi kết nối lại liền mạch với HomePod.

♪ ♪

Tôi có thể điều khiển phát lại từ điện thoại của mình một lần nữa.

Đây là loại hiệu suất mà mọi người mong đợi khi sử dụng AirPlay để phát nhạc trên loa tương thích AirPlay như HomePod.

Bây giờ với tất cả những điều tuyệt vời mà bộ đệm âm thanh nâng cao cung cấp, hãy kết hợp nó vào ứng dụng của bạn.

Hãy xem lại cách thêm hỗ trợ AirPlay vào ứng dụng của bạn.

Điều quan trọng là phải cấu hình phiên âm thanh đúng cách cho hành vi trộn và gián đoạn chính xác cho ứng dụng của bạn.

Nếu phát phương tiện là trung tâm của ứng dụng của bạn, hãy đặt danh mục phiên âm thanh của bạn thành phát lại.

Điều này sẽ đảm bảo phương tiện của ứng dụng của bạn sẽ tiếp tục phát khi ứng dụng ở chế độ nền.

Nói chung, bạn có thể đặt chế độ thành mặc định, nhưng nó được khuyến nghị cho âm thanh nói, như podcast hoặc sách nói, để đặt chế độ thành Âm thanh nói.

Cuối cùng, đặt chính sách định tuyến của phiên âm thanh thành longFormAudio.

Âm thanh dạng dài là bất cứ thứ gì khác ngoài âm thanh hệ thống, chẳng hạn như âm nhạc hoặc podcast.

Mới trong năm nay, chúng tôi đang làm cho AirPlay liền mạch hơn bao giờ hết.

iPhone và iPad của bạn hiện sử dụng trí thông minh trên thiết bị để tìm hiểu các tùy chọn AirPlay của bạn.

Vì vậy, bởi vì bạn thường nghe nhạc khi nấu bữa tối, HomePod gần đó trong nhà bếp sẽ tự động hiển thị, giúp mọi người dễ dàng phát nội dung ứng dụng của bạn ở nơi họ muốn.

Nếu bạn cung cấp nội dung âm thanh dạng dài, thì bạn muốn hỗ trợ điều này.

Và thật đơn giản để thêm hỗ trợ cho đề xuất AirPlay thông minh trong ứng dụng của bạn.

Ngoài cấu hình AVAudioSession mà chúng ta đã thảo luận, bước mới duy nhất là vào Info Plist của ứng dụng của bạn, khóa AVInitialRouteSharingPolicy và đặt nó thành LongFormAudio.

Trong Xcode, khóa này được gọi là "Chính sách tối ưu hóa AirPlay" trong trình đơn thả xuống.

Và thế là xong.

iOS sẽ xử lý phần còn lại và sử dụng học tập trên thiết bị để cung cấp cho mọi người một cách thông minh loa gần đó mà họ sử dụng khi mở ứng dụng của bạn.

Tiếp theo, thêm AVRoutePickerView vào hệ thống phân cấp chế độ xem của bạn để bao gồm bộ chọn AirPlay trong ứng dụng của bạn.

Bộ chọn cung cấp cho mọi người danh sách các thiết bị AirPlay tiềm năng mà họ có thể sử dụng với ứng dụng của bạn.

Cuối cùng, sử dụng MPNowPlayingInfoCenter để thông báo cho hệ thống về mục phát hiện tại và MPRemoteCommandCenter để nhận các lệnh từ xa, như phát, tạm dừng hoặc bỏ qua.

Điều đó bao gồm ứng dụng của bạn được thiết lập cho AirPlay.

Bây giờ, để hỗ trợ bộ đệm âm thanh nâng cao, bạn sẽ cần áp dụng một trong hai bộ API này, AVPlayer và AVQueuePlayer hoặc AVSampleBufferAudioRenderer và AVSampleBufferRenderSynchronizer.

Cả hai API sẽ hoạt động để phát lại không phải AirPlay, bao gồm cục bộ hoặc Bluetooth.

Tuy nhiên, một số nhà phát triển có thể muốn các API khác nhau để phát lại AirPlay và không phải AirPlay.

Trong trường hợp đó, ứng dụng của bạn có thể đăng ký routeChangeNotification và hành động phù hợp tùy thuộc vào tuyến đường hiện tại.

AVPlayer và AVQueuePlayer cung cấp cách đơn giản nhất để hỗ trợ bộ đệm âm thanh nâng cao cho ứng dụng của bạn.

Đối với đa số các nhà phát triển ứng dụng, chúng tôi khuyên bạn nên áp dụng AVQueuePlayer.

AVQueuePlayer sẽ xử lý hầu hết những gì phát lại cần, chẳng hạn như quản lý các mục, kiểm soát phát lại và tìm kiếm thông qua phương tiện.

Hầu hết các ứng dụng đa phương tiện của Apple cũng sử dụng AVQueuePlayer.

Để bắt đầu, hãy tạo một trình phát hàng đợi.

Xác định URL trỏ đến nội dung cục bộ hoặc đám mây mà bạn muốn phát.

Sau đó tạo một phiên bản AVAsset với URL và tạo một phiên bản AVPlayerItem với tài sản đó.

Cuối cùng, đưa AVPlayerItem cho người chơi và bắt đầu phát lại.

Thật đơn giản.

Bạn có thể đang nghĩ, "Nó chỉ xếp hàng một vật phẩm chơi vào người chơi.

Phần AirPlay ở đâu?"

Và điều đó đúng.

Bằng cách sử dụng AVPlayer và AVQueuePlayer, bạn sẽ tự động nhận được bộ đệm âm thanh nâng cao khi nó được chuyển đến AirPlay.

Để biết thêm các chức năng của AVPlayer, vui lòng tham khảo các liên kết trong phần mô tả.

Nếu bạn có một ứng dụng duy nhất cần thực hiện tiền xử lý trên dữ liệu phương tiện hoặc có mô hình DRM mà AVPlayer không hỗ trợ, thì bạn có thể sử dụng AVSampleBufferAudioRenderer và AVSampleBufferRenderSynchronizer.

Bạn sẽ sử dụng các API để đồng bộ hóa nhiều bộ đệm mẫu được xếp hàng đợi với một dòng thời gian duy nhất.

Ở đây tôi sẽ xem xét những điều cơ bản về cách xếp hàng dữ liệu âm thanh với nó.

Đầu tiên, bạn cần tạo một hàng đợi nối tiếp để thực hiện tất cả các thao tác phát lại.

Tạo trình kết xuất âm thanh và trình đồng bộ hóa kết xuất.

Bộ đồng bộ hóa được sử dụng để thiết lập dòng thời gian truyền thông.

Sau đó, thêm trình kết xuất âm thanh vào trình đồng bộ hóa kết xuất.

Điều này sẽ yêu cầu trình kết xuất âm thanh theo dòng thời gian phương tiện.

Để xếp hàng dữ liệu âm thanh, hãy cài đặt một cuộc gọi lại sẽ cho bạn biết bạn cần thêm dữ liệu.

Bắt đầu xếp hàng dữ liệu âm thanh trong cuộc gọi lại đó.

Và khi không còn dữ liệu âm thanh nữa, hãy yêu cầu trình kết xuất ngừng yêu cầu dữ liệu.

Đây chỉ là những điều cơ bản của giao diện.

Để biết thêm chi tiết, vui lòng tham khảo tài liệu được liên kết trong phần mô tả, nơi chúng tôi mô tả chuyên sâu về cách sử dụng API này, cùng với một dự án mẫu để xây dựng trình phát tùy chỉnh.

Điều đó bao gồm hai API mà bạn có thể sử dụng để tận dụng bộ đệm âm thanh nâng cao cho các thiết bị tương thích AirPlay.

Và đó không phải là tất cả.

Các nhà sản xuất ô tô hiện có thể hỗ trợ bộ đệm nâng cao trong việc triển khai CarPlay của họ.

Tại sao điều này lại quan trọng?

Ngày càng có nhiều phương tiện hỗ trợ CarPlay không dây.

Phát lại mạnh mẽ và điều khiển đáp ứng là rất quan trọng để có trải nghiệm âm thanh tốt nhất trên đường.

Tin tốt là, bằng cách thêm bộ đệm âm thanh nâng cao vào ứng dụng của bạn với một trong hai API mà chúng ta đã nói trước đây, nó cũng sẽ hoạt động cho CarPlay.

Những người sử dụng ứng dụng của bạn sẽ có trải nghiệm phát trực tuyến âm thanh tốt nhất ở bất cứ nơi nào hành trình của họ đưa họ đến.

Tóm lại, bạn sẽ cần định cấu hình phiên âm thanh để hỗ trợ AirPlay, thêm bộ chọn AirPlay vào ứng dụng của mình, tích hợp Trình phát đa phương tiện vào ứng dụng của bạn và áp dụng AVQueuePlayer hoặc API kết xuất và đồng bộ hóa tùy chỉnh để tăng cường bộ đệm âm thanh.

Đây mới chỉ là sự khởi đầu.

Chúng tôi liên tục cải tiến và làm việc để mang lại nhiều tính năng hơn cho công nghệ này.

Hy vọng bạn thích buổi học. Cảm ơn bạn.

♪ ♪