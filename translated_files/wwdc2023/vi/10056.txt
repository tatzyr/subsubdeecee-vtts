10056

♪ ♪

Michael: Xin chào và chào mừng.

Tôi là Michael Ochs và trong video này tôi sẽ nói về cách xây dựng các ứng dụng tập trung vào tài liệu tốt hơn.

Các ứng dụng lấy tài liệu làm trung tâm là một phần quan trọng của các công cụ năng suất, đặc biệt là trên iPad.

Có ba loại ứng dụng tập trung vào tài liệu.

Những thứ cho phép duyệt tài liệu, chẳng hạn như ứng dụng Tệp; những thứ cho phép xem nội dung, ví dụ như Xem nhanh; và những thứ cũng cho phép chỉnh sửa hoặc tạo nội dung, như Pages, Keynote hoặc Numbers.

Video này tập trung vào các cải tiến đối với ứng dụng người xem và biên tập, nhưng một số nội dung được thảo luận cũng áp dụng cho các ứng dụng trình duyệt.

iPadOS 17 giới thiệu bộ điều khiển chế độ xem mới tự động kích hoạt một số lượng lớn các tính năng trong ứng dụng của bạn.

Nó hoạt động tốt cùng với các API iPad cấp máy tính để bàn được giới thiệu trong iPadOS 16 và các API tập trung vào tài liệu hiện có.

Bộ điều khiển chế độ xem mới này được xây dựng theo cách mô-đun.

Bạn nhận được các mặc định hệ thống tuyệt vời, nhưng có thể tùy chỉnh bất kỳ hành vi cá nhân nào.

Để bắt kịp các API iPad cấp máy tính để bàn, hãy xem 'Gặp gỡ iPad cấp máy tính để bàn' và 'Xây dựng ứng dụng iPad cấp máy tính để bàn' từ WWDC22.

Để phát triển SwiftUI, DocumentGroup hiện có hỗ trợ cho tất cả các tính năng này mà không cần mã bổ sung.

Để tìm hiểu thêm về khía cạnh SwiftUI của điều này, hãy xem 'Xây dựng các ứng dụng dựa trên tài liệu trong SwiftUI' từ WWDC20 và 'SwiftUI trên iPad: Thêm thanh công cụ, tiêu đề và hơn thế nữa' từ WWDC22.

Trong UIKit, chức năng là chọn tham gia.

UIDocumentViewController là một lớp cơ sở mới cho bộ điều khiển chế độ xem nội dung.

Nó hoạt động cùng với UIDocument để tự động định cấu hình thanh điều hướng.

Điều này cho phép các tính năng như chia sẻ, kéo tài liệu, hoàn tác và làm lại hỗ trợ, v.v.

Nó cũng hỗ trợ đổi tên tự động.

Trong video này, bạn sẽ học cách sử dụng UIDocument và cách trình bày tài liệu với UIDocumentViewController.

Sau đó tôi sẽ giải thích những tính năng nào được tích hợp sẵn và cách tùy chỉnh chúng hơn nữa.

Cuối cùng, tôi khám phá một số phương pháp hay nhất để di chuyển các ứng dụng hiện có của bạn để tận dụng UIDocument.

Đầu tiên, tạo một tài liệu.

Cốt lõi của mọi ứng dụng dựa trên tài liệu là UIDocument.

Đó là một lớp cơ sở trừu tượng có nghĩa là được phân loại con cho mỗi loại tệp mà ứng dụng của bạn hỗ trợ.

Tất cả UIDocuments được hỗ trợ bởi một URL.

Các tệp trên đĩa là phổ biến nhất, nhưng bạn cũng có thể lưu và tải tài liệu của mình bằng cách sử dụng cơ sở dữ liệu và sơ đồ URL tùy chỉnh.

Các hoạt động tải và lưu của UIDocument không đồng bộ, cho phép các thao tác đọc và ghi dài, nếu cần.

Vì lý do này, UIDocument là luồng an toàn và đảm nhận việc phối hợp truy cập thông qua các khóa và hàng đợi.

Khi triển khai lớp con UIDocument, có hai trách nhiệm chính cần đảm nhận: tải và lưu tài liệu và cung cấp quyền truy cập vào nội dung của tài liệu.

Tải và lưu rất giống nhau trên tất cả các tài liệu.

Truy cập nội dung cụ thể hơn cho loại tài liệu và cách nó được sử dụng trong ứng dụng của bạn.

Ví dụ, một mô hình tài liệu cho trình chỉnh sửa đánh dấu có thể chỉ có một thuộc tính văn bản duy nhất; hoặc nó có thể hiển thị một giao diện phức tạp hơn cho phép cập nhật các phần riêng lẻ của tài liệu.

Trước khi chúng ta nói nhiều hơn về việc truy cập nội dung, hãy nói về việc tải và lưu.

Đối với các tài liệu đơn giản, dựa trên tệp, có hai phương pháp tiện lợi mà bạn có thể ghi đè.

Khi một tài liệu được mở, 'loadFromContents:ofType:' sẽ được gọi với nội dung của tệp.

Khi tài liệu đang được lưu, 'contentsForType:' được gọi để lấy nội dung hiện tại của tài liệu.

Nội dung của tài liệu là một đối tượng Dữ liệu cho các tệp thông thường hoặc một FileWrapper cho mọi thứ khác.

Để tìm hiểu thêm về các loại tệp và cách chúng hoạt động, hãy xem Tech Talk 'Uniform Type Identifiers - giới thiệu lại'.

Ví dụ ở đây, tài liệu xử lý các tệp đánh dấu thông thường, vì vậy chúng tôi mong đợi một đối tượng dữ liệu.

Bây giờ, nếu bạn muốn kiểm soát hoàn toàn, việc ghi đè 'saveToURL:forSaveOperation:' và 'readFromURL:' thay vào đó cho phép bạn toàn quyền truy cập vào URL và để lại tất cả việc đọc và viết cho bạn.

Điều này thật tuyệt nếu bạn muốn lưu trữ tài liệu của mình trong cơ sở dữ liệu hoặc có các yêu cầu đặc biệt để đọc và viết tài liệu của mình.

Lưu ý rằng trong khi thao tác lưu không đồng bộ, việc đọc dự kiến sẽ hoàn tất vào thời điểm phương thức trả về.

Và đây là tất cả những gì cần tải và lưu một tài liệu.

Bây giờ hãy đảm bảo rằng chúng ta có cách truy cập nội dung của tài liệu.

Một cách dễ dàng để cung cấp quyền truy cập vào nội dung của tài liệu là thêm các thuộc tính cho nội dung đó.

Trong ví dụ này, tôi thêm một thuộc tính văn bản duy nhất có chứa chuỗi đánh dấu đầy đủ.

Thuộc tính này sẽ được thiết lập khi tải tài liệu ban đầu, như đã thảo luận trên các trang trình bày trước đó.

Ứng dụng sau đó có thể cập nhật văn bản này bất cứ khi nào người dùng chỉnh sửa tài liệu.

Để UIDocument biết khi nào nó yêu cầu lưu, hãy gọi 'updateChangeCount:' mỗi khi tài sản cập nhật.

Gọi 'updateChangeCount:' cho phép UIDocument đánh dấu tài liệu là tiết kiệm nhu cầu và tự động lưu vào những thời điểm thích hợp.

Tiếp theo, trình bày một tài liệu với UIDocumentViewController mới.

Tương tự như UIDocument, UIDocumentViewController cũng là một lớp cơ sở trừu tượng có nghĩa là được phân lớp con.

Nó quản lý việc mở, lưu và đóng tài liệu và điền vào mục điều hướng của nó với thông tin từ tài liệu liên quan của nó.

Điều này bao gồm tiêu đề, menu tiêu đề của mục điều hướng, đối tượng UIDocumentProperties và đại diện đổi tên.

UIDocumentViewController cũng cung cấp các lệnh khóa cho các hành động phổ biến như hoàn tác và làm lại.

Hãy cùng xem cách triển khai lớp con UIDocumentViewController.

Có hai phương thức được thiết kế để bị ghi đè bởi lớp con của bạn.

Khi tài liệu được liên kết với bộ điều khiển chế độ xem được mở hoặc khi một tài liệu đã mở được gán cho bộ điều khiển chế độ xem, 'documentDidOpen' được gọi.

Điền chế độ xem của bộ điều khiển chế độ xem để hiển thị nội dung của tài liệu theo phương pháp này.

Lưu ý rằng không có đảm bảo thời gian giữa khi 'documentDidOpen' được gọi và khi chế độ xem của bộ điều khiển chế độ xem được tải.

Một cách tiếp cận tốt để viết mã mạnh mẽ là di chuyển cấu hình chế độ xem theo phương thức riêng của nó và gọi nó từ cả hai, 'documentDidOpen' cũng như 'viewDidLoad'.

Kiểm tra xem chế độ xem đã được tải và tài liệu đã được mở chưa, trước khi định cấu hình chế độ xem của bạn.

Phương pháp thứ hai để ghi đè là 'navigationItemDidUpdate'.

Bất cứ khi nào UIDocumentViewController thực hiện thay đổi đối với mục điều hướng, nó sẽ gọi phương thức này.

Thêm tùy chỉnh mục điều hướng của bạn vào đó.

'UIDocumentViewController' sẽ nỗ lực hết sức để giữ các thay đổi ở mức tối thiểu để duy trì các thay đổi của bạn tốt nhất có thể.

UIDocumentViewController cũng cung cấp một 'undoRedoItemGroup'.

Đặt nhóm này vào thanh điều hướng nếu bạn muốn các nút hoàn tác và làm lại xuất hiện và đảm bảo rằng tài liệu của bạn có trình quản lý hoàn tác được gán cho nó.

UIDocumentViewController sẽ thay đổi thuộc tính 'ẩn' của nhóm này tùy thuộc vào tính khả dụng của trình quản lý hoàn tác và bật hoặc tắt các nút bên trong nhóm khi cần thiết.

UIDocumentViewController tự động mở và đóng tài liệu.

Tuy nhiên nếu bạn cần quyền truy cập vào tài liệu từ bên ngoài bộ điều khiển chế độ xem, hãy gọi 'openDocumentWithCompletionHandler'.

UIDocumentViewController sẽ thực hiện tất cả các cuộc gọi lại cần thiết, chẳng hạn như gọi 'documentDidOpen' và gọi trình xử lý hoàn thành của bạn khi sẵn sàng.

Cuối cùng nhưng không kém phần quan trọng, UIDocumentViewController cung cấp một thuộc tính tài liệu.

Thuộc tính này luôn đề cập đến tài liệu được liên kết với bộ điều khiển chế độ xem.

Mặc dù bạn có thể cung cấp một tài liệu trong quá trình khởi tạo, nhưng nó hoàn toàn là tùy chọn.

Khi không có tài liệu nào được liên kết với bộ điều khiển chế độ xem, nó sẽ tự động hiển thị trạng thái trống.

Để tìm hiểu thêm về cấu hình trạng thái trống, hãy xem "Có gì mới trong UIKit".

Hơn nữa, UIDocumentViewController có thể được sử dụng làm bộ điều khiển chế độ xem gốc của ứng dụng của bạn.

Nếu không có bộ điều khiển chế độ xem trình duyệt trong hệ thống phân cấp, UIDocumentViewController sẽ đặt một nút tài liệu vào thanh điều hướng để mở bộ chọn tài liệu.

Điều này yêu cầu khai báo khóa 'UIDocumentClass' cho loại tệp có liên quan trong info.plist của ứng dụng của bạn và đặt nó thành lớp con UIDocument phù hợp với loại tệp đó.

Trong iPadOS 17, UIDocument phù hợp với 'UINavigationItemRenameDelegate' và sẽ tự xử lý các thay đổi tệp cơ bản khi người dùng gọi đổi tên từ menu tiêu đề.

Nếu bạn đang sử dụng UIDocumentViewController, nó sẽ tự động định cấu hình đổi tên cho bạn, nếu không bạn có thể đặt tài liệu làm đại diện đổi tên của mục điều hướng theo cách thủ công.

Đây là tất cả những phần bạn cần để tạo ra một ứng dụng tập trung vào tài liệu tuyệt vời trong iPadOS 17.

Tiếp theo, cách di chuyển các ứng dụng hiện có của bạn.

Di chuyển ứng dụng của bạn để sử dụng UIDocumentViewController mới thật dễ dàng và chỉ cần ba bước.

Đầu tiên, cập nhật lớp cơ sở của bộ điều khiển chế độ xem nội dung của bạn.

Thứ hai, di chuyển mã hiện có sang các cuộc gọi lại mới.

Và thứ ba, xóa mã không còn cần thiết nữa.

Hãy xem cách chuyển đổi ví dụ trình chỉnh sửa đánh dấu mà chúng tôi sử dụng trong các video ứng dụng iPad cấp máy tính để bàn.

Nếu bạn không quen thuộc với nó, đừng lo lắng.

Tôi sẽ hướng dẫn bạn các phần liên quan của mã hiện có trước.

Vì vậy, ở đây chúng tôi có định nghĩa của bộ điều khiển chế độ xem ở trên cùng, thuộc tính tài liệu mà nó xác định và phương thức init đặt tài liệu ban đầu và sau đó thêm lệnh gọi lại vào tài liệu của chúng tôi.

Đầu tiên chúng ta thay đổi lớp cơ sở thành UIDocumentViewController.

Bây giờ lớp này kế thừa từ UIDocumentViewController, chúng ta sẽ gặp lỗi trình biên dịch vì thuộc tính 'tài liệu' đã tồn tại trong siêu lớp với một loại khác.

Chúng tôi thay đổi tên của tài sản đó thành một tài sản cụ thể hơn, như 'markdownDocument'.

Sau đó, chúng tôi biến nó thành một thuộc tính được tính toán để chuyển thuộc tính tài liệu chung sang lớp tài liệu cụ thể được sử dụng trong bộ điều khiển chế độ xem này.

Phần cuối cùng trong mã này cần xử lý là trình khởi tạo.

Mã duy nhất trong đó mà chúng tôi vẫn cần là gán một cuộc gọi lại cho tài liệu của chúng tôi.

Vì tài liệu có thể thay đổi trong suốt vòng đời của bộ điều khiển chế độ xem này, chúng tôi di chuyển điều này để thực thi mỗi khi tài liệu thay đổi.

Một cách dễ dàng để làm điều này là ghi đè thuộc tính tài liệu và thêm lệnh gọi lại didSet.

Tuyệt vời, bây giờ lớp cơ sở đã được cập nhật, chúng ta cần xử lý các cuộc gọi lại mới.

Trong 'viewDidLoad', chúng tôi thêm các nút vào thanh điều hướng của mình và định cấu hình nó để cho phép tùy chỉnh thanh công cụ.

Đối với UIDocumentViewController, chúng tôi chuyển cái này sang lệnh gọi lại mới 'navigationItemDidUpdate'.

Tiếp theo, lớp học của chúng tôi đã có một phương thức 'didOpenDocument'.

Đây gần như là những gì UIDocumentViewController có.

Chúng ta chỉ cần đổi tên phương thức và điều chỉnh cho thực tế là tài liệu hiện là tùy chọn.

Được rồi, tiếp theo là phần mà tất cả chúng ta đều thích nhất: xóa mã.

Bộ điều khiển chế độ xem trình chỉnh sửa phù hợp với 'UINavigationItemRenameDelegate', nhưng chúng tôi không còn cần điều đó nữa.

UIDocument tự động đổi tên tất cả cho chúng tôi.

Vì vậy, chúng tôi loại bỏ định nghĩa đại diện, phương thức đại diện với tất cả mã của nó và cả gán 'renameDelegate'.

Tiếp theo chúng ta có thể xóa thêm một vài tùy chỉnh navigationItem.

Cả 'style' và 'backAction' đều được cấu hình tự động bởi bộ điều khiển xem tài liệu, vì vậy chúng ta có thể loại bỏ hoàn toàn điều này.

Ngoài ra còn có một phương thức 'updateDocumentProperties' được sử dụng để tạo một đối tượng UIDocumentProperties.

Phương pháp này được gọi từ nhiều nơi khác nhau.

Tuy nhiên, chúng tôi không cần nó nữa.

UIDocumentViewController đang làm tất cả những điều này cho chúng tôi, vì vậy chúng tôi có thể xóa nó và tất cả các trang web cuộc gọi của nó.

Và đó là tất cả những gì phải làm.

Bộ điều khiển chế độ xem trình chỉnh sửa hiện chỉ quan tâm đến các tính năng duy nhất của ứng dụng.

Nó không còn phải quản lý các tác vụ cơ bản của quản lý tài liệu hoặc cấu hình mặc định của thanh điều hướng.

Thay vào đó, bạn có thể tập trung vào các phần độc đáo, các yếu tố chính của ứng dụng của bạn.

Đây là tất cả những gì bạn cần biết để đưa các ứng dụng lấy tài liệu làm trung tâm của mình lên một tầm cao mới và cung cấp cho người dùng trải nghiệm tuyệt vời.

Chuyển đổi mô hình dữ liệu của bạn để sử dụng UIDocument.

Sau đó chuyển đổi bộ điều khiển chế độ xem nội dung của bạn để sử dụng lớp cơ sở UIDocumentViewController mới.

Sau đó, đi qua bộ điều khiển chế độ xem của bạn và xóa tất cả mã không còn cần thiết nữa.

Cảm ơn vì đã xem.

♪ ♪