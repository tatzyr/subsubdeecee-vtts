10119

♪ Hip-hop nhạc cụ êm dịu ♪

♪

David Johnson: Xin chào mọi người.

Chào mừng đến với "Có gì mới trong tiện ích mở rộng Safari."

Tên tôi là David Johnson, và tôi là một kỹ sư mở rộng Safari tại Apple.

Hôm nay, tôi rất vui được nói với bạn về một số phát triển gần đây trong các tiện ích mở rộng Safari, nêu bật những cải tiến về trải nghiệm người dùng và các tính năng mới.

Đầu tiên, chúng tôi muốn cảm ơn bạn đã tạo và chia sẻ hơn 2000 tiện ích mở rộng Safari có sẵn trên App Store ngày hôm nay.

Nhu cầu về các tiện ích mở rộng Safari trên iOS đặc biệt ấn tượng.

Chúng thường nằm trong số các danh mục hàng đầu trên App Store kể từ khi được giới thiệu tại WWDC21.

Tiện ích mở rộng của bạn cho phép người dùng tùy chỉnh trải nghiệm duyệt web của họ trên macOS, iOS và iPadOS.

Có bốn cách để xây dựng tiện ích mở rộng Safari: trình chặn nội dung, tiện ích mở rộng chia sẻ, tiện ích mở rộng ứng dụng và tiện ích mở rộng web.

Safari 17 tiếp tục hỗ trợ tất cả các loại này, nhưng tương lai của tùy chỉnh trình duyệt nằm ở các tiện ích mở rộng web.

Apple chuyên chuẩn hóa các tiện ích mở rộng web cùng với các nhà cung cấp trình duyệt lớn khác.

Sự hợp tác này nhằm mục đích cải thiện khả năng tương thích, hợp lý hóa sự phát triển và đảm bảo trải nghiệm quen thuộc trên tất cả các trình duyệt.

Chúng tôi đang làm việc cùng nhau trong Nhóm Cộng đồng Mở rộng WebW3C, nơi Apple tự hào đóng vai trò là đồng chủ tịch.

Bằng cách kết nối với các nhà phát triển trình duyệt và tiện ích mở rộng khác để thúc đẩy nỗ lực tiêu chuẩn hóa này, chúng tôi đang xây dựng một hệ sinh thái mở rộng web mạnh mẽ và thống nhất hơn.

Trước khi chuyển sang các chủ đề hôm nay, tôi muốn chia sẻ hai chi tiết chính về các tiện ích mở rộng web Safari.

Đầu tiên, Safari 17 sẽ tiếp tục hỗ trợ cả tiện ích mở rộng web Manifest v2 và v3.

Chúng tôi sẽ tiếp tục thêm các tính năng mới vào Manifest v3, vì vậy hãy cập nhật khi nó có ý nghĩa cho tiện ích mở rộng của bạn.

Thứ hai, tiện ích mở rộng web là cách tốt nhất để xây dựng tiện ích mở rộng cho Safari trên các nền tảng.

Với một cơ sở mã được chia sẻ duy nhất, các tiện ích mở rộng web cho phép bạn tùy chỉnh các khả năng của Safari trên iOS, iPadOS, macOS và bây giờ là xrOS.

Đúng vậy, tiện ích mở rộng web có sẵn trên iOS và iPadOS cũng sẽ có sẵn trên xrOS.

Các tiện ích mở rộng web trên xrOS hoạt động giống như bạn mong đợi và có khả năng tương tự như các tiện ích mở rộng trên iOS, bao gồm khả năng chèn tập lệnh, chạy nội dung nền và hiển thị cửa sổ bật lên.

Chúng tôi rất vui khi thấy các tiện ích mở rộng của bạn nâng cao trải nghiệm duyệt web trên xrOS như thế nào.

Để tìm hiểu thêm về Safari trên xrOS, hãy xem "Gặp gỡ Safari cho xrOS."

Với những thông báo đó, đây là những gì chúng tôi sẽ đề cập trong phần còn lại của phiên hôm nay.

Đầu tiên, chúng ta sẽ đi sâu vào một số API tiện ích mở rộng mới và cập nhật và cách chúng nâng cao khả năng của tiện ích mở rộng Safari.

Sau đó, chúng tôi sẽ đề cập đến quyền trên mỗi trang web cho các tiện ích mở rộng ứng dụng Safari, cung cấp cho người dùng nhiều quyền kiểm soát hơn đối với trải nghiệm duyệt web của họ.

Và cuối cùng, chúng ta sẽ xem xét cách đảm bảo khả năng tương thích với cả Hồ sơ Safari và Duyệt web Riêng tư.

Đầu tiên, các API mở rộng mới.

Trình chặn nội dung là một cách tuyệt vời để dọn dẹp các trang web, loại bỏ những phiền toái và chặn tải các tập lệnh.

Trình chặn nội dung sử dụng các quy tắc được xác định trong JSON để chặn hoặc ẩn nội dung mà không cần truy cập vào bất kỳ thông tin nào về những trang web nào được truy cập.

Khai báo ẩn nội dung trên các trang web có thể khó khăn.

Đó là lý do tại sao trình chặn nội dung hiện hỗ trợ bộ chọn :has().

Bộ chọn :has() rất tuyệt vì chúng cho phép trình chặn nội dung của bạn nhắm mục tiêu chính xác các phần tử mẹ dựa trên con cái của chúng.

Trong ví dụ quy tắc này, chúng tôi đang ẩn bất kỳ phần tử nào với lớp .post cũng có phần tử con với lớp .paid-promo.

Các tiện ích mở rộng ẩn nội dung trang web hoặc chặn các yêu cầu mạng là một số loại tiện ích mở rộng phổ biến nhất.

Đó là lý do tại sao Safari tiếp tục hỗ trợ bạn trong việc tạo ra các tiện ích mở rộng sáng tạo và hiệu quả cung cấp trải nghiệm duyệt web an toàn và riêng tư cho người dùng của bạn.

Nếu bạn đang tìm cách chặn hoặc sửa đổi các yêu cầu mạng bằng tiện ích mở rộng web, bạn nên xem các bản cập nhật này cho Yêu cầu mạng khai báo.

Yêu cầu mạng khai báo là một API mạnh mẽ cung cấp một cách để tiện ích mở rộng web của bạn chặn và sửa đổi các yêu cầu mạng.

Giống như trình chặn nội dung, tiện ích mở rộng của bạn cung cấp các quy tắc ở định dạng JSON và Safari xử lý phần còn lại.

Điều này có nghĩa là nâng cao hiệu suất năng lượng, đặc biệt là trên các thiết bị chạy bằng pin.

Vì các quy tắc này là khai báo, tiện ích mở rộng của bạn không cần truy cập vào các trang web mà người dùng truy cập, tăng quyền riêng tư và bảo mật của họ.

Một bản cập nhật lớn cho Yêu cầu mạng khai báo trong Safari 16.4 là tiện ích mở rộng của bạn hiện có thể sửa đổi tiêu đề yêu cầu.

Trong ví dụ này, tôi đã xác định một hành động đặt tiêu đề User-Agent tùy chỉnh cho tất cả các yêu cầu được thực hiện cho example.com.

Ngoài việc cài đặt tiêu đề, loại hành động này có thể sửa đổi tiêu đề bằng cách thêm các giá trị mới, xóa các giá trị hiện có hoặc thậm chí xóa hoàn toàn các tiêu đề khỏi các yêu cầu HTTP.

Sửa đổi các yêu cầu mạng là một công cụ mạnh mẽ và có một số điểm chính cần ghi nhớ.

Đầu tiên, bạn phải khai báo quyền khai báo NetRequestWithHostAccess trong bản kê khai.

Trong Safari 16.4, quyền này hiện cũng được yêu cầu cho các hành động chuyển hướng.

Tiện ích mở rộng của bạn cũng phải được cấp quyền cho mỗi trang web cho bất kỳ tiêu đề sửa đổi hoặc hành động chuyển hướng nào được áp dụng.

Điều này đảm bảo rằng người dùng có quyền kiểm soát dữ liệu của họ trên cơ sở từng trang web.

Bằng cách ghi nhớ những cân nhắc này, bạn có thể tạo các tiện ích mở rộng chặn nội dung mạnh mẽ và thân thiện với quyền riêng tư cung cấp trải nghiệm phù hợp cho người dùng của mình.

Nếu bạn đang xây dựng một tiện ích mở rộng sử dụng Yêu cầu mạng khai báo, bạn có thể muốn cho người dùng của mình biết có bao nhiêu yêu cầu mà nó đã chặn.

Sử dụng API declarativeNetRequest.setExtensionActionOptions mới, bạn có thể định cấu hình văn bản huy hiệu để hiển thị số lượng hành động, chẳng hạn như số lần tải bị chặn.

Trong ví dụ này, chúng tôi đặt tùy chọn displayActionCountAsBadgeText thành true, hiện là tùy chọn duy nhất cho API này.

Huy hiệu gia hạn của bạn sẽ tự động cập nhật dựa trên các hành động đã thực hiện.

Điều này cho phép người dùng của bạn dễ dàng theo dõi hoạt động và hiệu quả của tiện ích mở rộng, tất cả trong khi vẫn giữ riêng tư lịch sử duyệt web của họ.

Bây giờ tôi sẽ đề cập đến bản cập nhật cho API kịch bản cho phép bạn kiểm soát nhiều hơn hành vi của tiện ích mở rộng của mình.

Với bộ API registerContentScript, bạn có thể tạo các tập lệnh nội dung có thể được đăng ký, cập nhật hoặc xóa theo chương trình.

Điều này có nghĩa là bạn có thể nhắm mục tiêu các trang hoặc điều kiện cụ thể để áp dụng cho các tập lệnh nội dung.

Trong ví dụ này, tôi đang đăng ký một tập lệnh để được đưa vào các trang phù hợp với webkit.org.

Việc đăng ký tập lệnh này cũng sẽ tồn tại qua các phiên.

API mới này bổ sung cho các tập lệnh nội dung tĩnh được xác định trong bản kê khai tiện ích mở rộng, giúp bạn linh hoạt hơn trong việc quản lý các tập lệnh nội dung và cho phép bạn tạo các tính năng nâng cao hơn cho các tiện ích mở rộng của mình.

Safari 16.4 cũng mang đến một khu vực lưu trữ mới cho các tiện ích mở rộng web: khu vực lưu trữ phiên.

Lưu trữ và truy xuất dữ liệu từ lưu trữ phiên sử dụng các chức năng quen thuộc giống như các khu vực lưu trữ khác.

API này cho phép bạn lưu trữ dữ liệu trong bộ nhớ trong suốt thời gian phiên trình duyệt của mình, cung cấp một cách nhanh chóng và hiệu quả để truy cập dữ liệu giữa các lần tải trang nền không liên tục.

Không giống như lưu trữ cục bộ, lưu trữ phiên không tồn tại trên đĩa và nó sẽ bị xóa khi Safari thoát.

Điều này làm cho việc lưu trữ phiên đặc biệt hữu ích để lưu trữ dữ liệu nhạy cảm hoặc liên quan đến bảo mật, chẳng hạn như khóa giải mã hoặc mã thông báo xác thực, không nên được lưu trữ trong bộ nhớ cục bộ.

Cuối cùng, chúng tôi biết rằng việc đảm bảo tiện ích mở rộng của bạn có tất cả các kích thước biểu tượng phù hợp cho các yếu tố giao diện người dùng khác nhau là một việc vặt.

Đó là lý do tại sao bắt đầu trong Safari 16.4, bây giờ bạn có thể tạo một biểu tượng SVG duy nhất trông đẹp ở bất kỳ kích thước nào.

Safari sẽ xử lý việc mở rộng biểu tượng tiện ích mở rộng của bạn một cách rõ ràng, cho phép bạn tập trung vào mọi thứ khác.

Những cập nhật API đó chỉ là một số cải tiến cho các tiện ích mở rộng Safari trong năm nay.

Bây giờ hãy nói về các tiện ích mở rộng ứng dụng Safari và quyền cho mỗi trang web.

Nếu bạn đã quen thuộc với quyền trên mỗi trang web từ các tiện ích mở rộng web, chúng hoạt động theo cùng một cách đối với các tiện ích mở rộng ứng dụng.

Người dùng có thể cấp quyền truy cập tiện ích mở rộng vào các trang web khi họ duyệt, cung cấp quyền riêng tư và kiểm soát tốt hơn.

Khi tiện ích mở rộng được bật lần đầu tiên, nó sẽ không có quyền truy cập vào bất kỳ trang web nào mà người dùng truy cập.

Lần đầu tiên tiện ích mở rộng cố gắng truy cập trang, Safari sẽ gắn huy hiệu cho mục thanh công cụ của tiện ích mở rộng cảnh báo người dùng rằng tiện ích mở rộng muốn truy cập vào trang hiện tại.

Khi người dùng nhấp vào mục thanh công cụ đó, họ sẽ được hiển thị thông tin về quyền truy cập mà tiện ích mở rộng sẽ có và được cung cấp tùy chọn Cho phép trong một ngày hoặc Luôn cho phép.

Khi được cấp quyền, mục thanh công cụ của tiện ích mở rộng sẽ được nhuộm màu để hiển thị rằng tiện ích mở rộng có quyền truy cập vào trang hiện tại.

Bất kỳ ai nâng cấp lên Safari 17 và đã bật tiện ích mở rộng ứng dụng Safari sẽ có tất cả các quyền được di chuyển cho các tiện ích mở rộng đó.

Họ cũng sẽ được hiển thị một biểu ngữ cho họ tùy chọn để tăng quyền riêng tư của họ.

Nếu Yêu cầu mỗi trang web được chọn, tất cả các quyền tiện ích mở rộng ứng dụng Safari sẽ được đặt lại và người dùng của bạn sẽ có thể cấp quyền truy cập tiện ích mở rộng của bạn cho từng trang web khi họ truy cập.

Không có API mới nào được áp dụng để hỗ trợ thay đổi này trong Safari 17; tuy nhiên, hãy dành chút thời gian để xem lại các giả định của tiện ích mở rộng của bạn và kiểm tra xem tiện ích mở rộng của bạn hoạt động như thế nào trong Safari 17.

Người dùng của bạn sẽ có toàn quyền kiểm soát các trang web mà mọi tiện ích mở rộng ứng dụng Safari có thể truy cập.

Tiện ích mở rộng của bạn sẽ tự động có quyền truy cập vào các trang web khi người dùng cấp phép.

Tuy nhiên, quyền có thể được cấp hoặc thu hồi bất cứ lúc nào.

Các mục thanh công cụ hiện được hiển thị theo mặc định cho tất cả các tiện ích mở rộng.

Hãy xem cách biểu tượng tiện ích mở rộng của bạn xuất hiện trong Safari và cung cấp biểu tượng vectơ PDF có thể được nhuộm màu một cách thích hợp.

Cuối cùng, hãy nói về các cập nhật về cách các tiện ích mở rộng hoạt động trong cả Hồ sơ và Duyệt web Riêng tư.

Trong Safari 17, người dùng sẽ có thể kiểm soát tiện ích mở rộng nào có quyền truy cập vào cửa sổ và tab Duyệt web Riêng tư của họ mà không cần tắt tiện ích mở rộng trong các ngữ cảnh duyệt web khác.

Các tiện ích mở rộng chèn tập lệnh hoặc có thể đọc thông tin về các trang mà người dùng truy cập, sẽ bị tắt theo mặc định.

Tuy nhiên, các tiện ích mở rộng không truy cập nội dung, như trình chặn nội dung, sẽ tự động được cho phép trong Duyệt web Riêng tư vì không có bất kỳ mối quan tâm bổ sung nào về quyền riêng tư.

Đây là ngăn Tiện ích mở rộng được cập nhật trong cài đặt Safari trên macOS và có các bản cập nhật tương tự trên iOS.

Có một tùy chọn mới để cho phép tiện ích mở rộng này trong Duyệt web Riêng tư.

Đối với các tiện ích mở rộng được bật, chỉ cần một cú nhấp chuột trong cài đặt Safari để cho phép tiện ích mở rộng đó truy cập vào Duyệt web Riêng tư.

Hồ sơ là mới trong Safari năm nay.

Chúng là một cách để tách biệt dữ liệu duyệt web.

Hồ sơ chứa lịch sử, cookie và dữ liệu trang web riêng biệt.

Người dùng cũng có thể chọn tiện ích mở rộng nào họ muốn bật cho mỗi hồ sơ.

Điều này bao gồm các tiện ích mở rộng trang tab mới.

Và tất nhiên, tất cả các cài đặt này đồng bộ hóa trên tất cả iPhone, iPad và Mac của người dùng thông qua iCloud.

Ngăn Tiện ích mở rộng trong cài đặt Safari cũng đã được cập nhật để liệt kê các cấu hình nơi tiện ích mở rộng đang hoạt động.

Tại đây bạn có thể thấy rằng tiện ích mở rộng Sea Creator đang hoạt động trong cả hồ sơ Cơ quan và Trường học.

Khi một tiện ích mở rộng được bật trong một hồ sơ, nó là một ví dụ hoàn toàn mới của tiện ích mở rộng đó.

Điều này có nghĩa là mỗi trường hợp sẽ có một UUID, trang nền và bộ nhớ khác nhau.

Tuy nhiên, quyền trên mỗi trang web được chia sẻ trên các hồ sơ.

Điều đó có nghĩa là người dùng của bạn chỉ cần cấp quyền truy cập tiện ích mở rộng của bạn một lần.

Khi chạy trong hồ sơ, tiện ích mở rộng chỉ có quyền truy cập vào các cửa sổ, tab và các dữ liệu khác liên quan đến hồ sơ đó.

Nếu tiện ích mở rộng của bạn giao tiếp với ứng dụng máy chủ gốc, hãy đảm bảo rằng ứng dụng của bạn mong đợi nhận được tin nhắn từ nhiều hồ sơ và tôn trọng việc tách dữ liệu giữa các hồ sơ đó.

Khi ứng dụng của bạn nhận được cuộc gọi để bắt đầu Yêu cầu (với ngữ cảnh:), hãy giải mã từ điển userInfo.

Nếu tiện ích mở rộng của bạn đang hoạt động trong hồ sơ, sẽ có giá trị profileIdentifier cho khóa SFExtensionProfileKey.

Vì các tiện ích mở rộng có các trường hợp duy nhất trên mỗi hồ sơ, nên có thể kiểm tra nội dung nền của chúng một cách riêng biệt.

Từ menu Phát triển trong Safari 17, bạn có thể đi sâu vào mục menu Nội dung nền mở rộng web và xem các trang nền và nhân viên dịch vụ được nhóm theo tiện ích mở rộng.

Mỗi tiện ích mở rộng sẽ liệt kê nội dung có thể kiểm tra của nó trên mỗi hồ sơ.

Để tìm hiểu thêm về những cải tiến đối với các tính năng của nhà phát triển Safari trong năm nay, hãy xem "Có gì mới trong Trình kiểm tra web" và "Khám phá lại các tính năng của nhà phát triển Safari".

Tóm lại, Safari cam kết tiêu chuẩn hóa các tiện ích mở rộng web và cung cấp cho bạn các API mới để tạo ra các tiện ích mở rộng sáng tạo và hiệu quả.

Chúng tôi rất muốn bạn tham gia vào cuộc thảo luận và giúp định hình tương lai của các tiện ích mở rộng web bằng cách tham gia WECG.

Với quyền trên mỗi trang web cho các tiện ích mở rộng ứng dụng và hỗ trợ cho các tính năng mới như bộ chọn :has(), bạn có thể tạo các tiện ích mở rộng cung cấp trải nghiệm duyệt web an toàn và riêng tư cho người dùng của mình.

Đừng quên cập nhật các tiện ích mở rộng của bạn để tận dụng các khả năng mới này và đảm bảo chúng hoạt động tốt với cả Hồ sơ và Duyệt web Riêng tư.

Và cuối cùng, cung cấp phản hồi thông qua Trợ lý phản hồi khi bạn kiểm tra các tiện ích mở rộng của mình trong Safari 17.

Cảm ơn bạn đã lắng nghe, và chúc bạn có một phần còn lại tuyệt vời của WWDC.

♪