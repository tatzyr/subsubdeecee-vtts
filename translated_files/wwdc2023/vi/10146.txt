10146

♪ Hip-hop nhạc cụ êm dịu ♪

♪

Xin chào!

Tôi là Ilya Veygman, một kỹ sư của Core Location.

Tôi ở đây hôm nay để nói chuyện với bạn về Vị trí cốt lõi cho điện toán không gian.

Cho dù bạn là người hoàn toàn mới đối với hệ sinh thái của Apple hay một nhà phát triển App Store lâu năm, bạn có thể có rất nhiều câu hỏi về những thứ mà hệ thống này có thể làm.

xrOS rất tuyệt vời trong việc cho bạn thấy thành quả của trí tưởng tượng của bạn, trong khi Core Location ở đó để giúp bạn có một mỏ neo trong thế giới thực.

Hôm nay, tôi ở đây để nói với bạn tất cả về cách thực hiện điều đó với Core Location.

Đối với những người bạn hoàn toàn mới đối với hệ sinh thái nhà phát triển Apple, chào mừng!

Tôi muốn bắt đầu với một ví dụ đơn giản để cho bạn thấy việc thêm vị trí vào ứng dụng của bạn thực sự đơn giản như thế nào.

Đối với các nhà phát triển có kinh nghiệm, không bao giờ đau lòng khi xem lại những điều cơ bản của một người.

Vì vậy, hãy bắt đầu bằng cách xem xét một số mã mẫu cho ứng dụng demo này được liên kết với phiên của đồng nghiệp của tôi, "Khám phá các bản cập nhật vị trí được sắp xếp hợp lý."

Trong diễn viên này, chúng tôi yêu cầu cập nhật trực tiếp từ CLLocationUpdate và chúng tôi sẽ tải chúng không đồng bộ ở đây khi chúng có sẵn.

Để biết thêm chi tiết về API cập nhật vị trí, vui lòng tham khảo phiên được liên kết với bản demo này.

Các ứng dụng phải yêu cầu sự cho phép của người dùng trước khi truy cập thông tin nhạy cảm như vị trí, vì vậy ở đây, chúng tôi gọi API này để làm như vậy.

Trong ví dụ đơn giản này, chúng tôi làm điều đó khi chế độ xem.

Chúng tôi cũng phải đảm bảo rằng chúng tôi đặt chuỗi này trong thông tin của ứng dụng trong Cài đặt Xây dựng.

Một lần nữa, các ứng dụng phải xin phép người dùng trước khi họ có thể nhận được thông tin nhạy cảm như vị trí và chuỗi này ở đó để giải thích cho người dùng tại sao.

Sau đó nó sẽ được hiển thị trong một lời nhắc được hiển thị cho người dùng yêu cầu quyền truy cập này.

Vì vậy, hãy xem cái này trông như thế nào khi chúng ta chạy nó trong trình giả lập.

Một lần nữa, trong ứng dụng này, chúng tôi yêu cầu truy cập vị trí ngay lập tức vì đó là một ví dụ đơn giản.

Điều này sẽ không phải lúc nào cũng xảy ra với các ứng dụng của bạn.

Bạn có thể thấy rằng chúng tôi nhận được lời nhắc hỏi người dùng liệu họ có cấp quyền truy cập vào thông tin cá nhân của họ hay không.

Bây giờ trước khi tiếp tục, hãy trò chuyện thêm một chút về cách Core Location xử lý quyền riêng tư của người dùng trên hệ thống này.

Ngay cả khi bạn chưa quen với hệ sinh thái nhà phát triển của chúng tôi, bạn có thể đã biết rằng Apple tập trung nhiều vào quyền riêng tư trong trải nghiệm người dùng của mình.

Truy cập vị trí không phải là ngoại lệ đối với câu châm ngôn này.

Trước khi bạn có thể nhận được thông tin cập nhật về vị trí địa lý, trước tiên bạn phải yêu cầu người dùng cho phép truy cập thông tin vị trí của họ.

Bạn sẽ không nhận được cập nhật vị trí mà không có sự đồng ý của người dùng.

Bạn có thể yêu cầu sự đồng ý trên hệ thống này bằng cách tạo trình quản lý vị trí và gọi requestWhenInUseAuthorization, cùng với việc đặt chuỗi mô tả sử dụng trong Info.plist của ứng dụng của bạn.

Điều này, một lần nữa, cho người dùng biết lý do tại sao ứng dụng của bạn cần biết vị trí của họ.

Cuối cùng, bạn chỉ nên yêu cầu quyền truy cập này trong ngữ cảnh khi ứng dụng của bạn thực sự cần nó.

Điều này không chỉ tốt hơn từ góc độ riêng tư, nó còn đảm bảo người dùng có nhiều khả năng cho phép truy cập hơn.

Nhớ lại rằng chúng tôi đã làm điều này trong mã mẫu của mình vì nó là một ví dụ rất đơn giản và bắt đầu yêu cầu cập nhật vị trí ngay lập tức.

Vậy lời nhắc này trông như thế nào và nó hiển thị điều gì?

Người dùng sẽ thấy lời nhắc từ ứng dụng của bạn tương tự như ở đây.

Điều này có thể trông quen thuộc với những người bạn đang xem, những người đã có kinh nghiệm phát triển iOS.

Người dùng có thể cấp quyền truy cập vị trí chỉ cho phiên này, trong khi sử dụng ứng dụng hoặc từ chối hoàn toàn.

Người dùng cũng có thể chọn cấp cho ứng dụng của bạn kiến thức về vị trí chính xác hoặc gần đúng của họ bằng cách sử dụng nút được đánh dấu, giống như trên iOS.

Để biết thêm thông tin về cách thức hoạt động chính xác so với vị trí gần đúng này, vui lòng tham khảo "Có gì mới trong vị trí" từ WWDC20, được tổ chức bởi một phiên bản trẻ hơn của bản thân tôi.

Vì vậy, quay lại bản demo.

Sau khi chúng tôi cấp cho ứng dụng này quyền truy cập vào vị trí chính xác và cho phép nó trong khi sử dụng, bây giờ chúng tôi có thể bắt đầu nhận cập nhật vị trí và xem ứng dụng của chúng tôi nhận được cập nhật vị trí.

Vậy chính xác thì ý tôi là gì khi nói "vị trí chính xác"?

Đó là, tai nghe có thể biết chính xác vị trí của người dùng như thế nào?

Đối với một đơn vị, bạn nên mong đợi độ chính xác tương tự như của máy Mac, vì vậy đó là khoảng 100 mét.

Điều này sẽ đủ cho các ứng dụng như những ứng dụng được sử dụng để tìm nhà hàng, công viên gần đó và các điểm tham quan khác.

Tuy nhiên, nếu iPhone của bạn ở gần đó, thiết bị này có thể tận dụng các kết nối hiện có giữa hai thiết bị này để cải thiện độ chính xác vị trí mà bạn sẽ nhận được từ tai nghe để ở cùng cấp độ với iPhone.

Thiết bị của bạn thậm chí còn hoạt động tốt hơn khi kết hợp với phần cứng Apple khác của chúng tôi.

Điều này mở ra một loạt các ứng dụng hoàn toàn mới có thể chạy trên hệ thống điện toán không gian như hệ thống này, chẳng hạn như cập nhật thời tiết chính xác, gắn thẻ địa lý và hơn thế nữa.

Bây giờ đối với cả người mới đến và nhà phát triển có kinh nghiệm, bạn cũng đã nghe tôi nói rằng một ứng dụng đủ điều kiện để nhận cập nhật vị trí trong khi người dùng đang sử dụng nó.

Điều này có nghĩa là khá đơn giản trên iPhone hoặc đồng hồ, nhưng nó có ý nghĩa gì đối với chúng ta?

Xét cho cùng, trải nghiệm người dùng rất khác so với iPhone hoặc đồng hồ.

Vì vậy, hãy nói về điều đó.

Hãy để chúng tôi gọi lại "Có gì mới ở vị trí cốt lõi" từ năm 2019, nơi chúng tôi đã thảo luận về cách thức và thời điểm các ứng dụng tiền cảnh được coi là đang được sử dụng trên iOS.

Đối với một nền tảng như iPhone, điều này khá rõ ràng.

Chỉ có thể thực sự có một ứng dụng được đặt trước tại bất kỳ thời điểm nào.

Ngoài ra còn có một khoảng thời gian gia hạn ngắn sau khi ứng dụng được nền trong khi nó vẫn có thể nhận được các bản cập nhật vị trí.

Vậy còn ở đây thì sao?

Ứng dụng của bạn trên nền tảng này có thể hoàn toàn nhập vai hoặc bạn có thể có các ứng dụng chạy trong một cái gì đó giống như một cửa sổ.

"Vị trí cốt lõi xử lý điều này như thế nào?

Có lẽ bạn đang thắc mắc.

Để có trải nghiệm hoàn toàn nhập vai, điều này thật đơn giản.

Miễn là người dùng đang chạy ứng dụng của bạn, chúng tôi coi nó đang được sử dụng và đủ điều kiện để nhận cập nhật vị trí, giả sử rằng người dùng đã đồng ý cho ứng dụng của bạn để có được vị trí của họ.

Trên hệ thống này, Core Location cung cấp thông tin vị trí cho ứng dụng của bạn, miễn là người dùng gần đây đã xem ứng dụng.

Nói một cách dí dỏm, trên nền tảng này, chúng tôi xem xét các ứng dụng đang chạy trong một cửa sổ đủ điều kiện để nhận các bản cập nhật vị trí nếu người dùng đồng ý cung cấp vị trí của họ cho họ và nếu người dùng gần đây đã xem ứng dụng.

Hãy xem xét điều này một cách cụ thể hơn.

Hãy tưởng tượng rằng cả hai ứng dụng này đã được phép truy cập vào vị trí của người dùng trong khi sử dụng.

Miễn là người dùng không tương tác hoặc xem một trong hai ứng dụng, sẽ không ai có thể nhận được cập nhật vị trí.

Nếu người dùng bắt đầu xem - nghĩa là tương tác với - ứng dụng bên trái, ứng dụng đó hiện có thể nhận được cập nhật vị trí, trong khi ứng dụng bên phải vẫn không thể, ngay cả khi nó nằm trong tầm nhìn ngoại vi của người dùng.

Và điều này sẽ vẫn đúng cho đến khi người dùng tìm một nơi khác, chẳng hạn như ở ứng dụng bên phải hoặc di chuyển hai ứng dụng lại với nhau để họ có thể xem cả hai ứng dụng cùng một lúc.

Cũng giống như trong iOS, cũng có một khoảng thời gian ân hạn trước khi Core Location xem xét ứng dụng không còn được sử dụng nữa.

Điều này có nghĩa là nếu người dùng nhìn vào một ứng dụng ở bên trái, thì vào ứng dụng bên phải trước khi nhìn vào một nơi khác, sẽ có một khoảng thời gian ngắn - một vài giây - khi cả hai ứng dụng vẫn đủ điều kiện để có được vị trí trước khi Core Location coi các ứng dụng này là không sử dụng.

Chúng tôi cảm thấy rằng một mô hình truy cập vị trí như vậy cung cấp trải nghiệm tốt trên nền tảng này trong khi vẫn tôn trọng quyền riêng tư của người dùng, vì người dùng sẽ không theo dõi vị trí của họ nếu không có sự cho phép hoặc kiến thức của họ, đặc biệt là vì thiết bị này được dự định sử dụng tương tác, thay vì như một thứ gì đó

Như vậy, các ứng dụng sẽ không thể cập nhật vị trí trong khi chúng không chạy.

Tương tự, các bản cập nhật từ API giám sát của chúng tôi sẽ không được phân phối.

Vì vậy, điều này đưa tôi đến một thứ khác mà nhiều nhà phát triển đã có ứng dụng sử dụng vị trí cho nền tảng Apple có thể đang tự hỏi: Ứng dụng của tôi sẽ hoạt động như thế nào khi chạy ở chế độ tương thích?

Vậy điều gì sẽ xảy ra nếu tôi chỉ chạy ứng dụng iPhone hoặc iPad của mình mà không có thay đổi mã cho một thiết bị chạy xrOS?

Hãy nói về điều đó một chút.

Như đã thảo luận, "tính hữu ích" của "trong khi đang sử dụng" bắt nguồn từ nơi người dùng đã xem gần đây.

Và các ứng dụng chỉ đủ điều kiện để có được vị trí khi người dùng đang xem chúng.

Vậy còn các ứng dụng yêu cầu Luôn ủy quyền thì sao?

Các ứng dụng nhắc nhở cho Luôn luôn sẽ có yêu cầu của họ được chuyển hướng đến yêu cầu ủy quyền trong khi sử dụng.

Tương tự, bạn sẽ thấy rằng Luôn luôn không phải là một tùy chọn cho ứng dụng của bạn trong Cài đặt.

Vị trí trên hệ thống này hoạt động tốt nhất để cập nhật một lần hoặc liên tục trong khi ứng dụng của bạn đang được sử dụng.

Nếu ứng dụng iPhone hoặc iPad tương thích của bạn sử dụng giám sát khu vực hoặc CLMonitor mới của chúng tôi, nó sẽ không được phân phối các sự kiện.

Cân nhắc xem ứng dụng iOS của bạn có được thiết kế theo cách giả định rằng một API cụ thể luôn được hỗ trợ và có thể hoạt động theo những cách bất ngờ nếu, ví dụ, API giám sát không bao giờ cung cấp các sự kiện.

Tương tự, hãy xem xét liệu ứng dụng của bạn có dựa vào việc cập nhật vị trí trong nền trong khi nó không chạy hay không.

Để tìm hiểu thêm về API của chúng tôi nói chung, đặc biệt là những gì mới trong năm nay, tôi khuyên bạn nên xem hai phiên khác này từ các đồng nghiệp của tôi, cũng như bất kỳ phiên nào khác của chúng tôi từ những năm trước, đặc biệt nếu bạn là người mới tham gia hệ sinh thái của chúng tôi.

"Khám phá các bản cập nhật vị trí được sắp xếp hợp lý" thảo luận về một số phát triển mới trong API của chúng tôi, đặc biệt là xung quanh cách chúng tôi khuyên bạn nên nhận các bản cập nhật vị trí và cách chúng tôi đã làm cho API của mình tương thích hơn với Swift đồng thời.

"Gặp gỡ Giám sát Vị trí Cốt lõi" thảo luận thêm về những phát triển mới trong việc giám sát API và cách chúng tôi đã mô phỏng lại cách một ứng dụng có thể nhận thông báo về các sự kiện như lối vào và lối ra địa lý.

Nếu vị trí là điều bạn quan tâm đến ứng dụng của mình, tôi chắc chắn rằng bạn sẽ thấy đây là thời gian được sử dụng tốt.

xrOS cung cấp một trải nghiệm thực sự thú vị mà tôi chắc chắn rằng nhiều người trong số các bạn đã mong đợi trong một thời gian khá dài.

Chúng tôi cũng vậy, và chúng tôi đã làm việc chăm chỉ để đảm bảo rằng bạn có thể cung cấp trải nghiệm người dùng tốt nhất có thể cho cả các ứng dụng được thiết kế dành riêng cho thiết bị này và cho các ứng dụng iPhone hoặc iPad tương thích đó.

Chúng tôi cũng muốn đảm bảo rằng quyền riêng tư của người dùng được tôn trọng theo những cách tốt nhất có thể và quá trình chuyển đổi sang nền tảng này diễn ra liền mạch nhất có thể đối với những bạn có ứng dụng hiện có trong cửa hàng của chúng tôi.

Bây giờ đã nói, hãy xem xét các ứng dụng tương thích của bạn có thể hoạt động như thế nào trong trường hợp khi chúng không nhận được thông báo về các sự kiện như thay đổi khu vực hoặc lượt truy cập.

Tôi chắc chắn khuyến khích bạn xem bất kỳ phiên nào khác, cả cụ thể cho Vị trí cốt lõi và tính toán không gian nói chung, điều này có thể thu hút sở thích của bạn.

Cảm ơn bạn và tận hưởng phần còn lại của WWDC.

♪