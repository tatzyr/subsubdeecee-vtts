10179

♪ ♪

Erin: Xin chào! Tên tôi là Erin, và tôi là một Kỹ sư trong nhóm CoreMotion.

Tôi rất vui được kể cho bạn nghe về một số cập nhật thú vị cho CoreMotion.

CoreMotion đóng vai trò là khuôn khổ trung tâm để truy cập dữ liệu chuyển động từ các cảm biến quán tính.

Khi phần cứng của chúng tôi đã tiến bộ, khả năng nắm bắt thông tin chuyển động của chúng tôi cũng vậy.

Phát hiện va chạm, phát hiện té ngã và âm thanh không gian chỉ là một số tính năng dựa trên khả năng cảm biến được cải thiện.

Với CoreMotion, bạn cũng có thể tận dụng những cải tiến này trong các ứng dụng của riêng mình.

Trong phần này, tôi sẽ tập trung vào một số cách mới hơn mà bạn có thể tương tác với dữ liệu chuyển động, nhưng trước khi tôi tìm hiểu những gì mới, tôi muốn nhắc nhở bạn nhanh về các cảm biến tạo ra dữ liệu chuyển động.

Nắm bắt cách một thiết bị di chuyển là trọng tâm của cách chúng ta trải nghiệm chúng.

Nhiều thiết bị của Apple sử dụng cảm biến tích hợp để giúp tạo ra khái niệm về chuyển động của chúng trong không gian.

Lấy Apple Watch làm ví dụ.

Các cảm biến tích hợp của nó bao gồm gia tốc kế, đo gia tốc, con quay hồi chuyển, đo vòng quay, từ kế, đo từ trường và phong vũ biểu, đo áp suất.

Cùng nhau, chúng giúp theo dõi cách thiết bị di chuyển và định hướng trong không gian.

Tạo ra ý tưởng về chuyển động của thiết bị là nền tảng cho nhiều tính năng mà chúng tôi thích.

Chúng bao gồm những thứ như theo dõi số bước bạn đã thực hiện ngày hôm đó và lượng calo bạn đã đốt cháy trong quá trình tập luyện.

Nó hỗ trợ các trải nghiệm dựa trên hướng của thiết bị, như với ứng dụng ngắm sao để khám phá các vì sao trên bầu trời của chúng ta.

Các tính năng giúp chúng ta an toàn bằng cách phát hiện khi bạn gặp tai nạn xe hơi hoặc khi bạn bị ngã, cũng dựa vào việc theo dõi chuyển động bằng cách sử dụng các cảm biến tương tự.

Đây chỉ là một số trong nhiều ứng dụng có thể thực hiện được và chúng tôi luôn mong muốn được xem cách bạn tận dụng CoreMotion.

Bây giờ tôi đã cung cấp cho bạn một cái nhìn tổng quan ngắn gọn về một số cảm biến có liên quan, tôi sẽ xem xét việc lấy dữ liệu chuyển động từ các sản phẩm âm thanh như AirPods, cập nhật dữ liệu ngâm nước và cuối cùng là một cách mới để truyền dữ liệu cảm biến tốc độ cao hơn.

Hãy bắt đầu với chuyển động của tai nghe.

Cách đây không lâu, âm thanh không gian với tính năng theo dõi đầu động đã thay đổi cách chúng ta trải nghiệm âm nhạc và phim ảnh.

Theo dõi đầu động dựa trên cùng một thuật toán chuyển động của thiết bị tồn tại trên iPhone và Apple Watch.

Khi CMHeadphoneMotionManager được giới thiệu cách đây vài năm, cùng một dữ liệu giúp bạn có thể theo dõi đầu động.

Bằng cách phát trực tuyến thái độ, tăng tốc của người dùng và dữ liệu tốc độ quay sang thiết bị iOS hoặc iPadOS được kết nối, bạn có thể theo dõi cách đầu mình di chuyển.

Theo dõi đầu đã mở khóa rất nhiều tính năng thú vị, từ chơi game đến các ứng dụng thể dục.

Và bây giờ, năm nay, CMHeadphoneMotionManager đang đến với macOS.

Hãy xem qua một số chi tiết.

CMHeadphoneMotionManager lần đầu tiên được cung cấp trong iOS và iPadOS 14.

Và bắt đầu từ năm nay, nó cũng sẽ đến với macOS 14.

Bạn có thể sử dụng CMHeadphoneMotionManager để truyền chuyển động của thiết bị từ các sản phẩm âm thanh hỗ trợ âm thanh không gian với tính năng theo dõi đầu động, như AirPods Pro, đến thiết bị iOS, iPadOS hoặc macOS được kết nối.

Kiểm tra CMDeviceMotion để biết thái độ, khả năng tăng tốc của người dùng và dữ liệu tốc độ quay trong quá trình phát trực tuyến từ các thiết bị được hỗ trợ, giống như bạn làm trên iPhone và Apple Watch.

Lưu ý thông tin bổ sung cụ thể cho CMHeadphoneMotionManager, như SensorLocation, giúp xác định nguồn dữ liệu ở đâu, cho dù đó là từ chồi trái hay bên phải.

Bởi vì dữ liệu được truyền từ một thiết bị từ xa, điều quan trọng là phải hiểu khi nào nó được kết nối.

CMHeadphoneMotionManagerDelegate giúp bạn dễ dàng nghe các bản cập nhật trạng thái kết nối.

Để tôi chỉ cho bạn cách sử dụng nó.

Áp dụng giao thức CMHeadphoneMotionManagerDelegate để phản hồi các bản cập nhật trạng thái kết nối.

Dữ liệu có sẵn khi thiết bị âm thanh được kết nối với thiết bị phát trực tuyến được hỗ trợ, như iPhone, iPad hoặc Mac.

Nếu tính năng Phát hiện tai tự động được bật, bạn cũng sẽ nhận được các sự kiện ảnh hưởng đến việc theo dõi đầu.

Bạn sẽ nhận được một sự kiện ngắt kết nối khi các chồi được lấy ra khỏi tai và một sự kiện kết nối khi chúng được đưa trở lại.

Tương tự, nếu tính năng phát hiện đầu tự động được bật, việc đeo và tháo tai nghe qua tai sẽ kích hoạt những sự kiện này.

Thiết lập CMHeadphoneMotionManager để lắng nghe những sự kiện này và truyền dữ liệu thật dễ dàng. Để tôi chỉ cho bạn cách làm.

Trước khi bắt đầu phát trực tuyến, bạn sẽ muốn đảm bảo rằng dữ liệu chuyển động của thiết bị có sẵn, có thể được kiểm tra bằng thuộc tính isDeviceMotionAvailable.

Chỉ định một đại biểu để nhận các sự kiện kết nối mà tôi đã nói trước đó.

Sau đó, bắt đầu phát trực tuyến dữ liệu.

CMHeadphoneMotionManager hiển thị cả giao diện đẩy và kéo để lấy dữ liệu.

Trong ví dụ này, chúng ta sẽ sử dụng giao diện đẩy.

Sử dụng startDeviceMotionUpdates và chỉ định một hàng đợi và trình xử lý hoạt động.

Bởi vì bạn đang truy cập dữ liệu chuyển động, ủy quyền rất quan trọng.

Người dùng ứng dụng của bạn được nhắc ủy quyền cho ứng dụng của bạn cho dữ liệu chuyển động bằng cách sử dụng phím Mô tả Sử dụng Chuyển động mà bạn thêm vào Info.plist của mình.

Bạn có thể kiểm tra thuộc tính authorizationStatus để xác nhận xem bạn đã được ủy quyền cho dữ liệu chuyển động hay chưa và cung cấp trải nghiệm liền mạch bất kể mức độ cho phép.

Khi bạn được ủy quyền và dữ liệu bắt đầu phát trực tuyến, việc theo dõi tư thế đầu rất dễ dàng bằng cách sử dụng thông tin thái độ được cung cấp với mỗi bản cập nhật chuyển động của thiết bị.

Ví dụ, chúng ta có thể theo dõi thái độ tham chiếu khi bắt đầu Đặt và sử dụng phương pháp nhân để thuận tiện có được sự thay đổi tương đối của mẫu hiện tại đối với tư thế ban đầu đó.

Cùng với thái độ, gia tốc của người dùng và dữ liệu tốc độ quay, mỗi bản cập nhật chuyển động của thiết bị chứa thông tin vị trí cảm biến.

Điều này rất quan trọng vì dữ liệu chuyển động được gửi đến bạn từ một chồi tại một thời điểm.

Danh sách SensorLocation được phân phối cùng với mỗi mẫu cho phép bạn xác định chồi nào có nguồn gốc từ dữ liệu.

Chồi phát trực tuyến dữ liệu có thể bị ảnh hưởng bởi một số thứ, bao gồm cả trạng thái trong tai nếu tính năng Phát hiện tai tự động được bật.

Ví dụ, nếu dữ liệu đang phát trực tuyến từ chồi phải của tôi nhưng tôi lấy nó ra khỏi tai khi bật tính năng Phát hiện tai tự động, thì chồi trái của tôi sẽ tiếp quản luồng dữ liệu.

Điều này cho phép trải nghiệm theo dõi đầu liền mạch hơn.

Theo dõi đầu thuận tiện đã mở ra cánh cửa cho rất nhiều trải nghiệm khác nhau.

Những thứ như đếm số lần chống đẩy bạn đã làm hoặc theo dõi tư thế đã trở nên dễ dàng hơn bao giờ hết.

Và bây giờ, với sự hỗ trợ của macOS, bạn có thể truyền dữ liệu chuyển động từ các sản phẩm âm thanh hỗ trợ theo dõi đầu đến phạm vi thiết bị thậm chí còn rộng hơn.

Chúng tôi rất vui khi thấy những gì bạn xây dựng bằng cách sử dụng CMHeadphoneMotionManager.

Bây giờ, bạn không cần phải đo áp lực để theo dõi cách đầu bạn di chuyển, nhưng một cái gì đó khác thì có.

Tôi sẽ nói về những cách bạn có thể tương tác với các hoạt động dựa trên nước bằng cách sử dụng một số cập nhật thú vị cho CMWaterSubmersionManager.

Trong các hoạt động dưới nước như lặn với ống thở hoặc bơi lội, có rất nhiều điều thú vị cần biết về nước và trạng thái ngâm nước của bạn.

Bạn có thể quan tâm đến độ sâu của bạn và nhiệt độ nước là bao nhiêu.

Nó cũng hữu ích để biết khi nào bạn bị ngập nước hoặc nếu bạn đã thoát nước trở lại bờ hoặc một chiếc thuyền, và áp suất không khí bề mặt trong quá trình hoạt động của bạn là bao nhiêu.

Sử dụng phong vũ biểu tích hợp, CMWaterSubmersionManager có thể theo dõi các chỉ số này cho bạn trong các hoạt động dựa trên nước của bạn.

Để tôi cung cấp cho bạn một số chi tiết.

CMWaterSubmersionManager có sẵn trên Apple Watch Ultra chạy watchOS 9.

Sử dụng CMWaterSubmersionManagerDelegate để lắng nghe dữ liệu về độ sâu, nhiệt độ và trạng thái chìm.

Đảm bảo thêm khả năng Độ sâu và Áp lực Nông vào ứng dụng của bạn và có được trải nghiệm liền mạch khi người dùng ứng dụng của bạn bắt đầu các hoạt động trên nước của họ bằng cách định cấu hình cài đặt Tự động Khởi chạy.

Hãy để tôi chỉ cho bạn cách bắt đầu sử dụng CMWaterSubmersionManager.

Để bắt đầu theo dõi trạng thái ngập nước, hãy thiết lập CMWaterSubmersionManager sau khi kiểm tra tính khả dụng.

Sau đó, chỉ định một đại biểu để bắt đầu nhận thông tin cập nhật về trạng thái chìm và các sự kiện.

Hãy nói một chút về cách nhận những cập nhật đó.

Nhận cập nhật rất đơn giản bằng cách sử dụng CMWaterSubmersionManagerDelegate.

Có một số loại cập nhật khác nhau mà bạn có thể nhận được.

Các cập nhật cho trạng thái chìm, như khi bạn vào và ra khỏi nước, được phân phối bằng phương pháp didUpdate với CMWaterSubmersionEvent.

Bạn sẽ nhận được lỗi cập nhật xảy ra khi có sự cố, chẳng hạn như nếu bạn cố gắng nhận bản cập nhật khi ứng dụng của bạn thiếu quyền hoặc đang ở trên nền tảng không được hỗ trợ.

Cập nhật nhiệt độ nước được cung cấp bằng CMWaterTemperature.

Chúng đi kèm với một khái niệm về sự không chắc chắn, vì phải mất vài giây để nhiệt độ đồng hồ cân bằng với nước.

Vì vậy, khi bạn lần đầu tiên bị nhấn chìm, sự không chắc chắn sẽ cao hơn và sau đó bắt đầu hội tụ khi bạn đã dành nhiều thời gian hơn trong nước.

Lưu ý rằng nhiệt độ nước chỉ có sẵn khi ngập nước.

Bạn sẽ nhận được các cập nhật về độ sâu, áp suất, áp suất bề mặt và trạng thái chìm với CMWaterSubmersionMeasurement.

Trong quá trình hoạt động chìm của bạn, các phép đo được chuyển đến ứng dụng của bạn đều đặn.

Lưu ý rằng một số dữ liệu này, như độ sâu, chỉ áp dụng khi bạn ở trạng thái chìm, vì vậy đây là tùy chọn.

Độ sâu dưới nước tương ứng với các trạng thái độ sâu nhất định.

Hãy để tôi chỉ cho bạn cách chúng được lập bản đồ.

Hãy bắt đầu với trạng thái ra khỏi nước, khi bạn ở trạng thái không chìm.

Trên 1 mét dưới nước, bạn đang ở trạng thái Shallow chìm.

Vượt quá 1 mét, bạn đang ở trạng thái chìm sâu.

Với khả năng Độ sâu và Áp suất Nông, thật dễ dàng để đảm bảo người dùng ứng dụng của bạn ở trong vùng sâu để giảm thiểu nguy cơ bệnh giải nén.

Nó giữ độ sâu tối đa ở mức 6 mét và cho bạn biết khi nào bạn ở gần độ sâu đó.

Bạn có thể sử dụng thuộc tính độ sâu tối đa để kiểm tra độ sâu đang được theo dõi.

Khi bạn đến gần 6 mét, bạn sẽ bước vào trạng thái MaxDepth đang đến gần.

Vượt quá 6 mét, bạn đang ở trạng thái MaximumDepth trong quá khứ.

Dữ liệu được treo xuống 6 mét, cộng với một số điều không chắc chắn ở trạng thái MaxDepth trong quá khứ.

Ngoài ra, bạn đang ở trạng thái sensorDepthError.

Bằng cách chia độ sâu thành các vùng, CMWaterSubmersionManager giúp dễ dàng theo dõi những thay đổi về độ sâu với trọng tâm là giới hạn an toàn và cảm biến.

Nếu bạn quan tâm đến các trường hợp sử dụng vượt quá độ sâu tối đa 6 mét, bạn có thể xem tài liệu để biết thêm thông tin về quyền được quản lý.

Cho dù bạn chọn cách nào, việc tạo ra những trải nghiệm tuyệt vời cho các môn thể thao dưới nước dễ dàng hơn bao giờ hết với CMWaterSubmersionManager.

Tuy nhiên, cũng có rất nhiều môn thể thao ngoài nước và tôi rất vui được chia sẻ cách sử dụng dữ liệu chuyển động tốc độ cao trong các hoạt động này bằng cách sử dụng CMBatchedSensorManager.

Trước tiên hãy bắt đầu với một số thông tin cơ bản.

Tôi đã nói qua một số cách dữ liệu chuyển động được gửi đến bạn.

Các thuật toán chuyển động của thiết bị kết hợp dữ liệu từ gia tốc kế và con quay hồi chuyển tích hợp để cung cấp một cách dễ dàng để theo dõi cách một thiết bị, như Apple Watch, đang di chuyển trong không gian.

Bạn có thể quen thuộc với CMMotionManager, công ty cung cấp các mẫu này trên cơ sở mỗi mẫu cho ứng dụng của bạn trong thời gian thực.

Tần số được hỗ trợ tối đa là 100 Hz.

Điều này có nghĩa là nó là một lựa chọn tuyệt vời nếu bạn có yêu cầu độ trễ thấp, chẳng hạn như các thành phần giao diện người dùng dựa trên thái độ tức thời của thiết bị.

Bây giờ, điều này so sánh như thế nào với cách chúng tôi cung cấp dữ liệu tốc độ cao bằng cách sử dụng CMBatchedSensorManager mới?

CMBatchedSensorManager cung cấp các lô dữ liệu cảm biến theo một lịch trình cố định, cung cấp một lô dữ liệu mỗi giây.

Điều này có nghĩa là chúng tôi có thể cung cấp dữ liệu tốc độ cao hơn với chi phí thấp hơn cho ứng dụng của bạn.

Đó là gia tốc kế 800 Hz và chuyển động thiết bị 200 Hz, so với 100 Hz với CMMotionManager hiện có.

Giờ đây, bạn có thể truy cập một số luồng dữ liệu tương tự cung cấp năng lượng cho các tính năng giúp chúng tôi an toàn, như phát hiện va chạm và va chạm.

Bởi vì dữ liệu được phân lô, có một số điều cần xem xét khi nghĩ về việc sử dụng CMBatchedSensorManager.

Nếu ứng dụng của bạn có các tính năng tập trung vào tập luyện có thể hưởng lợi từ dữ liệu tốc độ cao, nhưng không có yêu cầu độ trễ rất chặt chẽ, thì CMBatchedSensorManager rất phù hợp.

Tôi đã xem qua cách dữ liệu cảm biến tốc độ cao hơn được phân phối cho bạn và cách nó so sánh với những gì được cung cấp bởi một số giao diện hiện có của chúng tôi.

Hãy để tôi chỉ cho bạn một số cách nó có thể được sử dụng.

Nhiều môn thể thao tập trung vào các sự kiện dựa trên tác động trong thời gian ngắn.

Điều này bao gồm các hoạt động như chơi gôn, quần vợt và bóng chày, chỉ nêu một vài ví dụ.

Trong những điều này, việc nắm bắt nhiều thông tin hơn trong chuyển động xoay vòng đó có thể rất quan trọng để đánh giá hình thức và cải thiện trò chơi của bạn.

Đây là nơi thu thập dữ liệu cảm biến tốc độ cao hơn phát huy tác dụng.

Chúng tôi sẽ được hưởng lợi bằng cách neo điều này trong một ví dụ cụ thể.

Hãy tập trung vào một cú swing bóng chày.

Xích đu có một vài giai đoạn khác nhau.

Trong hình này, chúng ta có thể thấy thiết lập trước khi xoay, xoay thực tế, sau đó là theo dõi sau tác động.

Một thước đo quan trọng cho chất lượng xoay là thời gian để liên hệ.

Nói cách khác, bao nhiêu thời gian trôi qua giữa thời điểm người đánh bóng bắt đầu vung gậy và thời gian người đánh bóng.

Sử dụng dữ liệu cảm biến tốc độ cao, chúng ta có thể chia nó thành ba bước.

Trên cổ tay của người đánh bóng, chúng ta có thể thấy Apple Watch với các hướng x, y và z.

Chúng ta có thể tưởng tượng đường đi của cổ tay khi nó di chuyển xung quanh bột màu xanh lam, với vectơ trọng lực hướng xuống.

Để tính toán thời gian tiếp xúc, trước tiên tôi sẽ phát hiện điểm va chạm giữa gậy và quả bóng bằng gia tốc kế 800 Hz.

Sau đó, tôi sẽ xác định sự bắt đầu của cú swing bằng cách sử dụng vòng quay dọc theo trọng lực với chuyển động của thiết bị 200 Hz.

Cuối cùng, chúng ta có thể tính toán sự khác biệt giữa các dấu thời gian này, từ khi bắt đầu xoay đến tác động, được gọi là thời gian để tiếp xúc.

Hãy bắt đầu bằng cách trực quan hóa dữ liệu cảm biến trong quá trình xoay để hiểu được những gì chúng ta đang tìm kiếm.

Ở đây, tôi đã vẽ biểu đồ dữ liệu gia tốc kế theo hướng z cho một cửa sổ một giây chứa một cú xoay.

Tôi có thể thấy rằng từ 0,5 đến 0,6 giây có một sự bùng nổ của hoạt động.

Thuật toán của chúng tôi để phát hiện điểm va chạm sẽ xoay quanh quan sát này.

Hãy so sánh lượng thông tin tín hiệu có sẵn trong quá trình xoay, với gia tốc kế 800 Hz ở trên và gia tốc kế 100 Hz ở dưới cùng.

Trong phần quan tâm đó, từ 0,5 đến 0,6 giây, bây giờ chúng ta có 80 điểm dữ liệu thay vì 10, cho chúng ta một bức tranh chi tiết hơn nhiều về những gì đang diễn ra.

Điều này giúp chúng tôi tập trung vào những thứ chúng tôi quan tâm, như tác động.

Bây giờ, hãy nhìn vào cùng một cú swing từ góc độ chuyển động của thiết bị.

Điều này vẽ biểu đồ tốc độ quay dọc theo trọng lực ở 200 Hz.

Tôi có thể thấy sự dao động bắt đầu bằng cách tốc độ quay bắt đầu thay đổi vào khoảng 0,3 giây.

Hãy ghép những thứ này lại với nhau.

Với những biểu đồ này được căn chỉnh theo thời gian, tôi có thể cảm nhận được thông tin trong gia tốc kế 800 Hz và chuyển động của thiết bị 200 Hz giúp tôi tính toán thời gian liên lạc như thế nào.

Bây giờ tôi đã có ý tưởng tốt về cách xoay hiển thị trong các luồng cảm biến, tôi có thể sử dụng CMBatchedSensorManager để bắt đầu phát trực tuyến và xử lý dữ liệu.

Đầu tiên, chúng tôi muốn xác nhận dữ liệu có sẵn trên nền tảng này.

Bạn có thể làm như vậy bằng cách kiểm tra isAccelerometerSupported.

Bạn có thể kiểm tra hỗ trợ chuyển động của thiết bị bằng cách sử dụng một thuộc tính tương tự.

Apple Watch Series 8 và Ultra hỗ trợ cả gia tốc kế tốc độ cao và chuyển động của thiết bị.

Bởi vì đây là một API tập trung vào tập luyện, bạn cần có một buổi tập luyện HealthKit đang hoạt động để lấy dữ liệu.

Khi bạn đang ở trong một buổi Tập luyện HealthKit, bạn có thể bắt đầu nhận thông tin cập nhật.

Với sự hỗ trợ không đồng bộ Swift, thật dễ dàng để nhận các lô dữ liệu cảm biến và xử lý từng lô.

Hãy chắc chắn rằng bạn đánh giá các điều kiện để thoát khỏi vòng lặp; ví dụ, nếu bài tập đã kết thúc.

Hãy nhớ rằng các lỗi sẽ xuất hiện nếu chúng tôi không được phép cho dữ liệu chuyển động hoặc trên một nền tảng không được hỗ trợ.

Bây giờ, hãy phóng to những gì tôi muốn làm với mỗi lô dữ liệu.

Đối với mỗi lô, tôi sẽ gọi một hàm nguồn cấp dữ liệu để chạy thuật toán của mình trên dữ liệu.

Khi con dơi tiếp xúc với quả bóng, tôi hy vọng sẽ thấy một phản ứng rõ rệt theo hướng z.

Hãy nhớ rằng, trục z vuông góc với vương miện đồng hồ.

Sự vang dội này là một xấp xỉ tốt của tác động.

Tôi sẽ xử lý từng lô gia tốc kế với ý nghĩ này.

Đầu tiên, tôi muốn cách ly tốt hơn đáp ứng tần số cao hơn khi lực bị dịch chuyển khi tiếp xúc.

Để làm điều này, tôi sẽ lọc các mẫu z dưới dạng fz.

Sử dụng dữ liệu được lọc, tôi sẽ ước tính điểm va chạm là đỉnh của tín hiệu được lọc.

Hãy theo dõi chỉ số liên quan đến mẫu đó dưới dạng impactIndex.

Sử dụng impactIndex được rút ra từ tín hiệu được lọc, tôi có thể lấy dấu thời gian tác động từ lô dữ liệu ban đầu.

Điều này đưa tôi đến bước thứ hai trên con đường tính toán thời gian tiếp xúc: phát hiện sự bắt đầu của cú swing bằng cách sử dụng vòng quay dọc theo trọng lực.

Hãy tưởng tượng con đường của Apple Watch khi người đánh bóng thực hiện một cú swing; nó sẽ đi theo một con đường xung quanh cơ thể để gặp quả bóng.

Vì vậy, tôi hy vọng sẽ thấy tốc độ quay không bằng không dọc theo trọng lực trong quá trình xoay và tốc độ quay gần bằng không dọc theo trọng lực bên ngoài xích đu.

Bằng cách truyền chuyển động của thiết bị tần số cao vào bộ đệm cục bộ, tôi có thể sử dụng dữ liệu tốc độ quay để xác định nơi bắt đầu dao động.

Chúng ta hãy xem xét kỹ hơn hàm tính toán của tôi trông như thế nào.

Tôi sẽ lặp lại qua bộ đệm cục bộ của mình ngược lại để điều tra xung quanh điểm quan tâm: dấu thời gian tác động.

Vì tôi biết việc bắt đầu cú swing phải đi trước tác động, tôi có thể chạy một loạt các kiểm tra shouldProcess trước khi xử lý từng mẫu trong bộ đệm.

Điều này có thể bao gồm kiểm tra dấu thời gian để xác nhận mẫu chuyển động của thiết bị là từ trước thời gian va chạm.

Tôi cũng có thể đặt giới hạn về thời lượng xoay.

Điều hợp lý là việc bắt đầu cú swing không xảy ra quá một khoảng thời gian nhất định trước khi nó tiếp xúc với quả bóng.

Đối với các mẫu vượt qua loạt kiểm tra ban đầu của tôi, tôi tính toán vòng quay dọc theo trọng lực trong hàm computeRotation của mình, hàm này tổng hợp tích của tốc độ quay và giá trị trọng lực của mỗi trục.

Với vòng quay dọc theo trọng lực được tính toán, tôi có thể bắt đầu tìm kiếm sự khởi đầu của cú swing.

Một kiểm tra bắt đầu xoay đơn giản có thể tìm kiếm sự thất bại nhất quán của tốc độ quay dọc theo trọng lực để đáp ứng giá trị ngưỡng.

Khi tôi ngừng nhìn thấy tốc độ quay dọc theo trọng lực đáp ứng ngưỡng đó, tôi sẽ sử dụng nó làm thời gian bắt đầu của cú swing và thoát ra khỏi vòng lặp.

Như một kiểm tra cuối cùng, tôi sẽ xác nhận cú swing mà chúng tôi đã phát hiện.

Ở đây, tôi có thể xem xét vòng quay tích lũy dọc theo trọng lực trong quá trình xoay và xác nhận nó nằm trong ngưỡng dự kiến.

Và với điều đó, tôi có thể trả lại dấu thời gian bắt đầu mà tôi đã phát hiện.

Điều này đưa tôi đến bước cuối cùng, bước 3, nơi bây giờ tôi có mọi thứ tôi cần để tính toán thời gian liên hệ.

Hãy quay lại chức năng nguồn cấp dữ liệu ban đầu của chúng ta.

Sử dụng CMBatchedSensorManager, tôi bắt đầu bằng cách phát trực tuyến gia tốc kế và dữ liệu chuyển động của thiết bị.

Tôi đã phát hiện impactTime bằng cách sử dụng dữ liệu gia tốc kế được lọc theo hướng z.

Sau đó, tôi đã xác định được sự bắt đầu của cú swing gần dấu thời gian va chạm đó bằng cách kiểm tra tốc độ quay dọc theo trọng lực.

Tôi sẽ lấy sự khác biệt giữa hai dấu thời gian để tính thời gian liên lạc.

Đây là một ví dụ đơn giản về cách bạn có thể phát triển các tính năng dựa trên dữ liệu cảm biến.

Thông tin tín hiệu bổ sung trong các luồng dữ liệu tần số cao hơn cũng mở ra cánh cửa cho rất nhiều cuộc điều tra khác.

Hãy cùng xem nào.

Chúng tôi đã thấy dấu vết dữ liệu gia tốc kế này trước đó với dòng gia tốc kế 800 Hz theo hướng z.

Bây giờ, hãy nhìn vào cốt truyện thứ hai.

Nó trông khá giống nhau, nhưng nó không hoàn toàn giống nhau.

Đây là dấu vết từ một cú đánh bị bỏ lỡ, nơi con dơi không thực sự tiếp xúc với quả bóng.

Mặc dù bản thân chuyển động xoay tương tự nhau cho cả hai, bạn có thể thấy các luồng dữ liệu tốc độ cao cung cấp cho chúng ta cái nhìn sâu sắc hơn về sự khác biệt như thế này như thế nào.

Các thuật toán bạn phát triển có thể tận dụng những khác biệt này để phát hiện những điều không thể thực hiện trước đây.

Tóm lại, các thuật toán chuyển động của cùng một thiết bị cung cấp dữ liệu cho bạn theo một vài cách khác nhau.

CMMotionManager định vị dữ liệu ở mức tối đa 100 Hz trên cơ sở mỗi mẫu.

Điều này làm cho nó trở thành một lựa chọn tuyệt vời nếu bạn có yêu cầu độ trễ thấp trên thang điểm dưới giây hoặc có các tính năng dựa trên chuyển động bên ngoài các bài tập.

CMBatchedSensorManager mới cung cấp dữ liệu với tốc độ cao hơn, với giới hạn chuyển động thiết bị 200 Hz và gia tốc kế 800 Hz theo lịch trình theo lô, cung cấp một lô dữ liệu mỗi giây.

Điều này làm cho nó hữu ích cho các tính năng tập luyện tập có thể được hưởng lợi từ dữ liệu tốc độ cao.

Nó có sẵn trên Apple Watch Series 8 và Ultra.

Mặc dù tôi tập trung vào một cú swing bóng chày để sử dụng CMBatchedSensorManager, những luồng dữ liệu tốc độ cao hơn này có thể cung cấp cái nhìn sâu sắc có giá trị về chuyển động của Apple Watch cho tất cả các bài tập, đặc biệt là trong thời gian ngắn hoặc các hoạt động dựa trên tác động.

Đó là CMBatchedSensorManager, và điều này kết thúc đánh giá của tôi về những gì mới với CoreMotion.

Chúng tôi có những cách tuyệt vời để tương tác với chuyển động, cho dù đó là trên tai nghe hay Apple Watch.

Có rất nhiều cách thú vị để sử dụng dữ liệu chuyển động và tôi chỉ đề cập đến một vài ví dụ.

Tôi khuyến khích bạn dùng thử chúng và kiểm tra tài liệu để biết thêm thông tin.

Đảm bảo cũng cung cấp phản hồi cho chúng tôi.

Để biết ví dụ về cách dữ liệu chuyển động được chuyển thành các tính năng dựa trên sức khỏe, như đo lường tính di động, hãy xem phiên "Vượt quá các bước đếm" từ WWDC 2020.

Để biết thêm thông tin về các bài tập chạy bộ để tận dụng lợi thế của CMBatchedSensorManager, hãy xem "Xây dựng các bài tập tùy chỉnh với WorkoutKit."

Chúng tôi rất vui khi thấy cách bạn sử dụng dữ liệu chuyển động để tạo ra những trải nghiệm mới tuyệt vời.

Cảm ơn bạn đã xem.