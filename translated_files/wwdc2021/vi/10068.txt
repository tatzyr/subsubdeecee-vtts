10068

♪ Nhạc bass đang phát ♪

♪

Erik Hornberger: Chào buổi chiều, mọi người, và cảm ơn vì đã tham gia cùng chúng tôi hôm nay.

Chúng tôi đã lên kế hoạch cho bạn một số nội dung tuyệt vời.

Chúng ta sẽ đi qua một mã - cùng với nơi bạn và tôi sẽ cùng nhau xây dựng một ứng dụng nghiên cứu và chăm sóc.

ResearchKit là một khung iOS mã nguồn mở mà Apple duy trì với sự hợp tác của cộng đồng GitHub của chúng tôi.

Nó cung cấp các yếu tố giao diện người dùng để thu thập sự đồng ý, quản lý các cuộc khảo sát và ghi lại dữ liệu cảm biến trong khi người tham gia thực hiện các hoạt động, chẳng hạn như các bài tập thể chất hoặc nhận thức.

CareKit, tương tự như vậy, cũng là một khung mã nguồn mở hoàn toàn và nó được thiết kế để giúp xây dựng các ứng dụng chăm sóc đối mặt với bệnh nhân.

Nó xuất sắc trong việc lên lịch các nhiệm vụ mà bạn muốn bệnh nhân thực hiện, như uống thuốc hoặc gọi bác sĩ của họ.

Nó cũng cung cấp một lớp kiên trì an toàn cho dữ liệu liên quan đến sức khỏe và có các tiện ích để lập biểu đồ.

Bây giờ, trong các phiên WWDC trước đây, chúng tôi thường thảo luận về hai khuôn khổ anh chị em này một cách cô lập, nhưng năm nay chúng tôi sẽ chỉ cho bạn cách chúng có thể được sử dụng cùng nhau để tạo ra trải nghiệm tốt hơn cho bệnh nhân...

Xin lỗi.

Chúng ta có nên - tôi nên để nó ở chế độ im lặng.

Chúng ta có cắt không?

Phi hành đoàn: Không, chỉ cần trả lời nó.

Erik: Yo, Jamie. Có chuyện gì vậy?

Jamie: Này, Erik.

Tôi biết bạn đang bận chuẩn bị cho WWDC ngay bây giờ, nhưng tôi muốn nói với bạn rằng nguồn tài trợ vừa được thông qua cho ứng dụng nghiên cứu vật lý trị liệu của chúng tôi!

Nghiên cứu tiên tiến này sẽ giúp ích cho rất nhiều người!

Vì vậy, bạn có nghĩ rằng chúng ta có thể nhận được vòng quay đầu tiên của ứng dụng, giống như, ngay lập tức không?

Erik: Này, Jamie, đó là - đó là một tin tuyệt vời, và tôi - tôi thực sự hào hứng với nó.

Vấn đề là chúng tôi chỉ đang ở giữa mã Dub Dub của chúng tôi - cùng.

Jamie: Ồ, vậy là bạn đã viết mã rồi à?

Điều đó thật hoàn hảo!

Vì vậy, ứng dụng sẽ được gọi là "Khôi phục".

Nó sẽ là một ứng dụng vật lý trị liệu để giúp những người tham gia tăng cường sức mạnh đầu gối sau phẫu thuật, và nó sẽ là một sự thay đổi cuộc chơi!

Tôi có rất nhiều ý tưởng tuyệt vời, nhưng trước tiên, điều thực sự quan trọng là những người tham gia đồng ý tham gia nghiên cứu trước khi chúng tôi để họ bắt đầu sử dụng ứng dụng.

Chúng ta phải giải thích cho họ tất cả các pháp lý, nhưng tôi thực sự muốn làm điều đó theo cách không đáng sợ, bạn biết không?

Chúng tôi cũng sẽ cần có chữ ký từ những người tham gia và yêu cầu họ đồng ý chia sẻ dữ liệu với chúng tôi.

Uh, một giây, Erik.

Tôi đang nhận được tin nhắn từ nhóm lâm sàng.

Ồ, wow. Có vẻ như những người tham gia đầu tiên sẽ được thả ra khỏi post-op vào thứ Hai.

Erik, bạn có thể bắt đầu với việc giới thiệu ngay bây giờ không?

Tôi phải bắt kịp với phần còn lại của đội, nhưng tôi sẽ gọi lại cho bạn một chút!

Điều này sẽ rất tuyệt!

Erik: Được rồi.

Uh... Được rồi!

Tôi đoán đây sẽ chỉ là mã của chúng tôi ngay bây giờ!

Vì vậy, hãy - hãy xem liệu chúng ta có thể kết thúc việc giới thiệu trước khi Jamie rời khỏi cuộc họp đó không!

Vì vậy, đối với phiên này, hãy tập trung vào việc giới thiệu và đồng ý.

Giải thích cho người tham gia những dữ liệu chúng tôi sẽ thu thập, ai sẽ có quyền truy cập vào nó, nó sẽ được sử dụng để làm gì, nó sẽ được lưu giữ trong bao lâu - và làm cho tất cả những điều đó dễ hiểu - là điều tối quan trọng đối với một nghiên cứu tốt.

Chúng tôi sẽ chỉ cho bạn một số phương pháp hay nhất mới cho ResearchKit sẽ giúp bạn có được phần rất quan trọng này trong ứng dụng của mình vừa phải.

Và như một phần thưởng, chúng tôi sẽ trình bày một cách thông minh để nướng luồng giới thiệu và đồng ý đó ngay vào ứng dụng dựa trên CareKit.

Cụ thể, chúng tôi sẽ thiết lập một ứng dụng CareKit tiêu chuẩn, nhưng theo cách mà những người tham gia phải hoàn thành việc giới thiệu trước khi nội dung của kế hoạch chăm sóc được tiết lộ.

Là một phần của sự đồng ý và quy trình giới thiệu đó, chúng tôi sẽ xây dựng một số bước hướng dẫn cho những người tham gia biết về những gì họ sắp được yêu cầu làm.

Chúng tôi nhận thấy rằng việc định hướng những người tham gia như thế này, trước khi nhảy vào các phần đồng ý thực tế, thực sự giúp cải thiện trải nghiệm của họ.

Chúng tôi sẽ chỉ cho bạn cách thu thập chữ ký và chúng tôi cũng sẽ trình bày cách sử dụng ResearchKit để yêu cầu ủy quyền cho HealthKit, thông báo và chuyển động của thiết bị ngay từ đầu, tất cả đều là một phần của quá trình giới thiệu.

Nếu bạn muốn theo dõi, bạn có thể tìm thấy dự án khởi động trong tài nguyên phiên.

Hãy mở Xcode và bắt đầu!

Đây là nơi chúng ta sẽ bắt đầu.

Hôm nay chúng ta sẽ chạm vào bốn tập tin.

Đầu tiên là AppDelegate.

Đây là nơi chúng tôi sẽ tương tác với cửa hàng của CareKit.

Trong Surveys.swift, chúng tôi sẽ viết ra một số khảo sát bằng ResearchKit.

Tiếp theo, chúng tôi có CareFeedViewController và InsightsViewController, nơi chúng tôi sẽ xây dựng giao diện người dùng cho ứng dụng của mình.

Bây giờ, nếu bạn chạy ứng dụng khởi động, bạn sẽ thấy rằng thực sự không có nhiều thứ ở đó ngay bây giờ.

Nó chỉ là OCKDailyPageViewController không có nội dung.

Nó cho phép chúng ta nhảy xung quanh giữa các ngày, nhưng vẫn chưa có gì ở đó.

Công việc của chúng tôi sẽ là lấp đầy tất cả những điều đó.

Ngoài ra còn có tab Thông tin chi tiết ở đây ở góc và chúng tôi sẽ quay lại đó trong phần ba.

Bây giờ, những gì chúng tôi muốn làm là làm cho một thẻ đồng ý hiển thị ở đây trong nguồn cấp dữ liệu của người tham gia.

Nhiệm vụ đồng ý đó sẽ truy cập cổng vào phần còn lại của ứng dụng.

Không có gì khác sẽ xuất hiện cho đến khi nó được hoàn thành, và một khi nó đã được hoàn thành, tất cả các nhiệm vụ khác sẽ xuất hiện.

Chuyển qua đây để AppDelegate.swift, bước đầu tiên của chúng tôi sẽ là duy trì một nhiệm vụ CareKit để giới thiệu.

Bây giờ, bất cứ khi nào chúng tôi tạo một nhiệm vụ, chúng tôi cần xác định một lịch trình xác định tần suất nhiệm vụ sẽ xuất hiện trong nguồn cấp dữ liệu của người tham gia.

Đối với việc lên tàu, chúng tôi sẽ sử dụng lịch trình hàng ngày để họ được nhắc lên tàu mỗi ngày cho đến khi họ hoàn thành việc đồng ý.

Tiếp theo, chúng ta sẽ tạo ra một nhiệm vụ.

Chúng tôi cung cấp cho nó một ID, có thể là bất cứ thứ gì chúng tôi muốn, miễn là nó là duy nhất.

Các số nhận dạng ngẫu nhiên đều ổn, nhưng trong trường hợp này, tôi chỉ có một hằng số mà chúng tôi đã xác định ở đây trong một tệp khác.

Chúng tôi cũng cần phải vượt qua lịch trình mà chúng tôi vừa tạo.

Chúng tôi cũng sẽ chỉ định một số hướng dẫn và chỉ ra rằng việc giới thiệu không ảnh hưởng đến việc tuân thủ.

Điều này có nghĩa là về cơ bản việc giới thiệu sẽ không được tính vào việc lấp đầy các vòng hoàn thành mà bạn thấy ở đầu hầu hết các ứng dụng CareKit.

Và cuối cùng, chúng ta có thể tiếp tục thực hiện nhiệm vụ vào cửa hàng của mình.

Chúng tôi sẽ tiếp tục và in ra một tin nhắn để cho chúng tôi biết liệu nó có thành công hay không.

Được rồi, chúng tôi đã có nhiệm vụ giới thiệu của mình trong cửa hàng, sẵn sàng hoạt động và bây giờ, chúng tôi đã sẵn sàng để làm cho nó xuất hiện trong nguồn cấp dữ liệu của người tham gia.

Chúng tôi sẽ lướt qua CareViewController.swift nơi chúng tôi sẽ cho CareKit biết chúng tôi muốn nó được hiển thị như thế nào.

Ở đây, chúng tôi đang phân loại con OCKDailyPageViewController, đây là lịch và nguồn cấp dữ liệu mà chúng tôi đã thấy chỉ một lúc trước.

Chúng tôi đang ghi đè lên listViewController chuẩn bị cho phương thức ngày.

Phương pháp này sẽ được gọi mỗi khi người dùng vuốt đến một ngày mới và công việc của chúng tôi là kiểm tra ngày, xác định những gì chúng tôi muốn hiển thị vào ngày đó và thêm nội dung thích hợp vào listViewController.

Bây giờ, điều đầu tiên chúng tôi muốn làm là kiểm tra xem người tham gia đã hoàn thành việc giới thiệu hay chưa, vì chúng tôi sẽ hiển thị nội dung khác nhau dựa trên câu trả lời cho câu hỏi đó.

Hãy thả xuống xa hơn một chút và viết ra một phương pháp để làm điều đó.

Bên trong phương thức checkIfOnboardingIsComplete của chúng tôi, chúng tôi sẽ tạo một OCKOutomeQuery và chúng tôi sẽ truy vấn tất cả các kết quả liên quan đến nhiệm vụ giới thiệu.

Khi truy vấn của chúng tôi trả về, chúng tôi sẽ kiểm tra xem có bất kỳ kết quả nào được tìm thấy hay không.

Nếu không có, điều đó có nghĩa là việc giới thiệu vẫn chưa kết thúc.

Nếu có, điều đó có nghĩa là việc giới thiệu đã hoàn tất.

Chúng tôi sẽ sử dụng phương pháp mới của mình ngay tại đây và dựa trên việc việc việc giới thiệu đã hoàn tất hay chưa, chúng tôi sẽ chỉ hiển thị nhiệm vụ đồng ý hoặc tất cả các nhiệm vụ khác.

Được rồi. Cho đến nay, rất tốt!

Bây giờ chúng tôi có một cơ chế để yêu cầu người tham gia tham gia tham gia trước khi cho họ vào phần còn lại của ứng dụng.

Bước tiếp theo là thiết lập quy trình giới thiệu đó.

Ngay tại đây, chúng tôi muốn tạo một thẻ nhiệm vụ CareKit trình bày một cuộc khảo sát ResearchKit, nhưng trước khi chúng tôi có thể làm điều đó, chúng tôi cần thực sự tạo một cuộc khảo sát ResearchKit để chúng tôi có thứ gì đó để hiển thị.

Chúng tôi sẽ ghé qua Surveys.swift và giải quyết vấn đề đó.

Hãy bắt đầu chức năng của chúng ta.

Cuộc khảo sát giới thiệu của chúng tôi sẽ bao gồm năm bước: bước chào mừng, bước hướng dẫn, bước chữ ký, bước cấp phép và cuối cùng là bước hoàn thành.

Đầu tiên sẽ là bước chào mừng, đó sẽ là Bước Hướng dẫn ORK.

Hôm nay chúng ta sẽ thấy rất nhiều bước hướng dẫn này.

Bất cứ khi nào chúng tôi tạo một bước ResearchKit, chúng tôi cần cung cấp cho nó một mã định danh duy nhất.

Bạn có thể sử dụng bất kỳ mẫu nào bạn muốn, bao gồm cả số nhận dạng ngẫu nhiên.

Tôi nhận thấy rằng cách tiếp cận lấy cảm hứng từ con đường chính này thực sự hiệu quả với tôi.

Chúng tôi cũng sẽ chỉ định một tiêu đề và một số văn bản chi tiết cũng như một hình ảnh tiêu đề.

Được rồi.

Vì vậy, tiếp theo: bước hai sẽ là bước đồng ý được thông báo của chúng tôi và đây cũng sẽ là một bước hướng dẫn.

Nhưng lần này, chúng ta sẽ thêm một số vật dụng cơ thể.

Các vật phẩm cơ thể về cơ bản là gạch đầu dòng, nhưng chúng tôi có tùy chọn sử dụng hình ảnh - và trong trường hợp này là Biểu tượng SF - thay cho viên đạn.

Vật phẩm cơ thể này nói với những người tham gia rằng họ sẽ được yêu cầu chia sẻ một số dữ liệu sức khỏe.

Hãy tạo một vật phẩm cơ thể thứ hai để nói với họ rằng họ sẽ được yêu cầu hoàn thành nhiệm vụ và một vật phẩm thứ ba để thông báo cho họ rằng họ sẽ được yêu cầu cung cấp chữ ký của họ.

Hãy thêm một cái nữa để nhắc nhở họ rằng dữ liệu của họ sẽ được giữ kín và an toàn.

Cuối cùng, chúng tôi sẽ chèn những vật dụng cơ thể này vào bước hướng dẫn của chúng tôi.

Và điều đó bao gồm các hướng dẫn.

Tiếp theo là thu thập chữ ký, và may mắn thay, ResearchKit làm cho phần này thực sự dễ dàng.

Chữ ký có thể được thu thập bằng ORKWebViewStep.

Đặt thuộc tính showSignature AfterContent thành true sẽ nhắc ResearchKit hiển thị hộp chữ ký ở cuối bước.

Chúng tôi có thể cung cấp tài liệu đồng ý thực tế dưới dạng HTML và nó sẽ được hiển thị ngay phía trên hộp chữ ký.

Vậy là xong; chữ ký khá nhanh chóng và dễ dàng!

Phần cuối cùng sẽ là yêu cầu quyền.

Đối với bước thứ tư này, chúng tôi sẽ thu thập các quyền với HealthKitPermissionType mà đồng đội Pariece của tôi đã giới thiệu tại WWDC năm ngoái.

Nó yêu cầu chúng tôi chỉ định hai bộ loại HealthKit: một bộ mà chúng tôi muốn có quyền ghi và một bộ mà chúng tôi muốn có quyền đọc.

Năm nay, chúng tôi sẽ giới thiệu hai loại quyền mới.

Đầu tiên là ORKNotificationPermissionType, và nó cho phép chúng tôi yêu cầu quyền hiển thị cảnh báo, gắn huy hiệu cho ứng dụng và phát âm thanh.

Chúng tôi cũng đang giới thiệu ORKMotionActivity PermissionType, sẽ giúp chúng tôi yêu cầu quyền truy cập vào dữ liệu chuyển động của thiết bị.

Chúng tôi sẽ chuyển cả ba điều này vào một requestPermissionStep, kết thúc bước thứ tư của chúng tôi.

Bước thứ năm và cuối cùng sẽ chỉ là bước hoàn thành cảm ơn người tham gia đã tham gia nghiên cứu của Jamie.

Tất cả các bước này sẽ được xích lại với nhau bên trong ORKOrderedTask.

Chúng tôi sẽ vượt qua các bước theo thứ tự mà chúng tôi muốn ResearchKit trình bày chúng và sau đó trả lại nhiệm vụ từ phương pháp này.

Được rồi.

Bây giờ chúng ta đã xác định toàn bộ quy trình giới thiệu và đồng ý, hãy quay lại CareFeedViewController và xem lại cách hiển thị nó từ ứng dụng dựa trên CareKit của chúng tôi.

Chúng tôi đang giới thiệu một lớp hoàn toàn mới, OCKSurveyTaskViewController, và nó được xây dựng đặc biệt cho mục đích này.

Giống như tất cả các bộ điều khiển chế độ xem CareKit khác, chúng tôi chuyển ID của tác vụ mà chúng tôi muốn hiển thị cùng với eventQuery và storeManager.

Ngoài ra, chúng tôi cũng sẽ cần cuộc khảo sát mà chúng tôi vừa tạo và đóng cửa chuyển kết quả ResearchKit thành một mảng các giá trị kết quả CareKit.

Chúng tôi sẽ xem xét lại việc đóng cửa này chi tiết hơn trong phần hai.

Hiện tại, chúng tôi sẽ chỉ nói rằng chỉ cần duy trì ngày người tham gia hoàn thành việc giới thiệu là đủ.

Chúng tôi cũng sẽ muốn thêm thẻ nhiệm vụ này vào nguồn cấp dữ liệu của chúng tôi.

Bây giờ, thực sự có một bước nữa, và đó là đảm bảo rằng nguồn cấp dữ liệu tải lại sau khi người tham gia hoàn thành việc giới thiệu.

Một cách chúng ta có thể hoàn thành điều đó là tự đặt mình làm đại diện của bộ điều khiển chế độ xem nhiệm vụ khảo sát.

Sau đó, ở dưới đây, chúng ta có thể thực hiện phương pháp đại diện, bộ điều khiển chế độ xem nhiệm vụ khảo sát đã hoàn thành nhiệm vụ với kết quả.

Trong phần thân của phương pháp này, chúng ta có thể kiểm tra xem việc giới thiệu đã được hoàn thành thành công chưa, về cơ bản chỉ để nói rằng người tham gia đã không hủy bỏ một phần; họ đã đi đến cuối cùng và hoàn thành nó thành công.

Nếu đúng như vậy, chúng ta có thể gọi reload() để làm mới nguồn cấp dữ liệu.

Được rồi, vậy thẻ giới thiệu của chúng tôi đã được thiết lập.

Khi người tham gia hoàn thành việc giới thiệu, chúng tôi sẽ lưu OCKOutcome và sau đó tải lại nguồn cấp dữ liệu.

Cái này trông ổn đấy!

Tôi nghĩ đó là - đó là tất cả, thực sự!

Hãy chạy ứng dụng của chúng tôi và xác nhận rằng tất cả đều hoạt động.

Bạn có thể thấy rằng chúng tôi đang được yêu cầu đồng ý trước khi chúng tôi có thể bắt đầu sử dụng ứng dụng.

Và đó chính xác là những gì chúng tôi muốn!

Hãy nhấn vào nút Bắt đầu ở đây và chúng ta sẽ thấy rằng chúng ta được chào đón bởi bước chào mừng mà chúng ta đã tạo chỉ một lúc trước.

Bước tiếp theo là bước hướng dẫn của chúng tôi với các vật dụng cơ thể mà chúng tôi đã xác định.

Các Biểu tượng SF mà chúng tôi đã chọn thực sự làm cho nó trở nên sống động.

Tiếp theo là bước chữ ký, vì vậy tôi sẽ cuộn xuống đây và ký tên đó...

...Và sau đó chúng ta chuyển sang bước ủy quyền.

Đầu tiên, chúng tôi sẽ ủy quyền cho HealthKit.

Cứ tiếp tục và cho phép điều đó.

Tiếp theo là thông báo, và sau đó là chuyển động của thiết bị.

Trang cuối cùng là bước hoàn thành của chúng tôi cho chúng tôi biết rằng tất cả chúng tôi đã hoàn thành và cảm ơn chúng tôi đã tham gia.

Và bây giờ chúng tôi đã trở lại Nguồn cấp dữ liệu Chăm sóc của mình.

Lưu ý rằng chúng tôi không thấy lời nhắc hoàn toàn đồng ý nữa vì chúng tôi đã hoàn thành việc đó ngay bây giờ.

Thay vào đó, đây là nơi tất cả nội dung thực sự của ứng dụng của chúng tôi sẽ xuất hiện.

Chúng ta sẽ đạt được điều đó trong phiên tiếp theo của chúng ta.

Này Siri, bạn có thể nhắn tin cho Jamie và nói với anh ấy rằng chúng ta đã hoàn thành việc giới thiệu và đồng ý không?

Bạn có thể tìm thêm thông tin về các khuôn khổ của chúng tôi trên researchandcare.org.

Nếu bạn muốn đọc mã nguồn - hoặc đóng góp - cả hai khuôn khổ đều có sẵn trên GitHub.

Vui lòng tham gia với chúng tôi một lần nữa cho phiên tiếp theo của chúng tôi.

Tôi sẽ kiểm tra với Jamie thật nhanh, và sau đó tôi sẽ tham gia lại với bạn trong phần hai.

Hẹn gặp lại!

♪