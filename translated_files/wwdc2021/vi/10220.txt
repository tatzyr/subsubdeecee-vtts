10220

Xin chào, tên tôi là Paul Borokhov, và tôi là một kỹ sư trong nhóm SwiftUI Mac.

Tôi sẽ tham gia sau bởi đồng nghiệp Kate Kononenko của tôi trong nhóm Bản địa hóa, và chúng tôi sẽ nói chuyện với bạn về cách bản địa hóa ứng dụng SwiftUI của bạn.

Để minh họa quá trình này, chúng tôi sẽ sử dụng ứng dụng mẫu Fruta mà bạn có thể đã thấy trước đây.

Ứng dụng này cho phép bạn duyệt qua thực đơn sinh tố, gọi chúng và cũng xem các công thức để làm chúng tại nhà.

Trong buổi nói chuyện này, chúng tôi sẽ thêm bản địa hóa tiếng Nga vào ứng dụng, vì đó là cả ngôn ngữ mẹ đẻ của tôi và Kate, và bởi vì nó là một chương trình giới thiệu tốt cho các phương pháp hay nhất về bản địa hóa khác nhau mà bạn có thể sẽ cần sử dụng trong các ứng dụng của riêng mình.

Chúng ta sẽ xem xét một số nguyên tắc cơ bản về cách các chuỗi được bản địa hóa trong SwiftUI và việc tránh những cạm bẫy thiết kế phổ biến dễ dàng như thế nào.

Chúng tôi sẽ thảo luận về các kỹ thuật để tạo kiểu và định dạng chuỗi và dữ liệu của bạn, đồng thời đề cập đến một số cải tiến đối với bản địa hóa phím tắt.

Cuối cùng, Kate sẽ đưa ra bản demo về những cải tiến mà chúng tôi đã thực hiện đối với quy trình bản địa hóa trong Xcode để giúp bản địa hóa ứng dụng của bạn dễ dàng hơn bao giờ hết.

Một trong những phần quan trọng nhất của việc bản địa hóa ứng dụng của bạn là đảm bảo rằng các chuỗi trong các phần khác nhau của giao diện người dùng của bạn được hiển thị cho người dịch và hiển thị chính xác trong thời gian chạy.

SwiftUI giúp bạn dễ dàng làm điều này, bởi vì khi bạn sử dụng Văn bản với chuỗi theo nghĩa đen, nó sẽ tự động thực hiện tra cứu chuỗi được bản địa hóa trong gói chính.

Trong ví dụ này, tôi có một nút Xong được bản địa hóa tự động trong thời gian chạy dựa trên bản dịch trong tệp chuỗi tiếng Nga của tôi.

Điều này cũng hoạt động cho nội suy chuỗi, để bạn có thể nhúng các biến vào chuỗi của mình và chúng được tự động chuyển đổi thành các chỉ định định dạng trong các tệp và danh mục chuỗi có thể định vị đã xuất.

Mới trong Xcode 13, bây giờ chúng tôi tự động suy ra loại chỉ định định dạng dựa trên loại biến được truyền vào chuỗi.

Văn bản chấp nhận các đối số tùy chọn bổ sung cho tên bảng và gói, trong trường hợp bạn cần kiểm soát nhiều hơn.

Trong ví dụ này, chúng tôi đã đặt tất cả các chuỗi liên quan đến thành phần của mình vào một bảng riêng biệt được gọi là "Thành phần".

Ngoài các thành phần thực tế của sinh tố, chúng tôi cũng đã đặt hai biến thể của từ "thành phần" cho hai ngữ cảnh khác nhau, trong chế độ xem sinh tố và trong chế độ xem công thức, trong bảng chuỗi này.

Chúng tôi đã làm điều này bởi vì tiếng Nga yêu cầu hai từ này phải được dịch khác nhau dựa trên ngữ cảnh, như bạn có thể thấy.

Bạn có thể tìm hiểu thêm về cách sắp xếp các chuỗi của mình trong bài nói chuyện "Hợp lý hóa các chuỗi được bản địa hóa của bạn".

Tất cả điều này đều hoạt động vì đối số đầu tiên của Text là loại LocalizedStringKey.

Nếu bạn có các chế độ xem và phương thức tùy chỉnh chấp nhận các ký tự chuỗi, bạn có thể làm cho chúng có thể định vị được bằng cách sử dụng loại này thay cho Chuỗi.

Bằng cách này, các ký tự được truyền dưới dạng đối số cho các chế độ xem và chức năng này sẽ tự động được trích xuất trong quá trình xuất bản địa hóa Xcode và sau đó được tải từ gói trong thời gian chạy.

Một cách tiếp cận thay thế, mà chúng ta đã thấy trước đó trong ví dụ nút, là để quan điểm của bạn chấp nhận đối số Văn bản thay thế.

Sử dụng LocalizedStringKey cũng cho phép bạn xem trước nhiều ngôn ngữ cùng một lúc bằng cách chỉ định ngôn ngữ của môi trường trong nhà cung cấp xem trước của bạn.

Nếu bạn muốn xem trước tất cả các chuỗi được bản địa hóa, bao gồm cả những chuỗi được tải bằng NSLocalizedString, bạn có thể thay đổi ngôn ngữ trong trình chỉnh sửa sơ đồ, như Kate sẽ chỉ cho bạn sau.

Tính năng mới trong Xcode 13, xuất dự án của bạn để bản địa hóa thực sự có thể xây dựng tất cả các mục tiêu để tìm các chuỗi có thể định vị.

Điều này có nghĩa là trong thực tế là Xcode có thể làm tốt hơn nhiều trong việc tìm kiếm nội dung có thể định vị và trích xuất nó để bản địa hóa.

Vì vậy, hãy tưởng tượng chúng ta có một số mã với một chuỗi nhiều dòng.

Bởi vì trình biên dịch hiện được sử dụng để trích xuất nội dung được bản địa hóa, chuỗi nhiều dòng này được phân tích cú pháp chính xác.

Bây giờ, hãy xem SwiftUI giúp bạn dễ dàng xây dựng các ứng dụng với bố cục thân thiện với bản địa hóa như thế nào.

Cũng giống như tra cứu chuỗi, các hành vi bố cục mặc định do SwiftUI cung cấp đã được thiết kế với mục đích bản địa hóa và trong hầu hết các trường hợp, không cần bất kỳ nỗ lực bổ sung nào từ phía bạn.

Ví dụ, khi thích hợp, các điều khiển với Văn bản sẽ bao bọc nó để nó không cắt hoặc cắt ngắn bằng các ngôn ngữ có nhãn dài hơn.

Trong trường hợp này, tên sinh tố được gói thành dòng thứ hai bằng tiếng Nga, bởi vì nó dài hơn.

Bố cục cũng được tự động lật cho các ngôn ngữ từ phải sang trái.

Bạn có thể thấy trong ảnh chụp màn hình rằng bố cục ô bảng đã được lật và các biểu tượng trong thanh tab cũng đã được phản chiếu khi thích hợp.

Và ngay cả khi bạn phải tùy chỉnh một cái gì đó để đi chệch khỏi mặc định, các tùy chọn chúng tôi cung cấp hướng dẫn bạn đến các giải pháp thân thiện với bản địa hóa, chẳng hạn như cung cấp căn chỉnh hàng đầu, thay vì trái, trong VStacks.

Tiếp theo, trong việc xây dựng các ứng dụng của bạn, bạn có thể thấy mình cần tạo kiểu cho Văn bản bản địa hóa được hiển thị trong giao diện người dùng của mình.

Để làm điều này dễ dàng hơn, chúng tôi đã giới thiệu khả năng tạo kiểu cho các chuỗi có thể định vị bằng cách sử dụng markdown.

Điều này đơn giản hóa đáng kể việc áp dụng kiểu dáng cho các chuỗi được bản địa hóa và cung cấp cho người dịch của bạn khả năng áp dụng kiểu dáng hợp lý cho ngôn ngữ của họ.

Ví dụ, tiếng Ả Rập không có khái niệm in nghiêng, vì vậy ngay cả khi bạn sử dụng trọng âm trong chuỗi tiếng Anh của mình, người dịch của bạn vẫn có thể sử dụng một cách xử lý khác, chẳng hạn như nhấn mạnh, trong bản dịch của họ.

Trong trường hợp này, dịch giả tiếng Nga của chúng tôi đã có thể áp dụng đánh dấu xung quanh các từ phù hợp nhất trong chuỗi để phù hợp với mục đích của mô tả tiếng Anh gốc.

Và trong khi sự hỗ trợ này tồn tại trong nền tảng, SwiftUI giúp bạn đặc biệt dễ dàng tận dụng lợi thế bằng cách chỉ cần chuyển các chuỗi được tạo kiểu trực tiếp đến các văn bản để hiển thị.

Bạn có thể tìm hiểu thêm về kiểu dáng Văn bản bằng cách xem "Có gì mới trong nền tảng" và các cuộc nói chuyện SwiftUI.

Một tình huống phổ biến khác mà bạn sẽ gặp phải trong các ứng dụng của mình là nhu cầu định dạng dữ liệu theo cách phù hợp với ngôn ngữ và khu vực.

Các API định dạng mới dễ sử dụng hơn và tích hợp chặt chẽ với Text và TextField sẽ cho phép bạn hoàn thành nhiệm vụ này.

Ở Fruta, chúng tôi hiển thị số lượng calo ở một số nơi trong giao diện người dùng.

Trước đây, chúng tôi phải tạo một trình định dạng đo lường để hiển thị các giá trị được định dạng, tương tự như những gì trên trang chiếu ở đây.

Bây giờ, chúng ta có thể chỉ định định dạng theo cách khai báo trực tiếp nội tuyến với nơi giá trị đang được hiển thị.

Điều này không chỉ dễ đọc hơn mà còn có thể hiệu quả hơn mã trên trang chiếu trước.

Bạn có thể tìm hiểu thêm về các API định dạng mới này trong bài nói chuyện "Có gì mới trong nền tảng".

Cuối cùng, hãy xem xét các phím tắt, cho phép người mới và người dùng thành thạo hoàn thành các tác vụ nhanh hơn, cả trên máy Mac và iPad của họ.

Mới trong macOS và iPadOS, bất kỳ phím tắt nào bạn xác định trong ứng dụng SwiftUI của mình giờ đây sẽ được tự động điều chỉnh để chúng có thể được nhập vào bố cục bàn phím hiện đang hoạt động của người dùng.

Ví dụ: nếu bạn muốn thêm sinh tố vào danh sách yêu thích của mình, bạn có thể nhập "Lệnh cộng" để làm như vậy.

Điều này hoạt động tốt trên bố cục của Hoa Kỳ, nơi tổ hợp yêu cầu chính xác hai lần nhấn phím, phím Command và phím cộng.

Tuy nhiên, nếu bạn đang sử dụng bố cục bàn phím tiếng Litva, việc đạt được phím cộng không hề dễ dàng như vậy.

Bạn phải nhấn phím đánh dấu ngược trước, sau đó nhấn "Shift bằng."

Tệ hơn nữa, sự kết hợp này thực sự không thể đánh máy được trong khi giữ phím Command.

Nhưng nhờ tính năng ánh xạ lại của macOS Monterey và iPadOS 15, khi bố cục bàn phím Litva đang hoạt động, phím tắt được thay đổi thành "Command ž" và người dùng của chúng tôi có thể thêm sinh tố vào mục yêu thích của họ bằng cách sử dụng phím tắt bất kể họ hiện đang sử dụng bố cục bàn phím nào.

Và đây là phần hay nhất, bạn với tư cách là nhà phát triển không cần phải làm bất cứ điều gì, nó chỉ hoạt động.

Và với điều đó, hãy để tôi chuyển nó cho Kate, người sẽ cho thấy những cải tiến mà chúng tôi đã thực hiện đối với quy trình bản địa hóa trong Xcode 13, cũng như giới thiệu một số phương pháp hay nhất và API mới mà tôi vừa đề cập.

Cảm ơn, Paul.

Xin chào, tôi là Kate, một kỹ sư trong nhóm Bản địa hóa.

Hãy nhảy vào để xem việc bản địa hóa ứng dụng SwiftUI dễ dàng như thế nào.

Ở đây chúng tôi có ứng dụng mẫu Fruta.

Chúng tôi muốn đảm bảo rằng mọi người trên khắp thế giới có thể gọi sinh tố bằng ngôn ngữ mẹ đẻ của họ.

Hôm nay, tôi sẽ thêm bản địa hóa tiếng Nga.

Vì vậy, trước tiên, tôi đi đến dự án trong trình điều hướng dự án, sau đó chọn "Fruta" trong trình chỉnh sửa dự án và trong tab Thông tin, tôi có thể thêm bản địa hóa.

Tất cả các bản địa hóa mà macOS đi kèm được liệt kê ở đây theo thứ tự bảng chữ cái.

Trong Xcode 12.5, chúng tôi đã thêm hàng trăm ngôn ngữ và biến thể khu vực khác trong menu con "Nhiều ngôn ngữ hơn" ở cuối danh sách.

Tôi sẽ chỉ chọn "tiếng Nga."

Như Paul đã đề cập, Xcode 13 đơn giản hóa rất nhiều việc trích xuất chuỗi từ mã Swift bằng cách sử dụng các công nghệ mới trong trình biên dịch Swift.

Fruta được viết bằng SwiftUI, vì vậy tôi muốn đảm bảo rằng cài đặt xây dựng "Sử dụng Trình biên dịch để trích xuất chuỗi Swift" được đặt thành "Có".

Điều này được bật theo mặc định cho các dự án Swift mới, nhưng bạn có thể chọn tham gia cài đặt này nếu dự án hiện tại của bạn sử dụng SwiftUI.

Khi tôi xuất để bản địa hóa, Xcode sẽ xây dựng tất cả các mục tiêu trong dự án của tôi và sử dụng thông tin loại trình biên dịch để trích xuất LocalizedStringKeys từ mã SwiftUI của tôi.

Trước khi xuất, tôi có thể sử dụng các ngôn ngữ giả trong SwiftUI Previews để xem chuỗi nào có thể định vị và chuỗi nào tôi đã bỏ lỡ.

Vì vậy, tôi sẽ vào trình chỉnh sửa sơ đồ và trong tab Tùy chọn, nhấp vào Ngôn ngữ ứng dụng.

Tất cả các ngôn ngữ được ứng dụng của tôi hỗ trợ đều được liệt kê ở đây ở trên cùng, nhưng tôi sẽ đi đến tận cùng và chọn Accented Pseudolanguage.

Ngôn ngữ giả có dấu thêm các dấu trọng âm khác nhau vào chuỗi nguồn của tôi trong giao diện người dùng.

Bây giờ, tôi có thể thấy rằng tất cả các thành phần đều được địa phương hóa giả.

Các phép đo không được bản địa hóa giả vì chúng được định dạng, nhưng StepperView lẽ ra phải được bản địa hóa giả.

Hãy làm cho chuỗi này có thể định vị được.

StepperView là một chế độ xem SwiftUI tùy chỉnh nhận chuỗi "nhãn" và chuyển nó xuống chế độ xem Văn bản.

Trong các chế độ xem SwiftUI tùy chỉnh yêu cầu bản địa hóa, chúng ta cần sử dụng LocalizedStringKey.

Hãy chắc chắn rằng nó được bản địa hóa giả ngay bây giờ.

Tuyệt vời!

Bây giờ chuỗi này có thể định vị được, chúng ta cần đảm bảo rằng nó xử lý số nhiều đúng cách.

Mã này hoạt động để số nhiều "smoothie" trong tiếng Anh, nhưng nó sẽ không hoạt động cho tất cả các từ và nó sẽ không hoạt động cho tất cả các ngôn ngữ.

Thay vào đó hãy sử dụng stringsdict.

Tệp stringsdict có thể cung cấp các bản dịch khác nhau cho một biến thể số nhiều trong một ngôn ngữ.

Để biết thêm thông tin về cách sử dụng stringsdict, hãy xem video "Hợp lý hóa chuỗi được bản địa hóa của bạn".

Tôi có một tệp được chuẩn bị ngay tại đây, vì vậy tôi sẽ kéo nó vào dự án của mình...

Và đánh dấu nó để bản địa hóa.

Bây giờ, hãy xuất để bản địa hóa.

Bắt đầu từ Xcode 12.5, bạn có thể xuất và nhập bản địa hóa cho các dự án và không gian làm việc trong menu Sản phẩm.

Vì vậy, tôi sẽ chỉ nhấp vào Xuất bản địa hóa và lưu nó vào màn hình nền.

Bây giờ, Xcode đang xây dựng dự án của tôi và sẽ tạo một Danh mục Bản địa hóa Xcode sẵn sàng để gửi cho Paul, người đã tình nguyện dịch nó sang tiếng Nga.

Bạn có thể tìm hiểu thêm về Danh mục bản địa hóa Xcode trong bài nói chuyện "Quy trình bản địa hóa mới trong Xcode 10" từ WWDC 2018.

Hãy kiểm tra kỹ những gì đã được xuất trước khi gửi nó đi để dịch.

Bắt đầu với Xcode 13, Danh mục bản địa hóa Xcode thậm chí còn thuận tiện hơn khi làm việc.

Tôi có thể chỉ cần nhấp đúp vào danh mục trong Finder và mở nó trong Xcode.

Điều này cực kỳ hữu ích nếu bạn đang bản địa hóa ứng dụng của riêng mình, xác minh chuỗi hoặc ảnh chụp màn hình trước khi gửi nội dung để bản địa hóa hoặc nếu sửa bản dịch cho các ngôn ngữ cụ thể.

Ở đây trong trình chỉnh sửa, tôi có thể thấy tất cả các tệp yêu cầu bản địa hóa.

Khi tôi chọn một tệp, tôi có thể thấy tất cả các chuỗi như trình dịch.

Chìa khóa, chuỗi nguồn, bản dịch và nhận xét.

Tôi sẽ lướt qua đây và xem mọi thứ có ổn không.

Ngay lập tức, tôi có thể thấy một vài vấn đề.

Đầu tiên, chúng tôi đã xuất chuỗi "%lf Calories".

Chuỗi đó nên được định dạng vì các vùng khác nhau sử dụng các đơn vị khác nhau để đo lượng calo.

Tôi sẽ cần thay đổi mã để khắc phục điều đó.

Ở đây trong NutritionFactView nơi chuỗi được trích xuất, thay vì một chuỗi, tôi có thể sử dụng phương pháp "định dạng" trong loại Đo lường của mình trên cấu trúc NutritionFacts của mình.

Tôi sẽ sử dụng định dạng rộng và đặt cách sử dụng thành "thực phẩm", vì chúng tôi đang đo lượng calo thực phẩm.

Điều này sẽ đảm nhận việc định dạng các đơn vị cho tất cả các khu vực.

Đó là một sửa chữa dễ dàng.

Hãy quay lại xem lại các chuỗi của tôi.

Ồ, người dịch không thấy tên biến, vì vậy một chuỗi như "Mua công thức cho %@" có thể gây nhầm lẫn.

Tôi đang mua một công thức với một mức giá nhất định, hay tôi đang tặng nó cho một người bạn?

Hãy xem liệu có bất kỳ chuỗi mơ hồ nào khác không.

"Yêu thích" có một bình luận nói rằng đó là một động từ, nhưng tôi nên thêm một bình luận vào "Yêu thích" để rõ ràng đó là một danh từ.

Tôi sẽ thêm nhận xét bằng mã cho cả hai thứ đó.

Trước tiên hãy xử lý chuỗi "Mua công thức cho".

Vậy là xong.

Chuỗi "Yêu thích" nằm trong các mục thanh tab của tôi, vì vậy hãy thêm nhận xét cho nó.

Các mục thanh tab là chế độ xem Nhãn.

Trong SwiftUI, để thêm nhận xét, tôi cần khởi tạo Nhãn với chế độ xem Văn bản.

Thêm các nhận xét như thế này thực sự quan trọng để đảm bảo bản địa hóa chất lượng cao.

Tôi không muốn các dịch giả của mình bối rối và phải đoán xem ý tôi là gì.

Được rồi, tôi nghĩ tôi đã sửa mọi thứ.

Đã đến lúc xuất một danh mục mới và gửi nó cho Paul.

Chà, điều đó thật nhanh.

Paul là Apple Silicon của các dịch giả!

Chúng ta hãy xem nhanh những gì anh ấy đã gửi lại.

Ở đây, tôi có thể xem tất cả các bản dịch.

Có stringsdict cho bước sinh tố mà tôi đã thêm vào.

Có vẻ ổn. Hãy nhập cái này và xem ứng dụng trông như thế nào bằng tiếng Nga.

Để nhập, tôi chỉ cần vào menu Sản phẩm, nhấp vào Nhập bản địa hóa, và sau đó chọn Danh mục từ Paul.

Tất cả các chuỗi của tôi nên được bản địa hóa ngay bây giờ.

Hãy xây dựng và chạy ứng dụng bằng tiếng Nga cho macOS.

Đầu tiên, tôi sẽ thay đổi sơ đồ thành macOS, và sau đó tôi có thể thay đổi ngôn ngữ sang tiếng Nga.

Được rồi, hãy chạy nó.

Chà, ứng dụng trông tuyệt vời bằng tiếng Nga, và tất cả các loại sinh tố đều trông rất ngon.

Tôi có thể thấy các thành phần và tất cả giá trị dinh dưỡng cho tất cả chúng.

Tôi nghĩ tôi thực sự sẽ đặt cái này.

Chà, thật là một dịch vụ tuyệt vời.

Bản địa hóa trong SwiftUI được thiết kế để dễ dàng, vì vậy bạn có thể tập trung vào việc viết mã.

Đây là một số điểm chính cần ghi nhớ khi bạn phát triển ứng dụng của mình.

LocalizedStringKey là một loại đặc biệt báo hiệu SwiftUI tra cứu các chuỗi được bản địa hóa trong gói của bạn.

Sử dụng nó trong các chế độ xem SwiftUI tùy chỉnh để làm cho chúng sẵn sàng cho bản địa hóa.

Bật cài đặt xây dựng "Sử dụng Trình biên dịch để trích xuất chuỗi Swift" để trích xuất LocalizedStringKeys từ mã khi xuất để bản địa hóa trong Xcode.

Định dạng chuỗi của bạn để quốc tế hóa mã của bạn và tạo kiểu cho chúng bằng Markdown.

Sử dụng Văn bản để thêm nhận xét cho ngữ cảnh dịch bổ sung.

Cảm ơn vì đã xem, và tận hưởng phần còn lại của WWDC!

[Âm nhạc].