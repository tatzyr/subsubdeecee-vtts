10259

♪ ♪

Xin chào.

Tên tôi là Kasia Wawer.

Tôi là một kỹ sư trong nhóm Giao diện người dùng Bàn phím, và hôm nay, tôi sẽ là người hướng dẫn bạn về thế giới tuyệt vời của bố cục bàn phím.

Tôi vô cùng hào hứng được nói chuyện với bạn hôm nay về việc đưa bàn phím từ quá khứ dựa trên khung hình vào một tương lai bố cục tự động.

Chúng ta sẽ bắt đầu chuyến tham quan của mình bằng cách nói về hướng dẫn viên mới.

Sau đó, chúng tôi sẽ xem xét một số điều mới mà bạn có thể làm để tích hợp bàn phím đầy đủ hơn vào bố cục của mình.

Và cuối cùng, chúng ta sẽ nói về bàn phím thực sự là gì - nói về mặt triết học, các loại bàn phím cần xem xét và một số trường hợp bạn có thể không nghĩ đến ngay lập tức.

Vì vậy, hãy bắt đầu với chuyến tham quan của chúng ta.

Cũng như nhiều thứ, điều này bắt đầu từ quá khứ cổ đại.

Nếu bạn đã từng làm việc với bàn phím trong ứng dụng của mình trước đây, bạn biết cách nó được xử lý từ thời xa xưa là bằng cách đăng ký thông báo, lấy các phần bù và hoạt ảnh thích hợp từ thông tin trong thông báo, thực hiện một số phép toán và cuối cùng, sử dụng nó để điều chỉnh bố cục của bạn.

Bây giờ, các thông báo đang ở xung quanh.

Chúng tôi không phản đối họ.

Bạn có thể tìm hiểu thêm về chúng, nếu bạn quan tâm, trong "Chìa khóa để trải nghiệm nhập văn bản tốt hơn" từ năm 2017.

Hãy xem xét một ví dụ nhanh về cách thông báo có thể được sử dụng với hướng dẫn tùy chỉnh.

Bây giờ, đừng sao chép bất kỳ mã nào trong số này vì chúng tôi sắp thay thế nó.

Nhưng đây là cách bạn xử lý bàn phím trước iOS 15.

Bạn sẽ tạo hướng dẫn tùy chỉnh và neo của mình để phản hồi các thông báo.

Sau đó, bạn sẽ đăng ký các thông báo thích hợp.

Thông thường, ít nhất sẽ Hiển thị và sẽ Ẩn, nhưng đôi khi khung hình thay đổi, v.v.

Sau đó, bạn sẽ phản hồi các thông báo đã nói bằng cách lấy thông tin khung từ thông báo, đảm bảo rằng bạn đang điều chỉnh chế độ xem của riêng mình và hướng dẫn khu vực an toàn, nếu bàn phím rời khỏi màn hình.

Và bạn sẽ nhận được thông tin hoạt hình từ thông báo và cuối cùng, thay đổi hướng dẫn của bạn để khớp.

Bây giờ, nó không phải là một tấn, nhưng nó có thể trở nên phức tạp nhanh chóng.

Hôm nay, tôi vui mừng thông báo một bổ sung hoàn toàn mới cho bộ sưu tập bố cục tự động: Hướng dẫn bố cục bàn phím giao diện người dùng.

Bây giờ, hãy cố gắng hạn chế sự phấn khích của bạn khi chúng ta đi sâu vào vấn đề này.

Hướng dẫn bố trí bàn phím hoàn toàn mới trong iOS 15.

Đó là một hướng dẫn bố cục.

Bạn có thể hạn chế các chế độ xem và hướng dẫn trong bố cục hiện tại của mình đối với nó.

Nếu bạn không quen thuộc với hướng dẫn bố cục, hướng dẫn bố cục là một cách để thể hiện không gian trong bố cục mà không cần sử dụng chế độ xem.

Nó có tất cả các mỏ neo giống nhau như một khung cảnh.

Hướng dẫn bố cục bàn phím sẽ đại diện cho không gian mà bàn phím chiếm trong ứng dụng của bạn để bố cục của bạn có thể giải thích cho nó.

Và thế là xong!

Chủ yếu.

Hãy nói về việc cập nhật mã mà chúng ta vừa thấy để sử dụng cái này thay thế.

Đây là mã thông báo đó.

Đừng sao chép nó, hãy đợi dấu kiểm màu xanh lá cây.

Vì vậy, bây giờ bạn có thể tiếp tục và xóa neo mà bạn đang theo dõi.

Và thay đổi từ hướng dẫn bố cục của bạn sang hướng dẫn bố cục bàn phím của chế độ xem.

Và chúng tôi không cần đăng ký thông báo nữa.

Và chúng tôi cũng không cần phải trả lời họ.

Và thế là xong.

Tất cả mã đó tập trung vào dòng duy nhất này.

Sẵn sàng để xem nó hoạt động chưa?

Đây là những gì nó trông giống như để hiển thị bàn phím khi sử dụng mã thông báo.

Và đây là những gì nó trông giống như khi đưa nó lên bằng cách sử dụng hướng dẫn.

Bạn có thể nhận thấy rằng, ngoài bản địa hóa của chúng, chúng trông gần như giống hệt nhau, nhưng đó là vấn đề.

Bạn không cần phải làm nhiều như vậy, và bạn cũng nhận được kết quả tương tự.

Vì vậy, hãy nói về việc cập nhật hướng dẫn.

Đó là một tài sản trên chế độ xem giao diện người dùng.

Và, đối với hầu hết các trường hợp, bạn sẽ chỉ cập nhật để sử dụng topAnchor của hướng dẫn.

Hướng dẫn phù hợp với hoạt ảnh bàn phím, như đưa lên và loại bỏ, và nó cũng tuân theo sự thay đổi chiều cao.

Bởi vì đôi khi bàn phím cao hơn, và đôi khi nó ngắn hơn.

Nhưng hướng dẫn sẽ thích nghi để phù hợp với bất kỳ kích thước nào xuất hiện.

Và, khi bàn phím được tháo ra, theo mặc định, hướng dẫn sẽ rơi xuống cuối màn hình và là chiều rộng của cửa sổ của bạn, và bất cứ thứ gì bạn đã gắn với neo trên cùng sẽ theo sau.

Nó tính đến các khu vực an toàn, vì vậy bạn cũng không phải lo lắng về điều đó nữa.

Đối với các mục đích sử dụng cơ bản, đó có lẽ là tất cả những gì bạn cần biết.

Nhưng bây giờ chúng ta có thể nói về những thứ thú vị.

Tại sao chúng ta lại chọn sử dụng một lớp học mới mà không chỉ là một hướng dẫn bố cục thông thường?

Chà, chúng tôi muốn bạn có thể làm được nhiều hơn những gì bạn từng làm với bàn phím.

Điểm dừng tiếp theo của chúng tôi là tích hợp bàn phím đầy đủ vào ứng dụng của bạn.

Tại sao tôi lại nói "tích hợp"?

Chà, tôi thường nghe mọi người nói về bàn phím như một thứ họ cần tránh, hoặc như một cái gì đó chiến đấu với bố cục của họ, nhưng bàn phím là một phần của ứng dụng của bạn.

Một trong những động lực chính đằng sau hướng dẫn bố cục bàn phím giao diện người dùng là cung cấp cho bạn, nhà phát triển, khả năng phản hồi nhiều cách khác nhau mà chúng tôi có để người dùng nhập văn bản và cho phép bạn thực sự, suy nghĩ đầy đủ về bàn phím như một phần của bố cục của bạn theo cách mà có lẽ bạn chưa từng có trước đây.

Tôi thực sự vui mừng khi thấy cách bạn tận dụng những tính năng mới này.

Vậy, điểm dừng tiếp theo của chúng tôi, điều gì làm cho hướng dẫn bố cục bàn phím không chỉ là hướng dẫn bố cục?

Với hướng dẫn bố cục bàn phím UI, bạn có khả năng theo dõi hoàn toàn bàn phím trong tất cả các hóa thân của nó, nếu bạn chọn, bằng cách sử dụng một thuộc tính mới: followsUndockedKeyboard.

Theo mặc định, nó sai, nhưng nếu bạn đặt nó thành true, hướng dẫn sẽ theo bàn phím khi nó được tháo hoặc nổi, cho bạn nhiều quyền kiểm soát cách bố cục của bạn phản hồi với bất cứ nơi nào bàn phím có thể.

Không còn tự động thả xuống đáy nữa.

Không nghe thông báo ẩn bàn phím khi mở khóa.

Hướng dẫn bố cục là nơi có bàn phím.

Tuy nhiên, vấn đề về việc có thông tin đó là điều đó có nghĩa là bạn phải ý thức hơn rất nhiều về cách bố cục của bạn phản ứng với các loại bàn phím khác nhau.

Vì vậy, hướng dẫn bố trí bàn phím UI là một lớp con của một hướng dẫn bố cục mới khác: Hướng dẫn bố cục theo dõi giao diện người dùng.

Chúng tôi gọi nó là hướng dẫn bố cục theo dõi vì nó theo dõi các ràng buộc bạn muốn thay đổi khi nó di chuyển xung quanh màn hình.

Bạn có thể cung cấp cho nó một mảng các ràng buộc kích hoạt khi ở gần một cạnh cụ thể và hủy kích hoạt khi rời khỏi nó và/hoặc một mảng kích hoạt khi cụ thể awayFrom một cạnh và hủy kích hoạt khi ở gần nó.

Hãy xem xét một ví dụ về những gì bạn có thể làm với điều này và mã bạn cần để đạt được nó.

Đây là một ứng dụng thử nghiệm.

Tôi có một trường văn bản và một số điều khiển có thể nằm trên bàn phím.

Nhưng, khi nó đến gần đầu màn hình, tôi muốn chúng rơi xuống phía dưới để tránh bị tắt màn hình.

Và khi bàn phím di chuyển từ bên này sang bên kia, tôi muốn phần còn lại của giao diện người dùng thay đổi một chút để cho nó thêm một chút không gian.

Vậy, tất cả những điều này đã được hoàn thành như thế nào?

Chúng ta sẽ xem xét một số mã ở đây.

Trong các trang trình bày sau, editView là chế độ xem với trường văn bản và các điều khiển, và imageView là chế độ xem hình ảnh.

Được rồi, lưu ý rằng chúng ta nên sử dụng số nhận dạng ở đây và bạn sẽ thấy điều đó trong mã mẫu, nhưng điều này phù hợp hơn trên trang chiếu.

Hãy bắt đầu với những gì đang xảy ra trên trục dọc.

Đầu tiên, chúng tôi xác định một mảng liên kết phần dưới cùng của editView với phần trên cùng của hướng dẫn bố cục bàn phím.

Sau đó, chúng tôi đặt chúng thành hoạt động chỉ khi hướng dẫn cách xa đầu, để chúng sẽ bị vô hiệu hóa khi nó ở gần nó.

Sau đó, chúng tôi xác định một mảng các ràng buộc riêng biệt mà chúng tôi muốn khi bàn phím đến gần đỉnh của chế độ xem.

Vì vậy, thay vì phần trên cùng của hướng dẫn bố cục bàn phím, chúng tôi sử dụng phần dưới của khu vực an toàn.

Đây là một hình ảnh nhanh để trợ giúp.

Đây là hướng dẫn và editView.

Nó hiện đang ở xa đỉnh, vì vậy các ràng buộc awayFromTop đang hoạt động.

Nhưng, khi bạn di chuyển hướng dẫn đến gần đỉnh hơn, các ràng buộc awayFrom bị vô hiệu hóa và nearTopConstraints được kích hoạt, thả nó xuống dưới cùng của chế độ xem.

Khi chúng ta quay trở lại khỏi đỉnh cao, điều ngược lại sẽ xảy ra.

Bây giờ, hãy nhìn vào chuyển động ngang.

Khi bàn phím cách xa cả hai cạnh đầu và cạnh sau, tôi muốn editView ở trung tâm của bàn phím.

Tôi cũng muốn chế độ xem hình ảnh được căn giữa trong chế độ xem.

Vì vậy, tôi xác định những ràng buộc đó và đặt chúng hoạt động khi tôi tránh xa cả dẫn đầu và theo dõi.

Bây giờ, hãy thiết lập những gì sẽ xảy ra khi chúng ta tiếp cận một lợi thế.

Tôi muốn editView chuyển sang cuối khi chúng ta ở rìa sau và dẫn đến dẫn đến dẫn đầu.

Vì vậy, trước tiên, hãy quan tâm đến điều đó.

Tôi muốn imageView di chuyển ra khỏi bàn phím một chút, vì vậy khi chúng ta ở gần một trong hai cạnh, tôi di chuyển nó từ trung tâm sang phía đối diện từ bàn phím, dẫn đến dẫn đầu khi bàn phím ở cạnh sau và ngược lại.

Sau đó, tôi chỉ đặt những thứ này để hoạt động khi tôi ở gần rìa thích hợp.

Chúng sẽ được kích hoạt khi bàn phím đi vào khu vực đó và bị vô hiệu hóa khi nó rời đi.

Và thế là xong!

Tích hợp bàn phím siêu tiên tiến vào bố cục của riêng bạn.

Chúng ta hãy xem nó trông như thế nào một lần nữa.

Đây là editView của tôi.

Nó ở lại với bàn phím nổi, và khi chúng ta di chuyển về phía trên, nó rơi xuống phía dưới.

Và khi chúng ta di chuyển từ bên này sang bên kia, những điều chỉnh mà chúng ta vừa nói đến sẽ xảy ra.

Khá tuyệt!

Tiếp theo, hãy nói về ý nghĩa của "gần" và "awayFrom" đối với bàn phím.

Một bàn phím được gắn vào được coi là ở gần phía dưới và cách xa các cạnh khác.

Bàn phím không có đầu nối và tách rời có thể tránh xa tất cả các cạnh, hoặc chúng có thể đến gần cạnh trên.

Khi đó là bàn phím nổi, nó có thể ở gần hoặc xa bất kỳ cạnh nào, và thậm chí nó có thể ở gần hai cạnh liền kề cùng một lúc.

Điều này có thể dẫn đến một số xung đột thú vị tiềm tàng mà bạn nên biết.

Bây giờ, tất cả những điều này chỉ áp dụng khi bạn đặt followsUndockedKeyboard thành true và trong phần còn lại của cuộc nói chuyện, đó là giả định mà chúng tôi sẽ đưa ra.

Được rồi. Đoạn cuối cùng: cân nhắc để tích hợp bàn phím đầy đủ.

Bàn phím là bàn phím là bàn phím-- cho đến khi nó không.

Khi bạn chọn làm theo bàn phím không có đầu nối, bạn có thêm một số điều cần suy nghĩ.

Vậy, bạn nên chú ý đến những thứ gì khi thiết kế bố cục của mình?

Luôn nhớ rằng bàn phím nổi có thể biến mất khỏi mọi thứ.

Bạn có đủ thông tin để được trình bày chính xác nếu nó biến mất Từ tất cả các cạnh không?

Ngoài ra, điều gì sẽ xảy ra khi bàn phím ở xa cạnh dưới hoặc gần cạnh trên?

Bạn cũng muốn cẩn thận với những gì được gắn với phần trên cùng của bàn phím.

Bởi vì nó có thể lên đó!

Vì vậy, hãy cẩn thận.

Cách để giải quyết điều đó là đặt các ràng buộc khi bàn phím ở xa Từ cạnh dưới di chuyển các chế độ xem đó ra khỏi phía trên Trang phục của bàn phím và xuống dưới cùng của SafeAreaLayoutGuide.

Người dùng cũng có thể di chuyển bàn phím bất cứ lúc nào, vì vậy bạn không thể tin rằng nó là bất kỳ nơi cụ thể nào.

Bạn cũng sẽ muốn ghi nhớ điều đó.

Đây là một mẫu vật hiếm: bàn phím tách rời.

Bàn phím tách rời và không có đầu nối rời khỏi tất cả các cạnh, cho đến khi nó đến quá gần đỉnh.

Như với bàn phím được gắn vào, nó luôn tránh xa việc dẫn đầu và theo dõi.

Hãy nói về một số thứ mới.

Có một cách mới để đưa văn bản vào ứng dụng của bạn trong năm nay, sử dụng máy ảnh.

Nó vẫn là một bàn phím, vì vậy nó vẫn có thể sử dụng hướng dẫn.

Nó giống như một bàn phím được gắn vào thông thường, nhưng nó là một trong số ít bàn phím có thể có khá nhiều toàn màn hình.

Để tìm hiểu thêm về việc tận dụng đầu vào văn bản qua máy ảnh trong năm nay, hãy điều chỉnh "Sử dụng máy ảnh để nhập bàn phím trong ứng dụng của bạn."

Tiếp tục với những điều mới, còn khi có một bàn phím phần cứng được gắn vào thì sao?

Chà, mới trong năm nay, chúng tôi có một thanh phím tắt thích ứng không còn luôn có chiều rộng đầy đủ nữa.

Nó thay đổi chiều rộng dựa trên ngôn ngữ bạn đang sử dụng và có bao nhiêu nút trong thanh.

Trước đây, nó luôn là chiều rộng đầy đủ của màn hình, nhưng bây giờ, nếu bạn đang theo dõi bàn phím không có bến, bạn thực sự có thể sử dụng các cạnh đầu và cuối thực sự của thanh.

Vậy, câu chuyện ở đây với các cạnh là gì?

Cái này luôn ở gần phía dưới và, ở vị trí bình thường của nó, nó cách xa ba cạnh còn lại.

Nhưng nó có thể thu gọn được!

Nếu bạn thu gọn nó, nó cũng có thể ở gần cạnh trước hoặc cạnh sau.

Nhân tiện, đây là một trong nhiều lý do tại sao bạn có thể muốn cẩn thận khi sử dụng chiều rộng của bàn phím.

Nó có thể rất nhỏ, hoặc nó có thể là toàn bộ chiều rộng của màn hình.

Bây giờ, hãy tham gia vào phần thú vị nhất của chuyến tham quan: nếu bạn không phải là ứng dụng duy nhất trên màn hình và bạn đang theo dõi bàn phím không có đầu nối thì sao?

Đầu tiên, hãy nhớ rằng bàn phím có thể rời khỏi không gian ứng dụng của bạn.

Khi điều đó xảy ra, chúng tôi sẽ đối xử với nó như thể nó đã bị loại bỏ.

Thứ hai, khi ứng dụng của bạn ở mức hẹp nhất, các cạnh trên và dưới đang hoạt động, nhưng đầu và cuối sẽ tránh xa, cho dù bàn phím có ở trên ứng dụng của bạn hay không.

Ngoài ra, hướng dẫn có kích thước cho phần nào của bàn phím trên cửa sổ ứng dụng của bạn, nếu bạn không phải là thứ duy nhất trên màn hình.

Hãy cùng xem một số hình ảnh để cho bạn thấy ý tôi là gì.

Tất cả những điều này chỉ áp dụng nếu bạn đã đặt followsUndockedKeyboard thành true.

Nếu bạn chưa có, hướng dẫn nằm ở cuối màn hình, toàn bộ chiều rộng cửa sổ của bạn.

Khi bạn ở chế độ toàn màn hình và bàn phím nổi và ở giữa, bạn sẽ rời xa mọi thứ.

Tất cả các ràng buộc awayFrom của bạn đã được kích hoạt và tất cả các ràng buộc gần của bạn đã bị vô hiệu hóa.

Khi một ứng dụng khác xuất hiện trên màn hình, nếu bạn là ứng dụng rộng hơn, bạn vẫn đủ rộng để bàn phím có thể tránh xa mọi thứ.

Nhưng nó cần phải di chuyển ít hơn để ở gần một cạnh nằm ngang.

Điều này cũng tương tự như ở trong chân dung.

Nhưng, ở nửa màn hình, bàn phím ở cùng một vị trí hiện đang ở gần cạnh trước của bạn và hướng dẫn đã có kích thước để chỉ khớp với phần bàn phím trên ứng dụng của bạn.

Khi bạn là ứng dụng hẹp, hướng dẫn luôn được coi là xa Các cạnh ngang, giống như iPhone hoặc bàn phím có đế, nhưng bạn vẫn có thể ở gần cạnh trên.

Và lưu ý rằng, một lần nữa, hướng dẫn chỉ có kích thước để tính đến phần trên ứng dụng của bạn.

Và khi bạn gắn bàn phím và nó có kích thước đầy đủ trở lại, nó cũng cách xa đầu, cuối và đầu.

Và lưu ý, một lần nữa, rằng hướng dẫn bố cục một lần nữa có kích thước cho những gì trên ứng dụng của bạn.

Nếu bạn là một ứng dụng trượt qua, nó cũng sẽ thay đổi kích thước cho điều đó.

Với các ví dụ trước và mã demo của chúng tôi, tất cả điều này sẽ được xử lý tốt.

Bạn chỉ cần nhớ rằng bạn có thể ở trong bất kỳ một trong những tình huống này.

Bây giờ bạn nên sẵn sàng đưa ứng dụng của mình lên cấp độ tích hợp bàn phím tiếp theo.

Vì vậy, hãy sử dụng hướng dẫn bố cục bàn phím.

Nếu ứng dụng của bạn có thể, hãy tận dụng các tính năng nâng cao của hướng dẫn bố cục theo dõi giao diện người dùng.

Và, quan trọng nhất, nếu bạn đã nghĩ về bố cục bàn phím như chiến đấu hoặc tránh bàn phím, hãy bắt đầu suy nghĩ về việc tích hợp nó vào bố cục của bạn thay thế.

Và nếu bạn đã suy nghĩ về nó theo cách đó, bây giờ bạn thậm chí còn có nhiều công cụ hơn để hiện thực hóa toàn bộ tầm nhìn của mình.

Điều đó đưa chúng tôi đến cuối chuyến tham quan của mình.

Vui lòng đảm bảo rằng bạn có tất cả các vật dụng cá nhân của mình trước khi ra ngoài, đừng quên ghé thăm cửa hàng quà tặng và có một WWDC tuyệt vời.

[Nhạc gõ ethereal].