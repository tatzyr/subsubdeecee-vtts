10298

Xin chào mọi người!

Chào mừng đến với phiên WWDC21 của chúng tôi, "Thêm hỗ trợ cho Matter trong ứng dụng nhà thông minh của bạn."

Tôi là Selina từ Home Engineering.

Hôm nay, đồng nghiệp của tôi, Chris, Sagar và tôi sẽ hướng dẫn bạn các tính năng thú vị mà chúng tôi đã thêm vào năm nay để hỗ trợ Matter.

Như đã đề cập trong bài phát biểu hôm thứ Hai, Matter là một tiêu chuẩn mới cho các phụ kiện nhà thông minh đang được phát triển bởi Apple và các nhà lãnh đạo ngành khác để đảm bảo rằng tất cả các phụ kiện nhà thông minh hoạt động cùng nhau một cách liền mạch trong tương lai.

Tầm nhìn của nó là dân chủ hóa tự động hóa nhà trên toàn thế giới, giúp mọi người có thể bắt đầu xây dựng nhà thông minh và sau đó tiếp tục bổ sung chúng trong nhiều năm tới.

Giao thức Matter đang được phát triển như một nỗ lực nguồn mở thúc đẩy các công nghệ đã được chứng minh, bao gồm HomeKit, đảm bảo rằng nó sẽ hỗ trợ số lượng thiết bị nhà thông minh rộng nhất và sau đó giúp các nhà sản xuất dễ dàng bắt đầu tích hợp nó vào các sản phẩm của họ.

Sử dụng Matter, các nhà sản xuất phụ kiện nhà thông minh không còn cần hỗ trợ song song nhiều giao thức, thực sự đơn giản hóa nỗ lực phát triển của việc tạo ra một sản phẩm và hỗ trợ nó trên cơ sở liên tục.

Nó cũng mang đến cho các nhà phát triển ứng dụng cơ hội tập trung vào việc phát triển trải nghiệm ứng dụng tốt nhất cho khách hàng của họ, mà không phải tạo và sau đó duy trì các giao thức độc quyền.

Bằng cách tạo ra một giao thức thống nhất như vậy cho các phụ kiện, khách hàng có thể dễ dàng tận hưởng những tiện nghi của một ngôi nhà thông minh và sau đó tự tin mang sản phẩm vào nhà của họ, biết rằng tất cả họ sẽ làm việc cùng nhau.

Nó sẽ cho phép mọi người lựa chọn nhiều phụ kiện hơn trong các cửa hàng, và sau đó các nhà xây dựng ở khắp mọi nơi sẽ có thể lắp đặt chúng theo tiêu chuẩn trong nhà.

Được thúc đẩy bởi những điều này, chúng tôi muốn các nhà phát triển của mình có thể sử dụng Matter sớm nhất trong quá trình phát triển phụ kiện và ứng dụng của bạn.

Chúng tôi rất vui khi cho bạn biết rằng sự hỗ trợ cho Matter đang đến trong iOS, iPadOS và tvOS 15 dưới dạng bản xem trước dành cho nhà phát triển.

Có rất nhiều tính năng tuyệt vời mà chúng tôi muốn giới thiệu với bạn hôm nay.

Đầu tiên và sau đó quan trọng nhất, hãy nói về cách bạn có thể tích hợp với các phụ kiện Matter thông qua HomeKit.

Ngày nay, một phụ kiện triển khai Giao thức Phụ kiện HomeKit tích hợp với Apple Home thông qua khung HomeKit.

Trong những năm qua, chúng tôi đã xây dựng các tính năng tuyệt vời trên HomeKit cung cấp toàn quyền kiểm soát và sau đó là quản lý các phụ kiện HAP.

Khi chúng tôi xem xét việc tích hợp các phụ kiện Matter với Apple Home, chúng tôi tự nhiên đi đến kết luận rằng chúng tôi có thể mở rộng trách nhiệm của khung HomeKit để hỗ trợ Matter như một giao thức song song.

Về mặt kiến trúc, điều này có nghĩa là HomeKit gọi vào việc triển khai Matter nguồn mở, được gọi là khung CHIP, để giao tiếp với các phụ kiện Matter.

Đối với ngữ cảnh của bạn, tên trước đó cho dự án Matter là Connected Home qua IP, hay nói tóm lại là CHIP.

Đó là lý do tại sao, trong suốt buổi nói chuyện hôm nay, bạn vẫn sẽ thấy tài liệu tham khảo của CHIP, cả trong dự án nguồn mở và API của chúng tôi.

Chúng tôi hy vọng sẽ cập nhật tên cho các API trong bản phát hành sau.

Quay lại chủ đề chính của chúng tôi, sự đóng gói được cung cấp bởi HomeKit cho phép tất cả các tính năng hiện có của Apple Home bắt đầu hoạt động với các phụ kiện Matter một cách liền mạch và ngay lập tức.

Ví dụ: thiết lập phụ kiện Matter bằng cách sử dụng các luồng giống hệt nhau để thiết lập phụ kiện HAP, điều khiển các phụ kiện Matter trong Trung tâm điều khiển chỉ bằng một lần vuốt xuống và tích hợp rảnh tay tuyệt vời với Siri cho trạng thái phụ kiện Matter và sau đó điều khiển trên tất cả các thiết bị Apple của bạn.

Nhưng trách nhiệm của HomeKit không chỉ là hỗ trợ các tính năng của bên thứ nhất.

Trên thực tế, kể từ ngày 1, chúng tôi đã thiết kế HomeKit với tầm nhìn rằng các nhà phát triển ứng dụng sẽ có thể tận dụng HomeKit để xây dựng các ứng dụng nhà thông minh sáng tạo và sau đó thú vị cho khách hàng của họ, mà không phải chịu gánh nặng triển khai các giao thức giao tiếp với các phụ kiện.

Điều này tiếp tục đúng với các phụ kiện Matter.

Tiếp tục sử dụng các API hiện có như bạn đã sử dụng trong HomeKit.

Tất cả họ sẽ bắt đầu làm việc với các phụ kiện Matter, không cần thay đổi mã.

Hãy lấy thiết lập phụ kiện làm ví dụ.

Mã này cho thấy cách bạn có thể gọi addAndSetupAccessories API trong ứng dụng HomeKit của bạn ngay hôm nay.

Với bản xem trước dành cho nhà phát triển iOS 15, trình quét mã QR mà bạn gọi bởi API này sẽ không chỉ hoạt động cho mã QR HAP mà còn bắt đầu nhận dạng mã QR Matter, cung cấp cho khách hàng của bạn trải nghiệm quen thuộc và nhất quán để thiết lập phụ kiện.

Để có một chút niềm vui, những người trong số các bạn đã chú ý đến các bản cập nhật Swift năm nay biết rằng có một sự thay đổi đang diễn ra trong thế giới đồng thời Swift.

Chúng tôi rất vui khi cho bạn biết rằng các API tương tự mà bạn đã quen bây giờ cũng có thể được gọi thông qua mô hình Swift async/await mới.

Bên cạnh việc thiết lập, với bản xem trước dành cho nhà phát triển iOS 15, bạn cũng sẽ có thể sử dụng các API HomeKit hiện có để đọc và ghi các trạng thái phụ kiện Matter.

Hơn nữa, bạn sẽ tự động nhận được quyền truy cập từ xa và thông báo kịp thời cho các phụ kiện Matter, sau đó có thể thêm và chỉnh sửa các phụ kiện Matter bằng cách sử dụng API cảnh và tự động hóa, tất cả đều giống như những gì bạn làm với các phụ kiện HAP.

Chúng ta cũng hãy lén lút trong tương lai.

Khi dự án Matter tiếp tục phát triển, chúng tôi hy vọng nó sẽ cung cấp hỗ trợ cho ngày càng nhiều danh mục phụ kiện.

Chúng tôi sẽ tiếp tục tích hợp các danh mục phụ kiện Matter mới này vào HomeKit, giúp các nhà phát triển của chúng tôi dễ dàng sử dụng chúng.

Thứ hai, HAP, như một giao thức, hỗ trợ các đặc điểm tùy chỉnh.

Nó cho phép các nhà sản xuất xây dựng các tính năng tùy chỉnh sáng tạo với các phụ kiện của họ và truy cập chúng thông qua HomeKit.

Vấn đề, như một giao thức, cũng hỗ trợ các tính năng tùy chỉnh.

Vì vậy, chúng tôi muốn kết nối các dấu chấm ở đây và sau đó cung cấp cho bạn quyền truy cập vào các tính năng tùy chỉnh Matter thông qua khung HomeKit.

Tính năng này sẽ ra mắt trong bản phát hành sau, vì vậy hãy theo dõi và cho chúng tôi biết nếu bạn có suy nghĩ sớm.

Tóm lại, chúng tôi cam kết tích hợp liền mạch Matter với HomeKit.

Cho dù bạn là nhà phát triển phụ kiện, nhà phát triển ứng dụng HomeKit hay khách hàng của HomeKit, hãy yên tâm, như Matter "Just Works".

Khi bạn sử dụng HomeKit để tích hợp với các phụ kiện Matter, bạn sẽ nhận được các tính năng như điều khiển từ xa được bảo mật và tự động hóa miễn phí, nhờ vào sức mạnh và trí thông minh của các trung tâm nhà thông minh của Apple, chẳng hạn như HomePod và Apple TV.

Nhưng nếu bạn cũng có nhu cầu giúp khách hàng của mình kết nối các phụ kiện Matter với các trung tâm nhà thông minh khác trong nhà của bạn, chúng tôi cũng sẽ giúp bạn dễ dàng làm điều đó từ ứng dụng iOS của mình.

Tiếp theo, tôi sẽ chuyển cho Chris để nói với bạn nhiều hơn về nó.

Cảm ơn bạn, Selina.

Đối với bản xem trước dành cho nhà phát triển năm nay, chúng tôi đang xây dựng một API thiết lập mới nhưng quen thuộc về mặt khái niệm cho phép bạn thiết lập kết nối trực tiếp giữa phụ kiện Matter và trung tâm gia đình của bạn.

Hãy bắt đầu bằng cách khám phá trải nghiệm người dùng.

Như bạn có thể thấy ở đây, dòng chảy này rất giống với cách chúng tôi thiết lập cả sản phẩm Apple và phụ kiện HomeKit ngày nay.

Chúng tôi biết khách hàng của chúng tôi đã quen thuộc với dòng chảy này, chúng tôi biết họ yêu thích nó và chúng tôi cũng muốn bạn hưởng lợi từ nó.

Điều quan trọng cần lưu ý ở đây là mặc dù đây là giao diện người dùng hệ thống, nhưng những ngôi nhà và phòng mà người dùng chọn sẽ được bán từ ứng dụng của bạn.

Ứng dụng của bạn chịu trách nhiệm hoàn thành các hoạt động bắt buộc và cung cấp thông tin được yêu cầu để thiết lập thông qua loại tiện ích mở rộng ứng dụng mới.

Hãy giải nén cái này cho bạn từng bước một.

Trước khi bắt đầu thiết lập, ứng dụng của bạn tạo ra một đối tượng cấu trúc liên kết đại diện cho những ngôi nhà mà nó quản lý.

Sau đó, nó chuyển đối tượng cấu trúc liên kết này sang một API thiết lập mới.

Tại thời điểm này, thiết lập được khởi chạy và sẵn sàng quét mã QR Matter.

Đây là một ví dụ mã để gọi.

Như bạn có thể thấy, API này về mặt khái niệm rất giống với các API HomeKit hiện có để thiết lập phụ kiện.

Sự khác biệt chính là việc bổ sung đối tượng HMCHIPServiceTopology, được sử dụng để thông báo thiết lập các ngôi nhà mà ứng dụng của bạn quản lý.

Khi người dùng quét mã QR Matter bằng máy quét, thiết lập sẽ tự động chuyển sang thẻ Phát hiện hiển thị danh mục phụ kiện được phát hiện.

Người dùng hiện đang có tùy chọn thêm phụ kiện vào ứng dụng của bạn, trong ví dụ này là Autohome.

Khi người dùng đã chọn kết nối phụ kiện với trung tâm gia đình của bạn, họ có thể cần chỉ định ngôi nhà cụ thể nào để thêm vào.

Chúng tôi trình bày màn hình này trong trường hợp bạn bắt đầu thiết lập với cấu trúc liên kết bao gồm nhiều hơn một ngôi nhà.

Nếu cấu trúc liên kết của bạn chỉ bao gồm một ngôi nhà duy nhất, thẻ này sẽ bị bỏ qua, vì ý định của người dùng đã được biết đến.

Khi người dùng chọn một ngôi nhà, iOS sẽ gửi yêu cầu đến tiện ích mở rộng của bạn yêu cầu nó ghép nối với tải trọng Matter của phụ kiện được quét.

Tiện ích mở rộng của bạn đáp ứng yêu cầu này thông qua lớp con HMCHIPServiceRequestHandler nguyên tắc của nó.

Khi được gọi, hãy sử dụng CHIP framework APIs để tạo ra một cặp nối an toàn giữa phụ kiện Matter và trung tâm gia đình của bạn.

Tiếp theo, iOS sẽ yêu cầu danh sách các phòng từ tiện ích mở rộng của bạn tương ứng với ngôi nhà đã chọn.

Những phòng này được trình bày trong giao diện người dùng để người dùng lựa chọn.

Mã để trả lời yêu cầu này trong tiện ích mở rộng của bạn rất đơn giản.

Cũng giống như yêu cầu cặp, nó xoay quanh lớp con HMCHIPServiceRequestHandler nguyên tắc tiện ích mở rộng của bạn.

Chỉ cần thực hiện chức năng này và trả lại các phòng tương ứng phù hợp với ngôi nhà đã chọn của người dùng.

Khi người dùng đã chọn tên và phòng cho phụ kiện của họ, chúng tôi sẽ cung cấp thông tin đó cho tiện ích mở rộng của bạn và yêu cầu nó định cấu hình phụ kiện.

Cũng giống như các loại yêu cầu khác, tiện ích mở rộng của bạn sẽ phản hồi yêu cầu cấu hình bằng cách sử dụng API khung CHIP để định cấu hình trực tiếp phụ kiện.

Cuối cùng, sau khi phụ kiện được cấu hình đầy đủ cho ứng dụng của bạn, người dùng cũng sẽ được cung cấp cơ hội sử dụng ứng dụng Apple Home, Trung tâm điều khiển và Siri để điều khiển phụ kiện này.

Được thu thập toàn bộ ở đây một lần nữa là mã mà chúng tôi mong đợi tiện ích mở rộng của bạn triển khai.

Ba chức năng đơn giản: yêu cầu phòng, yêu cầu phụ kiện cặp và yêu cầu cấu hình phụ kiện.

Khi bạn đã phân loại con HMCHIPServiceRequestHandler và ghi đè các phương pháp này, phần còn lại của trải nghiệm thiết lập về cơ bản không có từ góc độ nhà phát triển.

Những thứ như trình bày giao diện người dùng, chuyển đổi giữa các bước, xử lý lỗi, v.v., đều được xử lý cho bạn.

Điều này làm giảm đáng kể lượng mã bạn cần viết, đồng thời cung cấp cho người dùng của bạn trải nghiệm hạng nhất thực sự.

Cho đến nay, chúng tôi đã nói về cách bạn có thể sử dụng các API HomeKit hiện có để tích hợp với các phụ kiện Matter, cũng như một API mới nếu bạn cần kết nối các phụ kiện Matter với một trung tâm nhà thông minh khác.

Nếu bạn là nhà phát triển phụ kiện Matter, bạn cũng sẽ cần làm quen với chính giao thức cho mục đích phát triển phần sụn.

Vì vậy, tiếp theo, đồng nghiệp của tôi, Sagar, sẽ đưa chúng tôi đi tham quan giao thức Matter và cho bạn thấy những điểm tương đồng giữa Matter và HAP.

Cảm ơn, Chris.

Hãy bắt đầu với mô hình dữ liệu Matter.

Mọi phụ kiện Matter đều bộc lộ khả năng của nó thông qua mô hình dữ liệu Matter.

Chúng tôi có thể giải quyết riêng lẻ các khả năng này bắt đầu từ đầu với các điểm cuối.

Điểm cuối có thể được coi là các tính năng riêng biệt về mặt logic của một phụ kiện.

Hầu hết các phụ kiện sẽ chỉ có một vài trong số này: một cho thông tin, như tên, nhà cung cấp và kiểu máy; và một cho chức năng chính của phụ kiện, ví dụ, đèn.

Mỗi điểm cuối có thể có nhiều cụm bên trong nó.

Mỗi cụm đại diện cho một khả năng cụ thể của điểm cuối đó.

Đối với ví dụ ánh sáng của chúng tôi, điểm cuối ánh sáng của nó có thể có các cụm để kiểm soát độ sáng, màu sắc và công suất.

Đối với những người trong chúng ta quen thuộc với HomeKit, các cụm có thể được coi là tương đương với các dịch vụ HomeKit.

Tiếp theo, chúng ta xem xét những gì một cụm có bên trong nó.

Một cụm có thể có một hoặc nhiều thuộc tính.

Mỗi thuộc tính đại diện cho một số trạng thái của phụ kiện.

Đối với ví dụ ánh sáng của chúng tôi, cụm độ sáng trên ánh sáng sẽ có một thuộc tính cho phép chúng tôi đọc và kiểm soát độ sáng của ánh sáng.

Một lần nữa, các thuộc tính của Matter có thể được coi là tương đương với các đặc điểm của HomeKit.

Cuối cùng, ở đây bạn có thể thấy rằng mỗi thuộc tính có thể hỗ trợ một tập hợp các hành động khác nhau, từ đọc, viết và báo cáo.

Trong ví dụ ánh sáng của chúng tôi, chúng tôi có thể muốn bật báo cáo trên cụm bật-tắt để nhận thông báo từ phụ kiện mỗi khi đèn bật hoặc tắt.

Matter thường cung cấp nhiều lựa chọn API để định cấu hình và tương tác với từng thuộc tính dựa trên chức năng của nó.

Những khái niệm mà chúng tôi vừa nói đến đang được triển khai trong khuôn khổ CHIP nguồn mở, với Apple là một trong những người đóng góp chính.

Như Selina đã đề cập trước đó, CHIP đã được đổi tên thành Matter, nhưng khuôn khổ và mã sẽ được cập nhật trong bản phát hành trong tương lai.

Một phiên bản được chứng nhận đầy đủ của khung CHIP sẽ được phân phối trong iOS, cho phép tích hợp HomeKit với các phụ kiện Matter và cũng cung cấp quyền truy cập vào các API nguồn mở nếu bạn cần sử dụng chúng trong ứng dụng của mình.

Chúng ta hãy xem xét một ví dụ về việc sử dụng khung CHIP để tương tác với một phụ kiện nhẹ.

Điều này thực hiện các khái niệm cốt lõi của mô hình dữ liệu Matter mà chúng tôi vừa xem qua.

Chúng tôi bắt đầu bằng cách truy cập CHIPController được chia sẻ.

Bộ điều khiển này là xử lý chính của chúng tôi đối với Matter.

Tiếp theo, chúng tôi xử lý ánh sáng bằng cách sử dụng ID thiết bị mà chúng tôi đã gán cho nó trong quá trình ghép nối.

Sau đó, chúng tôi khởi tạo một tay cầm cho cụm bật-tắt trên điểm cuối ánh sáng.

Và bây giờ, với cụm bật-tắt này, chúng ta có thể thực hiện đọc và ghi trên thuộc tính bật-tắt.

Đầu tiên, chúng tôi yêu cầu chuyển đổi thuộc tính bật-tắt, chỉ chuyển đổi trạng thái của ánh sáng.

Sau đó, chúng tôi yêu cầu đọc trạng thái của thuộc tính bật-tắt.

Phụ kiện sau đó gửi cho chúng tôi phản hồi với trạng thái của thuộc tính mà chúng tôi có thể sử dụng để cập nhật ứng dụng của mình.

Vì vậy, đó là một cái nhìn nhanh về khung CHIP.

Trước khi kết thúc phiên của mình hôm nay, chúng tôi muốn xem xét một khái niệm mới được giới thiệu trong Matter và hiển thị một số tính năng mới mà chúng tôi đã giới thiệu trong ứng dụng Home tận dụng nó.

Như bạn có thể đã biết, giao thức Matter cho phép nhiều quản trị viên kết nối với một phụ kiện cùng một lúc.

Đây là một tính năng tuyệt vời để cung cấp sự lựa chọn cho khách hàng, nhưng nó cũng đặt ra những thách thức cho chúng tôi khi nói đến quản lý phụ kiện.

Hãy cùng xem ứng dụng Home kết hợp điều này như thế nào.

Ứng dụng Home hiện có thể hiển thị danh sách tất cả các quản trị viên được kết nối trên một phụ kiện trong phần Dịch vụ được kết nối mới này.

Người dùng cũng được cung cấp tùy chọn để quản lý các quản trị viên được kết nối.

Và cuối cùng, người dùng có tùy chọn bật lại chế độ ghép nối để cho phép quản trị viên mới kết nối với phụ kiện.

Mục tiêu của chúng tôi ở đây rất đơn giản: chúng tôi muốn đảm bảo rằng khách hàng của mình có quyền tự do lựa chọn những gì tốt nhất cho họ và cũng tự tin để biết các phụ kiện nhà thông minh của họ đang được quản lý như thế nào.

Vì vậy, hỗ trợ Matter trước tiên sẽ có sẵn trong bản xem trước nhà phát triển iOS, iPadOS và tvOS 15 và hồ sơ nhà phát triển phải được cài đặt trên các nền tảng này để kích hoạt nó.

Bạn cũng sẽ cần một trung tâm gia đình để điều khiển các phụ kiện Matter thông qua HomeKit.

Mặc dù chúng tôi hy vọng Matter sẽ xuất bản ID nhà cung cấp đủ điều kiện và ID sản phẩm được chứng nhận khi chúng có sẵn cho thị trường, chúng tôi sẽ cung cấp danh sách ID nhà cung cấp mẫu và ID sản phẩm với bản xem trước dành cho nhà phát triển để tạo điều kiện cho sự phát triển của bạn.

Các ID này được cấu hình sẵn để đại diện cho các danh mục phụ kiện Matter đã được hỗ trợ trong bản xem trước của nhà phát triển.

Như mọi khi, bạn có thể tìm thêm thông tin về API của chúng tôi trên developer.apple.com.

Và có thể tìm thêm thông tin về API nguồn mở Matter và các định nghĩa phụ kiện Matter trên Github.

Vì vậy, để kết luận, chúng tôi đang mang đến sự hỗ trợ Matter liền mạch thông qua HomeKit cho các nhà phát triển phụ kiện, ứng dụng HomeKit và người dùng HomeKit.

Sẽ có một API thiết lập mới trong một hạt giống sắp tới cho các nhà phát triển, những người cần kết nối các phụ kiện Matter với các trung tâm nhà thông minh khác.

Và tất cả những điều này sẽ có sẵn bắt đầu với bản xem trước dành cho nhà phát triển iOS, iPadOS và tvOS 15.

Cảm ơn bạn đã xem, và từ nhóm của tôi và tôi, tạm biệt.

[Nhạc gõ].