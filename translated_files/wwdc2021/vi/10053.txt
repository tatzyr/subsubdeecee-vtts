10053

♪ Nhạc bass đang phát ♪

♪

Owen Monsma: Xin chào, và chào mừng đến với "Chất lượng của một ứng dụng Mac Catalyst tuyệt vời."

Tên tôi là Owen Monsma, và tôi là một kỹ sư Ca cao.

Và tôi sẽ được tham gia sau bởi đồng nghiệp Dave Rahardja của tôi từ UIKit.

Hôm nay chúng ta sẽ xem xét ba cân nhắc quan trọng để tạo ra một ứng dụng Catalyst tuyệt vời.

Đầu tiên, chúng tôi sẽ đề cập đến một số thay đổi cấp cao xảy ra khi bạn chuyển sang ứng dụng Mac Catalyst.

Tiếp theo, chúng tôi sẽ đi sâu vào một số sửa đổi mã cụ thể mà bạn có thể thực hiện để cải thiện trải nghiệm ứng dụng của mình trên Mac.

Và chúng ta sẽ kết thúc với thông tin về phân phối ứng dụng.

Vậy hãy bắt đầu với việc di chuyển ứng dụng của bạn sang Mac Catalyst.

Bước đầu tiên hướng tới một ứng dụng Catalyst tuyệt vời là có một ứng dụng iPad tuyệt vời và ứng dụng của bạn đã chạy mà không có thay đổi bổ sung nào trên máy Mac với M1.

Nếu bạn có máy Mac M1, bạn có thể thử điều này ngay lập tức với điểm đến chạy được thiết kế cho iPad trong Xcode.

Bằng cách áp dụng các tính năng này trên iPad, ứng dụng Mac của bạn sẽ có một khởi đầu tuyệt vời.

Nếu ứng dụng của bạn hỗ trợ đa nhiệm trên iPad, bạn có thể tự động nhận được hỗ trợ nhiều cửa sổ trên Mac.

Và nếu bạn sử dụng UIMenuBuilder, các menu của bạn sẽ tự động được chọn trong thanh menu của ứng dụng và bằng các menu theo ngữ cảnh với một cú nhấp chuột phụ vào chế độ xem của bạn.

Chúng tôi cũng tự động kết nối các hành vi của hệ thống như sao chép/dán và kéo và thả.

Để tìm hiểu thêm về cách ứng dụng iPad của bạn chạy nguyên trạng trên máy Mac M1, hãy xem video của chúng tôi, "Các chất lượng của các ứng dụng iPad và iPhone tuyệt vời trên máy Mac với M1."

Nhưng bạn ở đây vì bạn muốn đưa mọi thứ đi xa hơn.

Bằng cách chọn hộp kiểm Mac, bạn có được khả năng phân phối cho tất cả các máy Mac và có quyền truy cập vào các API bổ sung để tinh chỉnh thêm ứng dụng của mình.

Vì vậy, hãy làm điều đó với ứng dụng của chúng tôi, Trip Planner!

Trong cài đặt dự án Xcode của chúng tôi, chúng tôi kiểm tra tùy chọn Mac trong Thông tin triển khai.

Lưu ý ở bên phải, một cửa sổ bật lên bổ sung xuất hiện, cho phép chúng tôi chọn giữa giao diện iPad được chia tỷ lệ và giao diện được tối ưu hóa Mac.

Chúng tôi sẽ xem xét lựa chọn này nhiều hơn một chút.

Hiện tại, hãy nhấp vào xây dựng và chạy trên thanh công cụ Xcode.

Và ứng dụng của chúng tôi được xây dựng và chạy!

Bây giờ, nếu ứng dụng của bạn không thể xây dựng được, có một vài điều cần điều tra.

Một số khung và lớp không dùng nữa không có sẵn cho Mac Catalyst, vì vậy bây giờ là lúc để hiện đại hóa.

Điều này không chỉ giúp ứng dụng của bạn chạy trên Mac mà còn cải thiện ứng dụng iOS của bạn.

Chuyển từ OpenGLES sang khung Metal của riêng Apple sẽ mở ra toàn bộ sức mạnh của GPU.

Khung Danh bạ đã thay thế Sổ địa chỉ bị phản đối và là một cách hướng tới tương lai, an toàn cho luồng để xử lý danh bạ.

Và UIWebView bị phản đối và đã bị thay thế bởi WKWebView.

Ngoài ra, hãy đảm bảo kiểm tra các phụ thuộc của bên thứ ba của bạn.

Nếu các khung đó được phân phối dưới dạng gói XCFramework, hãy đảm bảo rằng chúng cung cấp tệp nhị phân Mac để liên kết.

Khi bạn bắt đầu làm việc trên ứng dụng Mac của mình, hãy theo dõi các cảnh báo trình biên dịch khi xây dựng dự án của bạn và theo dõi nhật ký bảng điều khiển cho các thông báo thời gian chạy.

Những cảnh báo này cho bạn biết cách sửa mã của mình để nó chạy tốt như quy trình Mac Catalyst.

Và hãy nhớ chỉ sử dụng API được hỗ trợ để ứng dụng của bạn tiếp tục chạy trên các bản phát hành macOS trong tương lai.

Điều quan trọng là phải nhận thức được các sự kiện vòng đời mà ứng dụng của bạn sẽ nhận được khi chạy trên máy Mac.

Nếu ứng dụng của bạn hiện đang dựa vào các sự kiện vòng đời được gọi trên đại diện ứng dụng của bạn, thay vào đó bạn nên theo dõi vòng đời cảnh để ứng dụng của bạn có thể phản hồi các sự kiện cụ thể cho nội dung của từng cửa sổ trên màn hình nền.

Hãy nhớ rằng, một ứng dụng Mac Catalyst sẽ không nhận được sự kiện sceneDidEnterBackground thường xuyên như một ứng dụng iPad.

Các cảnh chuyển sang trạng thái nền khi cửa sổ màn hình nền được thu nhỏ hoặc đóng lại.

Nếu ứng dụng của bạn sử dụng sceneDidEnterBackground để thực hiện một số công việc thông thường như tự động lưu tài liệu, thay vào đó sử dụng bộ hẹn giờ sẽ đảm bảo hành động này được thực hiện thường xuyên.

Cuối cùng, hãy nhớ rằng ứng dụng Catalyst của bạn có thể không có cảnh nào nhưng vẫn tiếp tục chạy ở phía trước.

Trạng thái này xảy ra khi tất cả các cửa sổ ứng dụng của bạn đã bị đóng, nhưng tên ứng dụng của bạn vẫn hiển thị trên thanh menu.

Bây giờ hãy quyết định xem có nên tối ưu hóa giao diện của chúng ta cho Mac hay không.

Đây là một trong những quyết định quan trọng nhất cần đưa ra khi bạn lần đầu tiên bắt đầu đưa ứng dụng của mình đến.

Sử dụng thành ngữ Mac được khuyến nghị để làm cho ứng dụng của bạn cảm thấy như ở nhà nhất trên Mac, nhưng nó yêu cầu một số công việc bổ sung.

Trong thành ngữ Mac, ứng dụng của bạn sẽ chạy ở tỷ lệ 100 phần trăm, mang đến cho bạn văn bản và hình ảnh hoàn hảo về điểm ảnh và các điều khiển AppKit gốc.

Nếu bạn muốn, bạn có thể thêm các tài sản dành riêng cho Mac mới vào danh mục tài sản của mình để tận dụng chi tiết bổ sung này.

Thực hành tốt là cung cấp cả tài sản 1x và 2x để hỗ trợ tất cả các độ phân giải của màn hình.

Lưu ý, số liệu kích thước của nhiều điều khiển của bạn sẽ thay đổi, vì vậy điều quan trọng là phải điều chỉnh bố cục ứng dụng của bạn để phù hợp.

Đối với các điều khiển tùy chỉnh trong ứng dụng của bạn, bạn có một lựa chọn bổ sung.

Tự động, bạn có được kiểu điều khiển Mac.

Nhưng bây giờ bạn có thể chọn không tham gia các nút và thanh trượt của mình từ chuyển đổi này để sử dụng các API tùy chỉnh không có sẵn trên các điều khiển Mac.

Nếu bạn sử dụng bất kỳ tài sản tùy chỉnh nào - như đặt ngón tay cái trên UISlider - chúng sẽ xuất hiện lớn hơn dự kiến theo mặc định, vì vậy bạn có thể cần mở rộng quy mô hoặc cung cấp tài sản mới.

Cũng nên nhớ rằng người dùng Mac mong đợi các điều khiển kiểu AppKit, vì vậy các điều khiển tùy chỉnh nên được sử dụng một cách tiết kiệm.

Để biết thêm chi tiết về thành ngữ Mac, hãy xem video của chúng tôi, "Tối ưu hóa giao diện của ứng dụng Mac Catalyst của bạn."

Bởi vì một ứng dụng Catalyst trong thành ngữ Mac đảm nhận các kiểu điều khiển AppKit, cả giao diện và hành vi của một số điều khiển của bạn sẽ thay đổi.

Trong video của chúng tôi, "Có gì mới trong Mac Catalyst", chúng tôi đã giới thiệu kiểu nút bật lên mới làm tròn bộ loại nút Mac của chúng tôi.

Hãy đi sâu vào điều gì làm cho các điều khiển này khác nhau và cách hệ thống chọn cái nào để sử dụng.

Hiểu được các điều khiển này và nơi chúng thường được tìm thấy sẽ giúp bạn đưa ra lựa chọn sáng suốt về việc sử dụng chúng trong ứng dụng của bạn.

Loại UIButton mặc định là UIButton type .system.

Với loại nút này, nút sẽ tự động đảm nhận giao diện mong đợi cho ngữ cảnh của nó.

Trong thành ngữ Mac, điều này có nghĩa là nó trở thành một nút ấn viền.

Các nút kéo xuống là một điều khiển gốc Mac được sử dụng để cung cấp danh sách các hành động có thể xảy ra và được vẽ bằng một chỉ báo mũi tên đơn.

Một ví dụ điển hình là PDF kéo xuống trong hộp thoại in, trình bày các hành động như Lưu dưới dạng PDF hoặc Gửi trong Thư.

Để có được nút kéo xuống, hãy đảm bảo rằng bạn đã gán menu giao diện người dùng cho nút của mình thông qua thuộc tính menu của nó và đặt showMenuAsPrimaryAction thành true.

Nút của bạn sẽ có giao diện kéo xuống và trình bày menu chỉ bằng một cú nhấp chuột.

Và mới đối với Catalyst với macOS Monterey là các nút bật lên.

Các nút bật lên trông tương tự như các nút kéo xuống nhưng có chỉ báo mũi tên kép và chúng làm điều gì đó hơi khác một chút.

Khi kéo xuống kích hoạt một hành động, một nút bật lên được sử dụng để chọn một trong một tập hợp các tùy chọn loại trừ lẫn nhau.

Ví dụ, chọn ngày trong tuần.

Tiêu đề trong nút sau đó cập nhật để phản ánh lựa chọn.

Đây là một lựa chọn tốt, thân thiện với Mac để thay thế UIPickerView trong ứng dụng của bạn.

Nhận được điều khiển này tương tự như nút kéo xuống, nhưng thay đổi thuộc tínhSelectionAsPrimaryAction cũng phải đúng.

Cuối cùng, các hộp kiểm được sử dụng để đại diện cho một nút chuyển đổi nhị phân không độc quyền và là một giải pháp thay thế thân thiện với chuột hơn cho công tắc.

Và hóa ra, bạn nhận được hộp kiểm mà không cần làm thêm!

Chỉ cần đảm bảo rằng công tắc có bộ tiêu đề và lưu ý rằng thuộc tính tiêu đề chỉ được hỗ trợ trong thành ngữ Mac.

Theo mặc định, công tắc có Kiểu tự động ưu tiên và bạn có thể xác minh trong thời gian chạy xem đó là công tắc hay hộp kiểm bằng cách sử dụng thuộc tính kiểu chỉ đọc.

Bây giờ, để đi sâu vào một số thay đổi mã cụ thể, hãy giao mọi thứ cho đồng nghiệp của tôi, Dave.

Dave Rahardja: Xin chào mọi người, tên tôi là Dave, và tôi là một kỹ sư trong nhóm UIKit.

Hãy nói về một số điều cụ thể bạn có thể làm để làm cho ứng dụng Mac Catalyst của bạn cảm thấy như ở nhà hơn.

Một ứng dụng Mac Catalyst có thể có quyền truy cập vào nhiều bất động sản màn hình hơn.

Các cửa sổ ứng dụng của bạn có thể được thay đổi kích thước lớn hơn nhiều trên máy Mac so với trên iPad và có thể được hiển thị toàn màn hình.

Hãy dành một chút thời gian để thay đổi kích thước cửa sổ ứng dụng của bạn và chú ý đến bố cục của nó.

Đảm bảo rằng bạn đang sử dụng không gian bổ sung để hiển thị nhiều nội dung và điều khiển hơn để làm cho các ứng dụng của bạn dễ sử dụng hơn.

Thay đổi kích thước trực tiếp sẽ đưa hiệu suất bố cục ứng dụng của bạn vào thử nghiệm.

Ứng dụng của bạn nên thực hiện ít công việc nhất có thể trong quá trình bố trí để giữ cho các cửa sổ của ứng dụng của bạn phản hồi trong quá trình thay đổi kích thước.

Lưu ý đặc biệt các tương tác trong ứng dụng của bạn dựa trên các bài thuyết trình và cửa sổ bật lên theo phương thức.

Với diện tích hiển thị lớn hơn, bạn có thể làm cho các tương tác này luôn có sẵn bằng cách hiển thị chúng dưới dạng chế độ xem trẻ em.

Bây giờ, hãy nói về các thiết bị đầu vào con trỏ.

Hãy nhớ rằng không phải tất cả các máy Mac đều có bàn di chuột và một số máy Mac được kết nối với các thiết bị đầu vào không hỗ trợ cuộn.

Nếu chế độ xem của bạn dựa vào cử chỉ chụm hoặc xoay để hoạt động, hãy đảm bảo rằng tất cả các khả năng của nó đều có thể truy cập bằng chuột mà không cần nhập cuộn.

Thêm các nút bổ sung hoặc các điều khiển khác vào chế độ xem ứng dụng Mac Catalyst của bạn để đảm bảo tất cả các chức năng của nó đều có thể truy cập được.

Ngoài ra, việc phát hiện các công cụ sửa đổi bàn phím trên bộ nhận dạng cử chỉ chạm hoặc xoay đôi khi có thể cung cấp quyền truy cập nhanh hơn vào chức năng của chế độ xem của bạn.

Ví dụ, cho phép Shift-pan phóng to.

Hãy nói về các phím tắt và menu chính.

Menu chính của ứng dụng Mac là một nơi tuyệt vời để khám phá tất cả các hành động có sẵn trong ứng dụng của bạn, cũng như các phím tắt liên quan của chúng.

Nếu ứng dụng của bạn đã hỗ trợ các phím tắt bằng cách trả về các lệnh chính từ người phản hồi, hãy thêm các lệnh này vào menu chính bằng API trình tạo menu thay thế.

Di chuyển tất cả các phím tắt của bạn đến menu chính giúp chúng có thể phát hiện được ngay cả khi chúng hiện không được bật.

Hơn nữa, sử dụng MenuBuilder API để sắp xếp các phím tắt của bạn trên Mac Catalyst cũng sắp xếp chúng trên lớp phủ phím tắt iPad.

Khi bạn xây dựng menu chính của mình, hãy đảm bảo thêm tất cả các hành động cần thiết để tương tác với ứng dụng của bạn.

Các hành động được thực hiện bằng cử chỉ trên iPad cũng có thể truy cập được bằng cách chọn các mục từ menu chính.

Thêm các phím tắt vào các mục menu của bạn sẽ cung cấp quyền truy cập nhanh hơn vào các hành động này.

Bởi vì thanh menu và các hành động lệnh chính được định tuyến bắt đầu từ người phản hồi đầu tiên, hãy đảm bảo rằng các chế độ xem sẽ là mục tiêu của những hành động đó có thể trở thành người phản hồi đầu tiên và có thể chấp nhận sự tập trung.

Bạn có thể làm điều này bằng cách để quan điểm của bạn trả về true cho các thuộc tính canBecomeFirstResponder và canBecomeFocused.

Vì một ứng dụng Mac phải ít dựa vào thao tác trực tiếp các chế độ xem và nhiều hơn vào việc người dùng chọn chế độ xem và sau đó chọn một hành động từ menu chính, khả năng nhiều lượt xem ứng dụng của bạn trở thành người phản hồi đầu tiên và tập trung trở nên quan trọng hơn trên Mac Catalyst.

Để biết thêm thông tin về tiêu điểm và phản hồi đầu tiên, hãy xem video, "Tập trung vào điều hướng bàn phím iPad."

Trong khi chúng tôi đang nói về chủ đề người phản hồi, hãy đảm bảo để chuỗi người phản hồi không được sửa đổi trong ứng dụng của bạn.

Nói cách khác, đừng ghi đè nextResponder.

Để chuỗi phản hồi không được sửa đổi đảm bảo rằng Mac Catalyst có thể định tuyến hành động của bạn đến các mục tiêu thích hợp.

Nếu ứng dụng của bạn phải xử lý một số hành động nhất định bằng cách sử dụng các đối tượng không nằm trong chuỗi phản hồi của nó, hãy sử dụng chức năng target (cho Action:, withSender:) để ủy thác các hành động này cho đối tượng thích hợp thay thế.

Hãy xem qua mã.

Trong ví dụ này, quan điểm của chúng tôi ủy quyền hành động setAsFavorite cho một đối tượng mô hình, đồng thời cho phép các hành động khác tiếp tục truyền bá chuỗi phản hồi.

Bây giờ hãy nói về các cảnh và cách chúng hoạt động trong ứng dụng Mac Catalyst.

Một ứng dụng Mac có thể có nhiều cửa sổ máy tính để bàn mở cùng một lúc.

Trong ứng dụng Mac Catalyst, mỗi cửa sổ này được ghép nối với UIWindowScene.

Ứng dụng của bạn có thể cung cấp các cửa sổ có các chức năng khác nhau.

Ví dụ, nó có thể có một cửa sổ tài liệu, một cửa sổ xem chi tiết, một cửa sổ soạn tin nhắn, v.v.

Cách tốt nhất để tổ chức các chức năng cảnh khác nhau này là xác định cấu hình cảnh cho từng loại cửa sổ.

Để xác định cấu hình cảnh, hãy thêm chúng vào Info.plist của bạn trong mục Bản kê khai cảnh ứng dụng.

Trong mảng Vai trò Phiên Ứng dụng, tạo một cấu hình cho mỗi loại cảnh mà ứng dụng của bạn hỗ trợ.

Đặt tên cho mỗi cấu hình này và chọn lớp cảnh, lớp đại diện và bảng phân cảnh sẽ được khởi tạo khi cảnh được tạo.

Bây giờ chúng ta đã xác định cấu hình cảnh của mình, hãy thảo luận về cách chúng ta có thể sử dụng chúng để tạo một cảnh mới của một cấu hình cụ thể.

Trong ví dụ này, chúng tôi muốn tạo một cảnh xem chi tiết mới khi chế độ xem được nhấp đúp.

Điều đầu tiên chúng tôi làm là xác định một loại hoạt động người dùng mới để yêu cầu cảnh xem chi tiết.

Chúng tôi sẽ gọi nó là viewDetailActivityType.

Khi chúng tôi tạo hoạt động người dùng mới đó, chúng tôi muốn chuyển một mã định danh cho mục mà chúng tôi muốn hiển thị chi tiết.

Để làm điều đó, chúng tôi xác định một itemIDKey sẽ giữ thông tin đó trong từ điển thông tin người dùng.

Sau đó, trong trình xử lý sự kiện nhấp đúp chuột của chúng tôi, chúng tôi tạo một đối tượng NSUserActivity mới thuộc loại thích hợp và đặt thuộc tính userInfo của nó thành một từ điển chứa itemID mà chúng tôi muốn hiển thị.

Cuối cùng, chúng tôi gọi hàm UIApplication requestSceneSessionActivation, chuyển vào hoạt động người dùng mà chúng tôi vừa tạo.

Điều này sẽ khiến hệ thống tạo ra cảnh mới của chúng tôi.

Vì vậy, bây giờ chúng tôi biết cách yêu cầu một cảnh mới cho một loại hoạt động người dùng cụ thể.

Bây giờ hãy nói về cách sử dụng thông tin đó để tải cấu hình cảnh thích hợp.

Chúng tôi phản hồi các yêu cầu tạo cảnh bằng cách triển khai chức năng cấu hình ứng dụng ForConnecting trong đại diện ứng dụng.

Trong quá trình triển khai của chúng tôi, chúng tôi kiểm tra xem yêu cầu cảnh đến có chứa bất kỳ hoạt động nào của người dùng hay không.

Yêu cầu có thể chứa nhiều hoạt động của người dùng, nhưng đối với ví dụ mã này, chúng tôi sẽ chỉ kiểm tra hoạt động đầu tiên.

Nếu có một hoạt động chúng tôi cần xử lý, sau đó chúng tôi kiểm tra loại hoạt động của nó.

Ở đây, chúng tôi kiểm tra xem nó có bằng viewDetailActivityType hay không.

Nếu vậy, chúng tôi sẽ trả lại cấu hình cảnh có tên DetailViewer.

Điều này sẽ khiến hệ thống kiểm tra trong Info.plist của chúng tôi để biết cấu hình của tên đó và tải các lớp đại diện cảnh và cảnh thích hợp và hiển thị bảng phân cảnh được chỉ định trong cửa sổ máy tính để bàn mới.

Nếu không có cấu hình cảnh cụ thể nào được tải, chúng tôi sẽ quay lại cấu hình mặc định.

Còn một việc nữa để làm.

Hãy nhớ rằng chúng tôi đã lưu itemID để mặt hàng được hiển thị?

Chúng ta vẫn cần đặt giá trị đó trên bộ điều khiển chế độ xem của cảnh mà chúng ta vừa tạo.

Chúng tôi làm điều đó trong lớp SceneDelegate của chúng tôi.

Chức năng phiên willConnectTo của cảnh được gọi ngay trước khi cảnh sắp được hiển thị trên màn hình nền.

Hoạt động của người dùng đã được chuyển vào đại diện ứng dụng của chúng tôi cũng được chuyển vào chức năng này trong đại diện cảnh.

Bây giờ chúng ta có thể trích xuất itemID từ từ điển userInfo của nó và đặt nó trên bộ điều khiển chế độ xem mới của chúng ta.

Sử dụng NSUserActivity để định cấu hình các cảnh mới cũng giúp ứng dụng của bạn hỗ trợ khôi phục trạng thái dễ dàng hơn.

Nếu đại diện cảnh của bạn phản hồi cuộc gọi lại stateRestorationActivity (cho Scene:), hoạt động người dùng được trả về sẽ được hệ thống lưu lại khi ứng dụng của bạn thoát.

Nếu khôi phục trạng thái được bật trong Tùy chọn hệ thống, lần tới khi ứng dụng của bạn được khởi chạy, hệ thống sẽ tạo lại cảnh của bạn và chuyển đối tượng hoạt động người dùng của từng cảnh sang cấu hình ứng dụng của đại diện ứng dụng của bạn để kết nối chức năng SceneSession.

Đây là chức năng tương tự được gọi khi ứng dụng của bạn tạo cảnh mới, như đã đề cập trước đó.

Bằng cách sử dụng một tập hợp các loại hoạt động nhất quán, bạn có thể sử dụng cùng một mã để chọn cấu hình cảnh thích hợp khi ứng dụng của bạn tạo cửa sổ máy tính để bàn mới và trong quá trình khôi phục trạng thái.

Có một điều bạn cần thêm vào đại diện cảnh của mình để ứng dụng của bạn có thể xử lý cả yêu cầu cảnh mới và khôi phục trạng thái với cùng một mã và đó là sửa đổi chức năng phiên willConnect cảnh của bạn trong đại diện cảnh của bạn để nó quay trở lại stateRestorationActivity nếu hoạt động trong các tùy chọn kết nối cảnh là số không.

Bây giờ ứng dụng của bạn đã sẵn sàng để xử lý các yêu cầu cảnh mới và khôi phục trạng thái.

Để biết thêm thông tin về khôi phục trạng thái, hãy xem video "Giới thiệu nhiều cửa sổ trên iPad".

Tiếp theo, hãy nói về thanh công cụ ứng dụng của bạn.

Một ứng dụng Mac tuyệt vời sử dụng thanh công cụ của cửa sổ để trình bày các hành động được sử dụng thường xuyên và các tùy chọn điều hướng khác để truy cập nhanh.

Không giống như thanh công cụ trên iOS, thanh công cụ trên cửa sổ máy tính để bàn của ứng dụng Mac Catalyst không thay đổi khi bộ điều khiển chế độ xem xuất hiện và biến mất trong bộ điều khiển Split View hoặc bộ điều khiển điều hướng.

Bởi vì các thanh công cụ được liên kết chặt chẽ với các cảnh, nơi tốt nhất để định cấu hình thanh công cụ của bạn là trong lớp con đại diện cảnh của bạn.

Một mục quan trọng thường được tìm thấy trên thanh công cụ là nút chia sẻ.

Thêm NSSharingServicePicker ToolbarItem vào thanh công cụ của bạn cho phép ứng dụng của bạn chia sẻ nội dung chính được hiển thị trong cảnh của bạn bằng cách sử dụng menu chia sẻ tiêu chuẩn của Mac.

Trong macOS Monterey, chúng tôi đã thêm khả năng nút tự động sử dụng cấu hình các mục hoạt động được chia sẻ bởi cảnh của bạn.

Lưu ý rằng đây là cùng một cấu hình mà chức năng Chia sẻ này mới của Siri sử dụng trên iOS.

Một cách tốt để cung cấp cấu hình chia sẻ cho cảnh của bạn là trả về một đối tượng từ thuộc tính activityItemsConfiguration của RootViewController.

Trên Mac Catalyst, NSSharingServicePicker ToolbarItem trong thanh công cụ của ứng dụng của bạn sẽ tự động sử dụng thuộc tính này.

Trên iOS, Siri sử dụng cùng một thuộc tính để chia sẻ dữ liệu bằng cách sử dụng Chia sẻ cái này.

Tất nhiên, thanh công cụ không phải là nơi duy nhất ứng dụng của bạn có thể cung cấp các mục để chia sẻ.

Thông thường, bạn muốn cho phép chia sẻ hình ảnh hoặc các mục khác thông qua trình đơn ngữ cảnh.

Để làm điều này, hãy trả về một đối tượng activityItemsConfiguration từ chế độ xem của bạn sau đó thêm một contextMenuInteraction.

Đây là kết quả, trên cả Mac Catalyst và iPad.

Trên Mac Catalyst, lưu ý rằng hành động Sao chép và menu Chia sẻ sẽ tự động được thêm vào.

Và khi ứng dụng của bạn chạy trên iPad, hành động Sao chép và Chia sẻ sẽ được thêm vào.

Nhấn vào hành động Chia sẻ sẽ tự động trình bày bảng chia sẻ.

Sử dụng API Cấu hình Mục Hoạt động cho phép ứng dụng của bạn khai báo những gì chế độ xem của nó có thể chia sẻ để hệ thống có thể hiển thị giao diện người dùng phù hợp trên mỗi nền tảng.

Bây giờ chúng ta đã nói về cách ứng dụng của bạn có thể chia sẻ dữ liệu của nó, hãy nói về cách ứng dụng của bạn có thể nhập hình ảnh từ iPhone hoặc iPad bằng Máy ảnh liên tục.

Nếu ứng dụng của bạn sử dụng UITextView để hiển thị văn bản phong phú, hỗ trợ Continuity Camera sẽ tự động được bật trong macOS Monterey.

Nhấp chuột phải vào chế độ xem văn bản sẽ hiển thị menu ngữ cảnh với tùy chọn chụp ảnh trên iPhone hoặc iPad của bạn và tự động thêm nó dưới dạng tệp đính kèm.

Để thêm hỗ trợ cho Continuity Camera vào bất kỳ chế độ xem nào, chỉ cần trả lại một đối tượng UIPasteConfiguration chấp nhận hình ảnh từ thuộc tính pasteConfiguration của chế độ xem của bạn, sau đó thêm giao diện người dùng contextMenuInteraction.

Sau đó triển khai chức năng paste(itemProviders:) để tải và dán các đối tượng đến - trong trường hợp này là hình ảnh.

Như một phần thưởng, việc trả lại cấu hình dán từ chế độ xem của bạn không chỉ cho phép Máy ảnh liên tục khi cấu hình chấp nhận hình ảnh, nó còn tự động kích hoạt hành động Dán trong menu ngữ cảnh và cho phép chế độ xem của bạn chấp nhận các lần kéo đến, cả trên Mac Catalyst và iPad.

Vì vậy, đó là một số điều cụ thể bạn có thể làm để giúp ứng dụng của mình trở thành một ứng dụng Mac Catalyst tuyệt vời.

Bây giờ chúng ta hãy quay lại Owen để nói về việc phân phối.

Owen: Cảm ơn, Dave.

Khi nói đến việc phát hành ứng dụng của bạn, điều quan trọng cần nhớ là các ứng dụng Mac Catalyst là ứng dụng Mac và có thể được phân phối thông qua tất cả các phương tiện giống như bất kỳ ứng dụng Mac nào khác.

Bạn có thể xuất bản ứng dụng của mình trên Mac App Store, với tùy chọn Universal Purchase để khách hàng iOS hiện tại của bạn tự động nhận được ứng dụng Mac của bạn.

Bạn có quyền truy cập vào TestFlight để phát hành bản beta của ứng dụng của mình và để nhận phản hồi sớm về các bản dựng mới.

Bạn cũng có thể sử dụng App Notarization và tự phân phối nó.

Và nếu bạn phát triển một khuôn khổ, hãy sử dụng XCFrameworks để phân phối đa nền tảng, kết hợp các tệp nhị phân với nhau cho tất cả các nền tảng.

Hôm nay, chúng tôi đã đề cập đến quá trình xây dựng ứng dụng iOS của bạn cho Mac với Mac Catalyst và nêu bật một số quyết định và thay đổi quan trọng cần thực hiện trên đường đi.

Bây giờ là lúc để xem xét các dự án của riêng bạn.

Thật dễ dàng để ứng dụng của bạn chạy trên Mac và chỉ với một chút công việc, bạn có thể làm cho ứng dụng của mình cảm thấy như ở nhà và cung cấp cho một nhóm khách hàng hào hứng hoàn toàn mới.

Cảm ơn bạn!

♪