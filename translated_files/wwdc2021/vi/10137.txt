10137

♪ ♪

Xin chào và chào mừng đến với WWDC.

Tôi là Austin, và tôi làm việc trên API Quản lý Ứng dụng và Sách.

Tôi sẽ chia sẻ với bạn những cải tiến mà chúng tôi đã mang đến một phiên bản API mới, cho phép giải pháp MDM của bạn quản lý Ứng dụng và Sách theo cách nhanh hơn và có thể mở rộng hơn bao giờ hết.

Bạn có thể đã sử dụng API Quản lý Ứng dụng và Sách để cho phép các tổ chức sử dụng sản phẩm của bạn quản lý các ứng dụng và sách thuộc sở hữu của họ.

Tổ chức có thể đã mua lại những tài sản này thông qua Apple School Manager hoặc Apple Business Manager.

Và API cho phép bạn chỉ định các ứng dụng và sách thuộc sở hữu này cho người dùng và thiết bị được quản lý của tổ chức.

Chúng tôi đã giới thiệu rất nhiều thay đổi trong năm nay đối với API Ứng dụng và Sách mới.

Chúng tôi sẽ đề cập đến nhiều điều này trong suốt phiên này nhưng tập trung vào hai cải tiến sẽ cải thiện nhất quy trình làm việc của bạn: Thông báo thời gian thực và Xử lý không đồng bộ.

Để có cái nhìn sâu sắc về những thay đổi khác, hãy xem tài liệu dành cho nhà phát triển mới trong phần Quản lý thiết bị trên developer.apple.com và trong phần tham khảo cho phiên này.

Hãy bắt đầu với các thông báo theo thời gian thực.

Hiện tại chúng tôi hỗ trợ các thông báo theo thời gian thực về các thay đổi trạng thái đối với các bài tập, tài sản và người dùng đã đăng ký.

Bạn cần chọn tham gia các thông báo này và bạn sẽ chỉ nhận được thông báo cho các loại bạn đăng ký trong cấu hình máy khách.

Thông báo thời gian thực cuối cùng đã loại bỏ nhu cầu bạn liên tục đồng bộ hóa trạng thái.

Hãy thảo luận về các loại thông báo chuyên sâu hơn một chút.

Loại thông báo đầu tiên dành cho bài tập.

Chuyển nhượng là khi một tài sản được phân bổ cho người dùng hoặc thiết bị do một tổ chức quản lý.

Nếu bạn phải đợi xác nhận rằng toàn bộ nhóm bài tập đã được thực hiện thành công, điều đó sẽ dẫn đến sự chậm trễ trong việc cài đặt nội dung mà người dùng cần.

Bây giờ, với các thông báo bài tập, bạn sẽ biết chính xác trong thời gian thực những bài tập nào đã được thực hiện thành công và cho thiết bị nào.

Bạn đăng ký loại thông báo quản lý tài sản trong cấu hình khách hàng để nhận những thông báo này.

Apple sau đó sẽ tiến hành thông báo cho bạn khi trạng thái phân công bị thay đổi bởi sự kiện liên kết, hủy liên kết hoặc thu hồi tài sản.

Bây giờ bạn có thể dựa vào các thông báo này để cung cấp cho người dùng và thiết bị quyền truy cập nhanh hơn vào nội dung khi chúng được chỉ định.

Hãy xem một ví dụ về thông báo này.

Khi một bài tập xảy ra, bạn sẽ nhận được thông báo này.

Ví dụ ở đây được kích hoạt bởi một cuộc gọi tài sản liên kết.

Apple đăng những thông báo này với một bí mật được chia sẻ trong tiêu đề ủy quyền do bạn cung cấp trong cấu hình máy khách.

Thông báo chứa một tải trọng, cụ thể cho một loại thông báo nhất định.

Loại được ký hiệu ở đây, đối với thông báo này là quản lý tài sản.

Trong tải trọng thông báo của chúng tôi, chúng tôi có thể thấy các bài tập có trạng thái đã cố gắng thay đổi, ID sự kiện, mã định danh duy nhất cho sự kiện không đồng bộ do MDM kích hoạt này.

Chúng ta sẽ đi vào chi tiết hơn về bản chất không đồng bộ của API mới của chúng ta một chút.

Đây là kết quả của sự thay đổi trạng thái, cho dù nó thành công hay thất bại.

Và loại thay đổi đối với trạng thái phân công, đây là một cộng sự.

Loại thông báo tiếp theo dành cho tài sản.

Tài sản là các ứng dụng và sách mà một tổ chức đã mua trong Apple School Manager hoặc Apple Business Manager.

Tổ chức đó không thể quản lý và chỉ định tài sản cho đến khi MDM của bạn biết rằng họ sở hữu nội dung.

Với thông báo tài sản, bạn sẽ được thông báo trong thời gian thực khi các thay đổi đối với tài sản xảy ra từ việc mua, chuyển nhượng hoặc hoàn lại tiền và MDM của bạn luôn có thể biết số lượng hiện có sẵn của từng tài sản.

Bạn đăng ký loại thông báo số lượng tài sản trong cấu hình khách hàng để nhận những thứ này.

Apple sau đó sẽ tiến hành thông báo cho bạn khi trạng thái tài sản thay đổi do sự kiện mua, chuyển nhượng hoặc hoàn tiền.

Những thông báo này sẽ cho phép bạn nhanh chóng cung cấp cho người dùng tài sản đã mua gần đây của họ.

Chúng ta cũng hãy xem xét một ví dụ về thông báo này với bối cảnh về tình trạng tài sản trước đây như thế nào.

Để có được trạng thái hiện tại của tài sản, chúng tôi gọi điểm cuối "nhận tài sản".

Đây là điểm cuối đồng bộ hóa tài sản mới, mà bạn có thể lưu ý bằng cả phương thức yêu cầu HTTP thích hợp của GET và URI có phiên bản.

Ở đây, chúng tôi đang truy vấn với các tham số truy vấn của adamId và pricingParam để nhận trạng thái của một tài sản duy nhất.

Chúng tôi hiện đang yêu cầu mã thông báo máy chủ hoặc mã thông báo s được cung cấp trong tiêu đề ủy quyền của tất cả các yêu cầu API mới ở định dạng mã thông báo mang này.

Chúng tôi thấy trong mảng tài sản của phản hồi này đối với tài sản mà chúng tôi quan tâm, có 10.000 có sẵn để chuyển nhượng và tổng cộng 15.000.

Khi việc mua xảy ra, bạn sẽ nhận được thông báo này.

Chúng tôi thấy trong tải trọng, adamId cho tài sản đã được mua.

Sau đó là delta, trong trường hợp này là một số nguyên dương.

Điều này có thể biểu thị việc mua hoặc chuyển nhượng.

Bạn sẽ sử dụng delta này để cập nhật số lượng của mình mà không cần thực hiện một cuộc gọi nào khác đến điểm cuối đồng bộ hóa tài sản.

Các loại thông báo cuối cùng dành cho người dùng đã đăng ký.

Hầu hết các triển khai đều dựa trên các bài tập dựa trên thiết bị, nhưng khi bạn cần gán nội dung cho người dùng, việc tạo người dùng đã đăng ký là bước đầu tiên.

Sau đó, việc liên kết những người dùng này với ID Apple cá nhân hoặc được quản lý là cần thiết để triển khai.

Để ID Apple cá nhân của người dùng được liên kết với người dùng đã đăng ký cho một sToken nhất định, người dùng phải chấp nhận lời mời liên kết ID Apple của họ.

Giờ đây, với các thông báo người dùng đã đăng ký, bạn sẽ được cập nhật theo thời gian thực với trạng thái mới nhất của người dùng, cho cả việc tạo ban đầu và chấp nhận lời mời tiếp theo của họ.

Bạn đăng ký quản lý người dùng và các loại thông báo liên quan đến người dùng trong cấu hình máy khách để nhận những thứ này.

Sau đó, Apple sẽ thông báo cho bạn khi trạng thái người dùng bị thay đổi bằng cách tạo, liên kết, cập nhật hoặc loại bỏ các sự kiện người dùng.

Các thông báo liên quan đến người dùng đặc biệt cho phép bạn theo dõi tốt hơn khi người dùng đã chấp nhận lời mời liên kết ID Apple của họ.

Chúng ta hãy xem một ví dụ về những thông báo này với bối cảnh về trạng thái của người dùng trước đây.

Để có được trạng thái hiện tại của người dùng, chúng tôi gọi điểm cuối get users.

Đây là điểm cuối đồng bộ hóa người dùng mới.

Ở đây, chỉ lọc cho người dùng mà chúng tôi quan tâm bởi tham số truy vấn clientUserId.

Điều này sẽ giới hạn kích thước phản hồi chỉ cho một người dùng.

Ở đây, chúng tôi có một số trường phân trang phổ biến được tìm thấy trên API đồng bộ hóa của chúng tôi, cho biết chỉ mục trang hiện tại, kích thước hoặc trong ngữ cảnh này, số lượng đối tượng người dùng trong trang hiện tại và tổng số trang trong truy vấn được cung cấp.

Trong mảng người dùng của chúng tôi, chúng tôi có thể thấy người dùng duy nhất mà chúng tôi quan tâm, trong trường hợp này, với trạng thái đã đăng ký, trái ngược với liên kết và mã lời mời.

Người dùng này rõ ràng vẫn chưa được liên kết với ID Apple.

Tất cả API đồng bộ hóa của chúng tôi cũng bao gồm một mã định danh phiên bản, sẽ thay đổi bất cứ khi nào ghi xảy ra với dữ liệu cơ bản.

Điều này có thể cực kỳ hữu ích khi duyệt qua các phản hồi lớn để cho biết khi nào dữ liệu trên các trang trước có thể đã thay đổi.

Bạn có thể liên kết ID Apple được quản lý với người dùng đã đăng ký bằng cách sử dụng điểm cuối người dùng cập nhật mới.

Điều này dẫn đến thông báo người dùng đã đăng ký như được thấy ở đây.

Trong tải trọng thông báo của chúng tôi, chúng tôi thấy những người dùng có trạng thái đã cố gắng bị thay đổi, mã định danh duy nhất cho sự kiện không đồng bộ do MDM này kích hoạt, kết quả của việc thay đổi trạng thái, cho dù thành công hay thất bại, loại thay đổi đối với trạng thái người dùng, đây là bản cập nhật.

Nhìn vào mảng người dùng, chúng tôi thấy clientUserId cho trạng thái người dùng mà chúng tôi quan tâm, chứa idHash và trạng thái được liên kết, kết luận rằng liên kết ID Apple được quản lý đã thành công.

Bạn sử dụng điều này để cập nhật trạng thái của người dùng này mà không cần thực hiện cuộc gọi nào khác đến điểm cuối đồng bộ hóa người dùng.

Thay vì bạn liên kết, thay vào đó bạn có thể cung cấp cho người dùng một liên kết lời mời để liên kết ID Apple của riêng họ với người dùng đã đăng ký.

Ở đây, chúng tôi đang xem xét thông báo người dùng được liên kết đó.

Chúng tôi thấy trong tải thông báo đối tượng người dùng chứa thông tin liên quan đến người dùng được liên kết bao gồm nhưng không giới hạn ở clientUserId của họ, idHash cho biết ID Apple được liên kết, mã mời mà họ chấp nhận và trạng thái biểu thị được liên kết.

Bạn sử dụng điều này để cập nhật trạng thái của người dùng này mà không cần thực hiện cuộc gọi nào khác đến điểm cuối đồng bộ hóa người dùng.

Hãy nói về cách bạn đăng ký để nhận những thông báo này.

Bạn phải chọn tham gia thông qua cấu hình máy khách cho mỗi sToken bạn quản lý.

Bạn cung cấp một bí mật được chia sẻ để xác thực với notificationAuthToken và notificationUrl để đăng những thứ này lên.

Mã thông báo được sử dụng để xác minh rằng những thông báo này, trên thực tế, đến từ Apple và điều này có thể được cập nhật bất cứ lúc nào thông qua cấu hình khách hàng.

Cung cấp phản hồi cấp HTTP 200 khi bạn nhận được thông báo để cho Apple biết rằng chúng đã được gửi thành công.

Apple sẽ cố gắng thử lại thông báo nếu phản hồi không phải 200 được trả về hoặc thời gian chờ xảy ra.

Apple sẽ cung cấp dịch vụ giao hàng nỗ lực tốt nhất.

Nỗ lực liên lạc với bạn này sẽ được thực hiện một vài lần trước khi loại bỏ thông báo.

Điều này có nghĩa là nếu bạn không thể nhận được thông báo trong bất kỳ khoảng thời gian nào, bạn sẽ cần thăm dò ý kiến về trạng thái mới nhất.

Chỉ đồng bộ hóa cho những gì bạn biết ở trong trạng thái có khả năng cũ do các thông báo bị bỏ lỡ.

Cải tiến lớn thứ hai được đưa vào API mới này là xử lý không đồng bộ.

Trong phiên bản ban đầu của API, tất cả việc quản lý được thực hiện đồng bộ.

Bạn đưa ra yêu cầu quản lý một số tài sản và Apple thực hiện quản lý trong khi bạn chờ phản hồi đồng bộ.

Điều này có nghĩa là bạn đã xử lý tính song song, trong khi xử lý không đồng bộ cho phép tính song song do máy chủ thực thi ở cuối Apple.

Điều này dẫn đến việc tối ưu hóa quá trình xử lý, dẫn đến các yêu cầu lớn hơn được thực hiện nhanh hơn.

Xử lý theo đơn đặt hàng làm giảm số lượng lỗi không liên tục và các lần thử lại tiếp theo do các mẫu yêu cầu cụ thể của bạn.

Và điều này cuối cùng dẫn đến việc triển khai lớn không căng thẳng, và, đối với giáo dục, các mùa tựu trường dễ dàng hơn.

Apple đã được hưởng lợi từ việc xử lý không đồng bộ cho Ứng dụng và Sách, mua hàng và chuyển khoản trong cả Apple School Manager và Apple Business Manager, cho phép các tổ chức xem hàng tồn kho trong vài phút thay vì hàng giờ.

Hãy xem cách tất cả điều này kết hợp với nhau để tạo ra trải nghiệm quản lý Ứng dụng và Sách mới tuyệt vời.

Giả sử có một tổ chức mà bạn quản lý với 10.000 người dùng, mỗi người có thiết bị riêng của họ.

Và bạn được yêu cầu chỉ định 25 ứng dụng quan trọng cho các công việc hàng ngày của chúng cho mỗi thiết bị.

Bạn đang xem xét thực hiện 250.000 bài tập.

Hãy xem trước đây bạn sẽ làm điều này như thế nào.

Máy chủ của bạn yêu cầu Apple quản lý giấy phép.

Apple trả lại phản hồi cho bạn một cách đồng bộ.

Phản hồi này sẽ chứa các giấy phép được gán cho các thiết bị được yêu cầu.

Yêu cầu duy nhất này chỉ quản lý một ứng dụng tối đa mười thiết bị, dẫn đến chỉ có mười bài tập.

Điều này yêu cầu tối thiểu 25.000 yêu cầu để thực hiện 250.000 bài tập.

Với API mới, 25.000 yêu cầu tối thiểu này chỉ trở thành 10 yêu cầu, tất cả đều có thể thực hiện được bằng cách chuyển sang xử lý không đồng bộ.

Hãy xem cách bạn đạt được điều này.

Ở bên trái, bây giờ chúng tôi đã bổ sung máy chủ thông báo của bạn.

Quá trình vẫn bắt đầu với việc bạn yêu cầu Apple quản lý tài sản.

Trong yêu cầu, bạn cung cấp sToken trong tiêu đề ủy quyền.

Bây giờ bạn có thể cung cấp cho chúng tôi nhiều tài sản trong một yêu cầu duy nhất, hiện tại tối đa 25 tài sản.

Giới hạn động này được hiển thị trong cấu hình dịch vụ và cung cấp tối đa 1.000 thiết bị để thực hiện phân công, một giới hạn động khác cũng được hiển thị trong cấu hình dịch vụ.

Apple sẽ trả lại phản hồi đồng bộ cho bạn.

Trong phản hồi này, chúng tôi có mã trạng thái HTTP, điều này rất quan trọng đối với API mới này.

Chúng tôi trả lại mã trạng thái không phải 200 thích hợp cho các lỗi, vì vậy ban đầu bạn nên thẩm vấn phản hồi để đảm bảo đó là 200 trước khi tiếp tục.

Sau đó, quan trọng nhất, chúng tôi có mã định danh duy nhất cho sự kiện không đồng bộ này có trạng thái có thể nhận được từ việc gọi điểm cuối trạng thái sự kiện mới của chúng tôi hoặc bằng cách chờ thông báo phân công phù hợp.

Khi bài tập hoàn tất, giả sử bạn đã đăng ký, Apple sẽ đăng thông báo cho bạn.

Trong mỗi thông báo này, chúng tôi có một tập hợp con các bài tập được yêu cầu được liệt kê trong tải trọng thông báo của chúng tôi, siêu dữ liệu liên quan đến các bài tập, cho biết đó là thành công hay thất bại, loại và ID sự kiện tương ứng.

Bạn nên đợi các thông báo phân công thành công này sau đó tiến hành gửi các lệnh cài đặt đến các thiết bị được liệt kê.

Một ưu điểm khác của các điểm cuối quản lý mới của chúng tôi là Đặt hàng.

Giả sử bạn nhận được yêu cầu gán lại một số tài sản từ nhóm người dùng này sang nhóm người dùng khác.

Điều này có thể đạt được bằng cách bạn liên tục kích hoạt một sự tách rời theo sau là một yêu cầu liên kết.

Đầu tiên, bạn đăng yêu cầu không liên quan.

Apple sau đó phản hồi bằng ID sự kiện cho người không liên kết.

Sau đó, bạn đăng yêu cầu liên kết tiếp theo.

Apple phản hồi bằng một ID sự kiện khác, nhưng lần này, cho cộng sự.

Giả sử bạn đã đăng ký, Apple sẽ đăng thông báo cho bạn khi việc tách rời hoàn tất.

Sau đó, Apple sẽ đăng thông báo cho bạn khi các hiệp hội hoàn tất.

Những thay đổi lớn đối với API của chúng tôi, như thông báo, cho phép bạn giữ trạng thái của mình đồng bộ với Apple, loại bỏ nhu cầu liên tục đưa ra các yêu cầu để đảm bảo bạn có trạng thái mới nhất.

Xử lý không đồng bộ cho phép mọi người có trải nghiệm tốt hơn, cho dù đó là nhân viên hay sinh viên có quyền truy cập vào nội dung họ cần, quản trị viên CNTT thực hiện triển khai lớn một cách nhanh chóng hay bạn quản lý hiệu quả tài sản của tổ chức.

API kế thừa sẽ tiếp tục được hỗ trợ tại thời điểm này.

Lưu ý rằng việc sử dụng các phiên bản API mới và kế thừa kết hợp với cùng một mã thông báo sẽ không được hỗ trợ chính thức.

API mới này là con đường phía trước cho Quản lý Ứng dụng và Sách và có sẵn ngày hôm nay.

Chúng tôi mong muốn bạn thử nghiệm và tích hợp với API mới này càng sớm càng tốt, cung cấp cho người dùng của bạn trải nghiệm Quản lý Sách và Ứng dụng tốt nhất có thể.

Để biết thêm thông tin chi tiết, vui lòng xem tài liệu cập nhật dành cho nhà phát triển của chúng tôi.

Cảm ơn bạn đã dành thời gian và hy vọng bạn tận hưởng phần còn lại của WWDC.

[Nhạc gõ ethereal].