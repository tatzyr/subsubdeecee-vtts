10269

♪ Nhạc bass đang phát ♪

♪

Itai Rom: Chào mừng đến với "Tùy chỉnh quy trình làm việc Xcode Cloud nâng cao của bạn."

Tên tôi là Itai, và tôi sẽ được tham gia sau bởi đồng nghiệp của tôi, Yan.

Năm nay chúng tôi giới thiệu Xcode Cloud.

Xcode Cloud là một dịch vụ tích hợp và phân phối liên tục được tích hợp trong Xcode và được thiết kế dành riêng cho các nhà phát triển Apple.

Trong các phiên khác, chúng tôi đã chỉ ra cách bạn có thể thiết lập quy trình làm việc đầu cuối để liên tục xây dựng, kiểm tra và phân phối các ứng dụng của mình.

Trong phiên này, chúng ta sẽ nói về một số tính năng nâng cao hơn mà bạn có thể sử dụng để tùy chỉnh Xcode Cloud để phù hợp hơn với nhu cầu của nhóm bạn.

Xcode Cloud được thiết kế để tích hợp với các công cụ và dịch vụ của nhà phát triển Apple - như trang web của nhà phát triển, TestFlight và App Store Connect - ngay lập tức.

Nó cũng tích hợp với các công cụ phát triển thiết yếu hàng ngày của bạn, như tất cả các nhà cung cấp kiểm soát nguồn dựa trên Git chính và thậm chí cả Slack để nhắn tin.

Tuy nhiên, bạn có thể có các công cụ nội bộ hoặc độc quyền và các dịch vụ bên ngoài khác là một phần quan trọng trong quy trình của bạn.

Trong phiên này, chúng tôi sẽ trình bày cách bạn có thể tùy chỉnh Xcode Cloud để tích hợp tốt với các công cụ và dịch vụ này.

Chúng tôi sẽ đề cập đến bốn chủ đề tùy chỉnh.

Đầu tiên, chúng ta sẽ thảo luận về việc sử dụng các biến môi trường để chuyển thêm các bit thông tin vào các bản dựng của bạn.

Chúng ta sẽ học cách sử dụng các tập lệnh để chạy các lệnh tùy chỉnh trong các hành động bạn chạy trong bản dựng của mình.

Và cũng như cách thêm các kho lưu trữ nguồn khác mà bạn cần trong quá trình xây dựng.

Và cuối cùng, cách bạn có thể sử dụng webhooks để tích hợp Xcode Cloud với các hệ thống khác mà nhóm của bạn sử dụng.

Có rất nhiều thứ để đề cập, vì vậy hãy đi thẳng vào nó với các biến môi trường.

Khi bạn lập kế hoạch và định cấu hình quy trình làm việc cho dự án của mình, có thể có những lúc bạn muốn hành vi xây dựng của mình hơi khác nhau tùy thuộc vào quy trình làm việc đang chạy.

Ví dụ: nếu ứng dụng của bạn phụ thuộc vào dịch vụ API, bạn có thể muốn các thử nghiệm của mình sử dụng môi trường dàn dựng thay vì sản xuất.

Trong trường hợp này, bạn muốn chuyển một URL khác cho dịch vụ API vào các bài kiểm tra của mình.

Các biến môi trường cho phép bạn làm điều đó.

Chúng là các cặp khóa-giá trị đơn giản cho phép bạn xác định một số thông tin mà bạn có thể sử dụng để kiểm soát hơn nữa hành vi của bản dựng của mình.

Bạn có thể cấu hình bất kỳ biến môi trường nào bạn cần ngay trong phần Môi trường trong quy trình làm việc của mình.

Vì chúng là một phần của cấu hình quy trình làm việc của bạn, bạn không cần phải cam kết bất kỳ thông tin bổ sung nào vào kho lưu trữ nguồn của mình.

Mỗi khi quy trình làm việc của bạn chạy, các biến bạn đã xác định sẽ được đặt trong môi trường đang chạy các hành động.

Đối với thông tin nhạy cảm, như khóa API hoặc mã thông báo truy cập, bạn có thể định cấu hình một biến môi trường bí mật.

Các biến môi trường bí mật được xử lý an toàn.

Chúng luôn được mã hóa và lưu trữ an toàn và các giá trị được giải mã của chúng chỉ khả dụng trong môi trường tạm thời được sử dụng để chạy các hành động của bạn.

Các giá trị cũng được biên tập lại từ nhật ký và bạn không thể xem chúng trong trình chỉnh sửa quy trình làm việc như bạn có thể cho một biến không bí mật.

Tạo một bí mật biến đổi môi trường thật dễ dàng.

Chỉ cần chọn hộp kiểm "Bí mật" trong bảng biến môi trường.

Giá trị của biến môi trường của bạn sau đó sẽ bị ẩn khỏi chế độ xem và một khi bạn lưu thay đổi của mình, sẽ được lưu trữ an toàn và không thể xem được nữa trong trình chỉnh sửa quy trình làm việc.

Các biến môi trường cung cấp một cơ chế tiện dụng để tùy chỉnh hành vi và chuyển thông tin bổ sung vào quy trình làm việc của bạn.

Chúng thậm chí còn mạnh hơn khi kết hợp với tính năng nâng cao tiếp theo của chúng tôi: các tập lệnh tùy chỉnh.

Giữa quy trình làm việc của Xcode Cloud và các sơ đồ của Xcode, bạn có rất nhiều sự linh hoạt trong cách bạn có thể thiết lập các hành động mà bạn muốn chạy trong quy trình làm việc của mình.

Nhưng đôi khi bạn sẽ cần chạy logic tùy chỉnh hoặc các lệnh bổ sung trong một hành động và các tập lệnh tùy chỉnh cung cấp một cách mạnh mẽ và linh hoạt để đạt được điều này.

Tập lệnh tùy chỉnh là tập lệnh shell mà bạn viết và đưa vào kho lưu trữ nguồn của mình.

Các tập lệnh tùy chỉnh của bạn được chạy trong mỗi hành động trong quy trình làm việc của bạn.

Có ba loại tập lệnh có sẵn: tập lệnh post-clone, tập lệnh pre-Xcodebuild và tập lệnh post-Xcodebuild.

Mỗi lần Xcode Cloud chạy một hành động, nó thực hiện một loạt các bước và mỗi tập lệnh tùy chỉnh, như được gợi ý bởi tên của nó, được chạy như một bước tại một điểm cụ thể trong một hành động.

Đầu tiên, Xcode Cloud thiết lập một môi trường tạm thời và sao chép mã nguồn từ kho lưu trữ chính của bạn.

Sau đó, Xcode Cloud chạy tập lệnh post-clone.

Sau khi giải quyết tất cả các phụ thuộc nguồn khác, đám mây Xcode chạy tập lệnh pre-Xcodebuild.

Tiếp theo, Xcode Cloud chạy lệnh Xcodebuild tương ứng của hành động.

Khi bước Xcodebuild kết thúc, Xcode Cloud chạy tập lệnh sau Xcodebuild và lưu bất kỳ tạo tác nào mà nó đã tạo trước đó.

Nếu quy trình làm việc của bạn bao gồm một số hành động - ví dụ: nhiều hành động xây dựng - hoặc xây dựng, kiểm tra, phân tích và lưu trữ các hành động - Xcode Cloud sẽ chạy các tập lệnh tùy chỉnh của bạn vào những thời điểm thích hợp cho mỗi hành động.

Thêm một tập lệnh tùy chỉnh vào Xcode Cloud thật dễ dàng.

Bạn chỉ cần thêm một tập lệnh shell với tên thích hợp vào một thư mục có tên "ci_scripts", và đặt thư mục này ở cùng cấp độ với tệp dự án hoặc không gian làm việc bạn đang sử dụng trong quy trình làm việc của mình.

Vì các tập lệnh tùy chỉnh là một phần của mã nguồn của bạn, bạn có thể kiểm tra các thay đổi tập lệnh trong các yêu cầu kéo hoặc thậm chí tùy chỉnh hành vi của chúng trên các nhánh khác nhau.

Khi Xcode Cloud chạy các hành động của bạn, nó sẽ tìm kiếm sự tồn tại của từng tập lệnh vào thời điểm thích hợp và chạy chúng nếu chúng có mặt.

Bạn không cần phải định cấu hình quy trình làm việc của mình để chạy các tập lệnh tùy chỉnh của mình.

Nếu các kịch bản ở đó, chúng sẽ được chạy.

Lưu ý rằng tên của thư mục ci_scripts và các tập lệnh bên trong phải khớp chính xác với quy ước đặt tên này để Xcode Cloud tìm và chạy các tập lệnh của bạn.

Các biến môi trường mà bạn đã định cấu hình trong quy trình làm việc của mình có sẵn để sử dụng trong các tập lệnh tùy chỉnh của bạn, bao gồm các biến môi trường bí mật.

Ngoài ra, Xcode Cloud cũng cung cấp nhiều biến môi trường hữu ích khác.

Bạn có thể sử dụng các biến này để thêm kiểm soát luồng vào tập lệnh của mình, để bạn có thể đảm bảo các lệnh bạn muốn chạy được chạy tại các điểm chính xác trong quy trình làm việc của bạn.

Ví dụ: nếu bạn muốn kiểm tra xem hành động của mình có đang chạy cho iOS, macOS, tvOS hoặc watchOS hay không, bạn có thể sử dụng giá trị của biến CI_PRODUCT_PLATFORM.

Trong một kịch bản được nhắm mục tiêu nhiều hơn - có lẽ có một lệnh bạn chỉ muốn chạy trong hành động lưu trữ của một quy trình làm việc cụ thể - bạn có thể kiểm tra xem các biến CI_XCODEBUILD_ACTION và CI_WORKFLOW có khớp với hành động lưu trữ và quy trình làm việc cụ thể hay không trước khi chạy lệnh.

Hãy xem các tập lệnh tùy chỉnh đang hoạt động.

Nhóm của tôi làm việc trên một ứng dụng đặt hàng sinh tố có tên Fruta.

Trong phiên "Khám phá quy trình làm việc Xcode Cloud", bạn đã học cách thiết lập quy trình làm việc để xây dựng, kiểm tra và phân phối các ứng dụng, như Fruta.

Chúng tôi sử dụng Xcode Cloud để xây dựng và kiểm tra mỗi khi chúng tôi tạo yêu cầu kéo.

Chúng tôi cũng phân phối các bản dựng từ các yêu cầu kéo của chúng tôi cho các thành viên trong nhóm của chúng tôi thông qua TestFlight, cho phép họ xác minh và đăng xuất các thay đổi trước khi mã được hợp nhất.

Hôm nay, tôi muốn giúp các thành viên trong nhóm dễ dàng biết liệu bản dựng được cài đặt trên thiết bị của họ có phải từ yêu cầu kéo hay không.

Chúng ta có thể làm điều đó bằng cách sử dụng một biểu tượng ứng dụng khác khi chúng ta đang xây dựng từ một yêu cầu kéo.

Như bạn có thể đoán, việc sử dụng một tập lệnh tùy chỉnh giúp việc thiết lập điều này trở nên dễ dàng.

Hãy xem làm thế nào.

Trong Xcode, tôi đã mở dự án Fruta.

Trước khi tôi có thể thêm một tập lệnh tùy chỉnh, trước tiên tôi cần thêm một thư mục ci_scripts vào dự án của mình.

Tôi có thể làm điều này bằng cách chọn dự án của mình trong trình duyệt dự án và nhấp vào nút dấu cộng ở dưới cùng và sau đó chọn Nhóm mới.

Tôi sẽ nhập tên thư mục, ci_scripts.

Tiếp theo, tôi sẽ thêm bộ biểu tượng ứng dụng beta mà nhà thiết kế của chúng tôi đã tạo vào thư mục ci_scripts, để tập lệnh tùy chỉnh của tôi có thể hoán đổi nó vào vị trí trong quá trình xây dựng.

Để làm điều đó, tôi sẽ kéo nó vào thư mục ci_scripts của tôi từ Finder.

Trong trang tính, tôi sẽ bỏ chọn bất kỳ mục tiêu nào đã chọn và nhấp vào Kết thúc.

Cuối cùng, hãy thêm một tập lệnh pre-Xcodebuild.

Tập lệnh này sẽ chạy trước lệnh Xcodebuild và tôi sẽ sử dụng nó để hoán đổi biểu tượng ứng dụng mặc định của Fruta được đặt với biểu tượng ứng dụng beta được đặt khi thích hợp.

Tôi đã tạo một tập lệnh để sử dụng, vì vậy tất cả những gì tôi cần làm là thêm nó vào thư mục ci_scripts.

Một lần nữa, tôi sẽ bỏ chọn bất kỳ mục tiêu nào trong trang tính và nhấp vào Kết thúc.

Bây giờ kịch bản của tôi đã được đặt đúng chỗ, chúng ta hãy xem xét kỹ hơn những gì nó hoạt động.

Đầu tiên, tôi muốn đảm bảo rằng biểu tượng ứng dụng chỉ được hoán đổi khi bản dựng đến từ một yêu cầu kéo.

Tôi có thể sử dụng một trong những biến môi trường mà Xcode Cloud cung cấp để kiểm tra trong thời gian chạy xem bản dựng có phải là yêu cầu kéo hay không.

Có nhiều biến môi trường liên quan đến các yêu cầu kéo mà tôi có thể sử dụng cho việc này, nhưng trong trường hợp này tôi sẽ kiểm tra xem biến môi trường CI_PULL_REQUEST_NUMBER đã được đặt chưa.

Ngoài ra, tôi chỉ muốn biểu tượng ứng dụng beta được sử dụng cho các bản dựng được phân phối cho TestFlight.

Bất cứ khi nào Xcode Cloud phân phối một bản dựng cho TestFlight, nó luôn xây dựng một kho lưu trữ của dự án trước.

Vì vậy, một cách tốt để kiểm tra điều này là xác minh xem giá trị của biến môi trường CI_XCODEBUILD_ACTION có phải là "lưu trữ" hay không.

Nếu cả hai biến môi trường này đều có giá trị mong đợi, thì tôi sẽ xóa bộ biểu tượng ứng dụng hiện có và thay thế nó bằng bộ biểu tượng ứng dụng beta bằng các lệnh rm và mv.

Ngoài ra, hãy lưu ý rằng tôi đang sử dụng biến môi trường CI_WORKSPACE để xây dựng đường dẫn phù hợp cho cả bộ biểu tượng ứng dụng mặc định và beta.

Tất cả những gì còn lại cần làm là mở một yêu cầu kéo với những thay đổi này và đợi Xcode Cloud xây dựng và phân phối Fruta cho TestFlight.

Thay vì trải qua quá trình đó ngay bây giờ, tôi đã chuẩn bị một bản dựng trước thời hạn.

Ở đây, Xcode Cloud đã xây dựng và phân phối Fruta từ nhánh yêu cầu kéo của tôi.

Trong ứng dụng TestFlight trên điện thoại của tôi, tôi có thể xác minh rằng bản dựng của tôi đang sử dụng biểu tượng ứng dụng beta mới mà tôi vừa thêm.

Bây giờ tôi có thể hợp nhất yêu cầu kéo của mình và mọi người trong nhóm sẽ bắt đầu thấy cùng một biểu tượng ứng dụng beta trong các bản dựng của các yêu cầu kéo của riêng họ.

Bây giờ chúng ta đã thấy cách sử dụng các tập lệnh tùy chỉnh trong Xcode Cloud, có một vài điều quan trọng cần lưu ý về chúng.

Đầu ra tiêu chuẩn và lỗi tiêu chuẩn từ các tập lệnh tùy chỉnh của bạn được bao gồm trong nhật ký cho hành động mà chúng đã chạy và chúng cũng có thể được tải xuống từ tab Hiện vật.

Nếu tập lệnh của bạn dường như không chạy khi bạn mong đợi, hãy kiểm tra kỹ xem bạn đã đặt tên chính xác chưa và đặt nó vào thư mục ci_scripts cùng với dự án hoặc không gian làm việc của bạn.

Đảm bảo thêm ghi nhật ký và khả năng phục hồi hữu ích để hỗ trợ bạn khắc phục mọi lỗi trong các tập lệnh tùy chỉnh của mình.

Ví dụ: nếu tập lệnh của bạn thực hiện các yêu cầu mạng đối với các dịch vụ bên ngoài, bạn có thể muốn bao gồm logic để thử lại các yêu cầu đó với tính năng ghi nhật ký chi tiết được bật.

Ngoài ra, Xcode Cloud tôn trọng mã thoát của các tập lệnh của bạn.

Vì vậy, nếu tập lệnh của bạn thoát với giá trị khác 0, Xcode Cloud sẽ coi đây là một thất bại và sẽ thất bại trong hành động tổng thể.

Bạn có thể tận dụng điều này để đảm bảo rằng các lệnh bạn cần chạy trong tập lệnh của mình thành công trước khi Xcode Cloud tiếp tục với phần còn lại của hành động.

Cuối cùng, cần lưu ý rằng trong một hành động thử nghiệm, nhiều môi trường được sử dụng để xây dựng và chạy các thử nghiệm của bạn.

Chỉ có môi trường được sử dụng để xây dựng các bài kiểm tra của bạn mới có mã nguồn của bạn được nhân bản vào nó theo mặc định.

Các môi trường chạy thử nghiệm của bạn sẽ không có mã nguồn được nhân bản vào chúng.

Họ sẽ chỉ có thư mục ci_scripts được cung cấp trên chúng.

Kết quả là, tập lệnh sau sao chép sẽ không chạy trong các môi trường này và các tập lệnh tùy chỉnh của bạn và bất kỳ phụ thuộc nào của chúng, chẳng hạn như các tập lệnh shell khác và các công cụ nhỏ, phải được chứa hoàn toàn trong thư mục ci_scripts.

Với các tập lệnh tùy chỉnh và các biến môi trường, bạn có hai công cụ mạnh mẽ để tùy chỉnh hành vi của quy trình làm việc của mình.

Tiếp theo, đồng nghiệp Yan của tôi sẽ chỉ cho bạn cách sử dụng các kho lưu trữ bổ sung với Xcode Cloud để bạn có thể sử dụng các gói Swift và các phụ thuộc khác trong quy trình làm việc của mình.

Yan Huang: Cảm ơn, Itai.

Nhiều dự án được xây dựng bằng cách sử dụng các công cụ, thư viện và khuôn khổ.

Những phụ thuộc đó thường được lưu trữ trong kho lưu trữ Git được chia sẻ giữa các dự án và chúng cần được truy xuất để dự án của bạn xây dựng thành công.

Xcode Cloud tự động giúp thêm các kho lưu trữ bổ sung này.

Ví dụ, chúng tôi muốn thêm một tính năng mới để cho phép người dùng mời bạn bè của họ và chia sẻ đồ uống vào ứng dụng Fruta.

Một nhóm khác đã triển khai một tính năng tương tự.

Vì vậy, chúng tôi sẽ sử dụng lại gói của họ có tên là "InvitationsKit", được lưu trữ trên kho lưu trữ Git riêng tư được chia sẻ với nhóm của tôi.

Hãy xem cách thêm gói này.

Tôi ở đây trong Xcode với dự án Fruta.

Tôi có thể thêm một gói từ menu Tệp và chọn Thêm Gói.

Tôi đã có bộ sưu tập các gói được chia sẻ của Nature Labs, trong đó có danh sách các gói trong tổ chức của chúng tôi.

Tôi sẽ chọn InvitationsKit và nhấp vào Add Package.

Bây giờ sự phụ thuộc đã được thêm vào, tôi sẽ cam kết sự phụ thuộc mới này từ menu Kiểm soát Nguồn và đẩy các thay đổi của tôi đến chi nhánh của tôi.

Chúng tôi thiết lập một quy trình làm việc trong Xcode Cloud sẽ bắt đầu một bản dựng mới khi nó nhận được một cam kết mới từ bất kỳ chi nhánh nào.

Vì vậy, cam kết mới này sẽ bắt đầu một bản dựng mới.

Vì đây là lần đầu tiên chúng tôi thêm sự phụ thuộc này, tôi hy vọng rằng việc xây dựng sẽ thất bại vì Xcode Cloud không có quyền truy cập vào kho lưu trữ InvitationsKit.

Nhưng Xcode Cloud cung cấp một giao diện người dùng dễ dàng để giải quyết vấn đề này.

Hãy đến Xcode Cloud trong App Store Connect và xem bản dựng mới này.

Đúng như dự đoán, việc xây dựng đã thất bại.

Xcode Cloud hiển thị một biểu ngữ cảnh báo chỉ ra rằng nó có vấn đề với việc truy cập kho lưu trữ và cung cấp cho tôi tùy chọn cấp quyền truy cập vào nó.

Tôi tiếp tục và nhấp vào nút Quản lý Kho lưu trữ.

Nó đưa tôi đến trang cài đặt, nơi tôi có thể di chuột qua liên kết kho lưu trữ invitationsKit và sau đó nhấp vào Grant.

Tùy thuộc vào dịch vụ kiểm soát nguồn của bạn, bạn có thể được hướng dẫn phê duyệt Xcode Cloud để truy cập kho lưu trữ.

Tôi đã tiếp tục và cung cấp quyền truy cập vào InvitationsKit trong Github.

Bây giờ, khi tôi nhìn lại trong Xcode Cloud, nó hiển thị Quyền truy cập được cấp.

Bây giờ tôi có thể chạy lại bản dựng.

Chúng tôi hy vọng lần này sẽ qua đời.

Bạn có thể quay lại phần Kho lưu trữ bổ sung trong Cài đặt để tìm hiểu tất cả các kho lưu trữ đã được kết nối.

Bạn cũng có thể từ chối quyền truy cập từ đó nếu chúng không còn được sử dụng nữa.

Xcode Cloud sẽ phát hiện các kho lưu trữ mới được tham chiếu trong quá trình xây dựng.

Khi chúng tôi thêm một phụ thuộc mà Xcode Cloud không có quyền truy cập, giao diện người dùng cung cấp một cách nhanh chóng và dễ dàng để khắc phục sự cố này.

Điều này có giá trị cho bất kỳ hoạt động Git nào bao gồm nhân bản kho lưu trữ bên trong tập lệnh tùy chỉnh hoặc tham chiếu mô-đun con Git.

Điều này cũng áp dụng cho tất cả các công cụ quản lý phụ thuộc khác.

Trong bản demo này, chúng tôi đã sử dụng tính năng Swift Packages Collection mới để bao gồm một gói bổ sung.

Nếu bạn muốn tìm hiểu thêm về nó, hãy xem "Khám phá và quản lý các gói Swift bằng Bộ sưu tập."

Cho đến nay chúng tôi đã chứng minh cho bạn cách tùy chỉnh bản dựng của bạn trong Xcode Cloud.

Nhưng đôi khi bạn và nhóm của bạn cũng có thể muốn cộng tác thông qua các dịch vụ bên ngoài.

Ví dụ, bạn có thể muốn thông báo cho những người thử nghiệm beta khi một bản dựng mới đã sẵn sàng.

Đây là nơi webhooks có thể đến để giúp đỡ.

Webhooks cung cấp một cách để Xcode Cloud giao tiếp với các dịch vụ của bạn.

Với tải trọng phong phú được gửi ở các giai đoạn khác nhau của vòng đời xây dựng, bạn sẽ có thể tự động hóa hơn nữa quy trình làm việc của mình và cải thiện sự hợp tác của nhóm.

Hãy đi sâu vào để tìm hiểu thêm về nó.

Bạn có thể thiết lập webhooks trong Xcode Cloud để nhận các bản cập nhật theo thời gian thực ở ba giai đoạn khác nhau trong bản dựng của bạn.

Đầu tiên, khi bản dựng được tạo, hoặc vì bạn đã đẩy một số mã hoặc bắt đầu xây dựng theo cách thủ công; sau đó, khi bản dựng đang bắt đầu; cuối cùng, khi bản dựng đã hoàn thành, bất kể bản dựng thất bại hay thành công.

Hãy xem cách thêm một webhook mới vào dự án của chúng tôi Thêm webhooks thật dễ dàng trong Xcode Cloud.

Nhấp vào tab Cài đặt ở cột bên trái.

Nhấp vào Webhooks và sau đó nhấp vào nút dấu cộng.

Sau đó, nó sẽ yêu cầu bạn nhập tên webhook của bạn và URL vào một ứng dụng hoặc các dịch vụ có khả năng nhận và xử lý các yêu cầu HTTP.

Sau đó, nhấp vào Lưu.

Xcode Cloud cho phép bạn tạo tối đa năm webhooks cho mỗi sản phẩm.

Đảm bảo cung cấp một tên duy nhất cho mỗi webhooks của bạn để đảm bảo bạn có thể dễ dàng xác định chúng.

Tải trọng được gửi đến điểm cuối của bạn là một đốm màu JSON với thông tin về bản dựng và sản phẩm của bạn, chẳng hạn như ứng dụng App Store Connect, quy trình làm việc, sản phẩm, bản dựng của bạn và hơn thế nữa.

Bạn cần thiết lập một ứng dụng hoặc một dịch vụ để nhận và xử lý tải trọng được gửi qua HttpRequest.

Chúng ta hãy xem mã mẫu về cách đạt được điều đó bằng Swift trên AWS Lambda.

Đầu tiên, chúng tôi nhận được yêu cầu.

Sau đó giải mã tải trọng của nó thành một đối tượng JSON.

Sau đó, chúng tôi kiểm tra tên của quy trình làm việc và trạng thái xây dựng.

Nếu quy trình làm việc là quy trình phát hành và trạng thái xây dựng đã thành công, chúng tôi sẽ đăng một tin nhắn lên Twitter để cho người thử nghiệm hoặc người dùng beta biết rằng nó có sẵn để thử nghiệm.

Cuối cùng, chúng tôi sẽ trả lại mã trạng thái 200 để xác nhận rằng yêu cầu webhook đã được xử lý thành công.

Nếu bạn muốn tìm hiểu thêm về việc chạy các chức năng không máy chủ Swift, hãy xem phiên này trong WWDC 2020.

Nếu điểm cuối của bạn không trả về mã trạng thái thành công, Xcode Cloud sẽ cố gắng gửi lại yêu cầu.

Xcode Cloud cũng giúp bạn dễ dàng kiểm tra nội dung của các webhook đã được gửi đến điểm cuối của bạn.

Bạn có thể truy cập Xcode Cloud trong App Store Connect; nhấp vào cài đặt của bạn và webhook; chọn webhook bạn muốn kiểm tra.

Sau đó, nó hiển thị cho bạn danh sách các giao hàng tại các dấu thời gian khác nhau và chọn giao hàng mà bạn quan tâm.

Nó hiển thị cho bạn yêu cầu đã được gửi đến dịch vụ của bạn và phản hồi đã nhận được.

Có rất nhiều thứ bạn có thể làm với webhooks Xcode Cloud.

Đây là một vài ví dụ bổ sung.

Bạn có thể tự động tạo hoặc giải quyết các vấn đề từ hệ thống kiểm tra lỗi của mình; gửi thông báo đến hệ thống phân trang khi bản dựng không thành công; bắt đầu các bản dựng hạ nguồn như một phần của quy trình phát hành phức tạp.

Khi nói đến việc mở rộng quy trình làm việc của bạn bằng cách sử dụng nội dung đầy đủ của webhook, bầu trời là giới hạn.

Hãy tóm tắt lại những gì chúng ta đã học được trong phiên này.

Đầu tiên, chúng tôi đã học về cách chuyển các biến môi trường cho bản dựng của bạn.

Sau đó, chúng tôi đã trình bày cách thiết lập các tập lệnh để tùy chỉnh quy trình xây dựng của bạn và cách làm việc với các kho lưu trữ bổ sung trong dự án của bạn.

Cuối cùng, chúng tôi đã học cách thiết lập webhooks để nhận cuộc gọi lại từ Xcode Cloud ở các giai đoạn khác nhau của vòng đời xây dựng.

Chúng tôi hy vọng những tính năng này có thể nâng cao quy trình làm việc hàng ngày của nhóm bạn.

Cảm ơn bạn đã xem.

♪