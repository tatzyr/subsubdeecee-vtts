10289

♪ Nhạc bass đang phát ♪

♪

Jeff Robertson: Chào mừng bạn đến với phần thứ hai của bài nói chuyện của chúng tôi về việc xây dựng một ứng dụng Mac tuyệt vời trong SwiftUI.

Tôi là Jeff, một kỹ sư trong nhóm SwiftUI.

Tôi hy vọng bạn thích phần đầu tiên của bài nói chuyện này của đồng nghiệp Mathieu của tôi.

Nếu bạn chưa xem phần một, vui lòng dừng lại ở đây và làm như vậy ngay bây giờ, vì chúng tôi sẽ xây dựng dựa trên những thay đổi được thảo luận trong buổi nói chuyện đó.

Ứng dụng làm vườn của chúng tôi đã đi một chặng đường dài kể từ khi bắt đầu cuộc nói chuyện của Mathieu.

SwiftUI cho phép chúng tôi xây dựng một ứng dụng với khá nhiều chức năng trong thời gian rất ngắn.

Tuy nhiên, người dùng có xu hướng sử dụng các ứng dụng của chúng tôi theo nhiều cách khác nhau và một ứng dụng macOS đặc biệt tuyệt vời sẽ giải thích cho điều này.

Với ý nghĩ đó, chúng ta hãy xem xét một số cách mà chúng ta có thể xây dựng một ứng dụng cho mọi người trong khi vẫn duy trì các nguyên tắc Mathieu đã nêu trong phần một.

Đầu tiên, chúng ta sẽ xem xét ý nghĩa của việc trở thành một ứng dụng macOS hoàn toàn có thể tùy chỉnh, bằng cách xử lý các thay đổi đối với toàn bộ hệ thống cũng như trong ứng dụng của chúng ta.

Thêm một quy trình làm việc bổ sung cho người dùng của chúng tôi để thao tác dữ liệu của họ thông qua kéo và thả là một cách khác để chúng tôi cung cấp trải nghiệm người dùng linh hoạt.

Sau đó, chúng ta sẽ khám phá cách làm việc với hệ thống tệp, bằng cách cho phép xuất dữ liệu ứng dụng của chúng ta.

Và cuối cùng, chúng tôi sẽ thêm hỗ trợ cho Continuity Camera để tạo quy trình làm việc liền mạch để nhập hình ảnh vào ứng dụng của chúng tôi.

Điều đầu tiên tôi muốn nói với bạn không phải là bất kỳ API cụ thể nào cả, mà là nhiều hơn về cách một ứng dụng được xây dựng bằng SwiftUI phù hợp với khả năng tùy chỉnh của macOS.

Ở đây, tôi đã mở ứng dụng làm vườn của chúng tôi cũng như Tùy chọn hệ thống.

Tôi sẽ chuyển sang chế độ Tối và bạn có thể thấy ứng dụng của chúng tôi tự động cập nhật giao diện của nó.

Trong khi tôi mở Tùy chọn Hệ thống, tôi cũng sẽ cập nhật kích thước biểu tượng thanh bên của mình thành lớn.

Cũng giống như với chế độ Tối, ứng dụng của chúng tôi đã tự điều chỉnh theo những gì tôi đã đặt trong Tùy chọn Hệ thống.

Tôi thích những điểm nhấn nhỏ này, cả với tư cách là nhà phát triển - vì tôi tự động nhận được chúng - và với tư cách là người dùng - vì điều đó có nghĩa là các ứng dụng tôi đang sử dụng sẽ tính đến sở thích cá nhân của riêng tôi.

Trước khi tôi rời khỏi System Preferences để tập trung vào ứng dụng của chúng tôi, tôi muốn chỉ ra rằng tôi đã đặt màu nhấn của mình thành nhiều màu.

Tính năng này cho phép các nhà phát triển định cấu hình màu nhấn dành riêng cho ứng dụng; và hệ điều hành sẽ tùy chỉnh các nút, tô sáng lựa chọn và glyph thanh bên của ứng dụng của bạn.

Tôi muốn hỗ trợ màu nhấn trong ứng dụng của mình, vì vậy tôi sẽ mở danh mục tài sản trong dự án của chúng tôi và chọn AccentColor.

Và tôi sẽ thay đổi nội dung của nó thành màu xanh lá cây của hệ thống để phù hợp với chủ đề ứng dụng của chúng tôi.

Như bạn có thể thấy, các biểu tượng thanh bên và lựa chọn của chúng tôi đều đã nhận được sự thay đổi.

Chúng tôi đã thấy cách ứng dụng của chúng tôi có thể tự động phản ứng với những thay đổi ảnh hưởng đến toàn bộ hệ điều hành, nhưng còn cài đặt dành riêng cho ứng dụng thì sao?

Hãy cùng xem qua việc thêm một giao diện để cho phép người dùng tùy chỉnh ứng dụng làm vườn của chúng tôi.

Ở đây, tôi đã mở tệp GardenApp của chúng tôi.

Và cùng với cảnh WindowGroup, tôi sẽ thêm cảnh Cài đặt.

Và cảnh này sẽ cung cấp cho chúng ta một mục menu, khi được chọn, sẽ mở ra một cửa sổ với chế độ xem của chúng ta.

Tôi sẽ sử dụng SettingsView mà tôi đã thiết lập và tôi cũng sẽ chuyển nó cho mô hình của mình.

Ngoài ra, cảnh Cài đặt cũng sẽ thêm mục menu thích hợp vào menu chính của ứng dụng của bạn và định cấu hình nó bằng phím tắt tiêu chuẩn của Command-comma.

Điều này cho chúng ta một khởi đầu tuyệt vời.

Bây giờ, chúng ta hãy xem SettingsView, nơi tôi sẽ xác định giao diện.

Trên macOS, các ứng dụng thường cung cấp giao diện cài đặt với các biểu tượng thanh công cụ để cho phép chuyển đổi giữa các ngăn khác nhau, đặc biệt nếu ứng dụng cung cấp nhiều cài đặt có thể được chia thành các danh mục khác nhau.

Vì vậy, đối với quan điểm chính của tôi ở đây, tôi sẽ sử dụng TabView.

Và tôi sẽ cho nó hai đứa con: một cho Cài đặt chung và một cho Cài đặt xem.

Và đối với nội dung của tab trong khu vực thanh công cụ cửa sổ, tôi sẽ sử dụng tabItem.

Và nội dung của cái này chỉ có thể là một Nhãn.

Chúng tôi sẽ cung cấp cho nó văn bản được hiển thị - trong trường hợp này là "Chung" - và một hình ảnh hệ thống; Tôi sẽ sử dụng "thiết bị" cho Cài đặt chung.

Và sau đó hãy làm điều tương tự cho ViewingSettings của chúng ta.

Tôi sẽ thêm một tab Mục và một Nhãn - chúng tôi sẽ gọi nó là "Xem" - và một hệ thống Hình ảnh của, tôi nghĩ, "kính mắt".

Được rồi. Vì vậy, bây giờ chúng tôi có nội dung của hai tab của chúng tôi.

Hãy điền vào GeneralSettings ngay bây giờ.

Một cái gì đó có thể tốt cho người dùng của chúng tôi là khả năng xác định một khu vườn được sử dụng làm mặc định khi hiện tại không có khu vườn nào được chọn.

Đối với điều này, tôi sẽ thêm một Picker...

Và mục đầu tiên, tôi nghĩ, sẽ là Văn bản ("Không có").

Và đối với những người khác, tôi sẽ thêm một ForEach trên tất cả các khu vườn trong dữ liệu của chúng tôi.

Và đối với mỗi khu vườn, tôi sẽ chỉ thêm một Văn bản và đặt cho nó tên của khu vườn cũng như năm hiển thị của nó.

Chúng tôi cũng sẽ cần cung cấp một thẻ ở đây với ID của khu vườn.

Vì vậy, đối với giá trị "Không có" của chúng tôi, chúng tôi có thể cho nó một thẻ không có.

Và đối với các khu vườn khác của chúng tôi, chúng tôi sẽ cung cấp cho nó một thẻ tương ứng với ID của khu vườn.

Cuối cùng, chúng tôi cần cung cấp một số trạng thái cho lựa chọn của Picker.

Khi cung cấp giao diện cài đặt như thế này, điều quan trọng là phải duy trì trạng thái để ứng dụng của bạn ghi nhớ lựa chọn của người dùng qua các lần khởi chạy và cập nhật hệ điều hành.

Trong SwiftUI, điều này có thể được thực hiện bằng cách sử dụng trình bao bọc thuộc tính AppStorage.

Trình bao bọc thuộc tính này sẽ duy trì giá trị của chúng tôi bằng cách sử dụng hệ thống UserDefaults, đó chính xác là những gì chúng tôi muốn ở đây.

Vì vậy, để ràng buộc lựa chọn của chúng tôi, tôi sẽ thêm trình bao bọc thuộc tính AppStorage.

Cái này cần một chìa khóa.

Chúng tôi sẽ cho nó "khu vườn mặc định", và chúng tôi sẽ gọi nó là "lựa chọn".

Nó cũng là một Garden.ID tùy chọn.

Và những gì điều này sẽ làm là duy trì giá trị lựa chọn của chúng tôi bằng cách sử dụng hệ thống mặc định của người dùng.

Tôi cũng sẽ thêm một Kích thước cố định vào Bộ chọn của mình và một số phần đệm vào biểu mẫu.

Tôi sẽ chuyển sang Chế độ xem nội dung của chúng tôi tại đây và tôi sẽ thêm AppStorage của chúng tôi và cung cấp cho nó cùng một khóa mà chúng tôi đã sử dụng.

Chúng tôi sẽ gọi nó là "defaultGardenID", và nó cũng là một Garden.ID tùy chọn.

Và sau đó ở đây, nơi tôi có ràng buộc này để lựa chọn, tôi sẽ thay thế nó bằng Ràng buộc và "get" trước tiên sẽ là sử dụng ID Vườn đã chọn.

Và sau đó nếu điều đó không được thiết lập, chúng ta sẽ quay trở lại ID Vườn mặc định.

Và sau đó đối với setter, chúng tôi chỉ muốn cập nhật ID Garden đã chọn của mình.

Chúng tôi không thực sự muốn cập nhật defaultGarden của mình.

Vì vậy, tôi sẽ chỉ nói "selectedGardenID = $0".

Được rồi.

Tôi sẽ chạy ứng dụng của chúng ta.

Mở mục menu Tùy chọn tại đây và tôi sẽ chọn Cây trồng trong nhà làm khu vườn mặc định của mình.

Và tôi sẽ mở một cửa sổ mới, và chúng ta thấy Cây trồng trong nhà được chọn.

Cung cấp hỗ trợ tùy chỉnh thông qua cài đặt là một cách hay để xây dựng trải nghiệm linh hoạt cho người dùng của chúng tôi.

Một cách khác là cung cấp quy trình làm việc thay thế cho cùng một hành động.

Trong phần đầu tiên của bài nói chuyện của chúng tôi, Mathieu đã chỉ cho bạn cách thêm mục menu chính để thêm cây vào khu vườn đã chọn.

Đây là chức năng tuyệt vời cho ứng dụng của chúng tôi, nhưng hãy xem xét một cách khác để chúng tôi có thể cung cấp chức năng tương tự thông qua tương tác người dùng macOS phổ biến: kéo và thả.

Vì chúng tôi đang sử dụng bảng ở đây, tôi sẽ thực hiện một vài điều chỉnh để hỗ trợ nó trở thành nguồn kéo và điểm đến thả.

Điều đầu tiên tôi sẽ làm là loại bỏ "cây" này khỏi trình khởi tạo.

Sau đó, tôi sẽ đi xuống ở cuối và thêm một trình tạo hàng.

Đối với nội dung của trình tạo hàng này, tôi sẽ thêm một ForEach và sử dụng những cây mà chúng tôi đã có từ trước.

Và đối với mỗi nhà máy, tôi sẽ tạo ra một TableRow với nó.

Vì vậy, bây giờ tôi sẽ tùy chỉnh từng TableRows của chúng tôi bằng cách thêm công cụ sửa đổi itemProvider.

Và tôi sẽ chỉ trả lại plant.itemProvider ở đây, đây là một thuộc tính được tính toán mà tôi đã thiết lập trên mô hình của mình.

Vì vậy, bây giờ mỗi hàng này hỗ trợ trở thành một nguồn kéo.

Bây giờ tôi đã thực hiện đủ thay đổi để cho phép tôi kéo cây của mình ra, nhưng điều này không hữu ích lắm nếu không có gì chấp nhận nó.

Hãy khắc phục điều đó bằng cách thêm hỗ trợ thả vào bảng của chúng tôi.

Công cụ sửa đổi onInsert là nửa còn lại của phương trình kéo và thả của chúng tôi.

Nó cần một danh sách các loại nội dung và tôi sẽ vượt qua Plant.draggableType ở đây, đây là một loại tùy chỉnh mà tôi đã thiết lập trên mô hình của mình.

Nó cũng cần một kết thúc, được truyền hai tham số.

Một là chỉ mục xảy ra sự sụt giảm và một là danh sách các nhà cung cấp mặt hàng.

Sau đó chúng tôi sẽ gọi cho Plant.fromItemProviders để tạo mô hình của chúng tôi và chúng tôi sẽ chuyển các nhà cung cấp mặt hàng đó ở đây.

Điều này sẽ trả lại cho chúng tôi một danh sách các loài thực vật mà chúng tôi có thể sử dụng để cập nhật mô hình của mình.

Tôi sẽ gọi garden.plants.insert (contentsOf: plants) tại chỉ mục nơi nó xảy ra.

Bây giờ, tôi có thể mở một cửa sổ mới với Cây trồng trong nhà của mình, chọn một vài bông hoa từ Giường hoa ở sân sau của tôi và kéo để sao chép chúng.

Kéo và thả là một cách tuyệt vời để di chuyển dữ liệu bên trong ứng dụng của chúng tôi, nhưng còn việc di chuyển dữ liệu giữa ứng dụng của chúng tôi và hệ điều hành thì sao?

Người dùng của chúng tôi sẽ đánh giá cao việc có thể xuất tất cả dữ liệu này - có lẽ cho mục đích sao lưu hoặc nhập vào một ứng dụng khác.

Để tạo điều kiện thuận lợi cho quy trình làm việc này, hãy thêm một mục menu chính để xuất cơ sở dữ liệu của chúng tôi ở định dạng tệp chung có thể được chia sẻ với các ứng dụng khác.

Tôi đã tạo một loại để chứa mục menu của mình, loại này phù hợp với giao thức lệnh.

Trong các lệnh của chúng tôi ở đây, tôi sẽ thêm một ImportExportCommands và cũng chuyển nó cho cửa hàng của chúng tôi.

Hãy chuyển sang tệp đó ngay bây giờ.

Và đối với phần thân, tôi sẽ thêm CommandGroup và tôi sẽ thay thế vị trí importExport do hệ thống cung cấp.

Và những gì điều này sẽ làm là thêm mục menu của chúng tôi ở vị trí dự kiến trong menu Tệp.

Vì vậy, đối với nội dung của CommandGroup của chúng tôi, tôi sẽ thêm một Phần và một Nút.

Chúng tôi sẽ dán nhãn "Xuất khẩu" theo sau là các hình elip.

Các hình elip chỉ ra cho người dùng rằng việc chọn mục đó sẽ mở ra một cửa sổ hoặc hộp thoại lưu.

Và Nút chỉ có thể sửa đổi một số trạng thái - giả sử, "isShowingExport = true" - và hãy thêm trạng thái đó vào đây.

Vì vậy, bây giờ chúng tôi có Nút của mình, đang sửa đổi một số trạng thái.

Tôi cũng sẽ thêm công cụ sửa đổi fileExporter vào đây.

Và tôi sẽ cung cấp cho nó một ràng buộc với trạng thái của chúng tôi trong tham số isPresented của nó.

Đang hiển thị xuất khẩu.

Nó cũng cần một tài liệu.

Đây là một loại cần phải phù hợp với giao thức tài liệu tệp hoặc giao thức tài liệu tệp tham chiếu.

Tôi đã thêm sự phù hợp vào cửa hàng của mình, vì vậy chúng tôi sẽ chuyển nó ở đây.

Ngoài ra, nó cần một loại nội dung.

Chúng tôi sẽ cung cấp cho nó Store.readableContentTypes.first chỉ là loại CSV.

Và cuối cùng, nó cần một sự đóng cửa, được thông qua kết quả của hoạt động, cho thấy thành công hay thất bại.

Bây giờ, tôi có thể chọn mục menu Xuất của chúng tôi, cung cấp cho nó một tệp để lưu dưới dạng "plants.csv", nhấn Xuất và tệp đã được lưu vào đĩa.

Trong khi chúng ta đang nói về chủ đề di chuyển dữ liệu giữa ứng dụng của chúng ta và hệ điều hành, có một điều cuối cùng tôi muốn thảo luận.

Ứng dụng của chúng tôi có rất nhiều dữ liệu văn bản về các nhà máy của chúng tôi, nhưng cũng sẽ rất tuyệt nếu thêm hình ảnh.

Người dùng có thể chụp ảnh cây của họ theo thời gian để theo dõi tiến trình của họ.

Một cách để kích hoạt luồng nhập này là với Continuity Camera.

Tính năng này sẽ cho phép người dùng của chúng tôi chụp ảnh nhà máy của họ bằng thiết bị iOS của họ và nhập trực tiếp vào ứng dụng của chúng tôi.

Hãy xem cách chúng ta có thể thêm một mục menu để kích hoạt luồng này khi người dùng đã chọn một cây trong chế độ xem thư viện.

Sau importExportCommands của tôi, tôi sẽ thêm ImportFromDevicesCommands, và điều đó sẽ cung cấp cho chúng tôi mục menu chính của chúng tôi.

Ngoài ra, tôi sẽ chuyển sang tệp GardenDetail của chúng tôi và ở cuối phần thân của chúng tôi ở đây, tôi sẽ thêm công cụ sửa đổi importsItemProviders và điều này có danh sách các loại mà chúng tôi muốn hỗ trợ nhập.

Tôi sẽ căn cứ vào việc liệu có bất cứ thứ gì được chọn hay không, vì vậy tôi sẽ sử dụng lựa chọn của chúng tôi ở đây.

Và nếu nó trống, tôi sẽ trả về một mảng trống.

Và nếu nó không trống, tôi sẽ trả lại Plant.importImageTypes, đây là danh sách tất cả các loại hình ảnh trên hệ thống.

Và công cụ sửa đổi này đóng cửa, được thông qua danh sách các nhà cung cấp mặt hàng.

Chúng tôi sẽ lấy những nhà cung cấp đó và gọi Plant.importImageFromProviders, chuyển nó cho các nhà cung cấp và điều này sẽ trả lại cho chúng tôi một URL nơi nó đã lưu hình ảnh vào đĩa.

Sau đó, chúng tôi sẽ cập nhật mô hình của mình bằng cách lặp lại tất cả các ID được chọn...

...Và lấy một tham chiếu đến nhà máy và cập nhật hình ảnh của nóURL.

Tôi sẽ chọn khu vườn Cây trồng trong nhà của mình và chuyển sang chế độ Thư viện.

Và tôi sẽ làm mọi thứ lớn hơn một chút.

Chọn cây của tôi ở đây.

Trong mục menu chính, chọn Nhập từ iPhone > Chụp ảnh.

Và bạn có thể xem thư viện của chúng tôi được cập nhật.

Tôi hy vọng đây là một chuyến tham quan thú vị về một số cách khác nhau để xác định một ứng dụng Mac tuyệt vời.

Tôi đang mong chờ tất cả các cách mà các ứng dụng của bạn sẽ làm cho nền tảng macOS tốt hơn.

Chúc bạn có một WWDC 2021 tuyệt vời.

♪