10161

Xin chào, tôi là Ken Greenebaum, trong nhóm Công nghệ Hiển thị và Màu sắc.

Cảm ơn bạn đã tham dự buổi nói chuyện "Phạm vi động cao, kết xuất với EDR" này.

Đó là một công nghệ mà tôi rất vui khi được chia sẻ với bạn.

Hãy nhanh chóng xem xét những gì chúng ta sẽ đề cập và ai có thể được hưởng lợi tốt nhất từ việc tham dự.

Chúng ta sẽ bắt đầu với EDR thực sự là gì, mô tả bốn bước được sử dụng để thêm EDR vào ứng dụng hiện tại của bạn, thảo luận về API EDR gốc để kiểm soát kết xuất nhiều hơn và cuối cùng, chúng ta sẽ khám phá một loạt các phương pháp hay nhất liên quan đến EDR.

Bây giờ, EDR là gì?

EDR là một từ viết tắt mà bạn có thể không quen thuộc.

Nó là viết tắt của "Phạm vi động mở rộng".

Chúng tôi sử dụng "EDR" để chỉ cả biểu diễn HDR và công nghệ kết xuất HDR được sử dụng trên nền tảng của chúng tôi.

Nó hơi giống với quản lý màu sắc, thứ mà bạn có thể đã quen thuộc.

Các nhà phát triển của nhiều loại ứng dụng sẽ thấy bài nói chuyện này thú vị.

Để bắt đầu, bất kỳ nhà phát triển nào quan tâm đến công nghệ đồ họa máy tính, màn hình Dải động cao và đặc biệt là màn hình XDR mới mà Apple đã phát hành trong vài năm qua.

Tiếp theo là các nhà phát triển trò chơi khó tính, những người muốn tạo ra trải nghiệm thực tế và thú vị nhất, mở khóa các chi tiết tươi sáng có thể đã có trong công cụ kết xuất của họ.

Quan trọng hơn, có những nhà phát triển ứng dụng Pro quan tâm đến việc đạt được phản hồi tham chiếu phòng thu cho video HDR và hình ảnh tĩnh.

Cuối cùng, có những nhà phát triển ứng dụng không nhấn mạnh cụ thể vào đồ họa, nhưng những người muốn nắm lấy nội dung hình ảnh và video tĩnh HDR hiện đang đi vào hệ sinh thái.

HDR ở đây, và nó được kích hoạt bởi công nghệ EDR của chúng tôi.

Như chúng ta sẽ thảo luận, chúng ta có màn hình với những khả năng đáng kinh ngạc đã có trong tay người dùng.

Nội dung HDR tuyệt đẹp trong hệ sinh thái mà người dùng đang chụp, phát trực tuyến và tải xuống, cũng như các ứng dụng HDR, cả trò chơi và chuyên nghiệp, có sẵn trong App Store.

EDR là một công nghệ thích ứng.

Như chúng ta sẽ thảo luận, EDR không chỉ ánh xạ nội dung HDR đến các màn hình có khả năng cực kỳ khác nhau mà còn hỗ trợ phạm vi điều kiện xem thậm chí còn rộng hơn.

Bạn đã bao giờ nhận thấy màn hình trông khác nhiều trong môi trường sáng so với khi nhìn trong bóng tối chưa?

Màu sắc tươi sáng, rực rỡ mà bạn trải nghiệm trong nhà có thể trông mờ và tắt tiếng với dải động thấp khi xem ngoài trời.

Màn hình không thay đổi.

Ở một cài đặt độ sáng nhất định, nó luôn tạo ra cùng một ánh sáng.

Là môi trường đã thay đổi, cũng như tầm nhìn của bạn nhanh chóng thích nghi với môi trường.

Trong môi trường tối, tầm nhìn của bạn thích ứng với nội dung được hiển thị, nguồn ánh sáng chiếm ưu thế.

Nhưng trong một môi trường sáng sủa, tầm nhìn của người dùng phần lớn thích nghi với môi trường, trên màn hình mờ hơn nhiều, khiến nội dung trông mờ và bị cuốn trôi, nghiền nát màu đen và chi tiết bóng tối.

Đây là lý do tại sao EDR và các công nghệ thích ứng môi trường xung quanh cơ bản tự động điều chỉnh các thông số hiển thị, chẳng hạn như điểm trắng, điểm đen, độ sáng trắng tham chiếu và dải động, mà chúng tôi mô tả là "khoảng không EDR", để ánh xạ màn hình theo tầm nhìn thích ứng của người dùng.

Sự thích nghi của EDR cung cấp một số lợi ích.

Có lẽ đáng ngạc nhiên nhất, điều này dẫn đến việc EDR tạo ra phản hồi HDR thực sự, ngay cả trên các màn hình dải động tiêu chuẩn, thông thường.

Đó là, khi những màn hình đó được xem trong môi trường điều chỉnh độ sáng với cài đặt độ sáng mờ tương ứng.

Tương tự, động lực học của EDR tạo ra khả năng HDR được tối ưu hóa theo tình huống trên màn hình HDR sáng.

Điều này cho phép nội dung HDR trông tuyệt đẹp trong môi trường mờ tham chiếu HDR, đồng thời cung cấp dải động giảm nhưng tối ưu trong môi trường sáng hơn, tất cả trong khi vẫn giữ nguyên chi tiết bóng, chẳng hạn như các bản vá trên hình minh họa này.

Kết xuất EDR được hỗ trợ trên hầu hết các thiết bị mà chúng tôi đã vận chuyển trong nhiều năm nay.

Chúng tôi đã mô tả khả năng HDR về khoảng không EDR, sáng hơn bao nhiêu lần so với màu trắng SDR tối đa thông thường, các điểm ảnh EDR sáng nhất có thể được hiển thị cho màn hình.

Khoảng không EDR thay đổi dựa trên khả năng hiển thị, cũng như các thông số khác, bao gồm cài đặt thanh trượt độ sáng hiện tại.

Trên các màn hình có đèn nền thông thường, như được tìm thấy trên hầu hết các máy Mac và iPad gần đây, lên đến 2x SDR rất đáng chú ý, có sẵn.

iPhone với màn hình XDR cung cấp khoảng không SDR 8x thú vị.

Màn hình Liquid Retina XDR của iPad Pro mới có SDR 16x đáng kinh ngạc.

Khoảng 5x SDR được cung cấp khi lái màn hình HDR 10 bên ngoài điển hình qua Mac, iPad và AppleTV.

Và Pro Display XDR hiển thị thành 400x SDR đáng kinh ngạc trong cài đặt trước XDR mặc định, khi độ sáng được đặt thành giá trị 4 nit tối thiểu.

Không chỉ màn hình có khả năng HDR đã nằm trong tay nhiều người dùng, mà nội dung HDR đang trở thành xu hướng chủ đạo.

Ngoài nội dung HDR thương mại, người dùng đang thêm nội dung ảnh tĩnh và video HDR, được quay trên iPhone của riêng họ và các thiết bị khác, vào hệ sinh thái.

Một danh sách các ứng dụng đầy cảm hứng đã được áp dụng EDR.

Các trò chơi hàng đầu hỗ trợ EDR bao gồm "Baldur's Gate 3", "Divinity: Original Sin 2" và "Shadow of the Tomb Raider".

Ngày càng có nhiều dịch vụ AppleTV cung cấp nội dung HDR, bao gồm ứng dụng TV, Netflix và YouTube.

Cuối cùng, một danh sách các ứng dụng Pro thú vị và ngày càng tăng đã áp dụng EDR, vừa tăng tiền cược vừa tăng số lượng nội dung HDR được phát triển trên nền tảng.

Affinity Photo, DaVinci Resolve, Cinema 4D, Final Cut Pro, Nuke và Pixelmator Pro chỉ là một số ứng dụng.

Chúng tôi đã chọn đặt tên công nghệ của mình là "EDR" một phần để phân biệt nó với "HDR", có xu hướng có ý nghĩa khác nhau đối với những người khác nhau.

Khi nhiều người nghĩ về Dải động cao, họ tưởng tượng ra màn hình sáng có khả năng tạo ra màu đen sâu.

Những người có đầu óc sản xuất có thể nghĩ rằng các định dạng nội dung, có thể là HDR10 hoặc Dolby Vision.

Về mặt kỹ thuật, nó mang lại các chức năng chuyển giao, như PQ hoặc HLG, cho tâm trí.

Và có lẽ đối với nghệ thuật, HDR thậm chí có thể gợi ý bản đồ tông màu siêu thực, họa sĩ đại diện cho các điểm nổi bật sáng, cũng như chi tiết bóng mờ như SDR.

Hãy xem xét bản đồ tông màu SDR này của một hình ảnh OpenEXR Dải động cực cao, được tạo ra RIT.

Trong bản đồ tông màu, bóng đèn phát sáng và chi tiết bóng đều có mặt.

Tuy nhiên, dải động ấn tượng của hình ảnh HDR gốc bị mất.

EDR không phải là một chuyển đổi HDR sang SDR của họa sĩ, bảo tồn tất cả các chi tiết trong khi mất ý định, mà là một kết xuất Dải động cao thực sự.

Nhóm RIT đã kết hợp 18 lần phơi sáng SLR kỹ thuật số có khung, được thấy ở đây, để tạo ra hình ảnh HDR của họ với dải động 500.000: 1 tuyệt vời của nó.

EDR thể hiện đầy đủ điều này trong dấu phẩy động, với đối tượng của hình ảnh, chính đèn Luxo, dưới dạng các giá trị điểm ảnh dưới tham chiếu màu trắng 1.0 và với các chi tiết sáng hơn, chẳng hạn như quả cầu phát xạ của bóng đèn, được biểu thị dưới dạng các giá trị gần 500.

Nó sáng hơn 500 lần so với đế đèn.

Việc triển khai EDR tạo ra một ánh xạ giữa các màu trắng tham chiếu của mọi phần tử của hệ thống.

Từ màu trắng tham chiếu của nội dung đến màu trắng của màn hình, cho đến tầm nhìn thích nghi của người dùng.

Bản đồ này là nền tảng để cung cấp nhiều lợi ích của EDR, bao gồm cho phép nội dung HDR và SDR cùng tồn tại song song, hiển thị tối ưu dải động của màn hình HDR trên các môi trường, thậm chí cho phép màn hình SDR thông thường hiển thị HDR thực sự, trong khi luôn cho phép EDR hiển thị dải động tuyệt vời nhất có thể.

Ví dụ, trên Pro Display XDR, với thanh trượt độ sáng được đặt ở mức tối đa 500 nits, các giá trị EDR lên đến 3.2 sẽ được hiển thị mà không bị cắt.

Các yếu tố sáng hơn, chẳng hạn như đầu đèn, với các giá trị EDR tương ứng lớn hơn, sẽ kẹp vào đỉnh 1.600 nit của màn hình.

Giảm cài đặt độ sáng của màn hình xuống mức tối thiểu 4-nit, xảy ra khi ở trong môi trường mờ đến tối, tự động thông qua độ sáng tự động hoặc sử dụng thanh trượt độ sáng theo cách thủ công, các giá trị EDR lên đến 400 có thể hiển thị được, do đó cung cấp hầu hết dải động của hình ảnh đặc biệt này.

Các yếu tố sáng nhất của hình ảnh, trong khi vẫn hiển thị với độ sáng cực đại 1.600 nit của màn hình, giờ đây xác định rõ đường viền của bóng đèn.

Tương tự, các chi tiết khác được tiết lộ, chẳng hạn như màu sắc của trình kiểm tra màu được chiếu sáng rực rỡ.

Với tầm nhìn của người dùng hiện thích ứng với màu trắng tham chiếu 4 nit của hình ảnh, các yếu tố sáng nhất của hình ảnh hiện được hiển thị sáng hơn 400 lần so với đế đèn một cách đáng kinh ngạc.

Hãy cùng khám phá ý nghĩa của đường ống hiển thị và kết xuất HDR dấu phẩy động của EDR.

Là dấu phẩy động, EDR có thể đại diện cho mọi màu sắc mà con người có thể cảm nhận được, như được thể hiện bằng biểu đồ màu sắc được lấp đầy hoàn toàn này.

Tương tự, EDR có thể đại diện cho độ sáng sẽ gây hại cho thị lực nếu được hiển thị đầy đủ.

Như vậy, đại diện của EDR là bằng chứng trong tương lai.

Như đã đề cập, EDR không chỉ là một đại diện, mà còn là một đường ống kết xuất HDR.

EDR là một phần mở rộng cho các công nghệ quản lý màu sắc mà Apple đã đi tiên phong và đã được vận chuyển trong một thời gian rất dài.

Ví dụ, video được quản lý màu tăng tốc GPU lần đầu tiên được vận chuyển trở lại MacOS 10.4 Tiger.

Về mặt khái niệm tương tự như cho phép phương tiện có gam màu bình thường và rộng được hiển thị cạnh nhau, EDR cho phép các tài sản HDR và SDR chia sẻ màn hình một cách hài hòa, cũng như được hiển thị một cách thích hợp cho các màn hình có khả năng khác nhau.

Trong số những thứ khác, điều này có nghĩa là các nhà phát triển có thể tiếp tục sử dụng các tài sản SDR hiện có và thêm hỗ trợ EDR một cách có chọn lọc khi cần thiết.

Hãy cùng khám phá trực quan biểu diễn của EDR về các giá trị điểm ảnh HDR.

EDR là một biểu diễn dấu phẩy động.

EDR 0.0 đại diện cho màu đen, 1.0 đại diện cho SDR max, còn được gọi là "trắng tham chiếu" hoặc "trắng giao diện người dùng", do đó EDR 0.0 đến 1.0 đại diện cho phạm vi SDR, giống như mọi khi.

Những giá trị này đại diện cho chủ đề của một hình ảnh và sẽ không bao giờ bị cắt khi được hiển thị.

Các giá trị EDR vượt quá 1.0 đại diện cho các giá trị vượt quá độ sáng SDR, chẳng hạn như các bề mặt nổi bật và phát xạ.

Những giá trị này có thể trở nên cực kỳ sáng và trong khi có thể biểu diễn được, có thể bị cắt bớt khi được hiển thị.

EDR được sử dụng để điều khiển màn hình, bất kể màn hình có phản hồi năng lượng thuần túy thông thường hay chức năng truyền HDR mới hơn.

Hãy xem xét Pro Display XDR trong cài đặt trước XDR mặc định, dựa trên PQ.

EDR 0.0 điều khiển màn hình hiển thị về 0 nits, thông qua mã PQ zero nit.

EDR 1.0, được gọi là "màu trắng tham chiếu", được thu nhỏ bằng thanh trượt độ sáng màn hình hoặc độ sáng tự động, giống như mọi khi.

Cài đặt trước XDR có dải độ sáng trắng tham chiếu điển hình, khoảng 4 đến 500 nits.

Hãy xem xét cài đặt tối đa 500 nits cho ví dụ này.

Bất kể cài đặt độ sáng như thế nào, màu trắng đỉnh luôn là 1.600 nit trong cài đặt trước này.

Do đó, EDRmax, giá trị EDR sáng nhất, có thể hiển thị, là 3,2, như có thể được tính bằng cách chia màu trắng đỉnh 1.600 nit cho màu trắng tham chiếu 500 nit.

Tương ứng, chúng tôi nói rằng có khoảng không SDR 3,2x, vì giá trị sáng nhất có thể hiển thị cho màn hình sáng hơn 3,2 lần so với màu trắng tham chiếu.

Tóm lại, trên Pro Display XDR, sử dụng cài đặt trước XDR mặc định, với độ sáng màn hình, còn được gọi là "trắng tham chiếu", ở 500 nits, các giá trị EDR 0.0 đến 3.2 được hiển thị cho màn hình là 0.0 đến 1.600 nits, với EDR 1.0 được hiển thị là 500 nits.

Cuối cùng, các giá trị EDR trên 3.2 của EDRmax được cắt thành màu trắng đỉnh, 1.600 nits.

Thật ngạc nhiên, khi độ sáng màn hình giảm xuống mức tối thiểu 4 nit, các giá trị EDR lên đến 400 có thể hiển thị được, do đó hiển thị các chi tiết cực kỳ sáng ở dải động thực sự của chúng.

Bây giờ chúng ta đã có tổng quan về cách EDR hoạt động, chúng ta sẽ khám phá việc thêm EDR vào ứng dụng của bạn.

Có bốn bước để thêm hỗ trợ EDR cho hầu hết các ứng dụng.

Các bước này đều đơn giản, tuy nhiên, hiệu ứng của chúng có thể tinh tế và bạn có thể sẽ không có kết quả EDR một cách đáng tin cậy cho đến khi bạn áp dụng tất cả chúng.

Đầu tiên, bạn phải yêu cầu EDR bằng cách thêm một thuộc tính vào ngữ cảnh, lớp hoặc đối tượng thích hợp.

Thứ hai, bạn phải liên kết một không gian màu phạm vi mở rộng với bộ đệm, lớp hoặc ứng dụng của mình.

Quản lý màu sắc sẽ cắt các giá trị EDR vượt quá 1.0, nếu không gian màu phạm vi mở rộng không được chỉ định.

Bạn nên biết rằng quản lý màu sắc chỉ có thể tương tác khi không gian màu nguồn và đích không khớp, vì vậy clip này có thể không liên tục hoặc phụ thuộc vào nội dung.

Thứ ba, bạn cần chọn một định dạng bộ đệm pixel có thể đại diện cho các giá trị trên 1.0.

Đây thường là một dạng dấu phẩy động nào đó.

Cuối cùng, ứng dụng của bạn phải tạo ra các điểm ảnh vượt quá phạm vi SDR 0.0 đến 1, và do đó có các yếu tố lấp lánh để thể hiện.

Nhiều nhà phát triển có các ứng dụng hiện có mà họ có thể muốn thêm hỗ trợ EDR.

Có lẽ cách dễ nhất để bắt đầu với EDR là chỉ cần thay thế video HDR hoặc nội dung hình ảnh tĩnh thay cho nội dung SDR hiện có.

Sau đó làm theo bốn bước mà chúng tôi vừa vạch ra.

Một số ứng dụng, ví dụ, ứng dụng email được hiển thị, có thể chỉ bật EDR một cách có chọn lọc khi gặp phải nội dung HDR.

Giao diện AVPlayer của AVFoundation hỗ trợ số lượng định dạng video HDR ngày càng tăng như Dolby Vision, HDR 10 và HLG.

AVPlayer sẽ tự động hiển thị các định dạng này dưới dạng EDR khi có thể trên tất cả các nền tảng, ngoại trừ watchOS.

Các ứng dụng dựa trên AVPlayer hiện tại không yêu cầu bất kỳ thay đổi nào để hiển thị các định dạng video HDR được hỗ trợ thông qua EDR.

Hãy xem xét một ví dụ mã AVPlayer hỗ trợ EDR.

Như mọi khi, trước tiên người ta chỉ cần tạo một phiên bản AVPlayer, sử dụng playerWithURL của AVPlayer.

Tuy nhiên, trong ví dụ của chúng tôi, chúng tôi chỉ định nội dung video HDR.

Tiếp theo, thêm trình phát vào một lớp, sử dụng playerLayerWithPlayer.

Cuối cùng, hướng bộ điều khiển đến người chơi và yêu cầu người chơi bắt đầu chơi.

AVFoundation sẽ tự động thực hiện những gì được yêu cầu để hiển thị phương tiện HDR dưới dạng EDR, đồng thời sẽ bật và tắt EDR dựa trên loại nội dung.

Phát lại video HDR khá đơn giản.

Tiếp theo, hãy xem xét kết xuất hình ảnh tĩnh HDR.

ImageIO có hỗ trợ rộng rãi cho các định dạng hình ảnh HDR và thuận tiện, sẽ trả về các điểm ảnh được giải mã dưới dạng EDR trong bộ đệm dấu phẩy động.

Mặc dù ImageIO có sẵn trên tất cả các nền tảng, nhưng hiện tại, các kết quả được giải mã chỉ có thể được hiển thị dưới dạng EDR trên macOS.

Chúng tôi sẽ trình bày cách kết hợp các tài sản dựa trên ImageIO vào một ứng dụng trong ví dụ CAMetalLayer sắp tới.

Bây giờ, hãy khám phá EDR API gốc.

Như tôi đã đề cập, API EDR gốc được tạo ra cho các ứng dụng như ứng dụng Games và Pro, nơi nhà phát triển có thể muốn hiển thị nội dung tùy chỉnh và có nhiều quyền kiểm soát hơn đối với cách hiển thị phương tiện HDR.

Hiện tại, API này có sẵn trên macOS thông qua CAMetalLayer và NSOpenGLView.

Hãy xem xét một ví dụ sử dụng CAMetalLayer, khung EDR gốc ưa thích.

Để bắt đầu, chúng ta sẽ xem xét ba quy trình bốn bước đầu tiên, chọn tham gia EDR, thiết lập không gian màu phạm vi mở rộng và chọn định dạng bộ đệm điểm ảnh FP16.

Đầu tiên, chọn tham gia EDR bằng cách đặt thuộc tính "wantsExtended DynamicRangeContent" của metalLayer thành "có".

Thứ hai, đặt không gian màu của metalLayer thành không gian màu phạm vi mở rộng, chẳng hạn như ExtendedLinearDisplayP3.

Thứ ba, đặt định dạng pixel của metalLayer thành định dạng dấu phẩy động, chẳng hạn như RGBA16Float.

Tiếp theo, chúng ta sẽ kiểm tra bước chọn tham gia EDR thứ tư, thực sự tạo ra các điểm ảnh EDR.

Trong trường hợp này, chúng tôi sẽ sử dụng ImageIO để nhập nội dung hình ảnh tĩnh HDR và hiển thị kết quả dưới dạng kết cấu EDR.

Nó có liên quan một chút, vì vậy chúng tôi sẽ đi bộ qua từng bước một.

Chúng tôi tạo CGImage từ nội dung HDR, vẽ hình ảnh được giải mã thành bitmap dấu phẩy động, tạo kết cấu dấu phẩy động, tải bitmap EDR thành kết cấu và cuối cùng, hiển thị kết cấu cho đường ống kim loại hỗ trợ EDR.

Đầu tiên, CGImage được tạo từ nguồn được chỉ định trong HDRimageURL, sử dụng CGImageSourceCreateWithURL và CGImageSourceCreateImageAtIndex.

Tiếp theo, tạo CGContext với CGBitmapContextCreate, sử dụng cùng một không gian màu mà chúng tôi đã đặt trước đó trên metalLayer và vẽ hình ảnh EDR vào ngữ cảnh dấu phẩy động bằng CGContextDrawImage.

Bây giờ, chúng tôi tạo ra một kết cấu dấu phẩy động của loại RGBA16Float, sử dụng newTextureWithDescriptor.

Tải dữ liệu hình ảnh EDR, sử dụng CGBitmapContextGetData vào kết cấu EDR, sử dụng replaceRegion.

Cuối cùng, nhà phát triển đã sẵn sàng kết xuất kết cấu EDR vào đường ống kim loại hỗ trợ EDR của họ và tận hưởng kết quả năng động.

Đối với những người vẫn hỗ trợ các ứng dụng dựa trên OpenGL, chúng tôi sẽ khám phá việc kích hoạt EDR trên NSOpenGLView bằng cách sử dụng các bước tương tự như những bước mà chúng tôi đã chứng minh.

Việc áp dụng EDR cũng có thể tạo cơ hội để nắm bắt hoàn toàn việc quản lý màu sắc.

Tuy nhiên, chúng tôi sẽ không đề cập đến điều đó trong cuộc nói chuyện này.

Chúng ta sẽ khám phá các bước sau: Chọn tham gia EDR, chọn định dạng bộ đệm pixel dấu phẩy động và vẽ EDR và nội dung lên NSOpenGLView.

Không yêu cầu đặt không gian màu phạm vi mở rộng, vì NSOpenGLView không được quản lý màu tự động.

Đầu tiên, chọn tham gia EDR bằng cách đặt thuộc tính "wantsExtendedDynamicRange OpenGLSurface" của NSOpenGLView thành "có".

Thứ hai, đặt định dạng bộ đệm pixel thành NSOpenGLPFAColorFloat với ColorSize, 64.

Cuối cùng, vẽ các giá trị EDR vào OpenGLView, chạy ứng dụng đã sửa đổi của bạn và tận hưởng kết quả.

Bây giờ chúng ta đã thảo luận về việc kích hoạt hỗ trợ EDR cơ bản trong các ứng dụng hiện có, hãy đi sâu hơn một chút và khám phá một số phương pháp hay nhất để tận dụng tối đa ứng dụng hỗ trợ EDR của bạn.

Nhớ lại bước chọn tham gia EDR bốn là đặt không gian màu phạm vi mở rộng.

Và trong ví dụ của chúng tôi cho đến nay, chúng tôi đã thiết lập rõ ràng một không gian màu phạm vi mở rộng thích hợp.

Tuy nhiên, nhiều ứng dụng không đặt không gian màu của chúng một cách rõ ràng và thay vào đó sử dụng không gian màu mặc định được cung cấp bởi khung.

Điều này thường tương ứng với không gian hiển thị hoặc bố cục, không phải là phạm vi mở rộng, do đó phá vỡ EDR trừ khi có điều gì đó được thực hiện.

Hãy cùng khám phá một ví dụ về cách quảng bá không gian màu hiện có lên phạm vi mở rộng.

Đầu tiên, lấy không gian màu hiện có, trong trường hợp này, từ cửa sổ chế độ xem của bạn.

Thứ hai, quảng bá không gian màu đó lên phạm vi mở rộng bằng cách sử dụng CGcolorspaceCreateExtended.

Cuối cùng, gán không gian màu phạm vi mở rộng mới được tạo cho cửa sổ, bộ đệm hoặc lớp, nếu thích hợp, cho phép các ứng dụng không đặt rõ ràng không gian màu của chúng để sử dụng EDR.

Tiếp theo, chúng ta sẽ khám phá các phương pháp hay nhất để tạo nội dung EDR.

Cho đến nay, chúng tôi đã đề cập đến nội dung EDR có giá trị vượt quá 1.0, nhưng không phải cách thực sự tổng hợp nội dung này hoặc chuyển đổi nó từ các nguồn HDR.

Vui lòng cẩn thận khi tạo nội dung EDR, vì có thể trải nghiệm "hội chứng thỏ phát sáng" đáng sợ, nơi nội dung có thể có ánh sáng óng ánh, kỳ lạ khiến nội dung được viết đúng trông mờ khi so sánh.

Như đã được nhấn mạnh, các điểm ảnh trên EDR 1.0, chỉ nên mã hóa các điểm nổi bật gương và bề mặt phát xạ.

Điều này có nghĩa là không phù hợp để lấy nội dung SDR và kéo dài nó thành HDR.

Nội dung SDR tương thích với EDR nguyên trạng trong phạm vi 0.0 đến 1.0 gốc của nó.

Điều này căn chỉnh màu trắng tham chiếu SDR với nội dung HDR.

Khi nội dung HDR được tạo ra quá sáng, với những gì nên là các yếu tố mờ hơn hoặc thậm chí là bóng tối vượt quá EDR 1.0, nó sẽ xuất hiện không tự nhiên so với nội dung được viết tốt.

Tầm nhìn của người dùng có thể bắt đầu thích ứng với nội dung quá sáng này, khiến các nội dung khác có vẻ mờ hơn khi so sánh.

Vui lòng xem xét ví dụ này, về một cô gái cầm thẻ màu xám 18%, được các nhiếp ảnh gia và họa sĩ hoạt hình sử dụng để đặt độ phơi sáng.

Cô gái là chủ đề của bức ảnh, và do đó, nhiếp ảnh gia hoặc họa sĩ hoạt hình sẽ đặt độ phơi sáng sao cho cô ấy ở mức hoặc dưới màu trắng tham chiếu, và do đó sẽ không bị cắt.

Hầu hết các yếu tố giao diện người dùng cũng không được vượt quá EDR 1.0.

Tuy nhiên, có thể có những trường hợp ngoại lệ, bao gồm bộ chọn màu EDR hoặc giao diện người dùng được chia tỷ lệ tạm thời, được chiếu sáng rực rỡ để thu hút sự chú ý.

Các bề mặt phát xạ, chẳng hạn như mặt trời hoặc mây, cũng như các điểm nổi bật gương, chẳng hạn như mặt trời phản chiếu từ bề mặt sáng bóng, có khả năng sáng hơn nhiều so với màu trắng tham chiếu, và do đó, dự kiến sẽ vượt quá EDR 1.0.

Các yếu tố sáng nhất của cảnh đã được cắt bằng mã hóa SDR.

Do đó, nội dung SDR được biểu diễn chính xác là EDR 0.0 đến 1.0.

Đôi khi quy trình làm việc sẽ yêu cầu các định dạng HDR được chuyển đổi sang EDR một cách rõ ràng.

Như đã đề cập, ImageIO giải mã nội dung HDR thành EDR, không yêu cầu chuyển đổi thêm.

Ví dụ, HLG được giải mã thành phạm vi 0.0 đến 12.0 EDR, với EDR 1.0 đại diện cho tham chiếu màu trắng.

ImageIO giải mã các định dạng hình ảnh tĩnh HDR khác thành phạm vi cụ thể của riêng chúng, với EDR 1.0 luôn tương ứng với màu trắng tham chiếu của nguồn.

AVFoundation hiện không giải mã các định dạng HDR, chẳng hạn như HDR10, thành EDR.

Do đó, những thứ này cần được điều chỉnh để sử dụng với kết xuất EDR.

Việc chuyển đổi này rất đơn giản và bao gồm hai bước.

Đầu tiên, chuyển đổi sang ánh sáng tuyến tính bằng cách áp dụng hàm truyền nghịch đảo.

Và thứ hai, chia cho màu trắng tham chiếu của phương tiện.

Ví dụ: 100 nits cho nội dung PQ, do đó màu trắng tham chiếu sẽ được ánh xạ đến EDR 1.0 và giá trị PQ 10.000 nit tối đa sẽ ánh xạ đến 100 EDR.

Hãy xem xét bức ảnh này, giống như nhiều bức ảnh, cả kỹ thuật số và phim, có bầu trời chuyển sang màu trắng.

Mặc dù EDR sẽ không bao giờ cắt các giá trị lên đến EDR 1.0, màu trắng tham chiếu, đại diện cho chủ thể của hình ảnh, EDR sẽ cắt các giá trị trên màu trắng tham chiếu vượt quá EDRmax hiện tại và do đó không thể hiển thị trên cài đặt hiển thị và hiển thị hệ thống hiện tại.

Các giá trị trên màu trắng tham chiếu này là các bề mặt nổi bật hoặc phát xạ, chẳng hạn như mây, bầu trời và mặt trời, mà chúng ta không thể nhìn thấy trong hình ảnh này, và do đó, thường có thể bị cắt.

Tuy nhiên, việc cắt các chi tiết tươi sáng không phải lúc nào cũng được chấp nhận.

Ví dụ, hãy xem xét hình ảnh này của một chiếc máy bay có ánh nắng mặt trời bay cao trên những đám mây.

Chú ý màu xanh lam "HDR11" màu xanh lam?

Được chiếu sáng rực rỡ, con số, cũng như thân máy bay mà nó được sơn lên, cả hai đều có thể được hiển thị lớn hơn màu trắng tham chiếu, và do đó, có khả năng bị cắt tùy thuộc vào khả năng hiển thị và EDRmax hiện tại.

Nếu con số này là một yếu tố cốt truyện quan trọng trong một bộ phim hoặc trò chơi, thì ánh xạ âm động có thể được sử dụng để tránh hoặc quản lý việc cắt xén và giữ cho con số hiển thị.

Hãy cùng khám phá cách các ứng dụng phức tạp có thể theo kịp giá trị EDRmax hiện tại và theo đó, điều chỉnh những gì chúng hiển thị.

Các ứng dụng có thể muốn đăng ký nhận thông báo NSScreen, có thể để điều chỉnh độ sáng của các đối tượng trong cảnh, thay đổi độ phơi sáng của cảnh, áp dụng hiệu ứng nở hoa hoặc thậm chí là kẹp mềm để đảm bảo các chi tiết quan trọng không bị mất.

Hiện tại, chỉ có một giá trị EDR động có thể truy cập từ giao diện NSScreen.

Nó là maximumExtendedDynamic RangeColorComponentValue, và đại diện cho giá trị EDR tuyến tính có thể hiển thị tối đa hiện tại.

Như chúng tôi đã nói, các giá trị EDR lớn hơn EDRmax sẽ chuyển sang EDRmax.

Và EDRmax có thể tự động thay đổi, vì nó phụ thuộc vào các đặc điểm, chẳng hạn như độ sáng màn hình hoặc True Tone, bản thân chúng có thể thay đổi theo thời gian.

Hai giá trị EDR khác có thể truy cập từ NSScreen là tĩnh, có nghĩa là chúng sẽ không thay đổi theo thời gian.

Trái ngược với giá trị trước đó, maximumPotentialExtendedDynamic RangeColorComponentValue chỉ trả về giá trị pixel tuyến tính EDR tối đa có thể hiển thị mà không cần cắt trên màn hình này.

Đó là, nếu độ sáng màn hình và các tính năng khác được đặt một cách thích hợp.

EDR tiềm năng tối đa có thể được sử dụng để hướng dẫn các quyết định, chẳng hạn như liệu các phiên bản nội dung SDR hoặc HDR có nên được sử dụng hay không, hoặc thậm chí quyết định xem có đáng để kích hoạt EDR hay không.

Hãy nhớ rằng tiềm năng nằm trong cái tên.

Giá trị hiển thị tối đa hiện tại, EDRmax, có thể thấp hơn giá trị này.

1.0 được trả về cho màn hình, hoặc cài đặt trước hiển thị, không hỗ trợ EDR.

Giá trị tĩnh cuối cùng, maximumReferenceExtendedDynamic RangeColorComponentValue, chủ yếu được các nhà phát triển ứng dụng Pro quan tâm đến việc đạt được độ trung thực cao nhất với tiêu chuẩn tham chiếu.

Nó cung cấp giá trị EDR tối đa được đảm bảo hiển thị mà không bị biến dạng, chẳng hạn như cắt hoặc ánh xạ tông màu, trên một màn hình nhất định.

0.0 được trả về trên các màn hình không hỗ trợ kết xuất tham chiếu.

Bây giờ, hãy khám phá mã ví dụ đọc các giá trị EDR thông qua NSScreen.

Ở đây, chúng tôi đọc hai giá trị EDR tĩnh, maxPotential và maxReference.

Các giá trị EDR có thể khác nhau giữa các màn hình, vì vậy hãy đảm bảo thực hiện cuộc gọi trên màn hình mà ứng dụng của bạn thực sự đang bật.

Trong ví dụ này, chúng tôi đang sử dụng NSScreen được liên kết với cửa sổ của bạn.

Ứng dụng có thể theo kịp các thay đổi EDR động bằng cách đăng ký thông báo "NSWindowDidChangeScreen", sau đó truy vấn các tham số EDR hiện tại khi nhận được sự kiện thay đổi màn hình và có khả năng thay đổi những gì được hiển thị dựa trên kiến thức về khoảng không EDR hiện tại.

Để hoàn thành cuộc thảo luận của chúng tôi về lập bản đồ âm thanh, chúng tôi sẽ khám phá ngắn gọn trình lập bản đồ âm CAMetalLayer.

Điều này được quan tâm đối với các ứng dụng Pro tạo và hiển thị video HDR, chẳng hạn như HLG và HDR10, cho các thông số làm chủ HDR dựa trên dự án.

Các ứng dụng hệ thống, cũng như các ứng dụng sử dụng AVPlayer, như chúng tôi đã mô tả, sử dụng trình ánh xạ tông màu CAMetalLayer để cung cấp chức năng truyền quang học sang phương tiện cụ thể và clip mềm cho các giá trị HDR mà nếu không sẽ không thể hiển thị được.

Trình lập bản đồ âm CAMetalLayer được kích hoạt thông qua thuộc tính "CAEDRMetadata" và có sẵn trên macOS.

Ví dụ này minh họa cách bật trình ánh xạ âm thanh hệ thống bằng cách đặt thuộc tính "EDRMetadata" trên CAMetalLayer của ứng dụng của bạn.

Một số hàm tạo siêu dữ liệu EDRM có sẵn.

Chúng dành riêng cho tiêu chuẩn video HDR, cũng như thông tin làm chủ được cung cấp.

Ở đây chúng ta thấy hàm tạo siêu dữ liệu HLG, không có tham số.

Tiếp theo, chúng tôi trình diễn một trong những nhà xây dựng HDR10.

Cái này có ba tham số: Độ sáng tối thiểu và tối đa rõ ràng, cả về nits, cũng như opticalOutputScale, thường được đặt thành màu trắng tham chiếu 100 nit của HDR10.

Sau khi được xây dựng, hãy đặt đối tượng kết quả trên CAMetalLayer của ứng dụng của bạn, khiến tất cả nội dung được hiển thị trên lớp này được xử lý bởi trình ánh xạ âm hệ thống dựa trên siêu dữ liệu được cung cấp.

Liên quan chặt chẽ đến ánh xạ tông màu thích ứng, một ứng dụng có thể muốn vẽ với màu trắng sáng nhất hiện có thể hiển thị được.

Chúng tôi đã hiểu cách lấy EDRmax hiện tại từ NSScreen, tuy nhiên, khoảng không EDR là một giá trị tuyến tính và các pixel thường được mã hóa phi tuyến tính nhất.

Trong ví dụ cuối cùng này, chúng tôi sẽ chuyển đổi EDRmax thành không gian màu phi tuyến tiềm năng của ứng dụng.

Đầu tiên, chúng tôi sử dụng CGColorSpaceCreateWithName để tạo điểm ảnh trắng EDRmax tuyến tính mà chúng tôi muốn hiển thị.

Và sau đó chuyển đổi điểm ảnh EDRmax tuyến tính thành không gian màu của ứng dụng, sử dụng CGColorCreateCopy ByMatchingToColorSpace.

Màu kết quả sau đó có thể được sử dụng trong bất kỳ ứng dụng hỗ trợ EDR nào.

Điều này để lại cho chúng ta một chủ đề cuối cùng để thảo luận, sức mạnh và ý nghĩa hiệu suất của EDR.

Tương tự như tất cả kết xuất CG, việc đánh giá tác động của EDR đối với sức mạnh và hiệu suất có thể phức tạp và thường phụ thuộc vào kiến trúc phần cứng cụ thể và công nghệ hiển thị được sử dụng trên một thiết bị nhất định.

Mặc dù chúng ta sẽ không đi vào chi tiết trong cuộc nói chuyện này, nhưng có một số điểm chung cần xem xét, chẳng hạn như, tạo ra các điểm ảnh sáng hơn thường tiêu thụ nhiều năng lượng hơn, bộ đệm dấu phẩy động được sử dụng với EDR có thể lớn hơn và do đó tiêu thụ nhiều băng thông hơn bộ đệm điểm cố định có thể được sử dụng

Điều này, đến lượt nó, tương quan với nhiều năng lượng tiêu thụ hơn.

Ngay cả việc bật ánh xạ âm thanh dựa trên siêu dữ liệu CAEDRM cũng liên quan đến việc vượt qua xử lý bổ sung.

Điều này, đến lượt nó, làm tăng độ trễ và băng thông.

Đơn giản, EDR, giống như nhiều tính năng, không miễn phí và do đó, nó nên được sử dụng một cách thận trọng.

Phương pháp hay nhất là kích hoạt EDR khi có cả nội dung HDR và khoảng không EDR tiềm năng.

Vô hiệu hóa EDR khi đây không phải là trường hợp.

Tương tự, chọn các phiên bản nội dung HDR hoặc SDR để mở hoặc phát trực tuyến dựa trên nếu khoảng không tiềm năng của EDR, hoặc thậm chí là khoảng không EDRmax hiện tại, lớn hơn đáng kể so với 1.0.

Hoặc, đơn giản hơn, chỉ bật EDR khi người dùng sẽ thấy sự khác biệt.

Chúng tôi đã đề cập rất nhiều về EDR trong một khoảng thời gian ngắn.

Tôi hy vọng bạn cũng hào hứng với EDR như tôi, và mong muốn tích hợp nó vào các ứng dụng của bạn.

Tóm lại, EDR được sử dụng trên các thiết bị macOS, iOS, iPadOS và tvOS.

EDR là một phần mở rộng cho quản lý màu sắc và biểu diễn SDR mà bạn đang sử dụng.

EDR rất dễ dàng cho các ứng dụng để chọn tham gia.

EDR tương thích với các tiêu chuẩn HDR của ngành và cung cấp trải nghiệm thích ứng phi phương thức trên các thiết bị và môi trường.

Vui lòng xem các cuộc nói chuyện và tài nguyên sau đây để biết thêm thông tin về phát lại video HDR, Apple Pro Display XDR và kết xuất kim loại của EDR.

Cảm ơn bạn!

Hy vọng bạn tận hưởng phần còn lại của WWDC của mình.

[Âm nhạc].