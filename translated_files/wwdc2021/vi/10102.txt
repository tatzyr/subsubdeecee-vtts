10102

Xin chào.

Tôi là Cindy Clarissa.

Tôi là một kỹ sư phần mềm với Core Location.

Hôm nay, tôi sẽ nói về một số điều mới thú vị cho Core Location trong năm nay.

Chúng tôi đang giới thiệu hai tính năng mới có thể cho phép bạn cung cấp năng lượng cho chức năng dựa trên vị trí trong ứng dụng của mình mà không phải đối mặt với những người có nhu cầu cấp phép cho họ nhiều như vậy.

Bắt đầu với tính năng đầu tiên, chúng tôi sẽ đưa thông báo người dùng dựa trên Khu vực lên watchOS 8.

Giờ đây, ứng dụng Apple Watch của bạn có thể nhắc nhở mọi người bắt đầu tập luyện khi họ đến phòng tập thể dục hoặc cho chó ăn khi họ về nhà.

Ví dụ, ở đây chúng tôi có Ứng dụng trên không sử dụng tính năng mới này để thông báo cho mọi người về các chuyến bay của họ khi họ đến sân bay.

Với các thông báo của người dùng dựa trên Khu vực, hệ thống có thể thay mặt ứng dụng của bạn trình bày thông tin có liên quan đến không gian mà không cần ủy quyền "luôn luôn".

Để tìm hiểu thêm về cách bạn có thể áp dụng thông báo người dùng dựa trên Khu vực cho watchOS, hãy xem phiên "Có gì mới trong watchOS".

Bây giờ hãy nói về chủ đề chính của phiên này.

Chúng tôi đang giới thiệu một cách mới để yêu cầu vị trí giúp mọi người kiểm soát dữ liệu của họ nhiều hơn, đồng thời, cung cấp nhiều chức năng hơn cho ứng dụng của bạn.

Tôi sẽ bắt đầu bằng cách nói về tình trạng ủy quyền vị trí ngày hôm nay và động lực đằng sau tính năng mới của chúng tôi.

Trong iOS 14, khi một ứng dụng yêu cầu ủy quyền vị trí, một lời nhắc ban đầu sẽ xuất hiện và mọi người có khả năng chọn từ Cho phép một lần, Trong khi sử dụng hoặc Không cho phép ủy quyền.

Và với tính năng mới của năm ngoái, mọi người có khả năng kiểm soát độ chính xác của vị trí được gửi đến ứng dụng của bạn.

Một số bạn có thể nhận thấy rằng mọi người chọn Cho phép một lần trên ứng dụng của bạn và có thể họ không nghĩ rằng việc cấp phép khi sử dụng là cần thiết cho ứng dụng của bạn.

Ví dụ: một ứng dụng cửa hàng thú cưng có thể yêu cầu ủy quyền vị trí để xác định cửa hàng thú cưng gần họ nhất, nhưng nó không yêu cầu vị trí của chúng khi chúng chỉ duyệt các tùy chọn thức ăn cho mèo khác nhau.

Trong trường hợp này, những người sử dụng ứng dụng này có thể có nhiều khả năng chọn Cho phép một lần hoặc Không cho phép ủy quyền.

Nếu mọi người chọn Cho phép một lần, chúng tôi sẽ cấp ủy quyền vị trí trong khoảng thời gian họ đang sử dụng ứng dụng của bạn.

Nhưng ứng dụng của bạn sẽ mất quyền khi nó vào nền.

Điều này có thể dẫn đến nhiều yêu cầu ủy quyền vị trí, điều này có thể tác động tiêu cực đến trải nghiệm người dùng.

Trong một trường hợp khác, bạn có thể nhận thấy rằng ai đó mệt mỏi với lời nhắc có thể chọn Không cho phép để ngăn lời nhắc được hiển thị lại.

Điều này có thể dẫn đến việc phải gửi mọi người đến Cài đặt để ủy quyền cho các vị trí sau này.

Khi quyền riêng tư tiếp tục là ưu tiên quan trọng đối với Apple, chúng tôi nghĩ, "Làm thế nào chúng tôi có thể cung cấp nhiều quyền kiểm soát hơn mà không cản trở trải nghiệm người dùng?" Chúng tôi có thể cung cấp một cách dễ dàng và thân thiện để ủy quyền địa điểm chỉ tại thời điểm cần thiết không?

Bắt đầu từ iOS 15, chúng tôi sẽ giới thiệu CLLocationButton cho UIKit và LocationButton cho SwiftUI để giải quyết các điểm khó khăn mà tôi đã đề cập.

Ở đây, chúng tôi có một ứng dụng Park Finder tìm thấy công viên gần nhất gần đó.

Ở phía dưới, chúng tôi có một Nút Vị trí màu xanh lam với tiêu đề "Vị trí hiện tại" bên cạnh glyph mũi tên.

Khi tôi nhấn vào nút, Park Finder có thể lấy vị trí hiện tại của tôi và hiển thị chế độ xem bản đồ của tất cả các công viên gần đó.

Một mũi tên vị trí ở trên cùng bên trái sẽ chuyển sang màu xanh lam để kêu gọi người dùng chú ý đến ủy quyền mà họ vừa cấp.

Một điều cần lưu ý là Nút Vị trí thực sự đang cấp phép ứng dụng của bạn cho phép một lần mà không khiến mọi người phải xem qua lời nhắc mỗi lần.

Sau đó, tôi sẽ xem xét điều này sẽ ảnh hưởng như thế nào đến trạng thái ủy quyền hiện tại của bạn.

Chúng tôi sẽ mang Nút Vị trí đến watchOS, iOS, macOS với các ứng dụng Catalyst và iPad trên Mac.

Bây giờ, hãy đi sâu vào API và cách bạn có thể thêm CLLocationButton vào ứng dụng của mình.

CLLocationButton là một phần của khung CoreLocationUI.

Tương tự như UIButton, CLLocationButton có nguồn gốc từ UIControls.

Vì vậy, bạn có thể sử dụng các chức năng UIControl với nút.

Ngoài ra, chúng tôi có bốn thuộc tính dành riêng cho nút của chúng tôi.

Chúng tôi có CLLocationButtonIcon để đặt loại mũi tên, CLLocationLabel để đặt nhãn của nút, một góc Bán kính để đặt độ tròn của nút và cuối cùng, chúng tôi có fontSize để đặt kích thước của nhãn.

Bây giờ tôi đã xem qua một cái nhìn tổng quan ngắn gọn, bạn có thể tự hỏi, "Làm thế nào tôi có thể nhận được vị trí với CLLocationButton?"

Chà, nó tương tự như yêu cầu vị trí với UIButton.

Tôi nghĩ nó dễ hiểu hơn với một ví dụ.

Hãy để tôi chứng minh cách bạn có thể thay thế UIButton của mình bằng CLLocationButton.

Trong ví dụ UIButton này, tôi sẽ tạo một nút đơn giản yêu cầu vị trí bằng cách trước tiên yêu cầu ủy quyền khi sử dụng khi nhấn nút.

Tôi sẽ bắt đầu bằng cách khởi tạo một UIButton và đặt tiêu đề của nó thành "Vị trí hiện tại".

Tôi muốn thêm một hành động mục tiêu gọi một hàm và thực hiện hành động cần thiết mà chúng tôi muốn mỗi khi nhấn vào nút.

Trong trường hợp này, tôi muốn trưng bày tất cả các công viên gần đó.

Vậy hãy gọi hàm này là "showNearByParks".

Trong chức năng showNearByParks này, tôi sẽ sử dụng locationManager để gọi requestWhenInUseAuthorization và startUpdatingLocation.

Trong chức năng này, tôi cũng sẽ thêm logic bổ sung để hiển thị chế độ xem bản đồ cho phù hợp.

Nhưng, để đơn giản, hãy bỏ qua điều đó.

Hãy bắt đầu bằng cách thay thế UIButton bằng cách xóa hai dòng đầu tiên và thay thế nó bằng một khởi tạo CLLocationButton và sau đó đặt nhãn thành ".currentLocation".

Cuối cùng, chúng tôi có thể nhận xét cuộc gọi yêu cầu WhenInUseAuthorization và đó là vì Nút Vị trí sẽ thay mặt bạn cấp ủy quyền một lần mỗi khi nút được nhấn thành công.

Vì vậy, nếu bạn có một UIButton hiện có, việc thay thế nó sẽ đơn giản như được hiển thị ở đây.

Nhưng chúng tôi muốn làm cho nó dễ dàng hơn, vì vậy bạn có thể xem một ví dụ về ứng dụng Park Finder được đính kèm với bài nói chuyện này.

Đối với những người có ứng dụng SwiftUI, Nút Vị trí cũng có trong SwiftUI.

Bạn có thể sử dụng LocationButton như được hiển thị trong ví dụ ở đây.

Tôi muốn chỉ ra rằng tôi đang sử dụng "symbolVariant" mới của SwiftUI để đặt loại mũi tên và "tint" để đặt màu nền của nút.

Hãy xem qua một số ví dụ về cách bạn có thể tùy chỉnh Nút Vị trí.

Với Nút Vị trí của chúng tôi, bạn có thể tùy chỉnh màu nền, màu văn bản và màu glyph, các góc tròn, v.v.

Đây chỉ là một số kiểu ví dụ mà bạn có thể tạo bằng nút của chúng tôi.

Hãy xem qua các ví dụ từng bước về tùy chỉnh Nút Vị trí.

Hãy bắt đầu với nút mặc định của chúng ta.

Giao diện mặc định có tiêu đề "Vị trí hiện tại" màu trắng và màu nền systemBlue, như được hiển thị ở đây.

Chúng ta có thể đặt biểu tượng nút thành arrowFilled.

Tiếp theo, chúng ta có thể thay đổi màu nền trước của biểu tượng bằng cách đặt tintColor từ trắng sang đen...

Và sau đó đặt màu nền thành màu trắng.

Và cuối cùng, tôi có thể đặt bán kính góc thành các góc tròn bằng cách đặt nó thành 25,0.

Và tùy thuộc vào cách bạn đặt các ràng buộc và kích thước cho nút, nếu chiều rộng của nút bằng chiều cao, bạn có thể tạo một vòng tròn hoàn hảo khi bán kính góc bằng một nửa chiều rộng.

Bây giờ, chúng tôi đã biến nút vị trí mặc định của mình thành một nút tròn màu trắng chỉ với những điều chỉnh đơn giản.

Chúng tôi vừa trải qua một số thay đổi về phong cách mà bạn có thể thêm vào Nút Vị trí.

Bạn có thể tùy chỉnh nút để tạo ra giao diện hoàn hảo phù hợp với ứng dụng của mình.

Tuy nhiên, quyền lực lớn đi kèm với trách nhiệm lớn.

Khi tùy chỉnh Nút Vị trí của bạn, có một số hạn chế mà bạn có thể gặp phải để đảm bảo rằng Nút Vị trí của bạn rõ ràng và hiển thị.

Tôi muốn nói về một số ví dụ mà bạn có thể mong đợi nếu nút của bạn dường như không được vẽ chính xác hoặc nhận được bất kỳ vị trí nào.

Nếu đúng như vậy, trong khi hành động mục tiêu của bạn sẽ được gọi, bạn sẽ không nhận được ủy quyền.

Nhưng đừng lo lắng.

Chúng tôi sẽ cung cấp nhiều phản hồi với các tin nhắn nhật ký để giúp bạn tìm ra những hạn chế mà bạn đang gặp phải.

Ví dụ, đây chỉ là những thông báo nhật ký khác nhau đề cập đến sự thiếu hụt của kích thước nút, giá trị alpha và độ tương phản màu giữa tintColor và backgroundColor.

Bây giờ hãy xem qua một số ví dụ về những phản hồi mà bạn có thể mong đợi nếu bạn đang sử dụng Trình tạo giao diện trong Xcode.

Tiếp tục với nút tôi đã tạo trước đó, nếu tôi thay đổi nút hiện có để có màu trắng, mọi người sẽ không thể nhìn thấy điều này vì màu nền của nút đã có màu trắng.

Vì vậy, nếu bạn làm điều này, bạn sẽ thấy vấn đề này được hiển thị trong ngăn điều hướng bên dưới tab Vấn đề trong Xcode.

Thay vào đó, hãy hoàn nguyên nút ban đầu của chúng ta và cố gắng thay đổi độ mờ đục, hoặc alpha, của nút này.

Có thể bạn có thể thấy điều này, nhưng đối với những người khác, nó hơi quá minh bạch, và vì vậy nó không đạt được các hướng dẫn về khả năng tiếp cận của chúng tôi.

Một tuyên bố vấn đề tương tự được tạo ra trong Xcode, khuyên bạn nên tăng giá trị alpha.

Một vấn đề khác mà bạn có thể gặp phải là kích thước nút không đủ.

Đây là khi nội dung của nút quá nhỏ hoặc quá lớn so với kích thước nút.

Tùy thuộc vào cài đặt bản địa hóa của người dùng, độ dài văn bản của nút có thể thay đổi.

Bây giờ hãy tăng kích thước văn bản bằng cách thay đổi ngôn ngữ.

Tùy thuộc vào việc triển khai của bạn có thân thiện với bố cục tự động hay không, nếu chúng tôi thay đổi ngôn ngữ, kích thước của văn bản có thể lớn hơn nút.

Lưu ý rằng văn bản không vừa với nút bằng tiếng Đức.

Nếu điều này xảy ra, hãy xem thông báo nhật ký để nhận phản hồi.

Đừng quên kiểm tra Nút Vị trí của bạn với kích thước văn bản thực sự nhỏ hoặc thực sự lớn, cũng như kiểm tra nó bằng các ngôn ngữ khác nhau để đảm bảo rằng nút của bạn đang hoạt động trong mọi trường hợp.

Vì vậy, khi tùy chỉnh nút của bạn, hãy nhớ rằng điều bắt buộc là nó phải rõ ràng và hiển thị.

Nếu nút của bạn dường như không được vẽ chính xác hoặc nhận vị trí, có thể nó không còn dễ đọc nữa.

Nếu đúng như vậy, chúng tôi cung cấp thông báo nhật ký để được hướng dẫn giúp bạn xác định điều gì có thể xảy ra.

Bây giờ bạn đã biết cách triển khai Nút Vị trí, bạn có thể tự hỏi nó sẽ ảnh hưởng như thế nào đến trạng thái ủy quyền hiện tại của bạn.

Như tôi đã đề cập trước đây, Nút Vị trí về cơ bản cung cấp cho bạn ủy quyền Cho phép-Một lần.

Nếu ứng dụng của bạn không có bất kỳ trạng thái ủy quyền nào dưới bất kỳ hình thức nào, nó sẽ có ủy quyền "Không xác định" với "Khi tôi chia sẻ" được chọn trong Cài đặt quyền riêng tư.

Nếu đây là trạng thái hiện tại của ứng dụng của bạn, thì lần đầu tiên mỗi người dùng nhấn Nút Vị trí, lời nhắc này sẽ yêu cầu họ xác nhận rằng họ đang ở trên tàu.

Tuy nhiên, nếu ứng dụng của bạn đã được ủy quyền cho vị trí, chẳng hạn như trạng thái "Trong khi sử dụng ứng dụng", thì việc sử dụng Nút vị trí sẽ không thay đổi trạng thái hiện tại của bạn và sẽ hoạt động giống như bất kỳ UIButton nào khác.

Nơi nó hoạt động, Nút Vị trí có thể cảm thấy kỳ diệu và cũng yên tâm, bởi vì bạn đang để mọi người quyết định khi nào và liệu vị trí của họ có được sử dụng mỗi lần hay không.

Vì Nút Vị trí thoải mái hơn nhiều, chúng tôi nghĩ rằng mọi người sẽ có nhiều khả năng cung cấp vị trí ứng dụng của bạn thông qua Nút Vị trí hơn so với trước đây.

Vì vậy, chúng tôi muốn cung cấp cho người dùng và ứng dụng của bạn một cơ hội khác để đi đúng hướng.

Nếu ai đó, người đã chọn ủy quyền "Không cho phép" trên ứng dụng của bạn trong quá khứ nhấn vào Nút Vị trí mới của chúng tôi, họ sẽ thấy lời nhắc giới thiệu nút này và có cơ hội chuyển ứng dụng của bạn trở lại NotDetermined và sử dụng Nút Vị trí trong tương lai.

Vì vậy, trong phiên này, tôi đã nói về việc mang lại nhiều khả năng năng động hơn cho các ứng dụng watchOS của bạn với các thông báo người dùng dựa trên Khu vực.

Nếu bạn quan tâm đến việc tìm hiểu thêm, đừng quên xem các tài nguyên với phiên.

Chúng tôi cũng đã đề cập đến một số tính năng mới thú vị có thể thay đổi trò chơi về cách bạn có thể yêu cầu vị trí.

Cho phép mọi người kiểm soát nhiều hơn đối với quyền riêng tư dữ liệu của họ là điều quan trọng đối với Apple.

Mọi người ngày càng nhận thức rõ hơn về cách dữ liệu của họ đang được chia sẻ.

Khi thiết kế ứng dụng của bạn để cung cấp trải nghiệm người dùng tuyệt vời nhất, nhưng cũng xây dựng niềm tin với khách hàng của bạn, bạn có thể muốn tự hỏi mình: "Ứng dụng của tôi có yêu cầu ủy quyền truyền thống hay ủy quyền vị trí một lần với Nút Vị trí sẽ phù hợp hơn?"

Và câu trả lời, trong một số trường hợp, có thể là một lần là đủ.

Với Nút Vị trí, bạn có thể có được sự tin tưởng với mọi người bằng cách kiểm soát nhiều hơn khi họ muốn chia sẻ vị trí của họ.

Cảm ơn bạn.

[Âm nhạc].