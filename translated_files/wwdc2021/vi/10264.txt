10264

Xin chào, tôi là Nicki Brower.

Tôi là một kỹ sư trong nhóm Bút chì và Giấy.

Và hôm nay, tôi sẽ chỉ cho bạn cách áp dụng Quick Note.

Quick Note là một trải nghiệm ghi chú hoàn toàn mới, trên toàn hệ thống nhằm mục đích không chỉ hợp lý hóa khả năng ghi chú trên iOS và macOS mà còn kết nối nội dung từ nhiều ứng dụng và web ở một vị trí.

Tính năng này cho phép mọi người dễ dàng hiển thị Ghi chú ở bất cứ đâu và phần tốt nhất là, nó sử dụng API đã tồn tại: NSUserActivity.

Nếu điều đó nghe có vẻ quen thuộc, đó là vì nó được sử dụng cho các tính năng khác, như Handoff.

Hôm nay, tôi sẽ cho bạn xem Ghi chú nhanh trực tiếp và đang hoạt động.

Tôi sẽ nói về cách nó hoạt động trên hệ thống và cách áp dụng NSUserActivity.

Cuối cùng, tôi sẽ xem xét một số phương pháp hay nhất để bạn có thể tạo ra trải nghiệm tốt nhất.

Để cho bạn thấy tính năng Ghi chú nhanh mới, tôi sẽ thực hiện kế hoạch hành động của mình để lấy lại vóc dáng bằng Apple Fitness+.

Tôi chưa đăng ký, và tôi không muốn thiếu một kế hoạch hành động.

Thay vì phải chuyển sang ứng dụng Ghi chú, bây giờ tôi có thể sử dụng bút chì của mình để vuốt lên từ góc dưới cùng bên phải của màn hình để tạo Ghi chú nhanh hoàn toàn mới để nhớ rằng khi tôi sẵn sàng bắt đầu, trang web Apple có tất cả thông tin tôi cần biết.

Ngoài ra còn có một menu thêm liên kết mới ở đầu Ghi chú nhanh, nơi tôi sẽ thêm liên kết đến trang web để dễ dàng điều hướng trở lại nội dung này.

Tương tự như hình ảnh trong hình ảnh, cửa sổ Ghi chú nhanh có thể tự do di chuyển đến bất kỳ góc nào của thiết bị.

Tôi cũng có thể chụm để chia tỷ lệ cửa sổ từ kích thước mặc định, đến kích thước nhỏ nhất, lên đến kích thước lớn nhất.

Nếu tôi hoàn thành ghi chú của mình, tôi có thể nhấn nút Xong ở góc trên cùng bên trái.

Nhưng tôi vẫn còn một số thứ tôi cần thêm vào, vì vậy tôi sẽ vuốt giao diện người dùng sang phải để giấu nó ở bên cạnh màn hình.

Tất nhiên, ngoài các trang web, nó cũng hoạt động với các ứng dụng.

Sử dụng Bản đồ, tôi đã có thể tìm thấy một địa điểm tuyệt vời để thực hành các bài tập HIIT của mình.

Tôi sẽ lấy ra ghi chú mà tôi đã giấu đi và thêm vị trí này vào ghi chú của mình.

Để có thêm không gian để vẽ, hãy nhấn vào biểu tượng Ghi chú từ thanh công cụ Ghi chú nhanh để truy cập ghi chú trong ứng dụng Ghi chú.

Ở đây, tôi sẽ tận dụng khả năng vẽ qua các hình ảnh và liên kết.

Các liên kết tôi đã thêm vào đây không chỉ là bất kỳ liên kết cũ nào.

Chắc chắn, nhấn vào chúng sẽ đưa tôi đến Safari hoặc Bản đồ, nhưng bây giờ tôi có thể quay lại ghi chú của mình từ các ứng dụng này với Đề xuất Ghi chú Nhanh.

Khi tôi truy cập trang web về Apple Fitness+, giao diện người dùng Gợi ý Ghi chú Nhanh sẽ hiển thị ở góc dưới cùng bên phải.

Nhấn vào điều này sẽ đưa tôi trở lại ngay nơi tôi đã ở và tôi sẽ thêm một lưu ý rằng mục tiêu của tôi là thực hiện bài tập HIIT 4 đến 5 lần một tuần.

Tôi đã tạo một ghi chú ở đây trên iPad, nhưng nó cũng hoạt động đa nền tảng với Mac.

Khi tôi truy cập liên kết về Apple Fitness+, giao diện người dùng gợi ý ghi chú nhanh cũng sẽ xuất hiện ở đây trên máy Mac của tôi.

Khi tôi nhấp vào nó, tôi sẽ được chuyển đến ghi chú trong ứng dụng Ghi chú.

Bây giờ bạn đã gặp Quick Note, hãy nói về cách nó hoạt động.

Một đối tượng NSUserActivity cung cấp một cách để nắm bắt trạng thái của một ứng dụng và đưa nó vào sử dụng sau này.

Các đối tượng hoạt động của người dùng được tạo ra về những gì đang xảy ra, chẳng hạn như xem trang web hoặc xem nội dung ứng dụng và mỗi ứng dụng sẽ đăng ký hoạt động hiện tại của mình với hệ thống.

Hệ thống sau đó nhận các hoạt động này và gửi chúng đến các tính năng như Handoff.

Ghi chú nhanh liên kết cõng trên hệ thống này.

Ngoài việc chuyển sang Handoff, Spotlight và Reminders, các hoạt động đã đăng ký cũng được gửi đến Quick Note.

Đây là cách liên kết hiển thị trong menu thêm liên kết và điều gì kích hoạt Đề xuất Ghi chú Nhanh.

NSUserActivity đã có ba thuộc tính đóng vai trò là số nhận dạng bền để liên kết nội dung ứng dụng với Quick Note.

Để trở thành một phần của hệ sinh thái này, bạn phải đặt một hoặc nhiều thuộc tính sau: targetContentIdentifier, persistentIdentifier và webpageURL.

Bạn chọn cái nào phụ thuộc vào những tính năng khác mà bạn muốn hỗ trợ.

targetContentIdentifier cũng được sử dụng trong quá trình khôi phục trạng thái.

Thuộc tính này tạo ra trải nghiệm đa nhiệm tuyệt vời cho các ứng dụng chạy trên iPad.

persistentIdentifier cũng được sử dụng để xác định nội dung ứng dụng trong chỉ mục Spotlight của hệ thống và webpageURL cũng được sử dụng cho dự phòng web trong Handoff.

Để các liên kết Ghi chú Nhanh hoạt động, có một vài thuộc tính mà số nhận dạng cần phải có.

Chúng phải là duy nhất cho phần nội dung đó, mang tính toàn cầu để chúng hoạt động trên tất cả các thiết bị và đủ ổn định để hoạt động cho nội dung đó theo thời gian.

Có một mã định danh duy nhất, toàn cầu và ổn định cho một hoạt động cho phép Đề xuất Ghi chú Nhanh.

Khi tôi quay lại trang web về Apple Fitness+, lý do giao diện người dùng Gợi ý Ghi chú Nhanh xuất hiện là vì mã định danh trong liên kết, được tạo một giờ trước hoặc sáu tháng trước, vẫn khớp với mã định danh trên trang web.

Có ba bước chính để áp dụng NSUserActivity: khai báo các hoạt động được hỗ trợ trong Info.plist của ứng dụng của bạn, tạo và đăng ký các hoạt động của người dùng mô tả những gì trên màn hình tại các thời điểm khác nhau và xử lý các yêu cầu đến để tiếp tục hoạt động.

Điều này có thể đến từ một liên kết trong Quick Note hoặc từ một thiết bị khác.

Khai báo các loại hoạt động mà ứng dụng của bạn hỗ trợ theo khóa NSUserActivityTypes trong tệp Info.plist của nó.

Hệ thống sử dụng thông tin trong khóa đó để xác định xem ứng dụng của bạn có khả năng xử lý một đối tượng hoạt động người dùng nhất định hay không.

Để tạo một đối tượng NSUserActivity, hãy sử dụng một trong các chuỗi loại hoạt động đã đăng ký plist của bạn và đặt tiêu đề.

Đặt một hoặc nhiều trong ba số nhận dạng được đề cập trước đó.

Bất kỳ một trong những số nhận dạng này đều có thể được sử dụng cho Ghi chú nhanh.

Đối với ví dụ này, giả sử ứng dụng của bạn là một ứng dụng iPad cũng quan tâm đến việc hỗ trợ khôi phục trạng thái.

Đặt targetContentIdentifier.

Đặt thuộc tính userInfo với bất kỳ thông tin trạng thái cụ thể nào của ứng dụng cần thiết để tiếp tục hoạt động.

Sau đó, gắn nó vào một người phản hồi.

Thay vì phải đăng ký hoạt động bằng cách quản lý thủ công hoạt động ứng dụng hiện tại, hãy để hệ thống xử lý nó cho bạn.

Bằng cách thiết lập hoạt động trên trình phản hồi, đối tượng được quản lý bởi UIKit và AppKit.

Bởi vì NSUserActivity là đa nền tảng, mã này hoạt động trên cả iOS và macOS.

Bước cuối cùng là xử lý việc nhận các hoạt động đến và khôi phục trạng thái của nó trong ứng dụng của bạn.

Khi một liên kết được nhấn, Quick Note sẽ khởi chạy ứng dụng của bạn và gọi phương thức cảnh (willContinueUserActivityWithType) của UIWindowSceneDelegate.

Đây là nơi bạn có thể đưa ra một số phản hồi rằng ứng dụng của bạn đang nhận được hoạt động.

Ghi chú nhanh sau đó cung cấp hoạt động cho ứng dụng của bạn trong cảnh (tiếp tục userActivity:).

Đây là nơi bạn thiết lập bất kỳ bộ điều khiển chế độ xem, chế độ xem nào và sử dụng từ điển userInfo để khôi phục và tiếp tục hoạt động.

Trong trường hợp Handoff, nếu các thiết bị không thể kết nối, hệ thống sẽ gọi cảnh (didFailToContinueUserActivityWithType) nơi bạn có thể hiển thị thông báo lỗi.

Phương pháp này sẽ không được gọi cho Quick Note, nhưng rất tốt để thực hiện để áp dụng NSUserActivity toàn diện.

Đối với các ứng dụng macOS, hãy triển khai ứng dụng tương đương (willContinueUserActivityWithType), ứng dụng (tiếp tục userActivity) và ứng dụng (didFailToContinueUserActivityWithType) trong đại diện ứng dụng.

Để biết thêm thông tin về việc áp dụng NSUserActivity, hãy xem video WWDC 2014, "Adopting Handoff trên iOS 8 và OS X."

NSUserActivity là một cổng vì nó là nền tảng cho nhiều tính năng khác.

Bằng cách áp dụng nó cho Quick Note, đây là mọi thứ khác mà bạn có thể nhận được.

Chuyển giao được bật theo mặc định, trong khi những người khác đang chọn tham gia.

Ứng dụng của bạn có thể còn mạnh hơn vì mọi người có thể tạo lời nhắc về tài liệu trong ứng dụng của bạn hoặc có bài đăng trên blog từ ứng dụng của bạn hiển thị trong ánh đèn sân khấu hoặc cải thiện khả năng xử lý đa cửa sổ.

Kiểm tra tài liệu mới nhất và các video WWDC liên quan để biết thêm thông tin.

Cuối cùng, nhưng chắc chắn không kém phần quan trọng, chúng ta hãy xem qua một số phương pháp hay nhất để áp dụng NSUserActivity cho Quick Note.

Tôi sẽ xem xét bốn hành vi và đối với mỗi hành vi này, tôi sẽ nói về lý do và cách triển khai chúng trong ứng dụng của bạn.

Thuộc tính tiêu đề là một chuỗi có thể đọc được của con người cho hoạt động.

Đây là chuỗi hiển thị trong menu thêm liên kết.

Điều đó nói rằng, tiêu đề nên cung cấp một đại diện tốt, mô tả về nội dung.

Nói chung, tốt hơn là sử dụng tiêu đề của tài liệu hoặc mục trực tiếp.

Có một vài mẹo để giúp các số nhận dạng là duy nhất, toàn cầu và ổn định.

Tránh sử dụng dữ liệu dành riêng cho thiết bị.

Nếu mã định danh cho bức ảnh này là đường dẫn tệp cục bộ của nó, liên kết chỉ được đảm bảo hoạt động trên thiết bị mà nó được tạo.

Tránh bất kỳ thông tin thoáng qua nào, như ID phiên hoặc các thuộc tính xem cụ thể.

Tiêu đề của bức ảnh có thể hoàn toàn độc đáo, nhưng nếu nó có thể được sửa đổi, không có gì đảm bảo nó sẽ tồn tại khi cố gắng điều hướng trở lại nội dung này.

Suy nghĩ lâu dài, như sử dụng UUID đã lưu của ứng dụng cho ảnh, sẽ cho phép ứng dụng của bạn khôi phục các liên kết Ghi chú Nhanh, ngay cả khi nội dung đã được di chuyển xung quanh.

Mặc dù URL có thể là số nhận dạng duy nhất cho nội dung ứng dụng, nhưng chúng thường chứa thông tin trạng thái tạm thời, vi phạm các nguyên tắc nhận dạng được đề cập trước đó.

Quick Note thích targetContentIdentifier hoặc persistentIdentifier hơn webpageURL.

webpageURL hoàn toàn ổn để sử dụng, miễn là nó tuân theo các hướng dẫn.

Nếu ứng dụng của bạn sử dụng NSUserActivity cho cả khôi phục trạng thái và Spotlight, hãy sử dụng cùng một giá trị cho targetContentIdentifier và persistentIdentifier.

Nếu bạn có một trang web khen ngợi ứng dụng của mình, hãy thêm URL làm mã định danh dự phòng thứ hai.

Bằng cách này, nếu ứng dụng chưa được cài đặt, việc mở một liên kết sẽ chuyển hướng đến trang web của bạn.

Một thực hành quan trọng khác là đảm bảo NSUserActivity hiện tại của ứng dụng được cập nhật.

Điều này có nghĩa là theo kịp những gì đang xảy ra.

Phương pháp hay nhất là giữ cho các thuộc tính tiêu đề và định danh chính xác khi phát hiện bất kỳ thay đổi hoạt động nào, chẳng hạn như chọn xem một bức ảnh khác.

Không nên sử dụng lại các phiên bản hoạt động.

Khi có nội dung mới, như bức ảnh mới, hãy tạo một hoạt động mới.

Hãy để UIKit và AppKit xử lý hoạt động ứng dụng hiện tại bằng cách đính kèm các hoạt động vào các trình phản hồi như viewControllers hoặc chế độ xem, như tôi đã hiển thị trong mã ví dụ.

Nếu đính kèm vào trình phản hồi không hoạt động cho ứng dụng của bạn, hoạt động ứng dụng hiện tại có thể được quản lý thủ công bằng cách gọi becomeCurrent() và resignCurrent() vào những thời điểm thích hợp.

Ví dụ: khi xem xong ảnh, ứng dụng sẽ gọi resignCurrent() trên hoạt động hiện tại và khi một ảnh mới được chọn, ứng dụng sẽ gọi becomeCurrent() trên hoạt động mới.

Để có hiệu suất tốt hơn, hãy tận dụng thuộc tính "needsSave" của hoạt động.

Một hoạt động có thể cần các thuộc tính xem cụ thể để khôi phục đúng hoạt động trong ứng dụng.

Ví dụ, vị trí và thu phóng khi xem bản đồ.

Các thuộc tính này có thể được chuyển cùng với hoạt động, nhưng có chi phí khi cập nhật sau mỗi cử chỉ.

Thay vì cập nhật hoạt động, hãy đặt needsSave thành true.

Khi hệ thống cần gửi hoạt động đến liên kết Ghi chú nhanh hoặc Chuyển giao, cuộc gọi lại đại diện userActivityWillSave được gọi, để ứng dụng có thể cập nhật tất cả các thuộc tính theo yêu cầu.

Cuộc gọi lại này là nơi từ điển userInfo có thể được cập nhật để bao gồm bất kỳ thuộc tính nào giúp khôi phục hoạt động.

Có một vài vấn đề tương thích cần chuẩn bị.

Điều gì sẽ xảy ra nếu ứng dụng đã được cập nhật?

Ghi chú điều này với hai liên kết từ một ứng dụng.

Các liên kết có thể là từ phiên bản cũ hơn hoặc mới hơn của ứng dụng so với trên thiết bị.

Hoàn toàn ổn, nhưng các liên kết vẫn cần phải hoạt động.

Để chuẩn bị cho việc xử lý khả năng tương thích, hãy hỗ trợ xử lý các hoạt động nhận từ các phiên bản trước của ứng dụng của bạn và thất bại một cách duyên dáng khi nhận các hoạt động từ các phiên bản mới hơn.

Điều này có thể được hỗ trợ từ việc lập phiên bản các hoạt động của bạn hoặc sử dụng từ điển các khóa và chịu được các khóa bị thiếu hoặc có một số khóa mà bạn không hiểu.

Điều gì sẽ xảy ra nếu nội dung không còn tồn tại nữa?

Nội dung mà hoạt động được liên kết có thể đã bị xóa hoặc di chuyển.

Khi điều hướng trở lại ứng dụng, hãy hiển thị thông báo lỗi nếu bị xóa hoặc chuyển hướng nếu nội dung được di chuyển.

Áp dụng Quick Note kết nối ứng dụng của bạn vào hệ thống ghi chú mới này.

Một hệ thống được thiết kế để cải thiện kết nối giữa con người, nội dung và ứng dụng của bạn.

Đảm bảo rằng bạn đã áp dụng NSUserActivity.

Bây giờ là một cơ hội tuyệt vời để xem lại và đánh bóng bất kỳ mã hiện có nào.

Có các số nhận dạng duy nhất, toàn cầu và ổn định.

Và thiết lập các hoạt động của bạn trên những người phản hồi để cho phép hệ thống quản lý NSUserActivity hiện tại của ứng dụng.

Cảm ơn bạn đã xem, và tôi mong được thấy ứng dụng của bạn trong Quick Note và hơn thế nữa.

[Nhạc gõ].