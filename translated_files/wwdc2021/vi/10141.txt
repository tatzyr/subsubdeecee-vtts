10141

♪ Nhạc bass đang phát ♪

♪

Naiwei Zheng: Xin chào. Chào mừng đến với WWDC.

Tên tôi là Zheng Naiwei.

Tôi đến từ Nhóm Phát trực tuyến HLS của Apple.

Hôm nay tôi sẽ nói về một tính năng mới trong HLS được gọi là Chỉ đạo nội dung và cách nó có thể cải thiện tính khả dụng phát trực tuyến toàn cầu.

Kết nối mạng ngày nay ở quy mô toàn cầu.

Các nhà cung cấp phương tiện truyền thông trực tuyến cung cấp nội dung của họ trên toàn thế giới.

Tuy nhiên, việc cung cấp nội dung ở quy mô toàn cầu đi kèm với rất nhiều thách thức mà ngành công nghiệp phải giải quyết.

Chúng tôi, Nhóm phát trực tuyến HLS tại Apple, cũng nhận ra những vấn đề đầy thách thức này và liên tục làm việc để cung cấp các giải pháp.

Hôm nay, chúng tôi sẽ tập trung vào vấn đề sẵn có.

Cụ thể, giảm thiểu tắc nghẽn mạng và phục hồi lỗi.

Để giúp chúng tôi hiểu những vấn đề này, chúng ta hãy xem một ví dụ.

Giả sử một nhà cung cấp dịch vụ phát trực tuyến phổ biến ở châu Á triển khai cơ sở hạ tầng CDN của mình ở ba quốc gia sau: Trung Quốc, Nhật Bản và Singapore.

Trong biểu đồ này, chúng tôi đang hiển thị trạng thái mà mọi thứ đang hoạt động trong tình trạng hoàn hảo.

Chúng tôi có người dùng ở Trung Quốc phát trực tuyến từ CDN Trung Quốc và người dùng từ Nhật Bản phát trực tuyến từ CDN Nhật Bản và cả hai mạng CDN đều đang hoạt động ở mức có khả năng.

Bây giờ, hãy giới thiệu một số thay đổi.

Giả sử một lúc sau, người dùng ở Trung Quốc phát trực tuyến từ CDN của Trung Quốc đã tăng lên rất nhiều, đến mức mạng CDN đang trở nên quá tải.

Với các công nghệ HLS mà chúng tôi có, thật khó để giải quyết đầy đủ vấn đề tắc nghẽn mạng này.

Mặc dù chúng tôi có thể chỉ định người dùng mới cho các CDN khác nhau, tuy nhiên, rất khó để hướng dẫn các khách hàng hiện tại sử dụng một CDN khác và lưu lượng hiện tại sẽ liên tục làm quá tải CDN hiện tại.

Với tính năng Chỉ đạo Nội dung HLS mới của chúng tôi, các nhà cung cấp nội dung có thể giải quyết vấn đề này bằng cách lưu trữ máy chủ chỉ đạo của riêng họ.

Nó thiết lập một kênh phụ với tất cả các khách hàng HLS mới nhất để cập nhật cho họ chính sách CDN mới nhất.

Ví dụ, nó có thể gửi bản cập nhật chính sách cho 30 phần trăm khách hàng hiện tại ở Trung Quốc để chuyển sang CDN Nhật Bản.

Và các khách hàng nhận được bản cập nhật chính sách sẽ tôn trọng sự thay đổi và chuyển hướng lưu lượng mạng của họ đến CDN Nhật Bản.

Giờ đây, tình trạng tắc nghẽn mạng trong CDN của Trung Quốc đã được giảm thiểu.

Nhưng tắc nghẽn mạng chỉ là một trong nhiều vấn đề về tính khả dụng.

Điều gì xảy ra khi mất mạng?

Hãy lấy một ví dụ khác.

Giả sử đường dẫn mạng từ người dùng ở Nhật Bản đến CDN Nhật Bản đã trải qua sự cố ngừng hoạt động trong khu vực.

Với các công nghệ HLS mà chúng tôi có, các nhà cung cấp nội dung có thể liệt kê các luồng biến thể dự phòng của chúng tôi trong danh sách phát chính, vì vậy khách hàng có thể thử xem qua danh sách cho đến khi nó đạt đến CDN hoạt động.

Nhưng cách tiếp cận này là sơ bộ theo nghĩa là nhà cung cấp nội dung không thể thay đổi thứ tự hoặc mức ưu tiên của các CDN được liệt kê trong danh sách phát chính trong thời gian thực.

Tuy nhiên, với sự trợ giúp của máy chủ chỉ đạo, khách hàng sẽ được cập nhật các ưu tiên CDN mới nhất vào thời gian gần như thực.

Hãy tua lại một chút để xem nó có thể tạo điều kiện cho khách hàng khôi phục lỗi hiệu quả hơn như thế nào.

Trước khi mạng ngừng hoạt động, các khách hàng ở Nhật Bản định kỳ lấy các bản cập nhật danh sách ưu tiên CDN từ máy chủ chỉ đạo.

Giả sử trong bản cập nhật mới nhất, khách hàng ở Nhật Bản đã nhận được danh sách ưu tiên CDN sau đây, nơi CDN Nhật Bản được ưa thích nhất, sau Singapore và sau đó là Trung Quốc.

Hiện tại, người dùng ở Nhật Bản đang phát trực tuyến từ CDN Nhật Bản.

Bây giờ khi sự cố mất mạng xảy ra, CDN Nhật Bản sẽ bị đánh dấu là bị phạt từ danh sách ưu tiên.

Khách hàng sẽ chuyển sang CDN tiếp theo trong danh sách ưu tiên, trong trường hợp này là CDN ở Singapore và chuyển hướng lưu lượng mạng của họ.

Giờ đây, người dùng ở Nhật Bản sẽ có thể tiếp tục xem các chương trình của họ mà không bị gián đoạn.

Những gì ví dụ của chúng tôi cho bạn thấy chỉ là một cái nhìn tổng quan cấp cao về tính năng HLS mới của chúng tôi, Chỉ đạo nội dung.

Bây giờ hãy đi sâu hơn để chỉ cho bạn cách tích hợp tính năng tuyệt vời này vào các luồng của bạn.

Nó chỉ là một danh sách đơn giản các URL CDN khác nhau sao chép tất cả các biến thể có sẵn.

Như đã giải thích trước đây, một danh sách phát như thế này có thứ tự liên tục và cuối cùng của các ưu tiên CDN.

Các nhà cung cấp nội dung không thể thay đổi nó sau này trong quá trình phát lại.

Bây giờ hãy xem cách thêm hỗ trợ Chỉ đạo Nội dung vào danh sách phát này.

Bạn có thể ngạc nhiên khi sự thay đổi được giới thiệu ít như thế nào.

Trên thực tế, những thay đổi tương thích ngược với các khách hàng HLS hiện tại.

Hãy xem qua các bổ sung.

Đáng chú ý nhất, bây giờ chúng tôi nhóm các luồng biến thể thành các con đường khác nhau bằng các thuộc tính PATHWAY-ID trên mỗi luồng biến thể, trong đó mỗi con đường thường tương ứng với một CDN.

Trong ví dụ này, chúng tôi nhóm các luồng biến thể thành con đường CN, JP và SG, đại diện cho các CDN ở Trung Quốc, Nhật Bản và Singapore, tương ứng.

Tuy nhiên, một con đường có thể chứa các luồng biến thể từ các CDN khác nhau để cho phép trường hợp sử dụng nâng cao hơn.

Khi khách hàng chọn một con đường, chỉ những luồng biến thể từ con đường đó mới đủ điều kiện để lựa chọn biến thể.

Thuộc tính PATHWAY-ID trên thẻ CONTENT-STEERING mới chỉ định đường dẫn ban đầu để sử dụng khi khởi động phát lại.

Vì vậy, trong trường hợp này, khách hàng sẽ chỉ chọn từ các luồng biến thể thuộc đường dẫn CN ở lần phát lại ban đầu.

Thuộc tính SERVER-URI chỉ định máy chủ Chỉ đạo Nội dung ở đâu.

Khách hàng sẽ yêu cầu cập nhật Chỉ đạo Nội dung từ URI này.

Nhưng nếu danh sách phát của bạn chứa các nhóm phương tiện thì sao?

Không vấn đề gì.

Nó vẫn rất đơn giản để kích hoạt Chỉ đạo Nội dung.

Tất cả những gì bạn phải làm là sao chép các nhóm phương tiện cho mỗi con đường và gán chúng bằng các GROUP-ID duy nhất.

Ví dụ, nhóm âm thanh trong danh sách phát này đang được sao chép cho mỗi con đường, với GROUP-ID được đặt thành âm thanh CN cho con đường CN và vân vân.

Khi một máy khách HLS tải một danh sách phát chính với thẻ Chỉ đạo Nội dung, nó sẽ kích hoạt một quy trình khởi động hơi khác một chút.

Đầu tiên, khi nó thực hiện lựa chọn luồng biến thể ban đầu, nó sẽ chỉ sử dụng các luồng biến thể từ con đường ban đầu.

Sau đó, nó sẽ tải và bắt đầu phát luồng biến thể đã chọn và các phân đoạn phương tiện của nó như bình thường.

Nhưng song song với thói quen phát lại thông thường, khách hàng sẽ bắt đầu thực hiện các yêu cầu Bản kê khai chỉ đạo định kỳ trong nền.

Chúng ta hãy xem yêu cầu Bản kê khai chỉ đạo trông như thế nào.

Nó chỉ là một yêu cầu HTTP GET đơn giản được gửi đến URI đã được giải quyết này từ thuộc tính SERVER-URI dựa trên URL danh sách phát chính.

Máy chủ chỉ đạo sẽ phản hồi bằng Bản kê khai chỉ đạo.

Hãy phân tích định dạng của nó với một ví dụ.

Bản kê khai chỉ đạo là một tài liệu JSON.

Máy chủ chỉ đạo có thể tạo ra các Bản kê khai chỉ đạo tùy chỉnh cho từng khách hàng.

Điều này mang lại cho máy chủ điều khiển tiềm năng lớn trong việc định hình lưu lượng mạng được quản lý của nó.

Thuộc tính quan trọng nhất trong Bản kê khai chỉ đạo này là trường PATHWAY-PRIORITY.

Đó là danh sách các ID lộ trình được sắp xếp theo các ưu tiên của họ, với ID đầu tiên là ưu tiên nhất.

Ở đây trong ví dụ này, chúng tôi ưu tiên con đường CN được ưu tiên nhất, tiếp theo là JP và sau đó là SG.

Khi nhận được Bản kê khai chỉ đạo từ máy chủ chỉ đạo, khách hàng sẽ thực hiện đánh giá Chỉ đạo nội dung để xác định xem có nên chuyển sang một con đường khác hay không.

Đầu tiên, khách hàng sẽ loại trừ các luồng biến thể không đủ điều kiện để lựa chọn.

Điều này bao gồm các luồng biến thể bị phạt do lỗi mạng.

Ngoài ra, các luồng biến thể với codec không được hỗ trợ, giống như lựa chọn biến thể thông thường sẽ làm.

Nó sẽ chọn một con đường có ít nhất một luồng biến thể đủ điều kiện và có mức độ ưu tiên con đường cao nhất trong số tất cả các con đường đủ điều kiện.

Nếu con đường được chọn khác với con đường hiện đang sử dụng, khách hàng sẽ ngay lập tức chuyển sang con đường mới.

Nếu không có con đường phù hợp nào được chọn hoặc đã sử dụng con đường đã chọn, khách hàng sẽ không làm gì cả và tiếp tục chơi bằng con đường hiện tại.

Cuối cùng, khách hàng sẽ lên lịch cho yêu cầu Bản kê khai chỉ đạo tiếp theo để lấy các bản cập nhật mới nhất từ máy chủ chỉ đạo.

Vậy lịch trình này hoạt động như thế nào?

Hãy xem lại Bản kê khai chỉ đạo.

Lưu ý rằng có một trường TTL chỉ định số giây mà khách hàng nên đợi cho đến khi gửi yêu cầu Bản kê khai chỉ đạo tiếp theo.

Trong ví dụ này, sau khi khách hàng thực hiện đánh giá Chỉ đạo Nội dung bằng cách sử dụng danh sách ưu tiên con đường của Bản kê khai Chỉ đạo này, nó sẽ lên lịch cho yêu cầu Bản kê khai Chỉ đạo tiếp theo trong 300 giây, tức là năm phút.

Cũng cần lưu ý rằng máy chủ chỉ đạo có thể thay đổi giá trị TTL này trong mỗi phản hồi Bản kê khai chỉ đạo, ảnh hưởng đến thời gian khách hàng nên lên lịch cho yêu cầu tiếp theo.

Nó cũng hữu ích cho việc điều khiển máy chủ để đưa một số ngẫu nhiên vào giá trị TTL của mỗi khách hàng để phân phối tải máy chủ.

Ngoài ra, trường RELOAD-URI tùy chọn cho khách hàng biết nơi yêu cầu Bản kê khai chỉ đạo tiếp theo.

Máy chủ chỉ đạo có thể tận dụng trường này để đưa dữ liệu phiên hoặc trạng thái dành riêng cho khách hàng vào URL để được lặp lại trong yêu cầu tiếp theo.

Bây giờ bạn đã thấy các chi tiết kỹ thuật chính của Chỉ đạo Nội dung.

Hãy quay lại một trong những ví dụ ban đầu của chúng tôi để xem nó hoạt động như thế nào dưới mui xe.

Giả sử trong trường hợp này, tất cả người dùng ở Trung Quốc đã nhận được Bản kê khai chỉ đạo với lộ trình CN được ưu tiên nhất và CDN tương ứng của Trung Quốc đang bị quá tải vì số lượng người dùng ngày càng tăng.

Vì vậy, máy chủ chỉ đạo đã hoạt động và gửi một Bản kê khai chỉ đạo khác cho 30 phần trăm người dùng ở Trung Quốc, với con đường ưa thích nhất được đổi thành JP.

Sau khi thực hiện đánh giá Chỉ đạo Nội dung, 30 phần trăm khách hàng ở Trung Quốc sẽ chuyển sang lộ trình JP, chuyển hướng lưu lượng mạng của họ đến CDN ở Nhật Bản, giải quyết tình trạng tắc nghẽn mạng ở CDN Trung Quốc.

Để kết thúc, chúng tôi đã giới thiệu tính năng HLS mới của Chỉ đạo nội dung, giải thích cách thức hoạt động và cách tích hợp nó vào các luồng của bạn.

Với tính năng tuyệt vời này, bạn sẽ có thể tinh chỉnh tính khả dụng phát trực tuyến toàn cầu của mình.

Để biết thêm chi tiết kỹ thuật, hãy theo liên kết bên dưới video này cho "Thông số kỹ thuật chỉ đạo nội dung HLR".

Tôi cũng muốn nói với bạn rằng danh sách phát và xác thực Bản kê khai chỉ đạo cũng được hỗ trợ trong Công cụ phát trực tiếp HTTP mới nhất của chúng tôi.

Tôi cũng muốn ghi nhận phản hồi và sự giúp đỡ mà chúng tôi nhận được từ các thành viên trong ngành trong diễn đàn HLS Interest IETF.

Các phản hồi và đề xuất trong tương lai cũng được hoan nghênh.

Và với tất cả những điều này, Chỉ đạo nội dung HLS sẽ có sẵn cho các nhà phát triển và người dùng trong các bản dựng WWDC Seed năm nay.

Vì vậy, nếu bạn muốn phân phối phát trực tuyến toàn cầu tốt hơn với nhiều tính khả dụng hơn, hãy hành động ngay bây giờ để tích hợp Chỉ đạo nội dung HLS vào các luồng của bạn và mang đến cho khách hàng của bạn trải nghiệm phát trực tuyến tốt hơn.

Cảm ơn bạn rất nhiều.

♪