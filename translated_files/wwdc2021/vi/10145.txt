10145

♪ Nhạc bass đang phát ♪

♪

Pranav Sodhani: Xin chào và chào mừng đến với WWDC!

Tên tôi là Pranav, và tôi là thành viên của nhóm Công nghệ Hiển thị và Màu sắc tại Apple.

Trong buổi nói chuyện này, chúng tôi sẽ giới thiệu một công cụ chất lượng video và chỉ ra cách bạn có thể sử dụng nó để đánh giá chất lượng nhận thức của video nén trong ứng dụng hoặc quy trình tạo nội dung của bạn Được rồi.

Hãy bắt đầu bằng cách xem xét quy trình phân phối video điển hình.

Trong quy trình làm việc như vậy, video nguồn chất lượng cao trải qua quá trình nén video và tùy chọn giảm quy mô video để tạo video với tốc độ bit thấp hơn.

Và những video tốc độ bit thấp này sau đó có thể dễ dàng phân phối qua các mạng bị hạn chế băng thông.

Một vài cách khả thi để sử dụng quy trình làm việc như vậy bao gồm các API AVFoundation như AVAssetWriter, các ứng dụng như Compressor hoặc nó có thể là một trong những quy trình nén video của riêng bạn.

Giờ đây, việc thu nhỏ quy mô và nén có thể thêm các tạo tác mã hóa video và chia tỷ lệ.

Và điều này sẽ làm suy yếu video nguồn và tạo ra các hiện vật có thể nhìn thấy được.

Một ví dụ về hiện vật như vậy là sự tắc nghẽn trong video nén, được hiển thị trong khung hình ở phía bên phải.

Một ví dụ khác là khi video xuất hiện mờ và chi tiết video bắt đầu biến mất.

Những hiện vật như vậy có thể ảnh hưởng xấu đến trải nghiệm chất lượng video của người tiêu dùng.

Chúng tôi biết rằng người tiêu dùng đang mong đợi trải nghiệm video chất lượng cao.

Vì vậy, điều quan trọng là phải đáp ứng kỳ vọng này.

Bây giờ, bước đầu tiên để làm điều này là đánh giá chất lượng nội dung được phân phối của bạn.

Và cách chính xác nhất để làm điều này là để người thật xem video và đánh giá chúng trên thang chất lượng video.

Nhưng điều này rất tốn thời gian và không thể mở rộng nếu bạn muốn đánh giá khối lượng video lớn.

May mắn thay, có một cách khác.

Những gì chúng ta cần ở đây là một cách khách quan để mô tả chất lượng video, để chúng ta có thể tự động hóa quy trình về tốc độ và khả năng mở rộng.

Trong một thiết lập như vậy, công cụ chất lượng video nhận thức sẽ lấy video nén và video nguồn làm đầu vào và xuất điểm chất lượng video.

Điểm số này có thể là một số dấu phẩy động trong khoảng từ một đến năm và bắt chước cách mọi người thực sẽ đánh giá video nén.

Hôm nay, chúng tôi rất vui mừng được cho phép các nhà phát triển của mình sử dụng một công cụ chất lượng video nhận thức như vậy.

Tóm lại, chúng tôi gọi nó là Công cụ Chất lượng Video Nâng cao hoặc AVQT.

Hãy cùng tìm hiểu thêm về AVQT.

Vậy chính xác thì AVQT là gì?

Chà, AVQT có thể thực thi dòng lệnh macOS.

Và nó cố gắng bắt chước cách mọi người thực đánh giá chất lượng của video nén.

Bạn có thể sử dụng AVQT để tính toán cả điểm cấp khung hình và điểm cấp phân đoạn, trong đó một phân đoạn thường dài vài giây.

Và, tất nhiên, chúng tôi đã thêm hỗ trợ cho tất cả các định dạng video dựa trên AVFoundation trong AVQT.

Điều này bao gồm SDR, cũng như các định dạng video HDR như HDR10, HLG và Dolby Vision.

Tiếp theo, chúng tôi muốn thảo luận về ba thuộc tính chính của AVQT khiến nó trở nên rất hữu ích trên các ứng dụng.

Đầu tiên, chúng ta sẽ thấy AVQT phù hợp với nhận thức của con người tốt như thế nào.

Sau đó chúng ta sẽ nói về tốc độ tính toán của AVQT.

Và cuối cùng, chúng tôi sẽ chỉ ra lý do tại sao nhận thức về thiết lập xem lại quan trọng khi dự đoán chất lượng video.

Hãy đi vào chi tiết cho từng thứ này.

AVQT tương quan tốt với ý kiến của con người về chất lượng video.

Và nó hoạt động tốt trên các loại nội dung, chẳng hạn như hoạt hình, cảnh tự nhiên hoặc thể thao.

Chúng tôi đã phát hiện ra rằng các chỉ số chất lượng video truyền thống như PSNR và sự tương đồng về cấu trúc - hay nói ngắn gọn là SSIM - thường không hoạt động tốt trên các loại nội dung.

Hãy xem xét một ví dụ.

Bây giờ, đây là một khung hình từ một clip thể thao chất lượng cao, đây là video nguồn đầu tiên của chúng tôi.

Hãy nhìn vào cùng một khung hình trong video nén.

Bạn có thể thấy rằng khung có vẻ có chất lượng nhận thức đủ cao.

Đúng vậy, nó đạt điểm PSNR khoảng 35 và điểm AVQT là 4.4.

Tiếp theo, chúng ta đi với cùng một bài tập cho video nguồn thứ hai của chúng ta.

Video nén trong trường hợp này dường như có các hiện vật có thể nhìn thấy được.

Đặc biệt, bạn có thể nhìn thấy một số hiện vật trên khuôn mặt của người đó.

Thật thú vị, nó có cùng điểm PSNR khoảng 35, nhưng lần này AVQT đánh giá nó khoảng 2,5, ngụ ý chất lượng kém.

Chúng tôi nghĩ rằng điểm AVQT là dự đoán chính xác ở đây.

Lưu ý rằng đây chỉ là một ví dụ mà chúng tôi đã chọn để minh họa những gì có thể xảy ra trong các đánh giá nội dung chéo.

Chúng tôi muốn kiểm tra độ chính xác nhận thức của AVQT trên một bộ video đa dạng.

Vì vậy, chúng tôi đã đánh giá nó trên các bộ dữ liệu chất lượng video có sẵn công khai.

Các bộ dữ liệu này bao gồm video nguồn, video nén và điểm chất lượng video do các đối tượng con người cung cấp.

Ở đây, chúng tôi sẽ hiển thị cho bạn kết quả trên hai bộ dữ liệu: Waterloo IVC 4K và VQEG HD3.

Tập dữ liệu Waterloo IVC bao gồm 20 video nguồn và 480 video nén, bao gồm cả mã hóa và mở rộng quy mô tạo tác.

Nó bao gồm bốn độ phân giải video khác nhau và hai tiêu chuẩn video khác nhau.

Tập dữ liệu VQEG HD3 tương đối nhỏ hơn.

Nó có chín video nguồn và 72 video nén.

Và những thứ này được tạo ra bằng cách sử dụng mã hóa video ở độ phân giải video 1080p.

Và để đo lường hiệu suất của một chỉ số chất lượng video một cách khách quan, chúng tôi sử dụng các biện pháp tương quan và khoảng cách.

Hệ số tương quan Pearson, hay viết tắt là PCC, đo lường mức độ tương quan của điểm số dự đoán với điểm chủ quan.

Giá trị PCC cao hơn ngụ ý mối tương quan tốt hơn.

Và RMSE đo lường khoảng cách giữa các dự đoán so với điểm số chủ quan.

Giá trị RMSE thấp hơn sẽ ngụ ý độ chính xác dự đoán cao hơn.

Bây giờ, chúng tôi muốn đánh giá xem AVQT có thể dự đoán điểm số của các đối tượng con người tốt như thế nào.

Trên trục x ở đây, chúng tôi có điểm chất lượng video chủ quan sự thật cơ bản.

Và trên trục y, chúng tôi có điểm số được dự đoán bởi AVQT.

Mỗi điểm ở đây đại diện cho một video nén.

Như bạn có thể thấy từ biểu đồ phân tán, ngoại trừ một vài ngoại lệ, AVQT thực hiện rất tốt trong việc dự đoán điểm số chủ quan cho tập dữ liệu này.

Điều này cũng được phản ánh trong điểm PCC cao và RMSE thấp.

Và chúng tôi cũng thấy hiệu suất cao trên tập dữ liệu VQEG HD3.

Hãy tiếp tục và nói về tốc độ tính toán của AVQT.

Lưu ý rằng tốc độ tính toán cao là khá quan trọng để đảm bảo khả năng mở rộng.

Thuật toán của AVQT được thiết kế và tối ưu hóa để chạy nhanh trên Metal.

Điều này ngụ ý rằng bạn có thể chạy qua các tệp video lớn rất nhanh.

Nó cũng chăm sóc tất cả quá trình tiền xử lý một cách tự nhiên.

Đối với bạn, điều này có nghĩa là bạn không phải giải mã video của mình và mở rộng chúng ngoại tuyến.

AVQT làm điều đó cho bạn.

Bạn nên lưu ý rằng AVQT chạy qua video 1080p với tốc độ 175 khung hình mỗi giây.

Vì vậy, nếu bạn có video 1080p dài 10 phút ở tần số 24 Hz, AVQT có thể tính toán chất lượng của nó trong vòng chưa đầy 1,5 phút.

Thuộc tính cuối cùng mà chúng tôi muốn nói đến là nhận thức về thiết lập xem.

Thiết lập xem của bạn có thể ảnh hưởng đến chất lượng video mà bạn cảm nhận được khi xem video.

Đặc biệt, các yếu tố như kích thước màn hình, độ phân giải màn hình và khoảng cách xem có thể che giấu hoặc phóng đại các hiện vật trong video.

Để giải quyết vấn đề này, AVQT lấy các tham số này làm đầu vào cho công cụ và sau đó cố gắng dự đoán xu hướng phù hợp khi các yếu tố này thay đổi.

Hãy cùng xem xét một trường hợp như vậy.

Xem xét hai kịch bản.

Trong kịch bản A, bạn đang xem video 4K trên màn hình 4K ở khoảng cách xem gấp 1,5 lần chiều cao của màn hình.

Trong kịch bản B, bạn đang xem cùng một video trên cùng một màn hình nhưng bây giờ ở khoảng cách xem gấp ba lần chiều cao của màn hình.

Rõ ràng, trong kịch bản B, bạn sẽ bỏ lỡ một số hiện vật có thể nhìn thấy khi bạn đang theo dõi nó chặt chẽ.

Điều này ngụ ý rằng chất lượng video được cảm nhận của bạn trong kịch bản B sẽ cao hơn trong kịch bản A.

Và AVQT có thể nắm bắt những xu hướng như vậy ở các mức chất lượng khác nhau.

Biểu đồ ở đây cho thấy rằng khi khoảng cách xem tăng từ 1,5H lên 3H, điểm AVQT cũng tăng lên.

Chúng tôi khuyên bạn nên xem qua tài liệu README có sẵn với công cụ để biết thêm thông tin về điều này.

Chà, bây giờ tất cả các bạn đều hào hứng với AVQT, hãy để tôi chỉ cho bạn cách sử dụng công cụ đúng cách.

Chúng tôi sẽ sớm cung cấp AVQT cho tất cả các bạn thông qua cổng tải xuống dành cho nhà phát triển.

Hãy để tôi hướng dẫn bạn qua một bản demo.

Vì vậy, tôi đã tải xuống công cụ và cài đặt AVQT trên hệ thống này.

Nếu bạn nhìn vào đầu ra của "AVQT nào", bạn có thể thấy AVQT được đặt trong thư mục usr/local/bin.

Bây giờ, bạn có thể gọi lệnh trợ giúp AVQT để đọc thêm về việc sử dụng các cờ khác nhau được AVQT hỗ trợ.

Hãy xem những gì tôi có trong thư mục hiện tại của mình.

Tôi có một tài liệu tham khảo mẫu và một video nén mẫu mà tôi sẽ sử dụng cho bản demo.

Vậy hãy để tôi chạy AVQT thông qua chúng.

Chúng tôi sẽ cung cấp các tệp tham chiếu và kiểm tra làm đầu vào và chỉ định tệp đầu ra.

Hãy đặt tên cho tệp đầu ra là sample_output.csv.

Công cụ in tiến độ và báo cáo điểm phân đoạn trên màn hình.

Thời lượng phân đoạn mặc định là sáu giây và vì clip này dài năm giây, chúng tôi chỉ có một phân đoạn.

Tiếp theo, hãy xem xét tệp đầu ra.

Bạn có thể xem điểm số cấp khung hình ở đây.

Và, cuối cùng, chúng ta có điểm số cấp phân đoạn ở phía dưới.

Bây giờ, trong bản demo, chúng tôi đã trình bày một vài tùy chọn, nhưng công cụ này cũng có một số tính năng khác được tích hợp trong đó.

Ví dụ, bạn có thể sử dụng thời lượng phân đoạn và cờ tổng hợp thời gian để thay đổi cách tổng hợp điểm cấp khung hình.

Tương tự, bạn có thể chỉ định thiết lập xem bằng cách sử dụng cờ khoảng cách xem và độ phân giải hiển thị.

Vui lòng tham khảo README để biết thêm chi tiết về điều này.

Được rồi.

Cho đến nay chúng tôi đã tìm hiểu về một số thuộc tính chính của AVQT.

Chúng tôi cũng đã xem cách sử dụng công cụ dòng lệnh trên một cặp video để tạo điểm chất lượng video.

Bây giờ chúng ta hãy xem xét một trường hợp cụ thể mà bạn có thể sử dụng AVQT để tối ưu hóa tốc độ bit cho HLS.

Các bậc HLS được mã hóa ở các tốc độ bit khác nhau.

Và chúng tôi biết rằng việc chọn các tốc độ bit này không phải lúc nào cũng là một quá trình dễ dàng.

Để giải quyết vấn đề này, chúng tôi đã xuất bản một số hướng dẫn về tốc độ bit trong tài liệu Đặc tả Tác giả HLS.

Xin lưu ý rằng các tốc độ bit này chỉ là mục tiêu mã hóa ban đầu cho nội dung điển hình được phân phối qua HLS.

Chúng tôi cũng biết rằng các nội dung khác nhau có độ phức tạp mã hóa khác nhau, điều này ngụ ý rằng tốc độ bit tối ưu thay đổi giữa các nội dung khác nhau.

Vì vậy, tốc độ bit hoạt động tốt cho một loại nội dung - ví dụ: một bộ phim hoạt hình - có thể không hoạt động tốt cho một sự kiện thể thao.

Đây là cách bạn có thể sử dụng AVQT làm phản hồi để giúp bạn xác định tốc độ bit tối ưu cho nội dung của mình.

Đầu tiên, chúng tôi bắt đầu với tốc độ bit mục tiêu ban đầu của mình.

Chúng tôi sử dụng tốc độ bit này để mã hóa video nguồn của mình và tạo bậc HLS.

Sau đó, chúng tôi sử dụng video nguồn và cấp HLS được mã hóa để tính điểm chất lượng video bằng AVQT.

Cuối cùng, chúng ta có thể phân tích điểm AVQT để quyết định xem chúng ta muốn tăng hay giảm tốc độ bit mục tiêu cho cấp HLS.

Để chứng minh điều này bằng một ví dụ, hãy chọn một cấp HLS cụ thể.

Ở đây chúng tôi đang chọn tầng 2160p với tốc độ 11,6 megabit mỗi giây.

Sau đó, chúng tôi sẽ mã hóa hai chuỗi trước đó của mình - hoạt hình và thể thao - với tốc độ bit được đề xuất này.

Khi chúng tôi đã chuẩn bị sẵn các tầng được mã hóa, chúng tôi sẽ sử dụng AVQT để tính điểm chất lượng video của họ.

Biểu đồ ở đây cho thấy điểm AVQT cho hai chuỗi video.

Đối với cấp độ cụ thể này, chúng tôi có thể mong đợi chất lượng video cao, vì vậy chúng tôi đang đặt ngưỡng là 4,5, cho thấy chất lượng gần như tuyệt vời.

Bạn có thể thấy rằng mặc dù tốc độ bit này đủ tốt cho clip hoạt hình này, nhưng nó không đủ cho clip thể thao.

Vì vậy, chúng tôi quay lại và sử dụng phản hồi này để điều chỉnh mục tiêu tốc độ bit của mình.

Đặc biệt, chúng ta cần tăng mục tiêu tốc độ bit cho clip thể thao và tính toán lại điểm AVQT của nó.

Hãy nhắm đến việc tăng 10% tốc độ bit.

Ở đây chúng tôi đã vạch ra điểm AVQT mới của mình cho clip thể thao.

Điểm số cập nhật hiện nằm trên ngưỡng dự kiến của chúng tôi là bốn rưỡi.

Và nó cũng giống với chất lượng video của nội dung hoạt hình chặt chẽ hơn nhiều.

Để kết thúc, đây là một vài điều quan trọng mà chúng tôi muốn bạn rút ra từ cuộc nói chuyện này.

Nén video có thể dẫn đến các hiện vật có thể nhìn thấy, điều này ảnh hưởng đến trải nghiệm chất lượng video của người tiêu dùng.

Bạn có thể đánh giá chất lượng video nén của mình bằng AVQT.

AVQT đi kèm như một công cụ dòng lệnh macOS, tính toán nhanh chóng và đang xem thiết lập nhận thức.

Nó cũng có hỗ trợ cho tất cả các định dạng video dựa trên AVFoundation.

Cuối cùng, bạn có thể sử dụng AVQT để tối ưu hóa chất lượng video của các cấp HLS của mình.

Cảm ơn bạn rất nhiều!

♪