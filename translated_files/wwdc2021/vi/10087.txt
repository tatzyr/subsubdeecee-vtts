10087

Xin chào, tôi là Sonia, một kỹ sư công cụ hiệu suất.

Hôm nay, đồng nghiệp Shreyas của tôi và tôi sẽ chỉ cho bạn cách chẩn đoán hồi quy năng lượng và hiệu suất trong ứng dụng của bạn.

Hàng năm, bạn làm việc chăm chỉ để phát hành các ứng dụng tốt nhất có thể.

Bạn muốn mời người dùng trải nghiệm tuyệt vời trong các ứng dụng của mình, đó là lý do tại sao việc tối ưu hóa sức mạnh và hiệu suất rất quan trọng.

Bài nói chuyện này sẽ bao gồm các chỉ số chính ảnh hưởng đến hiệu suất ứng dụng của bạn, các công cụ giúp bạn khám phá hồi quy, thông tin chi tiết để giúp bạn giảm ghi đĩa và API để tự động hóa quy trình làm việc hiệu suất của bạn.

Để giúp bạn tối ưu hóa hiệu suất, có một bộ số liệu và chẩn đoán toàn diện có sẵn cho bạn thông qua Xcode Organizer và App Store Connect API, mà không có bất kỳ thay đổi nào đối với ứng dụng của bạn.

Như bạn đã biết, hiệu suất không dễ để tối ưu hóa.

Với rất nhiều số liệu và chẩn đoán có sẵn, có thể dễ dàng bị lạc trong biển thông tin.

Bạn muốn làm cho mỗi bản phát hành tốt hơn bản trước, nhưng cần một cách nhanh chóng để tóm tắt các ưu tiên hiệu suất của bạn.

Xcode Organizer là một công cụ tuyệt vời để hiểu hiệu suất.

Nó hiện đang thu thập dữ liệu trên bảy danh mục số liệu, bao gồm pin, khởi chạy, treo, bộ nhớ, ghi đĩa, quá giang cuộn và chấm dứt.

Đó là rất nhiều thông tin để xử lý.

Hãy đi sâu vào Xcode Organizer tiếp theo và chẩn đoán hồi quy hiệu suất.

Tôi sẽ bắt đầu bằng cách xem các số liệu khác nhau cho ứng dụng của mình.

Tôi có thể chọn từ bảy danh mục số liệu trên thanh điều hướng bên trái.

Một số danh mục, như pin và đầu cuối, có thể có nhiều phần, cũng như các danh mục con chi tiết các loại sự kiện khác nhau.

Tôi có thể tùy ý chọn giữa hàng tá loại thiết bị khác nhau, cũng như phần trăm cho người dùng hàng đầu và điển hình của ứng dụng của tôi.

Trung tâm của người tổ chức hiển thị một biểu đồ với dữ liệu cho 16 bản phát hành gần đây nhất.

Trong trường hợp này, tôi muốn điều tra việc chấm dứt trong ứng dụng của mình.

Biểu đồ trên màn hình cho thấy việc chấm dứt đã tăng đáng kể trong phiên bản mới nhất, cho thấy có thể có vấn đề với bản phát hành, đặc biệt là do nhiều lối thoát hướng dẫn bất hợp pháp được đánh dấu màu xanh lam.

Có một bộ số liệu phong phú và thú vị có sẵn để tôi hiểu hiệu suất trong lĩnh vực này, nhưng với rất nhiều tùy chọn thiết bị, danh mục số liệu và danh mục con, không rõ tôi nên bắt đầu từ đâu để tối ưu hóa hiệu suất.

Đó là lý do tại sao bây giờ có một phần thông tin chi tiết trong trình tổ chức để làm nổi bật tất cả các ưu tiên hiệu suất của bạn và hợp lý hóa quy trình làm việc của bạn.

Xcode Organizer hiện xử lý dữ liệu số liệu và xác định các xu hướng thú vị như hồi quy hiệu suất.

Trước khi tôi đi sâu vào, hãy nói về hồi quy hiệu suất là gì và cách chúng được phát hiện.

Hồi quy xảy ra khi một ứng dụng hoạt động kém trong lĩnh vực năng lượng hoặc hiệu suất so với các bản phát hành gần đây.

Ví dụ, khi mất nhiều thời gian hơn để khởi chạy sau khi phát hành.

Trong ví dụ này, số liệu được phân tích qua các bản phát hành gần đây để xác định xem giá trị có đang có xu hướng tăng hay không.

Số liệu sau đó được tính trung bình trong một vài bản phát hành gần đây nhất và được so sánh với giá trị mới nhất.

Nếu số liệu đang có xu hướng tăng và giá trị mới nhất cao hơn mức trung bình trong một vài bản phát hành gần đây nhất, nó sẽ được gắn cờ là hồi quy và được tóm tắt trong phần thông tin chi tiết.

Trong ví dụ này, ứng dụng mất trung bình 1,1 giây để khởi chạy, sau đó đột nhiên tăng lên 2,5 giây trong bản phát hành cuối cùng, khiến nó bị gắn cờ là hồi quy.

Bây giờ bạn đã biết hồi quy được gắn cờ như thế nào, chúng ta hãy quay lại với người tổ chức và đi sâu vào một vài ví dụ.

Đây là một cái nhìn về tab hồi quy.

Đó là một cửa hàng một cửa, nơi bạn có thể khám phá những ưu tiên hiệu suất hàng đầu của mình.

Ứng dụng của bạn đột nhiên gặp sự cố sau bản phát hành gần đây?

Tính năng máy ảnh mới thú vị đó có làm cạn kiệt pin của thiết bị không?

Bạn sẽ tìm thấy câu trả lời cho những câu hỏi này và hơn thế nữa trong phần thông tin chi tiết.

Tất cả dữ liệu bạn cần sẽ được đánh dấu trong phần hướng đến này để hiểu hiệu suất trong lĩnh vực này.

Tại đây bạn có thể khám phá hồi quy cho các danh mục số liệu và danh mục con khác nhau trên các thiết bị cho các phân vị điển hình và hàng đầu được nhóm lại với nhau.

Phía bên tay trái sẽ tóm tắt số liệu nào đã hồi quy, bao nhiêu và cho phần trăm nào, làm nổi bật chính xác những gì bạn cần tập trung vào để tạo ra các ứng dụng tốt hơn nữa.

Ứng dụng của tôi có một số hồi quy trên các lần chấm dứt, bộ nhớ và ghi đĩa.

Tiếp theo, tôi sẽ xem qua một ví dụ về từng ví dụ và cách diễn giải chúng.

Tôi sẽ bắt đầu với hồi quy chấm dứt.

Trước khi tôi chấm dứt hợp đồng, hãy xem video về "Tại sao ứng dụng của tôi bị hỏng?"

Để biết thêm ngữ cảnh.

Mỗi hồi quy sẽ tóm tắt tất cả các vấn đề hàng đầu từ bản phát hành ứng dụng mới nhất của tôi.

Đầu phần cho thấy các hướng dẫn bất hợp pháp đang gây ra sự cố, có thể xảy ra khi ứng dụng của tôi truy cập vào một con trỏ chức năng không hợp lệ.

Xa hơn nữa, có một biểu đồ các lối thoát hướng dẫn bất hợp pháp trong bốn bản phát hành cuối cùng của ứng dụng của tôi.

Đầu biểu đồ cho thấy phần trăm và thiết bị nào bị ảnh hưởng.

Trong trường hợp này, những người dùng phân vị hàng đầu trên tất cả iPhone đang gặp nhiều sự cố hơn trong bản phát hành mới nhất.

Số lần thoát hướng dẫn bất hợp pháp trung bình và mới nhất nằm ở bên phải biểu đồ.

Trong trường hợp này, ứng dụng của tôi đã bắt đầu gặp sự cố mười ngày một lần trong phiên bản mới nhất.

Việc chấm dứt trên màn hình rất gây gián đoạn vì người dùng sẽ phải quay lại Màn hình chính và khởi chạy lại ứng dụng thường xuyên.

Tôi sẽ muốn xóa các tham chiếu đến con trỏ chức năng không hợp lệ gây ra những sự cố này và có thể tìm hiểu thêm bằng cách xem xét chẩn đoán sự cố của tôi.

Xem video "Phân loại TestFlight gặp sự cố với Xcode" để tìm hiểu thêm về chẩn đoán sự cố.

Sử dụng hồi quy và chẩn đoán sự cố, bây giờ tôi biết tôi cần giảm việc chấm dứt trên màn hình trong bản phát hành ứng dụng tiếp theo.

Tôi không muốn dừng lại ở việc chấm dứt trên màn hình và biết rằng tôi có thể làm được nhiều hơn thế.

Tôi sẽ kiểm tra hồi quy ứng dụng của mình để khám phá các lĩnh vực khác cần cải thiện.

Có vẻ như cũng có hồi quy trong thời gian chờ nhiệm vụ.

Một số chỉ số có thể thoái lui cho nhiều thiết bị và phần trăm.

Trong trường hợp này, thời gian chờ tác vụ đã tăng lên trên tất cả các iPhone trên cả phân vị điển hình và phân vị hàng đầu.

Tôi có thể cuộn qua từng hồi quy ở bên phải, xem dữ liệu cho các bản phát hành gần đây cũng như giá trị mới nhất và trung bình cho số liệu.

Khi các ứng dụng được chuyển sang nền, chúng có 30 giây để thực hiện các tác vụ trước khi hệ thống chấm dứt chúng.

Điều này có nghĩa là việc không kết thúc các tác vụ nền một cách thích hợp có thể khiến ứng dụng của bạn chấm dứt thường xuyên hơn, dẫn đến việc khởi chạy chậm vào lần sau khi người dùng quay lại.

Ứng dụng của tôi hiện đang bị chấm dứt ba ngày một lần trong nền.

Mặc dù không gây rối như chấm dứt trên màn hình, nhưng việc chấm dứt nền có thể phổ biến hơn nhiều.

Điều cần thiết là phải có trải nghiệm khởi chạy liền mạch, ngay cả khi ứng dụng của tôi bị chấm dứt ở chế độ nền.

Tôi có thể tích hợp các tính năng khôi phục trạng thái của UIKit để đảm bảo khôi phục trơn tru từ bất kỳ lối thoát nền nào.

Cuối cùng, quay trở lại hồi quy ứng dụng của tôi, có một lĩnh vực hiệu suất nữa mà tôi cần tập trung vào.

Ghi đĩa đã tăng 28% trong bản phát hành cuối cùng, nhưng không rõ nguyên nhân gây ra sự cố.

Thật tuyệt khi tôi biết có vấn đề về hiệu suất, nhưng tôi sẽ cần thêm thông tin chi tiết về nơi bắt đầu trước khi tối ưu hóa ứng dụng của mình.

Tiếp theo, Shreyas sẽ cho bạn biết cách khám phá các nguyên nhân hàng đầu gây ra hồi quy ghi đĩa.

Cảm ơn, Sonia.

Xin chào, tôi là Shreyas.

Tôi là một kỹ sư phần mềm lưu trữ tại Apple, và tôi sẽ đề cập đến cách gỡ lỗi hồi quy ghi đĩa và luôn cập nhật hiệu suất của ứng dụng.

Nhưng trước khi đi sâu vào vấn đề này, tại sao ghi đĩa lại quan trọng như vậy?

Lưu trữ, rất giống CPU và bộ nhớ, là một nguồn tài nguyên hạn chế.

Ghi đĩa không được kiểm tra có thể bị hao mòn và làm hỏng thiết bị bên dưới.

Chúng cũng là một nguyên nhân phổ biến gây phiền nhiễu trên màn hình treo và giao diện người dùng quá giang.

Nếu chúng ta không cẩn thận, chúng có thể làm tăng thời lượng pin nhanh chóng.

Những điều này làm cho việc tối ưu hóa đĩa ghi lại một thành phần quan trọng trong việc đảm bảo trải nghiệm người dùng tuyệt vời.

Với ý nghĩ đó, hãy tìm hiểu về các tài nguyên có sẵn để chẩn đoán ghi đĩa cao.

Ngăn báo cáo ghi đĩa trong Xcode Organizer là một điểm khởi đầu tuyệt vời.

Các báo cáo này được thu thập từ các thiết bị đã đồng ý chia sẻ phân tích ứng dụng và chúng chứa thông tin về dấu vết ngăn xếp dẫn đến việc ghi.

Dấu vết ngăn xếp từ mỗi báo cáo được chia thành nhiều chữ ký và các bản ghi được theo dõi để có chữ ký trên tất cả các báo cáo.

Trong danh sách báo cáo này, các chữ ký được hiển thị được sắp xếp dựa trên tổng số lần ghi.

Đối với mỗi chữ ký, chúng tôi có thể tìm thấy dấu vết ngăn xếp chi tiết cho chúng tôi thấy nguyên nhân của việc ghi và chúng tôi cũng có thể tìm thấy số liệu thống kê về số lượng nhật ký đã được nhận, phiên bản hệ điều hành và sự cố mô hình phần cứng trông như thế nào, v.v.

Để xác định các khu vực có vấn đề, hãy chú ý đến chữ ký hàng đầu của bạn.

Trong trường hợp này, chữ ký hàng đầu chịu trách nhiệm cho 67% số lần viết.

Chúng ta có thể suy ra từ các calltacks rằng điều này là do một hàm SQLite.

Rất nhiều lần, biết điều này, nguồn gốc của vấn đề, có thể đi một chặng đường dài hướng tới việc giải quyết vấn đề.

Nhưng thông thường, như trong trường hợp này, việc sửa chữa có thể không rõ ràng.

Mã ở đây rất quan trọng đối với tính năng mới của tôi, tôi không phát hiện ra bất kỳ lỗi rõ ràng nào và không rõ các bước tiếp theo của tôi nên là gì.

Hóa ra, câu trả lời có mặt trong dấu vết ngăn xếp nếu bạn biết tìm ở đâu.

Đôi khi có các chức năng nằm sâu trong ngăn xếp trong các thư viện mà bạn đang sử dụng có thể cho bạn biết điều gì sai và, với đủ nghiên cứu, cách khắc phục nó.

Nhưng điều đó có thể rất phức tạp.

Nó thường đòi hỏi kiến thức về miền cụ thể và có thể cực kỳ tốn thời gian.

Để tiết kiệm cho bạn tất cả nỗ lực này, trong Xcode 13, người tổ chức có một lĩnh vực mới gọi là thông tin chi tiết.

Đằng sau hậu trường, một kho lưu trữ được duy trì với các phản mẫu đã biết gây ra ghi đĩa cao.

Khi nhận được báo cáo, chúng được quét để tìm các chức năng chỉ ra các phản mẫu này.

Khi có kết quả khớp, vấn đề được đánh dấu ở đây cùng với đề xuất tối ưu hóa để khắc phục sự cố.

Điều này sẽ giúp dễ dàng giảm ghi của ứng dụng và cải thiện hiệu suất trong khi tiết kiệm rất nhiều nỗ lực gỡ lỗi.

Ví dụ, đối với chữ ký hàng đầu của chúng tôi, tôi thấy một đề xuất tối ưu hóa để thêm một chỉ mục.

Ngoài ra còn có một liên kết đến trang tài liệu sẽ giải thích vấn đề một cách chi tiết và đưa ra các bước để gỡ lỗi và khắc phục sự cố.

Tuyệt vời.

Bây giờ, hãy làm theo lời khuyên và xem nó có giúp ích gì không.

Và để làm điều đó, hãy để tôi kích hoạt các công cụ hoạt động tập tin.

Công cụ hoạt động tệp là một tài nguyên tuyệt vời để gỡ lỗi tất cả các vấn đề liên quan đến lưu trữ.

Nó cung cấp cho tôi bảng phân tích chi tiết về tất cả các lần đọc và ghi mà ứng dụng thực hiện.

Đó là công cụ hoàn hảo để xác nhận bản sửa lỗi của tôi.

Trước đây, các công cụ hiển thị khoảng 180 megabyte ghi vào các tệp tạm thời.

Điều này cũng giới thiệu độ trễ 780 mili giây.

Và bây giờ, sau chỉ mục, các ghi do hàm giảm xuống 0.

Điều này là do SQLite bây giờ hiệu quả hơn.

Điều này có nghĩa là chúng ta không còn có độ trễ 780 mili giây làm chúng ta chậm lại. Chỉ mục SQLite là một ví dụ.

Có một loạt các đề xuất tối ưu hóa khác để cải thiện hiệu suất ứng dụng của bạn và có công việc liên tục để mở rộng danh sách này, vì vậy hãy xem thông tin chi tiết cho ứng dụng của bạn ngay hôm nay.

Hãy quay lại khung thông tin chi tiết.

Chúng tôi đã có ba hồi quy cho ứng dụng của mình.

Chúng tôi đã xem xét kỹ lưỡng từng người trong số họ và chúng tôi đã phát hiện ra các nguồn lực sẵn có để giải quyết tất cả chúng.

Điều đó thật tuyệt.

Có rất nhiều phân tích sức mạnh và hiệu suất trong Xcode Organizer và thông tin chi tiết nên là một khung cần thiết để khám phá các ưu tiên hiệu suất của ứng dụng của bạn.

Tận dụng tối đa nó.

Lên kế hoạch kiểm tra hồi quy và thông tin chi tiết định kỳ, và chắc chắn sau mỗi lần phát hành.

Ngoài Xcode Organizer, có một cách khác để bạn truy cập tất cả các phân tích được đề cập ngày hôm nay và đó là App Store Connect APIs.

Những thứ này rất tuyệt nếu bạn muốn truy cập dữ liệu theo chương trình và xây dựng các giải pháp tùy chỉnh.

Có lẽ bạn đã có một đường ống phân tích mà bạn đã thiết lập.

Sau đó, các API này là công cụ hoàn hảo để bạn tích hợp tất cả các phân tích thú vị này.

Xem video "Xác định xu hướng với Power and Performance API" từ WWDC 2020.

Nó bao gồm các điểm cuối API và phản hồi rất chi tiết.

Hãy để tôi đưa ra một cái nhìn tổng quan nhanh về một số phản hồi API.

Đối với các số liệu, bạn có thể thực hiện yêu cầu GET đến điểm cuối perfPowerMetrics.

Điều này trả về phản hồi JSON có số liệu và thông tin chi tiết của ứng dụng cho các phiên bản gần đây của bạn.

Hãy nhảy vào phần thông tin chi tiết.

Trong thông tin chi tiết, bạn sẽ tìm thấy tất cả các hồi quy được xác định cho ứng dụng của mình.

Đối với mỗi hồi quy, bạn sẽ tìm thấy danh mục số liệu và bản tóm tắt về hồi quy đã xác định.

Đây là việc chấm dứt trên màn hình do một hướng dẫn bất hợp pháp mà chúng tôi đã phát hiện trước đó trong Xcode Organizer.

Tiếp theo, bạn sẽ tìm thấy phần dân số.

Điều này cung cấp một danh sách chi tiết, có cấu trúc về các phân vị và thiết bị bị ảnh hưởng.

Bạn có thể sử dụng những thứ này để thực hiện hành động tập trung nhằm cải thiện hiệu suất ứng dụng của mình.

Tương tự, đối với các báo cáo chẩn đoán, bạn có thể thực hiện yêu cầu GET đến điểm cuối Chữ ký chẩn đoán.

Các câu trả lời sẽ có một danh sách các chữ ký hàng đầu và mỗi chữ ký sẽ có một liên kết đến các chi tiết liên quan đến nó.

Yêu cầu GET đến liên kết này sẽ cung cấp cho bạn nhật ký chẩn đoán chi tiết và thông tin chi tiết liên quan đến chữ ký.

Sử dụng các API này trong các quy trình phân tích của bạn và khi bạn thấy thông tin chi tiết, hãy hành động ngay lập tức.

Bây giờ bạn đã biết hồi quy hiệu suất là gì và cách bạn có thể chẩn đoán chúng và nơi bạn có thể tìm thấy dữ liệu có thể hành động để khắc phục chúng.

Đây là những gì bạn cần làm tiếp theo.

Mở Xcode Organizer ngay bây giờ. Kiểm tra khung hồi quy.

Xem hồi quy hiệu suất hàng đầu của ứng dụng của bạn là gì.

Tìm hiểu xem ứng dụng của bạn ghi được bao nhiêu.

Các cuộc gọi ghi đĩa trên cùng có phải là những gì bạn mong đợi không?

Hay có những lỗi ẩn nào đang làm chậm ứng dụng của bạn?

Cuối cùng, hãy lên kế hoạch để luôn cập nhật hiệu suất ứng dụng của bạn.

Kiểm tra Xcode Organizer định kỳ và sử dụng App Store Connect APIs trong bất kỳ quy trình phân tích tùy chỉnh nào.

Cảm ơn bạn đã dành thời gian. Săn hồi quy vui vẻ.

[Nhạc lạc quan].