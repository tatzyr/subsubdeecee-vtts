10096

♪ベース音楽の演奏♪

♪

トミー・ポーリー：こんにちは、私はトミー・ポーリーです。同僚のデルジエルと一緒に、インターネットプライバシーのエキサイティングな新機能を紹介します。

iCloudプライベートリレーは、ネットワークやサーバーがインターネット上でユーザーのアクティビティを監視するのを防ぐ新しいサービスです。

そして、それはすべてのiCloud+サブスクリプションの一部として利用可能です。

プライベートリレーは、ユーザーがウェブを閲覧しているときにユーザーを保護するだけでなく、アプリによって生成されたトラフィックに保護を追加して、意図せずにユーザー情報を漏洩したり、ユーザーをセキュリティ攻撃にさらしたりしないようにします。

今日は、iCloudプライベートリレーとは何か、それがアプリにどのように影響するか、アプリがプライベートリレーでうまく機能することを確認する方法、ウェブサイトとサーバーを準備する方法、そして最後に、プライベートリレーが有効になっているときにネットワークを管理し、トラフィックを監視する方法を学びます。

始めましょう。

プライベートリレーはiOSとmacOSに組み込まれているので、アプリから採用するために何もする必要はありません。

また、アプリに必ずしも影響を与えるわけではないことを理解することも重要です。

これは、ユーザーがiCloud+の加入者であり、プライベートリレーが有効になっている場合にのみ適用されます。

あなたはおそらく疑問に思っているでしょう、それは実際に何をしますか?

プライベートリレーなしで現在どのように機能するかは次のとおりです。

誰かがインターネットにアクセスすると、ローカルネットワーク上の誰もが、DNSクエリの検査に基づいてアクセスするすべてのウェブサイトの名前を見ることができます。

この情報は、ユーザーの指紋を採取し、時間の経過とともに活動の履歴を構築するために使用できます。

公共のWi-Fiオペレーター、ネットワーク上の別のユーザー、インターネットサービスプロバイダーなど、誰もこのすべての情報を静かに収集できるべきではありません。

接続がWebサイトを実行するサーバーに到達すると、それらのサーバーはユーザーのIPアドレスを見ることができます。

これにより、サーバーは明示的な許可なしにユーザーの位置を決定できます。

さらに悪いことに、Safariのインテリジェントトラッキング防止などのツールがクッキーを介して相関関係を妨げている場合でも、サーバーはユーザーの身元をフィンガープリントし、異なるウェブサイトでユーザーを認識することができます。

これらはユーザーのプライバシーにとって大きな問題であり、それらを修正するためには、設計によってプライバシーが組み込まれた新しいアプローチが必要です。

iCloudプライベートリレーは、ユーザーのトラフィックをルーティングし、それをプライベートに保つために、複数の安全なプロキシを追加します。

プロキシは別々のエンティティによって実行されます。

1つはアップル、もう1つはコンテンツプロバイダーです。

これで、誰かがインターネットにアクセスすると、クライアントのIPアドレスのみがネットワークプロバイダーと最初のプロキシの両方に表示されます。

2番目のプロキシは、ユーザーが要求している名前のみを表示し、それを使用してサーバーへの接続を構築します。

このチェーンの誰も、Appleでさえ、クライアントのIPアドレスとユーザーがアクセスしているものの両方を見ることができないことに注意することが重要です。

指紋採取の機会は取り除かれました。

これは設計上のプライバシーです。

プライベートリレーは、最新のトランスポートプロトコルとプライバシー保護認証を使用して、すべてのトランザクションが安全で高速であることを保証します。

この技術の詳細については、「Appleのプライバシーの柱に焦点を当てる」セッションで学ぶことができます。

プライベートリレーは、ユーザーエクスペリエンスに影響を与えることなく、システム上で最も機密性の高いトラフィックを保護することに重点を置いています。

iOS 15とmacOS 12では、プライベートリレーは、SafariのすべてのWebブラウジング、すべてのDNS名前解決クエリ、およびアプリからのトラフィックの小さなサブセットに適用されます。

具体的には、TCPポート80など、安全でないすべてのHTTPトラフィックが含まれます。

アプリがコンテンツフィルターまたはペアレンタルコントロールフィルターを提供している場合、プライベートリレーを通過する前にトラフィックが表示されるので、以前と同じようにフィルターを適用できます。

これについて詳しくは、「Meet the Screen Time API」セッションで学ぶことができます。

アプリによって行われるすべてのネットワーキングがパブリックインターネット上で行われるわけではないので、プライベートリレーの影響を受けないトラフィックのいくつかのカテゴリがあります。

アプリがローカルネットワークまたはプライベートドメイン名に接続しても影響を受けません。

同様に、アプリがVPNまたはアプリプロキシ機能を追加するためのネットワーク拡張機能を提供する場合、拡張機能はプライベートリレーを使用せず、拡張機能を使用するアプリトラフィックも使用しません。

プロキシを使用するトラフィックも免除されます。

次に、アプリがプライベートリレーでうまく機能する準備ができていることを確認するために何をする必要があるかを取り上げましょう。

素晴らしいニュースは、ほとんどすべてのアプリで、新しいことをする必要がないということです!

プライベートリレーはちょうど動作します。

しかし、知っておくべきベストプラクティスがいくつかあります。 

プライベートリレーは、使用しているネットワークAPIに関係なく機能します。

数年間、アプリがURLSessionやNWConnectionなどの最新のAPIを使用することを推奨してきました。

今、アプリ全体でそれらを採用する理由がもう1つあります。

これらのAPIは、プライベートリレーがトラフィックにどのように適用されているかを理解するための最良のツールを提供します。

URLSessionを使用する場合は、プライベートリレーを通過している場合でも、ネットワークXcodeインストゥルメントを使用してタスクを検査できます。

これを行う方法については、「InstrumentsでHTTPトラフィックを分析する」セッションで詳しく知ることができます。

また、URLSessionとNetwork.frameworkの両方でメトリクスAPIを使用して、接続がプライベートリレーを使用するタイミングを理解できます。

TaskTransactionMetricsでは、タスクがプロキシを使用したかどうかを確認できます。

NWConnectionのEstablishmentReportでは、DNS名前解決のタイミングとプロキシ接続確立の各段階を調べることもできます。

プライベートリレーは、暗号化されていない安全でないHTTP接続を過去のものにするために大きな一歩を踏み出します。

あなたもこの取り組みに参加できます!

まだ安全でないHTTPを使用している場合 - それはTCPポート80の接続です - 今が変更する時です。

プライベートリレーを有効にすると、これらの安全でない接続がプロキシされ、クライアントとプロキシ間のローカルネットワーク上の攻撃者から保護されます。

ただし、すべてのユーザーにとって接続をエンドからエンドまで安全に保つことが最善です。

これを行うには、サーバーがTLSをサポートしていることを確認し、URLをhttp://からhttps://に変更します。

あなたのアプリには、安全でないトラフィックを許可するためのアプリトランスポートセキュリティの例外があるかもしれません。

このリストを見て、アプリが使用する安全でないトラフィックを監査し、これらの例外を削除することができます。

アプリが位置情報に基づいて機能を提供する場合、IPアドレスから位置を推測するサーバーに頼るのではなく、Core LocationのAPIを使用していることを確認する絶好の機会でもあります。

IPアドレスのジオロケーションは、多くの場合、信頼性が低く、不正確です。

コアロケーションでは、必要な場所の精度を指定でき、明示的なユーザー許可に基づいています。

ロケーションアクセスの最新の機能強化については、「Appleのプライバシーの柱に焦点を当てる」セッションで詳しく知ることができます。

アプリがプライベートリレーの準備ができていることを確認したら、試してみてください!

iCloud+サブスクリプションでiPhone、iPad、またはMacにサインインし、設定アプリのiCloudセクションまたはシステム環境設定でプライベートリレーが有効になっていることを確認してください。

フィードバックアプリで「iCloud Private Relay」というタグでフィードバックを提供できます。

今、私はそれを同僚のDelzielに手渡します。

デルジエル・フェルナンデス:ありがとう、トミー。

こんにちは、私はデルジエル・フェルナンデスです。サーバーを準備し、プライベートリレーでネットワークを管理する方法について話します。

アプリが依存しているサーバーがある場合、またはSafariでユーザーがアクセスしている場合は、プライベートリレーの準備のためにできることがいくつかあります。

サーバーは、プロキシIPアドレスを認識することで、プライベートリレーを使用して入ってくる接続を識別できます。

これらのプロキシIPアドレスは、地域内の多くのユーザーによって共有される可能性があります。

各住所は、特定の都市または地域にマッピングされます。

したがって、正しいジオIPマッピングデータベースを適用しても、サーバーには引き続き関連情報があります。

プライベートリレーは、ユーザーがシステムを使用して別の地域のふりをできないことを保証するため、地域ベースのアクセス制限を引き続き実施できます。

プロキシIPアドレスの詳細は、このセッションに関連する記事として入手できます。

それでは、プライベートリレーを使用するデバイスからのネットワーク接続を見てみましょう。

デバイスがサーバーにアクセスしようとすると、まず入力プロキシへのネットワーク接続を設定します。

この接続は、ネットワークプロバイダーによって割り当てられたIPアドレスを使用して設定されます。

次に、デバイスは入力プロキシを使用して、入力プロキシIPアドレスを使用して出力プロキシにネットワーク要求を転送します。

その後、出力プロキシは、デバイスの都市または地域にマップするIPアドレスを選択することで、これらの要求を宛先サーバーに転送します。

一般的に、サーバーやウェブサイトは、ユーザーの位置や身元を決定するためにクライアントのIPアドレスのみに頼るのをやめるべきです。

位置情報アクセスが必要な場合は、ユーザーの位置情報を明示的に要求し、必要な粒度でのみ要求することを検討してください。

ユーザーを特定する必要がある場合は、IPアドレスがアイデンティティに関連付けられていると仮定するのではなく、ログインまたはその他の形式の明示的な識別を要求してください。

最後に、プライベートリレーが使用されているときにネットワークを管理するためのヒントをいくつか取り上げましょう。

プライベートリレーが使用されているときにローカルネットワークでパケットトレースを実行している場合は、いくつかの新しいトラフィックパターンが表示されます。

これで、UDPポート443で実行されているトラフィックが増えます。

これは、プライベートリレープロキシとの通信に使用されているQUICまたはHTTP / 3トラフィックです。

ネットワーク上のUDPポート443を許可し、ルーターまたはネットワークアドレストランスレータがそれをうまく処理するように調整されていることを確認することで、トラフィックがうまく機能することを確認できます。

また、ネットワーク上のクリアテキストUDP DNSクエリも少なくなります。

プライベートリレーが使用されていないときに、デバイスからの一般的なネットワーク接続要求を見てみましょう。

デバイスがサーバーにアクセスしようとすると、まずサーバーのホスト名のDNSクエリを送信します。

ホスト名がIPアドレスに解決されると、デバイスはTCPのようなトランスポートプロトコルを使用してサーバーのIPアドレスに接続します。

その後、デバイスはサーバーとTCP 3ウェイハンドシェイクを実行し、続いてTLS交換を実行してサーバーとの安全な接続を設定します。

しかし、ご覧のとおり、プライベートリレーがなければ、サーバーのホスト名とサーバーに接続しているデバイスのIPアドレスは、ネットワーク上のパケットを観察するだけで表示されます。

プライベートリレーでは、デバイスは最初にQUICまたはHTTP/3を使用して入力プロキシへの接続を設定します。

パケットキャプチャでは、入力プロキシのポート443に送信されたUDPパケットに気付くでしょう。

入力プロキシへのネットワーク接続が確立されると、入力プロキシへの接続内でサーバーへのアクセスが保護されます。

サーバー側では、プロトコルに変更はありません。

TCP/TLS交換は、プライベートリレーのないトラフィックに似ています。

唯一の違いは、サーバーがデバイスのIPアドレスではなく、プロキシIPアドレスからの着信接続を見ることです。

ほとんどのネットワークは、すべてのユーザートラフィックを監査または監視する必要はありません。

ただし、企業または学校のネットワークを運営している場合、ネットワークにはすべてのトラフィックを傍受する必要があるポリシーがある場合があります。

このユースケースをサポートするために、iCloudプライベートリレープロキシサーバーのホスト名をブロックすることができます。

その後、デバイスがネットワークに接続すると、ユーザーは現在のネットワークでプライベートリレーがブロックされていることを示すプロンプトを受け取ります。

その後、そのネットワークのプライベートリレーを無効にするか、ネットワークを切り替えるかを選択できます。

プロキシホスト名に関する情報は、このセッションに関連付けられた記事として提供されます。

ペアレンタルコントロールの場合、最善の解決策は、NetworkExtensionフレームワークが提供するコンテンツフィルターAPIを使用することです。

これにより、プライベートリレーが有効になっている場合でも、デバイスでトラフィックを監査できます。

コンテンツフィルターAPIの詳細については、「Meet the Screen Time API」と「Network extension for the modern Mac」のセッションをご覧ください。

物事をまとめるには、アプリでURLSessionのような最新の安全なネットワークAPIを使用し、プライベートリレーでアプリをテストし、プライベートリレーを介してルーティングされた接続を受信したときにサーバーとウェブサイトがうまく機能することを確認します。

見てくれてありがとう、みんな!

♪