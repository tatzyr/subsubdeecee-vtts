10141

♪ベース音楽の演奏♪

♪

Naiwei Zheng:こんにちは。WWDCへようこそ。

私の名前は鄭内偉です。

私はアップルのHLSストリーミングチーム出身です。

今日は、コンテンツステアリングと呼ばれるHLSの新機能と、それがどのようにグローバルストリーミングの可用性を向上させるかについて話します。

今日のネットワーク接続は世界規模です。

ストリーミングメディアプロバイダーは、世界中にコンテンツを配信しています。

しかし、世界規模でコンテンツを配信するには、業界が解決しなければならない膨大な量の課題が伴います。

私たち、アップルのHLSストリーミングチームも、これらの困難な問題を認識し、解決策を提供するために常に取り組んでいます。

今日は、可用性の問題に焦点を当てます。

具体的には、ネットワーク輻輳の軽減とエラー回復。

これらの問題を理解するために、例を見てみましょう。 例を見てみましょう。

アジアで人気のあるストリーミングプロバイダーが、中国、日本、シンガポールの3カ国にCDNインフラストラクチャを展開していると仮定しましょう。

このグラフでは、すべてが完璧な状態で機能している状態を示しています。

中国のCDNからストリーミングする中国のユーザーがおり、日本のCDNからストリーミングしている日本のユーザーがおり、両方のCDNネットワークは有能なレベルで機能しています。

さて、いくつかの変化を紹介しましょう。

しばらくして、中国のCDNからストリーミングする中国のユーザーが大幅に増加し、CDNネットワークが過負荷になっているとしましょう。

私たちが持っていたHLS技術では、このネットワークの混雑の問題に完全に対処することは困難です。

新規ユーザーを別のCDNに割り当てることができますが、既存のクライアントに別のCDNを使用するように指示することは難しく、既存のトラフィックは現在のCDNを継続的にオーバーロードします。

新しいHLSコンテンツステアリング機能により、コンテンツプロバイダーは独自のステアリングサーバーをホストすることでこの問題を解決できます。

最新のCDNポリシーで更新するために、すべての最新のHLSクライアントとのサイドチャネルを確立します。

たとえば、中国の既存のクライアントの30%にポリシーの更新を送信して、日本のCDNに切り替えることができます。

そして、ポリシーの更新を受け取るクライアントは、変更を尊重し、ネットワークトラフィックを日本のCDNにリダイレクトします。

現在、中国のCDNのネットワーク輻輳が緩和されました。

しかし、ネットワークの混雑は多くの可用性の問題の1つにすぎません。

ネットワークが停止するとどうなりますか?

別の例を挙げてみましょう。

日本のユーザーから日本のCDNへのネットワークパスが地域的な停止を経験したとします。

私たちが持っていたHLS技術では、コンテンツプロバイダーはマスタープレイリストにフォールバックバリアントストリームをリストできるため、クライアントは動作中のCDNに到達するまでリストを歩き回ることができます。

しかし、このアプローチは、コンテンツプロバイダーがマスタープレイリストにリストされているCDNの順序や優先順位をリアルタイムで変更できないという意味で予備的なものです。

ただし、ステアリングサーバーの助けを借りて、クライアントは最新のCDNの優先順位をほぼリアルタイムで更新します。

少し巻き戻して、より効率的なエラー回復でクライアントをどのように促進できるかを見てみましょう。

ネットワークが停止する前に、日本のクライアントはステアリングサーバーからCDN優先リストの更新を定期的に引き出します。

最新のアップデートで、日本のクライアントは、シンガポールと中国に続いて、日本のCDNが最も好まれる次のCDN優先リストを受け取ったとします。

現在、日本のユーザーは日本のCDNからストリーミングしています。

ネットワーク停止が発生すると、日本のCDNは優先リストからペナルティとしてマークされます。

クライアントは、優先リストの次のCDN（この場合はシンガポールのCDN）に移動し、ネットワークトラフィックをリダイレクトします。

これで、日本のユーザーは中断することなく番組を見続けることができます。

私たちの例があなたに示したことは、私たちの新しいHLS機能、コンテンツステアリングのハイレベルな概要です。

では、この素晴らしい機能をストリームに統合する方法を詳しく見てみましょう。

これは、利用可能なすべてのバリアントを複製するさまざまなCDN URLの簡単なリストです。

前に説明したように、このようなプレイリストには、CDNの優先順位が一定で最終的な順序があります。

コンテンツプロバイダーは、後で再生中に変更することはできません。

では、このプレイリストにコンテンツステアリングサポートを追加する方法を見てみましょう。

変化がほとんど導入されなかったことに驚くかもしれません。

実際、変更は現在のHLSクライアントと下位互換性があります。

追加を歩きましょう。

最も注目すべきは、各バリアントストリームのPATHWAY-ID属性によってバリアントストリームを異なる経路にグループ化するようになりました。各経路は通常1つのCDNに対応します。

この例では、バリアントストリームを経路CN、JP、SGにグループ化し、それぞれ中国、日本、シンガポールのCDNを表します。

ただし、パスウェイには、より高度なユースケースを可能にするために、異なるCDNからのバリアントストリームが含まれている場合があります。

クライアントが経路を選択すると、その経路からのバリアントストリームのみがバリアント選択の対象となります。

新しいCONTENT-STEERINGタグのPATHWAY-ID属性は、再生起動時に使用する最初の経路を指定します。

したがって、この場合、クライアントは最初の再生時にCN経路に属するバリアントストリームからのみ選択します。

SERVER-URI属性は、コンテンツステアリングサーバーがどこにあるかを指定します。

クライアントは、このURIからコンテンツステアリングの更新を取得します。

しかし、プレイリストにメディアグループが含まれている場合はどうなりますか?

問題ありません。

コンテンツステアリングを有効にするのはまだ非常に簡単です。

あなたがしなければならないのは、各経路のメディアグループを複製し、一意のGROUP-IDで割り当てることだけです。

たとえば、このプレイリストのオーディオグループは経路ごとに複製されており、GROUP-IDはCN経路などのCN-audioに設定されています。

HLSクライアントがコンテンツステアリングタグ付きのマスタープレイリストをロードすると、わずかに異なる起動ルーチンがトリガーされます。

まず、最初のバリアントストリーム選択を実行すると、最初の経路からのバリアントストリームのみが使用されます。

その後、選択したバリアントストリームとそのメディアセグメントを通常どおりロードして再生を開始します。

しかし、通常の再生ルーチンと並行して、クライアントはバックグラウンドで定期的なステアリングマニフェスト要求を開始します。

ステアリングマニフェストのリクエストがどのようなものか見てみましょう。

これは、マスタープレイリストURLに基づいてSERVER-URI属性からこの解決済みURIに送信される単純なHTTP GETリクエストです。

ステアリングサーバーはステアリングマニフェストで応答します。

その形式を例で解剖しましょう。

ステアリングマニフェストはJSONドキュメントです。

ステアリングサーバーは、クライアントごとにカスタマイズされたステアリングマニフェストを作成できます。

これにより、ステアリングサーバーは管理されたネットワークトラフィックを形作る上で大きな可能性を秘めています。

このステアリングマニフェストで最も重要なプロパティは、PATHWAY-PRIORITYフィールドです。

これは、優先順位順に並べられた経路IDのリストであり、最初のものが最も好ましいものです。

この例では、CN経路が最も好まれ、続いてJP、次にSGが優先されます。

ステアリングサーバーからステアリングマニフェストを受け取ると、クライアントはコンテンツステアリング評価を実行して、別の経路に切り替えるかどうかを判断します。

まず、クライアントは選択対象外のバリアントストリームを除外します。

これには、ネットワークエラーによるペナルティバリアントストリームが含まれます。

また、通常のバリアント選択と同様に、サポートされていないコーデックを持つバリアントストリームも行います。

少なくとも1つの適格なバリアントストリームを持ち、すべての適格な経路の中で最も高い経路優先度を持つ経路を選択します。

選択した経路が現在使用している経路と異なる場合、クライアントはすぐに新しい経路に切り替えます。

適切な経路が選択されていない場合、またはすでに選択した経路を使用している場合、クライアントは何もせず、現在の経路を使用してプレイし続けます。

最後に、クライアントは、ステアリングサーバーから最新のアップデートを引き出すために、次のステアリングマニフェストリクエストをスケジュールします。

では、このスケジューリングはどのように機能しますか?

ステアリングマニフェストを見直しましょう。

次のステアリングマニフェストリクエストを送信するまで、クライアントが待機する秒数を指定するTTLフィールドがあることに注意してください。

この例では、クライアントがこのステアリングマニフェストの経路優先度リストを使用してコンテンツステアリング評価を実行した後、次のステアリングマニフェストリクエストを300秒（5分）でスケジュールします。

また、ステアリングサーバーは、各ステアリングマニフェスト応答でこのTTL値を変更でき、クライアントが次のリクエストをスケジュールする時間に影響を与えることも注目に値します。

また、サーバーの負荷を分散するために、サーバーが各クライアントのTTL値にランダム性を注入することも便利です。

さらに、オプションのRELOAD-URIフィールドは、次のステアリングマニフェストを要求する場所をクライアントに伝えます。

ステアリングサーバーは、このフィールドを活用して、クライアント固有の状態またはセッションデータをURLに注入し、次のリクエストでエコーすることができます。

今、あなたはコンテンツステアリングの主要な技術的な詳細を見ました。

初期の例の1つに戻って、ボンネットの下でどのように機能するかを見てみましょう。

この場合、中国のすべてのユーザーがCN経路が最も好まれるステアリングマニフェストを受け取り、対応する中国のCDNはユーザー数の増加のために過負荷になっているとしましょう。

そのため、ステアリングサーバーが動作し、中国のユーザーの30%に異なるステアリングマニフェストを送信し、最も好ましい経路がJPに変更されました。

コンテンツステアリング評価を行った後、中国の30%のクライアントはJPパスウェイに切り替え、ネットワークトラフィックを日本のCDNにリダイレクトし、中国のCDNのネットワーク輻輳状況を解決します。

最後に、コンテンツステアリングの新しいHLS機能を紹介し、その仕組みとストリームに統合する方法を説明しました。

この素晴らしい機能により、グローバルストリーミングの可用性を微調整することができます。

技術的な詳細については、このビデオの下の「HLSコンテンツステアリング仕様」のリンクに従ってください。

また、プレイリストとステアリングマニフェストの検証は、最新のHTTPライブストリーミングツールでもサポートされていることもお伝えしたいと思います。

また、HLSインタレストIETFフォーラムで業界メンバーから受け取ったフィードバックと支援に感謝したいと思います。

今後のフィードバックや提案も歓迎します。

そして、これらすべてが実施されると、HLSコンテンツステアリングは、今年のWWDCシードビルドで開発者とユーザーが利用できるようになります。

したがって、より多くの可用性を備えたより良いグローバルストリーミング配信が必要な場合は、今すぐ行動してHLSコンテンツステアリングをストリームに統合し、顧客により良いストリーミング体験を提供します。

どうもありがとうございます。

♪