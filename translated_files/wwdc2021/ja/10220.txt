10220

こんにちは、私の名前はPaul Borokhovで、SwiftUI Macチームのエンジニアです。

後で同僚のケイト・コノネンコがローカリゼーションチームに加わり、SwiftUIアプリをローカライズする方法について話します。

このプロセスを説明するために、以前に見たことのあるFrutaサンプルアプリを使用します。

このアプリケーションでは、スムージーのメニューを閲覧したり、注文したり、レシピを見て自宅で作ることができます。

この講演では、私とケイトの両方の母国語であり、独自のアプリで使用する必要があるさまざまなローカリゼーションのベストプラクティスの良いショーケースであるため、ロシア語のローカリゼーションをアプリに追加します。

SwiftUIで文字列がどのようにローカライズされているか、そして一般的な設計上の落とし穴を避けるのがいかに簡単かについて、いくつかの基礎について説明します。

文字列とデータのスタイルとフォーマットのテクニックについて議論し、キーボードショートカットのローカリゼーションのいくつかの改善について説明します。

最後に、ケイトは、アプリのローカライズをこれまで以上に簡単にするために、Xcodeのローカリゼーションワークフローに対する改善のデモを行います。

アプリケーションをローカライズする上で最も重要な部分の1つは、UIのさまざまな部分の文字列が翻訳者に公開され、実行時に正しくレンダリングされるようにすることです。

SwiftUIは、文字列リテラルでテキストを使用すると、メインバンドルでローカライズされた文字列ルックアップを自動的に実行するため、これを簡単にします。

この例では、ロシア語の文字列ファイルの翻訳に基づいて、実行時に自動的にローカライズされる完了ボタンがあります。

これは文字列補間でも機能するため、変数を文字列に埋め込むことができ、エクスポートされたローカライズ可能な文字列ファイルとカタログの書式指定子に自動的に変換されます。

Xcode 13の新機能では、文字列に渡される変数の型に基づいて、書式指定子タイプを自動的に推測するようになりました。

テキストは、より多くの制御が必要な場合に備えて、テーブル名とバンドルの追加のオプション引数を受け入れます。

この例では、成分に関連するすべての文字列を「成分」と呼ばれる別の表に配置しました。

スムージーの実際の成分とは別に、スムージービューとレシピビューの2つの異なるコンテキストに「成分」という言葉の2つのバリエーションをこの文字列表に配置しました。

ご覧のとおり、ロシア語はこれら2つの単語を文脈に基づいて異なる方法で翻訳する必要があるため、これをしました。

文字列の整理方法の詳細については、「ローカライズされた文字列を合理化する」トークで学ぶことができます。

テキストの最初の引数はLocalizedStringKey型であるため、これはすべて機能します。

文字列リテラルを受け入れるカスタムビューとメソッドがある場合は、Stringの代わりにこのタイプを使用してローカライズ可能にすることができます。

このようにして、これらのビューと関数に引数として渡されるリテラルは、Xcodeローカリゼーションエクスポートプロセス中に自動的に抽出され、実行時にバンドルからロードされます。

ボタンの例で先に見た別のアプローチは、ビューが代わりにテキスト引数を受け入れるようにすることです。

LocalizedStringKeyを使用すると、プレビュープロバイダーで環境のロケールを指定することで、一度に複数のロケールをプレビューすることもできます。

NSLocalizedStringでロードされたものを含め、すべてのローカライズされた文字列をプレビューしたい場合は、ケイトが後で示すように、スキームエディタで言語を変更できます。

Xcode 13の新機能で、ローカリゼーションのためにプロジェクトをエクスポートすると、実際にすべてのターゲットを構築して、ローカライズ可能な文字列を見つけることができます。

これが実際に意味することは、Xcodeがローカライズ可能なコンテンツを見つけ、ローカリゼーションのためにそれを抽出するというはるかに良い仕事をすることができるということです。

だから、複数行の文字列を持つコードがあると想像してみてください。

コンパイラがローカライズされたコンテンツの抽出に使用されるようになったため、この複数行の文字列リテラルは正しく解析されます。

それでは、SwiftUIがローカリゼーションに優しいレイアウトでアプリを簡単に構築する方法を見てみましょう。

文字列ルックアップと同様に、SwiftUIが提供するデフォルトのレイアウト動作はローカリゼーションを念頭に置いて設計されており、ほとんどの場合、追加の労力は必要ありません。

たとえば、必要に応じて、テキスト付きのコントロールは、長いラベルを持つ言語でクリップしたり切り捨てたりしないようにラップします。

この場合、スムージーの名前は長いため、ロシア語で2行目にラップされます。

レイアウトは、右から左の言語でも自動的に反転されます。

スクリーンショットでは、テーブルセルのレイアウトが反転され、タブバーのシンボルも必要に応じてミラーリングされていることがわかります。

また、デフォルトから逸脱するように何かをカスタマイズする必要がある場合でも、私たちが提供するオプションは、VStacksで左ではなく先頭のアライメントを提供するなど、ローカリゼーションに優しいソリューションを案内します。

次に、アプリを構築する際に、UIに表示されるローカライズされたテキストのスタイルを設定する必要があるかもしれません。

これを簡単にするために、マークダウンを使用してローカライズ可能な文字列をスタイル設定する機能を導入しました。

これにより、ローカライズされた文字列へのスタイリングの適用が大幅に簡素化され、翻訳者は自分の言語に賢明なスタイリングを適用することができます。

たとえば、アラビア語にはイタリック体の概念がないため、英語の文字列に強調を使用しても、翻訳者は翻訳に強い強調などの異なる処理を使用できます。

この場合、私たちのロシア語翻訳者は、元の英語の説明の意図と一致するように、文字列内の最も関連性の高い単語の周りにマークアップを適用することができました。

そして、このサポートは基礎に存在しますが、SwiftUIは、スタイル化された文字列を表示用のテキストに直接渡すだけで、特に簡単に活用できます。

「What's New in Foundation」とSwiftUIトークをチェックすることで、テキストのスタイリングについて詳しく知ることができます。

アプリで遭遇するもう1つの一般的なシナリオは、言語と地域に適した方法でデータをフォーマットする必要性です。

使いやすく、TextおよびTextFieldと緊密に統合する新しい書式設定APIを使用すると、このタスクを達成できます。

Frutaでは、UI内のいくつかの場所でカロリー数を表示します。

以前は、ここのスライドにあるものと同様に、フォーマットされた値を表示するために測定フォーマッタを作成する必要がありました。

これで、値が表示されている場所と直接インラインで宣言的な方法でフォーマットを指定できます。

これは読みやすいだけでなく、前のスライドのコードよりもパフォーマンスが高くなります。

これらの新しい書式設定APIの詳細については、「What's New in Foundation」の講演をご覧ください。

最後に、初心者もパワーユーザーも、MacとiPadの両方でタスクをより迅速に実行できるキーボードショートカットを考えてみましょう。

macOSとiPadOSの新機能では、SwiftUIアプリで定義したキーボードショートカットが自動的に調整され、ユーザーの現在アクティブなキーボードレイアウトで入力できるようになりました。

たとえば、お気に入りリストにスムージーを追加する場合は、「Command plus」と入力して追加できます。

これは、組み合わせが正確に2つのキー押下、Commandキーとプラスキーを必要とする米国のレイアウトでうまく機能します。

ただし、リトアニア語のキーボードレイアウトを使用している場合、プラスキーに到達するのはそれほど簡単ではありません。

最初にバックティックキーを押してから、「Shift equals」を押す必要があります。

さらに悪いことに、この組み合わせは実際にはCommandキーを押しながら入力できません。

しかし、macOS MontereyとiPadOS 15の再マッピング機能のおかげで、リトアニアのキーボードレイアウトがアクティブな場合、ショートカットは「Command ž」に変更され、ユーザーは現在使用しているキーボードレイアウトに関係なく、キーボードショートカットを使用してお気に入りにスムージーを追加できます。

そして、ここに最高の部分があります、あなたは開発者として何もする必要はありません、それはただ機能します。

そして、それをケイトに渡しましょう。ケイトは、Xcode 13のローカリゼーションワークフローの改善点を示し、私が今取り上げたベストプラクティスと新しいAPIのいくつかをデモします。

ありがとう、ポール。

こんにちは、ローカリゼーションチームのエンジニアのケイトです。

SwiftUIアプリのローカライズがどれほど簡単かを見てみましょう。 試してみましょう。

ここにはFrutaのサンプルアプリがあります。

私たちは、世界中の人々が母国語でスムージーを注文できるようにしたいと考えています。

今日は、ロシア語のローカリゼーションを追加します。

したがって、まず、プロジェクトナビゲーターでプロジェクトに移動し、プロジェクトエディタで「Fruta」を選択し、「情報」タブでローカリゼーションを追加できます。

macOSに付属するすべてのローカリゼーションは、ここにアルファベット順にリストされています。

Xcode 12.5では、リストの下部にある「More Languages」サブメニューに、さらに何百もの言語と地域のバリエーションを追加しました。

「ロシア語」を選択します。

ポールが述べたように、Xcode 13は、Swiftコンパイラで新しい技術を使用して、Swiftコードからの文字列抽出を大幅に簡素化します。

FrutaはSwiftUIで書かれているので、ビルド設定「Compilerを使用してSwift Stringsを抽出する」が「はい」に設定されていることを確認したい。

これは新しいSwiftプロジェクトではデフォルトで有効になっていますが、既存のプロジェクトがSwiftUIを使用している場合は、この設定をオプトインできます。

ローカリゼーションのためにエクスポートすると、Xcodeはプロジェクト内のすべてのターゲットを構築し、コンパイラタイプ情報を使用してSwiftUIコードからLocalizedStringKeysを抽出します。

エクスポートする前に、SwiftUIプレビューで疑似言語を使用して、どの文字列がローカライズ可能で、どの文字列が見逃したかを確認できます。

そこで、スキームエディタに移動し、[オプション]タブで[App Language]をクリックします。

私のアプリでサポートされているすべての言語は上部にリストされていますが、一番下まで行って、アクセント付き疑似言語を選択します。

アクセント付きの疑似言語は、UIのソース文字列に異なるアクセントマークを追加します。

これで、すべての成分が疑似局在化されていることがわかります。

測定値はフォーマットされているため疑似ローカライズされていませんが、StepperViewは疑似ローカライズされているはずです。

この文字列をローカライズ可能にしましょう。

StepperViewは、「ラベル」文字列を取り込み、それをテキストビューに渡すカスタムSwiftUIビューです。

ローカリゼーションが必要なカスタムSwiftUIビューでは、LocalizedStringKeyを使用する必要があります。

今、それが疑似ローカライズされていることを確認しましょう。

すごい！

この文字列がローカライズ可能になったので、複数形を適切に処理することを確認する必要があります。

このコードは英語で「smoothie」を複数形にするために機能しますが、すべての単語で機能するわけではありませんし、すべての言語で機能するわけではありません。

代わりにstringsdictを使いましょう。

Stringsdictファイルは、言語の複数形のバリアントに対して異なる翻訳を提供できます。

Stringsdictの使用方法の詳細については、「ローカライズされた文字列を合理化する」ビデオをご覧ください。

ここにファイルが用意されているので、プロジェクトにドラッグします。

そして、ローカリゼーションのためにそれをマークします。

では、ローカリゼーションのためにエクスポートしましょう。

Xcode 12.5以降、製品メニューでプロジェクトやワークスペースのローカリゼーションをエクスポートおよびインポートできます。

では、ローカリゼーションのエクスポートをクリックして、デスクトップに保存しましょう。

今、Xcodeは私のプロジェクトを構築しており、それをロシア語に翻訳することを志願したポールに送る準備ができているXcodeローカリゼーションカタログを作成します。

Xcodeローカリゼーションカタログの詳細については、WWDC 2018の「Xcode 10の新しいローカリゼーションワークフロー」トークをご覧ください。

翻訳のために送信する前に、エクスポートされたものを再確認しましょう。

Xcode 13以降、Xcodeローカリゼーションカタログは作業がさらに便利になります。

Finderでカタログをダブルクリックして、Xcodeで開くだけです。

これは、独自のアプリをローカライズする場合、ローカリゼーションのためにコンテンツを送信する前に文字列やスクリーンショットを確認する場合、または特定の言語の翻訳を修正する場合に非常に便利です。

ここエディタでは、ローカリゼーションが必要なすべてのファイルを見ることができます。

ファイルを選択すると、翻訳者と同じようにすべての文字列を見ることができます。

キー、ソース文字列、翻訳、およびコメント。

私はここをざっと見て、すべてが良さそうに見えるかどうかを確認します。

すぐに、私はいくつかの問題を見ることができます。

まず、「%lfカロリー」文字列をエクスポートしました。

異なる地域がカロリーを測定するために異なる単位を使用するため、その文字列はフォーマットする必要があります。

それを修正するには、コードを変更する必要があります。

ここNutritionFactViewでは、文字列の代わりに、NutritionFacts構造体の測定タイプで「フォーマットされた」メソッドを使用できます。

食品のカロリーを測定しているので、ワイドフォーマットを使用し、使用量を「食品」に設定します。

これにより、すべての地域のユニットのフォーマットが処理されます。

それは簡単な修正でした。

私のひもを見直すことに戻りましょう。

ああ、翻訳者は変数名が表示されないので、「%@のレシピを購入する」のような文字列は混乱する可能性があります。

私は特定の価格でレシピを買っていますか、それとも友人にプレゼントしていますか?

他に曖昧な文字列があるかどうか見てみましょう。

「お気に入り」には動詞だというコメントがありますが、「お気に入り」にコメントを追加する必要があるので、名詞であることは明らかです。

両方のコメントをコードに追加します。

最初に「レシピを購入する」文字列を処理しましょう。

行くよ。

「お気に入り」文字列は私のタブバーの項目にあるので、コメントも追加しましょう。

タブバー項目はラベルビューです。

SwiftUIでは、コメントを追加するには、テキストビューでラベルを初期化する必要があります。

このようなコメントを追加することは、高品質のローカリゼーションを確保するために本当に重要です。

翻訳者に混乱してほしくないし、私の言いたいことを推測しないといけない。

さて、私はすべてを直したと思います。

新しいカタログをエクスポートしてポールに送る時間です。

うわー、それは速かった。

ポールは翻訳者のアップルシリコンです!

彼が送り返したものを簡単に見てみましょう。

ここでは、すべての翻訳を見ることができます。

私が追加したスムージーステッパーのstringsdictがあります。

よさそうですね。これをインポートして、アプリがロシア語でどのように見えるか見てみましょう。

インポートするには、[製品]メニューに移動し、[ローカリゼーションのインポート]をクリックし、Paulからカタログを選択します。

今、私のすべての文字列はローカライズされるべきです。

macOS用のロシア語でアプリを構築して実行しましょう。

まず、スキームをmacOSに変更してから、言語をロシア語に変更できます。

よし、それを実行しよう。

うわー、アプリはロシア語で素晴らしく見えます、そしてすべてのスムージーは美味しそうに見えます。

私はそれらのすべての成分とすべての栄養価を見ることができます。

私は実際にこれを注文すると思います。

うわー、なんて素晴らしいサービスでしょう。

SwiftUIのローカリゼーションは簡単に設計されているので、コードを書くことに集中できます。

アプリを開発する際に心に留めておくべき重要なポイントをいくつか紹介します。

LocalizedStringKeyは、バンドル内のローカライズされた文字列を検索するようにSwiftUIに通知する特別なタイプです。

カスタムSwiftUIビューで使用して、ローカリゼーションの準備をします。

Xcodeでローカリゼーションのためにエクスポートするときに、コードからLocalizedStringKeysを抽出する「Compilerを使用してSwift Stringsを抽出する」ビルド設定を有効にします。

文字列をフォーマットしてコードを国際化し、Markdownでスタイル設定します。

テキストを使用して、追加の翻訳コンテキストのコメントを追加します。

見てくれてありがとう、そしてWWDCの残りの部分を楽しんでください!

[音楽]。