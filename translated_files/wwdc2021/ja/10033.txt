10033

♪ ♪

こんにちは。私はケイトです。

私はSafariとWebKitチームのエンジニアで、今日はプライバシー保護広告アトリビューションについてお教えします。

今日のセッションを見ている人の多くは、おそらくすでに広告アトリビューションの歴史の専門家であることを知っていますが、全員が同じページにいることを確認するために、クッキー、広告、トラッキングの背景から始めます。

次に、ウェブサイト全体で広告キャンペーンを個人的に測定できるツールであるPrivate Click Measurementを紹介します。

次に、PCMをさらに拡張して、アプリで開始し、ウェブ上で変換する広告キャンペーンを測定する方法を紹介します。

最後に、SKAdNetworkを使用したプライバシー保護アプリからApp Storeへの広告アトリビューションの改善について説明します。

では、クッキーの歴史とウェブ広告におけるクッキーの役割から始めましょう。

クッキーは、広告アトリビューションと呼ばれるものをサポートするため、企業にとって有用です。

広告アトリビューションは、クリックなどの広告関連のアクションを、購入などの望ましい結果とリンクするプロセスです。

また、私がそれらの望ましい結果を「コンバージョン」と呼ぶのを聞くでしょう。

この概念は言葉では少し抽象的に見えるかもしれないので、例を見てみましょう。

私はたまたまロングボーディングが本当に好きです。

お気に入りの検索サイトsearchforlongboard.bizでロングボードの広告をタップするとします。

Searchforlongboard.bizは、クッキーと呼ばれるものをブラウザに保存できます。

クッキーは、ショッピングカート内の製品など、以前の訪問に関するデータをサイトが記憶するのに役立つ有用な小さなテキストです。

Searchforlongboard.bizのリンクは、ロングボードをカートに追加する新しいサイト、longboardshop.bizに移動するかもしれません。

Searchforlongboard.bizは、以前に保存したクッキーを参照して、私が行った最初の広告タップと私の購入をリンクすることができます。

これは広告アトリビューションの例です。

クッキーデータにより、searchforlongboard.bizは、この特定の広告キャンペーンの有効性を測定することができ、ビジネスにとって本当に役立ちます。

しかし、もし私が以前に最初の広告をタップしていなかったらどうでしょうか?

Searchforlongboard.bizは、私が行ったクリック、訪問したサイト、ページに費やした時間、および私のウェブ履歴と行動に関するその他の詳細情報を含む、私に関するクッキーデータを取得します。

Searchforlongboard.bizのような企業は、この情報を使用して、ユーザーの同意なしに、サイト全体でユーザーをフォローし、広告主の詳細なプロファイルを構築できます。

私たちはこれをクロスサイトトラッキングと呼んでいます。

ほとんどのユーザーは、自分の興味、行動、個人情報が保存され、追跡されるウェブ上での侵略的な経験を期待していません。

追跡は信頼を壊し、ユーザーと企業の間にミスアライメントを引き起こす可能性があります。

そして今、ますます多くのユーザーが、使用するサイトでの追跡を制限するために、広告やコンテンツブロッカーなどのメカニズムに目を向け始めています。

ユーザーの観点から見ると、コンテンツブロッカーは追跡を防ぐのに最適ですが、多くの場合、互換性の問題につながる可能性があります。

さらに、コンテンツブロッカーはすべての広告をブロックするため、いかなる種類の広告アトリビューションの可能性も明らかにありません。

広告とトラッキングに関するユーザーと企業の間の断絶は、ウェブ体験に大きなダメージを与えており、ウェブの互換性を維持しながらユーザーのプライバシーを保護する方法を見つけたいと考えました。

そのため、2017年、Appleは広告をブロックすることなく、トラッカーを識別し、ウェブ上のこの種のプロファイリングからユーザーを保護するIntelligent Tracking Prevention（ITP）を構築しました。

ITPでは、searchforlongboard.bizで同じ広告をタップすると、ファーストパーティのクッキーが保存され、longboardshop.bizに移動し、ロングボードが再びカートに追加されます。

しかし現在、ITPは、クッキーやその他のウェブサイトデータがsearchforlongboard.bizなどの第三者に送信されるのを防ぎます。

だから、彼らは私がロングボードの広告をタップしたことを知っているかもしれませんが、他のサイトで私の行動を追跡することはできません。

ITPは特にブラウザでのクロスサイトトラッキングを軽減しますが、トラッキングはウェブに固有のものではありません。

広告主の識別子（IDFA）は、アプリ間でiOSユーザーの同様のプロファイリングを実行するために長い間使用されてきました。

2020年、AppleはStoreKitフレームワークの一部であるSKAdNetworkを立ち上げた。

アプリのインストールにつながる広告に関するデータを収集して報告し、広告ネットワークに広告アトリビューションのプライバシー保護技術を提供するように設計されています。

昨年のSKAdNetworkの改善については、後で話します。

追跡は、ユーザーについて共有されているものを特定、理解、または同意する能力を与えることなく、ユーザーのプライバシーを侵害します。

そして、これについて考えているのは私たちだけではありません。

CCPAやGDPRなどの規制では、ウェブサイトにデータがどのように使用されているかをユーザーに通知することが義務付けられています。

BraveやFirefoxなどの他のブラウザも、トラッキング保護が組み込まれています。

追跡に依存するビジネスモデルは持続可能ではないことが明らかになっています。

私たちは、この変化するエコシステムで成功するために、広告を測定するためのよりプライベートな方法を提供することの重要性を認識しています。

したがって、セッションの残りの部分では、プライバシーで広告を測定するために実装したエキサイティングな新しいソリューションのいくつかに焦点を当てます。

私がカバーする最初のケースは、ウェブからウェブへの広告アトリビューションです。つまり、最初のクリックまたはタップと最終的なコンバージョンイベントの両方がブラウザで発生します。

今年は、プライバシーを保護する広告アトリビューションをウェブにもたらすプライベートクリック測定（PCM）を導入できることにとても興奮しています。

PCMは、W3Cプライバシーコミュニティグループで提案されている標準です。

完全な標準になるには、別のブラウザからの実装が必要です。

私たちは他のブラウザと協力して、ウェブ全体でPCMを標準化しています。

PCMは、完全にオンデバイス上の広告アトリビューションレポートメカニズムです。

レポートのエントロピーが制限されているため、サイトが特定のユーザーを特定できなくなります。

また、PCMを使用する場合、ユーザーはサイト間で追跡されません。

これは、アプリトラッキングの透明性要件がPCMの使用には適用されないことを意味します。

現在、PCMウェブツーウェブとアプリツーウェブはSafariで完全にサポートされています。

だから、このプレゼンテーションの残りの部分を通して、私が「ブラウザ」を参照するたびに、私はSafariを意味します。

WebKitエンジンを使用するブラウザと使用しないブラウザの両方で、他のブラウザのサポートの追加にも取り組んでいます。

オリジナルのロングボードの例に戻って、PCMがどのように機能するかを示しましょう。

繰り返しますが、searchforlongboard.bizでロングボードの広告をタップします。

PCMでは、このリンクは2つの追加情報を指定します。ソースIDは、広告キャンペーンを指定するために使用できる8ビットのエントロピーであり、広告が変換するサイトは、アトリビューション先サイトと呼ばれます。

これらはブラウザのデバイスに保存されます。

その後、広告リンクはlongboardshop.bizに私をナビゲートします。

「カートに追加」をタップすると、longboardshop.bizはトリガーデータと呼ばれる追加値を使用して変換イベントに関する情報を指定できます。

トリガーデータは4ビットで、カートに追加や購入などのアクションを指定する場合があります。

これはデバイス上、ブラウザにも保存されます。

では、報告はどうですか?

ブラウザのみがクリック側と変換側の両方の情報を持っていることに注意してください。

したがって、コンバージョンが保存されたクリックと一致する場合、ブラウザはこの情報を広告主に役立つレポートにフォーマットし、サイト間でユーザーの識別を防ぐことができます。

その後、ブラウザは、24時間から48時間後にランダムに、ソースサイトと宛先サイトの両方に送信するようにレポートをスケジュールします。

ランダムな遅延により、レポートは、誰かを識別するために広告クリックとコンバージョンをリンクする可能性のある時間関連のデータを提供することを防ぎます。

iOS 15とmacOS 12以降、これらのレポートにはIPアドレス保護もあり、フィンガープリントを防ぐために非常に重要です。

IPアドレス保護の詳細については、Appleのプライバシーの柱であるWWDCセッションで詳しく知ることができます。

では、広告キャンペーンを実行する際に、実際にPCMデータをどのように指定しますか?

広告が表示されているソースサイトでは、リンク属性を使用してPCMデータを指定できます。

ここでは、レモンイエローロングボードキャンペーンには識別子55があり、longboardshop.bizで変換されます。

宛先サイトでは、ソースサイトにHTTP GETリクエストを行い、変換イベントに関するデータを指定することで、アトリビューションイベントをトリガーできます。

ソースサイトはこのリクエストを取得し、この既知の場所にリダイレクトする必要があります。

ロングボードをカートに追加すると、トリガーデータ値が15になります。

また、後で購入など、より重要なコンバージョンでこのコンバージョンを上書きしたい場合は、より高い6ビットの優先度を指定できます。

このデザインは、採用を容易にするためにレガシーピクセルをサポートすることを目的としていました。

最後のステップは報告です。

レポートは、この有名な場所にJSON形式で送信されます。

このレポートは、広告クリックとコンバージョンをリンクするデータを提供しますが、ユーザーに関する識別情報が含まれていないことがわかります。

この場合、あなたが学んだことは、誰かがどこかでlongboardshop.bizのカートにレモンイエローのロングボードを追加したということです。

この情報を使用して、特定のユーザーを追跡することなく、広告キャンペーンを測定できます。

そして、これらは、ウェブからウェブへの広告キャンペーンを測定するためのプライベートクリック測定を実装するための基本です。

さて、PCMをさらに拡張してアプリで使用する方法を紹介します。

アプリで始まり、ウェブ上で変換する広告タップを測定することの重要性について、多くのフィードバックを聞きました。

このギャップを埋めることがいかに重要であるかを認識したので、PCMアプリからウェブへのアトリビューションも導入することに興奮しています。

これがどのように機能するかの例を見てみましょう。

今、私はソーシャルアプリを開きます。これは、ロングボードの友人全員に追いつくために使用するものです。

そして、私はロングボードの広告をタップします。

ソースIDと宛先サイトはデバイスに保存されます。

その後、Safariでlongboardshop.bizに移動します。

変換側は、ウェブからウェブへのケースとまったく同じです。

「カートに追加」をタップすると、longboardshop.bizはブラウザに保存されているトリガーデータで変換をトリガーできます。

ブラウザは情報をレポートに結合し、ランダムな24〜48時間の遅延でアプリレポートサイトと宛先サイトの両方に送信します。

PCM app-to-webアトリビューションを使用するには、キーNSAdvertising-AttributionReportEndpointを使用して、アトリビューションレポートの宛先サイトをアプリのinfo.plistに追加する必要があります。

レポートの宛先URLから登録可能なドメインを取り、レポートを送信するための既知のパスを形成するため、このステップは非常に重要です。

このよく知られたパスは、ウェブからウェブへのケースとまったく同じです。

PCM app-to-webの場合、アプリのコードにもいくつかの変更を加える必要があります。

キャンペーンを効果的に測定するためには、広告タップが実際に発生したことを知っておくことが重要であることを知っています。

そこで、UIEventAttributionViewと呼ばれる新しいデータ構造を追加しました。

アプリに広告を表示すると、新しいUIEventAttributionViewが作成されます。

その後、広告の上に配置します。

UIEventAttributionViewは、アトリビューションを報告する前にユーザーのジェスチャーが発生したことを確認し、報告されたデータが正確であることを確認します。

ユーザーが広告をタップすると、アプリが外部WebサイトへのURLを開いたときに送信されるUIEventAttributionと呼ばれる新しいデータ構造を作成する必要があります。

これには4つのものが入力されます。この場合、レモンイエローのロングボードの広告キャンペーンを識別するソース識別子。広告が変換されるdestinationURL。sourceDescription、タップされたコンテンツの説明。購入者、コンテンツの購入者の説明。

UISceneベースのライフサイクル管理を使用している場合は、OpenExternalURLOptionsオブジェクトを作成します。

次に、イベントアトリビューションオブジェクトを対応するプロパティに割り当て、オープン関数を呼び出す必要があります。

UIApplicationベースのライフサイクル管理を使用している場合、アプリからウェブへのキャンペーンのサポートを追加するのは少し異なります。

eventAttributionオブジェクトを含む辞書を作成する必要があります。

その後、オプションパラメータの値として辞書を使用してオープン関数を呼び出すことができます。

そして、それはアプリからウェブへのアトリビューションを実装するためのものです。

SKAdNetworkの改善に進む前に、PCMの不正防止について簡単に触れたいと思います。

PCMレポートには識別情報がないため、サーバーがコンバージョンレポートが信頼できるかどうかを知る固有の方法はありません。

したがって、PCMは詐欺を防ぐために暗号署名を使用しています。

署名を説明するために、私は人気のある封筒のアナロジーを使うつもりです。

それはこのように動作します。

Searchforlongboard.bizで広告タップが発生すると、ブラウザはsearchforlongboardの公開鍵を取得します。

次に、searchforlongboardが後で検証するメッセージを作成します。

ただし、searchforlongboard.bizがクリックとコンバージョンをリンクできるようにしたくないので、このメッセージは非表示にします。

メッセージを封筒に入れるようなものだと考えてください。

その後、ブラウザは隠されたメッセージをsearchforlongboard.bizに送信します。

彼らはRSAブラインド署名スキームを使用して隠されたメッセージに署名し、それを返送します。

これはカーボンコピー用紙のように考えることができます。

封筒の署名はメッセージにも適用されます。

したがって、ブラウザが封筒からメッセージを削除すると、searchforlongboardの署名が表示されます。

アトリビューションが発生すると、ブラウザはsearchforlongboardの署名付きのアトリビューションレポートを送信します。

これで、ソースサイトと宛先サイトは、searchforlongboardの公開鍵を使用して、クリックが発生したときに信頼できると見なされたことを検証できます。

Searchforlongboard.bizは元のメッセージを見たことがないので、広告のクリックとリンクすることはできません。

だから、それは詐欺防止についてです。

また、テストについてもお話ししたいと思います。なぜなら、テストとデバッグのシンプルで高速かつ簡単な方法を持つことが重要であることを知っているからです。

WebKitには、プライベートクリック測定デバッグモードと呼ばれる実験的な機能があります。

macOSのSafari開発メニューの「実験的機能」にあります。

iOSでは、WebKitの実験的機能メニューでデバッグモードをオンにすることができます。

デバッグモードはWebインスペクタのロギングを強化し、24時間から48時間後とは対照的に、レポートは10秒ごとに公開されます。

PCMを使用して、ウェブからウェブへのキャンペーンとアプリからウェブへのキャンペーンをサポートするのはそれです。

SKAdNetworkの最近のアップデートで、アプリからApp Storeへの広告キャンペーンを改善する方法について話したいと思います。

まず、ここまでのSKAdNetworkの簡単な概要から始めましょう。

SKAdNetworkの基本は2020年にWWDCで取り上げられたので、その仕組みのより詳細な概要については、これらのプレゼンテーションを参照すると便利です。

基本的に、SKAdNetworkには、広告ネットワーク、パブリッシャーアプリ、広告アプリの3つの当事者が関与しています。

ソーシャルアプリを使っていて、SocialAdNetからロングボードアプリの広告が出されたとしましょう。

SKAdNetwork用語では、SocialAdNetはAdNetwork、Social Appはパブリッシャーアプリ、Longboard Appは広告されたアプリです。

ロングボードアプリの広告をタップすると、広告ネットワークID、パブリッシャーアプリID、キャンペーンID、タイムスタンプ、および詐欺防止のための追加情報を含むレポートが生成されます。

この情報は、デバイス上のApp Storeに保存されます。

ロングボードアプリの広告が私をApp Storeに連れて行って、そこでロングボードアプリをインストールして起動するとしましょう。

現在、Longboard Appは、StoreKitが提供する2つのAPIのうちの1つ、RegisterApp- ForAdNetworkAttributionまたはupdateConversionValueを呼び出します。

どちらもSKAdNetworkレポートをトリガーし、どのコールを使用するタイミングの詳細については、ドキュメントを確認できます。

StoreKitは有用な情報をレポートにまとめ、広告ネットワークに送信します。

SKAdNetworkのバックグラウンドがわかったので、昨年行ったいくつかの改善について話します。

SKAdNetworkを立ち上げて以来、私たちはあなたのフィードバックに耳を傾け、変更を加えてきました。

各バージョンでは、より多くのセキュリティ、広告を測定するより多くの方法、またはより多くのアトリビューションレポートなど、広告アトリビューションでニーズをよりよく満たすのに役立つ何かが導入されました。

このセクションでは、署名キーの改善、ビュースルーアトリビューのサポート、複数のポストバックとIPアドレスの保護、開発者へのポストバックについて説明します。

また、それぞれの新機能を利用するために必要な最低限のiOSバージョンに注意してください。

まず、バージョン2.1で、Appleはより強力で安全な256ビット公開鍵を導入しました。

これを利用するには、ポストバックを検証するために使用しているApple公開鍵を更新する必要があります。

Appleの署名を確認する方法に関する詳細な手順は、このセッションに関連するSKAdNetworkのドキュメントへのリンクに記載されています。

次に、バージョン2.2は、ビュースルー広告キャンペーンのサポートを追加しました。

これには、新しいSKADImpressionインスタンスを作成し、署名を生成し、2つの新しいAPIを呼び出すことが含まれます。ユーザーへのカスタム広告の提示を開始するときのstartImpressionと、広告の提示を終えたときのendImpressionです。

ビュースルーアトリビューションにより、StoreKitはフィデリティタイプと呼ばれる新しいパラメータも導入しました。

StoreKitでレンダリングされたクリックスルー広告の忠実度タイプは1ですが、カスタムビュースルー広告の忠実度タイプは0です。

これにより、ビュースルーインプレッションはクリックスルーインプレッションよりも優先順位が低くなり、ビュースルーポストバックは、より高い忠実度で競合するインプレッションがない場合にのみ報告されます。

iOS 14.6では、複数のポストバックとIPアドレス保護が導入されました。

現在、SKAdNetworkは、勝者ネットワークと最大5人の準優勝者へのレポートの送信をサポートしています。

勝利ネットワークは、コンバージョン前に発生した最後の印象によって決定されます。

レポートが生成されると、勝者はsourceAppやコンバージョン値などの群衆の匿名性制御値を受け取る可能性があります。

準優勝者はこの情報を取得しません。

また、SKAdNetworkの新機能には、開発者へのポストバックがあり、優勝したポストバックは広告されたアプリに報告されます。

ポストバック・トゥ・デベロッパー機能を利用するには、アプリはInfo.plistで開発者レポートサイトを指定する必要があります。

これは、PCMアプリからウェブへのレポートに必要なのと同じNSAdvertising-AttributionReportEndpointキーを使用します。

PCMと同様に、plistで指定されたURLから登録可能なドメインは、ポストバックが送信される既知の場所を形成するために使用されます。

次に、新しいSKAdNetworkテクノロジーのテストとデバッグを成功させるためのベストプラクティスをいくつかお伝えします。

まず、各インプレッションのノンスは一意でなければならないことを思い出してください。

これは、不正防止とレポートの整合性を維持するために重要です。

次に、署名を作成するときに引数の順序が重要です。

したがって、このステップで問題が発生した場合は、ドキュメントをチェックして、引数の順序が正しいことを確認できます。

次に、ポストバックをテストするには、常にソースアプリIDが0の開発署名付きソースアプリを使用する必要があります。

そして最後に、テストプロファイルはポストバック送信時間を短縮し、このセッションに関連付けられたリンクからダウンロードできるというリマインダー。

だから、それはSKAdNetworkの改善のためであり、それはプライバシーを保護する広告アトリビューションのための今年の更新のすべてを締めくくります。

ご覧のとおり、プライベート広告アトリビューションを採用するために、昨年実装および改善した多くの機能があります。

では、私が今日取り上げたことを復習しましょう。

まず、プライベート広告測定をウェブにもたらす広告アトリビューションメカニズムであるPCMを導入しました。

PCMは、ウェブ上で完全に測定された広告キャンペーンだけでなく、アプリで開始し、ウェブ上で変換するキャンペーンもサポートしています。

また、昨年SKAdNetworkに入ったすべてのアップデートを調べました。これは、アプリのインストールを測定するためのさらにプライベートで安全で便利な方法を提供します。

そして最後に、これらの技術の設計と改善の多くは、開発者としての皆さんからの連絡から来ていることを繰り返したいと思います。

だから、ありがとう。そして、フィードバックを提供し続けてください。

私たちは、W3CプライバシーコミュニティグループのGitHubページで見つけることができるPCM提案された標準についての考えを歓迎します。

プライバシーと広告が混ざらないという考えでこれに入った場合、このセッションが実際に整列する未来を見るのに役立ったことを願っています。

見てくれてありがとう、そして私はあなたがWWDCの残りの部分を楽しむことを願っています。

[明るい音楽]。