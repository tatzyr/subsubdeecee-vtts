10136

こんにちは、私はAppleのCore OSのエンジニアリングマネージャー、Timm Hannonです。

このセッションでは、同僚のMelissa Nierleと私はMDMのユーザー登録をカバーします。

ユーザー登録は、組織ではなくユーザーがデバイスを所有するBYOD、またはBring Your Own Device展開用に設計されています。

ユーザーがデバイスを所有しているため、ユーザー登録には、モバイルデバイス管理ソリューションによってデバイスに適用できる限られたペイロードと制限があります。

また、iOS、iPadOS、macOSで利用できます。

セキュリティとプライバシーは、Appleで行うすべてのことの中心にあります。

ユーザー登録は、両方を組み込んだ優れたデバイス管理オプションです。

その設計により、ユーザーはプライバシーと個人データが保護されていることに安心できますが、組織は自分のデータが安全であると確信できます。

ユーザー登録の基礎を形成する3つのコアコンポーネントがあります。

1つ目は管理対象Apple IDです。

管理対象Apple IDは、iCloudなどのAppleサービスへのアクセスを提供します。

それらは組織によって所有および管理されており、Apple Business ManagerとApple School Managerを通じて入手できます。

ユーザーが組織の既存の資格情報で認証できるように、Azure Active Directoryとのフェデレーションをサポートしています。

2つ目はデータ分離です。

登録中に、異なる暗号鍵を持つ別のAPFSボリュームが作成されます。

管理対象アプリと管理対象アカウントからのデータは、個人的なコンテンツから離れたこのボリュームに安全に保管されます。

デバイスが管理から登録解除されると、ボリュームと暗号鍵は消去されます。

そして最後に、管理機能は、デバイス上の組織のコンテンツを制御するのに適したものに限定されています。

ユーザーはデバイスを所有し、使用しているため、プライバシーを保護することが重要です。

ユーザー登録では、ユーザーはデバイス上の個人データの管理を維持します。

デバイスは、ユーザー登録で監視されているとはみなされません。

MDMサーバーで利用可能な管理機能により、管理対象コンテンツを完全に制御できますが、個人データと設定へのアクセスと制限は制限されています。

個人アカウント、アプリ、および一意のデバイス識別子へのアクセスは、デバイスをリモートで拭くなどのシステム全体の操作と同様に、MDMサーバーでは使用できません。

今年はユーザー登録の更新に懸命に取り組んできましたが、今それらについて話し合うことに興奮しています。

管理対象Apple IDと管理対象アプリについて説明します。

その後、同僚のメリッサは、ユーザーのオンボーディングフローの変更、継続的なユーザー認証を有効にする方法、および開始について説明します。

管理対象Apple IDから始めましょう。

iOS 15では、設定で管理対象アカウントにアクセスするエクスペリエンスを改善しました。

デバイスがユーザー登録されると、設定の最上位にアカウントが表示されます。

そこから、iCloudの詳細と設定を表示できます。

追加アカウントの管理がこれまで以上に簡単になりました。

この再設計されたエクスペリエンスにより、設定は組織コンテンツの明確な分離を反映しています。

ユーザーは、システムのどの部分が組織によって管理され、どの部分が管理されていないかを確認できます。

iOS 15とmacOS Montereyの新機能で、マネージドApple IDはiCloud Driveをサポートしています。

iCloud DriveはiCloudアカウントの重要な機能であり、ユーザーが登録したデバイスで利用できるようになります。

iOSとiPadOSでは、ファイルアプリに新しい場所として表示されます。

また、macOSでは、Finderに追加の場所として表示されます。

iCloud Drive for Managed Apple IDを使用すると、組織は組み込みのクラウドストレージソリューションをユーザーに簡単に提供できるようになりました。

ドキュメントブラウザベースのアプリは、追加のiCloud Driveにもアクセスできます。

そしてもちろん、iCloud Driveは、管理対象アプリとデータアクセスのマネージドオープンイン制限を尊重します。

では、管理対象アプリに目を向けましょう。

macOS Big Surでは、macOSで初めて管理対象アプリを有効にしました。

これにより、組織は、カスタム構成のペイロードを含め、iOSの場合と同様に、管理対象デバイスにアプリをインストールできます。

また、MDMコマンドで、またはデバイスが登録を解除したときにアプリを削除する機能も提供します。

macOS Montereyでは、ユーザー登録に機能を拡張しています。

iOSと同様に、アプリのデータは別のボリュームで区切られています。

アプリは登録解除中またはMDMコマンドで削除されます。

その場合、データコンテナも消去されます。

CloudKitを使用するマネージドアプリは、MDMプロファイルに関連付けられたマネージドApple IDを使用するようになりました。

InstallApplicationコマンドにInstallAsManagedキーを追加する必要があります。

そして、管理されたアプリはアプリケーションフォルダにインストールする必要があり、単一のアプリバンドルのみを含める必要があることを簡単にお知らせします。

データが正しく分離されていることを確認するために、データ保護キーチェーンとアプリサンドボックスの使用を採用することをお勧めします。

また、ユーザー登録に関連するすべてのタイプの登録のために、管理対象アプリにいくつかの機能強化を追加しました。

まず、マネージドオープンインの制限機能が拡張され、コピー&ペーストが含まれます。

これにより、組織は、管理された境界を越えて両方向に貼り付けられるデータを制御することができます。

また、デバイスが管理に登録したときに、必要なアプリがインストールされることを指定する機能もあります。

アプリはデバイスが登録されるとインストールが承認されるため、追加のユーザー確認は必要ありません。

管理されたペーストボードと必要なアプリのインストールの詳細については、「Appleデバイスの管理に関する新機能」を参照してください。

メリッサに、登録と継続的なユーザー認証をカバーします。

ありがとう、ティム。

ユーザー登録のこれらすべての強化により、オンボーディングフローをよりパーソナライズされたユーザー主導のエクスペリエンスに更新しました。

iOS 13で導入されたユーザー登録のオンボーディングエクスペリエンスは、MDM登録プロファイルによって開始され、推進されます。

このプロファイルは、ユーザーごとに作成し、管理者が配布する必要があります。

iOS 15では、ユーザーと管理者の両方にとってより合理化されたエクスペリエンスのために、ユーザーの組織のアイデンティティをエントリポイントとして確立する新しいユーザー登録オンボーディングフローを作成しました。

ユーザーは、メールやカレンダーなどのサービスを設定するために組織のアイデンティティにサインインすることに慣れているので、組織のアイデンティティを使用してiPhoneでMDMを設定することに精通しているでしょう。

このオンボーディングフローにより、ユーザー登録の新しいセキュリティ機能が可能になります。

これで、MDMプロファイルがデバイスにダウンロードされる前や、組織データがデバイスに送信される前に、MDMサーバーがユーザーを確認できる登録フロー中のセキュリティレイヤーがあります。

この新しいアカウントベースのフローがどのように機能するかを見てみましょう。

新しいユーザー登録オンボーディングフローには4つのコンポーネントがあります。

サービスディスカバリーは、デバイスが組織のMDMサーバーを識別します。

ユーザー認証は、MDMサーバーがユーザーを検証する方法です。

セッショントークンの発行は、継続的な認証の実行方法です。

そして、登録は、デバイスへのMDMペイロードのインストールです。

これらのそれぞれを詳しく見てみましょう。 

ユーザーがオンボーディングフローを開始すると、組織識別子を入力するように求められます。

この識別子には、@記号で区切られた2つの主要な部分があります。

最初の部分はユーザーIDで、2番目の部分は組織のドメインまたはサブドメインになります。

ユーザーが組織IDを入力すると、デバイスは識別子のドメイン部分を取り、そのドメインでよく知られているHTTPリソースを指すHTTPS URLに変換します。

この検出URLは、登録エンドポイントがどこにあるかをデバイスに伝えるMDMサーバードキュメントをホストする場所です。

その後、デバイスはJSONドキュメントを取り戻すことを期待して、そのURLにGETリクエストを実行します。

受信したJSONオブジェクトには、サーバーがサポートする登録の種類をデバイスに知らせるバージョンキーと、MDMサーバーの登録エンドポイントのURLを指定するBaseURLキーが含まれています。

この情報により、デバイスはサーバーから登録プロファイルをリクエストする準備が整いました。

デバイスは、さまざまなデバイス属性を持つサーバーの登録エンドポイントにプロパティリストをPOSTします。

無線プロファイル配信プロセスに精通している場合は、デバイスがプロファイルサービスエンドポイントに対して行うのと同じ要求として認識されます。

しかし、ここでの主な違いは、サーバーが登録プロファイルを引き渡す前に、ユーザーに自分自身を認証するように要求することです。

これは、HTTP 401 Unauthorizedレスポンスを発行して、ユーザーに資格情報を求めます。

登録を成功させるには、サーバーがこの認証チャレンジを発行する必要があります。

重要なことに、この401応答には、デバイスが認証に使用する情報を含むWWW-Authenticateヘッダーが含まれています。

このWWW-Authenticateヘッダーは、ベアラー認証スキームと2つの追加パラメータを使用します。

メソッドパラメータは、どのタイプの認証が使用されているかをデバイスに伝えます。

この値は、デバイスが AuthenticationServices Web サインインフローを使用してユーザーを認証することを示します。

今のところ、その値は固定されています。

このメソッドパラメータには、URLも含まれています。

このキーの値は、認証が行われるエンドポイントを指定するHTTPS URLです。

このURLは、MDMサーバー自体のエンドポイントである必要があります。

この認証ヘッダーの受信により、AuthenticationServices Webサインインフローが開始されます。

それがどのように機能するかを見てみましょう。

AuthenticationServices Web サインイン フローによって表示される Web ビューの初期コンテンツは、401 応答の URL パラメーターで指定された認証エンドポイントへの HTTP GET 要求の結果です。

単純なケースでは、このWebサインインフローは、ユーザーがユーザー名とパスワードを入力するWebフォームを表示できます。

より複雑なケースでは、エンタープライズシングルサインオンを利用したり、サードパーティのIDプロバイダーにリダイレクトしたり、多要素認証を実行したりすることもできます。

デバイスと認証サービスの間で複数の往復が発生する可能性があります。

AuthenticationServices Webフローは、ここで見られるようなHTTPリダイレクト応答をサーバーがデバイスに返すと完了します。

応答には、カスタム固定スキームを使用したURLを含むLocationヘッダーが含まれています。

URLには、デバイスがMDMサーバーにリクエストを行う際にセッショントークンとして使用する不透明なトークンであるアクセストークンパラメータも含まれています。

セッショントークンを手元にあると、デバイスは元のHTTP POSTリクエストを再発行して、登録プロファイルを取得します。

今回、そのリクエストには、セッショントークンを値として含む承認ヘッダーが含まれています。

サーバーはこのトークンを検証し、成功すると登録プロファイルをデバイスに返します。

ユーザー登録プロファイルには、MDMペイロードに2つの新しいキーが含まれています。

まず、AssignedManagedAppleIDキーは、エンタープライズユーザーに関連付けられた管理対象Apple IDです。

ユーザーは、登録フローの一環として、iCloudおよびiTunesアカウントにサインインするために、この管理対象Apple IDを認証する必要があります。

MDM登録が成功すると、管理対象Apple IDがデバイスで有効であることを保証します。

AssignedManagedAppleIDキーが見つからない場合、またはユーザーが正常に認証しなかった場合、デバイスは登録に失敗します。

そして、2番目の新しいキーはEnrollmentModeキーで、登録がBYODタイプであることを示しています。

デバイスは、この値が現在のモードと一致することを確認し、不一致がある場合、またはキーが存在しない場合は登録に失敗します。

これらの新しいキーの両方を使用して、必ずMDMペイロードを更新してください。

登録プロファイルを受信すると、デバイスは必要な管理対象Apple IDアカウントを設定し、MDMサーバーに登録します。

サーバーへのすべてのリクエストには、サーバーが検証するための承認ヘッダーにセッショントークンが含まれるようになりました。

すべての作品を一緒に見てみましょう。 一緒に見ていきましょう。

まず、ユーザーは設定で再設計されたVPNとデバイス管理セクションに移動し、新しい職場または学校にサインインボタンをタップします。

次に、組織IDを入力し、サービス検出ステップをトリガーします。

ドメインから登録エンドポイントを検出した後、認証サービスWeb UIフローが開始されます。

これは、認証に使用される単純なWebフォームの例です。

ユーザーは組織のパスワードを入力します。

組織の認証が成功すると、MDMプロファイルが手渡されます。

プロファイルからAssignedManagedAppleIDキーの値を取り、ユーザーがパスワードを入力する次のサインイン画面に事前に入力します。

この認証が成功すると、ユーザーはデバイスの管理を許可します。

デバイスのパスコードを入力して、暗号化されたエンタープライズデータパーティションを作成し、MDM登録を承認します。

ユーザーの登録は成功しました。

そして、それはユーザー登録のための新しいアカウント主導のオンボーディングフローです。

オンボーディングフローでは、登録データを送信する前にサーバーがユーザーを認証する方法を調べました。

iOS 15の新しいユーザー登録では、組織がいつでもユーザーを再認証する機能を導入しています。

これにより、サーバーとクライアントの接続がこれまで以上に安全になります。

MDMサーバーは、クライアントからのすべての要求で承認を検証し、いつでもID資格情報を再認証するようユーザーに依頼できるようになりました。

この機能は、セッショントークンを使用して実行されます。

これは、次のMDMコマンドを取得するためにサーバーにチェックインするMDMクライアントの例です。

Authorizationヘッダーにはセッショントークンが含まれています。

これは、継続的な認証の2つの要素の定番です。

最初の要素は永続的な承認であり、セッショントークンはすべてのクライアント要求でサーバーに送信されます。

2番目の要素は、セッショントークンをリフレッシュすることです。

これにより、組織の管理者はいつでもユーザーの再認証を要求できます。

このセッショントークンの独自のサーバーサイド検証ロジックを実装することで、組織のセキュリティルールを管理ソリューションに直接追加できます。

たとえば、ユーザーの資格情報を定期的に確認して、機密性の高いペイロードが信頼できるユーザーを所有するデバイスにのみ送信されるようにすることができます。

それがどのように機能するかを見てみましょう。

セッショントークンが無効になると、再認証がトリガーされます。

次回デバイスがMDM HTTPリクエストを行うと、HTTP PUTに含まれる無効なセッショントークンがサーバーから401レスポンスをトリガーします。

サーバーが送信する応答には、オンボーディングフロー中に最初の認証交換で以前に見たのと同じWWW-Authenticateヘッダーが含まれています。

もちろん、MDMプロセスはデバイス上のバックグラウンドで実行されるため、この再認証要求はNotificationCenterを介してユーザーに公開されます。

通知をタップすると、ユーザーは設定で再認証フローを続行します。

クライアントは、オンボーディングプロセス中のような別のAuthenticationServices Webサインインフローを開始します。

ユーザーは、シンプルなメカニズムまたはサーバーのIDプロバイダーとの統合によって決定されたより複雑なメカニズムのいずれかで、AuthenticationServices Webサインインフローの一部として認証する必要があります。

その認証サービスのWebフローが完了すると、サーバーは新しいセッショントークンを含むカスタムロケーションヘッダーでリダイレクト応答を再度送信します。

再認証が成功すると、デバイスは最初に401応答を受け取ったMDM要求をすぐに繰り返し、サーバーからのアクションなしで中断したところからすぐに続行します。

以前と同様に、この新しいセッショントークンは、後続のすべてのMDM HTTPリクエストに含まれています。

何らかの理由でユーザーの認証試行が失敗した場合、サーバーはデバイスを信頼しなくなる可能性があります。

この場合、サーバーは機密性の高いMDMペイロードを削除するか、デバイスを完全に登録解除することができます。

また、MDMからの登録解除に関しては、継続的な認証はHTTP 401応答を活用するため、プロファイルベースの登録とこの新しいユーザー登録の主な違いに注意することが重要です。

iOS 15以前は、すべてのMDM登録デバイスは、サーバーからの401応答を登録解除コマンドとして扱っていました。

この新しいユーザー登録スタイルが有効になると、401応答は代わりに再認証をトリガーします。

登録解除をトリガーするには、MDM登録プロファイルのRemoveProfileコマンドを送信する既存のメカニズムを引き続き使用できます。

これにより、完全なMDM登録解除と、完全な管理アカウント、管理データ、およびデータ分離ボリュームがデバイスから削除されます。

iOS13からのユーザー登録フローを含む、プロファイルベースの登録のすべての登録解除動作は変更されません。

だから、それは継続的な認証の簡単な見方です。

さあ、あなたが始めてまとめるのを手伝いましょう。

iOS 15で、新しいユーザー登録のオンボーディングと継続的な認証を今すぐ始めることができます。

あなたはこれらの5つのことを必ず行う必要があります。

まず、エンタープライズドメインのHTTP既知のリソースファイルを設定して公開します。

次に、MDMサーバーをIDプロバイダーと統合して、登録中にユーザー認証を実行し、継続的な認証を利用してセキュリティのメリットを追加します。

第三に、管理対象Apple IDを作成するか、Apple School ManagerとApple Business Managerからすでに作成された管理対象Apple IDを使用して、サーバーのMDMペイロードにAssignedManagedAppleIDキーを入力します。

MDMペイロードを更新して、新しいEnrollmentModeキーも含めます。

そして最後に、新しいiOS 15 Apple Device Managementのドキュメントを見つけて、今日確認したすべての詳細とともに、特定のアップデートを確認してください。

そして、アカウントベースのユーザー登録を開始するために必要なのはそれだけです。

今日はたくさん取り上げたので、復習しましょう。

管理対象Apple IDの新しいiCloud Driveサポートは、あなたの組織に組み込みのクラウドストレージオプションをもたらします。

ユーザー登録でmacOS上のアプリを管理できるようになりました。

MDMソリューションの新しいオンボーディングフローのサポートを構築するか、MDMプロバイダーが新しいアカウント主導のオンボーディングをサポートして、ユーザーの登録をこれまで以上に簡単にすることを奨励します。

管理ワークフロー全体で、アカウントに継続的な認証を組み込みます。

iOS 15とmacOS Montereyから始まったこれらの新機能を活用して、あなたとあなたのユーザーの両方のためのBring Your Own Deviceワークフローを大幅に改善してください。

今日はご参加いただきありがとうございます。素晴らしいWWDCをお過ごしください。

[音楽]。