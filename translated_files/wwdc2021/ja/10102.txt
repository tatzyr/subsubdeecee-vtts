10102

こんにちは。

私はシンディ・クラリッサです。

私はCore Locationのソフトウェアエンジニアです。

今日は、今年のコアロケーションのクールな新しいことについて話します。

私たちは、できるだけ多くの許可を付与する必要のある人々に直面することなく、アプリのロケーションベースの機能に電力を供給できる2つの新機能を導入しています。

最初の機能から始めて、リージョンベースのユーザー通知をwatchOS 8にもたらします。

今、あなたのApple Watchアプリは、ジムに到着したときにトレーニングを開始するか、家に帰ったら犬に餌をやることを人々に思い出させることができます。

たとえば、ここには、この新機能を使用して、空港に到着したときにフライトについて人々に通知するApp in the Airがあります。

リージョンベースのユーザー通知を使用すると、システムは「常に」権限を持つことなく、アプリに代わって空間的に関連性のある情報を表示できます。

watchOSにリージョンベースのユーザー通知を採用する方法の詳細については、「watchOSの新機能」セッションをご覧ください。

では、このセッションの主なトピックについて話しましょう。

私たちは、人々が自分のデータをより詳細に制御できる場所を要求する新しい方法を導入していますが、同時に、アプリにより多くの機能を提供します。

まず、今日の位置認証の状態と、新機能の背後にある動機について話します。

iOS 14では、アプリが位置情報の承認を要求すると、最初のプロンプトが表示され、許可を一度、使用中、または許可しないから選択することができます。

そして、昨年の新機能により、人々はあなたのアプリに送信される場所の精度を制御することができます。

あなた方の何人かは、人々があなたのアプリで一度許可を選択したことに気づいたかもしれません、そして、彼らはあなたのアプリに使用中の許可を与えることが必要ではないと思うかもしれません。

たとえば、ペットショップアプリは、最寄りのペットショップを決定するために場所の承認を要求するかもしれませんが、異なるキャットフードのオプションを閲覧しているときには、その場所を必要としません。

この場合、このアプリを使用している人は、一度許可するか許可しないかを選択する可能性が高くなります。

ユーザーが「1回許可」を選択した場合、アプリを使用している期間の位置許可を付与します。

しかし、あなたのアプリはバックグラウンドに入ると承認を失います。

これにより、複数のロケーション認証要求が発生する可能性があり、ユーザーエクスペリエンスに悪影響を及ぼす可能性があります。

別のケースでは、プロンプトにうんざりしている人が、プロンプトが再び表示されるのを防ぐために「許可しない」を選択する可能性があることに気付くかもしれません。

これにより、後で場所を承認するために設定に人を送信しなければならない可能性があります。

プライバシーはAppleにとって重要な優先事項であり続けているため、「ユーザーエクスペリエンスを妨げることなく、どうすればより多くのコントロールを与えることができるか」と考えました。必要な瞬間にのみ場所を承認する簡単でフレンドリーな方法を提供できますか?

iOS 15から、私が言及した問題点に取り組むために、UIKit用のCLLocationButtonとSwiftUI用のLocationButtonを導入します。

ここには、近くの最寄りの公園を見つけるパークファインダーアプリがあります。

下部には、矢印グリフの横に「現在地」というタイトルの青い位置情報ボタンがあります。

ボタンを押すと、パークファインダーは私の現在の場所を取得し、近くのすべての公園の地図ビューを表示することができます。

左上の位置矢印が青に変わり、許可したばかりの承認にユーザーの注意を喚起します。

注意すべき点の1つは、ロケーションボタンが、毎回プロンプトを通過させることなく、実際にアプリにAllow-Onceの許可を与えていることです。

後で、これが既存の承認ステータスにどのように影響するかについて説明します。

位置情報ボタンをwatchOS、iOS、Catalystを搭載したmacOS、MacのiPadアプリに導入します。

それでは、APIと、CLLocationButtonをアプリに追加する方法を掘り下げてみましょう。

CLLocationButtonは、CoreLocationUIフレームワークの一部です。

UIButtonと同様に、CLLocationButtonはUIControlsから派生しています。

そのため、ボタンでUIControl機能を使用できます。

さらに、ボタンに固有の4つのプロパティがあります。

矢印のタイプを設定するCLLocationButtonIcon、ボタンのラベルを設定するCLLocationLabel、ボタンの丸みを設定するcornerRadius、最後にラベルのサイズを設定するfontSizeがあります。

簡単な概要を調べたので、「CLLocationButtonで場所を受け取るにはどうすればよいですか？」と疑問に思うかもしれません。

まあ、それはUIButtonで場所を要求するのと似ています。

例を挙げると理解しやすいと思います。

UIButtonをCLLocationButtonに置き換える方法をお見せしましょう。

このUIButtonの例では、ボタンのタップ時に使用中の承認を最初に要求することで、場所を要求する簡単なボタンを作成します。

まず、UIButtonをインスタンス化し、そのタイトルを「現在地」に設定します。

関数を呼び出すターゲットアクションを追加し、ボタンがタップされるたびに必要なアクションを実行したい。

この場合、近くのすべての公園を展示したいです。

では、この関数を「showNearByParks」と呼びましょう。

このshowNearByParks関数では、locationManagerを使用してrequestWhenInUseAuthorizationとstartUpdatingLocationを呼び出します。

この関数では、それに応じてマップビューをレンダリングするための追加のロジックも追加します。

しかし、簡単にするために、それを省略しましょう。

まず、最初の2行を削除し、CLLocationButtonのインスタンス化に置き換えてから、ラベルを「.currentLocation」に設定することで、UIButtonを置き換えましょう。

最後に、requestWhenInUseAuthorizationへの呼び出しをコメントアウトすることができます。これは、ボタンが正常にタップされるたびに、ロケーションボタンがお客様に代わって1回限りの承認を付与するためです。

したがって、既存のUIButtonをお持ちの場合は、ここに示すように簡単に置き換えられます。

しかし、私たちはそれをさらに簡単にしたいので、このトークに添付されているパークファインダーアプリの例を見ることができます。

SwiftUIアプリを持っている人のために、位置情報ボタンもSwiftUIにあります。

ここの例に示すように、LocationButtonを使用できます。

SwiftUIの新しい「symbolVariant」を使用して矢印タイプを設定し、「ティント」を使用してボタンの背景色を設定していることを指摘したいと思います。

ロケーションボタンをカスタマイズする方法について、いくつかの例を見てみましょう。

位置ボタンを使用すると、背景色、テキストとグリフの色、丸みを帯びた角などをカスタマイズできます。

ここでは、ボタンで作成できるスタイルの例をいくつか紹介します。

ロケーションボタンをカスタマイズするステップバイステップの例を見てみましょう。

デフォルトのボタンから始めましょう。

デフォルトの外観は、ここに示すように、白の「現在地」タイトルとシステムブルーの背景色です。

ボタンアイコンをarrowFilledに設定できます。

次に、tintColorを白から黒に設定することで、アイコンの前景色を変更できます。

次に、backgroundColorを白に設定します。

最後に、25.0に設定することで、角半径を角が丸みを帯びるように設定できます。

また、ボタンの制約とサイジングの設定方法に応じて、ボタンの幅が高さに等しい場合、コーナー半径が幅の半分のときに完璧な円を作成できます。

これで、デフォルトの位置ボタンを簡単な調整で白い円形のボタンに変えました。

ロケーションボタンに追加できるいくつかの文体の変更をちょうど通過しました。

ボタンをカスタマイズして、アプリに合った完璧な外観を作成できます。

しかし、大きな力には大きな責任が伴います。

位置情報ボタンをカスタマイズすると、位置情報ボタンが明確で見えるようにするために、いくつかの制限が発生する可能性があります。

ボタンが正しく描画されていないか、場所を受け取っていないように見える場合、あなたが期待できるいくつかの例について話したいと思います。

その場合、ターゲットアクションが呼び出されますが、承認は得られません。

でも、心配しないでください。

遭遇している制限を把握するのに役立つログメッセージで多くのフィードバックを提供します。

たとえば、これらは、ボタンのサイズ、アルファ値、およびtintColorとbackgroundColorの間の色のコントラストの不十分さを参照する異なるログメッセージにすぎません。

それでは、XcodeでInterface Builderを使用している場合に期待できるフィードバックの例をいくつか紹介しましょう。

先ほど作成したボタンを続けると、既存のボタンを白い色合いに変更すると、ボタンの背景色がすでに白であるため、人々はこれを見ることができません。

したがって、これを行うと、Xcodeの[問題]タブの下のナビゲーションペインにこの問題が表示されます。

代わりに、元のボタンを元に戻して、このボタンの不透明度（アルファ）を変更してみましょう。

たぶん、あなたはこれを見ることができますが、他の人にとっては、それは少し透明すぎるので、それは私たちのアクセシビリティガイドラインに失敗します。

同様の問題文がXcodeで作成され、アルファ値を増やすことをお勧めします。

あなたが遭遇するかもしれないもう一つの問題は、ボタンのサイズが不十分です。

これは、ボタンの内容がボタンのサイズに対して小さすぎる、または大きすぎる場合です。

ユーザーのローカリゼーション設定に応じて、ボタンのテキストの長さが変更される可能性があります。

では、言語を変更してテキストサイズを大きくしましょう。

実装が自動レイアウトに優しいかどうかに応じて、言語を変更すると、テキストのサイズがボタンよりも大きくなる可能性があります。

テキストがドイツ語のボタンに合わないことに注意してください。

このような場合は、ログメッセージを見てフィードバックを求めてください。

位置情報ボタンを非常に小さいまたは非常に大きなテキストサイズでテストするだけでなく、ボタンがすべてのケースで機能していることを確認するために異なる言語でテストすることを忘れないでください。

したがって、ボタンをカスタマイズするときは、それが明確で目に見えることが不可欠であることを覚えておいてください。

ボタンが正しく描画されていないか、場所を受信していないように見える場合は、もはや判読できない可能性があります。

その場合は、何が間違っている可能性があるかを判断するのに役立つガイダンスのためのログメッセージを提供します。

ロケーションボタンの実装方法がわかったので、それが既存の承認ステータスにどのように影響するか疑問に思うかもしれません。

前に述べたように、ロケーションボタンは基本的にAllow-Onceの承認を与えています。

アプリにいかなる種類の承認ステータスもない場合は、プライバシー設定で「共有するとき」が選択されている「NotDetermined」承認があります。

これがアプリの現在の状態である場合、各ユーザーが初めて位置情報ボタンを押すと、このプロンプトは、彼らが搭乗していることを確認するように求められます。

ただし、「アプリの使用中」状態など、アプリがすでに位置情報に許可されている場合、位置情報ボタンを使用しても既存の状態は変更されず、他のUIButtonと同様に動作します。

それが機能するところでは、場所ボタンは、自分の場所がいつ、毎回使用されるかどうかを人々に決めさせているので、魔法のように安心感を感じることができます。

ロケーションボタンははるかに快適であるため、人々は以前よりもロケーションボタンを介してアプリの位置情報を提供する可能性が高いと思います。

だから、私たちはユーザーとあなたのアプリに正しい足で降りる別の機会を与えたい。

過去にアプリで「許可しない」承認を選択した人が新しいロケーションボタンをタップすると、このボタンの紹介プロンプトが表示され、アプリをNotDeterminedに戻し、今後はロケーションボタンを使用する機会があります。

そこで、このセッションでは、リージョンベースのユーザー通知を使用して、watchOSアプリにより多くの動的な機能をもたらすことについて話しました。

もっと学ぶことに興味があるなら、セッションのリソースを見るのを忘れないでください。

また、場所を尋ねる方法のゲームを変えることができるいくつかのクールな新機能も取り上げました。

人々が自分のデータプライバシーをより詳細に制御できるようにすることは、Appleにとって重要です。

人々は自分のデータがどのように共有されているかをますます認識しています。

最も素晴らしいユーザーエクスペリエンスを提供するだけでなく、顧客との信頼を築くためにアプリを設計するとき、「私のアプリには従来の認証が必要ですか、それとも位置情報ボタンを使用した1回限りの位置認証がより適していますか？」と自問したいと思うかもしれません。

そして、答えは、場合によっては、一度で十分かもしれないということです。

ロケーションボタンを使用すると、位置情報を共有したいタイミングをより詳細に制御することで、人々の信頼を得ることができます。

ありがとうございます。

[音楽]。