10145

♪ベース音楽の演奏♪

♪

Pranav Sodhani:こんにちは、WWDCへようこそ!

私の名前はプラナブで、アップルのディスプレイとカラーテクノロジーチームの一員です。

この講演では、ビデオ品質ツールを紹介し、アプリやコンテンツ作成ワークフローで圧縮されたビデオの知覚品質を評価する方法を紹介します。

典型的なビデオ配信ワークフローを見ることから始めましょう。

このようなワークフローでは、高品質のソースビデオはビデオ圧縮を受け、オプションでビデオをダウンスケーリングして、より低いビットレートでビデオを生成します。

そして、これらの低ビットレートのビデオは、帯域幅に制約のあるネットワークを介して簡単に配信できます。

このようなワークフローを使用するいくつかの可能な方法には、AVAssetWriterなどのAVFoundation API、Compressorなどのアプリ、または独自のビデオ圧縮ワークフローの1つになります。

現在、ダウンスケーリングと圧縮により、ビデオコーディングとスケーリングアーティファクトを追加できます。

そして、これはソースビデオを損ない、目に見えるアーティファクトを作成します。

このようなアーティファクトの一例は、右側のフレームに示されている圧縮ビデオの閉塞性です。

もう1つの例は、ビデオがぼやけて見え、ビデオの詳細が消え始めるときです。

このようなアーティファクトは、消費者のビデオ品質体験に悪影響を及ぼす可能性があります。

私たちは、消費者が高品質のビデオ体験を期待していることを知っています。

したがって、この期待に応えることが重要です。

さて、これを行うための最初のステップは、配信されたコンテンツの品質を評価することです。

そして、これを行う最も正確な方法は、実際の人々にビデオを見てもらい、ビデオ品質の尺度で評価してもらうことです。

しかし、大量のビデオを評価したい場合、これは非常に時間がかかり、スケーラブルではありません。

幸いなことに、別の方法があります。

ここで必要なのは、スピードとスケーラビリティのプロセスを自動化できるように、ビデオ品質を特徴付ける客観的な方法です。

このような設定では、知覚ビデオ品質ツールは、圧縮されたビデオとソースビデオを入力として取り、ビデオ品質スコアを出力します。

このスコアは、1から5の範囲の浮動小数点数であり、実際の人々が圧縮されたビデオをどのように評価したかを模倣することができます。

今日、私たちはこのような知覚的なビデオ品質ツールで開発者を可能にすることに非常に興奮しています。

要するに、私たちはそれを高度なビデオ品質ツールまたはAVQTと呼んでいます。

AVQTについてもっと学びましょう。

では、AVQTとは正確には何ですか?

さて、AVQTはmacOSのコマンドライン実行可能ファイルとして提供されます。

そして、実際の人々が圧縮されたビデオの品質をどのように評価するかを模倣しようとします。

AVQTを使用して、フレームレベルとセグメントレベルのスコアの両方を計算できます。セグメントは通常数秒の長さです。

そしてもちろん、AVQTのすべてのAVFoundationベースのビデオフォーマットのサポートを追加しました。

これには、SDRだけでなく、HDR10、HLG、ドルビービジョンなどのHDRビデオフォーマットも含まれます。

次に、アプリケーション全体で非常に有用なAVQTの3つの重要な属性について説明します。

まず、AVQTが人間の知覚とどの程度一致しているかを見ていきます。

次に、AVQTの計算速度について話します。

そして最後に、ビデオ品質を予測する際に、視聴設定の認識が重要である理由を紹介します。

これらのそれぞれについて詳しく説明しましょう。

AVQTは、ビデオ品質に関する人間の意見とよく相関しています。

また、アニメーション、ナチュラルシーン、スポーツなどのコンテンツタイプでうまく機能します。

PSNRや構造的類似性、略してSSIMなどの従来のビデオ品質指標は、通常、コンテンツタイプ間ではあまりうまく機能しないことがわかりました。

1つの例を見てみましょう。

さて、これは私たちの最初のソースビデオである高品質のスポーツクリップのフレームです。

圧縮されたビデオの同じフレームを見てみましょう。

フレームが十分に高い知覚品質のように見えることがわかります。

その通り、PSNRスコアは約35、AVQTスコアは4.4です。

次に、2番目のソースビデオで同じ演習を実施します。

この場合の圧縮ビデオには、目に見えるアーティファクトがあるようです。

特に、その人の顔にいくつかのアーティファクトを見ることができます。

興味深いことに、それは約35の同じPSNRスコアを取得しますが、今回はAVQTはそれを約2.5と評価し、品質が悪いことを意味します。

ここでは、AVQTスコアが正しい予測だと思います。

これは、クロスコンテンツ評価で何がうまくいかないのかを説明するために選んだ一例にすぎないことに注意してください。

多様なビデオセットでAVQTの知覚精度をテストしたかった。

そこで、私たちは公的に利用可能なビデオ品質データセットでそれを評価しました。

これらのデータセットには、人間の被験者が提供するソースビデオ、圧縮ビデオ、およびビデオ品質スコアが含まれます。

ここでは、Waterloo IVC 4KとVQEG HD3の2つのデータセットの結果を紹介します。

ウォータールーIVCデータセットには、コーディングとスケーリングの両方のアーティファクトにまたがる20のソースビデオと480の圧縮ビデオが含まれています。

4つの異なるビデオ解像度と2つの異なるビデオ規格をカバーしています。

VQEG HD3データセットは比較的小さいです。

9つのソースビデオと72の圧縮ビデオがあります。

そして、これらは1080pのビデオ解像度でビデオコーディングを使用して生成されました。

また、ビデオ品質メトリックのパフォーマンスを客観的に測定するために、相関と距離の測定を使用します。

ピアソン相関係数、つまりPCCは、予測されたスコアが主観的なスコアとどの程度相関しているかを測定します。

PCC値が高いほど、相関関係が向上します。

そして、RMSEは、予測が主観的なスコアからどれだけ離れているかを測定します。

RMSE値が低いと、予測精度が高くなります。

さて、AVQTが人間の被験者から与えられたスコアをどれだけうまく予測できるかを評価したいと思います。

ここのx軸には、地上の真実の主観的なビデオ品質スコアがあります。

そして、y軸には、AVQTによって予測されたスコアがあります。

ここのすべてのポイントは、圧縮されたビデオを表しています。

散布図からわかるように、いくつかの外れ値を除いて、AVQTはこのデータセットの主観的なスコアを予測するのに素晴らしい仕事をしています。

これは、高いPCCスコアと低いRMSEスコアにも反映されています。

また、VQEG HD3データセットでも高いパフォーマンスが見られます。

先に進んで、AVQTの計算速度について話しましょう。

スケーラビリティを確保するためには、高い計算速度が非常に重要であることに注意してください。

AVQTのアルゴリズムは、Metalで高速に実行するように設計および最適化されています。

これは、大きなビデオファイルを非常に迅速に実行できることを意味します。

また、すべての前処理をネイティブに処理します。

あなたにとって、これはビデオをデコードしてオフラインでスケーリングする必要がないことを意味します。

AVQTはあなたのためにそれをします。

AVQTは毎秒175フレームで1080pのビデオを実行することに注意してください。

したがって、24 Hzで10分の長さの1080pビデオがある場合、AVQTは1.5分以内にその品質を計算できます。

私たちが話したい最後の属性は、セットアップの認識を見ることです。

視聴設定は、ビデオを見るときに知覚するビデオ品質に影響を与える可能性があります。

特に、ディスプレイサイズ、ディスプレイ解像度、視聴距離などの要因は、ビデオ内のアーティファクトを隠したり誇張したりする可能性があります。

これに対処するために、AVQTはこれらのパラメータをツールへの入力として取り、これらの要因が変化するにつれて正しい傾向を予測しようとします。

そのようなケースを1つ見てみましょう。

2つのシナリオを考えてみましょう。

シナリオAでは、画面の高さの1.5倍の視聴距離で4Kディスプレイで4Kビデオを見ています。

シナリオBでは、同じディスプレイで同じビデオを見ていますが、現在は画面の高さの3倍の視聴距離にあります。

明らかに、シナリオBでは、あなたがそれを注意深く見ていたときに見えたアーティファクトのいくつかを見逃すでしょう。

これは、シナリオBで認識されるビデオ品質がシナリオAよりも高くなることを意味します。

そして、AVQTはさまざまな品質レベルでそのような傾向を捉えることができます。

ここのチャートは、視聴距離が1.5Hから3Hに増加するにつれて、AVQTスコアも増加することを示しています。

これの詳細については、ツールで利用可能なREADMEドキュメントを確認することをお勧めします。

さて、皆さんがAVQTに興奮しているので、このツールを正しい方法で使用する方法をお見せしましょう。

開発者ダウンロードポータルを通じて、まもなくAVQTを利用できるようになります。

デモを順を追って説明します。

だから、私はすでにツールをダウンロードし、このシステムにAVQTをインストールしました。

「どのAVQT」の出力を見ると、AVQTがusr/local/binディレクトリに配置されていることがわかります。

これで、AVQTヘルプコマンドを呼び出して、AVQTでサポートされているさまざまなフラグの使用について詳しく読むことができます。

現在のディレクトリに何があるか見てみましょう。 

サンプルリファレンスと、デモに使用するサンプル圧縮ビデオがあります。

だから、それらを通してAVQTを実行させてください。

参照ファイルとテストファイルを入力として提供し、出力ファイルを指定します。

出力ファイルにsample_output.csvという名前を付けましょう。

このツールは進捗状況を印刷し、セグメントのスコアを画面に報告します。

デフォルトのセグメント期間は6秒で、このクリップの長さは5秒なので、セグメントは1つしかありません。

次に、出力ファイルを見てみましょう。

フレームレベルのスコアはここで確認できます。

そして最後に、セグメントレベルのスコアが下に向かっています。

さて、デモではいくつかのオプションを示しましたが、このツールには他にもいくつかの機能が組み込まれています。

たとえば、セグメント期間と時間プールフラグを使用して、フレームレベルのスコアの集計方法を変更できます。

同様に、表示距離フラグと表示解像度フラグを使用して表示設定を指定できます。

これの詳細については、READMEを参照してください。

わかった。

これまでのところ、AVQTの重要な属性のいくつかについて学びました。

また、ビデオのペアでコマンドラインツールを使用してビデオ品質スコアを生成する方法も見ました。

次に、AVQTを使用してHLSのビットレートを最適化できる特定のケースを見てみましょう。

HLS層は異なるビットレートでエンコードされます。

そして、これらのビットレートを選択することは、常に簡単なプロセスではないことを知っています。

これを支援するために、HLSオーサリング仕様文書にいくつかのビットレートガイドラインを公開しました。

これらのビットレートは、HLS経由で配信される典型的なコンテンツの初期エンコーディングターゲットにすぎないことに注意してください。

また、コンテンツによってエンコーディングの複雑さが異なることもわかっています。これは、最適なビットレートがコンテンツによって異なることを意味します。

したがって、アニメーション映画など、1種類のコンテンツでうまく機能するビットレートは、スポーツイベントではうまく機能しないかもしれません。

AVQTをフィードバックとして使用して、コンテンツの最適なビットレートを決定する方法は次のとおりです。

まず、最初の目標ビットレートから始めます。

このビットレートを使用して、ソースビデオをエンコードし、HLS層を作成します。

次に、ソースビデオとエンコードされたHLS層を使用して、AVQTを使用してビデオ品質スコアを計算します。

最後に、AVQTスコアを分析して、HLS層の目標ビットレートを増減するかどうかを決定できます。

これを例で示すために、特定のHLS層を選びましょう。

ここでは、毎秒11.6メガビットの2160p層を選択しています。

次に、前の2つのシーケンス（アニメーションとスポーツ）をこの推奨ビットレートでエンコードします。

エンコードされた階層の準備ができたら、AVQTを使用してビデオ品質スコアを計算します。

ここのチャートは、2つのビデオシーケンスのAVQTスコアを示しています。

この特定の層では、高いビデオ品質が期待できるため、しきい値を4.5に設定し、ほぼ優れた品質を示しています。

このビットレートはこのアニメーションクリップには十分ですが、スポーツクリップには十分ではないことがわかります。

そこで、私たちは戻って、このフィードバックを使用してビットレート目標を調整します。

特に、スポーツクリップのビットレート目標を増やし、AVQTスコアを再計算する必要があります。

ビットレートの10%の増加を目指しましょう。

ここでは、スポーツクリップの新しいAVQTスコアをプロットしました。

更新されたスコアは現在、予想されるしきい値の4つ半を上回っています。

また、アニメーションコンテンツのビデオ品質にもはるかに似ています。

最後に、この話から取り除いてほしい重要なことがいくつかあります。

ビデオ圧縮は、消費者のビデオ品質体験に影響を与える目に見えるアーティファクトにつながる可能性があります。

AVQTを使用して、圧縮されたビデオの品質を評価できます。

AVQTはmacOSのコマンドラインツールとして提供され、すばやく計算でき、セットアップを認識して表示しています。

また、すべてのAVFoundationベースのビデオフォーマットもサポートしています。

最後に、AVQTを使用して、HLS層のビデオ品質を最適化できます。

ありがとうございます！

♪