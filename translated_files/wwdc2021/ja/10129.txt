10129

私の名前はLucy Zhangで、インストールおよびソフトウェアアップデートチームのソフトウェアエンジニアです。

今日は、macOS、iOS、iPadOSのマネージドソフトウェアアップデートについて話します。

ソフトウェアのアップデートは、Apple製品を使用するすべての人にとって非常に重要です。

アップデートは、公証やmacOS Big Surの封印されたシステムボリュームなど、新しいセキュリティ強化をもたらします。

彼らはすべての最新の機能を有効にし、おそらく最も重要なのは、それがすべての新しい絵文字を取得する方法です。

当社のプラットフォームを使用すると、デバイスを簡単に更新できます。

実際、過去4年間に導入されたすべてのiPhoneの86%がiOS 14を使用しています。

ただし、管理環境では、このプロセスをより詳細に制御する必要があります。

デバイスの艦隊を管理するときは、それらを最新の状態に保ちたいが、OSがソフトウェアと互換性があることを確認するために、リリースする前にアップデートをテストする時間が必要です。

テストが完了したら、ユーザーの混乱を最小限に抑えながら、アップデートができるだけ早くインストールされていることを確認する必要があります。

このセッションでは、まず、ベータ版と新しくリリースされたソフトウェアアップデートをテストできるプログラムと制限について説明します。

次に、アップデートを展開するためのMDMコマンド。

そして最後に、ユーザーがサポートする準備ができている最新バージョンに確実に更新できる新しい方法についてお話しするのが待ちきれません。

アップデートのテストを始めましょう。

AppleがベータOSをリリースすると、リリース前に環境でOSをテストする時間とツールがあります。

AppleSeed for ITは、ベータ版中に新しいAppleソフトウェアにアクセスしてテストするのに役立ちます。

Apple School ManagerまたはApple Business Managerの学生以外の管理対象Apple IDは、プログラムに参加できます。このプログラムでは、環境でテストするためのリリース前のAppleソフトウェアにアクセスでき、詳細なテスト計画とフィードバックを提供する方法が含まれています。

アップデートが公開されると、まだテストする時間が必要な場合があり、アップデートをすべてのユーザーが利用できるようにしたくありません。

そのために、あなたは延期を持っています。

延期は、これらのアップデートがAppleによって公開されてから指定された期間が終了するまで、監視対象デバイスがユーザーにソフトウェアアップデートを提供することを防ぎます。

延期制限を適用すると、デフォルトの遅延は更新公開から30日です。

1日から90日の間にカスタム値を指定することもできます。

更新が指定された遅延が期限切れになるのに十分な期間利用可能だった場合、その更新は標準のソフトウェア更新通知と更新プロセスの一部としてユーザーに提供されます。

これらの制限により、システム環境設定のソフトウェア更新インターフェイスをより詳細に制御できます。

延期された更新の制限は、ソフトウェアアップデートのインターフェースにのみ影響します。

MDMコマンドの動作は変わりません。

制限が設定されていても、MDMにはデバイスに特定のアップデートを送信する機能があります。

iPhone、iPad、Apple TVの場合、ソフトウェアアップデートの延期は、iOS 11.3以降、iPadOS 13.1以降、tvOS 12.2以降で利用できます。

更新を延期すると、メジャーアップデートとマイナーアップデートに同じ延期ウィンドウが設定されます。

Macコンピュータの場合、ソフトウェアアップデートの延期はmacOS 10.13以降で利用できます。

macOS 11.3以降では、管理者はメジャーリリースをマイナーリリースよりも長く遅らせることを選択できます。

そうすれば、管理者が自分の環境で本番用の最新のメジャーリリースを承認するために働いている間、ユーザーは依然として重要なセキュリティアップデートの恩恵を受けることができます。

これらは、Macコンピュータにインストールするためにプロファイルで設定できるキーです。

forceDelayedMajorSoftwareUpdatesキーを使用して、メジャーリリースを延期します。

このキーを使用すると、主要なOSアップデートを延期しながら、マイナーなOSとセキュリティアップデートを受け取ることができます。

マイナーリリースを個別に延期したい場合があり、これを行うにはforceDelayedSoftwareUpdatesキーを使用します。

また、補足アップデートを個別に延期するには、forceDelayedAppSoftwareUpdatesキーを使用します。

延期タイプが有効になっているが、対応する延期期間が設定されていない場合は、古いキーManagedDeferredInstallDelayを使用します。

延期制限がある場合、これはmacOSのソフトウェアアップデート環境設定ペインがどのように表示されるかです。

延期がどのように機能するかを探りましょう。

タイムラインに戻ると、アップデートを延期し、環境での互換性のために新しいOSのテストを続けています。

OSを確認してテストを完了したら、ユーザーにプッシュする準備が整いました。

ユーザーの準備が整ったときにデバイスを更新したいし、ワークフローに侵入することはありません。

では、アップデートの展開について調べてみましょう。

適切なデバイスに適切なアップデートをインストールするにはいくつかの手順があり、macOS Montereyでは、macOSとiOSの間にこれまで以上に多くのパリティがあります。

すべてのプラットフォームにアップデートを展開する最初のステップは、アップデートを確認し、デバイスの適格性を確認することです。

macOS Montereyより前のMacでどのように行われたかは次のとおりです。

利用可能なOSアップデートは、ユーザーのデバイスでのみ評価することができました。

ScheduleOSUpdateScanコマンドを使用して、利用可能なOSアップデートをサーバーに照会するようにMacに指示し、アップデートを評価して適格性を判断します。

スキャンが終了し、MDMサーバーに送り返されると、MDMは展開するアップデートを選択できます。

ただし、Appleは、プラットフォーム間で利用可能なOSバージョンのリストを提供するApple Software Lookupサービスを提供しています。

ここでは、iOSデバイスが提示されています。

Mac用のScheduleOSUpdateScanに付属するやり取りを減らすために、すでにiPhoneとiPadのフィードを使用している可能性があります。

iOSの場合、MDMソリューションはAppleソフトウェアルックアップサービスを使用して、利用可能なアップデートを認識し、コマンドをデバイスに直接プッシュします。

方法は次のとおりです。まず、MDMサーバーは、Appleソフトウェア検索サービスから12.1や12.2などの利用可能なアップデートのリストを取得できます。

アップデートを展開する準備ができたら、MDMサーバーはアップデートバージョンをデバイスに送信します。

その後、デバイスはソフトウェアアップデートサーバーに到達し、アップデートが適格であることを確認し、ダウンロードとインストールを開始します。

macOS Montereyの新機能で、このプロセスをmacOSとiOSに統合しています。

現在、iOSとmacOSのハードウェアモデル文字列をMDMに返すSoftwareUpdateModelIDと呼ばれる新しいDeviceInformationクエリキーをサポートしています。

Apple Software Lookup Serviceには、macOSの適切なハードウェア識別子が含まれており、MDMサーバーはAvailableOSUpdatesコマンドなしでアップデートの適用性を判断できます。

iOSと同様に、MDMはDeviceInformationクエリの結果をJSONフィードにリストされているデバイスIDと比較することで、更新の適用性を判断できます。

また、これまで、macOSはProductVersionキーを無視し、代わりにProductKeyを使用していました。

macOS Monterey以降、ProductVersionキーはmacOSでサポートされます。

iOSはすでにこのキーを使用してアップデートを指定しています。

互換性のために、ProductVersionとProductKeyの両方を指定すると、ProductKeyが使用されます。

デバイスがそのバージョンの対象となるアップデートが見つからない場合、適切な応答が送信されます。

これにより、以前にデバイスのサポートされているデバイスIDを収集している限り、マイナーなOSアップデートの往復が削除されます。

MDM管理者は、デバイスが監視されている限り、macOS、iOS、およびiPadOSのソフトウェアアップデートを自動的にインストールして承認することができます。

macOS 11以降では、デバイス登録または自動デバイス登録のいずれかを使用して登録されたすべてのMacコンピュータが監視されています。

iOSとiPadOSの場合、ユーザーはアップデートを進めるためにパスコードを入力する必要があります。

Appleシリコンを搭載したMacコンピュータは、「所有権」の概念を導入しています。

所有権は、使用のために設定するためにMacを最初に請求し、真の法的所有権や親権の連鎖に縛られていないユーザーとして大まかに定義することができます。

所有権は、macOSの特定のインストールのスタートアップセキュリティポリシーを変更する権限を持つユーザーを定義します。

Appleシリコンでは、スタートアップセキュリティポリシーは、macOSのバージョンがMacコンピュータで起動できる制限と、自動更新にブートストラップトークンを使用する権限を定義します。

macOSでは、アップデートを実行するために認証が必要です。

Appleシリコンを搭載したMacコンピュータの場合、認証にはユーザーパスワードまたはMDMブートストラップトークンが必要です。

システム環境設定からユーザーが開始したインタラクティブな更新には、ユーザーパスワードが必要です。

MDMブートストラップトークンは、macOS 11.2以降を必要とする自動非対話型アップデートに使用され、インストールされているアップデートはAppleによって署名されている必要があります。

macOS Montereyの新機能として、MDMが開始したインストール後のフローのブートストラップトークンのサポートを導入しました。

これは、Appleシリコンデバイスが、デバイスが使用されていないときに、後で更新をスケジュールして実行できることを意味します。

ユーザーは、ワークフローを中断することなく、デバイスを更新していることに感謝するでしょう。

彼らは翌日、更新されたマシンで目を覚ますことができます。

ブートストラップトークンをすでにサポートしている場合は、ScheduleOSUpdateでInstallLaterアクションを使用すると、これが機能し始めます。

MDMがどのアップデートがデバイスに適用されるかを知ると、ScheduleOSUpdateコマンドを使用して、macOS、iOS、およびiPadOSにアップデートを展開します。

MDMコマンドを使用して、延期ウィンドウまたは後にアップデートをインストールできることに注意してください。

ScheduleOSUpdateコマンドを使用する場合は、いくつかのオプションがあります。

設定する必要があるオプションの1つはインストールアクションで、その値は更新の動作に大きく影響します。

InstallASAPインストールアクションは、ユーザーレスmacOSデバイスの主要な更新メカニズムです。

InstallASAPは、Appleシリコンを搭載したMacコンピュータでの認証にブートストラップトークンを使用します。

このアクションはすぐに実行され、ユーザーが更新をキャンセルするオプションがあります。

InstallASAPコマンドは、InstallForceResartオプションが使用されていない限り、アクティブに使用されているアプリケーションを自動的に閉じないことに注意してください。

DownloadOnlyは、ユーザーとユーザーレスデバイスの両方が、インストール時間前にバックグラウンドでアップデートをダウンロードするのに便利です。

NotifyOnlyは、インストールのためのアクションがあることをユーザーに警告するために使用されます。

どちらのコマンドもインストールを開始しません。

InstallLaterでは、Install Tonightのアップデートをスケジュールできます。

デバイスは、インストールを実行するために、デバイスが最も使用されていないときなどの条件を使用して、機械学習に基づいて、通常午前2時から午前4時の間に時間枠を選択します。

デバイスは、電源に接続されていることを考えると、その時間枠で更新が行われるようにスケジュールします。

通知をチェックしましょう。

InstallASAPコマンドまたはDefaultコマンドを使用すると、ユーザーは再起動カウントダウン通知を受け取ることができます。

ユーザーは、通知オプションで再起動をキャンセルすることを選択できます。

また、macOS Montereyでは、InstallLaterを使用すると、ユーザーにこの通知が届きます。

これをもっと詳しく調べてみましょう。

この通知は、アップデートがその夜にインストールを試みることを示しています。

ユーザーは、後でアップデートを実行するときに、デバイスを電源に接続する必要があることを思い出します。

iOSまたはiPadOSデバイスの場合、デフォルトは主要な更新メカニズムです。

DownloadOnlyは、ユーザーとユーザーレスデバイスの両方が、インストール時間の前にバックグラウンドでダウンロードをインストールするのに便利です。

ユーザーが提示されるものは次のとおりです。

パスコードで保護されていないデバイスは、MDMサーバーからコマンドが送信された直後にバージョンをインストールします。

パスコードで保護されたデバイスには、わずかに異なるフローが必要です。

デバイスがMDMからインストールコマンドを受信したら、次のロック解除に表示されるインストールアラートをスケジュールします。

これにより、ユーザーは今すぐインストールするか、今夜インストールするか、後で思い出させるかを選択できます。

iOSでは、ユーザーに表示されるこの最初のインストールアラートでは、今すぐインストール、後でインストール、または詳細を選択できます。

表示される後続のアラートは、アップデートをインストールする準備ができていることを知らせます。

例えば、「iOS 15.0はインストールする準備ができています。」

そして、提供されたオプションは、今すぐインストールまたは後でインストールです。

前の画面で後でタップすると、パスコードのプロンプトが表示され、下部に「後で思い出させる」オプションが表示されます。

MDMサーバーは、必要に応じてアップデートにフラグを付けることもできます。

これにより、ユーザーはRemind Me Laterを最大3回選択できます。

Remind Me Laterを3回タップすると、ユーザーがホーム画面を押すたびにインストール通知が表示され、Remind Me Laterオプションが削除されます。

アップデートをインストールする準備ができたタイムラインに戻りましょう。

ユーザーレスデバイスの場合、ScheduleOSUpdateでInstallForceRestartオプションを使用できます。

これらのデバイスは、更新を実行するためにハード再起動を行います。

また、ユーザーデバイスの場合、インストールコマンドを送信すると、更新を実行するためにユーザーに依存します。

つまり、今までです。

macOSに導入する新機能についてお伝えできることを嬉しく思います。

管理更新の延期期間が終了した後、ユーザーが更新を利用できるようにした後、更新が迅速にインストールされるようにする必要があります。

ユーザーが引き続き更新をキャンセルまたは延期したくありません。

あなたはそれを強制する方法が必要です。

macOS Montereyでは、アップデートを強制するためにInstallLaterポリシーをより詳細に制御できるようになりました。

アップデートが実施される前に、デバイスがインストールを促す回数を指定できます。

この数字はMaxUserDeferralsキーで定義されます。

このMaxUserDeferralsキーは、最大遅延数に達すると、既存のキーInstallForceRestartを意味します。

最大延期回数を強制すると、強制更新が発生する前に、ユーザーは残りの試行回数について有益な通知を受け取ります。

ユーザーの遅延の最大数を変更するには、新しいInstallLaterコマンドを発行するだけです。

ユーザーが提示されるものは次のとおりです。

MaxUserDeferrals値を設定すると、強制インストール前の残りの試行回数が通知に表示されます。

更新は今夜予定されていますが、ユーザーにはオプションが与えられます。

彼らはRemind Me Tomorrowを選択すると、更新を再度延期し、残りの試行回数を減らします。

彼らは今それをインストールするか、今夜遅くに更新を試みることができます。

ユーザーが何もしない場合、更新はその夜に試みます。

ユーザー延期の最大数に達すると、この更新が強制されることがユーザーに通知されます。

これは、ユーザーがまだデバイスを使用しているかどうかにかかわらず、マシンが再起動して更新を実行することを意味します。

これらの新しい変更により、管理者はmacOSのアップデートを実施し、デバイスがタイムリーに更新されるように、より詳細に制御できます。

ソフトウェアアップデートの管理についてお伝えしたいことがもう1つあります。

今年の新機能であるiOSとiPadOSでは、設定アプリ内の2つのソフトウェアアップデートバージョンから選択できるようになりました。

たとえば、最新の機能と最も完全なセキュリティアップデートのセットについては、リリースされるとすぐに次の主要なOSにアップデートできます。

あるいは、iOSまたはiPadOSの次のメジャーバージョンにジャンプする準備が整うまで、現在のメジャーリリースを続行し、重要なセキュリティアップデートを入手してください。

設定コマンドの新しいオプションを使用すると、ユーザーに表示されるOSアップデートを制御できます。

RecommendationCadenceというキーを持つSoftwareUpdateSettings辞書を提供することで、これを指定します。

このキーは3つの値を持つことができます。

RecommendationCadenceが0に設定されている場合に表示される内容は次のとおりです。

これはデフォルトのビューであり、MDMの制限がない場合に得られるものです。

メジャーバージョンとマイナーバージョンのアップデートの両方が利用可能です。

RecommendationCadenceを1に設定している場合、以下が表示されます。

2つのソフトウェアアップデートバージョンが利用可能な場合、デバイスにはより低いバージョン番号のソフトウェアアップデートバージョンが表示されます。

RecommendationCadenceを2に設定している場合、以下が表示されます。

2つのソフトウェアアップデートバージョンが利用可能な場合、デバイスにはより高いバージョン番号のソフトウェアアップデートが表示されます。

既存の enforceSoftwareDelayUpdateキーで延期が設定されている場合、デバイスはそれを考慮に入れ、RecommendedationCadenceによってフィルタリングされることに注意してください。

2つの更新の選択肢は最終的に収束します。

要約すると、macOSでは、MDMがデバイスに必要なアップデートを判断し、タイムリーにプッシュできるように、OSバージョンを使用したアップデートの展開をサポートします。

また、ブートストラップトークンを使用して、Appleシリコンを搭載したMacコンピュータでInstallLaterフローを自動化しました。

MDMがMaxUserDeferralsで更新を強制できるようにし、ユーザーが更新が発生したときに常に情報を入手できるようにし、少なくともワークフローを混乱させる可能性のあるタイミングで更新をスケジュールします。

最後に、iOSでは、設定に表示されるアップデートのバージョンを管理するためのサポートを追加しました。

この追加のコントロールを取得し、macOS MontereyとiOS 15のユーザーに素晴らしいアップデート体験を提供することを楽しみにしています。

ありがとう、そして素晴らしいWWDCをお過ごしください。

[パーカッシブミュージック]。