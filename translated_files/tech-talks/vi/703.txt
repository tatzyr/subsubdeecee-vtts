703

Xin chào, tên tôi là Michael Ford và tôi là một kỹ sư trong nhóm CloudKit.

Hôm nay chúng ta sẽ nói về GDPR và CloudKit.

GDPR là viết tắt của Quy định bảo vệ dữ liệu chung.

Đó là một quy định của Liên minh Châu Âu có hiệu lực vào ngày 25 tháng 5 năm 2018.

Quy định tập trung vào việc cung cấp cho người dùng khả năng hiển thị và kiểm soát dữ liệu cá nhân của họ và cách các công ty sử dụng dữ liệu đó.

Tại Apple, chúng tôi coi trọng quyền riêng tư của người dùng và chúng tôi muốn đảm bảo rằng các nhà phát triển có các công cụ họ cần để xây dựng các ứng dụng tuyệt vời đồng thời bảo vệ quyền riêng tư của người dùng.

Trong buổi nói chuyện này, chúng ta sẽ thảo luận về các API CloudKit mới và hiện có mà bạn có thể sử dụng để thực hiện các yêu cầu của người dùng liên quan đến GDPR hoặc các quy định khác.

Nếu bạn quan tâm đến một cuộc thảo luận rộng hơn về quyền riêng tư, hãy xem phiên "Ứng dụng tốt hơn thông qua quyền riêng tư tốt hơn" từ WWDC 2018.

Bây giờ, bạn có thể hỏi, "Tại sao chúng ta chỉ nói về CloudKit APIs?"

Hãy nói về một số dịch vụ đồng bộ hóa iCloud có sẵn cho các nhà phát triển sử dụng và bạn sẽ sớm thấy lý do tại sao.

Là một nhà phát triển, bạn có thể lưu dữ liệu người dùng vào iCloud bằng cách sử dụng Sao lưu iCloud, Cửa hàng Giá trị Chính, Ổ đĩa iCloud và CloudKit.

Hãy nói về cách ly dữ liệu, tương tác dữ liệu và tính khả dụng của API.

Đối với Sao lưu, Giá trị Khóa và iCloud Drive, dữ liệu luôn được lưu trữ cho một người dùng duy nhất.

CloudKit cung cấp cho các nhà phát triển một API linh hoạt hơn, nơi bạn có thể chia sẻ dữ liệu giữa những người dùng hoặc cung cấp dữ liệu cho tất cả người dùng.

Khi người dùng bắt đầu khôi phục Sao lưu iCloud, dữ liệu ứng dụng đã được lưu sẽ tự động khôi phục.

Dữ liệu ứng dụng được lưu vào Key Value Store và iCloud Drive được tự động đồng bộ hóa giữa tất cả các thiết bị nơi người dùng đăng nhập vào tài khoản iCloud của họ.

Ngược lại, dữ liệu mà ứng dụng của bạn lưu vào CloudKit không được tự động phản chiếu sang thiết bị khác.

Bạn có thể sử dụng Fetch Changes APIs hoặc Query APIs để truy cập tất cả hoặc một phần dữ liệu được lưu trữ trong CloudKit.

Sao lưu, Giá trị khóa và API ổ đĩa chỉ khả dụng trên thiết bị.

Bạn có thể sử dụng các phiên bản Objective-C hoặc Swift của CloudKit APIs trên thiết bị hoặc bạn có thể sử dụng các dịch vụ web CloudKit để truy cập dữ liệu CloudKit từ trình duyệt.

Như bạn có thể thấy, CloudKit là duy nhất.

Nó linh hoạt hơn và có nhiều cách hơn để tương tác với nó.

Khi thực hiện các yêu cầu GDPR về dữ liệu được lưu vào Sao lưu iCloud, Cửa hàng Giá trị Chính hoặc iCloud Drive, bạn có thể xử lý dữ liệu như các dữ liệu khác mà ứng dụng của bạn đã lưu trữ cục bộ.

Tuy nhiên, với CloudKit, bạn có thể cần tương tác với máy chủ để hoàn thành yêu cầu GDPR.

Bây giờ, khi chúng ta nói về GDPR nhiều hơn, tôi muốn bạn nhớ rằng tôi là một kỹ sư, không phải một luật sư.

Nếu bạn có thắc mắc về việc tuân thủ GDPR, bạn nên tham khảo ý kiến luật sư.

Điều đó nói rằng, hãy đi sâu vào một số quyền của người dùng được đảm bảo bởi GDPR.

GDPR đảm bảo cho người dùng quyền biết dữ liệu nào được lưu trữ về họ và nó đang được sử dụng như thế nào.

Người dùng có quyền truy cập dữ liệu được lưu trữ về họ.

Họ có quyền xuất dữ liệu.

Người dùng có thể yêu cầu tạm dừng xử lý dữ liệu của họ.

Họ có thể yêu cầu xóa dữ liệu của họ.

Điều này thường được gọi là quyền bị lãng quên.

Nếu dữ liệu về người dùng không chính xác, người dùng sẽ có thể cập nhật nó.

Người dùng cũng có thể phản đối cách dữ liệu của họ được sử dụng.

Các ví dụ bao gồm phản đối tiếp thị trực tiếp hoặc phản đối việc xử lý dữ liệu của người dùng để nghiên cứu khoa học.

Cuối cùng, người dùng nên có quyền truy cập vào sự can thiệp của con người nếu việc ra quyết định tự động có thể ảnh hưởng đến người dùng một cách hợp pháp hoặc vật chất.

Bây giờ, đó là một danh sách khá dài.

Hôm nay, chúng ta sẽ tập trung vào những quyền được áp dụng rộng rãi cho các nhà phát triển sử dụng CloudKit.

Đây sẽ không phải là một cuộc nói chuyện toàn diện về việc tuân thủ GDPR.

Thay vào đó, chúng tôi sẽ tập trung vào cách sử dụng các API CloudKit mới và hiện có để thực hiện các yêu cầu của người dùng liên quan đến GDPR hoặc các quy định khác.

Trước tiên hãy xem lại một số khái niệm bên trong CloudKit.

Ở cấp độ cao nhất là một vùng chứa CloudKit.

Bạn có thể có nhiều ứng dụng tương tác với cùng một vùng chứa CloudKit.

Bên trong vùng chứa CloudKit, có ba loại cơ sở dữ liệu.

Một cơ sở dữ liệu riêng tư, một cơ sở dữ liệu được chia sẻ và một cơ sở dữ liệu công khai.

Có một cơ sở dữ liệu công khai cho mỗi vùng chứa.

Theo mặc định, tất cả người dùng có thể đọc và ghi dữ liệu vào cơ sở dữ liệu công cộng.

Mỗi người dùng đều có cơ sở dữ liệu riêng tư và được chia sẻ của riêng họ trong một vùng chứa.

Dữ liệu trong cơ sở dữ liệu riêng tư thuộc về người dùng đó.

Nếu ứng dụng của bạn hỗ trợ chia sẻ, khi người dùng chấp nhận lời mời chia sẻ, dữ liệu sẽ hiển thị trong cơ sở dữ liệu được chia sẻ của họ.

Đây là một tham chiếu trở lại cơ sở dữ liệu riêng tư của chủ sở hữu, nơi dữ liệu thực tế cư trú.

Bên trong một cơ sở dữ liệu nhất định, bạn có thể có nhiều vùng.

Trong cơ sở dữ liệu riêng tư và cơ sở dữ liệu công cộng, luôn có một vùng mặc định.

Và trong một cơ sở dữ liệu riêng tư, bạn có thể tạo nhiều vùng tùy chỉnh.

Trong cơ sở dữ liệu được chia sẻ, các vùng hiển thị khi bạn chấp nhận lời mời chia sẻ.

Bên trong một khu vực là các bản ghi.

Đây là nơi bạn lưu trữ dữ liệu thực tế.

Để tóm tắt hệ thống phân cấp khái niệm của CloudKit, trước tiên bạn có một vùng chứa.

Sau đó, có ba loại cơ sở dữ liệu khác nhau.

Trong cơ sở dữ liệu, bạn có thể có một hoặc nhiều vùng, tùy thuộc vào loại cơ sở dữ liệu.

Cuối cùng, hồ sơ là nơi dữ liệu được lưu trữ.

Bây giờ chúng tôi đã xem xét các khái niệm CloudKit cốt lõi đó, chúng tôi đã sẵn sàng tập trung vào các quyền GDPR riêng lẻ.

Chúng ta sẽ cùng nhau xem xét quyền truy cập và tính di động.

Để thực hiện các quyền này, bạn sẽ cần tìm nạp dữ liệu từ CloudKit.

Để xóa, bạn sẽ cần xóa dữ liệu khỏi CloudKit.

Và để hạn chế, bạn sẽ áp dụng một hạn chế đối với một tài khoản trong trình kiểm toán CloudKit của mình.

Đối với các yêu cầu truy cập và tính di động, bạn nên cung cấp khả năng hiển thị dữ liệu được lưu bên trong CloudKit cho người dùng.

Bạn cũng nên cung cấp một cách để xuất dữ liệu của người dùng ở định dạng tiêu chuẩn.

Nếu bạn đang xuất một hình ảnh, sẽ rất hợp lý khi sử dụng định dạng tệp JPEG.

Đối với dữ liệu có cấu trúc chung, hãy sử dụng JSON hoặc CSV, tùy thuộc vào loại và lượng dữ liệu.

Bạn vừa xuất dữ liệu.

Mặc dù không có yêu cầu nhập dữ liệu, nhưng bạn có thể có được một số người dùng nếu bạn làm vậy.

Nếu bạn đã đồng bộ hóa tất cả dữ liệu cục bộ, bạn chỉ có thể thực hiện yêu cầu truy cập GDPR hoặc tính di động từ dữ liệu bạn đã lưu cục bộ.

Trong trường hợp bạn chưa có, bạn sẽ cần tìm nạp dữ liệu từ máy chủ CloudKit.

Vậy làm thế nào để bạn lấy tất cả dữ liệu từ CloudKit?

Bên trong hệ thống phân cấp CloudKit, đối với mọi vùng chứa, đối với mọi cơ sở dữ liệu, bạn nên tìm nạp tất cả các vùng và sau đó truy vấn tất cả các bản ghi.

Hãy xem lại một số mã để biết cách bạn sẽ làm điều đó.

Đầu tiên, hãy thiết lập các biến vùng chứa và cơ sở dữ liệu của chúng ta.

Trong trường hợp này, chúng tôi sẽ tập trung vào cơ sở dữ liệu riêng tư.

Tiếp theo, chúng ta sẽ tìm nạp tất cả các vùng bên trong cơ sở dữ liệu.

Chúng tôi sẽ lặp lại tất cả các khu vực đó và thiết lập một truy vấn.

Bạn sẽ nhận thấy rằng truy vấn này chỉ dành cho một loại bản ghi duy nhất, vì vậy bạn có thể cần chạy nhiều truy vấn.

Bạn có thể lặp qua tất cả các loại bản ghi mà bạn có hoặc liệt kê chúng riêng lẻ.

Chúng tôi sẽ chuyển một NSPredicate cho truy vấn luôn đúng, để chúng tôi nhận được tất cả các bản ghi của một loại bản ghi nhất định.

Sau đó, chúng tôi sẽ thực sự thực hiện truy vấn trong cơ sở dữ liệu.

Cuối cùng, một khi truy vấn trả về, bạn nên hiển thị các bản ghi hoặc lưu chúng để xuất.

Tôi vừa chỉ cho bạn mã để truy vấn tất cả các bản ghi trong cơ sở dữ liệu riêng tư.

Cơ sở dữ liệu được chia sẻ và cơ sở dữ liệu công cộng phức tạp hơn.

Đối với người tham gia, cơ sở dữ liệu được chia sẻ là chế độ xem một phần vào cơ sở dữ liệu riêng tư của chủ sở hữu.

Hãy nhớ rằng dữ liệu thuộc về chủ sở hữu, vì vậy bạn chỉ nên trả lại dữ liệu nếu nó liên quan đến người tham gia.

Điều tương tự cũng đúng với cơ sở dữ liệu công khai.

Theo mặc định, bất kỳ người dùng nào cũng có thể đọc hoặc ghi dữ liệu vào cơ sở dữ liệu công cộng.

Một lần nữa, bạn chỉ nên trả lại dữ liệu liên quan đến người dùng thực hiện yêu cầu GDPR.

Xóa là mãi mãi.

Bạn nên đảm bảo rằng người dùng thực sự muốn xóa dữ liệu của họ hàng loạt.

Bạn có thể muốn đưa ra một hạn chế như một giải pháp thay thế.

Nếu người dùng xác nhận rằng họ muốn xóa dữ liệu của họ, bạn sẽ cần xóa tất cả dữ liệu của người dùng khỏi CloudKit.

Hãy xem mã cho điều đó ngay bây giờ.

Một lần nữa, chúng tôi sẽ thiết lập vùng chứa và các biến cơ sở dữ liệu.

Chúng tôi sẽ tập trung vào cơ sở dữ liệu riêng tư.

Một lần nữa, chúng tôi sẽ tìm nạp tất cả các vùng bên trong cơ sở dữ liệu.

Bây giờ, chúng ta sẽ lấy zoneID từ các vùng riêng lẻ và sử dụng chúng để tạo hoạt động xóa.

Thao tác xóa này được chuyển trong các ID vùng bản ghi mà bạn muốn xóa.

Cuối cùng, chúng tôi thực hiện thao tác xóa đối với cơ sở dữ liệu.

Chúng tôi vừa thấy mã để xóa tất cả các vùng bên trong cơ sở dữ liệu riêng tư.

Một lần nữa, nếu ứng dụng của bạn hỗ trợ chia sẻ, hãy chọn lọc, nhưng lần này hãy chọn lọc những gì bạn xóa.

Xóa các bản ghi trong cơ sở dữ liệu được chia sẻ sẽ xóa chúng cho chủ sở hữu và tất cả những người tham gia khác trong phần chia sẻ.

Nếu có dữ liệu cần được xóa theo cách này, hãy thực hiện xóa bản ghi trước khi xóa các vùng.

Sau khi hoàn tất, hãy xóa tất cả các vùng trong cơ sở dữ liệu được chia sẻ của người dùng.

Trái ngược với việc xóa các bản ghi riêng lẻ, điều này sẽ không xóa dữ liệu cho chủ sở hữu hoặc những người tham gia khác trong phần chia sẻ.

Trên thực tế, việc xóa vùng trong cơ sở dữ liệu được chia sẻ sẽ thay đổi người dùng từ người tham gia chia sẻ sang trạng thái được mời.

Điều này có nghĩa là họ không còn nhìn thấy các vùng trong cơ sở dữ liệu được chia sẻ.

Cuối cùng, trong cơ sở dữ liệu công khai, bạn sẽ cần xem lại dữ liệu mà bạn đang lưu trữ liên quan đến một người dùng nhất định và xác định dữ liệu nào phù hợp để xóa.

Cuối cùng, hãy nói về sự hạn chế.

Trên thực tế, đây là một cách để tạm dừng hoặc tạm dừng xử lý dữ liệu của người dùng.

Theo GDPR, bạn có thể cần tạm dừng xử lý khi người dùng gọi một quyền khác.

Hoặc trong một số trường hợp, người dùng có thể yêu cầu bạn hạn chế dữ liệu của họ thay vì xóa nó.

Chúng tôi đã giới thiệu hai API dịch vụ web mới mà bạn có thể sử dụng để hạn chế hoặc hủy giới hạn tài khoản.

Bạn có thể gọi các API dịch vụ web này từ bất kỳ phiên bản iOS nào, miễn là bạn có thông tin đăng nhập thích hợp.

Hãy nói qua mã để hạn chế người dùng ngay bây giờ.

Đầu tiên, bạn sẽ cần tạo mã thông báo API trong bảng điều khiển CloudKit.

Khi bạn có mã thông báo API, bạn có thể tạo hoạt động fetchAuthorization.

API fetchAuthorization lần đầu tiên được phát hành trong iOS 9.2.

Với cả apiToken và webToken, bạn có mọi thứ bạn cần để thực hiện cuộc gọi hạn chế dịch vụ web.

Chúng tôi đã gói nó trong một chức năng trợ giúp hạn chế và chúng tôi sẽ xem xét điều đó ngay bây giờ.

Đầu tiên, bạn sẽ cần URL mã hóa webToken.

Tạo URL dịch vụ web đầy đủ bằng cách kết hợp các tham số baseURL, apiPath và truy vấn.

Khi bạn đã làm điều đó, bạn thực sự nên gửi yêu cầu dưới dạng bài đăng HTTP đến máy chủ CloudKit.

Chúng tôi sẽ không xem qua mã cho điều đó ngay bây giờ, nhưng bạn có thể tìm thấy nó trong tài liệu được liên kết của chúng tôi.

Khi bạn hạn chế người dùng, bất kỳ thao tác nào đối với vùng chứa đó sẽ dẫn đến lỗi managedAccountRestricted.

Bạn cũng sẽ thấy lỗi này nếu người dùng đã hạn chế tài khoản iCloud của họ thông qua Apple.

Apple sẽ ngừng xử lý dữ liệu của người dùng và sẽ trả lại lỗi này cho bất kỳ yêu cầu CloudKit nào, vì vậy hãy đảm bảo xử lý lỗi này trong mã của bạn.

Để xem xét, để truy cập và tính di động, hãy trả lại tất cả dữ liệu bên trong cơ sở dữ liệu riêng tư của người dùng.

Đối với cơ sở dữ liệu được chia sẻ và cơ sở dữ liệu công khai, hãy phân biệt khi xác định dữ liệu nào sẽ trả lại cho người dùng.

Để đáp ứng yêu cầu xóa người dùng, bạn có thể xóa tất cả dữ liệu bên trong cơ sở dữ liệu riêng tư của người dùng.

Bạn cũng có thể xóa các vùng được chia sẻ, điều này sẽ xóa người dùng với tư cách là người tham gia.

Đối với cơ sở dữ liệu công khai, hãy phân biệt khi xác định dữ liệu nào cần xóa.

Cuối cùng, chúng tôi đã giới thiệu các API dịch vụ web mới để hạn chế hoặc bỏ hạn chế tài khoản.

Bạn sẽ thấy lỗi managedAccountRestricted nếu bạn hạn chế người dùng hoặc nếu người dùng đã yêu cầu Apple hạn chế xử lý trên tài khoản iCloud của họ.

Với những công cụ này, chúng tôi biết rằng bạn có thể xây dựng quyền riêng tư tuyệt vời vào các ứng dụng của mình.

Để biết thêm thông tin, vui lòng truy cập developer.apple.com và vui lòng gửi email đến cloudkit@apple.com nếu bạn có bất kỳ câu hỏi hoặc phản hồi nào.