204

Là một nhà phát triển ứng dụng, điều quan trọng là bạn phải biết chính xác những gì ứng dụng của bạn đang lưu trữ trên đĩa, mọi thứ đang được lưu trữ ở đâu và tại sao cần thiết.

Cách tốt nhất để cập nhật những chi tiết này là kiểm kê những gì ứng dụng của bạn thực sự lưu trữ.

Để bắt đầu, hãy xây dựng và chạy ứng dụng của bạn trên một thiết bị, sau đó thực hiện tất cả các tính năng sẽ lưu trữ mọi thứ trên đĩa.

Khi bạn đã làm xong việc này, đã đến lúc xem xét những gì thực sự được lưu trữ và ở đâu.

Sử dụng cửa sổ Thiết bị và Trình mô phỏng trong Xcode để trích xuất vùng chứa ứng dụng của bạn để chúng tôi có thể thấy những gì có trong đó.

Chọn thiết bị của bạn ở cột bên trái, sau đó chọn ứng dụng của bạn trong danh sách Ứng dụng đã cài đặt.

Và sử dụng biểu tượng bánh răng, chọn Tải xuống vùng chứa và lưu nó trên máy Mac của bạn.

Trong Finder, Control-click vào tệp xcappdata đã được tải xuống.

Chọn Hiển thị Nội dung Gói và đi vào thư mục Dữ liệu Ứng dụng và bắt đầu kiểm kê.

Xem qua các thư mục để xem những gì được lưu trữ trong mỗi thư mục.

Đối với mỗi tệp, hãy đảm bảo rằng bạn có thể xác định nó là gì và tại sao nó được lưu trữ.

Nếu bạn không chắc tại sao có thứ gì đó ở đó, bạn có thể loại bỏ nó.

Bạn muốn xác minh rằng bạn đang đặt đúng tệp vào các thư mục thích hợp và cũng xem xét liệu tệp có nên được đưa vào bản sao lưu iTunes và iCloud hay không.

Chỉ bạn mới có thể trả lời hai câu hỏi đầu tiên, vì chúng liên quan đến chức năng ứng dụng của bạn.

Tôi sẽ tập trung vào hai câu hỏi cuối cùng và bắt đầu với nơi lưu trữ các tệp.

iCloud Drive là nơi tốt nhất để đặt tài liệu vì chúng có sẵn trên tất cả các thiết bị của người dùng.

Bởi vì nội dung trong thư mục ứng dụng của bạn trên iCloud Drive hiển thị, điều quan trọng là bạn chỉ đặt tài liệu vào đó mà mọi người sẽ nhận ra và truy cập trực tiếp.

Ứng dụng của bạn đọc và ghi nội dung cục bộ, và sau đó hệ điều hành sẽ tự động tải lên các tệp đó khi mạng khả dụng.

Vì nhiều thiết bị có thể truy cập các tệp trong iCloud Drive cùng một lúc, bạn cần sử dụng phối hợp tệp để tránh bất kỳ xung đột nào.

Vì vậy, hãy chắc chắn đọc tài liệu để biết thêm chi tiết.

Đối với các tệp được lưu trữ cục bộ, thư mục Tài liệu có sẵn trong vùng chứa ứng dụng của bạn.

Giống như với iCloud Drive, bạn chỉ nên lưu trữ các tài liệu hiển thị của người dùng ở đây.

Khi bạn đã xác minh rằng thư mục Tài liệu của bạn chỉ chứa các tệp cần được hiển thị, ứng dụng Tệp có thể hiển thị chúng ở vị trí Trên iPhone của tôi hoặc Trên iPad của tôi.

Để làm điều này, ứng dụng của bạn nên hỗ trợ Open in Place và cho biết rằng việc chia sẻ tệp đã được bật, cả hai đều được định cấu hình trong tệp Info.plist của bạn.

Ngoài việc xem các tệp của họ trong ứng dụng Tệp, mọi người có thể tìm thấy các tệp của họ trong Spotlight và trên iPad, kéo và thả chúng vào các ứng dụng khác.

Một lợi ích tuyệt vời khác của việc hiển thị thư mục Tài liệu của bạn là mọi người sẽ thấy các tệp của họ trong Giao diện người dùng Cài đặt Lưu trữ và có thể xóa các mục riêng lẻ.

Điều này giúp quản lý dung lượng đĩa dễ dàng hơn nhiều và sẽ giảm khả năng toàn bộ ứng dụng của bạn bị xóa khi dung lượng thấp.

Nhưng hãy nhớ rằng, những thứ duy nhất nên được đưa vào thư mục Tài liệu là các tệp sẽ có ý nghĩa đối với những người sử dụng ứng dụng của bạn.

Câu hỏi quan trọng bạn nên hỏi là, "Người dùng của tôi có thể xem tệp này không?"

Nếu câu trả lời là có, thì tốt thôi.

Nhưng nếu câu trả lời là không, hãy di chuyển nó ra khỏi thư mục Tài liệu và vào một trong các vị trí sau.

Thư mục Hỗ trợ Ứng dụng là một nơi tốt để lưu trữ các tệp có thể nằm trong thư mục Tài liệu của bạn nhưng người dùng không nên nhìn thấy điều đó.

Ví dụ, một cơ sở dữ liệu mà ứng dụng của bạn cần nhưng người dùng sẽ không bao giờ mở thủ công.

Bạn có thể lưu trữ các tệp ở cấp cao nhất hoặc bạn có thể tạo thư mục nếu điều đó giúp giữ mọi thứ ngăn nắp.

Thư mục hoàn toàn nằm dưới sự kiểm soát của bạn và nó liên tục.

Nội dung được bao gồm trong các bản sao lưu theo mặc định, nhưng bạn có thể chọn không tham gia các tệp nếu chúng không cần sao lưu.

Và cuối cùng, dung lượng đĩa được sử dụng trong thư mục Hỗ trợ Ứng dụng được báo cáo trong Giao diện người dùng Cài đặt Lưu trữ dưới tổng Tài liệu & Dữ liệu của ứng dụng của bạn.

Vị trí tiếp theo có sẵn cho ứng dụng của bạn là thư mục Bộ nhớ đệm.

Bạn có thể lưu trữ các tệp ở đây có thể bị loại bỏ nếu dung lượng thấp.

Đây là một vị trí tốt cho bất kỳ nội dung nào có thể tải xuống lại khi cần thiết.

Nội dung của thư mục Caches không được bao gồm trong bản sao lưu.

Khi một thiết bị sắp hết dung lượng đĩa, iOS có thể trợ giúp bằng cách xóa bộ nhớ cache.

Các tệp sẽ không bao giờ bị xóa khỏi thư mục bộ nhớ cache của bạn nếu ứng dụng của bạn đang chạy và hệ điều hành sẽ bắt đầu bằng cách xóa bộ nhớ cache cho các ứng dụng đã không được sử dụng trong một thời gian.

Như một phần thưởng cho bạn, các tệp trong thư mục bộ nhớ cache của bạn không được báo cáo như một phần trong tổng số Tài liệu & Dữ liệu của ứng dụng của bạn.

Mặc dù chúng được bao gồm trong không gian tổng thể được sử dụng bởi các ứng dụng.

Và cuối cùng, bạn có thể đặt các tệp mà bạn sẽ không cần trong bất kỳ khoảng thời gian dài nào vào thư mục Tạm thời.

Mặc dù hệ điều hành sẽ định kỳ xóa các tệp này khi ứng dụng của bạn không chạy, tốt nhất bạn nên xóa chúng khi bạn hoàn tất chúng.

Giống như thư mục Caches, thư mục Tạm thời không được sao lưu và không được báo cáo trong tổng Tài liệu & Dữ liệu của ứng dụng của bạn.

Đây là tất cả các vị trí phổ biến mà ứng dụng của bạn có thể lưu trữ tệp.

Sử dụng iCloud Drive và thư mục Tài liệu cho các tệp có thể truy cập được trong ứng dụng Tệp, trong khi hỗ trợ ứng dụng, bộ nhớ cache và thư mục tạm thời đều được sử dụng riêng cho ứng dụng của bạn.

Hãy chắc chắn xem lại nơi bạn đang lưu trữ mọi thứ và sử dụng đúng thư mục.

Cuối cùng, một vài mẹo thực hành tốt nhất.

Nếu bạn có các tệp không cần đưa vào bản sao lưu iTunes hoặc iCloud, hãy sử dụng NSFileManager APIs để đặt "IsExcludedFromBackupKey".

Bạn cũng muốn có khả năng phục hồi các tệp có thể được khôi phục từ phiên bản cũ hơn của ứng dụng của bạn.

Ví dụ: nếu bạn có phiên bản 32-bit của ứng dụng và các tệp của nó đã được sao lưu, thì đối với phiên bản 64-bit của ứng dụng, những tệp cũ hơn đó có thể được khôi phục và bạn cần có khả năng xử lý tình huống đó.

Tốt nhất là sử dụng sơ đồ lập phiên bản trên các tệp của mình để bạn có thể cung cấp khả năng tương thích mạnh mẽ trên nhiều phiên bản ứng dụng của mình.

Và hãy chắc chắn rằng bạn chỉ lưu trữ tệp ở một vị trí.

Ví dụ: nếu bạn đặt các tệp vào thư mục Tài liệu cục bộ của mình, đừng sao chép chúng trong iCloud Drive.

Chọn một nơi và bám sát nó.

Đối với tài liệu người dùng, tôi khuyên bạn nên chọn vị trí lưu trữ đám mây trừ khi bạn có lý do cụ thể để lưu trữ tệp chỉ cục bộ vào thiết bị.

Và cuối cùng, một số chi tiết dung lượng âm lượng mới có sẵn trong iOS 11 để giúp biết liệu đây có phải là thời điểm tốt để ứng dụng của bạn chiếm nhiều dung lượng đĩa hơn hay không.

Chìa khóa đầu tiên, Dung lượng khả dụng cho việc sử dụng quan trọng, cho biết dung lượng có thể được cung cấp cho những thứ mà người dùng đã yêu cầu rõ ràng trong giao diện người dùng ứng dụng của bạn.

Ví dụ, nếu họ đã chọn tải xuống một video hoặc một cấp độ mới trong một trò chơi.

Nếu không gian bạn cần lớn hơn những gì có sẵn, bạn nên cho họ biết rằng yêu cầu của họ không thể được đáp ứng.

Chìa khóa thứ hai, Dung lượng khả dụng cho việc sử dụng cơ hội, cho biết dung lượng có sẵn cho những thứ mà người dùng có thể muốn, nhưng chưa được yêu cầu rõ ràng.

Đây có thể là một cái gì đó giống như tập tiếp theo trong một loạt video mà họ đang xem hoặc các tài liệu được cập nhật gần đây trên máy chủ mà họ có thể sẽ mở.

Đối với các loại tệp này, ban đầu bạn có thể lưu trữ chúng trong thư mục Caches cho đến khi chúng thực sự được sử dụng, tại thời điểm đó bạn có thể chuyển chúng đến thư mục Hỗ trợ Ứng dụng hoặc Tài liệu.

Sau khi kiểm kê và xác định những gì ứng dụng của bạn đã lưu trữ, nếu bạn tìm thấy thứ gì đó không đúng chỗ, thì hãy cập nhật mã của bạn để đưa nó vào thư mục thích hợp.

Và đừng quên thêm bất kỳ mã di chuyển cần thiết nào để di chuyển các tệp từ nơi này sang nơi khác.

Nếu bạn không làm điều này, bạn có thể vô tình bỏ lại các tệp bị bỏ rơi.

Bằng cách dọn dẹp bộ nhớ trên đĩa của bạn, bạn có thể mở thư mục Tài liệu của mình cho mọi người trong ứng dụng Tệp và họ thậm chí có thể làm việc hiệu quả hơn với ứng dụng của bạn.

Bạn có thể tìm thêm thông tin tại developer.apple.com hoặc trên Diễn đàn Nhà phát triển của chúng tôi.

Cảm ơn vì đã xem!