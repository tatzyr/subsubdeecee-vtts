110353

Xin chào, tên tôi là Tim Chien.

Tôi là một kỹ sư trong nhóm MapKit ở đây tại Apple, làm việc trên MapKit JS.

Hôm nay tôi sẽ nói về một số tính năng mới thú vị mà bạn có thể sử dụng để mang lại trải nghiệm tốt nhất có thể khi tích hợp MapKit JS với ứng dụng web của mình.

Kể từ khi giới thiệu MapKit JS vào năm 2018, chúng tôi đã làm việc không mệt mỏi để bổ sung các tính năng mới mỗi năm.

Cùng với đó, MapKit JS đã trở thành một phần không thể thiếu trong dịch vụ web của Apple, được tích hợp vào nhiều trang web như trong máy chủ Find My của riêng chúng tôi trên icloud.com và các trang web của bên thứ ba như DuckDuckGo và trang web tìm kiếm tài sản ở Hy Lạp.

Bạn sẽ nhận thấy trang web này đang tận dụng khả năng bản địa hóa các tính năng bản đồ của MapKit JS.

Chúng tôi đã giúp việc áp dụng MapKit JS trong bất kỳ ứng dụng web nào trở nên cực kỳ dễ dàng với việc bao gồm và khởi tạo đơn giản.

Tuy nhiên, chúng tôi muốn cung cấp cho bạn sự linh hoạt để áp dụng MapKit JS theo cách tối ưu hóa hiệu suất của ứng dụng của bạn.

Vì vậy, bắt đầu từ năm nay, chúng tôi đã hướng mắt đến hiệu suất và xem xét cách chúng tôi có thể làm cho các trang của bạn phản hồi nhanh hơn, tải nhanh hơn và theo cách được thiết kế để cung cấp cho bạn nhiều quyền kiểm soát hơn, cho phép bạn chỉ bao gồm các chức năng bạn cần khi bạn cần.

Hôm nay, tôi rất vui khi giới thiệu ba tính năng mới sẽ làm được điều đó, bao gồm đánh dấu mới để tải MapKit JS hiệu suất cao, khả năng tải các thư viện MapKit JS bổ sung theo yêu cầu và cuối cùng là một cách mới để ứng dụng báo hiệu các tính năng bản đồ mong muốn để trình bày cho người dùng.

Bây giờ để chứng minh cách những tính năng mới này có thể cải thiện ứng dụng web của bạn, giả sử bạn đang xây dựng một bản đồ kho báu tương tác cho những tên cướp biển đồng nghiệp của mình.

Bạn đã áp dụng triển khai mặc định của MapKit JS.

Tuy nhiên, khi xem trang này qua Wi-Fi tàu cướp biển tệ hại, mất quá nhiều thời gian để tải và người dùng phải đợi quá lâu để bản đồ xuất hiện, khiến bạn cùng tàu của bạn mất kiên nhẫn.

Vì vậy, để ngăn chặn một cuộc nổi loạn, bạn có thể sử dụng đánh dấu tải MapKit JS hiệu suất cao mới.

Nó hoán đổi việc triển khai mặc định cho một đánh dấu mở rộng với các thuộc tính bổ sung mà bạn sẽ sử dụng để điều chỉnh ứng dụng web của mình.

Đầu tiên, MapKit JS hiện cung cấp một gói JavaScript mới, market.core.js, chỉ chứa lượng mã tối thiểu để bạn bắt đầu.

Tiếp theo, chúng tôi muốn cho MapKit JS biết tập hợp con các tính năng mà chúng tôi sẽ cần.

Ở đây, chúng tôi chỉ định thư viện bản đồ, đây là tính năng tối thiểu được đặt để hiển thị bản đồ tương tác.

Chúng tôi sẽ ngăn MapKit JS chặn tải trang bằng cách sử dụng thuộc tính không đồng bộ và gọi lại được chỉ định bởi thuộc tính gọi lại dữ liệu khi tải xong.

Vì MapKit JS không còn chặn trang tải nữa, ứng dụng web của bạn nên khẳng định sự sẵn sàng của nó trước khi đánh giá giao diện của nó lần đầu tiên.

Ví dụ, đây là một hàm không đồng bộ sẽ phân giải thành giao diện MapKit khi MapKit JS sẵn sàng.

Như mọi khi, MapKit JS có sẵn trên đối tượng cửa sổ toàn cầu ngay khi nó được tải.

Nếu đối tượng MapKit không được xác định, điều đó có nghĩa là MapKit JS vẫn chưa được tải.

Ngoài ra, chúng tôi muốn kiểm tra xem các thư viện ban đầu đã được tải chưa.

Nhớ lại rằng chúng tôi đã yêu cầu thư viện bản đồ trong đánh dấu bằng cách sử dụng thuộc tính của thư viện dữ liệu.

Không thành công trong hai bài kiểm tra có nghĩa là bộ gọi lại sử dụng thuộc tính gọi lại dữ liệu chưa được gọi.

Ở đây chúng tôi chuyển đổi một cuộc gọi lại thành một lời hứa cho hàm không đồng bộ của chúng tôi và dọn dẹp cuộc gọi lại ngay sau khi giải quyết lời hứa.

Cùng với đó, chúng tôi đã đảm bảo rằng MapKit JS đã sẵn sàng để triển khai khi tính năng này trở lại.

Bây giờ, quay lại cú pháp.

Có một số thuộc tính hữu ích khác trong đánh dấu hiệu suất cao của chúng tôi, bao gồm thuộc tính gốc chéo cho phép trình duyệt sử dụng lại một kết nối HTTP/2 duy nhất cho tất cả các yêu cầu đi đến MapKit JS CDN.

Chúng tôi cũng muốn MapKit JS tự khởi tạo ngay khi có cơ hội làm như vậy.

Chúng ta có thể đạt được điều đó bằng cách đặt mã thông báo ban đầu trong đánh dấu.

Ghép nó lại với nhau và chúng tôi sẽ làm cho trang của chúng tôi tải nhanh hơn nữa, nhưng chúng tôi vẫn chưa đến đó.

Vì chúng tôi chỉ yêu cầu thư viện bản đồ, chúng tôi sẽ cần tải thư viện chú thích để có thể đưa con tàu cướp biển và kho báu của chúng tôi trở lại bản đồ.

Và đó là nơi mà tối ưu hóa thứ hai của chúng tôi có ích.

Một phương pháp mới được cung cấp chỉ để tải xuống MapKit đó.

Nó tải các thư viện bổ sung không đồng bộ theo yêu cầu.

Và nếu bất kỳ thư viện nào bạn tải yêu cầu một thư viện khác, nó sẽ được xử lý tự động.

Và nó đang hoạt động ở đây.

Chỉ cần gọi phương thức tải xuống MapKit để tải thư viện chú thích.

Thêm trình nghe cho sự kiện tải, sau đó thêm chú thích của bạn khi nó được gọi.

Và tất nhiên, bạn có thể tải nhiều hơn chú thích.

Ví dụ, các dịch vụ bao gồm tất cả các API dịch vụ như tìm kiếm và mã hóa địa lý.

Bản đồ đầy đủ tải tất cả các tính năng có sẵn trên lớp bản đồ MapKit.

Và điều đó bao gồm bản đồ cơ bản, lớp phủ, chú thích và hiển thị vị trí người dùng.

Và GeoJSON tải trình nhập GeoJSON.

Bây giờ, đây là một trải nghiệm tải tốt, nhưng chúng ta có thể làm tốt hơn thế này.

Đây là tính năng thứ ba mà chúng tôi sẽ giới thiệu hôm nay: khởi động bản đồ ưu tiên.

Với thuộc tính ưu tiên tải mới, chúng tôi có thể hướng dẫn MapKit JS hiển thị các điểm quan tâm sớm hơn để giúp cướp biển hoang dã bắt đầu tốt hơn.

Khi đặt mức độ ưu tiên tải, bạn nên phục vụ cho trải nghiệm tốt nhất mà người dùng của bạn cần.

Có ba tùy chọn ưu tiên tải có sẵn.

Các điểm quan tâm hướng dẫn bản đồ MapKit hiển thị nhãn bản đồ và các điểm quan tâm sớm hơn, ngay cả trước chú thích của bạn.

Mặt khác, Land Cover sẽ chỉ phục vụ cho lớp phủ đất, đường xá và biên giới.

Vì các tùy chọn này sẽ can thiệp vào một số hành vi bản đồ trong quá trình khởi động, như xoay hoặc vùng bản đồ chính xác của khung nhìn, bạn có thể tắt hoàn toàn mức độ ưu tiên tải bằng cách đặt nó thành không có.

Và đây là những gì nó trông giống như trong hành động.

Chỉ cần sử dụng mức độ ưu tiên tải trong tùy chọn trình tạo bản đồ để chỉ định mức độ ưu tiên mong muốn.

Ở đây chúng tôi yêu cầu bản đồ MapKit hiển thị các điểm tham quan trước.

Bây giờ đó là một trải nghiệm tải thậm chí còn tốt hơn.

Hôm nay, chúng tôi đã giới thiệu ba tính năng mới được thiết kế để cải thiện trải nghiệm tải bản đồ của ứng dụng của bạn.

Chúng tôi tin rằng bạn có thể tích hợp MapKit JS trong khi đảm bảo rằng trải nghiệm người dùng tổng thể vẫn liền mạch và không bị suy giảm.

Đối với ứng dụng hiện tại của bạn, hãy thoải mái áp dụng các tính năng mới này dần dần, vì mỗi tính năng sẽ mang lại lợi ích riêng.

Hãy chắc chắn kiểm tra tài liệu chi tiết và phiên API Máy chủ Bản đồ được hiển thị bên dưới.

Chúng tôi mong muốn được thấy cách bạn tận dụng những tính năng mới này.

Cảm ơn bạn.