503

tvOS 11.2以降、Apple TV 4Kは、ビデオコンテンツのネイティブフレームレートとダイナミックレンジに合わせてビデオ表示モードを自動的に切り替えることができます。

設定アプリのビデオとオーディオセクションでは、一致するフレームレートとダイナミックレンジの動作を個別に設定でき、元のフレームレートとダイナミックレンジのコンテンツを表示できます。

デフォルトでは、これらのオプションは無効になっています。

有効にし、ビデオコンテンツが互換性のあるアプリで再生されると、tvOSはコンテンツと一致するようにビデオ表示設定を自動的に切り替えます。

たとえば、コンテンツが毎秒24フレームと標準ダイナミックレンジの場合、デバイスはシステムモードから毎秒24フレーム、標準ダイナミックレンジモードに切り替わります。

メディア再生セッションが終了すると、デバイスはシステムモードに戻ります。

コンテンツのフレームレートマッチングをサポートする最初のステップは、HLSマスタープレイリストがFRAME-RATE属性を使用してバリアントのネイティブフレームレートで完全に注釈付けされていることを確認することです。

プレイリストにFRAME-RATE属性が含まれていない場合、そのアセットではフレームレートモードの切り替えはサポートされません。

さらに、すべてのバリアントに対して単一のフレームレートを宣言するか、最小フレームレートの整数倍であるフレームレートのみを持つプレイリストのみがサポートされています。

例えば、29.97と59.94。

ダイナミックレンジモードのマッチングは、すべての非SDRコンテンツにすでにVIDEO-RANGE属性が含まれている必要があるため、VIDEO-RANGE属性が別途指定しない限り、コンテンツはSDRであると仮定されるため、通常、プレイリストの変更を必要としません。

AVPlayerViewControllerを使用するアプリは、applyPreferred DisplayCriteriaAutomaticallyプロパティがfalseに変更されない限り、自動的にモードマッチングをサポートします。

AVPlayerViewControllerを使用してコンテンツがフルスクリーンで再生されると、tvOSは自動的にそのコンテンツに適した表示モードに切り替わります。

その後、AVPlayerViewControllerがフルスクリーンモードを離れるか、却下されると、tvOSはシステム表示モードに戻ります。

AVPlayerViewControllerまたはTVMLKitを使用してフルスクリーンコンテンツを再生するアプリの場合、追加の作業は必要ありません。

ただし、ビデオが常にフルスクリーンで再生されない場合、複数のビデオを同時に再生する場合、異なる短いビデオを頻繁に切り替える場合、またはビデオ再生にAVPlayerViewControllerを使用していない場合は、モードスイッチが適切なタイミングで発生し、適切なメディアコンテンツの特性を反映するように、AVDisplayManager preferredDisplayCriteriaを直接指定する必要があります。

AVPlayerViewControllerを使用していて、モード切り替えを完全にオプトアウトしたい場合、または表示モードを手動で管理する必要がある場合は、AVPlayerViewControllerのapplyPreferredDisplay CriteriaAutomaticallyプロパティをfalseに設定することから始めます。

これにより、自動AVKitマッチング動作が無効になります。

次に、tvOSをトリガーして特定のコンテンツに合わせてモードを切り替えるには、AVAssetのpreferredDisplayCriteriaプロパティによって販売されたAVDisplayCriteriaオブジェクトを取得します。

AVDisplayCriteriaオブジェクトを、キーUIWindowによって販売されたAVDisplayManagerのpreferredDisplayCriteriaプロパティに割り当てます。

モードスイッチは、設定でマッチングが有効になっており、接続されたデバイスが優先モードをサポートしていると仮定して、このプロパティを設定すると発生します。

AVPlayerがターゲットディスプレイモードに基づいて設定できるように、AVPlayerItemをAVPlayerオブジェクトに割り当てる前に、このスイッチを実行する必要があります。

システムのデフォルトモードに戻すには、preferredDisplayCriteriaプロパティをnilに設定するだけです。

モードスイッチがいつ開始され、いつ終了するかを知るには、AVDisplayManagerオブジェクトのdisplayModeSwitchInProgressプロパティをキー値で観察できます。

メディアアプリケーションでこの新機能を利用する最良の方法を決定するために、心に留めておくべきいくつかのガイドラインがあります。必要な頻度でモードを切り替えます。

すべてのテレビはモード切り替えに少し異なる反応をしますが、一般的に画面が点滅したり、一時的にブラックアウトしたりし、完了するまでに数秒かかる場合があります。

必要以上に頻繁に発生する場合、これは破壊的になる可能性があります。

通常、モード切り替えはフルスクリーン再生にのみ適しています。

バックグラウンド、サムネイル、またはゲームの一部としてインタースティシャルとして再生されるコンテンツのフレームレートとダイナミックレンジのマッチングは、非常に破壊的であり、一般的に不要です。

ビデオ視聴体験以外のアプリの主要なユーザーインターフェイスは、UIとアニメーションがスムーズで流動的になるように、システムのフレームレートで実行する必要があります。

テレビが低フレームレートモードの場合、これらのアニメーションや動きもそのフレームレートでレンダリングされ、結果としてスムーズではないように見えることがあります。

また、デバイスをシステムモードにしておくと、ユーザーエクスペリエンスが向上する状況もいくつかあります。

アプリが短いクリップを再生したり、複数のビデオタイルを同時に表示したり、異なる特性を持つコンテンツを頻繁に切り替えたりする場合は、視聴体験が不必要に中断されないように、モードの切り替えを完全に避けることをお勧めします。

tvOS 11.2は、Apple TV 4Kでビデオコンテンツのフレームレートとダイナミックレンジマッチングを可能にします。

AVPlayerViewControllerはこの動作を自動的に管理できますが、一部のアプリではAVDisplayManagerとAVDisplayCriteriaを利用してより多くの制御が必要です。

詳細については、developer.apple.comをご覧ください。