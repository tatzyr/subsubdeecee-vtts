703

こんにちは、私の名前はマイケル・フォードで、CloudKitチームのエンジニアです。

今日はGDPRとCloudKitについて話します。

GDPRは一般データ保護規則の略です。

これは、2018年5月25日に施行された欧州連合の規制です。

この規制は、ユーザーが個人データと企業の使用方法を可視化し、制御することに重点を置いています。

Appleでは、ユーザーのプライバシーを大切にしており、開発者がユーザーのプライバシーを保護しながら優れたアプリケーションを構築するために必要なツールを持っていることを確認したいと考えています。

この講演では、GDPRやその他の規制に関連するユーザーの要求を満たすために使用できる新規および既存のCloudKit APIについて説明します。

より広範なプライバシーに関する議論に興味がある場合は、WWDC 2018の「より良いプライバシーを通じたより良いアプリ」セッションをご覧ください。

さて、「なぜ私たちはCloudKit APIについてだけ話しているのですか？」と尋ねるかもしれません。

開発者が利用できるiCloud同期サービスのいくつかについて話しましょう。すぐにその理由がわかります。

開発者として、iCloud Backup、Key Value Store、iCloud Drive、CloudKitを使用して、ユーザーデータをiCloudに保存できます。

データの分離、データインタラクション、APIの可用性について話しましょう。

バックアップ、キーバリュー、およびiCloud Driveの場合、データは常に1人のユーザーのために保存されます。

CloudKitは、ユーザー間でデータを共有したり、すべてのユーザーがデータを利用できるようにしたりできる、より柔軟なAPIを開発者に提供します。

ユーザーがiCloudバックアップの復元を開始すると、保存されたアプリケーションデータが自動的に復元されます。

キーバリューストアとiCloud Driveに保存されたアプリケーションデータは、ユーザーがiCloudアカウントにサインインしているすべてのデバイス間で自動的に同期されます。

対照的に、アプリケーションがCloudKitに保存するデータは、自動的に別のデバイスにミラーリングされません。

Fetch Changes APIまたはQuery APIを使用して、CloudKitに保存されているデータの全部または一部にアクセスできます。

バックアップ、キーバリュー、およびドライブAPIは、デバイスでのみ利用可能です。

デバイスでObjective-CまたはSwiftバージョンのCloudKit APIを使用するか、CloudKit Webサービスを使用してブラウザからCloudKitデータにアクセスできます。

ご覧のとおり、CloudKitはユニークです。

それはより柔軟で、それと対話する方法がもっとあります。

iCloudバックアップ、キーバリューストア、またはiCloud Driveに保存されたデータに対するGDPR要求を満たす場合、アプリケーションがローカルに保存した他のデータと同様にデータを処理できます。

ただし、CloudKitでは、GDPR要求を完了するためにサーバーと対話する必要があるかもしれません。

さて、GDPRについてもっと話すとき、私は弁護士ではなくエンジニアであることを覚えておいてください。

GDPRコンプライアンスについて質問がある場合は、弁護士に相談してください。

そうは言っても、GDPRによって保証されているユーザー権利の一部に入りましょう。

GDPRは、どのようなデータが保存され、どのように使用されているかを知る権利をユーザーに保証します。

ユーザーは、それらについて保存されたデータにアクセスする権利を有します。

彼らにはデータをエクスポートする権利がある。

ユーザーは、データの処理を一時停止するように要求できます。

彼らは自分のデータの削除を要求することができます。

これは一般的に忘れられる権利として知られています。

ユーザーに関するデータが間違っている場合、ユーザーはそれを更新できるはずです。

ユーザーは、データの使用方法に異議を唱えることもできます。

例としては、ダイレクトマーケティングに異議を唱えることや、科学研究のためにユーザーのデータを処理することに異議を唱えることなどがあります。

最後に、自動化された意思決定がユーザーに法的または重大な影響を与える可能性がある場合、ユーザーは人間の介入にアクセスする必要があります。

さて、それはかなりのリストです。

今日は、CloudKitを使用している開発者に広く適用される権利に焦点を当てます。

これは、GDPRコンプライアンスに関する包括的な話ではありません。

代わりに、新規および既存のCloudKit APIを使用して、GDPRやその他の規制に関連するユーザー要求を満たす方法に焦点を当てます。

まず、CloudKit内の概念のいくつかを見てみましょう。

最高レベルはCloudKitコンテナです。

複数のアプリケーションが同じCloudKitコンテナと対話することができます。

CloudKitコンテナの内部には、3種類のデータベースがあります。

プライベートデータベース、共有データベース、およびパブリックデータベース。

コンテナごとに1つのパブリックデータベースがあります。

デフォルトでは、すべてのユーザーはパブリックデータベースでデータを読み書きできます。

すべてのユーザーは、コンテナ内に独自のプライベートデータベースと共有データベースを持っています。

プライベートデータベース内のデータは、そのユーザーのものです。

アプリケーションが共有をサポートしている場合、ユーザーが共有招待を受け入れると、データは共有データベースに表示されます。

これは、実際のデータが存在する所有者のプライベートデータベースへの参照です。

特定のデータベース内では、複数のゾーンを持つことができます。

プライベートデータベースとパブリックデータベースには、常にデフォルトゾーンがあります。

また、プライベートデータベースでは、複数のカスタムゾーンを作成できます。

共有データベースでは、共有招待を受け入れるとゾーンが表示されます。

ゾーンの内側にはレコードがあります。

これは、実際のデータを保存する場所です。

CloudKitの概念階層を要約するには、まずコンテナがあります。

次に、3つの異なるタイプのデータベースがあります。

データベースでは、データベースの種類に応じて、1つ以上のゾーンを持つことができます。

最後に、レコードはデータが保存される場所です。

これらのコアCloudKitの概念を見直したので、個々のGDPRの権利に焦点を当てる準備が整いました。

アクセスと移植性を一緒に見ていきます。

これらの権利を果たすには、CloudKitからデータを取得する必要があります。

削除するには、CloudKitからデータを削除する必要があります。

また、制限については、CloudKit contianerのアカウントに制限を適用します。

アクセスとポータビリティの要求については、ユーザーのためにCloudKit内に保存されているデータの可視性を提供する必要があります。

また、ユーザーのデータを標準形式でエクスポートする方法も提供する必要があります。

画像をエクスポートする場合は、JPEGファイル形式を使用するのが理にかなっています。

一般的な構造化データの場合は、データの種類と量に応じて、JSONまたはCSVのいずれかを使用します。

データをエクスポートしたばかりです。

データをインポートする必要はありませんが、インポートすると一部のユーザーを獲得する可能性があります。

すでにすべてのデータをローカルで同期している場合は、ローカルに保存したデータからGDPRアクセスまたはポータビリティ要求を満たすことができます。

していない場合は、CloudKitサーバーからデータを取得する必要があります。

では、CloudKitからすべてのデータを取得するにはどうすればよいですか?

CloudKit階層内では、すべてのコンテナ、すべてのデータベースに対して、すべてのゾーンを取得し、すべてのレコードを照会する必要があります。

あなたがそれをどのように行うかについて、いくつかのコードを確認しましょう。

まず、コンテナ変数とデータベース変数を設定しましょう。

この場合、プライベートデータベースに焦点を当てます。

次に、データベース内のすべてのゾーンを取得します。 データベース内のゾーンを取得します。

これらすべてのゾーンを反復し、クエリを設定します。

このクエリは単一のレコードタイプのみであるため、複数のクエリを実行する必要がある場合があります。

あなたが持っているすべてのレコードタイプをループしたり、個別に列挙したりできます。

指定されたレコードタイプのすべてのレコードを取得できるように、常に真であるクエリにNSPredicateを渡します。

次に、実際にデータベースでクエリを実行します。

最後に、クエリが返されたら、レコードを表示するか、エクスポート用に保存する必要があります。

プライベートデータベース内のすべてのレコードを照会するコードをお見せしました。

共有データベースとパブリックデータベースはより複雑です。

参加者にとって、共有データベースは、所有者のプライベートデータベースへの部分的なビューです。

データは所有者に属しているため、参加者に関連する場合にのみデータを返す必要があります。

パブリックデータベースにも同じことが言えます。

デフォルトでは、どのユーザーでもパブリックデータベースにデータを読み書きできます。

繰り返しになりますが、GDPR要求を行うユーザーに関連するデータのみを返す必要があります。

削除は永遠です。

ユーザーが本当にデータを大量に削除したいことを確認する必要があります。

代替案として制限を提供したいと思うかもしれません。

ユーザーがデータを削除したいことを確認した場合は、CloudKitからユーザーのデータをすべて削除する必要があります。

今、そのためのコードを見てみましょう。

もう一度、コンテナとデータベースの変数を設定します。

プライベートデータベースに焦点を当てます。

繰り返しますが、データベース内のすべてのゾーンを取得します。

次に、個々のゾーンからzoneIDを引き出し、それらを使用して削除操作を作成します。

この削除操作は、削除したいレコードゾーンIDを渡します。

最後に、データベースに対して削除操作を実行します。

プライベートデータベース内のすべてのゾーンを削除するコードを見ました。

もう一度、アプリケーションが共有をサポートしている場合は、選択しますが、今回は削除するものを選択します。

共有データベースのレコードを削除すると、所有者と共有の他のすべての参加者のためにそれらが削除されます。

この方法で削除する必要があるデータがある場合は、ゾーンを削除する前にレコードの削除を実行してください。

それが完了したら、ユーザーの共有データベース内のすべてのゾーンを削除します。

個々のレコードを削除するのとは対照的に、これは所有者または共有の他の参加者のデータを削除しません。

実際、共有データベースのゾーンの削除は、ユーザーが共有の参加者から招待された状態に変更します。

これは、共有データベースのゾーンが表示されなくなったことを意味します。

最後に、パブリックデータベースでは、特定のユーザーに関連して保存しているデータを確認し、どのデータを削除するのが適切かを判断する必要があります。

最後に、制限について話しましょう。

事実上、これはユーザーのデータの処理を一時停止または一時停止解除する方法です。

GDPRでは、ユーザーが別の権利を行使したときに処理を一時停止する必要があるかもしれません。

または、場合によっては、ユーザーがデータを削除するのではなく、データを制限するように要求する場合があります。

アカウントを制限または制限解除するために使用できる2つの新しいWebサービスAPIを公開しました。

適切な資格情報があれば、どのバージョンのiOSからでもこれらのウェブサービスAPIを呼び出すことができます。

今、ユーザーを制限するコードについて話し合いましょう。

まず、CloudKitダッシュボードでAPIトークンを生成する必要があります。

APIトークンを取得したら、fetchAuthorization操作を作成できます。

fetchAuthorization APIは、iOS 9.2で初めてリリースされました。

apiTokenとwebTokenの両方を使用すると、Webサービスの制限コールを行うために必要なものがすべて揃っています。

私たちはそれを制限ヘルパー機能で包んだので、今それを見てみましょう。

まず、webTokenをURLエンコードする必要があります。

baseURL、apiPath、およびクエリパラメータを組み合わせて、完全なWebサービスURLを作成します。

完了したら、実際にHTTP投稿としてリクエストをCloudKitサーバーに送信する必要があります。

今のところそのコードは確認しませんが、リンクされたドキュメントで見つけることができます。

ユーザーを制限すると、そのコンテナに対する操作は、managedAccountRestrictedエラーになります。

ユーザーがAppleを通じてiCloudアカウントを制限した場合も、このエラーが表示されます。

Appleはユーザーのデータの処理を停止し、CloudKitリクエストに対してこのエラーを返すので、このエラーをコードで必ず処理してください。

確認するには、アクセスと移植性のために、ユーザーのプライベートデータベース内のすべてのデータを返します。

共有データベースとパブリックデータベースについては、どのデータをユーザーに戻すかを決定する際に識別してください。

ユーザーの削除要求に応答するには、ユーザーのプライベートデータベース内のすべてのデータを削除できます。

共有ゾーンを削除して、ユーザーを参加者として削除することもできます。

パブリックデータベースの場合、どのデータを削除するかを決定するときは、識別してください。

最後に、アカウントを制限または制限解除するための新しいウェブサービスAPIを導入しました。

ユーザーを制限する場合、またはユーザーがAppleがiCloudアカウント全体の処理を制限するように要求した場合、managedAccountRestrictedエラーが表示されます。

これらのツールを使用すると、アプリに優れたプライバシーを構築できることを知っています。

詳細については、developer.apple.comにアクセスし、ご質問やご意見がございましたら、お気軽にcloudkit@apple.comまでメールでお問い合わせください。